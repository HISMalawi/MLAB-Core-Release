import{_ as B}from"./Breadcrumb.cfeb06ed.js";import{u as F,a as E,_ as U,f as d,o as c,c as p,b as l,g as u,d as e,h as I,t as h,F as T,r as R,p as S,j as x,e as A,w as D,v as q}from"./entry.6a3fbfc1.js";import{S as V}from"./stock.8380d698.js";import{r as L}from"./XMarkIcon.fd9a39e2.js";import{r as M,a as P}from"./PencilSquareIcon.79aa7948.js";import{r as W}from"./ArrowDownTrayIcon.fa0f85a0.js";import{S as N,h as $,U as z,G,V as K}from"./transition.9bb58b2a.js";import{_ as X}from"./ambulance.097b3ca0.js";import{_ as H}from"./Dropdown.28b1fd1d.js";import{_ as O}from"./Loader.2c2cb550.js";import{u as Q}from"./vue.f36acd1f.f8958c90.js";import{r as J,e as Y,f as C}from"./fetch.444ade97.js";import{P as Z}from"./package.d411c004.js";import{r as ee}from"./SquaresPlusIcon.a19ce7b1.js";import{r as te}from"./ArrowUturnLeftIcon.1ffe50ee.js";import{r as se}from"./TrashIcon.4f2791d3.js";import{_ as oe}from"./stock_out.0bca0349.js";import"./nuxt-link.bebad584.js";import"./HomeIcon.54ceb79b.js";import"./hidden.e85239c2.js";import"./listbox.064b6dcd.js";import"./use-text-value.75cce7ff.js";import"./CheckIcon.9343e206.js";import"./CheckCircleIcon.6ff04472.js";import"./MagnifyingGlassIcon.ba982fe1.js";import"./constants.cf42f90d.js";import"./PrinterIcon.b8623d34.js";const ae={components:{TransitionRoot:N,TransitionChild:$,Dialog:z,DialogPanel:G,DialogTitle:K,XMarkIcon:L},data(){return{transferIcon:M,saveIcon:W,show:!1,loading:!1,editIcon:P,cookie:F("token")}},props:{data:{type:Object,required:!0}},computed:{filteredRequisitions(){return this.data.requisitions.map((o,s)=>{o.stock_item.name=="-- select item --"&&this.data.requisitions.splice(s,1)}),this.data.requisitions.map(o=>({stock_item_name:o.stock_item.name,stock_item_id:o.stock_item.id,quantity:o.quantity_requested,lot:o.lot_number,batch:o.batch_number,expiry_date:o.expiry_date}))}},methods:{async submitForm(){this.loading=!0;const o=new V,s={receiving_from:this.data.receiving_from,stock_status_reason:this.data.reason,stock_items:this.filteredRequisitions},{data:i,error:y,pending:t}=await o.receiveExternalStock(`${this.cookie}`,s);this.loading=t,i.value&&(this.loading=!1,E().$toast.success("Stock received successfully"),this.handleClick(),this.$router.push("/stock-management/transactions")),y.value&&(this.loading=!1,console.error(y.value),this.handleClick())},handleClick(){this.show=!this.show}}},le=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),ie={class:"fixed inset-0 overflow-y-auto"},ne={class:"flex min-h-full items-center justify-center p-4 text-center"},re={class:"border-b px-3 py-3 flex items-center justify-between"},ce=e("img",{src:X,class:"w-8 h-8 mr-2"},null,-1),de={class:"py-5 px-5"},me={class:"w-full flex items-center space-x-2"},ue=e("p",{class:"w-72 font-medium"},"From: ",-1),pe={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},_e={class:"w-full flex items-center space-x-2 mt-2"},fe=e("p",{class:"w-72 font-medium"},"Reason for transfer: ",-1),he={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},ye=e("div",{class:"bg-gray-50 px-2 py-2 border rounded-t mt-4"},[e("h3",{class:"font-semibold"},"Stock In Items")],-1),be={class:"w-full"},ke=e("thead",{clas:"w-full border-l border-r"},[e("tr",{class:"border-b border-r border-l rounded"},[e("th",{class:"px-2 py-2 text-left border-r"}," Item "),e("th",{class:"px-2 py-2 text-left"}," Quantity ")])],-1),ve={class:"px-2 py-2 border-r"},xe={class:"px-2 py-2 border-r"},ge={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function we(o,s,i,y,t,n){const b=A,k=d("TransitionChild"),_=d("DialogTitle"),m=d("XMarkIcon"),v=d("FormKit"),g=d("DialogPanel"),w=d("Dialog"),a=d("TransitionRoot");return c(),p("div",null,[l(b,{click:n.handleClick,color:"success",text:"Receive",icon:t.transferIcon},null,8,["click","icon"]),l(a,{appear:"",show:t.show,as:"template"},{default:u(()=>[l(w,{as:"div",class:"relative z-10"},{default:u(()=>[l(k,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:u(()=>[le]),_:1}),e("div",ie,[e("div",ne,[l(k,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:u(()=>[l(g,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:u(()=>[e("div",re,[l(_,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:u(()=>[ce,I(" Checkout Stock Transfer ")]),_:1}),e("button",{onClick:s[0]||(s[0]=(...f)=>n.handleClick&&n.handleClick(...f))},[l(m,{class:"w-5 h-5"})])]),l(v,{type:"form","submit-label":"Update",onSubmit:n.submitForm,actions:!1,id:"submitForm"},{default:u(({value:f})=>[e("div",de,[e("div",me,[ue,e("span",pe,h(i.data.receiving_from),1)]),e("div",_e,[fe,e("span",he,h(i.data.reason),1)]),ye,e("table",be,[ke,e("tbody",null,[(c(!0),p(T,null,R(n.filteredRequisitions,(r,j)=>(c(),p("tr",{key:j,class:"border-b border-t border-r border-l rounded"},[e("td",ve,h(r.stock_item_name),1),e("td",xe,h(r.quantity),1)]))),128))])])]),e("div",ge,[n.filteredRequisitions.length>0?(c(),S(b,{key:0,loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.transferIcon,text:"Continue"},null,8,["loading","icon"])):x("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ie=U(ae,[["render",we]]),Se={setup(){Q({title:`${Z.name.toUpperCase()} - Receive Stock`})},components:{SquaresPlusIcon:ee},data(){return{open:!1,transferIcon:M,saveIcon:W,clearIcon:te,addIcon:J,deleteIcon:se,destinations:new Array,selectedDestination:{name:"-- select sender --"},reason:"",requisitions:new Array,stockItems:new Array,cookie:F("token"),showFacility:!1,showWard:!1,suppliers:new Array,selectedDeparment:{name:"-- select supplier --"},facilities:new Array,selectedFacility:{name:"-- select facility --"},wards:new Array,selectedWard:{name:"-- select Ward --"},selectedItem:{name:"-- select item --"},pages:[{name:"Home",link:"/home"},{name:"Stock Management",link:"#"},{name:"Transactions",link:"/stock-management/transactions"}],transferData:{},requisitionLoading:{id:0,value:!1}}},computed:{destinationOptions(){return[{name:"Supplier",label:"Supplier"},{name:"Facility",label:"Facility"},{name:"Wards",label:"Wards"}]},selectedItems(){switch(this.selectedDestination.name){case"Supplier":return this.selectedItem={name:"-- select supplier --"},this.suppliers;case"Facility":return this.selectedItem={name:"-- select facility --"},this.facilities;case"Ward":return this.selectedItem={name:"-- select ward --"},this.wards;default:return[]}}},created(){this.addDestinations(),this.loadStockItems()},methods:{async loadStockItems(){const o=new V,{data:s,error:i}=await o.getStockItem(`${this.cookie}`);s.value&&(this.stockItems=s.value),i.value&&console.error(i.value)},async loadFacilities(){const o={route:Y.facility,method:"GET",token:`${this.cookie}`},{data:s,error:i}=await C(o);s.value&&(this.facilities=s.value.data),i.value&&console.error(i.value)},async loadSuppliers(){const o=new V,{data:s,error:i}=await o.getStockSupplier(`${this.cookie}`);s.value&&(this.suppliers=s.value),i.value&&console.error(i.value)},async loadWards(){console.log("bjkm");const o={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:`${this.cookie}`},{data:s,error:i}=await C(o);s.value&&(this.wards=s.value),i.value&&console.error(i.value)},addStockItem(){this.requisitions.push({id:0,stock_item:{name:"-- select item --",id:0},quantity_requested:0,batch_number:"",lot_number:"",expiry_date:""})},deleteStockItem(o){o>=0&&o<this.requisitions.length&&this.requisitions.splice(o,1)},addDestinations(){["Supplier","Ward","Department"].forEach(s=>this.destinations.push({name:s}))}},watch:{selectedDestination:{handler(o){const s={Supplier:this.loadSuppliers,Facility:this.loadFacilities,Ward:this.loadWards};console.log(o);const i=s[o.name];i&&i.call(this)},deep:!0}}},Ve={class:"px-5 py-5"},De={class:"flex items-center justify-between py-5"},qe=e("h3",{class:"text-2xl font-semibold capitalize"},"Receive External Stock",-1),Ce={class:"w-full mt-2 grid grid-cols-5 gap-2"},Fe={class:"col-span-1 order-2 rounded border"},Ue=e("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[e("h3",{class:"font-semibold text-lg"},"Details")],-1),Te={class:"flex flex-col space-y-2 px-5 py-5"},Re={class:"w-full flex flex-col space-y-2"},Ae=e("label",{class:"font-medium"},"Receive From",-1),Me={key:0,class:"w-full flex flex-col space-y-2"},We={class:"font-medium"},je=e("span",{class:"text-red-600 font-medium"},"*",-1),Be={class:"col-span-4 order-1 rounded border"},Ee=e("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[e("h3",{class:"font-semibold text-lg"},"Stock Items")],-1),Le={class:"px-5 py-5"},Pe={class:"grid grid-cols-6 gap-5 mb-5"},Ne={class:"flex flex-col space-y-2"},$e=e("label",{class:"font-medium mb-0"},"Stock item",-1),ze={class:"mt-8 flex items-center space-x-2"},Ge={class:"flex flex-col items-center justify-center space-y-2"},Ke=e("img",{src:oe,class:"w-28 h-28 text-red-500"},null,-1),Xe=e("p",{class:"flex items-center"},"No stock items entered for receive",-1);function He(o,s,i,y,t,n){const b=B,k=Ie,_=H,m=d("FormKit"),v=A,g=O,w=d("SquaresPlusIcon");return c(),p("div",Ve,[l(b,{pages:t.pages},null,8,["pages"]),e("div",De,[qe,l(k,{data:{reason:t.reason,receiving_from:`${t.selectedItem.name.includes("select")?"":t.selectedItem.name} ${t.selectedDestination.name.includes("select")?"":t.selectedDestination.name}`,requisitions:t.requisitions}},null,8,["data"])]),e("div",null,[e("div",Ce,[e("div",Fe,[Ue,e("div",Te,[e("div",Re,[Ae,l(_,{items:t.destinations,modelValue:t.selectedDestination,"onUpdate:modelValue":s[0]||(s[0]=a=>t.selectedDestination=a)},null,8,["items","modelValue"])]),t.selectedDestination&&n.selectedItems.length>0?(c(),p("div",Me,[e("label",We,[I("Select "+h(t.selectedDestination.name.toLowerCase()),1),je]),l(_,{"is-searchable":!0,items:n.selectedItems,modelValue:t.selectedItem,"onUpdate:modelValue":s[1]||(s[1]=a=>t.selectedItem=a)},null,8,["items","modelValue"])])):x("",!0),l(m,{label:"Reason for receiving",type:"textarea",modelValue:t.reason,"onUpdate:modelValue":s[2]||(s[2]=a=>t.reason=a),validation:"required"},null,8,["modelValue"])])]),e("div",Be,[Ee,e("div",Le,[D(l(v,{color:"primary",click:n.addStockItem,text:"Add items",icon:t.addIcon},null,8,["click","icon"]),[[q,t.requisitions.length>0]]),(c(!0),p(T,null,R(t.requisitions,(a,f)=>(c(),p("div",{class:"flex flex-col space-y-3 mt-5",key:f},[e("div",Pe,[e("div",Ne,[$e,l(_,{"is-searchable":!0,items:t.stockItems,modelValue:a.stock_item,"onUpdate:modelValue":r=>a.stock_item=r},null,8,["items","modelValue","onUpdate:modelValue"])]),l(m,{label:"Quantity received",type:"number",validation:"required",modelValue:a.quantity_requested,"onUpdate:modelValue":r=>a.quantity_requested=r,modelModifiers:{lazy:!0},delay:1e3},null,8,["modelValue","onUpdate:modelValue"]),l(m,{label:"Batch",type:"text",validation:"required",modelValue:a.batch_number,"onUpdate:modelValue":r=>a.batch_number=r,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),l(m,{label:"Lot",type:"text",validation:"required",modelValue:a.lot_number,"onUpdate:modelValue":r=>a.lot_number=r,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),l(m,{type:"date",modelValue:a.expiry_date,"onUpdate:modelValue":r=>a.expiry_date=r,label:"Expiry Date"},null,8,["modelValue","onUpdate:modelValue"]),e("div",ze,[t.requisitionLoading.id==a.id&&t.requisitionLoading.value?(c(),S(g,{key:0,class:"w-5 h-5"})):x("",!0),t.requisitionLoading.value?x("",!0):(c(),S(v,{key:1,icon:t.deleteIcon,text:"Delete",color:"error",click:()=>{n.deleteStockItem(f)}},null,8,["icon","click"]))])])]))),128)),D(e("div",Ge,[Ke,Xe,e("button",{onClick:s[3]||(s[3]=(...a)=>n.addStockItem&&n.addStockItem(...a)),type:"button",class:"flex items-center text-sky-500 font-medium"},[l(w,{class:"w-5 h-5 mr-2"}),I(" Add stock item ")])],512),[[q,t.requisitions.length==0]])])])])])])}const gt=U(Se,[["render",He]]);export{gt as default};
