import{a as C,b as h,_ as S,g as a,o as b,c as I,d as r,h as l,e as c,i as D,p as q,k as A,f as L}from"./entry.d9fbdf98.js";import{a as R,e as f,f as _}from"./fetch.b6555f7e.js";import{r as V}from"./XMarkIcon.06a44024.js";import{r as k}from"./PrinterIcon.03ed4c0e.js";import{S as O,h as U,U as z,G as N,V as B}from"./transition.ce32fc16.js";const F={components:{TransitionRoot:O,TransitionChild:U,Dialog:z,DialogPanel:N,DialogTitle:B,XMarkIcon:V,ExclamationTriangleIcon:R,PrinterIcon:k},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1},orderTests:{type:Array,required:!1}},data(){return{show:!1,printIcon:k,cookie:C("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const i={route:f.printers,method:"GET",token:`${this.cookie}`},{data:e,error:t}=await _(i);e.value&&(this.printers=new Array,e.value.map(d=>{this.printers.push(d.name)})),t.value&&console.error(t.value)},isCrossMatchTest(){var i;return this.orderTests?(i=this.orderTests)==null?void 0:i.some(e=>e.test_type_name.toLowerCase()=="cross-match"):!1},async toPrintSmallLabel(){this.zebraPrinting=!0;const i={route:f.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests,is_cross_match:this.isCrossMatchTest()}},{data:e,error:t,pending:d}=await _(i);if(this.zebraPrinting=d,e.value){this.zebraPrinting=!1;const o=new FileReader;o.onload=()=>{const n=URL.createObjectURL(e.value),s=document.createElement("a");s.href=n,s.setAttribute("download",`${Date.now()}.lbl`),s.click(),URL.revokeObjectURL(n)},o.readAsText(e.value)}t.value&&(this.zebraPrinting=!1,console.error(t.value))},containsWords(i,...e){for(let t=0;t<e.length;t++)if(i.cssText.includes(e[t]))return!0;return!1},async submitForm(i){var p,m;let e=new FormData;this.loading=!0;let t=new Array;t.push(Number(this.orderId));let d=this.id;e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(t)),e.append("client_id",d);const o={route:f.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:n,error:s,pending:u}=await _(o);this.loading=u,n.value&&(n.value.printed?h().$toast.success("Patient report printed successfully!"):h().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((p=this.$route.query.printer)==null?void 0:p.toString())=="true"&&this.$router.back(),this.handleClick()),s.value&&(this.loading=!1,console.error(s.value),h().$toast.error("An error occurred while printing patient report"),this.handleClick(),((m=this.$route.query.printer)==null?void 0:m.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show}}},j=c("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),M={class:"fixed inset-0 overflow-y-auto"},E={class:"flex top-0 items-center justify-center p-4 text-center"},$={class:"border-b px-3 py-3 flex items-center justify-between"},G={class:"py-5 px-5"},X={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function K(i,e,t,d,o,n){const s=L,u=a("TransitionChild"),p=a("PrinterIcon"),m=a("DialogTitle"),v=a("XMarkIcon"),g=a("FormKit"),x=a("DialogPanel"),w=a("Dialog"),P=a("TransitionRoot");return b(),I("div",null,[r(s,{click:n.init,color:"primary",text:"Print",icon:o.printIcon},null,8,["click","icon"]),r(P,{appear:"",show:o.show,as:"template"},{default:l(()=>[r(w,{as:"div",class:"relative z-10"},{default:l(()=>[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>[j]),_:1}),c("div",M,[c("div",E,[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[r(x,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[c("div",$,[r(m,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>[r(p,{class:"h-5 w-5 mr-2"}),D(" Print ")]),_:1}),c("button",{onClick:e[0]||(e[0]=(...y)=>n.handleClick&&n.handleClick(...y))},[r(v,{class:"w-5 h-5"})])]),r(g,{type:"form","submit-label":"Update",onSubmit:n.submitForm,actions:!1},{default:l(({value:y})=>[c("div",G,[r(g,{validation:"required",label:"Select a printer",type:"radio",modelValue:o.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=T=>o.selectedPrinter=T),options:o.printers},null,8,["modelValue","options"])]),c("div",X,[t.printSmallLabel?(b(),q(s,{key:0,type:"button",loading:o.zebraPrinting,click:()=>{n.toPrintSmallLabel()},icon:o.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):A("",!0),r(s,{click:()=>{},loading:o.loading,type:"submit",icon:o.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Y=S(F,[["render",K]]);export{Y as _};
