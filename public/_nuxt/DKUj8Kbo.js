import{_ as xe}from"./ucPVlGIa.js";import{u as ge}from"./Bnl9n6mh.js";import{al as $e,am as Re,d as z,a as Z,ak as he,c as g,C as c,T as ee,r as S,an as te,u as F,w as oe,o as H,y as A,b as d,e as m,g as t,ao as we,f as u,h as e,k as I,H as re,z as K,t as y,F as V,j as B,K as L,l as ne,E as se,_ as ae,ap as Ce,a5 as ke,N as Te,L as Ne,aq as Ee}from"./CnHVHtNb.js";import{_ as Se}from"./D8FNkFa0.js";import{P as Ie}from"./O-3ebvIT.js";import{_ as le}from"./BmVeJhZC.js";import{_ as ie,a as ce}from"./D-MoOnWN.js";import{u as ue,_ as de}from"./Dm7K0ulU.js";import{_ as pe}from"./n49EBazs.js";import{u as me}from"./DY202iD-.js";import{r as _e}from"./YtRYkxjm.js";import{r as ye}from"./lw9t-99L.js";import"./BZb3bzVo.js";import"./n6mkMIpm.js";const ve=()=>{const f=$e();return{replaceQuery:l=>f.replace({query:l}),removeQuery:l=>{const C={...f.currentRoute.value.query};return Object.keys(l).forEach($=>delete C[$]),f.replace({query:C})},removeAllQueries:()=>f.replace({query:{}}),replaceOneQuery:(l,C)=>{const $={...f.currentRoute.value.query};return $[l]=C[l],f.replace({query:$})}}},be=f=>Object.values(f).every(i=>i===null),fe=(f,i)=>{f.count!==0&&f.associated_ids!==""?i.$router.push(`/reports/${f.associated_ids}?origin=culture&type=culture-sensitivity-${f.type}-report&from=${f.date_filter}&to=${f.date_filter}&test=${f.test}&department=Microbiology&count=${f.count}`):i.$toast.warning("No data found for this month")},J=Re("culture",{state:()=>({currentRoute:{index:0,reportId:"",period:""},routes:[]}),actions:{setCurrentRoute(f,i,T){this.currentRoute.index=f,this.currentRoute.reportId=i,this.currentRoute.period=T||"",this.updateRoutes(f,i,T)},revertRoute(f){this.currentRoute.index=f,this.currentRoute.reportId="",this.updateRoutes(f,"")},updateRoutes(f,i,T){const E=this.routes.findIndex(N=>N.index===f);E!==-1?i!==""?(this.routes[E].reportId=i,this.routes[E].period=T||""):this.routes.splice(E,1):i!==""&&this.routes.push({index:f,reportId:i,period:T}),this.routes.sort((N,l)=>N.index-l.index)}},persist:{storage:sessionStorage}}),Me={class:"w-full flex items-center justify-between mb-10"},Oe={class:"flex flex-row items-center bg-gray-100 rounded-l pl-2 font-normal text-zinc-500"},Ge={class:"w-44 ml-2"},De={class:"w-48"},Ae={class:"rounded border",id:"print-container"},Ue={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ye=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:pe,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY GENERAL COUNTS REPORT ")],-1),je={class:"px-4 py-2.5 font-medium"},Fe={class:"font-normal"},Pe={key:0,class:"w-full mt-2",ref:"table"},qe={class:"w-full border-b border-t bg-gray-100 rounded-t"},Ve={class:"w-full"},Be={class:"border-b"},Le={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Qe=t("img",{src:ce,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),We=t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"General Counts"),I(" report. ")],-1),Ke=[Qe,We],ze=z({__name:"general-counts",async setup(f){let i,T;const E=Z("token"),N=me(),l=J(),C=he(),$=g(()=>{const s=C.query.dateFrom;return s&&typeof s=="string"&&s.trim()!==""?c(s.split("/").join("-01-")).format(ee):""}),p=g(async()=>{const s=l.routes.find(a=>a.index==0);return(s==null?void 0:s.period)||""}),_=S(String(([i,T]=te(()=>p.value),i=await i,T(),i))),Y=ve(),{$toast:M}=F(),{loading:R,executeCancellableRequest:r,cancelRequest:h}=ue(),x=S({Growth:{total:0,associated_ids:""},"No growth":{total:0,associated_ids:""},"Mixed growth; no predominant organism":{total:0,associated_ids:""},"Growth of normal flora; no pathogens isolated":{total:0,associated_ids:""},"Growth of contaminants":{total:0,associated_ids:""}}),G=S([{name:"Growth"},{name:"No Growth"},{name:"Mixed Growth:  No Predominant Organism"},{name:"Growth Normal Flora: No Pathogens Isolated"},{name:"Growth: Contaminations"}]),q=g(()=>G.value.map(s=>({NAME:s.name,COUNT:x.value[s.name]||0}))),O=(s,a,k)=>{Y.replaceOneQuery("revert",{revert:"true"}),fe({test:s,type:"General Counts",count:a,associated_ids:k,date_filter:c(_.value).format("YYYY-MM-DD")},F())},j=g(()=>_.value.length!==0?c(_.value).format("yyyy"):""),U=g(()=>_.value.length!==0?c(_.value).format("M"):"");async function o(){R.value=!0;const s=await n.value,a={route:`${ne.aggregateReports}culture/general_counts?year=${j.value}&month=${U.value}&report_id=${s||""}`,method:"GET",token:`${E.value}`},{data:k,error:D,pending:P}=await r(a);R.value=P,k.value&&(x.value=k.value,R.value=!1,l.setCurrentRoute(0,k.value.report_id,_.value),M.success("Report data generated successfully")),D.value&&(console.error(D.value),R.value=!1,M.error(se))}const n=g(async()=>{const s=l.routes.find(a=>a.index==0);return(s==null?void 0:s.reportId)||""});return oe(_,()=>{_&&l.setCurrentRoute(0,"")},{deep:!0}),H(async()=>{await n.value||$.value!==""?o():R.value=!1}),(s,a)=>{var w;const k=A("datepicker"),D=ae,P=le,Q=A("excel"),W=ie,v=de;return d(),m("div",null,[t("div",Me,[t("form",{onSubmit:a[1]||(a[1]=we(b=>o(),["prevent"])),class:"flex items-center space-x-5"},[t("div",Oe,[u(e(_e),{class:"w-4 h-4 mr-2"}),I(" Filter by date "),t("div",Ge,[u(k,{placeholder:"month & year",required:"","input-class-name":"custom-input",modelValue:e(_),"onUpdate:modelValue":a[0]||(a[0]=b=>re(_)?_.value=b:null),range:!1,format:"M/yyyy",position:"left"},null,8,["modelValue"])])]),t("div",De,[u(D,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(R)},null,8,["icon","loading"])])],32),t("div",null,[u(Q,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY GENERAL COUNTS REPORT ${e(_)}`,e(N).details.name,e(N).details.address,e(N).details.phone,"",""],data:e(q),worksheet:"report-work-sheet",name:`culture_sensitivity_general_counts_report_${e(c)(e(_)).format("M_YYYY")}.xls`},{default:K(()=>[u(P,{text:"Export Excel",icon:"excel.png"})]),_:1},8,["header","data","name"])])]),t("div",Ae,[t("div",Ue,[Ye,u(W)]),t("div",null,[t("h3",je,[I(" Data for period: "),t("span",Fe,y(e(_)==""?" - ":e(c)(e(_)).format("M/yyyy")),1)])]),!("isObjectNull"in s?s.isObjectNull:e(be))(e(x))&&!e(R)?(d(),m("table",Pe,[t("thead",qe,[t("tr",Ve,[(d(!0),m(V,null,B(e(G),(b,X)=>(d(),m("th",{class:"px-2 py-2 border-r text-left uppercase",key:X},y(b.name),1))),128))])]),t("tbody",null,[t("tr",Be,[t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[2]||(a[2]=b=>O("Growth",e(x).Growth.total,e(x).Growth.associated_ids))},y(e(x).Growth.total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[3]||(a[3]=b=>O("No growth",e(x)["No growth"].total,e(x)["No growth"].associated_ids))},y(e(x)["No growth"].total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[4]||(a[4]=b=>{O("Mixed growth; no predominant organism",e(x)["Mixed growth; no predominant organism"].total,e(x)["Mixed growth; no predominant organism"].associated_ids)})},y(e(x)["Mixed growth; no predominant organism"].total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[5]||(a[5]=b=>{O("Growth of normal flora; no pathogens isolated",e(x)["Growth of normal flora; no pathogens isolated"].total,e(x)["Growth of normal flora; no pathogens isolated"].associated_ids)})},y(e(x)["Growth of normal flora; no pathogens isolated"].total),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[6]||(a[6]=b=>O("Growth of contaminants",e(x)["Growth of contaminants"].total,e(x)["Growth of contaminants"].associated_ids))},y((w=e(x)["Growth of contaminants"])==null?void 0:w.total),1)])])],512)):L("",!0),u(v,{condition:e(R),cancelReportGeneration:()=>e(h)()},null,8,["condition","cancelReportGeneration"]),("isObjectNull"in s?s.isObjectNull:e(be))(e(x))&&!e(R)?(d(),m("div",Le,Ke)):L("",!0)])])}}}),He={class:"w-full flex items-center justify-between mb-10"},Je={class:"flex items-center space-x-5"},Xe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ze={class:"w-56 ml-2"},et={class:"w-48"},tt={class:"rounded border"},ot={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},rt=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:pe,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY WARDS COUNTS REPORT ")],-1),nt={class:"px-4 mt-2 font-medium"},st={class:"font-normal"},at={key:0,id:"print-container"},lt={class:"w-full mt-3",ref:"table"},it={class:"w-full border-b border-t bg-gray-50 rounded-t"},ct={class:"w-full"},ut={class:"px-2 py-2 border-r"},dt={class:"px-2 py-2 border-r"},pt={class:"px-2 py-2 border-r"},mt=["onClick"],_t={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},yt=t("img",{src:ce,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),ft=t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"General Counts"),I(" report. ")],-1),ht=[yt,ft],vt=z({__name:"wards-counts",async setup(f){let i,T;const E=S([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Total Count"}]),N=Z("token"),l=S([]);he();const C=me(),$=J();ve();const{loading:p,executeCancellableRequest:_,cancelRequest:Y}=ue(),M=g(async()=>{const o=$.routes.find(n=>n.index==1);return(o==null?void 0:o.period)||""}),R=g(async()=>{const o=await M.value;return o&&typeof o=="string"&&o.trim()!==""?c(o.split("/").join("-01-")).format(ee):""}),r=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),h=()=>{r.value=""},x=g(()=>r.value.length!==0?c(r.value).format("yyyy"):""),G=g(()=>r.value.length!==0?c(r.value).format("M"):""),q=g(()=>E.value.flatMap(()=>l.value.map(o=>({WARD:o.ward,ENCOUNTER:o.encounter,"DATE PERIOD":c(r.value).format("MMMM-yyyy"),COUNT:o.count})))),O=(o,n,s)=>{fe({test:o,type:"General Counts",count:n,associated_ids:s,date_filter:c(r.value).format("YYYY-MM-DD")},F())};async function j(){p.value=!0;const o=await U.value,n={route:`${ne.aggregateReports}culture/wards_based_counts?year=${x.value}&month=${G.value}&report_id=${o||""}`,method:"GET",token:`${N.value}`},{data:s,error:a,pending:k}=await _(n);p.value=k,s.value&&(l.value=s.value.data,p.value=!1,$.setCurrentRoute(1,s.value.report_id,r.value),F().$toast.success("Report data generated successfully")),a.value&&(console.error(a.value),p.value=!1,F().$toast.error(se))}const U=g(async()=>{const o=$.routes.find(n=>n.index==1);return(o==null?void 0:o.reportId)||""});return oe(r,()=>{r&&$.setCurrentRoute(1,"")},{deep:!0}),H(async()=>{await U.value||await R.value!==""?j():p.value=!1}),(o,n)=>{const s=A("datepicker"),a=ae,k=A("FormKit"),D=le,P=A("excel"),Q=ie,W=de;return d(),m("div",null,[t("div",He,[u(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(()=>[t("div",Je,[t("div",Xe,[u(e(_e),{class:"w-5 h-5 mr-2"}),I(" Filter By Date Range "),t("div",Ze,[u(s,{onCleared:h,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(r),"onUpdate:modelValue":n[0]||(n[0]=v=>re(r)?r.value=v:null),format:"M/yyyy"},null,8,["modelValue"])])]),t("div",et,[u(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(p)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[u(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY WARDS COUNTS REPORT ${e(c)(e(r)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(q),worksheet:"report-work-sheet",name:`culture_sensitivity_wards_counts_report_${e(c)(e(r)).format("M_yyyy")}.xls`},{default:K(()=>[u(D,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",tt,[t("div",ot,[rt,u(Q)]),t("div",null,[t("h3",nt,[I(" Data for period: "),t("span",st,y(e(r)==""?" - ":e(c)(e(r)).format("M/yyyy")),1)])]),e(l).length>0&&!e(p)?(d(),m("div",at,[t("table",lt,[t("thead",it,[t("tr",ct,[(d(!0),m(V,null,B(e(E),(v,w)=>(d(),m("th",{class:"px-2 py-2 border-r text-left uppercase",key:w},y(v.name),1))),128))])]),t("tbody",null,[(d(!0),m(V,null,B(e(l),(v,w)=>(d(),m("tr",{key:w,class:"border-b border-l border-r"},[t("td",ut,y(v.ward),1),t("td",dt,y(v.encounter),1),t("td",pt,y(e(r)==""?"":e(c)(e(r)).format("M/yyyy")),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:b=>O(`Ward Based Counts - ${v.ward}, ${v.encounter}`,v.count,v.associated_ids)},y(v.count),9,mt)]))),128))])],512)])):L("",!0),u(W,{condition:e(p),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(l).length==0&&!e(p)?(d(),m("div",_t,ht)):L("",!0)])])}}}),bt={class:"w-full flex items-center justify-between mb-10"},xt={class:"flex items-center space-x-5"},gt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},$t={class:"w-56 ml-2"},Rt={class:"w-48"},wt={class:"rounded border",id:"print-container"},Ct={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},kt=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:pe,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ")],-1),Tt={class:"px-4 mt-2"},Nt={class:"font-semibold"},Et={key:0},St={class:"w-full mt-3",ref:"table"},It={class:"w-full border-b border-t bg-gray-50 rounded-t"},Mt={class:"w-full"},Ot={class:"px-2 py-2 text-left border-r"},Gt={class:"px-2 py-2 text-left border-r"},Dt=["onClick"],At={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Ut=t("img",{src:ce,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Yt=t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"Organisms Count"),I(" report. ")],-1),jt=[Ut,Yt],Ft=z({__name:"organisms-counts",async setup(f){let i,T;const E=S([{name:"Organism Name"},{name:"Period"},{name:"Total Count"}]),N=Z("token"),l=S([]),C=me(),$=J(),{loading:p,executeCancellableRequest:_,cancelRequest:Y}=ue(),M=g(async()=>{const o=$.routes.find(n=>n.index==2);return(o==null?void 0:o.period)||""}),R=g(async()=>{const o=await M.value;return o&&typeof o=="string"&&o.trim()!==""?c(o.split("/").join("-01-")).format(ee):""}),r=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),h=g(()=>l.value&&l.value.length>0?l.value.map(o=>({ORGANISM:o.organism,"DATE PERIOD":c(r.value).format("MMMM/yyyy"),COUNT:o.count})):[]),x=(o,n,s)=>{fe({test:o,type:"General Counts",count:n,associated_ids:s,date_filter:c(r.value).format("YYYY-MM-DD")},F())},G=()=>{r.value=""},q=g(()=>r.value.length!==0?c(r.value).format("yyyy"):""),O=g(()=>r.value.length!==0?c(r.value).format("M"):"");async function j(){p.value=!0;let o=await U.value;const n={route:`${ne.aggregateReports}culture/organisms_based_counts?year=${q.value}&month=${O.value}&report_id=${o||""}`,method:"GET",token:`${N.value}`},{data:s,error:a,pending:k}=await _(n);p.value=k,s.value&&(l.value=s.value.data,p.value=!1,$.setCurrentRoute(2,s.value.report_id,r.value),F().$toast.success("Report data generated successfully")),a.value&&(console.error(a.value),p.value=!1,F().$toast.error(se))}const U=g(async()=>{const o=$.routes.find(n=>n.index==2);return(o==null?void 0:o.reportId)||""});return oe(r,()=>{r&&$.setCurrentRoute(2,"")},{deep:!0}),H(async()=>{await U.value||await R.value!==""?j():p.value=!1}),(o,n)=>{const s=A("datepicker"),a=ae,k=A("FormKit"),D=le,P=A("excel"),Q=ie,W=de;return d(),m("div",null,[t("div",bt,[u(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(()=>[t("div",xt,[t("div",gt,[u(e(_e),{class:"w-5 h-5 mr-2"}),I(" Filter By Date Range "),t("div",$t,[u(s,{onCleared:G,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(r),"onUpdate:modelValue":n[0]||(n[0]=v=>re(r)?r.value=v:null),format:"M/yyyy"},null,8,["modelValue"])])]),t("div",Rt,[u(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(p)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[u(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ${e(c)(e(r)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(h),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_counts_report_${e(c)(e(r)).format("M_yyyy")}.xls`},{default:K(()=>[u(D,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",wt,[t("div",Ct,[kt,u(Q)]),t("div",null,[t("h3",Tt,[I(" Data for period: "),t("span",Nt,y(e(r)==""?" - ":e(c)(e(r)).format("M/yyyy")),1)])]),e(l)!==void 0&&e(l).length>0&&!e(p)?(d(),m("div",Et,[t("table",St,[t("thead",It,[t("tr",Mt,[(d(!0),m(V,null,B(e(E),(v,w)=>(d(),m("th",{class:"px-2 py-2 border-r text-left uppercase",key:w},y(v.name),1))),128))])]),t("tbody",null,[(d(!0),m(V,null,B(e(l),(v,w)=>(d(),m("tr",{key:w,class:"border-b"},[t("td",Ot,y(v.organism),1),t("td",Gt,y(e(r)==""?" - ":e(c)(e(r)).format("M/yyyy")),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:b=>x(`Organisms Based Counts (${v.organism})`,v.count,v.associated_ids)},y(v.count),9,Dt)]))),128))])],512)])):L("",!0),u(W,{condition:e(p),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(l)!==void 0&&e(l).length==0&&!e(p)?(d(),m("div",At,jt)):L("",!0)])])}}}),Pt={class:"w-full flex items-center justify-between mb-10"},qt={class:"flex items-center space-x-5"},Vt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Bt={class:"w-56 ml-2"},Lt={class:"w-48"},Qt={class:"rounded border",id:"print-container"},Wt={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Kt=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:pe,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ")],-1),zt={class:"px-4 mt-2 font-medium"},Ht={class:"font-normal"},Jt={key:0},Xt={class:"w-full mt-3",ref:"table"},Zt={class:"w-full border-b border-t bg-gray-100 rounded-t"},eo={class:"w-full"},to={class:"px-2 py-2 text-center border-r"},oo={class:"px-2 py-2 text-center border-r"},ro={class:"px-2 py-2 text-center border-r"},no={class:"px-2 py-2 text-center border-r"},so=["onClick"],ao={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},lo=t("img",{src:ce,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),io=t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"Organisms in Wards Count"),I(" report. ")],-1),co=[lo,io],uo=z({__name:"organisms-wards-counts",async setup(f){let i,T;const E=S([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Organism Name"},{name:"Total Count"}]);he();const N=Z("token"),l=S([]),C=me(),$=J(),{$toast:p}=F(),{loading:_,executeCancellableRequest:Y,cancelRequest:M}=ue(),R=g(async()=>{const n=$.routes.find(s=>s.index==3);return(n==null?void 0:n.period)||""}),r=g(async()=>{const n=await R.value;return n&&typeof n=="string"&&n.trim()!==""?c(n.split("/").join("-01-")).format(ee):""}),h=S(String(([i,T]=te(()=>R.value),i=await i,T(),i))),x=g(()=>l.value.map(n=>({WARD:n.ward,ENCOUNTER:n.encounter,"DATE PERIOD":c(h.value).format(Ce),ORGANISMS:n.organism,COUNT:n.count}))),G=(n,s,a)=>{fe({test:n,type:"General Counts",count:s,associated_ids:a,date_filter:c(h.value).format("YYYY-MM-DD")},F())},q=()=>{h.value=""},O=g(()=>h.value.length!==0?c(h.value).format("yyyy"):""),j=g(()=>h.value.length!==0?c(h.value).format("M"):"");async function U(){_.value=!0;let n=await o.value;const s={route:`${ne.aggregateReports}culture/organisms_wards_counts?year=${O.value}&month=${j.value}&report_id=${n||""}`,method:"GET",token:`${N.value}`},{data:a,error:k,pending:D}=await Y(s);_.value=D,a.value&&(l.value=a.value.data,_.value=!1,$.setCurrentRoute(3,a.value.report_id,h.value),p.success("Report data generated successfully")),k.value&&(console.error(k.value),_.value=!1,p.error(se))}oe(h,()=>{h&&$.setCurrentRoute(3,"")},{deep:!0});const o=g(async()=>{const n=$.routes.find(s=>s.index==3);return(n==null?void 0:n.reportId)||""});return H(async()=>{await o.value||await r.value!==""?U():_.value=!1}),(n,s)=>{const a=A("datepicker"),k=ae,D=A("FormKit"),P=le,Q=A("excel"),W=ie,v=de;return d(),m("div",null,[t("div",Pt,[u(D,{type:"form","submit-label":"Update",onSubmit:U,actions:!1},{default:K(({value:w})=>[t("div",qt,[t("div",Vt,[u(e(_e),{class:"w-5 h-5 mr-2"}),I(" Filter By Date Range "),t("div",Bt,[u(a,{onCleared:q,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(h),"onUpdate:modelValue":s[0]||(s[0]=b=>re(h)?h.value=b:null),format:"M/yyyy"},null,8,["modelValue"])])]),t("div",Lt,[u(k,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(_)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[u(Q,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ${e(c)(e(h)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(x),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_in_wards_counts_report_${e(c)(e(h)).format("M_yyyy")}.xls`},{default:K(()=>[u(P,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",Qt,[t("div",Wt,[Kt,u(W)]),t("div",null,[t("h3",zt,[I(" Data for period: "),t("span",Ht,y(e(h)==""?"":e(c)(e(h)).format("M/yyyy")),1)])]),e(l).length>0&&!e(_)?(d(),m("div",Jt,[t("table",Xt,[t("thead",Zt,[t("tr",eo,[(d(!0),m(V,null,B(e(E),(w,b)=>(d(),m("th",{class:"px-2 py-2 border-r text-left uppercase",key:b},y(w.name),1))),128))])]),t("tbody",null,[(d(!0),m(V,null,B(e(l),(w,b)=>(d(),m("tr",{key:b,class:"border-b"},[t("td",to,y(w.ward),1),t("td",oo,y(w.encounter),1),t("td",ro,y(e(h)==""?"":e(c)(e(h)).format("M/yyyy")),1),t("td",no,y(w.organism),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>G(`Organisms in Wards Counts (${w.organism}) - ${w.ward}, ${w.encounter}`,w.count,w.associated_ids)},y(w.count),9,so)]))),128))])],512)])):L("",!0),u(v,{condition:e(_),cancelReportGeneration:()=>e(M)()},null,8,["condition","cancelReportGeneration"]),e(l).length==0&&!e(_)?(d(),m("div",ao,co)):L("",!0)])])}}}),po={class:"w-full flex items-center justify-between mb-10"},mo={class:"flex items-center space-x-5"},_o={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},yo={class:"w-56 ml-2"},fo={class:"w-48"},ho={class:"rounded border",id:"print-container"},vo={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},bo=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:pe,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ")],-1),xo={class:"px-4 mt-2 font-medium"},go={class:"font-normal"},$o={key:0},Ro={class:"w-full border-b border-t bg-gray-50 rounded-t"},wo={colspan:4,class:"text-left px-2 py-2"},Co=t("tr",{class:"border-r border-t"},[t("th",{class:"border-r px-2 py-2 text-left"},"Drug Name"),t("th",{class:"border-r px-2 py-2 text-center"},"I"),t("th",{class:"border-r px-2 py-2 text-center"},"R"),t("th",{class:"px-2 py-2 text-center"},"S")],-1),ko={class:"border-r px-2 py-2 text-left"},To=["onClick"],No=["onClick"],Eo=["onClick"],So={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Io=t("img",{src:ce,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Mo=t("p",null,"Data not found, please generate report",-1),Oo=[Io,Mo],Go=z({__name:"ast",async setup(f){let i,T;const E=Z("token"),N=S([]),l=me(),C=J(),{$toast:$}=F(),{loading:p,executeCancellableRequest:_,cancelRequest:Y}=ue(),M=g(async()=>{const o=C.routes.find(n=>n.index==4);return(o==null?void 0:o.period)||""}),R=g(async()=>{const o=await M.value;return o&&typeof o=="string"&&o.trim()!==""?c(o.split("/").join("-01-")).format(ee):""}),r=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),h=g(()=>N.value.flatMap(o=>o.drugs.map(n=>({"DRUG NAME":n.drug_name,"INTERPRETATION I":n.interpretations.I.count,"INTERPRETATION R":n.interpretations.R.count,"INTERPRETATION S":n.interpretations.S.count})))),x=()=>{r.value=""},G=g(()=>r.value.length!==0?c(r.value).format("yyyy"):""),q=g(()=>r.value.length!==0?c(r.value).format("M"):""),O=(o,n,s)=>{fe({test:o,type:"General Counts",count:n,associated_ids:s,date_filter:c(r.value).format("YYYY-MM-DD")},F())};async function j(){p.value=!0;const o=await U.value,n={route:`${ne.aggregateReports}culture/ast?year=${G.value}&month=${q.value}&report_id=${o}`,method:"GET",token:`${E.value}`},{data:s,error:a,pending:k}=await _(n);p.value=k,s.value&&(N.value=s.value.data,p.value=!1,C.setCurrentRoute(4,s.value.report_id,r.value),$.success("Report data generated successfully")),a.value&&(console.error(a.value),p.value=!1,$.error(se))}oe(r,()=>{r&&C.setCurrentRoute(4,"")},{deep:!0});const U=g(async()=>{const o=C.routes.find(n=>n.index==4);return(o==null?void 0:o.reportId)||""});return H(async()=>{await U.value||await R.value!==""?j():p.value=!1}),(o,n)=>{const s=A("datepicker"),a=ae,k=A("FormKit"),D=le,P=A("excel"),Q=ie,W=de;return d(),m("div",null,[t("div",po,[u(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(({value:v})=>[t("div",mo,[t("div",_o,[u(e(_e),{class:"w-5 h-5 mr-2"}),I(" Filter By Date Range "),t("div",yo,[u(s,{onCleared:x,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(r),"onUpdate:modelValue":n[0]||(n[0]=w=>re(r)?r.value=w:null),format:"M/yyyy"},null,8,["modelValue"])])]),t("div",fo,[u(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(p)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[u(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ${e(c)(e(r)).format("M/yyyy")}`,e(l).details.name,e(l).details.address,e(l).details.phone],data:e(h),worksheet:"report-work-sheet",name:`culture_sensitivity_antibiotic_susceptibility_report_${e(c)(e(r)).format("M_yyyy")}.xls`},{default:K(()=>[u(D,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",ho,[t("div",vo,[bo,u(Q)]),t("div",null,[t("h3",xo,[I(" Data for period: "),t("span",go,y(e(r)==""?"":e(c)(e(r)).format("M/yyyy")),1)])]),e(N).length>0&&!e(p)?(d(),m("div",$o,[(d(!0),m(V,null,B(e(N),(v,w)=>(d(),m("table",{key:w,class:"w-full mt-3",ref_for:!0,ref:"table"},[t("thead",Ro,[t("tr",null,[t("th",wo,y(v.name),1)]),Co]),t("tbody",null,[(d(!0),m(V,null,B(v.drugs,b=>(d(),m("tr",{key:b,class:"border-b"},[t("td",ko,y(b.drug_name),1),t("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>O(`Antimicrobial Subsceptibility Testing (${v.name}) - ${b.drug_name}`,b.interpretations.I.count,b.interpretations.I.associated_ids)},y(b.interpretations.I.count),9,To),t("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>O(`Antimicrobial Subsceptibility Testing (${v.name}) - ${b.drug_name}`,b.interpretations.R.count,b.interpretations.R.associated_ids)},y(b.interpretations.R.count),9,No),t("td",{class:"px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>O(`Antimicrobial Subsceptibility Testing (${v.name}) - ${b.drug_name}`,b.interpretations.S.count,b.interpretations.S.associated_ids)},y(b.interpretations.S.count),9,Eo)]))),128))])],512))),128))])):L("",!0),u(W,{condition:e(p),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(N).length==0&&!e(p)?(d(),m("div",So,Oo)):L("",!0)])])}}}),Do={class:"px-5 py-5"},Ao={class:"flex items-center py-5"},Uo=t("img",{src:Se,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Yo={class:"text-2xl font-semibold uppercase"},jo={class:"font-medium bg-gray-100"},Fo=["onClick"],Po={class:"mt-4"},or=z({__name:"culture-sensitivity",setup(f){ge({title:`${Ie.name.toUpperCase()} - Culture & Sensitivity Report`});const i=J(),T=ke(),E=he(),N=S("Culture & Sensitivity Report"),l=S(new Array("General Counts","Ward Based Counts","Organisms Based Count","Organisms in Wards Count","Antibiotic Susceptibility Test (AST)")),C=[ze,vt,Ft,uo,Go],$=S(Number(E.query["current-tab"])||0),p=ve(),_=S(new Array({name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"})),Y=R=>{var h;const r=((h=i.routes.find(x=>x.index===R))==null?void 0:h.reportId)||"";(r!==""||r!==void 0)&&p.replaceOneQuery("current-tab",{"current-tab":R})};H(()=>{const R=Number(T.currentRoute.value.query["current-tab"])||0;$.value=R,Y(R)});const M=R=>{$.value=R,Y(R)};return(R,r)=>{const h=xe;return d(),m("div",Do,[u(h,{pages:e(_)},null,8,["pages"]),t("div",Ao,[Uo,t("h3",Yo,y(e(N)),1)]),t("div",null,[t("div",jo,[(d(!0),m(V,null,B(e(l),(x,G)=>(d(),m("button",{key:G,onClick:q=>M(G),class:Te(e($)==G?"inline-block px-2 py-2 text-white bg-sky-500":"inline-block px-2 py-2 border-r hover:text-sky-500 transition duration-150")},y(x),11,Fo))),128))]),t("div",Po,[(d(),Ne(Ee(C[e($)])))])])])}}});export{or as default};
