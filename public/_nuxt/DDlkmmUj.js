import{_ as se}from"./Dzn3CqtN.js";import{_ as ae}from"./BuXepRWo.js";import{d as ne,r as M,a as le,a2 as de,ag as ue,u as ce,aq as Y,c as $,C as _,w as j,o as ie,y as P,b as p,e as m,f as v,h as t,g as a,t as x,j as L,H as V,z as pe,O as C,F as k,k as q,K as B,l as me,E as fe,_ as _e}from"./BO3L0kwf.js";import{_ as ve}from"./DzNW1Vf5.js";import{_ as ye}from"./DPkVQ8oh.js";import{_ as be,a as Re}from"./CBrpuzdQ.js";import{u as he,_ as ge}from"./eIeQwZmM.js";import{_ as xe}from"./Pf2MiR_y.js";import{_ as Ee}from"./CK7-8qTE.js";import{u as De}from"./SDvnuXqY.js";import{P as Te}from"./DSb1hqrV.js";import{u as we}from"./BYRXL7y9.js";import{r as Ae}from"./Dmty_WBN.js";import{r as Me}from"./BJdcKMi-.js";import"./DnNgkCJc.js";import"./QUNJvIBY.js";import"./CuGXnkCA.js";import"./owp3TffR.js";import"./B6asxmgh.js";import"./Bwoq8sKN.js";import"./ZhQoleTq.js";import"./CphnV1xF.js";import"./BbIt3Hzw.js";const $e={class:"px-5 py-5"},ke={class:"w-full flex items-center justify-between"},Ce={class:"flex items-center space-x-3"},qe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Oe={class:"w-72 ml-2"},Fe={class:"w-44"},Se={class:"flex items-center space-x-3"},Ye={class:"border rounded mt-5"},je={class:"flex items-center justify-between px-5 py-5 border-b"},Pe={class:"mt-3 px-5"},Le={class:"text-lg font-semibold mb-2"},Ve={class:"text-normal font-normal"},Be={key:0,class:"print-container",id:"print-container"},Ne={class:"w-full border border-dotted rounded overflow-x-auto"},Ue={class:"bg-gray-50 border-b border-dotted rounded-t"},Ge={class:"border-r border-b border-dotted px-2 py-2"},He=["onClick"],Qe={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},ze={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Ie="Rejected Samples Report",ht=ne({__name:"rejected-samples",setup(Je){we({title:`${Te.name.toUpperCase()} - Rejected Samples Report`});const N=M([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),w=M([]),U=le("token"),O=De(),g=de(),c=ue(),{loading:y,executeCancellableRequest:G,cancelRequest:H}=he(),d=M(["",""]),{$toast:A,$metadata:Q}=ce(),i=M(c.query.department?{name:String(c.query.department)}:{name:Y}),z=()=>{d.value=new Array("","")},b=M({results:[],value:void 0,wards:[]}),F=$(()=>b.value.results.map(o=>{const e={};o.test_types.forEach(r=>{const{name:s,ward:l,count:R,associated_ids:f}=r;e[s]||(e[s]={}),e[s][l]||(e[s][l]={count:0,associated_ids:""}),e[s][l].count+=R,e[s][l].associated_ids=f});const n=Object.keys(e).map(r=>({name:r,wards:e[r]}));return{name:o.name,testTypes:n}})),I=$(()=>{const o=[];return b.value.results.forEach(e=>{const n={},r={};e.test_types.forEach(s=>{const{name:l,ward:R,count:f}=s;n[l]||(n[l]={},r[l]=0),n[l][R]=f||0,r[l]+=f});for(const s in n){const l=n[s],R={TESTS:s};b.value.wards.forEach(f=>{R[f]=l[f]!==void 0?l[f]:0}),R.TOTAL=r[s],o.push(R)}}),o}),J=(o,e)=>{const n=F.value.find(s=>s.name===o),r=n==null?void 0:n.testTypes.find(s=>s.name===e);return r?Object.values(r.wards).reduce((s,l)=>s+l.count,0):0},E=$(()=>d.value[0]?_(d.value[0]).format("YYYY-MM-DD"):""),D=$(()=>d.value[1]?_(d.value[1]).format("YYYY-MM-DD"):"");async function S(){if(K())A.warning("Please select a department");else{y.value=!0;const o={route:`${me.aggregateReports}rejected?from=${E.value}&to=${D.value}&department=${i.value.id==0?"":i.value.id}&report_id=${c.query.report_id}`,method:"GET",token:`${U.value}`},{data:e,error:n,pending:r}=await G(o);y.value=r,e.value&&(y.value=!1,b.value=e.value,W(e.value.report_id),e.value.results.length>0?A.success("Report generated successfully!"):A.warning("Data not found within the specified period")),n.value&&(console.error(n.value),y.value=!1,A.error(fe))}}const K=()=>i.value.name==Y,W=o=>{const n={...g.currentRoute.value.query,report_id:o};g.replace({query:n}).catch(r=>{console.error("Failed to replace route:",r)})},X=(o,e,n,r)=>{n!==0&&r!==""?g.push(`/reports/${r}?origin=aggregate&type=rejected-samples-report&from=${E.value}&to=${D.value}&test=${o} - ${e}&department=${i.value.name}&count=${n}`):A.warning("No data found for this month")};j(d,()=>{const o=d.value[0]?_(d.value[0]).format("YYYY-MM-DD"):"",e=d.value[1]?_(d.value[1]).format("YYYY-MM-DD"):"";if(o||e){const r={...g.currentRoute.value.query,...o&&{from:o},...e&&{to:e}};g.replace({query:r}).catch(s=>{console.error("Failed to replace route:",s)})}},{deep:!0}),j(i,(o,e)=>{if(o!==e){const r={...g.currentRoute.value.query,department:o.name||"",report_id:""};g.replace({query:r}).catch(s=>{console.error("Failed to replace route:",s)})}});const Z=$(()=>c.query.to!==void 0&&c.query.from!==void 0&&c.query.department!==void 0?(d.value=[c.query.from,c.query.to],i.value.name=`${c.query.department}`,c.query.to!==""&&c.query.from!==""&&c.query.department!==""):!1);return ie(()=>{Z.value?S():y.value=!1,w.value=Q.departments,w.value.some(e=>e.name=="All")||w.value.push({id:0,name:"All"}),w.value.sort((e,n)=>{const r=e.name.toUpperCase(),s=n.name.toUpperCase();return r<s?-1:r>s?1:0})}),(o,e)=>{const n=se,r=P("datepicker"),s=ae,l=_e,R=ve,f=ye,ee=P("excel"),te=Re,oe=ge;return p(),m("div",$e,[v(n,{pages:t(N)},null,8,["pages"]),a("div",{class:"flex items-center py-5"},[e[2]||(e[2]=a("img",{src:xe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),a("h3",{class:"text-2xl font-semibold uppercase"},x(Ie))]),a("div",ke,[a("div",Ce,[a("div",qe,[v(t(Ae),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=L(" Filter By Date Range ")),a("div",Oe,[v(r,{onCleared:z,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(d),"onUpdate:modelValue":e[0]||(e[0]=T=>V(d)?d.value=T:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),a("div",Fe,[v(s,{items:t(w),modelValue:t(i),"onUpdate:modelValue":e[1]||(e[1]=T=>V(i)?i.value=T:null)},null,8,["items","modelValue"])]),v(l,{color:"primary",text:"Generate Report",icon:t(Me),click:()=>S(),loading:t(y)},null,8,["icon","click","loading"])]),a("div",Se,[v(R,{printSmallLabel:!1}),v(ee,{class:"btn btn-default",header:[`REJECTED ${t(i).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${t(_)(t(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:t(C))} TO ${t(_)(t(D)).format("DATE_FORMAT"in o?o.DATE_FORMAT:t(C))}`,t(O).details.name,t(O).details.address,t(O).details.phone],data:t(I),worksheet:"report-work-sheet",name:`rejected_${t(i).name.toLowerCase().split(" ").join("_")}_report_${t(_)(t(E)).format("DD_MM_yyyy")}_to_${t(_)(t(D)).format("DD_MM_yyyy")}.xls`},{default:pe(()=>[v(f,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),a("div",Ye,[a("div",je,[e[4]||(e[4]=a("div",{class:"flex flex-col space-y-2"},[a("img",{src:Ee,alt:"app-logo",class:"w-24 h-24 object-cover"}),a("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1)),v(te)]),a("div",Pe,[a("h3",Le,[e[5]||(e[5]=L(" Tests Performed Period: ")),a("span",Ve,x(t(E)!=""?t(_)(t(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:t(C)):"")+" - "+x(t(D)!=""?t(_)(t(D)).format("DATE_FORMAT"in o?o.DATE_FORMAT:t(C)):""),1)])]),t(b).results.length>0&&!t(y)?(p(),m("div",Be,[a("table",Ne,[(p(!0),m(k,null,q(t(F),(T,re)=>(p(),m(k,{key:re},[a("thead",Ue,[a("tr",null,[e[6]||(e[6]=a("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1)),(p(!0),m(k,null,q(t(b).wards,u=>(p(),m("th",{key:u,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(u),1))),128)),e[7]||(e[7]=a("th",{class:"border-r border-t border-b border-dotted px-2 py-2"},"TOTAL",-1))])]),a("tbody",null,[(p(!0),m(k,null,q(T.testTypes,u=>(p(),m("tr",{key:u.name},[a("td",Ge,x(u.name),1),(p(!0),m(k,null,q(t(b).wards,h=>(p(),m("td",{key:h,onClick:Ke=>X(u.name,h,u.wards[h]?u.wards[h].count:0,u.wards[h]?u.wards[h].associated_ids:""),class:"px-4 border-r border-b border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(u.wards[h]?u.wards[h].count:0),9,He))),128)),a("td",Qe,x(J(T.name,u.name)),1)]))),128))])],64))),128))])])):B("",!0),v(oe,{condition:t(y),cancelReportGeneration:()=>t(H)()},null,8,["condition","cancelReportGeneration"]),t(b).wards.length==0&&t(b).results.length==0&&!t(y)?(p(),m("div",ze,e[8]||(e[8]=[a("img",{src:be,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),a("p",{class:"text-base"},"Please generate report data to preview the report",-1)]))):B("",!0)])])}}});export{ht as default};
