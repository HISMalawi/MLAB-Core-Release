import{_ as de}from"./DeHqjJH7.js";import{_ as me}from"./BOt9Lm4e.js";import{d as fe,a as _e,r as w,$ as ye,I as ve,u as A,c as U,z as f,w as I,o as ge,x as j,b as u,e as i,f as d,g as r,t as R,y as N,h as o,j as G,A as z,L as K,F as M,k as E,K as he,D as Q,l as xe,E as Re,_ as be}from"./BLMYYBub.js";import{_ as De}from"./Bxl2pUFk.js";import{_ as $e}from"./BC1wyGKt.js";import{_ as we,a as Te}from"./DrZlfu5Z.js";import{u as ke,_ as Me}from"./CXkY3hoU.js";import{_ as Ce}from"./CaWMponf.js";import{_ as Ae}from"./Gj1XiySU.js";import{u as Ee}from"./B4BIo1yJ.js";import{P as qe}from"./CM4UxiDe.js";import{u as Oe}from"./CfmpkH2n.js";import{r as Ye}from"./BZ-nU4m4.js";import{r as Fe}from"./Cbp5S_6y.js";import"./sNlKP72R.js";import"./DliR-cc7.js";import"./BlFheT0q.js";import"./IJCDyQty.js";import"./cHOIL3XF.js";import"./CkgugtXF.js";import"./BpACQbkq.js";import"./OnYuLN16.js";import"./DDt9YMgi.js";import"./Rq-tLeC0.js";import"./9NBlOp5g.js";const Se={class:"px-5 py-5"},Ue={class:"w-full flex items-center justify-between mb-3"},je={class:"flex items-center space-x-3"},Be={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Pe={class:"w-72 ml-2"},Ve={class:"w-44"},Le={class:"flex items-center space-x-3"},Ie={class:"border rounded print-container",id:"print-container"},Ne={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ge={class:"mt-3 px-5"},ze={class:"font-medium mb-2"},Ke={class:"font-normal"},Qe={class:"overflow-x-auto bg-white border-t"},He={key:0,class:"w-full overflow-x-auto"},Je={class:"uppercase bg-gray-100"},We={class:"text-left"},Xe={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},Ze={class:"px-4 py-2 font-bold"},et={class:"px-4 py-2"},tt=["onClick"],ot={class:"px-4 py-2"},rt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},st="Lab Statistics Report",qt=fe({__name:"lab-statistics",setup(at){Oe({title:`${qe.name.toUpperCase()} - Lab Statistics Report`});const F=Ee(),H=_e("token"),J=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],C=w([]),v=w({name:"select department"}),l=w(["",""]),B=w([]),T=w([]),q=w([]),P=w([]),b=ye(),m=ve(),{$toast:W,$metadata:X}=A(),{loading:_,executeCancellableRequest:Z,cancelRequest:ee}=ke(),te=()=>{l.value=new Array("","")};function oe(t){return t==="select department"||t==="-- select test type --"||t==="-- select test status --"?"":t}function re(t,e){const s=new Date(t),a=new Date(e),n=new Array;let c=s;for(;c<=a;){const g=c.toLocaleString("default",{month:"long"});n.push(g),c.setMonth(c.getMonth()+1)}T.value=n}const se=()=>{const{value:t}=v;return t.name==="select department"?!A().$toast.warning("Please select a department"):!0},D=U(()=>l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):""),$=U(()=>l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"");async function V(){_.value=!0;let t=`from=${D.value}&to=${$.value}&department=${oe(v.value.name)}&report_id=${m.query.report_id}`;const e={route:`${xe.aggregateReports}/lab_statistics?${t}`,method:"GET",token:`${H.value}`},{data:s,error:a,pending:n}=await Z(e);if(_.value=n,s.value){re(s.value.from,s.value.to),B.value=s.value.data,q.value=ne(s.value.data);let c=[];q.value.forEach(g=>{const h={};h["Tests".toUpperCase()]=g.department.toUpperCase(),T.value.forEach(y=>{h[y.toUpperCase()]=""}),h["Total".toUpperCase()]="",c.push(h),g.tests.forEach(y=>{const k={};k["Tests".toUpperCase()]=y.name,T.value.forEach(O=>{k[O.toUpperCase()]=S(y,O)}),k["Total".toUpperCase()]=L(y),c.push(k)})}),P.value=c,_.value=!1,ae(s.value.report_id),s.value.data.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found for period ${D.value} - ${$.value}`)}a.value&&(_.value=!1,console.error("error: ",a.value),A().$toast.error(Re))}const ae=t=>{const s={...b.currentRoute.value.query,report_id:t};b.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})};function ne(t){return t.map(e=>{const s=Object.keys(e)[0],a=Object.entries(e[s]).map(([n,c])=>{const g=Object.entries(c).map(([h,y])=>({[h]:y}));return{name:n,results:g}});return{department:s,tests:a}})}function S(t,e){let s=0;return t.results.forEach(a=>{let n=a[e]!==void 0?a[e].total:0;s+=n}),s}function L(t){let e=0;return t.results.forEach(s=>{Object.values(s).forEach(a=>{e+=a.total})}),e}const le=(t,e,s)=>{const a=t.results.find(n=>n[e]!==void 0);a?b.push(`/reports/${a[e].associated_ids}?origin=aggregate&type=lab-statistics-report&from=${D.value}&to=${$.value}&test=${t.name}&department=${v.value.name}&count=${s}&page=1&rowsPerPage=10`):W.warning("No data found for this month")};function ue(t){return t%2===0}I(l,()=>{const t=l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):"",e=l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"";if(t||e){const a={...b.currentRoute.value.query,...t&&{from:t},...e&&{to:e}};b.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0}),I(v,(t,e)=>{if(t!==e){const a={...b.currentRoute.value.query,department:t.name||void 0,report_id:""};b.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}});const ie=U(()=>m.query.to!==void 0&&m.query.from!==void 0&&m.query.department!==void 0?(l.value=[m.query.from,m.query.to],v.value.name=`${m.query.department}`,m.query.to!==""&&m.query.from!==""&&m.query.department!==""):!1);return ge(()=>{ie.value?V():_.value=!1,C.value=X.departments,C.value.some(e=>e.name=="All")||C.value.push({id:0,name:"All"}),C.value.sort((e,s)=>{const a=e.name.toUpperCase(),n=s.name.toUpperCase();return a<n?-1:a>n?1:0})}),(t,e)=>{const s=de,a=j("datepicker"),n=me,c=be,g=j("FormKit"),h=De,y=$e,k=j("excel"),O=Te,ce=Me;return u(),i("div",Se,[d(s,{pages:J}),r("div",{class:"flex items-center py-5"},[e[3]||(e[3]=r("img",{src:Ce,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),r("h3",{class:"text-2xl font-semibold uppercase"},R(st))]),r("div",Ue,[d(g,{type:"form","submit-label":"Update",onSubmit:e[2]||(e[2]=x=>se()&&V()),actions:!1,id:"submitForm"},{default:N(({value:x})=>[r("div",je,[r("div",Be,[d(o(Ye),{class:"w-5 h-5 mr-2"}),e[4]||(e[4]=G(" Filter By Date Range ")),r("div",Pe,[d(a,{onCleared:te,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:o(l),"onUpdate:modelValue":e[0]||(e[0]=p=>z(l)?l.value=p:null),maxDate:new Date},null,8,["modelValue","maxDate"])])]),r("div",Ve,[d(n,{items:o(C),modelValue:o(v),"onUpdate:modelValue":e[1]||(e[1]=p=>z(v)?v.value=p:null)},null,8,["items","modelValue"])]),d(c,{type:"submit",color:"primary",text:"Generate Report",icon:o(Fe),click:()=>{},loading:o(_)},null,8,["icon","loading"])])]),_:1}),r("div",Le,[d(h),r("div",null,[d(k,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${o(f)(o(D)).format("DD-MM-yyyy")} TO ${o(f)(o($)).format("DD-MM-yyyy")}`,o(F).details.name,o(F).details.address,o(F).details.phone],data:o(P),worksheet:"report-work-sheet",name:`lab-statistics-report_${o(f)(o(D)).format("DD_MM_yyyy")}_to_${o(f)(o($)).format("DD_MM_yyyy")}.xls`},{default:N(()=>[d(y,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),r("div",Ie,[r("div",Ne,[e[5]||(e[5]=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"LABORATORY STATISTICS REPORT")],-1)),d(O)]),r("div",Ge,[r("h3",ze,[e[6]||(e[6]=G(" Tests Performed Period: ")),r("span",Ke,R(o(D)!=""?o(f)(o(D)).format("DATE_FORMAT"in t?t.DATE_FORMAT:o(K)):"")+" - "+R(o($)!=""?o(f)(o($)).format("DATE_FORMAT"in t?t.DATE_FORMAT:o(K)):""),1)])]),r("div",Qe,[o(q).length>0&&!o(_)?(u(),i("table",He,[r("thead",Je,[r("tr",We,[e[7]||(e[7]=r("th",{class:"px-4 py-2"},"Tests",-1)),(u(!0),i(M,null,E(o(T),x=>(u(),i("th",{key:x,class:"px-4 py-2"},R(x),1))),128)),e[8]||(e[8]=r("th",{class:"px-4 py-2"},"Total",-1))])]),r("tbody",null,[(u(!0),i(M,null,E(o(q),x=>(u(),i(M,{key:x.department},[r("tr",Xe,[r("td",Ze,R(x.department),1),(u(!0),i(M,null,E(o(T),p=>(u(),i("td",{key:p,class:"px-4 py-2"}))),128)),e[9]||(e[9]=r("td",{class:"px-4 py-2"},null,-1))]),(u(!0),i(M,null,E(x.tests,(p,pe)=>(u(),i("tr",{key:p.name,class:he({"bg-gray-50":ue(pe),"border-b border-dotted":!0})},[r("td",et,R(p.name),1),(u(!0),i(M,null,E(o(T),Y=>(u(),i("td",{onClick:nt=>le(p,Y,S(p,Y)),key:Y,class:"px-4 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},R(S(p,Y)),9,tt))),128)),r("td",ot,R(L(p)),1)],2))),128))],64))),128))])])):Q("",!0),d(ce,{condition:o(_),cancelReportGeneration:()=>o(ee)()},null,8,["condition","cancelReportGeneration"]),o(B).length==0&&!o(_)?(u(),i("div",rt,e[10]||(e[10]=[r("img",{src:we,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),r("p",null,"Data not found, please generate report",-1)]))):Q("",!0)])])])}}});export{qt as default};
