import{_ as re}from"./Breadcrumb.vue.c95f637a.js";import{_ as ne}from"./Dropdown.5ab9507a.js";import{l as le,u as ce,B as y,K as Y,f as S,o as l,c,b as p,d as e,t as v,g as L,k as t,h as B,D as N,F as k,r as $,n as ie,j as G,w as pe,v as me,a as A,e as de}from"./entry.71c9e4aa.js";import{_ as ue}from"./index.a1eedbe1.js";import{_ as _e}from"./ExportButton.vue.7096d9ca.js";import{_ as fe}from"./Address.vue.d604a3e4.js";import{_ as he}from"./Loader.5b27d560.js";import{u as ye}from"./vue.f36acd1f.04a7f7a9.js";import{d as I,e as ve}from"./constants.b3aab3f3.js";import{_ as xe}from"./report.8a3883b2.js";import{_ as ge}from"./logo.13d2cd28.js";import{_ as be}from"./page.fecfe083.js";import{h as R,f as q,e as K}from"./fetch.ad8fdb43.js";import{u as De}from"./facility.1a380316.js";import{P as we}from"./package.c708cd85.js";import{r as ke}from"./FunnelIcon.a3c15e2b.js";import{r as Re}from"./ArrowPathIcon.1190bac1.js";import"./nuxt-link.f7bb8acd.js";import"./HomeIcon.a65c875c.js";import"./listbox.36379e19.js";import"./hidden.295c025e.js";import"./use-text-value.f88e0f84.js";import"./CheckIcon.9aa54248.js";import"./CheckCircleIcon.1627fe1e.js";import"./MagnifyingGlassIcon.05b953ff.js";import"./html2canvas.esm.acdae98d.js";import"./jspdf.es.min.65e2939b.js";import"./XMarkIcon.aea27e1b.js";import"./PrinterIcon.be7f4d4c.js";import"./transition.fb9320ab.js";import"./PencilSquareIcon.9ee104ee.js";const Ce={class:"px-5 py-5"},Te=e("img",{src:xe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),$e={class:"w-full flex items-center justify-between mb-3"},Me={class:"flex items-center space-x-3"},Ee={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ae={class:"w-72 ml-2"},Oe={class:"w-44"},Se={class:"flex items-center space-x-3"},Be={class:"border rounded print-container",id:"print-container"},Fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ue=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ge,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," LABORATORY STATISTICS REPORT ")],-1),je={class:"mt-3 px-5"},Pe={class:"font-medium mb-2"},Ve={class:"font-normal"},Ye={class:"overflow-x-auto bg-white border-t"},Le={key:0,class:"w-full overflow-x-auto"},Ne={class:"uppercase bg-gray-100"},Ge={class:"text-left"},Ie=e("th",{class:"px-4 py-2"},"Tests",-1),qe=e("th",{class:"px-4 py-2"},"Total",-1),Ke={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},ze={class:"px-4 py-2 font-bold"},He=e("td",{class:"px-4 py-2"},null,-1),Je={class:"px-4 py-2"},Qe={class:"px-4 py-2"},We={class:"w-full items-center flex flex-col space-y-2 my-10"},Xe=e("p",null,[B("Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),Ze={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},et=e("img",{src:be,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),tt=e("p",null,"Data not found, please generate report",-1),ot=[et,tt],st="Lab Statistics Report",Ut=le({__name:"lab-statistics",setup(at){ye({title:`${we.name.toUpperCase()} - Lab Statistics Report`});const O=De(),F=ce("token"),z=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],C=y([]),T=y({name:"select department"}),_=y(["",""]),U=y([]),g=y([]),M=y([]),H=y([]),x=y(!1),J=()=>{_.value=new Array("","")};async function Q(){const{data:o,error:s}=await q({route:K.departments,method:"GET",token:`${F}`});o.value&&(C.value=o.value,C.value.some(r=>r.name=="All")||C.value.push({id:0,name:"All"}),C.value.sort((r,m)=>{const n=r.name.toUpperCase(),i=m.name.toUpperCase();return n<i?-1:n>i?1:0})),s.value&&console.error(s.value)}function W(o){return o==="select department"||o==="-- select test type --"||o==="-- select test status --"?"":o}function X(o,s){const a=new Date(o),r=new Date(s),m=new Array;let n=a;for(;n<=r;){const i=n.toLocaleString("default",{month:"long"});m.push(i),n.setMonth(n.getMonth()+1)}g.value=m}const Z=()=>{const{value:o}=T;return o.name==="select department"?!A().$toast.warning("Please select a department"):!0},b=Y(()=>_.value[0]?R(_.value[0]).format("YYYY-MM-DD"):""),D=Y(()=>_.value[1]?R(_.value[1]).format("YYYY-MM-DD"):"");async function ee(){x.value=!0;let o=`from=${b.value}&to=${D.value}&department=${W(T.value.name)}`;const s={route:`${K.aggregateReports}/lab_statistics?${o}`,method:"GET",token:`${F.value}`},{data:a,error:r,pending:m}=await q(s);if(x.value=m,a.value){X(a.value.from,a.value.to),U.value=a.value.data,M.value=te(a.value.data);let n=[];M.value.forEach(i=>{const f={};f["Tests".toUpperCase()]=i.department.toUpperCase(),g.value.forEach(u=>{f[u.toUpperCase()]=""}),f["Total".toUpperCase()]="",n.push(f),i.tests.forEach(u=>{const w={};w["Tests".toUpperCase()]=u.name,g.value.forEach(E=>{w[E.toUpperCase()]=j(u,E)}),w["Total".toUpperCase()]=P(u),n.push(w)})}),n=n,x.value=!1,a.value.data.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found for period ${b.value} - ${D.value}`)}r.value&&(x.value=!1,console.error("error: ",r.value),A().$toast.error(ve))}function te(o){return o.map(s=>{const a=Object.keys(s)[0],r=Object.entries(s[a]).map(([m,n])=>{const i=Object.entries(n).map(([f,u])=>({[f]:u}));return{name:m,results:i}});return{department:a,tests:r}})}function j(o,s){let a=0;return o.results.forEach(r=>{a+=r[s]||0}),a}function P(o){let s=0;return o.results.forEach(a=>{Object.values(a).forEach(r=>{s+=r})}),s}function oe(o){return o%2===0}return Q(),(o,s)=>{const a=re,r=S("datepicker"),m=ne,n=de,i=S("FormKit"),f=ue,u=_e,w=S("excel"),E=fe,se=he;return l(),c("div",Ce,[p(a,{pages:z}),e("div",{class:"flex items-center py-5"},[Te,e("h3",{class:"text-2xl font-semibold uppercase"},v(st))]),e("div",$e,[p(i,{type:"form","submit-label":"Update",onSubmit:s[2]||(s[2]=h=>Z()&&ee()),actions:!1,id:"submitForm"},{default:L(({value:h})=>[e("div",Me,[e("div",Ee,[p(t(ke),{class:"w-5 h-5 mr-2"}),B(" Filter By Date Range "),e("div",Ae,[p(r,{onCleared:J,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(_),"onUpdate:modelValue":s[0]||(s[0]=d=>N(_)?_.value=d:null)},null,8,["modelValue"])])]),e("div",Oe,[p(m,{items:t(C),modelValue:t(T),"onUpdate:modelValue":s[1]||(s[1]=d=>N(T)?T.value=d:null)},null,8,["items","modelValue"])]),p(n,{type:"submit",color:"primary",text:"Generate Report",icon:t(Re),click:()=>{},loading:t(x)},null,8,["icon","loading"])])]),_:1}),e("div",Se,[p(f),e("div",null,[p(w,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${t(R)(t(b)).format("DD-MM-yyyy")} TO ${t(D)}).format('DD-MM-yyyy')}`,t(O).details.name,t(O).details.address,t(O).details.phone],data:t(H),worksheet:"report-work-sheet",name:`lab-statistics-report_${t(R)(t(b)).format("DD_MM_yyyy")}_to_${t(D)}).format('DD_MM_yyyy')}.xls`},{default:L(()=>[p(u,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),e("div",Be,[e("div",Fe,[Ue,p(E)]),e("div",je,[e("h3",Pe,[B("Tests Performed Period: "),e("span",Ve,v(t(b)!=""?t(R)(t(b)).format("dateFormat"in o?o.dateFormat:t(I)):"")+" - "+v(t(D)!=""?t(R)(t(D)).format("dateFormat"in o?o.dateFormat:t(I)):""),1)])]),e("div",Ye,[t(M).length>0?(l(),c("table",Le,[e("thead",Ne,[e("tr",Ge,[Ie,(l(!0),c(k,null,$(t(g),h=>(l(),c("th",{key:h,class:"px-4 py-2"},v(h),1))),128)),qe])]),e("tbody",null,[(l(!0),c(k,null,$(t(M),h=>(l(),c(k,{key:h.department},[e("tr",Ke,[e("td",ze,v(h.department),1),(l(!0),c(k,null,$(t(g),d=>(l(),c("td",{key:d,class:"px-4 py-2"}))),128)),He]),(l(!0),c(k,null,$(h.tests,(d,ae)=>(l(),c("tr",{key:d.name,class:ie({"bg-gray-50":oe(ae),"border-b border-dotted":!0})},[e("td",Je,v(d.name),1),(l(!0),c(k,null,$(t(g),V=>(l(),c("td",{key:V,class:"px-4 py-2"},v(j(d,V)),1))),128)),e("td",Qe,v(P(d)),1)],2))),128))],64))),128))])])):G("",!0),pe(e("div",We,[p(se),Xe],512),[[me,t(x)]]),t(U).length==0&&!t(x)?(l(),c("div",Ze,ot)):G("",!0)])])])}}});export{Ut as default};
