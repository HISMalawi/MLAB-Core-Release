import{_ as q}from"./B38OGO74.js";import{M as j,a as B,C as k,P as I,l as F,m as E,Z as V,a7 as N,x as U,y as M,b as l,e as c,f,g as e,k as T,t as n,i as P,aC as Y,L as H,K as y,h as g,O as S,F as x,j as v,v as L,_ as G,n as Z}from"./DaVfplCl.js";import{_ as K}from"./Cq2ShHsP.js";import{u as Q}from"./MuIwof8c.js";import{u as X}from"./TCrkXuHj.js";import{P as J}from"./Dr0mg474.js";import{r as W}from"./DQxuftN6.js";import{r as $}from"./DmaMmluN.js";import{r as ee}from"./B6aIjIoK.js";import{r as te}from"./Dqe_SWQt.js";import{_ as se}from"./DlVh0w5e.js";import"./CaCwXEk-.js";import"./Bk1fID9q.js";const re={name:"PatientReport",components:{UserIcon:W,QrCodeIcon:$,FunnelIcon:ee},setup(){Q({title:`${J.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:j,refreshIcon:te,cookie:B("token"),moment:k,facility:X(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String((this._.provides[I]||this.$route).query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){var d;this.loading=!0;const t=(d=(this._.provides[I]||this.$route).query.order_id)==null?void 0:d.toString(),r=this.dateRange!==null&&this.dateRange.length>0&&k(this.dateRange[0]).isValid()?k(this.dateRange[0]).format("YYYY-MM-DD"):"",i=this.dateRange!==null&&this.dateRange.length>1&&k(this.dateRange[1]).isValid()?k(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const s={route:`${F.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:R}=await E(s);if(this.loading=R,o.value){this.loading=!1,this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let D=o.value.orders.map(u=>{let h=0;return u.tests!==void 0&&(h+=u.tests.filter(w=>w.status.toLowerCase()==="verified").length),{...u,tests_verified:h}});this.reportData=D,this.showPrinterDialog()}m.value&&(this.loading=!1,console.error(m.value))}else{const s={route:`${F.tests}/${this.patientId}/report?from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:R}=await E(s);if(this.loading=R,o.value){this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let D=o.value.orders.map(u=>{let h=0;return u.tests!==void 0&&(h+=u.tests.filter(w=>w.status.toLowerCase()==="verified").length),{...u,tests_verified:h}});this.reportData=D,this.loading=!1,this.showPrinterDialog()}m.value&&(console.error(m.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],i=t.find(d=>r.includes(d.status.name));return i?`${i.initiator.first_name} ${i.initiator.last_name}`:""},getOrderStatus(t){return t!==null?V(t.split("-").join(" ")):""},getTestStatusInitiatorName(t,r){const i=t.find(d=>r===d.status.name);return i?{name:`${i.initiator.first_name} ${i.initiator.last_name}`,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(i=>i.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,i)=>r+i.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0&&t.toLowerCase()==="growth"?`Growth of ${[...new Set(r)].map(i=>i.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.test_types.some(i=>i.print_device))},getSmallLabelPrintTests(t){const r=[],i=new Set;return t.forEach(d=>{d.test_types.forEach(s=>{s.print_device&&i.add(s.name)})}),t.forEach(d=>{d.tests.forEach(s=>{i.has(s.test_type_name)&&r.push(String(s.id))})}),r},getPrintCount(t){return t.reduce((r,i)=>r+i.print_count,0)},getRequiredRange(t,r){const i=t.sex=="M"?"Male":"Female",d=Math.ceil(Number(N(t.date_of_birth)==0?1:Number(N(t.date_of_birth))));return r.filter(s=>s.sex===i&&d>Number(s.min_age)&&d<Number(s.max_age)||s.sex==="Both"&&d>Number(s.min_age)&&d<Number(s.max_age))[0]},shouldDisplayRange(t,r,i){let d=null;return this.showIndicatorRanges(t)&&(d=this.getRequiredRange(r,i.indicator_ranges)),d},getMachineName(t){return t[0].result.machine_name},getCompletedTests(t){const r=new Set(["completed","verified"]);return t.filter(i=>r.has(i.status.toLowerCase()))},showPrinterDialog(){this.$nextTick(()=>{var t;((t=(this._.provides[I]||this.$route).query.printer)==null?void 0:t.toString())=="true"&&this.$refs.corePrinter.init()})}}},oe=""+new URL("medical-record.B8XPaMkU.png",import.meta.url).href,ne={class:"py-5 px-5"},ie={class:"flex items-center py-5"},ae=e("img",{src:oe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),le={class:"text-2xl font-semibold uppercase",style:{"font-size":"24px","line-height":"2rem"}},de={class:"text-sky-500 text-2xl",style:{"font-size":"24px","line-height":"2rem"}},ce={class:"mt-2 space-y-3"},pe={class:"w-full flex items-center justify-between"},_e={class:"flex items-center space-x-5"},ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},me={class:"w-72 ml-2"},he={class:"flex items-center space-x-2"},be=e("label",null,"Include pending tests",-1),fe={key:0,class:"border rounded print-container mt-10"},ye={class:"rounded-tr rounded-tl border-b px-5 py-5"},ge={class:"flex items-center justify-between"},xe=e("div",{class:"flex items-center space-x-2"},[e("img",{src:se,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold",style:{"font-size":"24px","line-height":"2rem"}}," PATIENT REPORT ")],-1),ve={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},Te={class:"font-normal"},Re={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted",style:{"font-size":"20px","line-height":"2rem"}},De={class:"flex items-center not-italic text-gray-600"},we={class:"flex items-center not-italic text-gray-600"},ke={class:"flex items-center justify-between mt-5"},Se=e("span",{class:"font-medium"},"Report Date:",-1),Ae=e("span",{class:"font-medium"},"No. Printed:",-1),Ie=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Me={class:"w-full mt-2"},Pe=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Ne={class:"border px-2 py-2"},Ce=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Fe={class:"border px-2 py-2"},Ee=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Le={class:"border px-2 py-2"},Oe=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),ze={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),je={class:"border px-2 py-2",colspan:"2"},Be={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Ve={class:"flex items-center"},Ue={class:"border-collapse border-slate-500 w-full"},Ye=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),He={class:"border-b border-r px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),Ze={class:"border-b px-2 py-2"},Ke=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),Qe={class:"border-b border-r px-2 py-2"},Xe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),Je={class:"border-b px-2 py-2"},We=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),$e={class:"border-b border-r px-2 py-2"},et=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1),tt={class:"border-b px-2 py-2"},st={class:"border-collapse w-full"},rt={class:"bg-gray-100 text-gray-600"},ot=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),nt={colspan:3,class:"px-2 py-2 text-lg font-semibold"},it=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),at={class:"border px-2 py-2 text-left"},lt={class:"p-0 border-b",style:{padding:"0 !important"}},dt={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},ct=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Units "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1),pt={class:"border-b"},_t={class:"border-r px-2 py-2"},ut={class:"px-2 py-2 flex items-center border-r"},mt=["innerHTML"],ht={key:0},bt={class:"px-2"},ft={key:0,class:"border-t border-l px-2 py-2 font-bold"},yt={key:1,class:"border px-2 py-2"},gt={class:"border px-2 py-2"},xt=["innerHTML"],vt={class:"border px-2 py-2"},Tt={class:"test-status"},Rt=e("p",{class:"font-bold"},"Test Status",-1),Dt={class:"px-2"},wt={class:"px-2"},kt={class:"px-2"},St={key:0},At=e("p",{class:"font-bold"},"Performed By",-1),It={class:"px-2"},Mt={class:"px-2 mb-2"},Pt={key:0,class:"mb-2"},Nt=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1),Ct={class:"m-2"},Ft=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Et={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},Lt={class:"w-full"},Ot=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),zt={classs:"border-l border-r"},qt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},jt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Bt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Vt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Ut=e("p",{class:"text-base"},[T(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function Yt(t,r,i,d,s,o){const m=q,R=M("FunnelIcon"),D=M("datepicker"),u=G,h=K,w=M("barcode"),O=Z;return l(),c("div",ne,[f(m,{pages:s.pages},null,8,["pages"]),e("div",ie,[ae,e("h3",le,[T(" patient report for "),e("span",de,'"'+n(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`)+'"',1)])]),e("div",ce,[e("div",pe,[e("div",_e,[e("div",ue,[f(R,{class:"w-5 h-5 mr-2"}),T(" Filter By Date Range "),e("div",me,[f(D,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=p=>s.dateRange=p)},null,8,["modelValue"])])]),e("div",he,[P(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=p=>s.showPendingTests=p)},null,512),[[Y,s.showPendingTests]]),be]),f(u,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>o.init()},null,8,["loading","icon","click"])]),e("div",null,[o.getAuthorizedTestCount(s.reportData)>0?(l(),H(h,{key:0,"print-small-label":o.shouldPrintSmallLabel(s.reportData),id:o.patientId,orderId:o.orderId,tests:o.getSmallLabelPrintTests(s.reportData),orderTests:s.reportData[0].tests,onUpdate:o.updateReport,ref:"corePrinter"},null,8,["print-small-label","id","orderId","tests","orderTests","onUpdate"])):y("",!0)])]),s.reportData.length>0?(l(),c("div",fe,[e("div",ye,[e("div",ge,[xe,e("div",null,[f(w,{value:s.reportData[0].accession_number,"display-value":!1,height:50},null,8,["value"])]),e("div",ve,[e("address",Te,[e("span",Re,n(s.facility.details.name),1),e("span",De,n(s.facility.details.address),1),e("span",we,n(s.facility.details.phone),1)])])]),e("div",ke,[e("div",null,[Se,T(" "+n(s.moment(new Date).format("DATE_FORMAT"in t?t.DATE_FORMAT:g(S))),1)]),e("div",null,[Ae,T(" "+n(o.getPrintCount(s.reportData)),1)]),e("div",null,[Ie,T(" "+n(s.reportData.length>0&&s.moment(s.reportData[0].sample_collection_time).format("DATE_FORMAT"in t?t.DATE_FORMAT:g(S))),1)])]),e("table",Me,[e("tbody",null,[e("tr",null,[Pe,e("td",Ne,n(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`),1),Ce,e("td",Fe,n(s.person.sex==="F"?"Female":"Male"),1),Ee,e("td",Le,n(("calculateAge"in t?t.calculateAge:g(N))(s.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[Oe,e("td",ze,n(s.person.id),1),qe,e("td",je,n(o.getPhysicalAddress),1)])])])]),(l(!0),c(x,null,v(s.reportData,(p,z)=>(l(),c("div",{key:z},[e("div",Be,[e("div",Ve," Accession No: "+n(p.accession_number),1),e("div",null," Requested By: "+n(p.requested_by)+" ("+n(p.requesting_ward)+") ",1)]),e("table",Ue,[e("tbody",null,[e("tr",null,[Ye,e("td",He,n(p.specimen),1),Ge,e("td",Ze,n(s.moment(p.created_date).format("DATE_FORMAT"in t?t.DATE_FORMAT:g(S))),1)]),e("tr",null,[Ke,e("td",Qe,n(o.getTestTypes(p.test_types)),1),Xe,e("td",Je,n(o.getDepartments(p.test_types)),1)]),e("tr",null,[We,e("td",$e,n(o.getOrderStatus(p.order_status)),1),et,e("td",tt,n(o.getOrderStatusInitiatorName(p.order_status_trail)),1)])])]),e("table",st,[e("thead",null,[e("tr",rt,[ot,e("th",nt," Tests Authorized("+n(p.tests_verified)+") ",1)])]),e("tbody",null,[it,(l(!0),c(x,null,v(s.showPendingTests?p.tests:o.getCompletedTests(p.tests),a=>(l(),c("tr",{key:a.id},[e("td",at,n(a.test_type_name),1),e("td",lt,[e("table",dt,[ct,e("tbody",pt,[(l(!0),c(x,null,v(a.indicators,(_,A)=>{var b,C;return l(),c("tr",{key:A,class:"border-b"},[e("td",_t,n(_.name),1),e("td",ut,[e("p",{innerHTML:o.showResult(((b=_.result)==null?void 0:b.value)??"",a==null?void 0:a.suscept_test_result)},null,8,mt),(C=_.result)!=null&&C.value?y("",!0):(l(),c("span",ht,"Not done"))]),e("td",bt,n(_==null?void 0:_.unit),1),o.shouldDisplayRange(a.indicators,s.person,_)!==void 0&&o.shouldDisplayRange(a.indicators,s.person,_)!==null?(l(),c("td",ft," ("+n(o.shouldDisplayRange(a.indicators,s.person,_).lower_range)+" - "+n(o.shouldDisplayRange(a.indicators,s.person,_).upper_range)+") ",1)):(l(),c("td",yt))])}),128))])])]),e("td",gt,[e("p",{innerHTML:a!=null&&a.result_remarks?a==null?void 0:a.result_remarks.value:"N/A"},null,8,xt)]),e("td",vt,[e("div",Tt,[Rt,e("p",Dt,n(o.getTestStatusName(a.status)),1),e("p",wt," By: "+n(o.getTestStatusInitiatorName(a.status_trail,a.status).name),1),e("p",kt," On: "+n(s.moment(o.getTestStatusInitiatorName(a.status_trail,a.status).created_at).format("DATE_FORMAT"in t?t.DATE_FORMAT:g(S))),1)]),o.getTestStatusInitiatorName(a.status_trail,"completed").name?(l(),c("div",St,[At,e("p",It,n(o.getTestStatusInitiatorName(a.status_trail,"completed").name),1),e("p",Mt," On: "+n(s.moment(o.getTestStatusInitiatorName(a.status_trail,"completed").created_at).format("DATE_FORMAT"in t?t.DATE_FORMAT:g(S))),1),o.getMachineName(a.indicators)?(l(),c("div",Pt,[Nt,e("p",null,n(o.getMachineName(a.indicators)),1)])):y("",!0)])):y("",!0)])]))),128))])]),P(e("div",Ct,[Ft,e("div",null,[(l(!0),c(x,null,v(p.tests,a=>(l(),c("div",{class:"grid grid-cols-2 gap-4",key:a.id},[a.test_type_name.toLowerCase().includes("culture")?(l(!0),c(x,{key:0},v(a.suscept_test_result,(_,A)=>(l(),c("div",{key:A},[e("div",Et,n(_.name),1),e("table",Lt,[Ot,e("tbody",zt,[(l(!0),c(x,null,v(o.getFilteredDrugs(_.drugs),b=>(l(),c("tr",{key:b.drug_id},[e("th",qt,n(b.name),1),e("th",jt,n(b.zone),1),e("th",Bt,n(b.interpretation),1)]))),128))])])]))),128)):y("",!0)]))),128))])],512),[[L,o.checkSusceptibilityResults(p)]])]))),128))])):y("",!0),e("div",null,[P(e("div",Vt,[f(O),Ut],512),[[L,s.loading]])])])])}const os=U(re,[["render",Yt]]);export{os as default};
