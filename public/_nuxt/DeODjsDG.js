import{_ as ae}from"./FSyX_QAo.js";import{_ as ne}from"./BVbKE4I5.js";import{d as le,r as M,a as de,a2 as ie,N as ue,u as ce,ap as O,c as $,C as f,w as P,o as me,y as N,b as m,e as p,f as v,h as t,g as a,t as x,j as L,H as B,z as pe,P as k,F as q,k as C,K as V,l as _e,E as fe,_ as ve}from"./fgAWut4R.js";import{_ as ye}from"./CqZhWxxg.js";import{_ as be}from"./p9xou6Cm.js";import{_ as Re,a as he}from"./C9spbOGC.js";import{u as ge,_ as xe}from"./B_UD_8z9.js";import{_ as Ee}from"./gjJynNbW.js";import{_ as De}from"./DyZADXEb.js";import{u as Te}from"./CIe-vdAS.js";import{P as we}from"./D60l4UIm.js";import{u as Ae}from"./DHxBKYG_.js";import{r as Me}from"./Bn_PUTpw.js";import{r as $e}from"./CcwhGEz4.js";import"./CRggh57R.js";import"./Qv-HZX4d.js";import"./b5sOyOyw.js";import"./C5yTkR2T.js";import"./Cko9ZNcE.js";import"./CepswtFc.js";import"./BMlEGhQ0.js";import"./xRdLAUoX.js";import"./CLX9t2Lo.js";const qe={class:"px-5 py-5"},ke={class:"w-full flex items-center justify-between"},Ce={class:"flex items-center space-x-3"},Fe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Oe={class:"w-72 ml-2"},Se={class:"w-44"},Ye={class:"flex items-center space-x-3"},je={class:"border rounded mt-5"},Pe={class:"flex items-center justify-between px-5 py-5 border-b"},Ne={class:"mt-3 px-5"},Le={class:"text-lg font-semibold mb-2"},Be={class:"text-normal font-normal"},Ve={key:0,class:"print-container",id:"print-container"},Ue={class:"w-full border border-dotted rounded overflow-x-auto"},Ge={class:"bg-gray-50 border-b border-dotted rounded-t"},He={class:"border-r border-b border-dotted px-2 py-2"},Ie=["onClick"],Qe={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},ze={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Je="Rejected Samples Report",gt=le({__name:"rejected-samples",setup(Ke){Ae({title:`${we.name.toUpperCase()} - Rejected Samples Report`});const U=M([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),E=M([]),G=de("token"),F=Te(),g=ie(),l=ue(),{loading:y,executeCancellableRequest:H,cancelRequest:I}=ge(),u=M(["",""]),{$toast:A,$metadata:Q}=ce(),i=M({name:l.query.department?String(l.query.department):O,id:l.query.department_id?Number(l.query.department_id):void 0}),z=()=>{u.value=new Array("","")},b=M({results:[],value:void 0,wards:[]}),S=$(()=>b.value.results.map(r=>{const e={};r.test_types.forEach(s=>{const{name:o,ward:d,count:R,associated_ids:_}=s;e[o]||(e[o]={}),e[o][d]||(e[o][d]={count:0,associated_ids:""}),e[o][d].count+=R,e[o][d].associated_ids=_});const n=Object.keys(e).map(s=>({name:s,wards:e[s]}));return{name:r.name,testTypes:n}})),J=$(()=>{const r=[];return b.value.results.forEach(e=>{const n={},s={};e.test_types.forEach(o=>{const{name:d,ward:R,count:_}=o;n[d]||(n[d]={},s[d]=0),n[d][R]=_||0,s[d]+=_});for(const o in n){const d=n[o],R={TESTS:o};b.value.wards.forEach(_=>{R[_]=d[_]!==void 0?d[_]:0}),R.TOTAL=s[o],r.push(R)}}),r}),K=(r,e)=>{const n=S.value.find(o=>o.name===r),s=n==null?void 0:n.testTypes.find(o=>o.name===e);return s?Object.values(s.wards).reduce((o,d)=>o+d.count,0):0},D=$(()=>u.value[0]?f(u.value[0]).format("YYYY-MM-DD"):""),T=$(()=>u.value[1]?f(u.value[1]).format("YYYY-MM-DD"):"");async function Y(){if(W())A.warning("Please select a department");else{y.value=!0;const r={route:`${_e.aggregateReports}rejected?from=${D.value}&to=${T.value}&department=${i.value.id==0?"":i.value.id}&report_id=${l.query.report_id}`,method:"GET",token:`${G.value}`},{data:e,error:n,pending:s}=await H(r);y.value=s,e.value&&(y.value=!1,b.value=e.value,X(e.value.report_id),e.value.results.length>0?A.success("Report generated successfully!"):A.warning("Data not found within the specified period")),n.value&&(console.error(n.value),y.value=!1,A.error(fe))}}const W=()=>i.value.name==O,X=r=>{const n={...g.currentRoute.value.query,report_id:r};g.replace({query:n}).catch(s=>{console.error("Failed to replace route:",s)})},Z=(r,e,n,s)=>{if(n!==0&&s!==""){const o=i.value.name,d=i.value.id;g.push(`/reports/${s}?origin=aggregate&type=rejected-samples-report&from=${D.value}&to=${T.value}&test=${r} - ${e}&department=${o}&department_id=${d}&count=${n}`)}else A.warning("No data found for this month")};P(u,()=>{const r=u.value[0]?f(u.value[0]).format("YYYY-MM-DD"):"",e=u.value[1]?f(u.value[1]).format("YYYY-MM-DD"):"";if(r||e){const s={...g.currentRoute.value.query,...r&&{from:r},...e&&{to:e},...i.value.name!==O&&{department:i.value.name,department_id:i.value.id},...l.query.report_id&&{report_id:""}};g.replace({query:s}).catch(o=>{console.error("Failed to replace route:",o)})}},{deep:!0}),P(i,(r,e)=>{if(r!==e){const s={...g.currentRoute.value.query,department:r.name||"",department_id:r.id,report_id:""};g.replace({query:s}).catch(o=>{console.error("Failed to replace route:",o)})}});const j=()=>{if(l.query.department){const r=E.value.find(e=>e.name===l.query.department);r?i.value={name:r.name,id:r.id}:l.query.department_id&&(i.value={name:String(l.query.department),id:Number(l.query.department_id)})}},ee=$(()=>l.query.to!==void 0&&l.query.from!==void 0&&l.query.department!==void 0?(u.value=[l.query.from,l.query.to],j(),l.query.to!==""&&l.query.from!==""&&l.query.department!==""):!1);return me(()=>{E.value=Q.departments,E.value.some(e=>e.name=="All")||E.value.push({id:0,name:"All"}),E.value.sort((e,n)=>{const s=e.name.toUpperCase(),o=n.name.toUpperCase();return s<o?-1:s>o?1:0}),j(),ee.value?Y():y.value=!1}),(r,e)=>{const n=ae,s=N("datepicker"),o=ne,d=ve,R=ye,_=be,te=N("excel"),re=he,oe=xe;return m(),p("div",qe,[v(n,{pages:t(U)},null,8,["pages"]),a("div",{class:"flex items-center py-5"},[e[2]||(e[2]=a("img",{src:Ee,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),a("h3",{class:"text-2xl font-semibold uppercase"},x(Je))]),a("div",ke,[a("div",Ce,[a("div",Fe,[v(t(Me),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=L(" Filter By Date Range ")),a("div",Oe,[v(s,{onCleared:z,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(u),"onUpdate:modelValue":e[0]||(e[0]=w=>B(u)?u.value=w:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),a("div",Se,[v(o,{items:t(E),modelValue:t(i),"onUpdate:modelValue":e[1]||(e[1]=w=>B(i)?i.value=w:null)},null,8,["items","modelValue"])]),v(d,{color:"primary",text:"Generate Report",icon:t($e),click:()=>Y(),loading:t(y)},null,8,["icon","click","loading"])]),a("div",Ye,[v(R,{printSmallLabel:!1}),v(te,{class:"btn btn-default",header:[`REJECTED ${t(i).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${t(f)(t(D)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(k))} TO ${t(f)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(k))}`,t(F).details.name,t(F).details.address,t(F).details.phone],data:t(J),worksheet:"report-work-sheet",name:`rejected_${t(i).name.toLowerCase().split(" ").join("_")}_report_${t(f)(t(D)).format("DD_MM_yyyy")}_to_${t(f)(t(T)).format("DD_MM_yyyy")}.xls`},{default:pe(()=>[v(_,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),a("div",je,[a("div",Pe,[e[4]||(e[4]=a("div",{class:"flex flex-col space-y-2"},[a("img",{src:De,alt:"app-logo",class:"w-24 h-24 object-cover"}),a("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1)),v(re)]),a("div",Ne,[a("h3",Le,[e[5]||(e[5]=L(" Tests Performed Period: ")),a("span",Be,x(t(D)!=""?t(f)(t(D)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(k)):"")+" - "+x(t(T)!=""?t(f)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(k)):""),1)])]),t(b).results.length>0&&!t(y)?(m(),p("div",Ve,[a("table",Ue,[(m(!0),p(q,null,C(t(S),(w,se)=>(m(),p(q,{key:se},[a("thead",Ge,[a("tr",null,[e[6]||(e[6]=a("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1)),(m(!0),p(q,null,C(t(b).wards,c=>(m(),p("th",{key:c,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(c),1))),128)),e[7]||(e[7]=a("th",{class:"border-r border-t border-b border-dotted px-2 py-2"}," TOTAL ",-1))])]),a("tbody",null,[(m(!0),p(q,null,C(w.testTypes,c=>(m(),p("tr",{key:c.name},[a("td",He,x(c.name),1),(m(!0),p(q,null,C(t(b).wards,h=>(m(),p("td",{key:h,onClick:We=>Z(c.name,h,c.wards[h]?c.wards[h].count:0,c.wards[h]?c.wards[h].associated_ids:""),class:"px-4 border-r border-b border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(c.wards[h]?c.wards[h].count:0),9,Ie))),128)),a("td",Qe,x(K(w.name,c.name)),1)]))),128))])],64))),128))])])):V("",!0),v(oe,{condition:t(y),cancelReportGeneration:()=>t(I)()},null,8,["condition","cancelReportGeneration"]),t(b).wards.length==0&&t(b).results.length==0&&!t(y)?(m(),p("div",ze,e[8]||(e[8]=[a("img",{src:Re,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),a("p",{class:"text-base"}," Please generate report data to preview the report ",-1)]))):V("",!0)])])}}});export{gt as default};
