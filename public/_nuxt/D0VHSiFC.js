import{d as j,r as v,a as G,ak as L,a5 as K,c as g,w as z,C as u,o as Q,y as T,b as d,e as p,g as e,f as c,z as $,h as t,k as E,H,t as _,F as N,j as A,K as F,i as J,v as W,u as k,l as X,m as Z,E as ee,_ as te,n as oe}from"./BxD-h1LR.js";import{_ as se}from"./BNhNOnHe.js";import{_ as re}from"./Cs7plFji.js";import{_ as ne}from"./B4cMvEBz.js";import{_ as ae}from"./CQcCm1L6.js";import{u as ie}from"./DRcUz5ts.js";import{s as ce}from"./Qw5I_VYr.js";import{r as le}from"./BkJfYQCG.js";import{r as ue}from"./CQe3LSWs.js";const de={class:"w-full flex items-center justify-between mb-10"},pe={class:"flex items-center space-x-5"},me={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},_e={class:"w-56 ml-2"},ye={class:"w-48"},fe={class:"rounded border",id:"print-container"},he={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},ve=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ne,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ")],-1),xe={class:"px-4 mt-2 font-medium"},be={class:"font-normal"},Re={key:0},Ie={class:"w-full border-b border-t bg-gray-50 rounded-t"},Te={colspan:4,class:"text-left px-2 py-2"},ke=e("tr",{class:"border-r border-t"},[e("th",{class:"border-r px-2 py-2 text-left"},"Drug Name"),e("th",{class:"border-r px-2 py-2 text-center"},"I"),e("th",{class:"border-r px-2 py-2 text-center"},"R"),e("th",{class:"px-2 py-2 text-center"},"S")],-1),Ee={class:"border-r px-2 py-2 text-left"},Ce=["onClick"],we=["onClick"],Se=["onClick"],ge={class:"w-full items-center flex flex-col space-y-2 my-10"},$e=e("p",null,[E(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),Ne={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Ae=e("img",{src:ae,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Fe=e("p",null,"Data not found, please generate report",-1),Me=[Ae,Fe],Le=j({__name:"ast",setup(De){const o=v(""),M=G("token"),i=v(!1),y=v([]),x=ie(),D=v(""),C=L(),f=K(),B=g(()=>y.value.flatMap(n=>n.drugs.map(s=>({"DRUG NAME":s.drug_name,"INTERPRETATION I":s.interpretations.I.count,"INTERPRETATION R":s.interpretations.R.count,"INTERPRETATION S":s.interpretations.S.count})))),q=()=>{o.value=""},b=(n,s,a)=>{ce({test:n,type:"General Counts",count:s,associated_ids:a,date_filter:u(o.value).format("YYYY-MM-DD")},k())};async function w(){i.value=!0;let n=u(o.value).format("M"),s=u(o.value).format("yyyy");const a={route:`${X.aggregateReports}culture/ast?year=${s}&month=${n}`,method:"GET",token:`${M.value}`},{data:l,error:h,pending:R}=await Z(a);i.value=R,l.value&&(y.value=l.value.data,i.value=!1,U(l.value.report_id),k().$toast.success("Report data generated successfully")),h.value&&(console.error(h.value),i.value=!1,k().$toast.error(ee))}const U=n=>{D.value=n;const a={...f.currentRoute.value.query,report_id:n};f.replace({query:a}).catch(l=>{console.error("Failed to replace route:",l)})};z(o,()=>{if(o){const s={...f.currentRoute.value.query,dateFrom:o?u(o.value).format("M/yyyy"):""};f.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})}},{deep:!0});const V=g(()=>C.query.dateFrom!==void 0&&C.query.dateFrom!=="");return Q(()=>{V.value&&w()}),(n,s)=>{const a=T("datepicker"),l=te,h=T("FormKit"),R=se,O=T("excel"),Y=re,P=oe;return d(),p("div",null,[e("div",de,[c(h,{type:"form","submit-label":"Update",onSubmit:w,actions:!1},{default:$(({value:m})=>[e("div",pe,[e("div",me,[c(t(le),{class:"w-5 h-5 mr-2"}),E(" Filter By Date Range "),e("div",_e,[c(a,{onCleared:q,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:t(o),"onUpdate:modelValue":s[0]||(s[0]=I=>H(o)?o.value=I:null),format:"M/yyyy"},null,8,["modelValue"])])]),e("div",ye,[c(l,{type:"submit",color:"primary",text:"Generate Report",icon:t(ue),click:()=>{},loading:t(i)},null,8,["icon","loading"])])])]),_:1}),e("div",null,[c(O,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ${t(u)(t(o)).format("M/yyyy")}`,t(x).details.name,t(x).details.address,t(x).details.phone],data:t(B),worksheet:"report-work-sheet",name:`culture_sensitivity_antibiotic_susceptibility_report_${t(u)(t(o)).format("M_yyyy")}.xls`},{default:$(()=>[c(R,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",fe,[e("div",he,[ve,c(Y)]),e("div",null,[e("h3",xe,[E(" Data for period: "),e("span",be,_(t(o)==""?"":t(u)(t(o)).format("M/yyyy")),1)])]),t(y).length>0&&!t(i)?(d(),p("div",Re,[(d(!0),p(N,null,A(t(y),(m,I)=>(d(),p("table",{key:I,class:"w-full mt-3",ref_for:!0,ref:"table"},[e("thead",Ie,[e("tr",null,[e("th",Te,_(m.name),1)]),ke]),e("tbody",null,[(d(!0),p(N,null,A(m.drugs,r=>(d(),p("tr",{key:r,class:"border-b"},[e("td",Ee,_(r.drug_name),1),e("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:S=>b(`Antimicrobial Subsceptibility Testing (${m.name}) - ${r.drug_name}`,r.interpretations.I.count,r.interpretations.I.associated_ids)},_(r.interpretations.I.count),9,Ce),e("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:S=>b(`Antimicrobial Subsceptibility Testing (${m.name}) - ${r.drug_name}`,r.interpretations.R.count,r.interpretations.R.associated_ids)},_(r.interpretations.R.count),9,we),e("td",{class:"px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:S=>b(`Antimicrobial Subsceptibility Testing (${m.name}) - ${r.drug_name}`,r.interpretations.S.count,r.interpretations.S.associated_ids)},_(r.interpretations.S.count),9,Se)]))),128))])],512))),128))])):F("",!0),J(e("div",ge,[c(P),$e],512),[[W,t(i)]]),t(y).length==0&&!t(i)?(d(),p("div",Ne,Me)):F("",!0)])])}}});export{Le as default};
