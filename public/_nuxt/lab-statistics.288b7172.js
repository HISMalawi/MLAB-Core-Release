import{_ as E}from"./Breadcrumb.cfeb06ed.js";import{_ as F}from"./Dropdown.28b1fd1d.js";import{u as C,a as A,_ as O,f as k,o as i,c,b as d,d as t,t as m,g as V,h as U,k as v,F as g,r as x,e as j}from"./entry.6a3fbfc1.js";import{_ as B}from"./index.1c41193f.js";import{e as S,d as w}from"./constants.cf42f90d.js";import{u as Y}from"./vue.f36acd1f.f8958c90.js";import{h as T,e as M,f as R}from"./fetch.444ade97.js";import{u as I}from"./facility.df7118e4.js";import{P as L}from"./package.d411c004.js";import{r as P}from"./ArrowPathIcon.8bf7277c.js";import{r as q}from"./PrinterIcon.b8623d34.js";import{r as H}from"./DocumentTextIcon.9fa90f2c.js";import{_ as N}from"./logo.18f1af6f.js";import"./nuxt-link.bebad584.js";import"./HomeIcon.54ceb79b.js";import"./listbox.064b6dcd.js";import"./hidden.e85239c2.js";import"./use-text-value.75cce7ff.js";import"./CheckIcon.9343e206.js";import"./CheckCircleIcon.6ff04472.js";import"./MagnifyingGlassIcon.ba982fe1.js";import"./jspdf.es.min.fa83e768.js";import"./XMarkIcon.fd9a39e2.js";import"./transition.9bb58b2a.js";import"./PencilSquareIcon.79aa7948.js";const G={setup(){Y({title:`${L.name.toUpperCase()} - Lab Statistics Report`})},data(){return{moment:T,refreshIcon:P,printIcon:q,exportIcon:H,title:"Lab Statistics Reports",facility:I(),headers:[{name:"Tests"},{name:"Feb"},{name:"Total"}],tests:[{name:"Blood glucose",feb:50,total:120},{name:"Complete blood count",feb:100,total:250},{name:"Electrolytes",feb:75,total:200},{name:"Liver function tests",feb:80,total:180},{name:"Kidney function tests",feb:60,total:150},{name:"Lipid panel",feb:70,total:200},{name:"Thyroid function tests",feb:90,total:220},{name:"Urinalysis",feb:40,total:100},{name:"Hemoglobin A1C",feb:85,total:190},{name:"Hepatitis panel",feb:55,total:150}],pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],departments:new Array,selectedDepartment:{name:"-- select department --"},dateFrom:"",dateTo:"",cookie:C("token"),reportData:new Array,months:new Array,filteredData:new Array,exportData:new Array,loading:!1}},created(){this.getDepartments()},methods:{async getDepartments(){const s={route:M.departments,method:"GET",token:`${this.cookie}`},{data:o,error:r}=await R(s);o.value&&(this.departments=o.value),r.value&&console.error(r.value)},checkStatus(s){let o="";return s=="-- select department --"||s==="-- select test type --"||s==="-- select test status --"?o="":o=s,o},generateMonths(s,o){const r=new Date(s),a=new Date(o),e=new Array;let l=r;for(;l<=a;){const u=l.toLocaleString("default",{month:"long"});e.push(u),l.setMonth(l.getMonth()+1)}this.months=e},async generateReport(){this.loading=!0;let s=this.dateFrom!=""?T(this.dateFrom).format("YYYY-MM-DD"):"",o=this.dateTo!=""?T(this.dateTo).format("YYYY-MM-DD"):"",r=`from=${s}&to=${o}&department=${this.checkStatus(this.selectedDepartment.name)}`;const a={route:`${M.aggregateReports}/lab_statistics?${r}`,method:"GET",token:`${this.cookie}`},{data:e,error:l,pending:u}=await R(a);if(this.loading=u,e.value){this.generateMonths(e.value.from,e.value.to),this.reportData=e.value.data,this.filteredData=this.filterData(e.value.data);let p=[];this.filteredData.forEach(_=>{const f={};f["Tests".toUpperCase()]=_.department.toUpperCase(),this.months.forEach(h=>{f[h.toUpperCase()]=""}),f["Total".toUpperCase()]="",p.push(f),_.tests.forEach(h=>{const y={};y["Tests".toUpperCase()]=h.name,this.months.forEach(n=>{y[n.toUpperCase()]=this.getTestResultByMonth(h,n)}),y["Total".toUpperCase()]=this.getTotalTestResults(h),p.push(y)})}),this.exportData=p,this.loading=!1}l.value&&(this.loading=!1,console.error(l.value),A().$toast.error(S))},filterData(s){return s.map(o=>{const r=Object.keys(o)[0],a=Object.entries(o[r]).map(([e,l])=>{const u=Object.entries(l).map(([p,_])=>({[p]:_}));return{name:e,results:u}});return{department:r,tests:a}})},getTotalTestsByMonth(s,o){let r=0;return s.tests.forEach(a=>{a.results.forEach(e=>{r+=e[o]||0})}),r},getTotalTests(s){let o=0;return s.tests.forEach(r=>{r.results.forEach(a=>{Object.values(a).forEach(e=>{o+=e})})}),o},getTestResultByMonth(s,o){let r=0;return s.results.forEach(a=>{r+=a[o]||0}),r},getTotalTestResults(s){let o=0;return s.results.forEach(r=>{Object.values(r).forEach(a=>{o+=a})}),o}}},K={class:"px-5 py-5"},z={class:"flex items-center justify-between py-5"},J={class:"text-2xl font-semibold"},Q={class:"w-full flex items-center justify-between mb-3"},W={class:"flex items-center space-x-3"},X={class:"w-40"},Z={class:"w-40"},$={class:"w-44"},ee={class:"flex items-center space-x-3"},te={class:"border rounded print-container",id:"print-container"},oe={class:"bg-gray-50 rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},se=t("img",{src:N,alt:"app-logo",class:"w-24 h-24 object-cover"},null,-1),re={class:"space-y-2 py-5"},ne={class:"uppercase font-medium"},ae={class:"uppercase font-medium"},le={class:"uppercase font-medium"},ie=t("p",{class:"uppercase font-medium underline"},"Laboratory Report",-1),ce={class:"mt-3 px-5"},me={class:"font-medium mb-2"},pe={class:"text-normal font-normal"},de={class:"border mx-5 mb-5"},ue={class:"w-full"},fe={class:"uppercase bg-gray-100"},he={class:"text-left"},_e=t("th",{class:"px-4 py-2"},"Tests",-1),ye=t("th",{class:"px-4 py-2"},"Total",-1),be={style:{width:"100% !important"},class:"w-full bg-gray-50 border-t border-b border-dotted"},ge={class:"px-4 py-2 font-bold"},xe=t("td",{class:"px-4 py-2"},null,-1),Te={class:"px-4 py-2"},De={class:"px-4 py-2"};function ke(s,o,r,a,e,l){const u=E,p=k("datepicker"),_=F,f=j,h=B,y=k("excel");return i(),c("div",K,[d(u,{pages:e.pages},null,8,["pages"]),t("div",z,[t("h3",J,m(e.title),1)]),t("div",Q,[t("div",W,[t("div",X,[d(p,{position:"left",range:!1,placeholder:"-- start date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateFrom,"onUpdate:modelValue":o[0]||(o[0]=n=>e.dateFrom=n),format:"dd/MM/yyyy"},null,8,["modelValue"])]),t("div",Z,[d(p,{range:!1,placeholder:"-- end date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateTo,"onUpdate:modelValue":o[1]||(o[1]=n=>e.dateTo=n),format:"dd/MM/yyyy"},null,8,["modelValue"])]),t("div",$,[d(_,{items:e.departments,modelValue:e.selectedDepartment,"onUpdate:modelValue":o[2]||(o[2]=n=>e.selectedDepartment=n)},null,8,["items","modelValue"])]),t("div",null,[d(f,{color:"success",text:"Generate Report",icon:e.refreshIcon,click:()=>l.generateReport(),loading:e.loading},null,8,["icon","click","loading"])])]),t("div",ee,[d(h),t("div",null,[d(y,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${e.moment(e.dateFrom).format("DD-MM-yyyy")} TO ${e.moment(e.dateTo).format("DD-MM-yyyy")}`,e.facility.details.name,e.facility.details.address,e.facility.details.phone],data:e.exportData,worksheet:"report-work-sheet",name:`lab-statistics-report_${e.moment(e.dateFrom).format("DD_MM_yyyy")}_to_${e.moment(e.dateTo).format("DD_MM_yyyy")}.xls`},{default:V(()=>[d(f,{color:"success",click:()=>{},icon:e.exportIcon,text:"Export"},null,8,["icon"])]),_:1},8,["header","data","name"])])])]),t("div",te,[t("div",oe,[se,t("div",re,[t("p",ne,m(e.facility.details.name),1),t("p",ae,m(e.facility.details.address),1),t("p",le,m(e.facility.details.phone),1),ie])]),t("div",ce,[t("h3",me,[U("Tests Performed Period: "),t("span",pe,m(e.dateFrom!=""?e.moment(e.dateFrom).format("dateFormat"in s?s.dateFormat:v(w)):"")+" - "+m(e.dateTo!=""?e.moment(e.dateTo).format("dateFormat"in s?s.dateFormat:v(w)):""),1)])]),t("div",de,[t("table",ue,[t("thead",fe,[t("tr",he,[_e,(i(!0),c(g,null,x(e.months,n=>(i(),c("th",{key:n,class:"px-4 py-2"},m(n),1))),128)),ye])]),t("tbody",null,[(i(!0),c(g,null,x(e.filteredData,n=>(i(),c(g,{key:n.department},[t("tr",be,[t("td",ge,m(n.department),1),(i(!0),c(g,null,x(e.months,b=>(i(),c("td",{key:b,class:"px-4 py-2"}))),128)),xe]),(i(!0),c(g,null,x(n.tests,b=>(i(),c("tr",{key:b.name,class:"border-b border-dotted"},[t("td",Te,m(b.name),1),(i(!0),c(g,null,x(e.months,D=>(i(),c("td",{key:D,class:"px-4 py-2"},m(l.getTestResultByMonth(b,D)),1))),128)),t("td",De,m(l.getTotalTestResults(b)),1)]))),128))],64))),128))])])])])])}const Qe=O(G,[["render",ke]]);export{Qe as default};
