import{_ as J}from"./Dzn3CqtN.js";import{d as W,r as E,a as X,a2 as Z,ag as ee,u as T,c as C,C as v,w as te,o as oe,y as P,b as a,e as l,f as m,h as o,g as t,t as f,ak as re,j as S,H as se,z as ne,F as x,k as R,K as q,i as ae,v as le,l as ce,m as ue,E as ie,_ as de,n as pe}from"./BO3L0kwf.js";import{_ as me}from"./DzNW1Vf5.js";import{_ as fe}from"./DPkVQ8oh.js";import{_ as _e,a as ye}from"./CBrpuzdQ.js";import{_ as ve}from"./Pf2MiR_y.js";import{_ as he}from"./CK7-8qTE.js";import{u as be}from"./SDvnuXqY.js";import{P as ge}from"./DSb1hqrV.js";import{u as xe}from"./BYRXL7y9.js";import{r as we}from"./Dmty_WBN.js";import{r as Re}from"./BJdcKMi-.js";import"./DnNgkCJc.js";import"./QUNJvIBY.js";const ke={class:"px-5 py-5"},$e={class:"flex justify-between items-center"},De={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Me={class:"w-72 ml-2"},Ye={class:"w-48"},Ee={class:"flex items-center space-x-3"},Te={class:"border rounded mt-10",id:"print-container"},Ce={class:"flex items-center justify-between px-5 py-5 border-b"},Oe={class:"m-3"},Se={class:"text-lg font-semibold mb-2"},qe={class:"text-normal font-normal"},je={key:0,class:"overflow-x-auto"},Be={class:"w-full rounded overflow-x-auto border-t border-b"},Pe={class:"w-full border-b"},Ae=["colspan"],Ve={class:"bg-gray-50"},Fe={class:"px-2 py-2 border-r capitalize"},Le=["onClick"],Ne={class:"bg-gray-50 border-b"},Ue={key:0,class:"border-t bg-gray-100 border-b"},Ge={class:"w-full items-center flex flex-col space-y-2 my-10"},ze={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},He="TB Report",ut=W({__name:"tb-tests",setup(Ie){xe({title:`${ge.name.toUpperCase()} - TB Tests Reports`});const A=E([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),u=E([]),_=E(!1),p=E({months:new Array,data:new Array}),O=be(),V=X("token"),k=Z(),h=ee(),{$toast:F}=T(),L=()=>{u.value=new Array("","")},N=(s,e)=>{let n=0;return e.forEach(r=>{n+=r.month[s]?r.month[s].count:0}),n},j=s=>s.sort((e,n)=>{const r=[],i=new Date;for(let d=0;d<12;d++)i.setMonth(d),r.push(i.toLocaleString("default",{month:"long"}));return r.indexOf(e)-r.indexOf(n)}),U=C(()=>{const s=[];return Object.keys(p.value.data).length>0&&Object.entries(p.value.data).forEach(([e,n])=>{n.forEach(r=>{const i={TEST:e,RESULT:r.result,...j(Object.keys(r.month)).reduce((d,$)=>{const D=r.month[$]?r.month[$].count:0;return d[$.toUpperCase()]=D??0,d},{})};s.push(i)})}),s}),G=(s,e)=>{let n=1,r=1;Object.keys(e)[0].toString().toLowerCase().includes("+")&&e[Object.keys(e)[0]].forEach(d=>{r+=d.month[s]?d.month[s]:0});let i=0;return e.forEach(d=>{i+=d.month[s]?d.month[s].count:0}),i>0?n=r/i*100:n=0,Math.floor(n)},b=C(()=>u.value[0]?v(u.value[0]).format("YYYY-MM-DD"):""),g=C(()=>u.value[1]?v(u.value[1]).format("YYYY-MM-DD"):"");async function B(){_.value=!0;let s=`from=${b.value}&to=${g.value}&report_id=${h.query.report_id}`;const e={route:`${ce.aggregateReports}tb_tests?${s}`,method:"GET",token:`${V.value}`},{data:n,error:r,pending:i}=await ue(e);_.value=i,n.value&&(_.value=!1,p.value=n.value,z(n.value.report_id),Object.keys(p.value.data).length>0?T().$toast.success("Report data generated successfully"):T().$toast.warning(`No data found in period ${b.value} - ${g.value}`)),r.value&&(_.value=!1,console.error(r.value),T().$toast.success(ie))}const z=s=>{const n={...k.currentRoute.value.query,report_id:s};k.replace({query:n}).catch(r=>{console.error("Failed to replace route:",r)})},H=(s,e,n,r)=>{n!==0&&r!==""?k.push(`/reports/${r}?origin=aggregate&type=tb-tests-report&from=${b.value}&to=${g.value}&test=${s} - ${e}&department=&count=${n}`):F.warning("No data found for this month")};te(u,()=>{const s=u.value[0]?v(u.value[0]).format("YYYY-MM-DD"):"",e=u.value[1]?v(u.value[1]).format("YYYY-MM-DD"):"";if(s||e){const r={...k.currentRoute.value.query,report_id:"",...s&&{from:s},...e&&{to:e}};k.replace({query:r}).catch(i=>{console.error("Failed to replace route:",i)})}},{deep:!0});const I=C(()=>h.query.to!==void 0&&h.query.from!==void 0?(u.value=[h.query.from,h.query.to],h.query.to!==""&&h.query.from!==""):!1);return oe(()=>{I.value&&B()}),(s,e)=>{const n=J,r=P("datepicker"),i=de,d=me,$=fe,D=P("excel"),Q=ye,K=pe;return a(),l("div",ke,[m(n,{pages:o(A)},null,8,["pages"]),t("div",{class:"flex items-center py-5"},[e[2]||(e[2]=t("img",{src:ve,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),t("h3",{class:"text-2xl font-semibold uppercase"},f(He))]),t("div",$e,[t("form",{onSubmit:e[1]||(e[1]=re(w=>B(),["prevent"])),class:"w-full flex items-center space-x-3"},[t("div",De,[m(o(we),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=S(" Filter By Date Range ")),t("div",Me,[m(r,{onCleared:L,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:o(u),"onUpdate:modelValue":e[0]||(e[0]=w=>se(u)?u.value=w:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),t("div",Ye,[m(i,{type:"submit",color:"primary",text:"Generate Report",icon:o(Re),click:()=>{},loading:o(_)},null,8,["icon","loading"])])],32),t("div",Ee,[m(d,{printSmallLabel:!1}),m(D,{class:"btn btn-default",header:["TB TESTS LABORATORY REPORT",`PERIOD FROM ${o(v)(o(b)).format("DD-MM-yyyy")} TO ${o(v)(o(g)).format("DD-MM-yyyy")}`,o(O).details.name,o(O).details.address,o(O).details.phone],data:o(U),worksheet:"report-work-sheet",name:`tb_tests_report_from_${o(b)}_to_${o(g)}.xls`},{default:ne(()=>[m($,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",Te,[t("div",Ce,[e[4]||(e[4]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:he,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"},"TB TESTS REPORT")],-1)),m(Q)]),t("div",Oe,[t("h3",Se,[e[5]||(e[5]=S(" Tests Performed Period: ")),t("span",qe,f(o(b)!=""?o(v)(o(b)).format("DD/MM/YYYY"):"")+" - "+f(o(g)!=""?o(v)(o(g)).format("DD/MM/YYYY"):""),1)])]),o(_)?q("",!0):(a(),l("div",je,[t("table",Be,[(a(!0),l(x,null,R(o(p).data,(w,Y)=>(a(),l(x,{key:Y},[t("thead",Pe,[t("tr",null,[t("th",{colspan:o(p).months.length+1,class:"uppercase text-center py-2 border-b"},f(Y),9,Ae)]),t("tr",Ve,[e[6]||(e[6]=t("th",{class:"px-2 py-2 border-r uppercase"},"Result",-1)),(a(!0),l(x,null,R(o(p).months,(c,M)=>(a(),l("th",{class:"px-2 py-2 border-r",key:M},f(c.toString().toUpperCase()),1))),128))])]),t("tbody",null,[(a(!0),l(x,null,R(w,(c,M)=>(a(),l("tr",{class:"border-b",key:M},[t("td",Fe,f(c.result),1),(a(!0),l(x,null,R(o(p).months,y=>(a(),l("td",{key:y,class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:Qe=>H(`${Y} - ${c.result}`,y,c.month[y]?c.month[y].count:0,c.month[y]?c.month[y].associated_ids:"")},f(c.month[y]?c.month[y].count:0),9,Le))),128))]))),128)),t("tr",Ne,[e[7]||(e[7]=t("td",{class:"px-2 py-2 border-r font-semibold uppercase"}," Total Examined ",-1)),(a(!0),l(x,null,R(j(o(p).months),c=>(a(),l("td",{key:c,class:"px-2 py-2 border-r"},f(N(c,w)),1))),128))]),Y.toString().toLowerCase()=="smear microscopy result"?(a(),l("tr",Ue,[e[8]||(e[8]=t("td",{class:"px-2 py-2 border-r font-semibold uppercase"}," Pick Up Rate ",-1)),(a(!0),l(x,null,R(o(p).months,(c,M)=>(a(),l("td",{key:M,class:"px-2 py-2 border-r"},f(G(c,w))+"% ",1))),128))])):q("",!0)])],64))),128))])])),ae(t("div",Ge,[m(K),e[9]||(e[9]=t("p",null,[S(" Generating report, please wait"),t("span",{class:"animate-pulse"},"...")],-1))],512),[[le,o(_)]]),o(p).data.length==0&&!o(_)?(a(),l("div",ze,e[10]||(e[10]=[t("img",{src:_e,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),t("p",null,"Data not found, please generate report",-1)]))):q("",!0)])])}}});export{ut as default};
