import{_ as _e}from"./CRuJk1iG.js";import{b as A,e as U,g as e,d as X,r as f,c as ne,z as N,w as E,o as he,x as F,f as s,h as a,A as O,F as ge,k as ye,t as S,a as Y,u as B,y as m,Y as J,p as j,G as W,V as Q,j as z,q as ee,S as te,l as q,m as L,E as T,_ as H,a1 as xe,X as be,s as ce,i as Z,v as G,n as we,a2 as Ce,J as Ve,R as ke,a3 as $e,L as Pe,H as ie,D as re}from"./DbJ6VTtH.js";import{_ as me}from"./D8VEAQZN.js";import{r as ue}from"./CkbGasXy.js";import{r as K}from"./CmdrOBJL.js";import{r as De}from"./BsPboDhg.js";import{r as pe}from"./BeZ38TKU.js";import{r as Fe}from"./WqemdFV2.js";import{r as fe}from"./CWZZ6cqw.js";import{_ as Ae}from"./KXgxOgRx.js";import{u as de}from"./BpcCxOZ6.js";import{P as Ie}from"./BJRIIcKh.js";import{u as Me}from"./BoB3wlvU.js";import{r as Be}from"./CkQvy5WJ.js";import{r as Ue}from"./Czt4tGcA.js";import{r as Oe}from"./nNMAiyHf.js";import"./CCijkVrC.js";import"./DXbs9UP2.js";function Se(l,n){return A(),U("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm4.28 10.28a.75.75 0 0 0 0-1.06l-3-3a.75.75 0 1 0-1.06 1.06l1.72 1.72H8.25a.75.75 0 0 0 0 1.5h5.69l-1.72 1.72a.75.75 0 1 0 1.06 1.06l3-3Z","clip-rule":"evenodd"})])}function Ne(l,n){return A(),U("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M4.5 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0ZM14.25 8.625a3.375 3.375 0 1 1 6.75 0 3.375 3.375 0 0 1-6.75 0ZM1.5 19.125a7.125 7.125 0 0 1 14.25 0v.003l-.001.119a.75.75 0 0 1-.363.63 13.067 13.067 0 0 1-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 0 1-.364-.63l-.001-.122ZM17.25 19.128l-.001.144a2.25 2.25 0 0 1-.233.96 10.088 10.088 0 0 0 5.06-1.01.75.75 0 0 0 .42-.643 4.875 4.875 0 0 0-6.957-4.611 8.586 8.586 0 0 1 1.71 5.157v.003Z"})])}const je={class:"w-full flex flex-col space-y-2"},qe={class:""},Le=["checked","onChange"],ve=X({__name:"AgeInput",props:{dateOfBirth:{default:void 0}},emits:["update:modelValue","update:dateOfBirth"],setup(l,{expose:n,emit:b}){const v=l,t=b,p=[{id:"years",label:"Years"},{id:"months",label:"Months"},{id:"weeks",label:"Weeks"},{id:"days",label:"Days"}],V={years:120,months:1440,weeks:6240,days:43800},i=f("days"),d=f(0),y=f(!1),x=ne(()=>`required|min:0|max:${V[i.value]}`),u=ne(()=>`Estimated ${i.value}`),h=ne(()=>!d.value||d.value===0?"":N().subtract(d.value,i.value).format("YYYY-MM-DD")),g=(w,P,M)=>{const D=N().subtract(w,P);return N().diff(D,M)},_=w=>{if(d.value){const P=g(d.value,i.value,w);i.value=w,d.value=P}else i.value=w},$=(w,P)=>{const M=N(w,"YYYY-MM-DD");d.value=N().diff(M,P)},I=()=>{d.value=0,i.value="days"};return E(d,()=>{!y.value&&d.value!==void 0&&(y.value=!0,t("update:dateOfBirth",h.value),y.value=!1)}),E(()=>v.dateOfBirth,w=>{w&&!y.value&&$(w,i.value)}),he(()=>{v.dateOfBirth&&$(v.dateOfBirth,i.value)}),n({reset:I}),(w,P)=>{const M=F("FormKit");return A(),U("div",je,[s(M,{label:a(u),type:"number",validation:a(x),modelValue:a(d),"onUpdate:modelValue":P[0]||(P[0]=D=>O(d)?d.value=D:null),"validation-messages":{min:"Age cannot be negative",max:`Age cannot exceed ${V[a(i)]} ${a(i)}`}},null,8,["label","validation","modelValue","validation-messages"]),e("div",qe,[(A(),U(ge,null,ye(p,D=>e("label",{key:D.id,class:"flex items-center space-x-2"},[e("input",{type:"radio",checked:a(i)===D.id,onChange:R=>_(D.id),name:"ageUnit",class:"form-radio"},null,40,Le),e("span",null,S(D.label),1)])),64))])])}}}),ae="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M25.1716%208.17157C26.0154%207.32777%2027.1424%206.93977%2028.2466%207.00756C27.631%205.25582%2025.9622%204%2024%204C21.5147%204%2019.5%206.01472%2019.5%208.5C19.5%2010.9853%2021.5147%2013%2024%2013C24.1751%2013%2024.348%2012.99%2024.5179%2012.9705C23.6533%2011.4448%2023.8712%209.47191%2025.1716%208.17157Z'%20fill='%23333333'/%3e%3cpath%20d='M13.8493%2017.0002C15.0941%2015.7409%2016.8649%2015%2018.9884%2015H29.1716L26.5858%2012.4142C25.8047%2011.6332%2025.8047%2010.3668%2026.5858%209.58579C27.3668%208.80474%2028.6332%208.80474%2029.4142%209.58579L35.4142%2015.5858C35.9862%2016.1578%2036.1573%2017.018%2035.8478%2017.7654C35.5382%2018.5127%2034.8089%2019%2034%2019H30V42C30%2043.0722%2029.1544%2043.9537%2028.0831%2043.9983C27.0118%2044.0428%2026.096%2043.2346%2026.0069%2042.1661L25.1597%2032H22.8403L21.9931%2042.1661C21.904%2043.2346%2020.9882%2044.0428%2019.9169%2043.9983C18.8456%2043.9537%2018%2043.0722%2018%2042V30H21C23.2091%2030%2025%2028.2091%2025%2026C25%2023.7909%2023.2091%2022%2021%2022H18V19.1088C17.3996%2019.2527%2016.9805%2019.5224%2016.694%2019.8123C16.2492%2020.2622%2016.0063%2020.879%2016.0001%2021.5192C15.994%2022.158%2016.2233%2022.758%2016.6498%2023.1924C17.0565%2023.6064%2017.7714%2024%2018.9884%2024H20.9913C22.0959%2024%2022.9913%2024.8954%2022.9913%2026C22.9913%2027.1046%2022.0959%2028%2020.9913%2028H18.9893C16.8375%2028%2015.0466%2027.2686%2013.796%2025.9951C12.5652%2024.742%2011.9848%2023.092%2012.0003%2021.4808C12.0158%2019.871%2012.6259%2018.2378%2013.8493%2017.0002Z'%20fill='%23333333'/%3e%3c/svg%3e",Te={class:"fixed inset-0 overflow-y-auto"},Ee={class:"flex min-h-full items-center justify-center p-4 text-center"},Re={class:"border-b px-3 py-3 flex items-center justify-between"},Ye={class:"mt-2 space-y-3 px-5 py-5"},ze={class:"w-full grid grid-cols-3 gap-2"},He={class:"grid grid-cols-2 gap-2"},Ze={class:"w-full flex flex-col space-y-2"},Ge={class:"w-full"},Ke={class:"w-full grid grid-cols-2 gap-2"},Xe={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Je=X({__name:"index",props:{openForm:{type:Boolean},defaultData:{}},emits:["onPatientCreated","sethandleDialog"],setup(l,{emit:n}){const b=n,v=f(!1),t=f(!1),p=Y("token"),V=B().$toast,i=l,d=f(""),y=f(""),x=f(""),u=f(""),h=f(""),g=f(""),_=f(""),$=f(!1),I=f(null),w=()=>{v.value=!v.value,b("sethandleDialog",v.value)},P=r=>{_.value=new Date(String(r)).toString(),$.value=!0},M=()=>{var r;(r=I.value)==null||r.reset()},D=async()=>{t.value=!0;const r={route:q.clients,method:"POST",token:`${p.value}`,body:{client:{uuid:""},person:{first_name:y.value,middle_name:x.value,last_name:u.value,sex:h.value.charAt(0),date_of_birth:_.value,birth_date_estimated:$.value},client_identifiers:{current_village:"",current_district:"",current_traditional_authority:"",physical_address:g.value}}},{data:o,error:C,pending:k}=await L(r);t.value=k,o.value&&(V.success("Patient created successfully!"),w(),R(),b("onPatientCreated",!0),t.value=!1),C.value&&(console.error(C.value),V.error(T),t.value=!1)},R=()=>{var r;d.value="",y.value="",x.value="",u.value="",h.value="",g.value="",_.value="",$.value=!1,(r=I.value)==null||r.reset()};return E(()=>i.defaultData,r=>{r&&(d.value=r.uuid,y.value=r.firstName,u.value=r.lastName,h.value=r.gender.toUpperCase()=="M"?"Male":"Female")}),E(()=>i.openForm,r=>{v.value=r}),(r,o)=>{const C=F("FormKit"),k=F("datepicker"),se=ve,le=me,oe=H;return A(),U("div",null,[s(a(te),{appear:"",show:a(v),as:"template"},{default:m(()=>[s(a(J),{as:"div",onClose:w,class:"relative z-10"},{default:m(()=>[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>o[6]||(o[6]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Te,[e("div",Ee,[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[s(a(W),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:m(()=>[e("div",Re,[s(a(Q),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:m(()=>o[7]||(o[7]=[e("img",{src:ae,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),z(" Create patient ")])),_:1}),e("button",{onClick:w},[s(a(ee),{class:"w-5 h-5"})])]),s(C,{type:"form",id:"patientForm","submit-label":"Update",onSubmit:D,actions:!1},{default:m(({})=>[e("div",Ye,[e("div",ze,[s(C,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:a(y),"onUpdate:modelValue":o[0]||(o[0]=c=>O(y)?y.value=c:null)},null,8,["modelValue"]),s(C,{type:"text",label:"Middle name",modelValue:a(x),"onUpdate:modelValue":o[1]||(o[1]=c=>O(x)?x.value=c:null)},null,8,["modelValue"]),s(C,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:a(u),"onUpdate:modelValue":o[2]||(o[2]=c=>O(u)?u.value=c:null)},null,8,["modelValue"])]),e("div",He,[e("div",Ze,[o[8]||(o[8]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Ge,[s(k,{placeholder:"Click to select a date",modelValue:a(_),"onUpdate:modelValue":o[3]||(o[3]=c=>O(_)?_.value=c:null),range:!1,"max-date":new Date,onCleared:M,"ignore-time-validation":!0,teleport:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",required:""},null,8,["modelValue","max-date"])])]),s(se,{"onUpdate:dateOfBirth":P})]),e("div",Ke,[s(C,{modelValue:a(h),"onUpdate:modelValue":o[4]||(o[4]=c=>O(h)?h.value=c:null),type:"radio",label:"Sex",options:["Male","Female"],validation:"required"},null,8,["modelValue"]),s(C,{type:"text",label:"Physical Address",validation:"required",modelValue:a(g),"onUpdate:modelValue":o[5]||(o[5]=c=>O(g)?g.value=c:null)},null,8,["modelValue"])])]),e("div",Xe,[s(le,{type:"button",click:R,text:"Clear form"}),s(oe,{type:"submit",click:()=>{},color:"success",icon:a(ue),text:"Save changes",loading:a(t)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),We={class:"fixed inset-0 overflow-y-auto"},Qe={class:"flex min-h-full items-center justify-center p-4 text-center"},et={class:"border-b px-3 py-3 flex items-center justify-between"},tt={class:"mt-2 space-y-3 px-5 py-5"},at={class:"w-full grid grid-cols-2 gap-2"},st={class:"items-center"},lt={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},ot=X({__name:"index",emits:["action-completed"],setup(l,{emit:n}){const b=n,v=f(!1),t=f(!1),p=Y("token"),{$toast:V}=B(),i=f({firstName:"",lastName:"",gender:""}),d=()=>v.value=!v.value,y=async()=>{t.value=!0;const x={route:be(q.client.search,{first_name:i.value.firstName,last_name:i.value.lastName,gender:i.value.gender}),method:"GET",token:`${p.value}`},{data:u,error:h,pending:g}=await L(x);t.value=g,u.value&&(d(),b("action-completed",{patient:u.value,defaults:i.value}),i.value={firstName:"",lastName:"",gender:""}),h.value&&V.error(`${T}`),t.value=v.value=!1};return(x,u)=>{const h=H,g=F("FormKit");return A(),U("div",null,[e("div",null,[s(h,{text:"Find/Create Patient",color:"primary",icon:a(K),click:d},null,8,["icon"])]),s(a(te),{appear:"",show:a(v),as:"template"},{default:m(()=>[s(a(J),{as:"div",onClose:d,class:"relative z-10"},{default:m(()=>[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>u[3]||(u[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",We,[e("div",Qe,[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[s(a(W),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:m(()=>[e("div",et,[s(a(Q),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:m(()=>u[4]||(u[4]=[e("img",{src:ae,class:"w-8 h-8 mr-2"},null,-1),z(" "+S("Find or Create patient"))])),_:1}),e("button",{onClick:d},[s(a(ee),{class:"w-5 h-5"})])]),s(g,{type:"form",onSubmit:y,actions:!1},{default:m(({})=>[e("div",tt,[e("div",at,[s(g,{type:"text",label:"First name",validation:"required",modelValue:a(i).firstName,"onUpdate:modelValue":u[0]||(u[0]=_=>a(i).firstName=_)},null,8,["modelValue"]),s(g,{type:"text",label:"Last name",validation:"required",modelValue:a(i).lastName,"onUpdate:modelValue":u[1]||(u[1]=_=>a(i).lastName=_)},null,8,["modelValue"])]),e("div",st,[s(g,{modelValue:a(i).gender,"onUpdate:modelValue":u[2]||(u[2]=_=>a(i).gender=_),type:"radio",label:"Gender",options:"sex"in x?x.sex:a(xe),validation:"required"},null,8,["modelValue","options"])])]),e("div",lt,[s(h,{type:"submit",click:()=>{},color:"success",icon:a(Se),text:"Find",loading:a(t)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),nt={components:{TransitionRoot:te,TransitionChild:j,Dialog:J,DialogPanel:W,DialogTitle:Q,XMarkIcon:ee,UserIcon:De},props:{data:{required:!0,type:Object}},data(){return{details:new Object,open:!1,addIcon:K,viewIcon:pe,saveIcon:ue,clearIcon:Fe,cookie:Y("token"),loading:!1}},methods:{async init(){this.adjustVisibility(),this.loading=!0;const l={route:`${q.clients}/${this.data.client_id}`,method:"GET",token:`${this.cookie}`},{data:n,pending:b,error:v}=await L(l);n.value&&(this.details=n.value,this.loading=!1),v.value&&(console.log(v.value),B().$toast.error(T))},adjustVisibility(){this.open=!this.open}}},it={class:"fixed inset-0 overflow-y-auto"},rt={class:"flex min-h-full items-center justify-center p-4 text-center"},dt={class:"border-b px-3 py-3 flex items-center justify-between"},ut={class:"flex items-center justify-center mx-auto my-20"},ct={class:"mt-2 space-y-3 px-5 py-5"},mt={class:"w-full flex flex-col space-y-1"},pt={class:"underline"},ft={class:"w-full flex flex-col space-y-1"},vt={class:"underline"},_t={class:"w-full flex flex-col space-y-1"},ht={class:"underline"},gt={class:"w-full flex flex-col space-y-1"},yt={class:"underline"},xt={class:"w-full flex flex-col space-y-1"},bt={class:"underline"};function wt(l,n,b,v,t,p){const V=H,i=F("TransitionChild"),d=F("DialogTitle"),y=F("XMarkIcon"),x=we,u=F("DialogPanel"),h=F("Dialog"),g=F("TransitionRoot");return A(),U("div",null,[e("div",null,[s(V,{text:"View",color:"success",icon:t.viewIcon,click:p.init},null,8,["icon","click"])]),s(g,{appear:"",show:t.open,as:"template"},{default:m(()=>[s(h,{as:"div",onClose:p.adjustVisibility,class:"relative z-10"},{default:m(()=>[s(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>n[1]||(n[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",it,[e("div",rt,[s(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[s(u,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:m(()=>[e("div",dt,[s(d,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:m(()=>n[2]||(n[2]=[e("img",{src:ae,class:"w-8 h-8 mr-2"},null,-1),z(" View patient ")])),_:1}),e("button",{onClick:n[0]||(n[0]=(..._)=>p.adjustVisibility&&p.adjustVisibility(..._))},[s(y,{class:"w-5 h-5"})])]),Z(e("div",ut,[s(x,{loading:t.loading},null,8,["loading"])],512),[[G,t.loading]]),Z(e("div",ct,[e("div",mt,[n[3]||(n[3]=e("label",{class:"font-semibold text-lg"},"Name",-1)),e("p",pt,S(`${t.details.first_name} ${t.details.last_name}`),1)]),e("div",ft,[n[4]||(n[4]=e("label",{class:"font-semibold text-lg"},"National Patient ID",-1)),e("p",vt,S(t.details.npid),1)]),e("div",_t,[n[5]||(n[5]=e("label",{class:"font-semibold text-lg"},"Date Of Birth",-1)),e("p",ht,S(t.details.date_of_birth),1)]),e("div",gt,[n[6]||(n[6]=e("label",{class:"font-semibold text-lg"},"Sex",-1)),e("p",yt,S(t.details.sex),1)]),e("div",xt,[n[7]||(n[7]=e("label",{class:"font-semibold text-lg"},"Physical Address",-1)),e("p",bt,S(t.details.physical_address),1)])],512),[[G,!t.loading]])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Ct=ce(nt,[["render",wt]]),Vt={class:"fixed inset-0 overflow-y-auto"},kt={class:"flex min-h-full items-center justify-center p-4 text-center"},$t={class:"border-b px-3 py-3 flex items-center justify-between"},Pt={class:"mt-2 space-y-3 px-5 py-5"},Dt={class:"w-full grid grid-cols-2 gap-2"},Ft={class:"w-full grid grid-cols-3 gap-2"},At={class:"grid grid-cols-2 gap-2"},It={class:"w-full flex flex-col space-y-2"},Mt={class:"w-full"},Bt={class:"w-full grid grid-cols-2 gap-2"},Ut={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Ot=X({__name:"index",props:{data:{required:!0,type:Object}},emits:["update"],setup(l,{emit:n}){const b=l,v=n,t=f({uuid:"",npid:"",first_name:"",middle_name:"",last_name:"",date_of_birth:"",gender:"",physical_address:"",value:void 0,id:0,client_id:0,sex:"",phone:"",birth_date_estimated:!1}),p=f(!1),V=ue,i=fe,d=f(!1),y=Y("token"),x=f(!1),u=f(!1),h=f(!1),g=f(""),_=f(""),$=f(null),I=()=>{p.value=!p.value},w=r=>{t.value.birth_date_estimated=!0,h.value=!0},P=()=>{var r;g.value="",h.value=!1,(r=$.value)==null||r.reset()},M=()=>{var r;(r=$.value)==null||r.reset()},D=async()=>{const r={route:`${q.clients}/${b.data.client_id}`,method:"GET",token:`${y.value}`},{data:o,error:C}=await L(r);o.value&&(t.value=o.value,_.value=o.value.gender=="M"?"Male":"Female",I()),C.value&&(console.error(C.value),B().$toast.error(T))},R=async()=>{d.value=!0;const r={route:`${q.clients}/${b.data.client_id}`,method:"PUT",token:`${y.value}`,body:{client:{uuid:t.value.uuid},person:{first_name:t.value.first_name,middle_name:t.value.middle_name,last_name:t.value.last_name,sex:_.value.charAt(0),date_of_birth:t.value.date_of_birth,birth_date_estimated:h.value},client_identifiers:[{type:"physical_address",value:t.value.physical_address},{type:"phone",value:t.value.phone},{type:"npid",value:t.value.npid}]}},{data:o,error:C,pending:k}=await L(r);d.value=k,o.value&&(d.value=!1,Object.assign(t,{}),B().$toast.success("Patient updated successfully!"),I(),v("update",!0)),C.value&&(d.value=!1,console.error(C.value),B().$toast.error(T))};return E(()=>t.value.date_of_birth,r=>{!u.value&&r&&(x.value=!0,t.value.age=Number(Ce(r)),x.value=!1)}),E(()=>t.value.age,(r,o)=>{r!==o&&r!=null&&!x.value&&!t.value.date_of_birth&&(u.value=!0,t.value.date_of_birth=N().subtract(r,"years").format("YYYY-MM-DD"),u.value=!1,h.value=!0)}),(r,o)=>{const C=H,k=F("FormKit"),se=F("datepicker"),le=ve,oe=me;return A(),U("div",null,[e("div",null,[s(C,{text:"Edit",color:"primary",icon:a(i),click:D},null,8,["icon"])]),s(a(te),{appear:"",show:a(p),as:"template"},{default:m(()=>[s(a(J),{as:"div",onClose:I,class:"relative z-10"},{default:m(()=>[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>o[9]||(o[9]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Vt,[e("div",kt,[s(a(j),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[s(a(W),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:m(()=>[e("div",$t,[s(a(Q),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:m(()=>o[10]||(o[10]=[e("img",{src:ae,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),z(" Edit patient ")])),_:1}),e("button",{onClick:I},[s(a(ee),{class:"w-5 h-5"})])]),s(k,{type:"form",id:"editPatientForm","submit-label":"Update",onSubmit:R,actions:!1},{default:m(()=>[e("div",Pt,[e("div",Dt,[s(k,{type:"text",label:"Patient ID",modelValue:a(t).uuid,"onUpdate:modelValue":o[0]||(o[0]=c=>a(t).uuid=c)},null,8,["modelValue"]),s(k,{type:"text",label:"National Patient ID",modelValue:a(t).npid,"onUpdate:modelValue":o[1]||(o[1]=c=>a(t).npid=c)},null,8,["modelValue"])]),e("div",Ft,[s(k,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:a(t).first_name,"onUpdate:modelValue":o[2]||(o[2]=c=>a(t).first_name=c)},null,8,["modelValue"]),s(k,{type:"text",label:"Middle name",modelValue:a(t).middle_name,"onUpdate:modelValue":o[3]||(o[3]=c=>a(t).middle_name=c)},null,8,["modelValue"]),s(k,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:a(t).last_name,"onUpdate:modelValue":o[4]||(o[4]=c=>a(t).last_name=c)},null,8,["modelValue"])]),e("div",At,[e("div",It,[o[11]||(o[11]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Mt,[s(se,{placeholder:"Click to select a date",modelValue:a(t).date_of_birth,"onUpdate:modelValue":o[5]||(o[5]=c=>a(t).date_of_birth=c),range:!1,"max-date":new Date,onCleared:M,"ignore-time-validation":!0,teleport:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",required:""},null,8,["modelValue","max-date"])])]),s(le,{dateOfBirth:a(t).date_of_birth,"onUpdate:dateOfBirth":[o[6]||(o[6]=c=>a(t).date_of_birth=c),w]},null,8,["dateOfBirth"])]),e("div",Bt,[s(k,{modelValue:a(_),"onUpdate:modelValue":o[7]||(o[7]=c=>O(_)?_.value=c:null),type:"radio",label:"Sex",options:["Male","Female"],validation:"required"},null,8,["modelValue"]),s(k,{type:"text",label:"Physical Address",validation:"required",modelValue:a(t).physical_address,"onUpdate:modelValue":o[8]||(o[8]=c=>a(t).physical_address=c)},null,8,["modelValue"])])]),e("div",Ut,[s(oe,{type:"button",click:P,text:"Clear form"}),s(C,{type:"submit",click:()=>{},color:"success",icon:a(V),text:"Save changes",loading:a(d)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),St={components:{UsersIcon:Ne,PlusIcon:K,MagnifyingGlassIcon:Be},setup(){Me({title:`${Ie.name.toUpperCase()} - Patients`})},data(){return{loading:!1,openCreatePatientForm:!1,newIcon:Ue,defaultData:{},editIcon:fe,viewIcon:pe,refreshIcon:Oe,headers:new Array({text:"patient no",value:"client_id",sortable:!0},{text:"name",value:"name",sortable:!0},{text:"sex",value:"sex",sortable:!0},{text:"date of birth",value:"date_of_birth",sortable:!0},{text:"physical address",value:"physical_address",sortable:!0},{text:"actions",value:"actions"}),pages:[{name:"Home",link:"/home"}],data:{},addIcon:K,patients:new Array,cookie:Y("token"),serverItemsLength:0,serverOptions:{page:1,rowsPerPage:25,sortBy:"name"},searchField:"name",search:"",searchValue:"",createPatient:!1,showSearch:!1}},created(){this.init()},methods:{updateSearch(l){this.searchValue=l,this.search=l,this.updatePatients(!0)},async init(){this.createPatient=!1,this.defaultData={firstName:"",lastName:"",middleName:"",gender:""},this.loading=!0;const{page:l,rowsPerPage:n}=this.serverOptions,b=Ve(),v=ke(b.locations,b.selectedLocation),t={route:`${q.clients}?page=${l}&per_page=${n}&search=${this.search}&lab_location=${v}`,method:"GET",token:`${this.cookie}`};let{data:p,error:V,pending:i}=await L(t);this.loading=i,p.value&&(this.patients=p.value.clients,this.serverItemsLength=p.value.meta.total_count),V.value&&(console.error(V.value.data),B().$toast.error(`${T}`))},updatePatients(l){typeof l=="object"&&(this.serverOptions=l),this.init()},async handleClick(l){this.data=l,l.source==="remote"&&await this.handleSaveRemotePatient(this.data),this.$router.push(`/tests/new-test?patient_id=${l.client_id}`)},async handleSaveRemotePatient(l){const n={route:q.clients,method:"POST",token:this.cookie,body:{client:{uuid:l.uuid},person:{first_name:l.first_name,middle_name:l.middle_name,last_name:l.last_name,sex:l.sex,date_of_birth:l.date_of_birth,birth_date_estimated:!1},client_identifiers:{current_village:l.current_village,current_district:l.current_district,current_traditional_authority:l.current_traditional_authority,physical_address:`${l.home_village} ${l.home_traditional_authority} ${l.home_district}`,npid:l.npid}}},{data:b,error:v,pending:t}=await L(n);b.value&&(this.data=b.value),v.value&&B().$toast.error(`${T}`)},handleActionCompleted(l){l.patient.length>0?(this.createPatient=!0,this.patients=l.patient,this.serverItemsLength=l.patient.length,this.showSearch=!0):(B().$toast.warning("Patient not found"),this.openCreatePatientForm=!0,this.defaultData=l.defaults,this.showSearch=!1)},setCreatePatientFormVisibility(l){this.openCreatePatientForm=l}},computed:{filteredPatients(){return this.patients.map(l=>({...l,name:$e(`${l.first_name} ${l.middle_name!=null?l.middle_name:""} ${l.last_name}`),date_of_birth:N(l.date_of_birth).format(Pe)}))}}},Nt={class:"py-5 px-5"},jt={class:"flex justify-between items-center w-full py-2 mb-2"},qt={class:"flex items-center space-x-2"},Lt={class:"mb-2.5"},Tt={class:"text-lg font-medium"},Et={class:"py-2 flex items-center space-x-2"};function Rt(l,n,b,v,t,p){var g,_;const V=_e,i=H,d=Je,y=ot,x=Ct,u=Ot,h=Ae;return A(),U("div",Nt,[s(V,{pages:t.pages},null,8,["pages"]),n[1]||(n[1]=e("div",{class:"flex items-center space-x-2 py-5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[e("path",{fill:"currentColor",d:"M16 11a4 4 0 1 0 0-8a4 4 0 0 0 0 8m-6-3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0m19 0a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0M9.377 13a3.98 3.98 0 0 0-.877 2.5V23c0 1.235.298 2.4.827 3.427A5 5 0 0 1 2 22v-6.5A2.5 2.5 0 0 1 4.5 13zm13.296 13.427A7.5 7.5 0 0 0 23.5 23v-7.5c0-.946-.328-1.815-.877-2.5H27.5a2.5 2.5 0 0 1 2.5 2.5V22a5 5 0 0 1-7.327 4.427M12.5 13a2.5 2.5 0 0 0-2.5 2.5V23a6 6 0 0 0 12 0v-7.5a2.5 2.5 0 0 0-2.5-2.5z"})]),e("h3",{class:"text-2xl font-semibold uppercase"},"Patients")],-1)),e("div",jt,[e("div",qt,[s(i,{color:"warning",icon:t.refreshIcon,text:"Refresh",click:()=>{p.init()}},null,8,["icon","click"]),Z(s(i,{click:()=>{t.openCreatePatientForm=!0},text:"Create a new patient",color:"success",icon:t.addIcon},null,8,["click","icon"]),[[G,t.createPatient]])]),("usePermissions"in l?l.usePermissions:a(de))().can.manage("patients")?(A(),ie(d,{key:0,openForm:t.openCreatePatientForm,onSethandleDialog:p.setCreatePatientFormVisibility,onOnPatientCreated:p.updatePatients,"default-data":t.defaultData},null,8,["openForm","onSethandleDialog","onOnPatientCreated","default-data"])):re("",!0),("usePermissions"in l?l.usePermissions:a(de))().can.manage("patients")?(A(),ie(y,{key:1,onActionCompleted:p.handleActionCompleted},null,8,["onActionCompleted"])):re("",!0)]),Z(e("div",Lt,[n[0]||(n[0]=z(" Showing results for ")),e("span",Tt,S(`${(g=t.defaultData)==null?void 0:g.firstName} ${(_=t.defaultData)==null?void 0:_.lastName}`),1)],512),[[G,t.showSearch]]),("usePermissions"in l?l.usePermissions:a(de))().can.manage("patients")?(A(),ie(h,{key:0,headers:t.headers,data:p.filteredPatients,loading:t.loading,searchField:t.searchField,searchValue:t.searchValue,serverItemsLength:t.serverItemsLength,serverOptions:t.serverOptions,onUpdate:p.updatePatients},{actions:m(({item:$})=>[e("div",Et,[s(i,{click:()=>p.handleClick($),text:"New Test",color:"primary",icon:t.newIcon},null,8,["click","icon"]),s(x,{data:$},null,8,["data"]),s(u,{data:$,onUpdate:p.updatePatients},null,8,["data","onUpdate"])])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"])):re("",!0)])}const ra=ce(St,[["render",Rt]]);export{ra as default};
