import{_ as se}from"./CUGREwii.js";import{_ as ae}from"./D-ktHv4g.js";import{d as ne,r as M,au as Y,a as le,a5 as ce,ak as de,u as ie,c as $,C as f,w as j,o as ue,y as P,b as i,e as u,f as v,h as e,g as r,t as x,k as L,H as V,z as pe,O as A,F as k,j as C,K as B,l as me,E as _e,_ as fe}from"./JEpZiKDn.js";import{_ as ve}from"./DLaRdVyx.js";import{_ as ye}from"./jcukMvCQ.js";import{_ as he,a as be}from"./BuvA2s-D.js";import{u as Re,_ as ge}from"./Bj3uaHlm.js";import{u as xe}from"./Bl4Rx-lb.js";import{_ as Ee}from"./DRxg2Ufn.js";import{_ as Te}from"./DNbyhRT_.js";import{u as De}from"./DPv16rA3.js";import{P as we}from"./DObdreHM.js";import{r as Me}from"./BByxu38V.js";import{r as $e}from"./DpXPT2CW.js";import"./DGM4Jn_4.js";import"./Cd90EHgg.js";import"./BcRhypLO.js";import"./D9psU6J9.js";import"./BO5pWTJR.js";import"./DHOH29o0.js";import"./BhA5OI8I.js";import"./IQ2PmlzZ.js";import"./BcteEfoI.js";const ke={class:"px-5 py-5"},Ae=r("img",{src:Ee,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Ce={class:"w-full flex items-center justify-between"},qe={class:"flex items-center space-x-3"},Oe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Fe={class:"w-72 ml-2"},Se={class:"w-44"},Ye={class:"flex items-center space-x-3"},je={class:"border rounded mt-5"},Pe={class:"flex items-center justify-between px-5 py-5 border-b"},Le=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Te,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1),Ve={class:"mt-3 px-5"},Be={class:"text-lg font-semibold mb-2"},Ne={class:"text-normal font-normal"},Ge={key:0,class:"print-container",id:"print-container"},Ue={class:"w-full border border-dotted rounded overflow-x-auto"},He={class:"bg-gray-50 border-b border-dotted rounded-t"},Qe=r("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1),ze=r("th",{class:"border-r border-t border-b border-dotted px-2 py-2"},"TOTAL",-1),Ie={class:"border-r border-b border-dotted px-2 py-2"},Je=["onClick"],Ke={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},We={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Xe=r("img",{src:be,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Ze=r("p",{class:"text-base"},"Please generate report data to preview the report",-1),et=[Xe,Ze],tt="Rejected Samples Report",Mt=ne({__name:"rejected-samples",setup(ot){xe({title:`${we.name.toUpperCase()} - Rejected Samples Report`});const N=M([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),O=M([]),p=M({name:Y}),G=le("token"),q=De(),g=ce(),m=de(),{loading:y,executeCancellableRequest:U,cancelRequest:H}=Re(),c=M(["",""]),{$toast:w,$metadata:Q}=ie(),z=()=>{c.value=new Array("","")},h=M({results:[],value:void 0,wards:[]}),F=$(()=>h.value.results.map(o=>{const t={};o.test_types.forEach(s=>{const{name:a,ward:l,count:b,associated_ids:_}=s;t[a]||(t[a]={}),t[a][l]||(t[a][l]={count:0,associated_ids:""}),t[a][l].count+=b,t[a][l].associated_ids=_});const n=Object.keys(t).map(s=>({name:s,wards:t[s]}));return{name:o.name,testTypes:n}})),I=$(()=>{const o=[];return h.value.results.forEach(t=>{const n={},s={};t.test_types.forEach(a=>{const{name:l,ward:b,count:_}=a;n[l]||(n[l]={},s[l]=0),n[l][b]=_||0,s[l]+=_});for(const a in n){const l=n[a],b={TESTS:a};h.value.wards.forEach(_=>{b[_]=l[_]!==void 0?l[_]:0}),b.TOTAL=s[a],o.push(b)}}),o}),J=(o,t)=>{const n=F.value.find(a=>a.name===o),s=n==null?void 0:n.testTypes.find(a=>a.name===t);return s?Object.values(s.wards).reduce((a,l)=>a+l.count,0):0},E=$(()=>c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):""),T=$(()=>c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"");async function S(){if(K())w.warning("Please select a department");else{y.value=!0;const o={route:`${me.aggregateReports}rejected?from=${E.value}&to=${T.value}&department=${p.value.id}&report_id=${m.query.report_id}`,method:"GET",token:`${G.value}`},{data:t,error:n,pending:s}=await U(o);y.value=s,t.value&&(y.value=!1,h.value=t.value,W(t.value.report_id),t.value.results.length>0?w.success("Report generated successfully!"):w.warning("Data not found within the specified period")),n.value&&(console.error(n.value),y.value=!1,w.error(_e))}}const K=()=>p.value.name==Y,W=o=>{const n={...g.currentRoute.value.query,report_id:o};g.replace({query:n}).catch(s=>{console.error("Failed to replace route:",s)})},X=(o,t,n,s)=>{n!==0&&s!==""?g.push(`/reports/${s}?origin=aggregate&type=rejected-samples-report&from=${E.value}&to=${T.value}&test=${o} - ${t}&department=${p.value.name}&count=${n}`):w.warning("No data found for this month")};j(c,()=>{const o=c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):"",t=c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"";if(o||t){const s={...g.currentRoute.value.query,...o&&{from:o},...t&&{to:t}};g.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})}},{deep:!0}),j(p,(o,t)=>{if(o!==t){const s={...g.currentRoute.value.query,department:o.name||void 0,report_id:""};g.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})}});const Z=$(()=>m.query.to!==void 0&&m.query.from!==void 0&&m.query.department!==void 0?(c.value=[m.query.from,m.query.to],p.value.name=`${m.query.department}`,m.query.to!==""&&m.query.from!==""&&m.query.department!==""):!1);return ue(()=>{Z.value?S():y.value=!1,O.value=Q.departments}),(o,t)=>{const n=se,s=P("datepicker"),a=ae,l=fe,b=ve,_=ye,ee=P("excel"),te=he,oe=ge;return i(),u("div",ke,[v(n,{pages:e(N)},null,8,["pages"]),r("div",{class:"flex items-center py-5"},[Ae,r("h3",{class:"text-2xl font-semibold uppercase"},x(tt))]),r("div",Ce,[r("div",qe,[r("div",Oe,[v(e(Me),{class:"w-5 h-5 mr-2"}),L(" Filter By Date Range "),r("div",Fe,[v(s,{onCleared:z,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(c),"onUpdate:modelValue":t[0]||(t[0]=D=>V(c)?c.value=D:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),r("div",Se,[v(a,{items:e(O),modelValue:e(p),"onUpdate:modelValue":t[1]||(t[1]=D=>V(p)?p.value=D:null)},null,8,["items","modelValue"])]),v(l,{color:"primary",text:"Generate Report",icon:e($e),click:()=>S(),loading:e(y)},null,8,["icon","click","loading"])]),r("div",Ye,[v(b,{printSmallLabel:!1}),v(ee,{class:"btn btn-default",header:[`REJECTED ${e(p).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A))} TO ${e(f)(e(T)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A))}`,e(q).details.name,e(q).details.address,e(q).details.phone],data:e(I),worksheet:"report-work-sheet",name:`rejected_${e(p).name.toLowerCase().split(" ").join("_")}_report_${e(f)(e(E)).format("DD_MM_yyyy")}_to_${e(f)(e(T)).format("DD_MM_yyyy")}.xls`},{default:pe(()=>[v(_,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),r("div",je,[r("div",Pe,[Le,v(te)]),r("div",Ve,[r("h3",Be,[L(" Tests Performed Period: "),r("span",Ne,x(e(E)!=""?e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A)):"")+" - "+x(e(T)!=""?e(f)(e(T)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A)):""),1)])]),e(h).results.length>0&&!e(y)?(i(),u("div",Ge,[r("table",Ue,[(i(!0),u(k,null,C(e(F),(D,re)=>(i(),u(k,{key:re},[r("thead",He,[r("tr",null,[Qe,(i(!0),u(k,null,C(e(h).wards,d=>(i(),u("th",{key:d,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(d),1))),128)),ze])]),r("tbody",null,[(i(!0),u(k,null,C(D.testTypes,d=>(i(),u("tr",{key:d.name},[r("td",Ie,x(d.name),1),(i(!0),u(k,null,C(e(h).wards,R=>(i(),u("td",{key:R,onClick:rt=>X(d.name,R,d.wards[R]?d.wards[R].count:0,d.wards[R]?d.wards[R].associated_ids:""),class:"px-4 border-r border-b border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(d.wards[R]?d.wards[R].count:0),9,Je))),128)),r("td",Ke,x(J(D.name,d.name)),1)]))),128))])],64))),128))])])):B("",!0),v(oe,{condition:e(y),cancelReportGeneration:()=>e(H)()},null,8,["condition","cancelReportGeneration"]),e(h).wards.length==0&&e(h).results.length==0&&!e(y)?(i(),u("div",We,et)):B("",!0)])])}}});export{Mt as default};
