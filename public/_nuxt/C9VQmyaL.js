import{_ as Re}from"./Bz0K0IGU.js";import{d as J,a3 as Ae,af as De,c as q,r as i,a7 as Le,o as Q,w as Oe,a8 as me,a9 as qe,aa as Ie,ab as je,ac as Ue,ad as Me,F as he,ag as ve,b as M,e as P,g as o,u as Pe,a as ye,f as p,h as a,y as F,Y as Be,p as z,G as Ve,V as He,j as G,A as fe,k as ze,J as _e,t as V,S as Ge,m as K,l as Y,_ as Ke,M as Ye,ap as Je,al as Qe,z as D,aq as B,x as We,K as Xe}from"./Mfiulbk9.js";import{_ as Ze}from"./D5hPT3cm.js";import{u as ge}from"./2ZMSEcLs.js";import{r as et}from"./Blth7wSc.js";import{d as tt,p as at}from"./CYeo7YUF.js";import{s as lt}from"./Wqr38Kg4.js";import{r as st}from"./D40REQ-4.js";import{r as ot}from"./BtaVwlPI.js";import{_ as rt}from"./Br7vy9ES.js";import{_ as nt}from"./MEi_HMIO.js";import{u as it}from"./DVF6Pu2h.js";import{P as ut}from"./Cym2IAMG.js";import{u as ct}from"./hBIwNBsI.js";import"./CWIC1ZeM.js";import"./B-Vd1x1K.js";import"./DCmZ3cax.js";let dt=Symbol("GroupContext"),pt=J({name:"Switch",emits:{"update:modelValue":g=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:void 0},defaultChecked:{type:Boolean,optional:!0},form:{type:String,optional:!0},name:{type:String,optional:!0},value:{type:String,optional:!0},id:{type:String,default:null},disabled:{type:Boolean,default:!1},tabIndex:{type:Number,default:0}},inheritAttrs:!1,setup(g,{emit:n,attrs:v,slots:L,expose:E}){var I;let k=(I=g.id)!=null?I:`headlessui-switch-${Ae()}`,f=De(dt,null),[b,w]=tt(q(()=>g.modelValue),t=>n("update:modelValue",t),q(()=>g.defaultChecked));function x(){w(!b.value)}let j=i(null),S=f===null?j:f.switchRef,N=lt(q(()=>({as:g.as,type:v.type})),S);E({el:S,$el:S});function h(t){t.preventDefault(),x()}function y(t){t.key===ve.Space?(t.preventDefault(),x()):t.key===ve.Enter&&at(t.currentTarget)}function R(t){t.preventDefault()}let d=q(()=>{var t,r;return(r=(t=Le(S))==null?void 0:t.closest)==null?void 0:r.call(t,"form")});return Q(()=>{Oe([d],()=>{if(!d.value||g.defaultChecked===void 0)return;function t(){w(g.defaultChecked)}return d.value.addEventListener("reset",t),()=>{var r;(r=d.value)==null||r.removeEventListener("reset",t)}},{immediate:!0})}),()=>{let{name:t,value:r,form:T,tabIndex:A,...c}=g,U={checked:b.value},H={id:k,ref:S,role:"switch",type:N.value,tabIndex:A===-1?0:A,"aria-checked":b.value,"aria-labelledby":f==null?void 0:f.labelledby.value,"aria-describedby":f==null?void 0:f.describedby.value,onClick:h,onKeyup:y,onKeypress:R};return me(he,[t!=null&&b.value!=null?me(qe,Ie({features:je.Hidden,as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:b.value,form:T,disabled:c.disabled,name:t,value:r})):null,Ue({ourProps:H,theirProps:{...v,...Me(c,["modelValue","defaultChecked"])},slot:U,attrs:v,slots:L,name:"Switch"})])}}});function mt(g,n){return M(),P("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const vt={class:"fixed inset-0 overflow-hidden"},ft={class:"absolute inset-0 overflow-hidden"},_t={class:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10"},ht={class:"absolute left-0 top-0 -ml-8 flex pr-2 pt-4 sm:-ml-10 sm:pr-4"},yt={class:"flex h-full flex-col overflow-y-scroll bg-white py-3 shadow-xl"},gt={class:"border-b"},bt={class:"relative mt-6 flex-1 flex flex-col space-y-3"},xt={class:"px-5 flex flex-col space-y-3"},wt={classs:"flex flex-col items-center"},St={class:"absolute w-full border-t bottom-0 justify-end flex px-5 pt-3 items-center space-x-5"},Ct=J({__name:"filters",emits:["tableFields","filterFields","specimenFields","locationField","originField","onClearFilters"],setup(g,{emit:n}){const v=i(!1),{$toast:L}=Pe(),{getDisplayName:E}=ge(),I=()=>{v.value=!0},k=i([{label:"Show person who requested test",value:!1,property:"Requested by",table_value:"requested_by"},{label:"Show person who completed the test",value:!1,property:"Completed by",table_value:"completed"},{label:"Show test tracking numbers",value:!1,property:"tracking number",table_value:"tracking_number"},{label:"Show test result value",value:!1,property:"Test result",table_value:"result"},{label:"Show date of test result",value:!1,property:"Result date",table_value:"result_date"}]),f=i([]),b=i([]),w=i([]),x=i([]),j=q(()=>f.value.map(t=>E(t.name,t.preferred_name))),S=ye("token"),N=n,h=()=>{const t=k.value.filter(r=>r.value);N("tableFields",t),N("specimenFields",w.value.join(",")),N("locationField",x.value.join(",")),v.value=!1,L.success("Filters applied successfully")},y=()=>{v.value=!1,k.value=k.value.map(t=>({...t,value:!1})),w.value=[],x.value=[],N("onClearFilters",k.value),L.success("Filters reset successfully")},R=async()=>{const{data:t,error:r,pending:T}=await K({route:Y.specimens,method:"GET",token:`${S.value}`});t&&(f.value=t.value)},d=async()=>{const{data:t,error:r,pending:T}=await K({route:Y.locations,method:"GET",token:`${S.value}`});t&&(b.value=t.value)};return Q(()=>{R(),d()}),(t,r)=>{const T=Ke,A=Ze;return M(),P("div",null,[p(T,{text:"Apply filters",color:"primary",icon:a(et),click:I},null,8,["icon"]),p(a(Ge),{as:"template",show:a(v)},{default:F(()=>[p(a(Be),{class:"relative z-10",onClose:r[3]||(r[3]=c=>v.value=!1)},{default:F(()=>[p(a(z),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:F(()=>r[4]||(r[4]=[o("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity"},null,-1)])),_:1}),o("div",vt,[o("div",ft,[o("div",_t,[p(a(z),{as:"template",enter:"transform transition ease-in-out duration-500 sm:duration-700","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:F(()=>[p(a(Ve),{class:"pointer-events-auto relative w-screen max-w-md"},{default:F(()=>[p(a(z),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:F(()=>[o("div",ht,[o("button",{type:"button",class:"relative text-gray-100 hover:text-white",onClick:r[0]||(r[0]=c=>v.value=!1)},[r[5]||(r[5]=o("span",{class:"absolute -inset-2.5"},null,-1)),r[6]||(r[6]=o("span",{class:"sr-only"},"Close panel",-1)),p(a(mt),{class:"h-6 w-6","aria-hidden":"true"})])])]),_:1}),o("div",yt,[o("div",gt,[p(a(He),{class:"text-xl font-semibold leading-6 text-gray-900 px-4 py-2"},{default:F(()=>r[7]||(r[7]=[G("Filters")])),_:1})]),o("div",bt,[o("div",xt,[o("div",null,[p(A,{label:"Specimen",mode:"tags",items:a(j),"items-selected":a(w),"onUpdate:itemsSelected":r[1]||(r[1]=c=>fe(w)?w.value=c:null)},null,8,["items","items-selected"])]),o("div",null,[p(A,{label:"Lab location",mode:"tags",items:a(b).map(c=>c.name),"items-selected":a(x),"onUpdate:itemsSelected":r[2]||(r[2]=c=>fe(x)?x.value=c:null)},null,8,["items","items-selected"])]),o("div",wt,[(M(!0),P(he,null,ze(a(k),c=>(M(),P("label",{key:c.label,class:"flex items-center pt-3"},[p(a(pt),{modelValue:c.value,"onUpdate:modelValue":U=>c.value=U,class:_e([c.value?"bg-sky-500":"bg-gray-200","relative mr-2 inline-flex w-11 h-6 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75"])},{default:F(()=>[o("span",{"aria-hidden":"true",class:_e([c.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"])},null,2)]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),G(" "+V(c.label),1)]))),128))])]),o("div",St,[p(T,{text:"Reset",color:"error",icon:a(st),click:y},null,8,["icon"]),p(T,{text:"Apply",color:"success",icon:a(ot),click:h},null,8,["icon"])])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["show"])])}}}),Et=""+new URL("report_details.CM__hAjw.png",import.meta.url).href,kt={class:"px-5 py-5"},Tt={class:"bg-gray-50 border border-gray-100 rounded"},$t={class:"flex px-2 py-2 items-center"},Ft={class:"px-2 text-base font-medium uppercase"},Nt={class:"flex px-2 py-2 items-center"},Rt={class:"px-2 text-base font-medium"},At={class:"w-full flex items-center justify-between mt-3"},Dt={class:"flex items-center space-x-3"},Lt={class:"mt-5"},Xt=J({__name:"[associated_id]",setup(g){var X,Z;const n=Ye(),{getDisplayName:v}=ge();ct({title:`${Je(((Z=(X=n.query.type)==null?void 0:X.toString())==null?void 0:Z.toUpperCase().replaceAll("-"," "))??"")} Drilldown - ${ut.name.toUpperCase()}`});const L=i([]),E=i(!1),I=i(""),k=ye("token"),f=it(),b=Qe(),w=i("name"),x=i(0),j=i([50,100,500,1e3]),S=i("patient_name"),N=i("asc"),h=i([]),y=i([]),R=i({page:1,rowsPerPage:50,sortBy:"name"}),d=i([{text:"SN",value:"sn",sortable:!1},{text:"PATIENT NO",value:"patient_id",sortable:!0},{text:"PATIENT NAME",value:"patient_name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"DATE REGISTERED",value:"date_registered",sortable:!0},{text:"RESULT DATE",value:"result_date",sortable:!0},{text:"TAT IN HOURS",value:"tat_hours",sortable:!0}]),t=i(d.value),r=i([]),T=[{name:"Home",link:"/home"},{name:"Reports",link:"#"}],A=(e,l,u,s)=>{const m=D(s).format("MMMM"),$=D(s).format("yyyy");return{aggregate:`${D(l).format(B)} - ${D(u).format(B)}`,culture:`${m}, ${$}`,moh:`${s}`}[e]},c=q(()=>L.value.filter(e=>{if(h.value.length>0){const l=v(e.specimen_type,e.specimen_preferred_name);return h.value.includes(l)}return!0}).map((e,l)=>{const u=e.completed_by&&e.completed_by.username?e.completed_by.username:"",s=e.results&&e.results.length>0?e.results.find(_=>_.value!==null&&_.result_date):{},m=e.results&&e.results.length>0?e.results.filter(_=>_.name!=="Lab Tech. Name:").map(_=>`${v(_.name,_.preferred_name)}: ${_.value}`).join(", "):"",$=D(e.created_date),C=s.result_date?D(s.result_date):null,O=C&&$.isValid()&&C.isValid()?Math.round(C.diff($,"hours",!0)*100)/100:null;return{sn:l+1,patient_id:e.client.patient_no,patient_name:`${e.client.first_name} ${e.client.last_name}`,accession_number:e.accession_number,test_type_name:v(e.test_type_name,e.test_type_preferred_name),specimen_type:v(e.specimen_type,e.specimen_preferred_name),result:m,result_date:D(s.result_date).format(B),completed:u,requested_by:e.requested_by,tracking_number:e.tracking_number,lab_location:e.lab_location.name,rejection_reason:e.rejection_reason,date_registered:D(e.created_date).format(B),tat_hours:O!==null?O:"N/A"}}).filter(e=>y.value.length===0||y.value.includes(e.lab_location))),U=q(()=>c.value.map(e=>{let l={SN:e.sn,"PATIENT NO":e.patient_id,"PATIENT NAME":e.patient_name,"ACCESSION NO":e.accession_number,TEST:e.test_type_name,SPECIMEN:e.specimen_type,"TEST RESULT":e.result.replace(/,/g,`
`),"LAB LOCATION":e.lab_location,"RESULT DATE":e.result_date,"COMPLETED BY":e.completed,"REQUESTED BY":e.requested_by,"REJECTION EASON":e.rejection_reason,"TRACKING NUMBER":e.tracking_number,"DATE REGISTERED":e.date_registered,"TAT IN HOURS":e.tat_hours};const u=[...r.value.length>0?[([s])=>r.value.map(m=>m.toUpperCase()).includes(s.toUpperCase())||d.value.some(m=>m.text===s.toUpperCase())]:[],...h.value.length>0?[([s])=>s.toUpperCase()==="SPECIMEN"]:[],...y.value.length>0?[([s])=>s.toUpperCase()==="LAB LOCATION"]:[],([s])=>t.value.map(m=>m.text.toUpperCase()).includes(s.toUpperCase())];return Object.fromEntries(Object.entries(l).filter(s=>u.some(m=>m(s))))})),H=i([{origin:"aggregate",path:`${Y.aggregateDrilldown}?associated_ids=${n.params.associated_id}`}]),W=async()=>{var $;E.value=!0;const e=H.value.find(C=>C.origin==="aggregate");if(!e){console.error("Endpoint not found");return}const l={route:`${e.path}&page=${R.value.page}&per_page=${R.value.rowsPerPage}`,method:"GET",token:`${k.value}`},{data:u,error:s,pending:m}=await K(l);if(E.value=m,u.value&&(L.value=u.value.data,x.value=u.value.meta.total_count,E.value=!1,($=n.query.type)!=null&&$.includes("reject"))){const C=d.value.findIndex(_=>_.value==="test_type_name")+1,O={text:"REJECTION REASON",value:"rejection_reason",sortable:!0};d.value.splice(C,0,O)}s.value&&(console.error(s.value),E.value=!1)},be=e=>{if(typeof e=="object"){R.value=e;const u={...b.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};b.replace({query:u}),W()}},xe=e=>{h.value=[],y.value=[],Se(e),t.value=d.value.filter(l=>!l.text.includes("Specimen")).filter(l=>!l.text.includes("Lab Location"))},we=e=>{if(t.value=[...d.value],r.value=[],e.length>0){const l=new Set(t.value.map(s=>s.text));e.forEach(s=>{l.has(s.property)||(t.value.push({text:s.property,value:s.table_value,sortable:!0}),r.value.push(s.property))});const u=new Set(e.map(s=>s.property));t.value=t.value.filter(s=>u.has(s.text)||d.value.some(m=>m.text===s.text))}},Se=e=>{e.forEach(l=>{l.value||(t.value=t.value.filter(u=>u.text!==l.property))}),h.value.length===0&&y.value.length===0&&(t.value=[...d.value])},Ce=e=>{const l=e.split(",").filter(u=>u.trim()!=="");h.value=l,l.length>0?ke({text:"Specimen",value:"specimen_type",sortable:!0}):Te(),h.value.length===0&&y.value.length===0&&(d.value=[...d.value])},Ee=e=>{const l=e.split(",").filter(u=>u.trim()!=="");y.value=l,l.length>0?$e({text:"Lab Location",value:"lab_location",sortable:!0}):Fe(),h.value.length===0&&y.value.length===0&&(d.value=[...d.value])},ke=e=>{t.value.some(l=>l.text==="Specimen")||t.value.push(e)},Te=()=>{t.value=t.value.filter(e=>e.text!=="Specimen")},$e=e=>{t.value.some(l=>l.text==="Lab Location")||t.value.push(e)},Fe=()=>{t.value=t.value.filter(e=>e.text!=="Lab Location")},Ne=e=>e.join("-").toLowerCase().replace(/ /g,"-");return Q(()=>{W()}),(e,l)=>{var O,_,ee,te,ae,le,se,oe,re,ne,ie,ue,ce,de,pe;const u=Re,s=Ct,m=rt,$=We("excel"),C=nt;return M(),P("div",kt,[p(u,{pages:T}),l[3]||(l[3]=o("div",{class:"py-4 flex items-center"},[o("img",{src:Et,alt:"report-icon",class:"w-8 h-8 mr-2"}),o("h3",{class:"text-2xl font-semibold uppercase"},"Report Details")],-1)),o("div",null,[o("div",Tt,[o("div",$t,[l[0]||(l[0]=o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[o("path",{fill:"currentColor","fill-rule":"evenodd",d:"M31 10a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2h-8a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2H9a1 1 0 1 0 0 2v7H7v-3H5v3H4v2h1v13H4v2h1v2h2v-2h34v2h2v-2h1v-2h-1V21h1v-2h-1v-3h-2v3h-2v-7a1 1 0 1 0 0-2zm6 9v-7h-4v7zm-4 2h4v5h-4zm-2 0v8a4 4 0 0 0 8 0v-8h2v13H7V21h2v8a4 4 0 0 0 8 0v-8h3v8a4 4 0 0 0 8 0v-8zm-5-2v-7h-4v7zm-11 0v-7h-4v7zm-4 2h4v2h-4z","clip-rule":"evenodd"})],-1)),o("p",Ft,V(a(n).query.test)+" (total tests count: "+V(a(n).query.count)+") ",1)]),o("div",Nt,[l[2]||(l[2]=Xe('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 512 512"><rect width="416" height="384" x="48" y="80" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M128 48v32m256-32v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path></svg>',1)),o("p",Rt,[l[1]||(l[1]=o("span",{class:"font-medium text-black uppercase"},"Report period:",-1)),G(" "+V(A((O=a(n).query.origin)==null?void 0:O.toString(),(_=a(n).query.from)==null?void 0:_.toString(),(ee=a(n).query.to)==null?void 0:ee.toString(),(te=a(n).query.dateRange)==null?void 0:te.toString())),1)])])]),o("div",At,[o("div",null,[p(s,{onTableFields:we,onSpecimenFields:Ce,onLocationField:Ee,onOnClearFilters:xe})]),o("div",Dt,[p($,{class:"btn btn-default",header:[`${(ae=a(n).query.origin)==null?void 0:ae.toString().toUpperCase()} - ${(le=a(n).query.type)==null?void 0:le.toString().replaceAll("-"," ").toUpperCase()} `,`FOR PERIOD ${A((se=a(n).query.origin)==null?void 0:se.toString(),(oe=a(n).query.from)==null?void 0:oe.toString(),(re=a(n).query.to)==null?void 0:re.toString(),(ne=a(n).query.dateRange)==null?void 0:ne.toString())}`,a(f).details.name,a(f).details.address,a(f).details.phone,`${(ue=(ie=a(n).query.test)==null?void 0:ie.toString())==null?void 0:ue.toUpperCase()}`],data:a(U),worksheet:"report-work-sheet",name:Ne([`${(ce=a(n).query.origin)==null?void 0:ce.toString()}`,`${(de=a(n).query.type)==null?void 0:de.toString()}`,`${(pe=a(n).query.test)==null?void 0:pe.toString()}`,".xls"])},{default:F(()=>[p(m,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),o("div",Lt,[p(C,{headers:a(t),data:a(c),loading:a(E),"rows-per-items":a(j),searchField:a(I),searchValue:a(w),serverItemsLength:a(x),serverOptions:a(R),sortBy:a(S),sortType:a(N),onUpdate:be},null,8,["headers","data","loading","rows-per-items","searchField","searchValue","serverItemsLength","serverOptions","sortBy","sortType"])])])])}}});export{Xt as default};
