import{_ as pe}from"./Bo9Y6Pu_.js";import{_ as me}from"./Dwb4xzFl.js";import{d as fe,r as E,a as ye,a5 as be,ak as he,u as Ee,c as U,C as f,w as I,o as ge,y as P,b as L,e as S,f as y,h as s,g as r,t as g,z as H,k as K,H as z,F as ve,j as xe,N as Re,K as Q,m as Te,l as J,E as Le,au as Se,_ as $e}from"./B6Tj7v0x.js";import{_ as Me}from"./Cjvly83J.js";import{_ as Ye,a as Ge}from"./BDBSpNu8.js";import{u as Ne,_ as ke}from"./GKlopJML.js";import{u as Ae}from"./BU27LF7R.js";import{_ as Ce}from"./86AVq6QV.js";import{_ as qe}from"./CETmTxPE.js";import{x as Ue}from"./BmG5Fs-Q.js";import{P as Fe}from"./D0dD8Pjq.js";import{u as Oe}from"./oH74rWNW.js";import{r as We}from"./DJan6R1z.js";import{r as je}from"./CeZ-UIlw.js";import"./BbLbM4kr.js";import"./Ch3yEbHE.js";import"./CeQk7h_J.js";import"./B3lZ31pd.js";import"./qSwcIyrJ.js";import"./BWO9R2Jr.js";import"./Bhrz-4gH.js";import"./DDhblu8r.js";import"./DcNW31lB.js";const Be={class:"px-5 py-5"},Ve={class:"flex items-center py-5"},Ie=r("img",{src:Ce,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Pe={class:"text-2xl font-semibold uppercase"},He={class:"w-full flex items-center justify-between mb-5"},Ke={class:"w-full flex items-center space-x-3"},ze={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Qe={class:"w-72 ml-2"},Je={class:"w-40"},Xe={class:"w-48 flex items-end justify-end"},Ze={class:"rounded border"},we={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},De=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:qe,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold uppercase"},"INFECTION REPORT")],-1),et={key:0},tt={class:"hidden"},rt=r("h3",null,"INFECTION REPORT",-1),st={class:"text-lg font-semibold py-2 px-2"},ot={class:"text-normal font-normal"},nt={id:"print-container"},at=["innerHTML"],lt=r("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"SUMMARY",-1),ct={class:"w-full border-t"},dt=r("thead",null,[r("tr",{class:"border-b border-t bg-gray-100"},[r("th",{class:"px-2 py-2 border-r text-left"},"TESTS"),r("th",{class:"px-2 py-2 text-left"},"TOTAL")])],-1),it={class:"px-2 py-2 border-r border-b"},ut={class:"px-2 py-2 border-r border-b"},_t={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},pt=r("img",{src:Ge,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),mt=r("p",{class:"text-base"},"Data not found, please generate report",-1),ft=[pt,mt],Bt=fe({__name:"infection",setup(yt){Ae({title:`${Fe.name.toUpperCase()} - Infection Report`});const X=E("Infection Report"),Z=E([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),$=E([]),h=E({id:0,name:"select department"}),F=ye("token"),{loading:b,executeCancellableRequest:w,cancelRequest:D}=Ne(),v=be(),p=he(),{$toast:R}=Ee(),M=Oe(),Y=E([]),O=E([]),W=E(!1),l=E(new Array("","")),G=U(()=>l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):""),N=U(()=>l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):""),ee=()=>{l.value=new Array("","")},te=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',u=(o,e,a)=>{const n=o.indexOf(e);return n!==-1?o.slice(0,n)+a+o.slice(n+e.length):o},re=o=>{W.value=!1;let e="",a="",n="",c="",d=0,i=0,_=0,m=0,x=0;return o.reduce((t,k)=>{const q=k.measures.flatMap(A=>A.results.flatMap(B=>{const V=Object.keys(B[0])[0],de=B[0][V];return Object.entries(de).map(([ie,ue])=>{const _e=ue;return{test_type:k.test_type,measure:A.name,result:V,gender:ie==="F"?"Female":"Male",..._e}})}));return t.push(...q),t},new Array).forEach(t=>{i++,_++,d++,n===t.test_type?(e+="<tr>",a!==t.measure?(a=t.measure,c=t.result,e=u(e,"NEW_MEASURE",i.toString()),e=e.replace("NEW_RESULT",_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),i=0,_=0,m=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):c!==t.result&&(e=e.replace(/NEW_RESULT/g,_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),c=t.result,_=0,m=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(n=t.test_type,a=t.measure,c=t.result,e=e.replace(/NEW_TEST/g,d.toString()),e=u(e,"NEW_MEASURE",i.toString()),e=e.replace(/NEW_RESULT/g,_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),e=u(e,"TEST_TOTAL",x.toString()),i=0,_=0,m=0,d=0,x=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>";const k=C("L_E_5");e+=`
      <td
        class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${k}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">
        ${t.L_E_5?t.L_E_5.count.toString():"0"}
      </td>`;const q=C("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${q}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">`+(t.G_5_L_E_14?t.G_5_L_E_14.count:0).toString()+"</td>";const A=C("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${A}"
        data-count="${t.G_14?t.G_14.count:0}"
        data-ids="${t.G_14?t.G_14.associated_ids:""}">`+(t.G_14?t.G_14.count:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0)).toString()+"</td>",m+=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0),c===t.result&&_==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),i==0&&(x=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0))}),e=u(e,"NEW_TEST",(++d).toString()),e=u(e,"NEW_MEASURE",(++i).toString()),e=u(e,"NEW_RESULT",(++_).toString()),e=u(e,"RESULT_TOTAL",m.toString()),e=u(e,"TEST_TOTAL",x.toString()),e+="</tr>",W.value=!0,e},C=o=>({L_E_5:"Less than or equal to 5 years old",G_5_L_E_14:"Greater than 5 years old and less than or equal to 14 years old",G_14:"Greater than 14 years old"})[o],se=o=>{const e=te(),a=o.length>0?re(o):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${a}</table>`};async function oe(){const{data:o,error:e}=await Te({route:`${J.departments}`,method:"GET",token:`${F.value}`});o.value&&($.value=o.value,$.value.some(a=>a.id===0)||$.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function j(){if(le())R.warning("Please select a department");else{b.value=!0;let o=l.value[0].toString()!=""?f(l.value[0].toString()).format("YYYY-MM-DD"):"",e=l.value[1].toString()!=""?f(l.value[1].toString()).format("YYYY-MM-DD"):"";const a={route:`${J.aggregateReports}infection?from=${o}&to=${e}&department=${h.value.name}&report_id=${p.query.report_id}`,method:"GET",token:`${F.value}`},{data:n,error:c,pending:d}=await w(a);b.value=d,n.value&&(b.value=!1,Y.value=n.value.data,O.value=n.value.summary,ae(n.value.report_id),R.success("Report data generated successfully!")),c.value&&(console.error(c.value),b.value=!1,R.error(Le))}}const ne=o=>{const e=o.target;if(e.tagName==="TD"&&e.id==="tdRef"){const{test:a,ward:n,count:c,ids:d}=e.dataset;if(c&&d){const i=parseInt(c,10);i!==0&&d!==""?v.push(`/reports/${d}?origin=aggregate&type=infection-report&from=${G.value}&to=${N.value}&test=${a} - ${n}&department=${h.value.name}&count=${i}`):R.warning("No data found for this month")}else R.warning("No data found for this month")}},ae=o=>{const a={...v.currentRoute.value.query,report_id:o};v.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})},le=()=>h.value.name==Se;I(l,()=>{const o=l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):"",e=l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"";if(o||e){const n={...v.currentRoute.value.query,...o&&{from:o},...e&&{to:e}};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}},{deep:!0}),I(h,(o,e)=>{if(o!==e){const n={...v.currentRoute.value.query,department:o.name||void 0,report_id:""};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}});const ce=U(()=>p.query.to!==void 0&&p.query.from!==void 0&&p.query.department!==void 0?(l.value=[p.query.from,p.query.to],h.value.name=`${p.query.department}`,p.query.to!==""&&p.query.from!==""&&p.query.department!==""):!1);return ge(()=>{ce.value?j():b.value=!1}),oe(),(o,e)=>{const a=pe,n=P("datepicker"),c=me,d=$e,i=P("FormKit"),_=Me,m=Ye,x=ke;return L(),S("div",Be,[y(a,{pages:s(Z)},null,8,["pages"]),r("div",Ve,[Ie,r("h3",Pe,g(s(X)),1)]),r("div",He,[y(i,{type:"form","submit-label":"Update",onSubmit:j,actions:!1,id:"submitForm"},{default:H(({value:T})=>[r("div",Ke,[r("div",ze,[y(s(We),{class:"w-5 h-5 mr-2"}),K(" Filter By Date Range "),r("div",Qe,[y(n,{onCleared:ee,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:s(l),"onUpdate:modelValue":e[0]||(e[0]=t=>z(l)?l.value=t:null)},null,8,["modelValue"])])]),r("div",Je,[y(c,{items:s($),modelValue:s(h),"onUpdate:modelValue":e[1]||(e[1]=t=>z(h)?h.value=t:null)},null,8,["items","modelValue"])]),r("div",null,[y(d,{loading:s(b),color:"primary",type:"submit",text:"Generate Report",icon:s(je),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),r("div",Xe,[y(s(Ue),{element:"print-container",filename:`infection_report_from_${s(f)(s(G)).format("DD_MM_YYYY")}_to_${s(f)(s(N)).format("DD_MM_YYYY")}_for_${s(M).details.name.toLowerCase().split(" ").join("_")}`},{default:H(()=>[y(_,{text:"Export Excel"})]),_:1},8,["filename"])])]),r("div",null,[r("div",Ze,[r("div",we,[De,y(m)]),s(Y).length>0&&!s(b)?(L(),S("div",et,[r("div",tt,[rt,r("h3",null,g(s(M).details.name),1),r("p",null,g(s(M).details.address),1),r("p",null,g(s(M).details.phone),1)]),r("div",st,[K(" Tests Performed Period: "),r("span",ot,g(s(G)!=""?s(f)(s(G)).format("DD/MM/YYYY"):"")+" - "+g(s(N)!=""?s(f)(s(N)).format("DD/MM/YYYY"):""),1)]),r("div",nt,[r("div",{innerHTML:se(s(Y)),onClick:ne},null,8,at),r("div",null,[lt,r("table",ct,[dt,r("tbody",null,[(L(!0),S(ve,null,xe(s(O),(T,t)=>(L(),S("tr",{key:T.name,class:Re(t%2===0?"bg-white":"bg-gray-50")},[r("td",it,g(T.name),1),r("td",ut,g(T.count),1)],2))),128))])])])])])):Q("",!0),s(Y).length==0&&!s(b)?(L(),S("div",_t,ft)):Q("",!0),y(x,{condition:s(b),cancelReportGeneration:()=>s(D)()},null,8,["condition","cancelReportGeneration"])])])])}}});export{Bt as default};
