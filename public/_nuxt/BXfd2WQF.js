import{_ as me}from"./COJDNupw.js";import{_ as _e}from"./CoQgzhbz.js";import{d as fe,a as ve,r as $,a5 as ye,ak as he,u as E,c as U,C as f,w as L,o as ge,y as j,b as u,e as i,f as m,g as r,t as b,z as I,h as t,k as z,H,O as K,F as C,j as A,N as Re,K as Q,m as be,l as J,E as xe,_ as De}from"./BxD-h1LR.js";import{_ as we}from"./C2S1Arkw.js";import{_ as $e}from"./BNhNOnHe.js";import{_ as ke}from"./Cs7plFji.js";import{u as Te,_ as Ce}from"./NR9_F3jh.js";import{u as Me}from"./BmiBNsbw.js";import{_ as Ee}from"./CKMQEpqg.js";import{_ as Ae}from"./B4cMvEBz.js";import{_ as qe}from"./CQcCm1L6.js";import{u as Oe}from"./DRcUz5ts.js";import{P as Ye}from"./C1C0mJ5v.js";import{r as Fe}from"./BkJfYQCG.js";import{r as Se}from"./CQe3LSWs.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";const Ue={class:"px-5 py-5"},je=r("img",{src:Ee,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Be={class:"w-full flex items-center justify-between mb-3"},Pe={class:"flex items-center space-x-3"},Ve={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ne={class:"w-72 ml-2"},Ge={class:"w-44"},Le={class:"flex items-center space-x-3"},Ie={class:"border rounded print-container",id:"print-container"},ze={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},He=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"LABORATORY STATISTICS REPORT")],-1),Ke={class:"mt-3 px-5"},Qe={class:"font-medium mb-2"},Je={class:"font-normal"},We={class:"overflow-x-auto bg-white border-t"},Xe={key:0,class:"w-full overflow-x-auto"},Ze={class:"uppercase bg-gray-100"},et={class:"text-left"},tt=r("th",{class:"px-4 py-2"},"Tests",-1),ot=r("th",{class:"px-4 py-2"},"Total",-1),rt={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},st={class:"px-4 py-2 font-bold"},at=r("td",{class:"px-4 py-2"},null,-1),nt={class:"px-4 py-2"},lt=["onClick"],ct={class:"px-4 py-2"},ut={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},it=r("img",{src:qe,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),dt=r("p",null,"Data not found, please generate report",-1),pt=[it,dt],mt="Lab Statistics Report",Pt=fe({__name:"lab-statistics",setup(_t){Me({title:`${Ye.name.toUpperCase()} - Lab Statistics Report`});const F=Oe(),B=ve("token"),W=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],M=$([]),y=$({name:"select department"}),c=$(["",""]),P=$([]),k=$([]),q=$([]),V=$([]),x=ye(),_=he(),{$toast:X}=E(),{loading:h,executeCancellableRequest:Z,cancelRequest:ee}=Te(),te=()=>{c.value=new Array("","")};async function oe(){const{data:e,error:o}=await be({route:J.departments,method:"GET",token:`${B}`});e.value&&(M.value=e.value,M.value.some(a=>a.name=="All")||M.value.push({id:0,name:"All"}),M.value.sort((a,n)=>{const l=a.name.toUpperCase(),p=n.name.toUpperCase();return l<p?-1:l>p?1:0})),o.value&&console.error(o.value)}function re(e){return e==="select department"||e==="-- select test type --"||e==="-- select test status --"?"":e}function se(e,o){const s=new Date(e),a=new Date(o),n=new Array;let l=s;for(;l<=a;){const p=l.toLocaleString("default",{month:"long"});n.push(p),l.setMonth(l.getMonth()+1)}k.value=n}const ae=()=>{const{value:e}=y;return e.name==="select department"?!E().$toast.warning("Please select a department"):!0},D=U(()=>c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):""),w=U(()=>c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"");async function N(){h.value=!0;let e=`from=${D.value}&to=${w.value}&department=${re(y.value.name)}&report_id=${_.query.report_id}`;const o={route:`${J.aggregateReports}/lab_statistics?${e}`,method:"GET",token:`${B.value}`},{data:s,error:a,pending:n}=await Z(o);if(h.value=n,s.value){se(s.value.from,s.value.to),P.value=s.value.data,q.value=le(s.value.data);let l=[];q.value.forEach(p=>{const g={};g["Tests".toUpperCase()]=p.department.toUpperCase(),k.value.forEach(v=>{g[v.toUpperCase()]=""}),g["Total".toUpperCase()]="",l.push(g),p.tests.forEach(v=>{const T={};T["Tests".toUpperCase()]=v.name,k.value.forEach(O=>{T[O.toUpperCase()]=S(v,O)}),T["Total".toUpperCase()]=G(v),l.push(T)})}),V.value=l,h.value=!1,ne(s.value.report_id),s.value.data.length>0?E().$toast.success("Report data generated successfully"):E().$toast.warning(`No data found for period ${D.value} - ${w.value}`)}a.value&&(h.value=!1,console.error("error: ",a.value),E().$toast.error(xe))}const ne=e=>{const s={...x.currentRoute.value.query,report_id:e};x.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})};function le(e){return e.map(o=>{const s=Object.keys(o)[0],a=Object.entries(o[s]).map(([n,l])=>{const p=Object.entries(l).map(([g,v])=>({[g]:v}));return{name:n,results:p}});return{department:s,tests:a}})}function S(e,o){let s=0;return e.results.forEach(a=>{let n=a[o]!==void 0?a[o].total:0;s+=n}),s}function G(e){let o=0;return e.results.forEach(s=>{Object.values(s).forEach(a=>{o+=a.total})}),o}const ce=(e,o,s)=>{const a=e.results.find(n=>n[o]!==void 0);a?x.push(`/reports/${a[o].associated_ids}?origin=aggregate&type=lab-statistics-report&from=${D.value}&to=${w.value}&test=${e.name}&department=${y.value.name}&count=${s}&page=1&rowsPerPage=10`):X.warning("No data found for this month")};function ue(e){return e%2===0}L(c,()=>{const e=c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):"",o=c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"";if(e||o){const a={...x.currentRoute.value.query,...e&&{from:e},...o&&{to:o}};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0}),L(y,(e,o)=>{if(e!==o){const a={...x.currentRoute.value.query,department:e.name||void 0,report_id:""};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}});const ie=U(()=>_.query.to!==void 0&&_.query.from!==void 0&&_.query.department!==void 0?(c.value=[_.query.from,_.query.to],y.value.name=`${_.query.department}`,_.query.to!==""&&_.query.from!==""&&_.query.department!==""):!1);return ge(()=>{ie.value&&N()}),oe(),(e,o)=>{const s=me,a=j("datepicker"),n=_e,l=De,p=j("FormKit"),g=we,v=$e,T=j("excel"),O=ke,de=Ce;return u(),i("div",Ue,[m(s,{pages:W}),r("div",{class:"flex items-center py-5"},[je,r("h3",{class:"text-2xl font-semibold uppercase"},b(mt))]),r("div",Be,[m(p,{type:"form","submit-label":"Update",onSubmit:o[2]||(o[2]=R=>ae()&&N()),actions:!1,id:"submitForm"},{default:I(({value:R})=>[r("div",Pe,[r("div",Ve,[m(t(Fe),{class:"w-5 h-5 mr-2"}),z(" Filter By Date Range "),r("div",Ne,[m(a,{onCleared:te,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(c),"onUpdate:modelValue":o[0]||(o[0]=d=>H(c)?c.value=d:null)},null,8,["modelValue"])])]),r("div",Ge,[m(n,{items:t(M),modelValue:t(y),"onUpdate:modelValue":o[1]||(o[1]=d=>H(y)?y.value=d:null)},null,8,["items","modelValue"])]),m(l,{type:"submit",color:"primary",text:"Generate Report",icon:t(Se),click:()=>{},loading:t(h)},null,8,["icon","loading"])])]),_:1}),r("div",Le,[m(g),r("div",null,[m(T,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${t(f)(t(D)).format("DD-MM-yyyy")} TO ${t(f)(t(w)).format("DD-MM-yyyy")}`,t(F).details.name,t(F).details.address,t(F).details.phone],data:t(V),worksheet:"report-work-sheet",name:`lab-statistics-report_${t(f)(t(D)).format("DD_MM_yyyy")}_to_${t(f)(t(w)).format("DD_MM_yyyy")}.xls`},{default:I(()=>[m(v,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),r("div",Ie,[r("div",ze,[He,m(O)]),r("div",Ke,[r("h3",Qe,[z(" Tests Performed Period: "),r("span",Je,b(t(D)!=""?t(f)(t(D)).format("DATE_FORMAT"in e?e.DATE_FORMAT:t(K)):"")+" - "+b(t(w)!=""?t(f)(t(w)).format("DATE_FORMAT"in e?e.DATE_FORMAT:t(K)):""),1)])]),r("div",We,[t(q).length>0&&!t(h)?(u(),i("table",Xe,[r("thead",Ze,[r("tr",et,[tt,(u(!0),i(C,null,A(t(k),R=>(u(),i("th",{key:R,class:"px-4 py-2"},b(R),1))),128)),ot])]),r("tbody",null,[(u(!0),i(C,null,A(t(q),R=>(u(),i(C,{key:R.department},[r("tr",rt,[r("td",st,b(R.department),1),(u(!0),i(C,null,A(t(k),d=>(u(),i("td",{key:d,class:"px-4 py-2"}))),128)),at]),(u(!0),i(C,null,A(R.tests,(d,pe)=>(u(),i("tr",{key:d.name,class:Re({"bg-gray-50":ue(pe),"border-b border-dotted":!0})},[r("td",nt,b(d.name),1),(u(!0),i(C,null,A(t(k),Y=>(u(),i("td",{onClick:ft=>ce(d,Y,S(d,Y)),key:Y,class:"px-4 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},b(S(d,Y)),9,lt))),128)),r("td",ct,b(G(d)),1)],2))),128))],64))),128))])])):Q("",!0),m(de,{condition:t(h),cancelReportGeneration:()=>t(ee)()},null,8,["condition","cancelReportGeneration"]),t(P).length==0&&!t(h)?(u(),i("div",ut,pt)):Q("",!0)])])])}}});export{Pt as default};
