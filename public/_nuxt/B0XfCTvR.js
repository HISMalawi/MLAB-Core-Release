var Se=Object.defineProperty;var Te=(w,y,u)=>y in w?Se(w,y,{enumerable:!0,configurable:!0,writable:!0,value:u}):w[y]=u;var R=(w,y,u)=>Te(w,typeof y!="symbol"?y+"":y,u);import{_ as Re}from"./DeHqjJH7.js";import{be as Ue,l as C,d as ke,$ as Ce,a as Ae,r as i,bg as De,bh as F,w as Ne,bi as Me,x as ae,b as V,e as h,f as a,h as o,g as t,i as U,v as Y,y as Ie,A as b,ay as ne,bj as re,F as B,k as W,t as $e,q as Q,H as qe,D as k,j as Pe,bk as Ge,bl as O,bm as ie,Z as ue,m as Oe,u as L,E as Le,C as je,n as Fe,_ as Ye,bn as Be}from"./BLMYYBub.js";import{_ as We}from"./BOt9Lm4e.js";import{_ as Qe}from"./ymv4d8Tv.js";import{_ as He}from"./Dz4s_-UK.js";import{r as de}from"./DnJ5gH3O.js";import{r as Ke}from"./ZKhCvW0v.js";import{r as Ze}from"./B77w2j_x.js";import"./sNlKP72R.js";import"./DliR-cc7.js";import"./BlFheT0q.js";import"./IJCDyQty.js";import"./cHOIL3XF.js";import"./CkgugtXF.js";import"./BpACQbkq.js";import"./OnYuLN16.js";import"./DDt9YMgi.js";class ze extends Ue{constructor(){super(...arguments);R(this,"ORGANISMS",C.organisms);R(this,"SPECIMENS",C.specimens);R(this,"DEPARTMENTS",C.departments);R(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(u){const v={route:this.ORGANISMS,method:"GET",token:`${u}`};return this.call(v)}async getSpecimens(u){const v={route:this.SPECIMENS,method:"GET",token:`${u}`};return this.call(v)}async getDepartments(u){const v={route:this.DEPARTMENTS,method:"GET",token:`${u}`};return this.call(v)}async getTestTypesIndicators(u){const v={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${u}`};return this.call(v)}}const Je={class:"px-5 py-5"},Xe={class:"flex items-center justify-center mx-auto my-20"},et={class:"mt-2 space-y-3"},tt={class:"grid grid-cols-2 gap-4"},lt={class:"w-full flex items-center"},st={class:"py-1 ml-2 flex flex-col space-y-2"},ot={class:"w-full flex items-center space-x-2"},at={class:"w-full flex flex-col space-y-2"},nt={class:"w-full flex flex-col space-y-2"},rt={class:"w-full flex items-center space-x-2"},it={class:"w-full flex flex-col space-y-2"},ut={class:"w-full flex"},dt={class:"py-3 flex items-center justify-between"},mt={class:"text-lg text-grameasuresy-700 font-semibold"},ct=["onClick"],pt={class:"grid grid-cols-4 gap-2 mb-3"},vt={class:"flex items-center space-x-3"},ft={class:"grid grid-cols-2 gap-2"},_t={class:""},gt={class:"grid grid-cols-2 gap-2"},yt={class:"flex flex-col"},xt={class:""},bt={class:"grid grid-cols-2 gap-2"},Vt=["onClick"],Et={class:"w-full flex items-center justify-center space-x-2"},ht={class:"w-full grid grid-cols-2 gap-4"},wt=["onClick"],St={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},Tt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Bt=ke({__name:"index",setup(w){const y=Ce(),u=Ae("token"),v=new ze,me=i(!1),p=i([]),A=i(""),D=i(""),N=i(""),H=i([]),E=i(!1),M=i([]),K=i([]),Z=i([]),I=i([]),$=i(!1),q=i(!1),ce=i(De),S=i({name:F}),z=i([]),J=i([]),X=i([]),P=i(""),G=i({name:F}),pe=Ge,ve=async()=>{const{data:s,error:e}=await v.getOrganisms(`${u.value}`);s.value&&(K.value=s.value,Z.value=s.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},fe=async()=>{const{data:s,error:e}=await v.getSpecimens(`${u.value}`);s.value&&(z.value=s.value,J.value=s.value.map(d=>d.name)),e.value&&(me.value=!1,console.error("could not load specimens: ",e.value))},_e=async()=>{const{data:s,error:e}=await v.getDepartments(`${u.value}`);s.value&&(X.value=s.value),e.value&&console.error("could not load departments: ",e.value)},ge=async()=>{const{data:s,error:e}=await v.getTestTypesIndicators(`${u.value}`);s.value&&(H.value=s.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function ee(s,e){try{const c=(p==null?void 0:p.value[s]).indicator_ranges;let r=0;if(c.length>0){const _=c.length-1;r=c[_].id}const f={id:r&&r+1,interpretation:""},x=e.toLowerCase();x.includes("numeric")?(f.age_max=0,f.age_min=0,f.upper_range=0,f.lower_range=0,f.gender={name:O.SELECT_GENDER}):(x=="auto complete"||x.includes("alpha"))&&(f.value=""),c.push(f)}catch(d){console.error("Error: ",d)}}const te=(s,e)=>{p.value[s].indicator_ranges.splice(e,1)},le=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ie},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},se=s=>new Set(["free text","rich text"]).has(s);async function ye(){E.value=!0;const s=p.value.map(g=>{const f=g.indicator_ranges.map(x=>{if(x.hasOwnProperty("gender")){const _=x;return{sex:_.gender.name,max_age:_.max_age,min_age:_.min_age,upper_range:_.upper_range,lower_range:_.lower_range,interpretation:_.interpretation}}else return delete x.id,x});return{...g,indicator_ranges:f,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${u.value}`,body:{name:A.value,short_name:D.value,sex:P.value,expected_turn_around_time:{value:N.value,unit:S.value.name},print_device:$.value,department_id:G.value.id,specimens:ue(z.value,M.value),indicators:s,organisms:ue(K.value,I.value)}},{data:d,error:c,pending:r}=await Oe(e);E.value=r,d.value&&(oe(),y.push("/test-catalog/test-types?create=true"),E.value=!1),c.value&&(console.error("error creating test type: ",c.value),L().$toast.error(Le),E.value=!1)}const xe=s=>{const e=new Set(Be);for(const d of s)if(d.type.name.toLowerCase()==="numeric"){for(const c of d.indicator_ranges)if(!e.has(c.gender.name.toLowerCase()))return L().$toast.warning(O.GENDER_REQUIRED),!1}return!0},be=s=>s.name===F?(L().$toast.warning(O.DURATION_REQUIRED),!1):!0,Ve=s=>{for(const e of s)if(e.type.name===ie)return L().$toast.warning(O.MEASURE_TYPE_REQUIRED),!1;return!0},Ee=()=>{const s=xe(p.value),e=be(S.value),d=Ve(p.value);return s&&e&&d};Ne(()=>p.value.map(s=>s.type),(s,e)=>{s!==e&&s.forEach((d,c)=>{if(d!==e[c]&&new Set(Me).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[c].type.name;ee(c,g)}})},{deep:!0});const oe=()=>{je("submitForm")};return fe(),_e(),ge(),ve(),le(),(s,e)=>{const d=Re,c=Fe,r=ae("FormKit"),g=We,f=ae("multi-select"),x=Qe,_=Ye,he=He;return V(),h("div",Je,[a(d,{pages:o(pe)},null,8,["pages"]),e[22]||(e[22]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1)),t("div",null,[U(t("div",Xe,[a(c,{loading:o(E)},null,8,["loading"])],512),[[Y,o(E)]]),U(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[10]||(e[10]=we=>Ee()&&ye()),actions:!1},{default:Ie(({value:we})=>[t("div",et,[t("div",tt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:o(A),"onUpdate:modelValue":e[0]||(e[0]=l=>b(A)?A.value=l:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:o(D),"onUpdate:modelValue":e[1]||(e[1]=l=>b(D)?D.value=l:null)},null,8,["modelValue"])]),t("div",lt,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:o(N),"onUpdate:modelValue":e[2]||(e[2]=l=>b(N)?N.value=l:null)},null,8,["modelValue"]),t("div",st,[e[11]||(e[11]=t("p",{class:"font-medium text-base"},"Duration",-1)),a(g,{items:o(ce),modelValue:o(S),"onUpdate:modelValue":e[3]||(e[3]=l=>b(S)?S.value=l:null)},null,8,["items","modelValue"])])]),t("div",ot,[U(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>b(q)?q.value=l:null)},null,512),[[ne,o(q)]]),e[12]||(e[12]=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1))]),U(t("div",at,[e[13]||(e[13]=t("label",{class:"font-medium"},"Organisms",-1)),a(f,{style:{"--ms-max-height":"none !important"},modelValue:o(I),"onUpdate:modelValue":e[5]||(e[5]=l=>b(I)?I.value=l:null),options:o(Z),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[Y,o(q)]]),t("div",nt,[e[14]||(e[14]=t("label",{class:"font-medium"},"Specimens",-1)),a(f,{style:{"--ms-max-height":"none !important"},modelValue:o(M),"onUpdate:modelValue":e[6]||(e[6]=l=>b(M)?M.value=l:null),options:o(J),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",rt,[U(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>b($)?$.value=l:null)},null,512),[[ne,o($)]]),e[15]||(e[15]=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1))]),t("div",it,[e[16]||(e[16]=t("label",{class:"font-medium"},"Lab section",-1)),a(g,{"is-searchable":!0,modelValue:o(G),"onUpdate:modelValue":e[8]||(e[8]=l=>b(G)?G.value=l:null),items:o(X)},null,8,["modelValue","items"])]),a(x,{label:"Specific Sex","items-selected":o(P),"onUpdate:itemsSelected":e[9]||(e[9]=l=>b(P)?P.value=l:null),items:("GENDER"in s?s.GENDER:o(re)).map(l=>l.name),mode:"single"},null,8,["items-selected","items"]),t("div",ut,[a(_,{click:()=>{le()},color:"primary",text:"Add Measure",icon:o(de)},null,8,["click","icon"])]),o(p).length!=0?(V(!0),h(B,{key:0},W(o(p),(l,T)=>(V(),h("div",{key:l.id,class:"border px-5 py-3 rounded"},[t("div",dt,[t("h3",mt," Measures ("+$e(T+1)+") ",1),t("button",{onClick:()=>{o(p).splice(T,1)}},[a(o(Q),{class:"w-5 h-5"})],8,ct)]),t("div",pt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l.name,"onUpdate:modelValue":n=>l.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[e[17]||(e[17]=t("p",{class:"font-medium mb-2"},"Type",-1)),a(g,{modelValue:l.type,"onUpdate:modelValue":n=>l.type=n,items:o(H)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:l.unit,"onUpdate:modelValue":n=>l.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:l.description,"onUpdate:modelValue":n=>l.description=n},null,8,["modelValue","onUpdate:modelValue"])]),se(l.type.name.toLowerCase())?k("",!0):(V(),qe(_,{key:0,type:"button",click:()=>{ee(T,l.type.name)},color:"primary",text:"Add New Range",icon:o(de)},null,8,["click","icon"])),l.indicator_ranges.length>0&&l.type.name==="Numeric"?(V(!0),h(B,{key:1},W(l.indicator_ranges,(n,j)=>(V(),h("div",{class:"w-full px-3 py-3",key:n.id},[t("div",vt,[t("div",ft,[t("div",_t,[e[19]||(e[19]=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1)),t("div",gt,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":m=>n.min_age=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":m=>n.max_age=m},null,8,["modelValue","onUpdate:modelValue"]),t("div",yt,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sex",-1)),a(g,{modelValue:n.gender,"onUpdate:modelValue":m=>n.gender=m,items:"GENDER"in s?s.GENDER:o(re)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",xt,[e[20]||(e[20]=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1)),t("div",bt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":m=>n.upper_range=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":m=>n.lower_range=m},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(T,j)},[a(o(Q),{class:"w-5 h-5"})],8,Vt)])]))),128)):k("",!0),l.indicator_ranges.length>0&&l.type.name=="Auto Complete"||l.type.name==="Alpha Numeric"?(V(!0),h(B,{key:2},W(l.indicator_ranges,(n,j)=>(V(),h("div",{class:"px-3 py-3",key:n.id},[t("div",Et,[t("div",ht,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":m=>n.value=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(T,j),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(o(Q),{class:"w-5 h-5"})],8,wt)])]))),128)):k("",!0),se(l.type.name.toLowerCase())?(V(),h("div",St,[a(o(Ke),{class:"w-5 h-5 mr-2"}),e[21]||(e[21]=Pe(" A text box will appear for results entry "))])):k("",!0)]))),128)):k("",!0)]),t("div",Tt,[a(he,{type:"button",click:()=>{oe()},text:"Clear form"},null,8,["click"]),a(_,{type:"submit",click:()=>{},loading:o(E),color:"success",icon:o(Ze),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[Y,!o(E)]])])])}}});export{Bt as default};
