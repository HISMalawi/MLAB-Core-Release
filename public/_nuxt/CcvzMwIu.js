import{_ as J}from"./ucPVlGIa.js";import{d as W,r as E,a as X,a5 as Z,ak as ee,u as T,c as C,C as y,w as te,o as oe,y as P,b as n,e as l,f as m,h as t,g as e,t as _,ao as se,k as q,H as re,z as ae,F as g,j as R,K as S,i as ne,v as le,l as ce,m as ie,E as ue,_ as de,n as pe}from"./CnHVHtNb.js";import{_ as me}from"./hvHUUwMq.js";import{_ as _e}from"./BmVeJhZC.js";import{_ as fe,a as he}from"./D-MoOnWN.js";import{u as ye}from"./Bnl9n6mh.js";import{_ as ve}from"./D8FNkFa0.js";import{_ as be}from"./n49EBazs.js";import{u as xe}from"./DY202iD-.js";import{P as ge}from"./O-3ebvIT.js";import{r as we}from"./YtRYkxjm.js";import{r as Re}from"./lw9t-99L.js";import"./BZb3bzVo.js";import"./n6mkMIpm.js";const ke={class:"px-5 py-5"},$e=e("img",{src:ve,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),De={class:"flex justify-between items-center"},Me={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ye={class:"w-72 ml-2"},Ee={class:"w-48"},Te={class:"flex items-center space-x-3"},Ce={class:"border rounded mt-10",id:"print-container"},Oe={class:"flex items-center justify-between px-5 py-5 border-b"},Se=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:be,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"},"TB TESTS REPORT")],-1),qe={class:"m-3"},je={class:"text-lg font-semibold mb-2"},Be={class:"text-normal font-normal"},Pe={key:0,class:"overflow-x-auto"},Ae={class:"w-full rounded overflow-x-auto border-t border-b"},Ve={class:"w-full border-b"},Fe=["colspan"],Le={class:"bg-gray-50"},Ne=e("th",{class:"px-2 py-2 border-r uppercase"},"Result",-1),Ue={class:"px-2 py-2 border-r capitalize"},Ge=["onClick"],ze={class:"bg-gray-50 border-b"},He=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"}," Total Examined ",-1),Ie={key:0,class:"border-t bg-gray-100 border-b"},Qe=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"}," Pick Up Rate ",-1),Ke={class:"w-full items-center flex flex-col space-y-2 my-10"},Je=e("p",null,[q(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),We={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Xe=e("img",{src:he,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Ze=e("p",null,"Data not found, please generate report",-1),et=[Xe,Ze],tt="TB Report",vt=W({__name:"tb-tests",setup(ot){ye({title:`${ge.name.toUpperCase()} - TB Tests Reports`});const A=E([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),i=E([]),f=E(!1),p=E({months:new Array,data:new Array}),O=xe(),V=X("token"),k=Z(),v=ee(),{$toast:F}=T(),L=()=>{i.value=new Array("","")},N=(r,s)=>{let a=0;return s.forEach(o=>{a+=o.month[r]?o.month[r].count:0}),a},j=r=>r.sort((s,a)=>{const o=[],u=new Date;for(let d=0;d<12;d++)u.setMonth(d),o.push(u.toLocaleString("default",{month:"long"}));return o.indexOf(s)-o.indexOf(a)}),U=C(()=>{const r=[];return Object.keys(p.value.data).length>0&&Object.entries(p.value.data).forEach(([s,a])=>{a.forEach(o=>{const u={TEST:s,RESULT:o.result,...j(Object.keys(o.month)).reduce((d,$)=>{const D=o.month[$]?o.month[$].count:0;return d[$.toUpperCase()]=D??0,d},{})};r.push(u)})}),r}),G=(r,s)=>{let a=1,o=1;Object.keys(s)[0].toString().toLowerCase().includes("+")&&s[Object.keys(s)[0]].forEach(d=>{o+=d.month[r]?d.month[r]:0});let u=0;return s.forEach(d=>{u+=d.month[r]?d.month[r].count:0}),u>0?a=o/u*100:a=0,Math.floor(a)},b=C(()=>i.value[0]?y(i.value[0]).format("YYYY-MM-DD"):""),x=C(()=>i.value[1]?y(i.value[1]).format("YYYY-MM-DD"):"");async function B(){f.value=!0;let r=`from=${b.value}&to=${x.value}&report_id=${v.query.report_id}`;const s={route:`${ce.aggregateReports}tb_tests?${r}`,method:"GET",token:`${V.value}`},{data:a,error:o,pending:u}=await ie(s);f.value=u,a.value&&(f.value=!1,p.value=a.value,z(a.value.report_id),Object.keys(p.value.data).length>0?T().$toast.success("Report data generated successfully"):T().$toast.warning(`No data found in period ${b.value} - ${x.value}`)),o.value&&(f.value=!1,console.error(o.value),T().$toast.success(ue))}const z=r=>{const a={...k.currentRoute.value.query,report_id:r};k.replace({query:a}).catch(o=>{console.error("Failed to replace route:",o)})},H=(r,s,a,o)=>{a!==0&&o!==""?k.push(`/reports/${o}?origin=aggregate&type=tb-tests-report&from=${b.value}&to=${x.value}&test=${r} - ${s}&department=&count=${a}`):F.warning("No data found for this month")};te(i,()=>{const r=i.value[0]?y(i.value[0]).format("YYYY-MM-DD"):"",s=i.value[1]?y(i.value[1]).format("YYYY-MM-DD"):"";if(r||s){const o={...k.currentRoute.value.query,report_id:"",...r&&{from:r},...s&&{to:s}};k.replace({query:o}).catch(u=>{console.error("Failed to replace route:",u)})}},{deep:!0});const I=C(()=>v.query.to!==void 0&&v.query.from!==void 0?(i.value=[v.query.from,v.query.to],v.query.to!==""&&v.query.from!==""):!1);return oe(()=>{I.value&&B()}),(r,s)=>{const a=J,o=P("datepicker"),u=de,d=me,$=_e,D=P("excel"),Q=fe,K=pe;return n(),l("div",ke,[m(a,{pages:t(A)},null,8,["pages"]),e("div",{class:"flex items-center py-5"},[$e,e("h3",{class:"text-2xl font-semibold uppercase"},_(tt))]),e("div",De,[e("form",{onSubmit:s[1]||(s[1]=se(w=>B(),["prevent"])),class:"w-full flex items-center space-x-3"},[e("div",Me,[m(t(we),{class:"w-5 h-5 mr-2"}),q(" Filter By Date Range "),e("div",Ye,[m(o,{onCleared:L,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(i),"onUpdate:modelValue":s[0]||(s[0]=w=>re(i)?i.value=w:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),e("div",Ee,[m(u,{type:"submit",color:"primary",text:"Generate Report",icon:t(Re),click:()=>{},loading:t(f)},null,8,["icon","loading"])])],32),e("div",Te,[m(d,{printSmallLabel:!1}),m(D,{class:"btn btn-default",header:["TB TESTS LABORATORY REPORT",`PERIOD FROM ${t(y)(t(b)).format("DD-MM-yyyy")} TO ${t(y)(t(x)).format("DD-MM-yyyy")}`,t(O).details.name,t(O).details.address,t(O).details.phone],data:t(U),worksheet:"report-work-sheet",name:`tb_tests_report_from_${t(b)}_to_${t(x)}.xls`},{default:ae(()=>[m($,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",Ce,[e("div",Oe,[Se,m(Q)]),e("div",qe,[e("h3",je,[q(" Tests Performed Period: "),e("span",Be,_(t(b)!=""?t(y)(t(b)).format("DD/MM/YYYY"):"")+" - "+_(t(x)!=""?t(y)(t(x)).format("DD/MM/YYYY"):""),1)])]),t(f)?S("",!0):(n(),l("div",Pe,[e("table",Ae,[(n(!0),l(g,null,R(t(p).data,(w,Y)=>(n(),l(g,{key:Y},[e("thead",Ve,[e("tr",null,[e("th",{colspan:t(p).months.length+1,class:"uppercase text-center py-2 border-b"},_(Y),9,Fe)]),e("tr",Le,[Ne,(n(!0),l(g,null,R(t(p).months,(c,M)=>(n(),l("th",{class:"px-2 py-2 border-r",key:M},_(c.toString().toUpperCase()),1))),128))])]),e("tbody",null,[(n(!0),l(g,null,R(w,(c,M)=>(n(),l("tr",{class:"border-b",key:M},[e("td",Ue,_(c.result),1),(n(!0),l(g,null,R(t(p).months,h=>(n(),l("td",{key:h,class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:st=>H(`${Y} - ${c.result}`,h,c.month[h]?c.month[h].count:0,c.month[h]?c.month[h].associated_ids:"")},_(c.month[h]?c.month[h].count:0),9,Ge))),128))]))),128)),e("tr",ze,[He,(n(!0),l(g,null,R(j(t(p).months),c=>(n(),l("td",{key:c,class:"px-2 py-2 border-r"},_(N(c,w)),1))),128))]),Y.toString().toLowerCase()=="smear microscopy result"?(n(),l("tr",Ie,[Qe,(n(!0),l(g,null,R(t(p).months,(c,M)=>(n(),l("td",{key:M,class:"px-2 py-2 border-r"},_(G(c,w))+"% ",1))),128))])):S("",!0)])],64))),128))])])),ne(e("div",Ke,[m(K),Je],512),[[le,t(f)]]),t(p).data.length==0&&!t(f)?(n(),l("div",We,et)):S("",!0)])])}}});export{vt as default};
