var ae=Object.defineProperty;var oe=(u,a,n)=>a in u?ae(u,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[a]=n;var h=(u,a,n)=>oe(u,typeof a!="symbol"?a+"":a,n);import{_ as le}from"./COJDNupw.js";import{_ as ne}from"./Dm9r4zu1.js";import{_ as ie}from"./CoQgzhbz.js";import{C as ce,bG as _,d as re,bH as de,bI as ue,bJ as me,a as pe,r as o,c as y,a6 as _e,w as U,bK as k,o as fe,y as B,b as R,e as F,g as e,f as r,k as H,z as M,t as x,N as E,i as ve,aB as be,K as he,h as ye,bE as xe,l as ge,m as we,u as g,bD as Ne,_ as ke}from"./BxD-h1LR.js";import{_ as Ve}from"./DAoM-dCf.js";import{u as $e}from"./BmiBNsbw.js";import{u as K}from"./DkqoXkVu.js";import{P as Ce}from"./C1C0mJ5v.js";import{r as Se}from"./2qDGpbGm.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";import"./CmGziMTe.js";class De{constructor(a){h(this,"client",{id:"",uuid:""});h(this,"tests",[]);h(this,"order",{priority:1,requested_by:"",collected_by:K().$state.department,sample_collected_time:"",tracking_number:""});h(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=a}createEncounter(a,n){this.encounter={...this.encounter,encounter_type:a,facility_section:n}}buildOrder(a="",n=ce().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=a,this.order.sample_collected_time=n}setTests(a,n){this.tests=n.map(m=>({specimen:a,test_type:m}))}async createOrder(a){return _.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:a})}}const qe={class:"py-5 px-5"},Pe={class:"mt-5"},Te={class:"flex items-center space-x-2"},Ue=e("img",{src:Ve,class:"w-auto h-6",alt:"flash-icon"},null,-1),Be={class:"text-xl font-semibold uppercase"},Ee={class:"border rounded mt-5"},Je=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("img",{src:xe,class:"h-8 w-auto",alt:"fever-icon"}),e("h3",{class:"font-semibold text-lg"},"Patient Details")],-1),Oe={class:"w-full py-5 px-5"},Ae={class:"flex items-center space-x-20"},Re={class:"flex items-center space-x-3"},Fe=e("h3",{class:"font-medium"},"Patient Number:",-1),He={class:"mt-1 text-gray-600"},Me={class:"flex items-center space-x-3"},Ke=e("h3",{class:"font-medium"},"Age",-1),Le={class:"mt-1 text-gray-600"},Ye={class:"flex items-center space-x-3"},ze=e("h3",{class:"font-medium"},"Sex:",-1),Ge={class:"mt-1 text-gray-600"},Ie={class:"border mt-5 rounded"},We=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("h3",{class:"font-semibold text-lg"},"Order Details")],-1),je={class:"px-5 py-5"},Qe={class:"w-full mb-5"},Xe={class:"flex flex-col space-y-2"},Ze={class:"w-full flex items-center space-x-10 mb-5"},et={class:"w-1/2 flex flex-col space-y-2"},tt=e("label",{class:"font-medium"},"Visit Type",-1),st={class:"w-1/2 flex flex-col space-y-2"},at={class:"font-medium"},ot={class:"w-full flex items-center space-x-10 mb-5"},lt={class:"w-1/2 flex flex-col space-y-2"},nt=e("label",{class:"font-medium"},"Specimen Type",-1),it={class:"w-1/2 flex flex-col space-y-2"},ct=e("label",{class:"font-medium"},"Tests",-1),rt={class:"w-full my-6"},dt=e("label",{class:"font-medium"},"Back Data Entry",-1),ut={key:0,class:"w-full mb-5 flex flex-col space-y-2"},mt=e("label",{class:"font-medium"},"Sample collection date",-1),pt={class:"w-full"},Tt=re({__name:"index",setup(u){$e({title:`${Ce.name.toUpperCase()} - New Test`});const a=de(),n=ue(),m=K(),L=me(),Y=pe("token"),d=o({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),z=o([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),J=o([]),V=o([]),w=o([]),p=o([]),f=o({name:"select visit type",id:0}),c=o({name:"select specimen",id:0}),v=o({name:"select ward",id:0}),N=o([]),$=o(""),C=o(""),S=o("Requesting Ward"),D=o(!1),G=y(()=>_e(d.value.date_of_birth)),q=y(()=>d.value.sex.match(/f/i)?"Female":"Male"),O=y(()=>`${d.value.first_name} ${d.value.middle_name} ${d.value.last_name}`),I=y(()=>d.value.client_id),P=y(()=>m.user.departments.find(s=>s.name===m.department));function W(s){const t={route:`${ge.clients}/${s}`,method:"GET",token:`${Y.value}`};we(t).then(({data:i,error:b})=>{i.value&&(d.value=i.value),b.value&&console.error(b.value)})}function j(s,t){const i=s.find(b=>b.name===t);return i?i.id:null}async function Q(){const s=new De(d.value.client_id);s.createEncounter(Number(f.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(c.value.id),N.value);const t=j(m.locations,m.selectedLocation),i=await s.createOrder(Number(t));k(i)||(g().$toast.success(`Order with accession number ${i.accession_number} has been created successfully!`),await L.alertConfirmation({message:"Do you want to print specimen label?"})&&await Ne.printSpecimenLabel(i.accession_number)),n.push("/tests")}function X(){return Number(f.value.id)==0?(g().$toast.warning("Please select visit type and try again!"),!1):Number(c.value.id)==0?(g().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(g().$toast.warning("Please select ward and try again!"),!1):N.value.length==0?(g().$toast.warning("Please select tests and try again!"),!1):!0}return U(f,async s=>{s.name.toLowerCase()=="referral"?(S.value="Requesting Facility",v.value={name:"select facility",id:0}):S.value="Requesting Ward",w.value=[],k(w.value[Number(s.id)])&&(w.value=await _.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),U(c,async s=>{k(p.value[Number(s.id)])&&(p.value[Number(s.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:P.value.id,sex:q.value})||[])}),U(()=>m,async s=>{for(const t in p.value)p.value.hasOwnProperty(t)&&delete p.value[t];k(c.value)||(p.value[Number(c.value.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(c.value.id),department_id:s.user.departments.find(t=>t.name===s.department).id,sex:q.value})||[]),_.getJson("specimen",{department_id:P.value.id}).then(t=>V.value=t)},{deep:!0}),fe(async()=>{const s=await _.getJson("encounter_types");J.value=s.data;const t=await _.getJson("specimen",{department_id:P.value.id});V.value=t,W(a.query.patient_id)}),(s,t)=>{const i=le,b=ne,A=B("FormKit"),T=ie,Z=B("multi-select"),ee=B("datepicker"),te=ke;return R(),F("div",null,[e("div",qe,[r(i,{pages:z.value},null,8,["pages"]),e("div",Pe,[e("div",Te,[Ue,e("h3",Be,[H(" New order for "),e("span",null,[r(b,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${O.value.toLowerCase().replace(" ","+")}`},{default:M(()=>[H(" “"+x(O.value)+"” ",1)]),_:1},8,["to"])])])]),e("div",Ee,[Je,e("div",Oe,[e("div",Ae,[e("div",Re,[Fe,e("p",He,x(I.value),1)]),e("div",Me,[Ke,e("p",Le,x(G.value)+" years old",1)]),e("div",Ye,[ze,e("p",Ge,x(q.value),1)])])])]),r(A,{type:"form","submit-label":"Update",onSubmit:t[7]||(t[7]=se=>X()&&Q()),actions:!1,id:"submitForm"},{default:M(({value:se})=>[e("div",Ie,[We,e("div",je,[e("div",Qe,[e("div",Xe,[r(A,{label:"Requesting Physician",validation:"required",modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=l=>$.value=l)},null,8,["modelValue"])])]),e("div",Ze,[e("div",et,[tt,r(T,{items:J.value,modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=l=>f.value=l),class:E(f.value.name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",st,[e("label",at,x(S.value),1),r(T,{isSearchable:"",items:w.value,modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),class:E(v.value.name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),e("div",ot,[e("div",lt,[nt,r(T,{items:V.value,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value=l),class:E(c.value.name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",it,[ct,r(Z,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=l=>N.value=l),options:p.value[c.value.id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",rt,[ve(e("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":t[5]||(t[5]=l=>D.value=l)},null,512),[[be,D.value]]),dt]),D.value?(R(),F("div",ut,[mt,r(ee,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=l=>C.value=l)},null,8,["modelValue"])])):he("",!0),e("div",pt,[r(te,{type:"submit",text:"Place order",color:"primary",icon:ye(Se),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{Tt as default};
