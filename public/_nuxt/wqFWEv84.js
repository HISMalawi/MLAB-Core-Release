import{S,p as I,Y as D,G as q,V as L,q as A,D as R,M as b,a as V,l as h,m as f,u as _,P as v,x as z,y as a,b as k,e as O,f as r,z as l,g as c,k as N,L as B,K as F,_ as M}from"./B6Tj7v0x.js";const U={components:{TransitionRoot:S,TransitionChild:I,Dialog:D,DialogPanel:q,DialogTitle:L,XMarkIcon:A,ExclamationTriangleIcon:R,PrinterIcon:b},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1},orderTests:{type:Array,required:!1}},data(){return{show:!1,printIcon:b,cookie:V("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const i={route:h.printers,method:"GET",token:`${this.cookie}`},{data:e,error:t}=await f(i);e.value&&(this.printers=new Array,e.value.map(d=>{this.printers.push(d.name)})),t.value&&console.error(t.value)},isCrossMatchTest(){var i;return this.orderTests?(i=this.orderTests)==null?void 0:i.some(e=>e.test_type_name.toLowerCase()=="cross-match"):!1},async toPrintSmallLabel(){this.zebraPrinting=!0;const i={route:h.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests,is_cross_match:this.isCrossMatchTest()}},{data:e,error:t,pending:d}=await f(i);if(this.zebraPrinting=d,e.value){this.zebraPrinting=!1;const o=new FileReader;o.onload=()=>{const n=URL.createObjectURL(e.value),s=document.createElement("a");s.href=n,s.setAttribute("download",`${Date.now()}.lbl`),s.click(),URL.revokeObjectURL(n)},o.readAsText(e.value)}t.value&&(this.zebraPrinting=!1,console.error(t.value))},containsWords(i,...e){for(let t=0;t<e.length;t++)if(i.cssText.includes(e[t]))return!0;return!1},async submitForm(i){var p,m;let e=new FormData;this.loading=!0;let t=new Array;t.push(Number(this.orderId));let d=this.id;e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(t)),e.append("client_id",d);const o={route:h.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:n,error:s,pending:u}=await f(o);this.loading=u,n.value&&(n.value.printed?_().$toast.success("Patient report printed successfully!"):_().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((p=(this._.provides[v]||this.$route).query.printer)==null?void 0:p.toString())=="true"&&this.$router.back(),this.handleClick()),s.value&&(this.loading=!1,console.error(s.value),_().$toast.error("An error occurred while printing patient report"),this.handleClick(),((m=(this._.provides[v]||this.$route).query.printer)==null?void 0:m.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show}}},j=c("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),E={class:"fixed inset-0 overflow-y-auto"},$={class:"flex top-0 items-center justify-center p-4 text-center"},G={class:"border-b px-3 py-3 flex items-center justify-between"},K={class:"py-5 px-5"},X={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Y(i,e,t,d,o,n){const s=M,u=a("TransitionChild"),p=a("PrinterIcon"),m=a("DialogTitle"),x=a("XMarkIcon"),y=a("FormKit"),w=a("DialogPanel"),P=a("Dialog"),T=a("TransitionRoot");return k(),O("div",null,[r(s,{click:n.init,color:"primary",text:"Print",icon:o.printIcon},null,8,["click","icon"]),r(T,{appear:"",show:o.show,as:"template"},{default:l(()=>[r(P,{as:"div",class:"relative z-10"},{default:l(()=>[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>[j]),_:1}),c("div",E,[c("div",$,[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[r(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[c("div",G,[r(m,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>[r(p,{class:"h-5 w-5 mr-2"}),N(" Print ")]),_:1}),c("button",{onClick:e[0]||(e[0]=(...g)=>n.handleClick&&n.handleClick(...g))},[r(x,{class:"w-5 h-5"})])]),r(y,{type:"form","submit-label":"Update",onSubmit:n.submitForm,actions:!1},{default:l(({value:g})=>[c("div",K,[r(y,{validation:"required",label:"Select a printer",type:"radio",modelValue:o.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=C=>o.selectedPrinter=C),options:o.printers},null,8,["modelValue","options"])]),c("div",X,[t.printSmallLabel?(k(),B(s,{key:0,type:"button",loading:o.zebraPrinting,click:()=>{n.toPrintSmallLabel()},icon:o.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):F("",!0),r(s,{click:()=>{},loading:o.loading,type:"submit",icon:o.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const W=z(U,[["render",Y]]);export{W as _};
