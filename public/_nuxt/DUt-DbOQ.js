var ae=Object.defineProperty;var le=(c,a,o)=>a in c?ae(c,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):c[a]=o;var y=(c,a,o)=>le(c,typeof a!="symbol"?a+"":a,o);import{_ as ne}from"./BxxC6xAb.js";import{_ as oe}from"./CDJ4C1jN.js";import{_ as ie}from"./Bzacd9Q4.js";import{C as re,bL as f,d as ue,bJ as de,ai as ce,bM as me,a as pe,r as l,c as x,a4 as fe,w as U,bN as V,o as ve,y as A,b as R,e as F,g as t,f as u,j as M,z as H,t as g,bI as _e,N as J,i as be,aA as ye,K as xe,h as ge,l as we,m as he,u as w,bH as Ne,_ as Ve}from"./CUNWPMFO.js";import{_ as ke}from"./DAoM-dCf.js";import{u as $e}from"./C_AIsC7W.js";import{u as L}from"./C_BiN2iC.js";import{P as Ce}from"./BSY9E36G.js";import{r as Se}from"./BfjsmCpQ.js";import"./C5KkEBG1.js";import"./DGiBFwjt.js";import"./B1NysoR-.js";import"./BoMo2d9h.js";import"./Bnw_B-mo.js";import"./DAgWbDoT.js";import"./B73RjFxO.js";import"./CxvClpzF.js";class qe{constructor(a){y(this,"client",{id:"",uuid:""});y(this,"tests",[]);y(this,"order",{priority:1,requested_by:"",collected_by:L().$state.department,sample_collected_time:"",tracking_number:""});y(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=a}createEncounter(a,o){this.encounter={...this.encounter,encounter_type:a,facility_section:o}}buildOrder(a="",o=re().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=a,this.order.sample_collected_time=o}setTests(a,o){this.tests=o.map(m=>({specimen:a,test_type:m}))}async createOrder(a){return f.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:a})}}const De={class:"py-5 px-5"},Pe={class:"mt-5"},Te={class:"flex items-center space-x-2"},Ue={class:"text-xl font-semibold uppercase"},Ae={class:"border rounded mt-5"},Je={class:"w-full py-5 px-5"},Oe={class:"flex items-center space-x-20"},Be={class:"flex items-center space-x-3"},Ee={class:"mt-1 text-gray-600"},Re={class:"flex items-center space-x-3"},Fe={class:"mt-1 text-gray-600"},Me={class:"flex items-center space-x-3"},He={class:"mt-1 text-gray-600"},Le={class:"border mt-5 rounded"},Ye={class:"px-5 py-5"},Ke={class:"w-full mb-5"},ze={class:"flex flex-col space-y-2"},Ie={class:"w-full flex items-center space-x-10 mb-5"},We={class:"w-1/2 flex flex-col space-y-2"},je={class:"w-1/2 flex flex-col space-y-2"},Ge={class:"font-medium"},Qe={class:"w-full flex items-center space-x-10 mb-5"},Xe={class:"w-1/2 flex flex-col space-y-2"},Ze={class:"w-1/2 flex flex-col space-y-2"},et={class:"w-full my-6"},tt={key:0,class:"w-full mb-5 flex flex-col space-y-2"},st={class:"w-full"},wt=ue({__name:"index",setup(c){$e({title:`${Ce.name.toUpperCase()} - New Test`});const a=de(),o=ce(),m=L(),Y=me(),K=pe("token"),d=l({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),z=l([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),O=l([]),k=l([]),h=l([]),p=l([]),v=l({name:"select visit type",id:0}),r=l({name:"select specimen",id:0}),_=l({name:"select ward",id:0}),N=l([]),$=l(""),C=l(""),S=l("Requesting Ward"),q=l(!1),I=x(()=>fe(d.value.date_of_birth)),D=x(()=>d.value.sex.match(/f/i)?"Female":"Male"),B=x(()=>`${d.value.first_name} ${d.value.middle_name} ${d.value.last_name}`),W=x(()=>d.value.client_id),P=x(()=>m.user.departments.find(s=>s.name===m.department));function j(s){const e={route:`${we.clients}/${s}`,method:"GET",token:`${K.value}`};he(e).then(({data:i,error:b})=>{i.value&&(d.value=i.value),b.value&&console.error(b.value)})}function G(s,e){const i=s.find(b=>b.name===e);return i?i.id:null}async function Q(){const s=new qe(d.value.client_id);s.createEncounter(Number(v.value.id),Number(_.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(r.value.id),N.value);const e=G(m.locations,m.selectedLocation),i=await s.createOrder(Number(e));V(i)||(w().$toast.success(`Order with accession number ${i.accession_number} has been created successfully!`),await Y.alertConfirmation({message:"Do you want to print specimen label?"})&&await Ne.printSpecimenLabel(i.accession_number)),o.push("/tests")}function X(){return Number(v.value.id)==0?(w().$toast.warning("Please select visit type and try again!"),!1):Number(r.value.id)==0?(w().$toast.warning("Please select specimen and try again!"),!1):Number(_.value.id)==0?(w().$toast.warning("Please select ward and try again!"),!1):N.value.length==0?(w().$toast.warning("Please select tests and try again!"),!1):!0}return U(v,async s=>{s.name.toLowerCase()=="referral"?(S.value="Requesting Facility",_.value={name:"select facility",id:0}):S.value="Requesting Ward",h.value=[],V(h.value[Number(s.id)])&&(h.value=await f.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),U(r,async s=>{V(p.value[Number(s.id)])&&(p.value[Number(s.id)]=await f.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:P.value.id,sex:D.value})||[])}),U(()=>m,async s=>{for(const e in p.value)p.value.hasOwnProperty(e)&&delete p.value[e];V(r.value)||(p.value[Number(r.value.id)]=await f.getJson("specimen/test_types",{specimen_id:Number(r.value.id),department_id:s.user.departments.find(e=>e.name===s.department).id,sex:D.value})||[]),f.getJson("specimen",{department_id:P.value.id}).then(e=>k.value=e)},{deep:!0}),ve(async()=>{const s=await f.getJson("encounter_types");O.value=s.data;const e=await f.getJson("specimen",{department_id:P.value.id});k.value=e,j(a.query.patient_id)}),(s,e)=>{const i=ne,b=oe,E=A("FormKit"),T=ie,Z=A("multi-select"),ee=A("datepicker"),te=Ve;return R(),F("div",null,[t("div",De,[u(i,{pages:z.value},null,8,["pages"]),t("div",Pe,[t("div",Te,[e[9]||(e[9]=t("img",{src:ke,class:"w-auto h-6",alt:"flash-icon"},null,-1)),t("h3",Ue,[e[8]||(e[8]=M(" New order for ")),t("span",null,[u(b,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${B.value.toLowerCase().replace(" ","+")}`},{default:H(()=>[M(" “"+g(B.value)+"” ",1)]),_:1},8,["to"])])])]),t("div",Ae,[e[13]||(e[13]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("img",{src:_e,class:"h-8 w-auto",alt:"fever-icon"}),t("h3",{class:"font-semibold text-lg"},"Patient Details")],-1)),t("div",Je,[t("div",Oe,[t("div",Be,[e[10]||(e[10]=t("h3",{class:"font-medium"},"Patient Number:",-1)),t("p",Ee,g(W.value),1)]),t("div",Re,[e[11]||(e[11]=t("h3",{class:"font-medium"},"Age",-1)),t("p",Fe,g(I.value)+" years old",1)]),t("div",Me,[e[12]||(e[12]=t("h3",{class:"font-medium"},"Sex:",-1)),t("p",He,g(D.value),1)])])])]),u(E,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=se=>X()&&Q()),actions:!1,id:"submitForm"},{default:H(({value:se})=>[t("div",Le,[e[19]||(e[19]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("h3",{class:"font-semibold text-lg"},"Order Details")],-1)),t("div",Ye,[t("div",Ke,[t("div",ze,[u(E,{label:"Requesting Physician",validation:"required",modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=n=>$.value=n)},null,8,["modelValue"])])]),t("div",Ie,[t("div",We,[e[14]||(e[14]=t("label",{class:"font-medium"},"Visit Type",-1)),u(T,{items:O.value,modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),class:J(v.value.name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",je,[t("label",Ge,g(S.value),1),u(T,{isSearchable:"",items:h.value,modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=n=>_.value=n),class:J(_.value.name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),t("div",Qe,[t("div",Xe,[e[15]||(e[15]=t("label",{class:"font-medium"},"Specimen Type",-1)),u(T,{items:k.value,modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=n=>r.value=n),class:J(r.value.name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",Ze,[e[16]||(e[16]=t("label",{class:"font-medium"},"Tests",-1)),u(Z,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=n=>N.value=n),options:p.value[r.value.id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",et,[be(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=n=>q.value=n)},null,512),[[ye,q.value]]),e[17]||(e[17]=t("label",{class:"font-medium"},"Back Data Entry",-1))]),q.value?(R(),F("div",tt,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sample collection date",-1)),u(ee,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:C.value,"onUpdate:modelValue":e[6]||(e[6]=n=>C.value=n)},null,8,["modelValue"])])):xe("",!0),t("div",st,[u(te,{type:"submit",text:"Place order",color:"primary",icon:ge(Se),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{wt as default};
