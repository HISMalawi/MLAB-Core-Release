import{d as j,r as f,ak as B,a5 as Y,a as P,c as E,C as l,w as L,o as K,y as w,b as u,e as m,g as e,f as i,z as S,h as t,k as h,H as z,t as _,F as N,j as M,K as T,i as Q,v as H,u as C,l as J,m as X,E as Z,_ as ee,n as te}from"./BxD-h1LR.js";import{_ as oe}from"./BNhNOnHe.js";import{_ as se}from"./Cs7plFji.js";import{_ as ae}from"./B4cMvEBz.js";import{_ as re}from"./CQcCm1L6.js";import{u as ne}from"./DRcUz5ts.js";import{s as ce}from"./Qw5I_VYr.js";import{r as le}from"./BkJfYQCG.js";import{r as ie}from"./CQe3LSWs.js";const de={class:"w-full flex items-center justify-between mb-10"},ue={class:"flex items-center space-x-5"},me={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},_e={class:"w-56 ml-2"},pe={class:"w-48"},ye={class:"rounded border",id:"print-container"},fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},he=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ")],-1),ve={class:"px-4 mt-2 font-medium"},xe={class:"font-normal"},ge={key:0},Re={class:"w-full mt-3",ref:"table"},be={class:"w-full border-b border-t bg-gray-100 rounded-t"},we={class:"w-full"},Ce={class:"px-2 py-2 text-center border-r"},ke={class:"px-2 py-2 text-center border-r"},Ee={class:"px-2 py-2 text-center border-r"},Se={class:"px-2 py-2 text-center border-r"},Ne=["onClick"],Me={class:"w-full items-center flex flex-col space-y-2 my-10"},Te=e("p",{class:"text-base"},[h(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),$e={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Fe=e("img",{src:re,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Ie=e("p",{class:"text-base"},[h(" Please generate report data to preview the "),e("span",{class:"font-medium"},"Organisms in Wards Count"),h(" report. ")],-1),Oe=[Fe,Ie],Le=j({__name:"organisms-wards-counts",setup(De){const o=f(""),$=f([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Organism Name"},{name:"Total Count"}]),F=f(""),v=B(),x=Y(),I=P("token"),p=f([]),R=ne(),c=f(!1),O=E(()=>p.value.map((s,r)=>({WARD:s.ward,ENCOUNTER:s.encounter,"DATE PERIOD":l(o.value).format("MMMM-yyyy"),ORGANISMS:s.organism,COUNT:s.count}))),D=(s,r,n)=>{ce({test:s,type:"General Counts",count:r,associated_ids:n,date_filter:l(o.value).format("YYYY-MM-DD")},C())},q=()=>{o.value=""};async function k(){c.value=!0;let s=o.value?l(o.value).format("M"):"",r=o.value?l(o.value).format("yyyy"):"";const n={route:`${J.aggregateReports}culture/organisms_wards_counts?year=${r}&month=${s}&report_id=${v.query.report_id}`,method:"GET",token:`${I.value}`},{data:d,error:g,pending:b}=await X(n);c.value=b,d.value&&(p.value=d.value.data,c.value=!1,A(d.value.report_id),C().$toast.success("Report data generated successfully")),g.value&&(console.error(g.value),c.value=!1,C().$toast.error(Z))}const A=s=>{F.value=s;const n={...x.currentRoute.value.query,report_id:s};x.replace({query:n}).catch(d=>{console.error("Failed to replace route:",d)})};L(o,()=>{if(o){const r={...x.currentRoute.value.query,dateFrom:o?l(o.value).format("M/yyyy"):""};x.replace({query:r}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0});const U=E(()=>v.query.dateFrom!==void 0&&v.query.dateFrom!=="");return K(()=>{U.value&&k()}),(s,r)=>{const n=w("datepicker"),d=ee,g=w("FormKit"),b=oe,V=w("excel"),G=se,W=te;return u(),m("div",null,[e("div",de,[i(g,{type:"form","submit-label":"Update",onSubmit:k,actions:!1},{default:S(({value:a})=>[e("div",ue,[e("div",me,[i(t(le),{class:"w-5 h-5 mr-2"}),h(" Filter By Date Range "),e("div",_e,[i(n,{onCleared:q,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:t(o),"onUpdate:modelValue":r[0]||(r[0]=y=>z(o)?o.value=y:null),format:"M/yyyy"},null,8,["modelValue"])])]),e("div",pe,[i(d,{type:"submit",color:"primary",text:"Generate Report",icon:t(ie),click:()=>{},loading:t(c)},null,8,["icon","loading"])])])]),_:1}),e("div",null,[i(V,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ${t(l)(t(o)).format("M/yyyy")}`,t(R).details.name,t(R).details.address,t(R).details.phone],data:t(O),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_in_wards_counts_report_${t(l)(t(o)).format("M_yyyy")}.xls`},{default:S(()=>[i(b,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",ye,[e("div",fe,[he,i(G)]),e("div",null,[e("h3",ve,[h(" Data for period: "),e("span",xe,_(t(o)==""?"":t(l)(t(o)).format("M/yyyy")),1)])]),t(p).length>0&&!t(c)?(u(),m("div",ge,[e("table",Re,[e("thead",be,[e("tr",we,[(u(!0),m(N,null,M(t($),(a,y)=>(u(),m("th",{class:"px-2 py-2 border-r",key:y},_(a.name),1))),128))])]),e("tbody",null,[(u(!0),m(N,null,M(t(p),(a,y)=>(u(),m("tr",{key:y,class:"border-b"},[e("td",Ce,_(a.ward),1),e("td",ke,_(a.encounter),1),e("td",Ee,_(String(t(v).query.dateFrom)),1),e("td",Se,_(a.organism),1),e("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:qe=>D(`Organisms in Wards Counts (${a.organism}) - ${a.ward}, ${a.encounter}`,a.count,a.associated_ids)},_(a.count),9,Ne)]))),128))])],512)])):T("",!0),Q(e("div",Me,[i(W),Te],512),[[H,t(c)]]),t(p).length==0&&!t(c)?(u(),m("div",$e,Oe)):T("",!0)])])}}});export{Le as default};
