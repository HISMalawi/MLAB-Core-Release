import{_ as G}from"./BvEqexTj.js";import{b as _,e as k,g as o,a as O,u as v,l as M,m as u,f as s,n as p,p as V,x as q,s as S,_ as T,t as U,P as w,i as D,v as P,F as A,j as B}from"./DkSHUfZG.js";import{_ as W}from"./BNCtDB5Q.js";import{e as R}from"./B5NVDA4R.js";import{S as x}from"./Bws7QizP.js";import{r as j}from"./CFqEtL_8.js";import{r as Y}from"./lQpKi9YL.js";import{r as F}from"./DPnmkidM.js";import{r as J}from"./DPH2a7O9.js";import{S as X,h as K,Y as H,G as Q,V as E}from"./C_hGcfdC.js";import{_ as $}from"./CaB7BVGy.js";import{r as Z}from"./BX6JXNJd.js";import{r as ee}from"./CEYBmAkp.js";import{r as L}from"./D5CWeJJk.js";import{u as te}from"./uQJ05scD.js";import{P as oe}from"./Bf5grz7u.js";import{r as se}from"./BT_g8CmU.js";import{r as ie}from"./Bqk_Cgrm.js";import{r as re}from"./CH6bbBJF.js";import{_ as ae}from"./IQzdcCmk.js";import"./Bit5kMcC.js";import"./jXHX7K2g.js";import"./DGb1bV5M.js";import"./D2LBdSgo.js";import"./BzCrDE1y.js";import"./BwUwUGKT.js";import"./_yfpsPGK.js";import"./DthfA08H.js";function z(i,t){return _(),k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375Z"}),o("path",{"fill-rule":"evenodd",d:"m3.087 9 .54 9.176A3 3 0 0 0 6.62 21h10.757a3 3 0 0 0 2.995-2.824L20.913 9H3.087ZM12 10.5a.75.75 0 0 1 .75.75v4.94l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72v-4.94a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const ne={components:{TransitionRoot:X,TransitionChild:K,Dialog:H,DialogPanel:Q,DialogTitle:E,XMarkIcon:j,UserIcon:Y},props:{data:{required:!0,type:Object}},data(){return{open:!1,checkIcon:z,saveIcon:F,clearIcon:J,cookie:O("token"),quantityRequested:0,quantityIssued:0,quantityCollected:0,notCollectedReason:"",batchNumber:"",lotNumber:"",remarks:"",expirtyDate:"",loading:!1}},computed:{isNotCollected(){return this.quantityCollected<this.quantityIssued},quantityNotCollected(){return this.quantityIssued-this.quantityCollected}},methods:{async receiveRequisition(){this.loading=!0;const i=new x,t={stock_requisition_id:this.data.id,requisition:{quantity_received:this.quantityCollected,quantity_issued:this.quantityIssued,quantity_not_collected:this.quantityNotCollected,not_collected_reason:this.notCollectedReason},transaction:{lot:this.lotNumber,batch:this.batchNumber,expiry_date:this.expirtyDate,remarks:this.remarks}},{data:l,error:d,pending:e}=await i.receiveStockOrderRequisition(`${this.cookie}`,t);this.loading=e,l.value&&(v().$toast.success("Stock order requisition received successfully"),this.$emit("update",!0),this.loading=!1,this.handleClick()),d.value&&(console.error(d.value),this.handleClick(),v().$toast.error(R),this.loading=!1)},handleClick(){this.open=!this.open}}},le=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),de={class:"fixed inset-0 overflow-y-auto"},ce={class:"flex min-h-full items-center justify-center p-4 text-center"},ue={class:"border-b px-3 py-3 flex items-center justify-between"},me=o("img",{src:$,class:"w-8 h-8 mr-2"},null,-1),pe={class:"px-5 py-5 space-y-3"},he={class:"relative flex flex-col space-y-2.5"},_e=o("label",{class:"font-medium"},"Date Expiry",-1),ve={class:"mt-5 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function fe(i,t,l,d,e,r){const f=T,g=u("TransitionChild"),m=u("DialogTitle"),C=u("XMarkIcon"),h=u("FormKit"),n=u("datepicker"),a=W,y=u("DialogPanel"),I=u("Dialog"),N=u("TransitionRoot");return _(),k("div",null,[o("div",null,[s(f,{text:"Receive",color:"primary",icon:e.checkIcon,click:r.handleClick},null,8,["icon","click"])]),s(N,{appear:"",show:e.open,as:"template"},{default:p(()=>[s(I,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[le]),_:1}),o("div",de,[o("div",ce,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",ue,[s(m,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>[me,V(" Receive Stock Requisition ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>r.handleClick&&r.handleClick(...b))},[s(C,{class:"w-5 h-5"})])]),s(h,{type:"form","submit-label":"Update",actions:!1,onSubmit:r.receiveRequisition,id:"submitForm"},{default:p(({value:b})=>[o("div",pe,[s(h,{type:"number",label:"Quantity issued",modelValue:e.quantityIssued,"onUpdate:modelValue":t[1]||(t[1]=c=>e.quantityIssued=c),validation:"required"},null,8,["modelValue"]),s(h,{type:"number",label:"Quantity collected",modelValue:e.quantityCollected,"onUpdate:modelValue":t[2]||(t[2]=c=>e.quantityCollected=c),validation:"required"},null,8,["modelValue"]),r.isNotCollected?(_(),q(h,{key:0,disabled:"",type:"number",label:"Quantity not collected",modelValue:r.quantityNotCollected,"onUpdate:modelValue":t[3]||(t[3]=c=>r.quantityNotCollected=c),validation:"required"},null,8,["modelValue"])):S("",!0),r.isNotCollected?(_(),q(h,{key:1,type:"textarea",label:"Provide a reason for quantity not collected",modelValue:e.notCollectedReason,"onUpdate:modelValue":t[4]||(t[4]=c=>e.notCollectedReason=c),validation:"required"},null,8,["modelValue"])):S("",!0),s(h,{type:"text",label:"Lot number",modelValue:e.lotNumber,"onUpdate:modelValue":t[5]||(t[5]=c=>e.lotNumber=c)},null,8,["modelValue"]),s(h,{type:"text",label:"Batch number",modelValue:e.batchNumber,"onUpdate:modelValue":t[6]||(t[6]=c=>e.batchNumber=c)},null,8,["modelValue"]),o("div",he,[_e,s(n,{required:"",teleport:!0,position:"center",range:!1,placeholder:"-- select expiry date --",minDate:new Date,"input-classes":"border font-none rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.expirtyDate,"onUpdate:modelValue":t[7]||(t[7]=c=>e.expirtyDate=c),format:"dd/MM/yyyy"},null,8,["minDate","modelValue"])]),s(h,{type:"textarea",label:"Remarks",modelValue:e.remarks,"onUpdate:modelValue":t[8]||(t[8]=c=>e.remarks=c),validation:"required"},null,8,["modelValue"])]),o("div",ve,[s(a,{text:"Clear form",click:()=>{}}),s(f,{loading:e.loading,type:"submit",color:"success",icon:e.saveIcon,click:()=>{},text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ge=M(ne,[["render",fe]]),ye={components:{TransitionRoot:X,TransitionChild:K,Dialog:H,DialogPanel:Q,DialogTitle:E,XMarkIcon:j,NoSymbolIcon:Z,ExclamationTriangleIcon:ee,ArchiveBoxXMarkIcon:L},data(){return{show:!1,notCollectedIcon:L,loading:!1,statusLoading:!1,reason:"",cookie:O("token")}},props:{data:{type:Object,required:!0},orderId:{type:String,required:!0}},methods:{async acceptNotCollected(){this.statusLoading=!0;const i=new x,t={route:"stock_requisition_not_collected",stock_requisition_id:this.data.id,stock_status_reason:this.reason},{data:l,error:d,pending:e}=await i.updateStockOrderStatus(`${this.cookie}`,t);this.statusLoading=e,l.value&&(this.$emit("update",!0),this.statusLoading=!1,this.reason="",this.handleClick(),v().$toast.success("Stock order requisition not collected successfully!")),d.value&&(console.error(d.value),this.statusLoading=!1)},handleClick(){this.show=!this.show}}},ke=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),be={class:"fixed inset-0 overflow-y-auto"},xe={class:"flex min-h-full items-center justify-center p-4 text-center"},Ce={class:"border-b px-3 py-3 flex items-center justify-between"},Ve={class:"mt-2 space-y-3 px-5"},we={class:"rounded px-2 py-2"},qe={class:"font-semibold text-red-500"},Se={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Ie(i,t,l,d,e,r){const f=T,g=u("TransitionChild"),m=u("ArchiveBoxXMarkIcon"),C=u("DialogTitle"),h=u("XMarkIcon"),n=u("FormKit"),a=W,y=u("DialogPanel"),I=u("Dialog"),N=u("TransitionRoot");return _(),k("div",null,[s(f,{click:r.handleClick,color:"error",text:"Not Received",icon:e.notCollectedIcon},null,8,["click","icon"]),s(N,{appear:"",show:e.show,as:"template"},{default:p(()=>[s(I,{as:"div",class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[ke]),_:1}),o("div",be,[o("div",xe,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",Ce,[s(C,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:p(()=>[s(m,{class:"h-5 w-5 mr-2"}),V(" Confirm Not Collected ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>r.handleClick&&r.handleClick(...b))},[s(h,{class:"w-5 h-5"})])]),s(n,{type:"form","submit-label":"Update",onSubmit:t[2]||(t[2]=b=>r.acceptNotCollected()),actions:!1},{default:p(({value:b})=>[o("div",Ve,[o("div",we,[V(" Please provide a reason why "),o("span",qe,U(l.data.item.name),1),V(" from the Order "),o("strong",null,U(l.orderId),1),V(" was not collected? Note that once this action is completed, it can not be undone ")]),s(n,{type:"textarea",label:"Reason",validation:"required",modelValue:e.reason,"onUpdate:modelValue":t[1]||(t[1]=c=>e.reason=c)},null,8,["modelValue"])]),o("div",Se,[s(a,{click:()=>{r.handleClick()},type:"button",text:"Cancel"},null,8,["click"]),s(f,{loading:e.statusLoading,type:"submit",click:()=>{},color:"error",icon:e.notCollectedIcon,text:"Reject"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ne=M(ye,[["render",Ie]]),De={setup(){te({title:`${oe.name.toUpperCase()} - Receive Stock Order`})},components:{TicketIcon:se},data(){return{header:"Receive Stock Order",checkIcon:z,saveIcon:F,allIcon:ie,rejectIcon:Z,pages:[{name:"Home",link:"/home"},{name:"Stock Orders",link:"/stock-management/orders"}],cookie:O("token"),deleteicon:re,loading:!1,adding:!1,receiving:!1,verifying:!1,requisitions:new Array,voidReason:"",issuerName:"",issuerDesignation:"",issuerPhone:"",issuerSignature:"",approverName:"",approverDesignation:"",approverPhone:"",approverSignature:"",pharmacyWorkers:new Array}},created(){this.init()},computed:{hasApprover(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="approver")},hasIssuer(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="issuer")}},methods:{async addPharmacyWorker(i){this.adding=!0;const t=new x,l={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:r}=await t.createStockOrderPharmacy(`${this.cookie}`,l);this.adding=r,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details saved successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(R),this.adding=!1)},async updatePharmacyWorker(i){this.adding=!0;const t=new x,l={pharmacy_id:this.pharmacyWorkers.filter(f=>f.record_type==i)[0].id,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:r}=await t.updateStockOrderPharmacy(`${this.cookie}`,l);this.adding=r,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details updated successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(R),this.adding=!1)},async init(){this.loading=!0;const i=new x,{data:t,error:l,pending:d}=await i.getStockOrder(`${this.cookie}`,`${(this._.provides[w]||this.$route).query.order_id}`);this.loading=d,t.value&&(this.requisitions=t.value.stock_requisitions,t.value.stock_pharmacy_approver_and_issuers.map(e=>{e.record_type=="issuer"?(this.issuerName=e.name,this.issuerPhone=e.phone_number,this.issuerDesignation=e.designation,this.issuerSignature=e.signature):(this.approverName=e.name,this.approverPhone=e.phone_number,this.approverDesignation=e.designation,this.approverSignature=e.signature)}),this.pharmacyWorkers=t.value.stock_pharmacy_approver_and_issuers,this.loading=!1),l.value&&(console.error(l.value),this.loading=!1)},deleteStockItem(i){i>=0&&i<this.requisitions.length&&this.requisitions.splice(i,1)},isReceivedOrNotCollected(i){for(let t=0;t<i.length;t++)if(i[t].requisition_status.toLowerCase()==="received"||i[t].requisition_status.toLowerCase()==="not collected")return!0;return!1},async receiveOrder(){if(this.isReceivedOrNotCollected(this.requisitions))if(this.hasApprover&&this.hasIssuer){this.receiving=!0;const i=new x,t={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`},{data:l,error:d,pending:e}=await i.receiveStockOrder(`${this.cookie}`,t);this.receiving=e,l.value&&(v().$toast.success("Stock order received successfully!"),this.$router.push("/stock-management/orders"),this.receiving=!1),d.value&&(console.error(d.value),this.receiving=!1)}else v().$toast.warn("Order should be issued and approved by pharmacy!");else v().$toast.warn("Please enter the amount recieved or mark as not collected!")}}},Pe={class:"px-5 py-5"},Ue={class:"py-5 flex items-center justify-between"},Re={class:"text-2xl font-semibold"},Oe={class:"py-2"},Me=o("div",{class:"flex items-center space-x-3"},[o("img",{src:ae,class:"w-8 h-8"}),o("h3",{class:"text-xl font-semibold"},"Pharmacy")],-1),Te={class:"border rounded mt-3"},Ae=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Issuer ",-1),Be={class:"px-5 py-5"},Le={class:"grid grid-cols-4 gap-5"},We={class:"border rounded mt-3"},je=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Approver ",-1),Fe={class:"px-5 py-5"},Xe={class:"grid grid-cols-4 gap-5"},Ke={class:"rounded border"},He=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Stock Items ",-1),Qe={class:"grid grid-cols-4 gap-4 mt-5"},Ee={class:"flex flex-col space-y-2"},Ze={class:"mt-8 flex space-x-2.5 items-center"},ze=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10 mt"},null,-1),Ge=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Ye=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Je=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),$e=[ze,Ge,Ye,Je];function et(i,t,l,d,e,r){const f=G,g=T,m=u("FormKit"),C=ge,h=Ne;return _(),k("div",Pe,[s(f,{pages:e.pages},null,8,["pages"]),o("div",Ue,[o("h3",Re,U(e.header),1),s(g,{text:"Receive Order",color:"success",icon:e.checkIcon,click:()=>r.receiveOrder()},null,8,["icon","click"])]),o("div",null,[D(o("div",Oe,[Me,o("div",Te,[Ae,o("div",Be,[s(m,{type:"form","submit-label":"Update",onSubmit:t[4]||(t[4]=n=>r.hasIssuer?r.updatePharmacyWorker("issuer"):r.addPharmacyWorker("issuer")),actions:!1},{default:p(({value:n})=>[o("div",Le,[s(m,{type:"text",label:"Name",modelValue:e.issuerName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.issuerName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.issuerDesignation,"onUpdate:modelValue":t[1]||(t[1]=a=>e.issuerDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.issuerPhone,"onUpdate:modelValue":t[2]||(t[2]=a=>e.issuerPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.issuerSignature,"onUpdate:modelValue":t[3]||(t[3]=a=>e.issuerSignature=a),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:r.hasIssuer?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:r.hasIssuer?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])]),o("div",We,[je,o("div",Fe,[s(m,{type:"form","submit-label":"Update",onSubmit:t[9]||(t[9]=n=>r.hasApprover?r.updatePharmacyWorker("approver"):r.addPharmacyWorker("approver")),actions:!1},{default:p(({value:n})=>[o("div",Xe,[s(m,{type:"text",label:"Name",modelValue:e.approverName,"onUpdate:modelValue":t[5]||(t[5]=a=>e.approverName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.approverDesignation,"onUpdate:modelValue":t[6]||(t[6]=a=>e.approverDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.approverPhone,"onUpdate:modelValue":t[7]||(t[7]=a=>e.approverPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.approverSignature,"onUpdate:modelValue":t[8]||(t[8]=a=>e.approverSignature=a),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:r.hasApprover?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:r.hasApprover?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])])],512),[[P,!e.loading]]),D(o("div",Ke,[He,(_(!0),k(A,null,B(e.requisitions,(n,a)=>(_(),k("div",{class:"flex flex-col space-y-3 px-5 py-5",key:a},[o("div",Qe,[o("div",Ee,[s(m,{label:"Stock item",disabled:!0,modelValue:n.item.name,"onUpdate:modelValue":y=>n.item.name=y},null,8,["modelValue","onUpdate:modelValue"])]),s(m,{label:"Quantity requested",type:"number",validation:"required",modelValue:n.quantity_requested,"onUpdate:modelValue":y=>n.quantity_requested=y,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),o("div",Ze,[n.requisition_status.toLowerCase()!=="received"?(_(),q(C,{key:0,data:n,onUpdate:r.init},null,8,["data","onUpdate"])):S("",!0),n.requisition_status.toLowerCase()!=="received"?(_(),q(h,{key:1,onUpdate:r.init,data:n,orderId:`${(i._.provides[w]||i.$route).params.voucherId}`},null,8,["onUpdate","data","orderId"])):S("",!0)])])]))),128))],512),[[P,!e.loading]]),D(o("div",null,[(_(),k(A,null,B(5,n=>o("div",{class:"flex items-center space-x-3 mb-3",key:n},$e)),64))],512),[[P,e.loading]])])])}const Nt=M(De,[["render",et]]);export{Nt as default};
