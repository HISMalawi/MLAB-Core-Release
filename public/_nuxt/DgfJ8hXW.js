import{_ as Xe}from"./CNMhSPC9.js";import{b as d,e as p,g as t,s as Qe,i as U,v as G,F as I,k as O,J as w,d as et,M as tt,al as st,r as a,a as nt,u as be,I as at,c as h,o as ot,x as W,f as v,h as s,t as u,z as b,X as we,C as k,H as xe,A as lt,l as C,m as T,ao as rt,E as it,_ as ut,n as dt}from"./B6cxelmB.js";import{_ as ct}from"./CDRCXyuD.js";import{u as he,P as pt}from"./C9kSM0Lo.js";import{P as mt}from"./D4--2Hlb.js";import{u as ft}from"./CZuTiJYT.js";import{u as vt}from"./BUl5Z4e1.js";import{r as _t}from"./DZ0fSVSz.js";import{r as gt}from"./D4gN629H.js";import{r as yt}from"./C5kJqlRV.js";import{r as bt}from"./sNlg2jLO.js";import"./ggmJqlUs.js";import"./D3aePf0O.js";import"./D2wjyI06.js";import"./1lOtxyWh.js";import"./DnKNuaHm.js";import"./CRKLI29b.js";import"./48QfwrLv.js";import"./81D-L97k.js";import"./KGHA3aGV.js";import"./DjfbvY8W.js";import"./CW8KkBU1.js";function wt(F,_){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M2.625 6.75a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0A.75.75 0 0 1 8.25 6h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75ZM2.625 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0ZM7.5 12a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12A.75.75 0 0 1 7.5 12Zm-4.875 5.25a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}function xt(F,_){return d(),p("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M15 3.75H9v16.5h6V3.75ZM16.5 20.25h3.375c1.035 0 1.875-.84 1.875-1.875V5.625c0-1.036-.84-1.875-1.875-1.875H16.5v16.5ZM4.125 3.75H7.5v16.5H4.125a1.875 1.875 0 0 1-1.875-1.875V5.625c0-1.036.84-1.875 1.875-1.875Z"})])}const ht={props:{loading:{required:!0,type:Boolean},isGrid:{required:!0,type:Boolean}}},kt={class:"py-3 px-3"};function Mt(F,_,y,R,D,A){return U((d(),p("div",kt,[t("div",{class:w({"grid grid-cols-3 gap-3":y.isGrid,"flex flex-col gap-3":!y.isGrid})},[(d(),p(I,null,O(6,P=>t("div",{key:P,class:w({"w-full col-span-1 h-8 bg-gray-100 rounded animate-pulse":y.isGrid,"w-full h-8 bg-gray-100 rounded animate-pulse":!y.isGrid})},null,2)),64))],2),_[0]||(_[0]=t("div",{class:"w-full h-32 bg-gray-100 rounded animate-pulse mt-3"},null,-1)),_[1]||(_[1]=t("div",{class:"w-32 h-8 bg-gray-100 rounded animate-pulse mt-3"},null,-1))],512)),[[G,y.loading]])}const $t=Qe(ht,[["render",Mt]]),Ct={class:"p-5"},Tt={class:"flex items-center justify-between py-5"},Rt={class:"text-2xl font-semibold"},Dt={class:"grid grid-cols-5 gap-4"},At={class:"flex flex-col space-y-4 col-span-2 order-2"},Yt={class:"rounded border"},Et={class:"w-full flex items-center",style:{"padding-bottom":"20px"}},St={class:"w-full space-y-2.5 py-5"},qt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},jt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Nt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Bt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Lt={class:"rounded border"},Vt={class:"w-full flex items-center"},Pt={class:"w-full space-y-2.5 py-5"},Ut={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Gt={class:"w-full py-2 px-4 flex justify-between items-center"},It={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Ot={class:"w-full py-2 px-4 flex justify-between items-center"},Ft={class:"rounded border"},Zt={class:"w-full flex items-center max-h-60 overflow-y-auto"},Ht={class:"w-full py-5"},zt={class:"w-full flex items-center pb-0 pt-72"},Kt={class:"w-full space-y-2 py-5"},Wt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Jt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Xt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Qt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},es={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},ts={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},ss={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},ns={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},as={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},os={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},ls={class:"rounded border order-1 col-span-3"},rs={class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-medium text-md gap-5 flex justify-between items-center"},is={class:"w-full flex items-center gap-5 flex-row"},us={class:"mr-2"},ds={class:"flex space-x-2 items-center bg-gray-200 rounded"},cs={class:"flex items-center bg-gray-200 rounded"},ps={class:"p-5"},ms=["id"],fs={key:0},vs={key:0,class:"relative flex items-center space-x-1.5"},_s={class:"absolute top-10 right-2"},gs=["id"],ys={class:"text-base font-medium mb-2"},bs=["id"],ws={class:"font-medium mb-2"},xs={class:"w-full mt-3 relative"},Os=et({__name:"index",setup(F){ft({title:`${mt.name.toUpperCase()} - Enter Test Results`});const _=tt(),y=st(),R=a(_.query.accession_number),D=a(_.query.test_id),A=nt("token"),P=be(),J=at(),{$toast:Z}=be(),ke=a({}),Me=a("Enter Test Results"),X=a(""),Q=a(""),ee=a(""),te=a(""),se=a(""),ne=a(""),ae=a(""),oe=a(""),le=a(""),re=a(""),ie=a(""),Y=a(""),ue=a(""),de=a(""),ce=a(""),pe=a(""),E=a({value:"",unit:""}),g=a([]),M=a(!1),S=a(!1),q=a(!1),j=a(!1),N=a(!1),me=a(!0),B=a(""),fe=a(!1),ve=a({}),H=a(""),$e=a({id:0,initiator:{id:0}}),Ce=_t,Te=gt,Re=yt,De=bt,Ae=a([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),{value:z}=vt("test_name_display","preferred_name"),Ye=h(()=>{const n=J.user.preferences.find(e=>e.name==="grid_or_list_enter_result_view");return((n==null?void 0:n.value)??"grid")==="grid"}),f=a(Ye.value),Ee=h(()=>g.value.filter(n=>n.type==="numeric"||n.type==="free_text")),Se=h(()=>{const n=g.value.filter(e=>e.type==="auto_complete"||e.type==="alpha_numeric");return n.forEach(e=>{e.ranges.unshift({name:"-- select result --"})}),n}),qe=h(()=>g.value.filter(n=>n.type==="rich_text")),je=h(()=>g.value.filter(n=>n.type==="numeric"||n.type==="free_text").length>0),Ne=h(()=>g.value.filter(n=>n.type==="alpha_numeric"||n.type==="auto_complete").length>0),Be=h(()=>g.value.filter(n=>n.type==="rich_text").length>0),_e=n=>{f.value=n};async function Le(n,e){const l={route:`${C.resultsAvailable}?accession_number=${n}&test_type_id=${e}`,method:"GET",token:`${A.value}`},{data:r,error:c}=await T(l);r.value&&(me.value=!r.value.result_available),c.value&&console.error(c.value)}async function Ve(){S.value=!0;const n={route:`${C.fetchResults}?accession_number=${R.value}`,method:"GET",token:`${A.value}`},{data:e,error:l,pending:r}=await T(n);S.value=r,e.value&&(g.value.forEach(c=>{e.value.forEach(i=>{String(c.id)===String(i.indicator_id)&&i.tracking_number===R.value&&(c.value.name=i.value,H.value=i.machine_name)})}),S.value=!1),l.value&&(console.error(l.value),S.value=!1)}function Pe(n){g.value=[],n&&n.forEach(e=>{var l,r,c,i,m,x;g.value.push({name:String(z.value)=="preferred_name"?e.preferred_name??e.name:e.name,originalName:e.name,id:e.id,machine_name:(l=e.result)==null?void 0:l.machine_name,value:e.test_indicator_type==="free_text"||e.test_indicator_type==="numeric"?{name:e.name.toLowerCase().includes("date")?b((r=e.result)==null?void 0:r.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(c=e.result)==null?void 0:c.value}:((i=e.result)==null?void 0:i.value)!=null?{name:e.name.toLowerCase().includes("date")?b((m=e.result)==null?void 0:m.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(x=e.result)==null?void 0:x.value}:e.test_indicator_type=="rich_text"?{name:""}:{name:"-- select result --"},type:e.test_indicator_type,unit:e.unit,ranges:Ue(e.indicator_ranges,e.id)})})}function Ue(n,e){let l=[];return n&&n.forEach(r=>{l.push({id:e,name:r.value,lowerRange:r.lower_range,upperRange:r.upper_range})}),l}function Ge(){let n=new Array;return g.value.forEach(e=>{var l;n.push({indicator:e.id,value:e.type=="free_text"?e.value.name!==void 0?e.name.toLowerCase().includes("date")?b(e.value.name).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?b(e.value.name).format("DD/MMM/YYYY"):"":e.value.name:null:e.value!==void 0?(l=e==null?void 0:e.name)!=null&&l.toLowerCase().includes("date")?b(e.value).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?b(e.value).format("DD/MMM/YYYY"):"":e.value:null,machine_name:e.value!==null?H.value===""?e.machine_name:H.value:null})}),n}async function Ie(){q.value=!0;let n=Ge().map(i=>(typeof i.value=="object"&&i.value!==null&&(i.value=i.value.name=="-- select result --"?null:i.value.name),i));const e={route:`${C.updateResults}`,method:"POST",token:`${A.value}`,body:{test_id:D.value,test_indicators:n,remarks:B.value}},{data:l,error:r,pending:c}=await T(e);q.value=c,l.value&&(q.value=!1,P.$toast.success("Test results updated successfully"),y.back()),r.value&&(q.value=!1,console.error(r.value))}async function Oe(){N.value=!0;const n={route:`${C.testStatus}/${D.value}/verified`,method:"PUT",token:`${A.value}`},{data:e,error:l,pending:r}=await T(n);N.value=r,e.value&&(N.value=!1,P.$toast.success("Test status authorized successfully!"),y.push("/tests")),l.value&&(console.error(l.value),N.value=!1)}function Fe(n){const e=J.user,l=n.completed_by;if(l){if(l.id!==e.id)return!0;if(l.is_super_admin===!0)return!0}return!1}function Ze(n){return n.status.toLowerCase()==="completed"?Fe(n):!1}async function He(){const{alertConfirmation:n}=he();await n({message:"Do you want to print specimen label?"})&&await pt.printSpecimenLabel(R.value)}function ze(n){if(n.length===0)return"";const e=n[0];return e.lowerRange==null?"":`(Ref ${e.lowerRange} - ${e.upperRange})`}async function Ke(){var c,i;M.value=!0;const n={route:`${C.tests}/${D.value}`,method:"GET"},{data:e,error:l,pending:r}=await T(n);M.value=r,e.value&&(M.value=!1,Q.value=e.value.client.first_name+" "+((c=e.value.client)==null?void 0:c.last_name),X.value=e.value.id,te.value=(i=e.value.client)==null?void 0:i.sex,ee.value=rt(e.value.client.date_of_birth)+"",ne.value=e.value.tracking_number,ae.value=e.value.accession_number,Y.value=e.value.status,se.value=String(z.value)=="preferred_name"?e.value.specimen_type_preferred_name:e.value.specimen_type,ue.value=e.value.requested_by,oe.value=String(z.value)=="preferred_name"?e.value.test_type_preferred_name:e.value.test_type_name,le.value=e.value.requesting_ward,re.value=e.value.created_date,ie.value=e.value.created_date,de.value=e.value.request_origin,E.value=e.value.expected_turn_around_time,B.value=e.value.result_remarks?e.value.result_remarks.value:"",Pe(e.value.indicators),e.value.status_trail.map(m=>{m.status.name.toLowerCase()==="completed"&&($e.value=m,pe.value=`${m.initiator.first_name} ${m.initiator.last_name}`)}),e.value.status_trail.map(m=>{m.status.name.toLowerCase()==="pending"&&(ce.value=`${m.initiator.first_name} ${m.initiator.last_name}`)}),Le(e.value.accession_number,e.value.test_type_id),fe.value=e.value.is_machine_oriented,ve.value=e.value.completed_by,ke.value=e.value),l.value&&(console.error(l.value),M.value=!1)}const We=async(n,e)=>{var x;const l=he();if(((x=n.originalName)==null?void 0:x.toLowerCase())!=="pack no."||e==="")return;j.value=!0;const r={route:`${C.processCrossMatch}/pack_number_exist?pack_number=${e.replaceAll("$","")}`,method:"GET"},{data:c,error:i,pending:m}=await T(r);j.value=m,c.value&&(j.value=!1,c.value.pack_number_exist&&(Z.warning("Pack number already exists"),await l.alertConfirmation({message:`Pack number already exists, you wish to continue? A suffix ${c.value.next_suffix} will be logged`})?Z.warning("A suffix will be logged"):n.value="")),i.value&&(console.error(i.value),Z.error(it),j.value=!1)};return ot(()=>{R.value=`${_.query.accession_number}`,D.value=`${_.query.test_id}`,Ke()}),(n,e)=>{const l=Xe,r=ut,c=ct,i=W("FormKit"),m=dt,x=W("datepicker"),K=W("RichTextEditor"),Je=$t;return d(),p("div",Ct,[v(l,{pages:s(Ae)},null,8,["pages"]),t("div",Tt,[t("h3",Rt,u(s(Me)),1)]),t("div",Dt,[t("div",At,[t("div",Yt,[e[7]||(e[7]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-semibold text-lg"}," Patient Details ",-1)),t("div",null,[t("div",Et,[t("div",St,[t("div",qt,[e[3]||(e[3]=t("p",{class:"font-medium"},"Patient No",-1)),t("p",null,u(s(X)),1)]),t("div",jt,[e[4]||(e[4]=t("p",{class:"font-medium"},"Name",-1)),t("p",null,u(s(Q)),1)]),t("div",Nt,[e[5]||(e[5]=t("p",{class:"font-medium"},"Age",-1)),t("p",null,u(s(ee)),1)]),t("div",Bt,[e[6]||(e[6]=t("p",{class:"font-medium"},"Sex",-1)),t("p",null,u(s(te)),1)])])])])]),t("div",Lt,[e[12]||(e[12]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Specimen Details ",-1)),t("div",null,[t("div",Vt,[t("div",Pt,[t("div",Ut,[e[8]||(e[8]=t("p",{class:"font-medium"},"Specimen Type",-1)),t("p",null,u(s(se)),1)]),t("div",Gt,[e[9]||(e[9]=t("p",{class:"font-medium"},"Tracking Number",-1)),t("p",null,u(s(ne)),1)]),t("div",It,[e[10]||(e[10]=t("p",{class:"font-medium"},"Accession Number",-1)),t("p",null,u(s(ae)),1)]),t("div",Ot,[e[11]||(e[11]=t("p",{class:"font-medium"},"Status",-1)),t("p",null,u(s(Y)),1)])])])])]),t("div",Ft,[e[23]||(e[23]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Test Details ",-1)),t("div",Zt,[t("div",Ht,[t("div",zt,[t("div",Kt,[t("div",Wt,[e[13]||(e[13]=t("p",{class:"font-medium"},"Test Type",-1)),t("p",null,u(s(oe)),1)]),t("div",Jt,[e[14]||(e[14]=t("p",{class:"font-medium"},"Requesting Ward/Location",-1)),t("p",null,u(s(le)),1)]),t("div",Xt,[e[15]||(e[15]=t("p",{class:"font-medium"},"Date Registered",-1)),t("p",null,u(s(b)(s(re)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(we))),1)]),t("div",Qt,[e[16]||(e[16]=t("p",{class:"font-medium"},"Receipt Date",-1)),t("p",null,u(s(b)(s(ie)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(we))),1)]),t("div",es,[e[17]||(e[17]=t("p",{class:"font-medium"},"Test Status",-1)),t("p",null,u(s(Y)),1)]),t("div",ts,[e[18]||(e[18]=t("p",{class:"font-medium"},"Requesting Physician",-1)),t("p",null,u(s(ue)),1)]),t("div",ss,[e[19]||(e[19]=t("p",{class:"font-medium"},"Request Origin",-1)),t("p",null,u(s(de)),1)]),t("div",ns,[e[20]||(e[20]=t("p",{class:"font-medium"},"Registered By",-1)),t("p",null,u(s(ce)),1)]),t("div",as,[e[21]||(e[21]=t("p",{class:"font-medium"},"Performed By",-1)),t("p",null,u(s(pe)),1)]),t("div",os,[e[22]||(e[22]=t("p",{class:"font-medium"},"Turn around time",-1)),t("p",null,u(`${s(E).value} ${Number(s(E).value)==1?s(E).unit.toLowerCase().slice(0,-1):s(E).unit}`),1)])])])])])])]),t("div",ls,[t("div",rs,[t("div",is,[U(v(r,{text:"Fetch results",color:"warning",icon:s(Ce),loading:s(S),disabled:s(me),click:()=>Ve()},null,8,["icon","loading","disabled","click"]),[[G,s(fe)]]),v(r,{text:"Print Accession Number",color:"primary",icon:s(Te),click:()=>He()},null,8,["icon","click"]),U(v(r,{text:"Authorize",color:"success",icon:s(Re),click:()=>Oe(),loading:s(N)},null,8,["icon","click","loading"]),[[G,Ze({status:s(Y),completed_by:s(ve)})]])]),t("div",us,[t("div",ds,[t("div",cs,[t("button",{onClick:e[0]||(e[0]=o=>_e(!0)),class:w([{"bg-sky-500 text-white":s(f),"text-gray-500":!s(f)},"rounded p-2"])},[v(s(xt),{class:"w-5 h-5"})],2),t("button",{onClick:e[1]||(e[1]=o=>_e(!1)),class:w([{"bg-sky-500 text-white":!s(f),"text-gray-500":s(f)},"rounded p-2"])},[v(s(wt),{class:"w-5 h-5"})],2)])])])]),U(t("div",ps,[s(g).length!==0?(d(),p("div",{key:0,class:w({"w-full grid grid-cols-3 gap-4":s(f),"flex flex-col gap-4":!s(f)})},[s(Ne)?(d(),p("div",{key:0,class:w({"col-span-3 grid grid-cols-3 gap-3":s(f),"flex flex-col":!s(f)})},[(d(!0),p(I,null,O(s(Se),(o,L)=>(d(),p("div",{key:L},[t("div",null,[t("p",{class:"font-medium",id:`measure-mapping-id:${o.id}`},u(o.name),9,ms),v(c,{items:o.ranges,modelValue:o.value,"onUpdate:modelValue":$=>o.value=$},null,8,["items","modelValue","onUpdate:modelValue"])])]))),128))],2)):k("",!0),s(je)?(d(),p("div",{key:1,class:w({"col-span-3 grid grid-cols-3 gap-3":s(f),"flex flex-col":!s(f)})},[(d(!0),p(I,null,O(s(Ee),(o,L)=>{var $,ge,ye;return d(),p("div",{key:L},[o.type==="numeric"||o.type==="free_text"?(d(),p("div",fs,[($=o.originalName)!=null&&$.toLowerCase().includes("date")?(d(),p("div",{key:1,id:`measure-mapping-id:${o.id}`},[t("p",ys,u(o.name),1),v(x,{label:o.name,"input-class-name":"datepicker",placeholder:"dd/MM/yyyy",modelValue:o.value.name,"onUpdate:modelValue":V=>o.value.name=V,"text-input":"",format:"dd/MM/yyyy","min-date":new Date},null,8,["label","modelValue","onUpdate:modelValue","min-date"])],8,gs)):(d(),p("div",vs,[v(i,{type:(ge=o.originalName)!=null&&ge.toLowerCase().includes("comment")?"textarea":"text",label:o.name,modelValue:o.value.name,"onUpdate:modelValue":V=>o.value.name=V,modelModifiers:{lazy:!0},help:`${ze(o.ranges)} ${o.unit}`,delay:1e3,id:`measure-mapping-id:${o.id}`,onInput:V=>We(o,V)},null,8,["type","label","modelValue","onUpdate:modelValue","help","id","onInput"]),t("div",_s,[((ye=o.originalName)==null?void 0:ye.toLowerCase())=="pack no."&&s(j)?(d(),xe(m,{key:0,height:20,width:20})):k("",!0)])]))])):k("",!0)])}),128))],2)):k("",!0),s(Be)?(d(),p("div",{key:2,class:w({"col-span-3":s(f),"flex flex-col":!s(f)})},[(d(!0),p(I,null,O(s(qe),(o,L)=>(d(),p("div",{key:L},[t("div",{id:`measure-mapping-id:${o.id}`},[t("p",ws,u(o.name),1),v(K,{theme:"snow",class:"editor",content:o.value.name,"onUpdate:content":$=>o.value.name=$,contentType:"html"},null,8,["content","onUpdate:content"])],8,bs)]))),128))],2)):k("",!0)],2)):k("",!0),t("div",xs,[e[24]||(e[24]=t("p",{class:"font-medium mb-2"},"Remarks",-1)),v(K,{theme:"snow",class:"editor",content:s(B),"onUpdate:content":e[2]||(e[2]=o=>lt(B)?B.value=o:null),contentType:"html"},null,8,["content"])]),s(Y).toLowerCase()!=="verified"?(d(),xe(r,{key:1,loading:s(q),text:"Update Test Results",color:"success",icon:s(De),click:()=>Ie(),class:"mt-5"},null,8,["loading","icon","click"])):k("",!0)],512),[[G,!s(M)]]),v(Je,{loading:s(M),isGrid:s(f)},null,8,["loading","isGrid"])])])])}}});export{Os as default};
