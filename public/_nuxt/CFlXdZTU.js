import{_ as se}from"./B38OGO74.js";import{_ as ae}from"./BWe303fu.js";import{d as ne,r as M,a as le,a5 as ce,aj as de,u as ie,at as j,c as $,C as f,w as Y,o as ue,y as P,b as p,e as m,f as v,h as e,g as a,t as x,k as L,H as V,z as pe,O as C,F as k,j as q,K as B,l as me,E as _e,_ as fe}from"./DaVfplCl.js";import{_ as ve}from"./DjvDPQpG.js";import{_ as ye}from"./BNBlrbgu.js";import{_ as he,a as be}from"./B5IH3IIM.js";import{u as Re,_ as ge}from"./qDaxYYZu.js";import{u as xe}from"./MuIwof8c.js";import{_ as Ee}from"./aVKuZZVS.js";import{_ as De}from"./DlVh0w5e.js";import{u as Te}from"./TCrkXuHj.js";import{P as we}from"./Dr0mg474.js";import{r as Ae}from"./B6aIjIoK.js";import{r as Me}from"./Dqe_SWQt.js";import"./CaCwXEk-.js";import"./Bk1fID9q.js";import"./CrLTzj8x.js";import"./BeuONbta.js";import"./C4Sn6TUr.js";import"./WTOBM9CX.js";import"./BBPlnGp-.js";import"./dfRNb6Oz.js";import"./zVsiTWFb.js";const $e={class:"px-5 py-5"},ke=a("img",{src:Ee,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Ce={class:"w-full flex items-center justify-between"},qe={class:"flex items-center space-x-3"},Oe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Fe={class:"w-72 ml-2"},Se={class:"w-44"},je={class:"flex items-center space-x-3"},Ye={class:"border rounded mt-5"},Pe={class:"flex items-center justify-between px-5 py-5 border-b"},Le=a("div",{class:"flex flex-col space-y-2"},[a("img",{src:De,alt:"app-logo",class:"w-24 h-24 object-cover"}),a("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1),Ve={class:"mt-3 px-5"},Be={class:"text-lg font-semibold mb-2"},Ne={class:"text-normal font-normal"},Ue={key:0,class:"print-container",id:"print-container"},Ge={class:"w-full border border-dotted rounded overflow-x-auto"},He={class:"bg-gray-50 border-b border-dotted rounded-t"},Qe=a("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1),ze=a("th",{class:"border-r border-t border-b border-dotted px-2 py-2"},"TOTAL",-1),Ie={class:"border-r border-b border-dotted px-2 py-2"},Je=["onClick"],Ke={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},We={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Xe=a("img",{src:be,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Ze=a("p",{class:"text-base"},"Please generate report data to preview the report",-1),et=[Xe,Ze],tt="Rejected Samples Report",At=ne({__name:"rejected-samples",setup(ot){xe({title:`${we.name.toUpperCase()} - Rejected Samples Report`});const N=M([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),w=M([]),U=le("token"),O=Te(),g=ce(),i=de(),{loading:y,executeCancellableRequest:G,cancelRequest:H}=Re(),c=M(["",""]),{$toast:A,$metadata:Q}=ie(),u=M(i.query.department?{name:String(i.query.department)}:{name:j}),z=()=>{c.value=new Array("","")},h=M({results:[],value:void 0,wards:[]}),F=$(()=>h.value.results.map(o=>{const t={};o.test_types.forEach(r=>{const{name:s,ward:l,count:b,associated_ids:_}=r;t[s]||(t[s]={}),t[s][l]||(t[s][l]={count:0,associated_ids:""}),t[s][l].count+=b,t[s][l].associated_ids=_});const n=Object.keys(t).map(r=>({name:r,wards:t[r]}));return{name:o.name,testTypes:n}})),I=$(()=>{const o=[];return h.value.results.forEach(t=>{const n={},r={};t.test_types.forEach(s=>{const{name:l,ward:b,count:_}=s;n[l]||(n[l]={},r[l]=0),n[l][b]=_||0,r[l]+=_});for(const s in n){const l=n[s],b={TESTS:s};h.value.wards.forEach(_=>{b[_]=l[_]!==void 0?l[_]:0}),b.TOTAL=r[s],o.push(b)}}),o}),J=(o,t)=>{const n=F.value.find(s=>s.name===o),r=n==null?void 0:n.testTypes.find(s=>s.name===t);return r?Object.values(r.wards).reduce((s,l)=>s+l.count,0):0},E=$(()=>c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):""),D=$(()=>c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"");async function S(){if(K())A.warning("Please select a department");else{y.value=!0;const o={route:`${me.aggregateReports}rejected?from=${E.value}&to=${D.value}&department=${u.value.id==0?"":u.value.id}&report_id=${i.query.report_id}`,method:"GET",token:`${U.value}`},{data:t,error:n,pending:r}=await G(o);y.value=r,t.value&&(y.value=!1,h.value=t.value,W(t.value.report_id),t.value.results.length>0?A.success("Report generated successfully!"):A.warning("Data not found within the specified period")),n.value&&(console.error(n.value),y.value=!1,A.error(_e))}}const K=()=>u.value.name==j,W=o=>{const n={...g.currentRoute.value.query,report_id:o};g.replace({query:n}).catch(r=>{console.error("Failed to replace route:",r)})},X=(o,t,n,r)=>{n!==0&&r!==""?g.push(`/reports/${r}?origin=aggregate&type=rejected-samples-report&from=${E.value}&to=${D.value}&test=${o} - ${t}&department=${u.value.name}&count=${n}`):A.warning("No data found for this month")};Y(c,()=>{const o=c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):"",t=c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"";if(o||t){const r={...g.currentRoute.value.query,...o&&{from:o},...t&&{to:t}};g.replace({query:r}).catch(s=>{console.error("Failed to replace route:",s)})}},{deep:!0}),Y(u,(o,t)=>{if(o!==t){const r={...g.currentRoute.value.query,department:o.name||"",report_id:""};g.replace({query:r}).catch(s=>{console.error("Failed to replace route:",s)})}});const Z=$(()=>i.query.to!==void 0&&i.query.from!==void 0&&i.query.department!==void 0?(c.value=[i.query.from,i.query.to],u.value.name=`${i.query.department}`,i.query.to!==""&&i.query.from!==""&&i.query.department!==""):!1);return ue(()=>{Z.value?S():y.value=!1,w.value=Q.departments,w.value.some(t=>t.name=="All")||w.value.push({id:0,name:"All"}),w.value.sort((t,n)=>{const r=t.name.toUpperCase(),s=n.name.toUpperCase();return r<s?-1:r>s?1:0})}),(o,t)=>{const n=se,r=P("datepicker"),s=ae,l=fe,b=ve,_=ye,ee=P("excel"),te=he,oe=ge;return p(),m("div",$e,[v(n,{pages:e(N)},null,8,["pages"]),a("div",{class:"flex items-center py-5"},[ke,a("h3",{class:"text-2xl font-semibold uppercase"},x(tt))]),a("div",Ce,[a("div",qe,[a("div",Oe,[v(e(Ae),{class:"w-5 h-5 mr-2"}),L(" Filter By Date Range "),a("div",Fe,[v(r,{onCleared:z,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(c),"onUpdate:modelValue":t[0]||(t[0]=T=>V(c)?c.value=T:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),a("div",Se,[v(s,{items:e(w),modelValue:e(u),"onUpdate:modelValue":t[1]||(t[1]=T=>V(u)?u.value=T:null)},null,8,["items","modelValue"])]),v(l,{color:"primary",text:"Generate Report",icon:e(Me),click:()=>S(),loading:e(y)},null,8,["icon","click","loading"])]),a("div",je,[v(b,{printSmallLabel:!1}),v(ee,{class:"btn btn-default",header:[`REJECTED ${e(u).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(C))} TO ${e(f)(e(D)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(C))}`,e(O).details.name,e(O).details.address,e(O).details.phone],data:e(I),worksheet:"report-work-sheet",name:`rejected_${e(u).name.toLowerCase().split(" ").join("_")}_report_${e(f)(e(E)).format("DD_MM_yyyy")}_to_${e(f)(e(D)).format("DD_MM_yyyy")}.xls`},{default:pe(()=>[v(_,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),a("div",Ye,[a("div",Pe,[Le,v(te)]),a("div",Ve,[a("h3",Be,[L(" Tests Performed Period: "),a("span",Ne,x(e(E)!=""?e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(C)):"")+" - "+x(e(D)!=""?e(f)(e(D)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(C)):""),1)])]),e(h).results.length>0&&!e(y)?(p(),m("div",Ue,[a("table",Ge,[(p(!0),m(k,null,q(e(F),(T,re)=>(p(),m(k,{key:re},[a("thead",He,[a("tr",null,[Qe,(p(!0),m(k,null,q(e(h).wards,d=>(p(),m("th",{key:d,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(d),1))),128)),ze])]),a("tbody",null,[(p(!0),m(k,null,q(T.testTypes,d=>(p(),m("tr",{key:d.name},[a("td",Ie,x(d.name),1),(p(!0),m(k,null,q(e(h).wards,R=>(p(),m("td",{key:R,onClick:rt=>X(d.name,R,d.wards[R]?d.wards[R].count:0,d.wards[R]?d.wards[R].associated_ids:""),class:"px-4 border-r border-b border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(d.wards[R]?d.wards[R].count:0),9,Je))),128)),a("td",Ke,x(J(T.name,d.name)),1)]))),128))])],64))),128))])])):B("",!0),v(oe,{condition:e(y),cancelReportGeneration:()=>e(H)()},null,8,["condition","cancelReportGeneration"]),e(h).wards.length==0&&e(h).results.length==0&&!e(y)?(p(),m("div",We,et)):B("",!0)])])}}});export{At as default};
