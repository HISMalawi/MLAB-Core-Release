import{_ as et}from"./DnQNH6n5.js";import{b as g,e as D,g as s,d as ge,r as O,c as E,ar as Ve,Y as be,M as z,F as K,o as qe,O as Fe,as as ye,l as se,m as x,t as k,i as we,v as xe,f as u,z as Oe,a as de,u as q,n as S,p as W,_ as pe,av as tt,s as V,h as B,x as U,j as le,aB as st,k as ot,P as M}from"./CFJLM_Ie.js";import{r as nt,_ as rt}from"./BaCgUW4N.js";import{_ as it}from"./C6UYnv0-.js";import{r as oe}from"./Dhp4HNmj.js";import{_ as lt}from"./BSRxqa4B.js";import{_ as Be}from"./B4k1OJQ0.js";import{e as ee,d as me}from"./Zs5V9wEc.js";import{e as j,f as A,l as at,m as ct,n as ut,h as Y,r as Ee,o as Ne,P as Me,j as ce,i as Ue,c as dt,s as pt}from"./NSQCzdgw.js";import{u as he}from"./B61kAMSl.js";import{r as He}from"./Ce3lpVva.js";import{a as Ce,r as Ze}from"./BmAKWF52.js";import{r as ze}from"./X6D5z3Ai.js";import{r as Ye}from"./B10gWtx9.js";import{q as mt,N as ht,E as ft,n as Ge,d as H,S as ke,h as Se,Y as Te,G as $e,V as Pe}from"./CXlG2fUz.js";import{u as te}from"./Ct03zjsX.js";import{r as ae}from"./SXaV5Ymo.js";import{r as _t}from"./ccM_rzRE.js";import{_ as vt}from"./CNyqjQsr.js";import{u as gt}from"./CbkhdmMI.js";import{P as bt}from"./DnWkowi2.js";import{r as yt}from"./rauhO8aD.js";import{r as wt}from"./DgNWSFHG.js";import{r as xt}from"./1TxO0rPq.js";import{i as Ie,o as m,p as De,a as Q,j as Ct,b as ue,d as kt,m as St,n as Tt,A as Le,I as J,f as fe,u as _e,l as $t,e as je,g as G,P as X,N as Z,T as ve}from"./B307KWXK.js";import{s as Pt}from"./DL7tKmRK.js";import{r as It}from"./CIBAR2Bi.js";import{r as Dt}from"./BL5kvFFC.js";import{r as Ae}from"./BfKLgwf-.js";import{r as Lt}from"./Ds23cvkg.js";import{a as Rt,r as Mt}from"./BIb1_Skx.js";import{r as jt}from"./JKDaAX9j.js";import{r as ie}from"./BnKrpuTE.js";import{r as At}from"./DVj5woSA.js";import{I as Vt,j as qt,E as Ft,A as Ot,F as Bt}from"./sen56F8u.js";import{g as Et,S as Nt,M as Ut,b as Ht}from"./BMGW8D29.js";import"./0YTBxEWP.js";import"./BoZExIdM.js";import"./BwWK-syC.js";import"./C6QRH5hM.js";import"./D72LMua3.js";function Zt(e,o){return g(),D("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M12.97 3.97a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 1 1-1.06-1.06l6.22-6.22H3a.75.75 0 0 1 0-1.5h16.19l-6.22-6.22a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function zt(e,o){return g(),D("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 0 1 1.06 0l6 6a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l4.72-4.72H9a5.25 5.25 0 1 0 0 10.5h3a.75.75 0 0 1 0 1.5H9a6.75 6.75 0 0 1 0-13.5h10.19l-4.72-4.72a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Yt(e,o){return g(),D("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z","clip-rule":"evenodd"})])}var Gt=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Gt||{});let Xe=Symbol("PopoverContext");function Re(e){let o=ye(Xe,null);if(o===null){let n=new Error(`<${e} /> is missing a parent <${We.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Re),n}return o}let Xt=Symbol("PopoverGroupContext");function Ke(){return ye(Xt,null)}let Qe=Symbol("PopoverPanelContext");function Kt(){return ye(Qe,null)}let We=ge({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(e,{slots:o,attrs:n,expose:a}){var t;let r=O(null);a({el:r,$el:r});let l=O(1),i=O(null),P=O(null),T=O(null),w=O(null),p=E(()=>Ie(r)),$=E(()=>{var c,f;if(!m(i)||!m(w))return!1;for(let re of document.querySelectorAll("body > *"))if(Number(re==null?void 0:re.contains(m(i)))^Number(re==null?void 0:re.contains(m(w))))return!0;let h=De(),L=h.indexOf(m(i)),F=(L+h.length-1)%h.length,N=(L+1)%h.length,ne=h[F],Je=h[N];return!((c=m(w))!=null&&c.contains(ne))&&!((f=m(w))!=null&&f.contains(Je))}),v={popoverState:l,buttonId:O(null),panelId:O(null),panel:w,button:i,isPortalled:$,beforePanelSentinel:P,afterPanelSentinel:T,togglePopover(){l.value=Q(l.value,{0:1,1:0})},closePopover(){l.value!==1&&(l.value=1)},close(c){v.closePopover();let f=c?c instanceof HTMLElement?c:c.value instanceof HTMLElement?m(c):m(v.button):m(v.button);f==null||f.focus()}};Ve(Xe,v),Ct(E(()=>Q(l.value,{0:ue.Open,1:ue.Closed})));let R={buttonId:v.buttonId,panelId:v.panelId,close(){v.closePopover()}},C=Ke(),d=C==null?void 0:C.registerPopover,[_,b]=mt(),I=ht({mainTreeNodeRef:C==null?void 0:C.mainTreeNodeRef,portals:_,defaultContainers:[i,w]});function y(){var c,f,h,L;return(L=C==null?void 0:C.isFocusWithinPopoverGroup())!=null?L:((c=p.value)==null?void 0:c.activeElement)&&(((f=m(i))==null?void 0:f.contains(p.value.activeElement))||((h=m(w))==null?void 0:h.contains(p.value.activeElement)))}return be(()=>d==null?void 0:d(R)),ft((t=p.value)==null?void 0:t.defaultView,"focus",c=>{var f,h;c.target!==window&&c.target instanceof HTMLElement&&l.value===0&&(y()||i&&w&&(I.contains(c.target)||(f=m(v.beforePanelSentinel))!=null&&f.contains(c.target)||(h=m(v.afterPanelSentinel))!=null&&h.contains(c.target)||v.closePopover()))},!0),kt(I.resolveContainers,(c,f)=>{var h;v.closePopover(),St(f,Tt.Loose)||(c.preventDefault(),(h=m(i))==null||h.focus())},E(()=>l.value===0)),()=>{let c={open:l.value===0,close:v.close};return z(K,[z(b,{},()=>Le({theirProps:{...e,...n},ourProps:{ref:r},slot:c,slots:o,attrs:n,name:"Popover"})),z(I.MainTreeNode)])}}}),Qt=ge({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(e,{attrs:o,slots:n,expose:a}){var t;let r=(t=e.id)!=null?t:`headlessui-popover-button-${J()}`,l=Re("PopoverButton"),i=E(()=>Ie(l.button));a({el:l.button,$el:l.button}),qe(()=>{l.buttonId.value=r}),Fe(()=>{l.buttonId.value=null});let P=Ke(),T=P==null?void 0:P.closeOthers,w=Kt(),p=E(()=>w===null?!1:w.value===l.panelId.value),$=O(null),v=`headlessui-focus-sentinel-${J()}`;p.value||be(()=>{l.button.value=m($)});let R=Pt(E(()=>({as:e.as,type:o.type})),$);function C(c){var f,h,L,F,N;if(p.value){if(l.popoverState.value===1)return;switch(c.key){case G.Space:case G.Enter:c.preventDefault(),(h=(f=c.target).click)==null||h.call(f),l.closePopover(),(L=m(l.button))==null||L.focus();break}}else switch(c.key){case G.Space:case G.Enter:c.preventDefault(),c.stopPropagation(),l.popoverState.value===1&&(T==null||T(l.buttonId.value)),l.togglePopover();break;case G.Escape:if(l.popoverState.value!==0)return T==null?void 0:T(l.buttonId.value);if(!m(l.button)||(F=i.value)!=null&&F.activeElement&&!((N=m(l.button))!=null&&N.contains(i.value.activeElement)))return;c.preventDefault(),c.stopPropagation(),l.closePopover();break}}function d(c){p.value||c.key===G.Space&&c.preventDefault()}function _(c){var f,h;e.disabled||(p.value?(l.closePopover(),(f=m(l.button))==null||f.focus()):(c.preventDefault(),c.stopPropagation(),l.popoverState.value===1&&(T==null||T(l.buttonId.value)),l.togglePopover(),(h=m(l.button))==null||h.focus()))}function b(c){c.preventDefault(),c.stopPropagation()}let I=Ge();function y(){let c=m(l.panel);if(!c)return;function f(){Q(I.value,{[H.Forwards]:()=>X(c,Z.First),[H.Backwards]:()=>X(c,Z.Last)})===ve.Error&&X(De().filter(h=>h.dataset.headlessuiFocusGuard!=="true"),Q(I.value,{[H.Forwards]:Z.Next,[H.Backwards]:Z.Previous}),{relativeTo:m(l.button)})}f()}return()=>{let c=l.popoverState.value===0,f={open:c},{...h}=e,L=p.value?{ref:$,type:R.value,onKeydown:C,onClick:_}:{ref:$,id:r,type:R.value,"aria-expanded":l.popoverState.value===0,"aria-controls":m(l.panel)?l.panelId.value:void 0,disabled:e.disabled?!0:void 0,onKeydown:C,onKeyup:d,onClick:_,onMousedown:b};return z(K,[Le({ourProps:L,theirProps:{...o,...h},slot:f,attrs:o,slots:n,name:"PopoverButton"}),c&&!p.value&&l.isPortalled.value&&z(fe,{id:v,features:_e.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:y})])}}}),Wt=ge({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(e,{attrs:o,slots:n,expose:a}){var t;let r=(t=e.id)!=null?t:`headlessui-popover-panel-${J()}`,{focus:l}=e,i=Re("PopoverPanel"),P=E(()=>Ie(i.panel)),T=`headlessui-focus-sentinel-before-${J()}`,w=`headlessui-focus-sentinel-after-${J()}`;a({el:i.panel,$el:i.panel}),qe(()=>{i.panelId.value=r}),Fe(()=>{i.panelId.value=null}),Ve(Qe,i.panelId),be(()=>{var b,I;if(!l||i.popoverState.value!==0||!i.panel)return;let y=(b=P.value)==null?void 0:b.activeElement;(I=m(i.panel))!=null&&I.contains(y)||X(m(i.panel),Z.First)});let p=$t(),$=E(()=>p!==null?(p.value&ue.Open)===ue.Open:i.popoverState.value===0);function v(b){var I,y;switch(b.key){case G.Escape:if(i.popoverState.value!==0||!m(i.panel)||P.value&&!((I=m(i.panel))!=null&&I.contains(P.value.activeElement)))return;b.preventDefault(),b.stopPropagation(),i.closePopover(),(y=m(i.button))==null||y.focus();break}}function R(b){var I,y,c,f,h;let L=b.relatedTarget;L&&m(i.panel)&&((I=m(i.panel))!=null&&I.contains(L)||(i.closePopover(),((c=(y=m(i.beforePanelSentinel))==null?void 0:y.contains)!=null&&c.call(y,L)||(h=(f=m(i.afterPanelSentinel))==null?void 0:f.contains)!=null&&h.call(f,L))&&L.focus({preventScroll:!0})))}let C=Ge();function d(){let b=m(i.panel);if(!b)return;function I(){Q(C.value,{[H.Forwards]:()=>{var y;X(b,Z.First)===ve.Error&&((y=m(i.afterPanelSentinel))==null||y.focus())},[H.Backwards]:()=>{var y;(y=m(i.button))==null||y.focus({preventScroll:!0})}})}I()}function _(){let b=m(i.panel);if(!b)return;function I(){Q(C.value,{[H.Forwards]:()=>{let y=m(i.button),c=m(i.panel);if(!y)return;let f=De(),h=f.indexOf(y),L=f.slice(0,h+1),F=[...f.slice(h+1),...L];for(let N of F.slice())if(N.dataset.headlessuiFocusGuard==="true"||c!=null&&c.contains(N)){let ne=F.indexOf(N);ne!==-1&&F.splice(ne,1)}X(F,Z.First,{sorted:!1})},[H.Backwards]:()=>{var y;X(b,Z.Previous)===ve.Error&&((y=m(i.button))==null||y.focus())}})}I()}return()=>{let b={open:i.popoverState.value===0,close:i.close},{focus:I,...y}=e,c={ref:i.panel,id:r,onKeydown:v,onFocusout:l&&i.popoverState.value===0?R:void 0,tabIndex:-1};return Le({ourProps:c,theirProps:{...o,...y},attrs:o,slot:b,slots:{...n,default:(...f)=>{var h;return[z(K,[$.value&&i.isPortalled.value&&z(fe,{id:T,ref:i.beforePanelSentinel,features:_e.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:d}),(h=n.default)==null?void 0:h.call(n,...f),$.value&&i.isPortalled.value&&z(fe,{id:w,ref:i.afterPanelSentinel,features:_e.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:_})])]}},features:je.RenderStrategy|je.Static,visible:$.value,name:"PopoverPanel"})}}});const Jt={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:oe}},es={class:"text-sm"};function ts(e,o,n,a,t,r){const l=x("XMarkIcon");return g(),D("button",{class:Oe(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${n.color}-500`])},[s("p",es,k(n.value.text),1),we(s("button",{onClick:o[0]||(o[0]=(...i)=>r.removeLabel&&r.removeLabel(...i))},[u(l,{class:"w-4 h-4"})],512),[[xe,n.close]])],2)}const ss=se(Jt,[["render",ts]]),os={components:{TransitionRoot:ke,TransitionChild:Se,Dialog:Te,DialogPanel:$e,DialogTitle:Pe,XMarkIcon:oe,UserIcon:He},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:Ce,saveIcon:ze,clearIcon:Ye,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:de("token"),authStore:he(),departmentId:0}},methods:{async init(){this.handleClick();const e=this.authStore.department,o=this.authStore.user.departments.find(n=>n.name===e);o&&(this.departmentId=o.id),this.selectedDepartment=e,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(e){const o={route:`${j.specimenTestTypes}?department_id=${e}&specimen_id=${this.item.specimen_id}`,method:"GET",token:`${this.cookie}`},{error:n,data:a}=await A(o);a.value&&(this.rawTestTypes=a.value,this.testTypes=a.value),n.value&&console.error("error: ",n.value)},async submitForm(){this.loading=!0;let e=this.testTypesSelected.map(t=>({specimen:this.item.specimen_id,test_type:t}));const o={route:`${j.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:e}},{data:n,error:a}=await A(o);n.value&&(this.handleClick(),q().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),a.value&&(this.handleClick(),console.error("error: ",a.value),q().$toast.error(ee),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(e,o){if(e!==o){const n=this.authStore.user.departments.find(a=>a.name===e);n&&(this.departmentId=n.id,this.getTestTypes(this.departmentId))}}}},ns=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),rs={class:"fixed inset-0 overflow-y-auto"},is={class:"flex min-h-full items-center justify-center p-4 text-center"},ls={class:"border-b px-3 py-3 flex items-center justify-between"},as={class:"mt-2 space-y-3 pb-40"},cs={class:"w-full flex flex-col space-y-2 px-5"},us=s("label",{class:"font-medium"},"Department",-1),ds={class:"w-full flex flex-col space-y-2 px-5"},ps=s("label",{class:"font-medium"},"Tests",-1),ms={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function hs(e,o,n,a,t,r){const l=pe,i=x("TransitionChild"),P=x("DialogTitle"),T=x("XMarkIcon"),w=x("multi-select"),p=Be,$=x("FormKit"),v=x("DialogPanel"),R=x("Dialog"),C=x("TransitionRoot");return g(),D("div",null,[s("div",null,[u(l,{text:"Add test to current order",color:"warning",icon:t.editIcon,click:r.init},null,8,["icon","click"])]),u(C,{appear:"",show:t.open,as:"template"},{default:S(()=>[u(R,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[ns]),_:1}),s("div",rs,[s("div",is,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",ls,[u(P,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:S(()=>[W(" Add Test To Current Order ")]),_:1}),s("button",{onClick:o[0]||(o[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[u(T,{class:"w-5 h-5"})])]),u($,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"submitForm"},{default:S(({value:d})=>[s("div",as,[s("div",cs,[us,u(w,{style:{"--ms-max-height":"none !important"},modelValue:t.selectedDepartment,"onUpdate:modelValue":o[1]||(o[1]=_=>t.selectedDepartment=_),options:t.departments.map(_=>_.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),s("div",ds,[ps,u(w,{style:{"--ms-max-height":"none !important"},modelValue:t.testTypesSelected,"onUpdate:modelValue":o[2]||(o[2]=_=>t.testTypesSelected=_),options:t.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),s("div",ms,[u(p,{type:"button",click:()=>r.resetForm(),text:"Clear form"},null,8,["click"]),u(l,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const fs=se(os,[["render",hs]]),_s={components:{TransitionRoot:ke,TransitionChild:Se,Dialog:Te,DialogPanel:$e,DialogTitle:Pe,XMarkIcon:oe,PhoneIcon:at,EnvelopeIcon:ct,MapPinIcon:ut},data(){return{moment:Y,viewIcon:Ze,show:this.open,addIcon:Ee,checkIcon:ae,editIcon:Ce,acceptIcon:Ne,printerIcon:_t,cookie:de("token"),details:{},loading:!1,verifying:!1,zebraPrinting:!1}},props:{open:{type:Boolean,required:!1}},methods:{async init(e){this.loading=!0;const o={route:`${j.tests}/${e.id}`,method:"GET",token:`${this.cookie}`},{data:n,error:a,pending:t}=await A(o);this.loading=t,n.value&&(this.details=n.value,typeof this.details=="object"&&this.handleClick()),a.value&&(this.loading=!1,console.error(a.value),q().$toast.error(ee))},async printBBResults(){const e={route:j.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.details.order_id,tests:[this.details.id],is_cross_match:!0}},{data:o,error:n,pending:a}=await A(e);if(this.zebraPrinting=a,o.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const r=URL.createObjectURL(o.value),l=document.createElement("a");l.href=r,l.setAttribute("download",`${Date.now()}.lbl`),l.click(),URL.revokeObjectURL(r)},t.readAsText(o.value),q().$toast.success("Results printed successfully!")}n.value&&(this.zebraPrinting=!1,q().$toast.error(ee),console.error(n.value))},async changeStatus(e,o){this.verifying=!0;const n={route:`${j.testStatus}/${o}/${e}`,method:"PUT",token:`${this.cookie}`},{data:a,error:t,pending:r}=await A(n);this.verifying=r,a.value&&(this.verifying=!1,q().$toast.success(`${this.details.test_type_name} test for ${this.details.client.first_name} ${this.details.client.middle_name!==null?this.details.client.middle_name:""} ${this.details.client.last_name} verified successfully!`),this.viewReport(!0)),t.value&&(console.error(t.value),this.verifying=!1)},updateChanges(){this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return Me.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return Me.printTrackingNumber(this.details.tracking_number)},viewReport(e=!1){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}&printer=${e}`)},getRequestedBy(e){let o="";return e.forEach(n=>{n.status.name==="pending"&&(o=`${n.initiator.first_name} ${n.initiator.last_name}`)}),ce(o)}}},vs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27%2015V4H10C9.44772%204%209%204.44772%209%205V43C9%2043.5523%209.44772%2044%2010%2044H38C38.5523%2044%2039%2043.5523%2039%2043V16H28C27.4477%2016%2027%2015.5523%2027%2015ZM29%2014V4.58579L38.4142%2014H29ZM17%2019C17%2018.4477%2017.4477%2018%2018%2018H23C25.2091%2018%2027%2019.7909%2027%2022C27%2024.0759%2025.4186%2025.7825%2023.3948%2025.9808L27%2029.5859L30.2929%2026.293L31.7072%2027.7072L28.4142%2031.0001L31.7071%2034.293L30.2928%2035.7072L27%2032.4143L23.7072%2035.7072L22.2929%2034.293L25.5858%2031.0001L20.5857%2026H19V33H17V25V19ZM23%2024H19V20H23C24.1046%2020%2025%2020.8954%2025%2022C25%2023.1046%2024.1046%2024%2023%2024Z'%20fill='currentColor'/%3e%3c/svg%3e",gs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M19%204C18.4477%204%2018%204.44772%2018%205V8C18%208.55228%2018.4477%209%2019%209H20V11.2729C19.4174%2011.4788%2019%2012.0344%2019%2012.6875V39C19%2041.7614%2021.2386%2044%2024%2044C26.7614%2044%2029%2041.7614%2029%2039V12.6875C29%2012.0344%2028.5826%2011.4788%2028%2011.2729V9H29C29.5523%209%2030%208.55228%2030%208V5C30%204.44772%2029.5523%204%2029%204H19ZM22%2011.6875V9H26V11.6875C26%2012.3406%2026.4174%2012.8962%2027%2013.1021V18H21V13.1021C21.5826%2012.8962%2022%2012.3406%2022%2011.6875Z'%20fill='currentColor'/%3e%3c/svg%3e",bs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M28.7526%206.3415C28.4782%206.02797%2028.0383%205.91736%2027.6483%206.0639C27.2583%206.21043%2027%206.58339%2027%207V14C27%2015.1046%2027.8954%2016%2029%2016H35C35.3924%2016%2035.7485%2015.7705%2035.9106%2015.4132C36.0728%2015.0559%2036.011%2014.6368%2035.7526%2014.3415L28.7526%206.3415ZM20.75%2023H19.25L20%2021.2L20.75%2023ZM27.5576%205L37%2015.3866V40C37%2041.6569%2035.6569%2043%2034%2043H14C12.3431%2043%2011%2041.6569%2011%2040V8C11%206.34315%2012.3431%205%2014%205H27.5576ZM21.8462%2015.2308C21.5356%2014.4855%2020.8074%2014%2020%2014C19.1926%2014%2018.4644%2014.4855%2018.1538%2015.2308L13.1538%2027.2308C12.729%2028.2504%2013.2112%2029.4213%2014.2308%2029.8462C15.2504%2030.271%2016.4213%2029.7888%2016.8462%2028.7692L17.5833%2027H22.4167L23.1538%2028.7692C23.5787%2029.7888%2024.7496%2030.271%2025.7692%2029.8462C26.7888%2029.4213%2027.271%2028.2504%2026.8462%2027.2308L26.7432%2026.9837C26.8273%2026.9944%2026.913%2027%2027%2027H28V28C28%2029.1046%2028.8954%2030%2030%2030C31.1046%2030%2032%2029.1046%2032%2028V27H33C34.1046%2027%2035%2026.1046%2035%2025C35%2023.8954%2034.1046%2023%2033%2023H32V22C32%2020.8954%2031.1046%2020%2030%2020C28.8954%2020%2028%2020.8954%2028%2022V23H27C26.3521%2023%2025.7762%2023.3081%2025.4107%2023.7857L21.8462%2015.2308ZM15%2031C13.8954%2031%2013%2031.8954%2013%2033C13%2034.1046%2013.8954%2035%2015%2035C13.8954%2035%2013%2035.8954%2013%2037C13%2038.1046%2013.8954%2039%2015%2039H27C28.1046%2039%2029%2038.1046%2029%2037C29%2035.8962%2028.1058%2035.0012%2027.0023%2035H33C34.1046%2035%2035%2034.1046%2035%2033C35%2031.8954%2034.1046%2031%2033%2031L15%2031Z'%20fill='currentColor'%20stroke='%23333333'%20stroke-width='2'%20stroke-linejoin='round'/%3e%3c/svg%3e",ys={key:0},ws=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),xs={class:"fixed inset-0 overflow-y-auto"},Cs={class:"flex min-h-full items-center justify-center text-center"},ks={class:"border-b px-3 py-3 flex items-center justify-between"},Ss=s("img",{src:vs,class:"w-8 h-8 mr-2"},null,-1),Ts={class:"flex items-center justify-center mx-auto my-20"},$s={class:"grid grid-cols-3 gap-4 px-5 py-5"},Ps={class:"rounded border"},Is=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[s("h3",{class:"text-lg font-semibold text-black flex items-center"},[s("img",{src:st,class:"w-7 h-7 mr-1"}),W(" Patient ")])],-1),Ds={class:"w-full space-y-2 py-2"},Ls={class:"w-full flex justify-between px-4 py-1"},Rs=s("h3",{class:"font-semibold"},"Patient Number",-1),Ms={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},js=s("h3",{class:"font-semibold"},"Name",-1),As={class:"w-full flex justify-between px-4 py-1"},Vs=s("h3",{class:"font-semibold"},"Sex",-1),qs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Fs=s("h3",{class:"font-semibold"},"Age",-1),Os={class:"rounded border"},Bs=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[s("h3",{class:"text-lg font-semibold text-black flex items-center"},[s("img",{src:gs,class:"w-7 h-7 mr-1"}),W(" Specimen ")])],-1),Es={class:"w-full space-y-2 py-2"},Ns={class:"w-full flex justify-between px-4 py-1"},Us=s("h3",{class:"font-semibold"},"Specimen Type",-1),Hs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Zs=s("h3",{class:"font-semibold"},"Tracking Number",-1),zs={class:"w-full flex justify-between px-4 py-1"},Ys=s("h3",{class:"font-semibold"},"Accession Number",-1),Gs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Xs=s("h3",{class:"font-semibold"},"Status",-1),Ks={class:"rounded border max-h-72 overflow-y-auto"},Qs=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[s("img",{src:bs,class:"w-7 h-7 mr-1"}),s("h3",{class:"text-lg font-semibold text-black"},"Test")],-1),Ws={class:"w-full space-y-2 py-2"},Js={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},eo=s("h3",{class:"font-semibold"},"Name",-1),to={class:"w-full flex justify-between px-4 py-1"},so=s("h3",{class:"font-semibold"},"Date Registered",-1),oo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},no=s("h3",{class:"font-semibold"},"Receipt Date",-1),ro={class:"w-full flex justify-between px-4 py-1"},io=s("h3",{class:"font-semibold"},"Test Status",-1),lo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ao=s("h3",{class:"font-semibold"},"Ward/Location",-1),co={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},uo=s("h3",{class:"font-semibold"},"Request Origin",-1),po={class:"w-full flex justify-between px-4 py-1"},mo=s("h3",{class:"font-semibold"},"Registered By",-1),ho={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},fo=s("h3",{class:"font-semibold"},"Requested By",-1),_o={class:"mx-5 rounded border mb-5"},vo={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},go=s("h3",{class:"text-lg font-semibold text-black"},"Results",-1),bo={class:"justify-end flex items-center space-x-3"},yo={class:"flex items-center space-x-1"},wo=["innerHTML"],xo={key:1,class:"text-xs"},Co={key:0,class:"px-2.5 py-2.5 border-t"};function ko(e,o,n,a,t,r){const l=lt,i=x("TransitionChild"),P=x("DialogTitle"),T=x("XMarkIcon"),w=ot,p=pe,$=fs,v=x("DialogPanel"),R=x("Dialog"),C=x("TransitionRoot");return g(),D("div",null,[tt(e.$slots,"default",{onClick:o[0]||(o[0]=(...d)=>r.init&&r.init(...d))}),t.details!==null&&t.details.client!==void 0?(g(),D("div",ys,[u(l,{class:"hidden",ref:"corePrinter",orderId:`${t.details.order_id}`,id:`${t.details.client.id}`},null,8,["orderId","id"])])):V("",!0),u(C,{appear:"",show:t.show,as:"template"},{default:S(()=>[u(R,{as:"div",class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[ws]),_:1}),s("div",xs,[s("div",Cs,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(v,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",ks,[u(P,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>[Ss,W(" View Test ")]),_:1}),s("button",{onClick:o[1]||(o[1]=(...d)=>r.handleClick&&r.handleClick(...d))},[u(T,{class:"w-5 h-5"})])]),we(s("div",Ts,[u(w,{loading:t.loading},null,8,["loading"])],512),[[xe,t.loading]]),s("div",$s,[s("div",Ps,[Is,s("div",Ds,[s("div",Ls,[Rs,s("p",null,k(t.details.client.id),1)]),s("div",Ms,[js,s("p",null,k(("capitalize"in e?e.capitalize:B(ce))(`${t.details.client.first_name} ${t.details.client.middle_name!==null?t.details.client.middle_name:""} ${t.details.client.last_name}`)),1)]),s("div",As,[Vs,s("p",null,k(t.details.client.sex),1)]),s("div",qs,[Fs,s("p",null,k(("calculateAge"in e?e.calculateAge:B(Ue))(t.details.client.date_of_birth)),1)])])]),s("div",Os,[Bs,s("div",Es,[s("div",Ns,[Us,s("p",null,k(t.details.specimen_type),1)]),s("div",Hs,[Zs,s("p",null,k(t.details.tracking_number),1)]),s("div",zs,[Ys,s("p",null,k(t.details.accession_number),1)]),s("div",Gs,[Xs,s("p",null,k(("capitalize"in e?e.capitalize:B(ce))(t.details.order_status.split("-").join(" "))),1)])])]),s("div",Ks,[Qs,s("div",Ws,[s("div",Js,[eo,s("p",null,k(t.details.test_type_name),1)]),s("div",to,[so,s("p",null,k(t.moment(t.details.created_date).format("dateFormat"in e?e.dateFormat:B(me))),1)]),s("div",oo,[no,s("p",null,k(t.moment(t.details.updated_date).format("dateFormat"in e?e.dateFormat:B(me))),1)]),s("div",ro,[io,s("p",null,k(("capitalizeStr"in e?e.capitalizeStr:B(dt))(t.details.status.split("-").join(" "))),1)]),s("div",lo,[ao,s("p",null,k(t.details.requesting_ward),1)]),s("div",co,[uo,s("p",null,k(t.details.request_origin),1)]),s("div",po,[mo,s("p",null,k(r.getRequestedBy(t.details.status_trail)),1)]),s("div",ho,[fo,s("p",null,k(t.details.requested_by),1)])])])]),s("div",_o,[s("div",vo,[go,s("div",bo,[t.details.status.toLowerCase()==="completed"&&("usePermissions"in e?e.usePermissions:B(te))().can.verify("test_results")?(g(),U(p,{key:0,icon:t.checkIcon,text:"Authorize",click:()=>{r.changeStatus("verified",t.details.id)},color:"success",loading:t.verifying},null,8,["icon","click","loading"])):V("",!0),(t.details.status.toLowerCase()==="completed"||t.details.status.toLowerCase()==="verified")&&("usePermissions"in e?e.usePermissions:B(te))().can.view("reports")?(g(),U(p,{key:1,icon:t.viewIcon,text:"View Report",click:r.viewReport,color:"primary"},null,8,["icon","click"])):V("",!0),u($,{item:t.details,onUpdate:r.updateChanges,color:"primary"},null,8,["item","onUpdate"]),u(p,{icon:t.printerIcon,text:"Print Accession Number",click:r.printAccessionNumber,color:"primary"},null,8,["icon","click"]),u(p,{icon:t.printerIcon,color:"success",text:"Print Tracking Number",click:r.printTrackingNumber},null,8,["icon","click"])])]),(g(!0),D(K,null,le(t.details.indicators,(d,_)=>{var b;return g(),D("div",{class:Oe(t.details.indicators.length!==_+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:_},[s("h3",null,k(d.name),1),s("div",yo,[d.result?(g(),D("p",{key:0,innerHTML:d.result.value?d.result.value:"Not done"},null,8,wo)):V("",!0),(b=d.result)!=null&&b.value?(g(),D("span",xo,k(d==null?void 0:d.unit),1)):V("",!0)])],2)}),128)),t.details.test_type_name=="Cross-match"&&t.details.status.toLowerCase()=="verified"?(g(),D("div",Co,[u(p,{loading:t.zebraPrinting,click:()=>{r.printBBResults()},text:"Print results",color:"primary",icon:t.printerIcon},null,8,["loading","click","icon"])])):V("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const So=se(_s,[["render",ko]]),To={components:{TransitionRoot:ke,TransitionChild:Se,Dialog:Te,DialogPanel:$e,DialogTitle:Pe,XMarkIcon:oe,UserIcon:He},data(){return{open:!1,addIcon:Ee,saveIcon:ze,clearIcon:Ye,name:"",description:"",loading:!1,cookie:de("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const e={route:j.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:o,data:n}=await A(e);n.value&&(this.rawReasons=n.value,n.value.map(a=>{this.reasons.push(a.description)})),o.value&&console.error(o.value)},async submitForm(){this.loading=!0;let e=null;this.rawReasons.map(r=>{r.description===this.reasonsSelected&&(e=r.id)});const o={route:`${j.testStatus}/${this.item.id}/${this.action}?status_reason_id=${e}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:n,error:a,pending:t}=await A(o);this.loading=t,n.value&&(q().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),a.value&&(console.error(a.value),q().$toast.error(ee),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},$o="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M40%2024.0005C40%2027.3142%2037.3137%2030.0005%2034%2030.0005H32.566L27.7629%2024.9453C27.9142%2024.6638%2028%2024.3419%2028%2024C28%2022.8954%2027.1046%2022%2026%2022H24.9645L21.1644%2018.0005H34C37.3137%2018.0005%2040%2020.6868%2040%2024.0005ZM36%2023.9995C36%2023.1711%2035.3284%2022.4995%2034.5%2022.4995C33.6716%2022.4995%2033%2023.1711%2033%2023.9995C33%2024.8279%2033.6716%2025.4995%2034.5%2025.4995C35.3284%2025.4995%2036%2024.8279%2036%2023.9995ZM30.752%2023.25C31.1673%2023.25%2031.504%2023.5858%2031.504%2024C31.504%2024.4142%2031.1673%2024.75%2030.752%2024.75C30.3367%2024.75%2030%2024.4142%2030%2024C30%2023.5858%2030.3367%2023.25%2030.752%2023.25Z'%20fill='%23333333'/%3e%3cpath%20d='M12%2024C12%2022.8954%2012.8954%2022%2014%2022H16.6881L12.9715%2018.0883C10.1478%2018.5761%208%2021.0375%208%2024.0005C8%2027.3142%2010.6863%2030.0005%2014%2030.0005H24.2896L20.4886%2026H14C12.8954%2026%2012%2025.1046%2012%2024Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44%2024C44%2035.0457%2035.0457%2044%2024%2044C12.9543%2044%204%2035.0457%204%2024C4%2012.9543%2012.9543%204%2024%204C35.0457%204%2044%2012.9543%2044%2024ZM42%2024C42%2029.1085%2039.8719%2033.7199%2036.4539%2036.9962L11.6573%2010.8981C14.8798%207.86121%2019.2226%206%2024%206C33.9411%206%2042%2014.0589%2042%2024ZM24%2042C28.1125%2042%2031.9028%2040.6209%2034.9338%2038.2999L10.2781%2012.35C7.60984%2015.4897%206%2019.5569%206%2024C6%2033.9411%2014.0589%2042%2024%2042Z'%20fill='%23333333'/%3e%3c/svg%3e",Po=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Io={class:"fixed inset-0 overflow-y-auto"},Do={class:"flex min-h-full items-center justify-center p-4 text-center"},Lo={class:"border-b px-3 py-3 flex items-center justify-between"},Ro=s("img",{src:$o,class:"w-8 h-8 mr-2"},null,-1),Mo={class:"mt-2 space-y-3 px-5 py-5"},jo={class:"space-y-2"},Ao=s("h3",{class:"font-medium"},"Test Type",-1),Vo={class:"border-b border-dotted text-gray-600"},qo={class:"space-y-2"},Fo=s("h3",{class:"font-medium"},"Specimen",-1),Oo={class:"border-b border-dotted text-gray-600"},Bo={class:"space-y-2"},Eo=s("h3",{class:"font-medium"},"Accession Number",-1),No={class:"border-b border-dotted text-gray-600"},Uo={class:"w-full flex items-center"},Ho={class:"w-full flex flex-col space-y-2"},Zo={class:"w-full flex flex-col space-y-2 pb-40"},zo=s("label",{class:"font-medium"},"Select Reason(s)",-1),Yo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Go(e,o,n,a,t,r){const l=pe,i=x("TransitionChild"),P=x("DialogTitle"),T=x("XMarkIcon"),w=x("FormKit"),p=x("multi-select"),$=Be,v=x("DialogPanel"),R=x("Dialog"),C=x("TransitionRoot");return g(),D("div",null,[s("div",null,[u(l,{text:n.text,color:"error",icon:n.icon,click:r.init},null,8,["text","icon","click"])]),u(C,{appear:"",show:t.open,as:"template"},{default:S(()=>[u(R,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[Po]),_:1}),s("div",Io,[s("div",Do,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",Lo,[u(P,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:S(()=>[Ro,W(" "+k(n.text.charAt(0).toUpperCase()+n.text.slice(1))+" Reason ",1)]),_:1}),s("button",{onClick:o[0]||(o[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[u(T,{class:"w-5 h-5"})])]),u(w,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"rejectionForm"},{default:S(({value:d})=>[s("div",Mo,[s("div",jo,[Ao,s("p",Vo,k(n.item.test_type_name),1)]),s("div",qo,[Fo,s("p",Oo,k(n.item.specimen_type),1)]),s("div",Bo,[Eo,s("p",No,k(n.item.accession_number),1)]),s("div",Uo,[s("div",Ho,[u(w,{type:"text",label:"Person Talked To",validation:n.text.toLowerCase()!=="void"?"required":"",modelValue:t.name,"onUpdate:modelValue":o[1]||(o[1]=_=>t.name=_)},null,8,["validation","modelValue"])])]),s("div",Zo,[zo,u(p,{style:{"--ms-max-height":"none !important"},modelValue:t.reasonsSelected,"onUpdate:modelValue":o[2]||(o[2]=_=>t.reasonsSelected=_),options:t.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),s("div",Yo,[u($,{type:"button",text:"Clear form",click:r.resetForm},null,8,["click"]),u(l,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Xo=se(To,[["render",Go]]),Ko={components:{MagnifyingGlassIcon:yt,Listbox:Vt,ListboxButton:qt,ListboxLabel:Ft,ListboxOptions:Ot,ListboxOption:Bt,ChevronUpDownIcon:nt,ArrowRightIcon:Zt,ChevronDownIcon:wt,Menu:Et,MenuButton:Nt,MenuItems:Ut,MenuItem:Ht,CheckIcon:xt,PopoverButton:Qt,Popover:We,PopoverPanel:Wt,XMarkIcon:oe,CheckCircleIcon:It,FunnelIcon:Dt},setup(){const e=he();gt({title:`${bt.name.toUpperCase()} - ${e.department} Tests`})},data(){return{moment:Y,addIcon:Ae,filterIcon:Lt,applyIcon:zt,acceptIcon:Ne,viewIcon:Ze,moreActions:!1,showMore:0,okIcon:ae,moreIcon:Rt,lessIcon:Mt,clearIcon:jt,dropIcon:ie,editIcon:Ce,refreshIcon:At,dateRange:["",""],search:"",header:"Tests Lists",pages:[{name:"Home",link:"/home"}],headers:[{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions"}],statuses:[{text:"Results",color:"primary",icon:Ae,status:"completed",show:"started",permission:"enter_test_results"},{text:"Accept",color:"success",icon:ae,status:"pending",show:"not-collected",permission:"accept_test_specimen"},{text:"Start",color:"warning",icon:Yt,status:"started",show:"pending",permission:"start_test"},{text:"Authorize",color:"success",status:"verified",icon:ae,show:"completed",permission:"verify_test_results"}],rejectStatuses:[{name:"Reject",icon:ie,action:"rejected",permission:"void_test"},{name:"Void",icon:ie,action:"voided",permission:"void_test"},{name:"Notdone",icon:ie,action:"not_done",permission:"void_test"}],changing:!1,data:new Array,statusSelected:{name:"select status"},searchField:"accession_number",searchValue:"",cookie:de("token"),loading:!1,serverItemsLength:0,serverOptions:{page:1,rowsPerPage:10,sortBy:"name"},authStore:he(),testStatuses:new Array,filters:new Array}},created(){var e,o,n,a,t,r;this.serverOptions={page:Number((this._.provides[M]||this.$route).query.page?(this._.provides[M]||this.$route).query.page:1),rowsPerPage:Number((this._.provides[M]||this.$route).query.rowsPerPage?(this._.provides[M]||this.$route).query.rowsPerPage:10)},this.statusSelected=(this._.provides[M]||this.$route).query.status?{name:(this._.provides[M]||this.$route).query.status.toString()}:{name:"select status"},this.search=(e=(this._.provides[M]||this.$route).query.search)!=null&&e.toString()?(o=(this._.provides[M]||this.$route).query.search)==null?void 0:o.toString():"",this.dateRange=[`${(n=(this._.provides[M]||this.$route).query.from)!=null&&n.toString()?(a=(this._.provides[M]||this.$route).query.from)==null?void 0:a.toString():""}`,`${(t=(this._.provides[M]||this.$route).query.to)!=null&&t.toString()?(r=(this._.provides[M]||this.$route).query.to)==null?void 0:r.toString():""}`],this.init()},methods:{shouldDisplayMore(e){this.showMore==e?this.showMore=0:this.showMore=e},async searchNlims(e){this.loading=!0;const o={route:`${j.nlimsTestSearch}?tracking_number=${e.replace(/\$$/,"")}`,method:"GET",token:`${this.cookie}`},{data:n,error:a}=await A(o);n.value&&(pt(n.value).then(t=>{const l={...this.$router.currentRoute.value.query,search:t};this.$router.replace({query:l}),this.search=t,this.searchValue=t,this.init()}).catch(t=>{console.error("error routing to merged test: ",t)}),this.loading=!1),a.value&&(console.error(a.value),q().$toast.error(`${a.value.data.error}`),this.loading=!1)},async init(){this.loadStatuses(),this.loading=!0;const{page:e,rowsPerPage:o}=this.serverOptions;let n=this.getIdFromName(this.authStore.user.departments,this.authStore.department),a=this.getIdFromName(this.authStore.locations,this.authStore.selectedLocation),t=this.statusSelected.name==="select status"?"":this.statusSelected.name!==void 0&&this.statusSelected.name;const r=this.dateRange[0].toString()!==""?Y(this.dateRange[0].toString()).format("YYYY-MM-DD"):"",l=this.dateRange[1].toString()!==""?Y(this.dateRange[1].toString()).format("YYYY-MM-DD"):"",i={route:`${j.tests}?minimal=true&page=${e}&per_page=${o}&status=${t.toString().toLowerCase()}&search=${this.search}&department_id=${n}&lab_location=${a}&start_date=${r}&end_date=${l}`,method:"GET",token:`${this.cookie}`},{data:P,error:T,pending:w}=await A(i);this.loading=w,P.value&&(this.data=P.value.data.map(p=>{var $,v,R,C;return{...p,name:`${ce(`${($=p.client)==null?void 0:$.first_name} ${((v=p.client)==null?void 0:v.middle_name)!==null?p.client.middle_name:""} ${(R=p.client)==null?void 0:R.last_name}`)} (${p.client.sex}, ${Ue((C=p.client)==null?void 0:C.date_of_birth)} yrs)`,order_status:`${p.order_status!==null?(p.order_status.charAt(0).toUpperCase()+p.order_status.slice(1)).split("-").join(" "):""}`,status:`${p.status!==null?p.status.charAt(0).toUpperCase()+p.status.slice(1):""}`,created_date:Y(p.created_date).utcOffset(2).format(me)}}),this.serverItemsLength=P.value.meta.total_count,this.loading=!1),T.value&&(console.error(T.value.data),q().$toast.error(ee),this.loading=!1)},async loadStatuses(){const e={route:`${j.testStatus}/all`,method:"GET",token:`${this.cookie}`},{data:o,error:n}=await A(e);o.value&&(this.testStatuses=o.value.map(a=>({id:a.id,name:a.name.charAt(0).toUpperCase()+a.name.slice(1)}))),n.value&&console.error(n.value)},async changeStatus(e,o){this.loading=!0;const n={route:`${j.testStatus}/${o}/${e}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:a,error:t,pending:r}=await A(n);this.loading=r,a.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},async changeOrderStatus(e,o){this.loading=!0;const n={route:`${j.orderStatus}/${e}`,method:"PUT",token:`${this.cookie}`,body:{order_id:o}},{data:a,error:t,pending:r}=await A(n);this.loading=r,a.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},checkStatus(e,o){e.status==="completed"?o.test_type_name.toLowerCase().includes("culture")?this.redirect(o,`/tests/result/culture-sensitivity?accession_number=${o.accession_number}&test_id=${o.id}`):this.redirect(o,`/tests/result?accession_number=${o.accession_number}&test_id=${o.id}`):e.status==="verified"?this.openTestsDialog(o):e.status!==""?this.changeStatus(e.status,o.id):this.printTest(o)},printTest(e){print()},getIdFromName(e,o){const n=e.find(a=>a.name===o);return n?n.id:null},updateTests(e){if(typeof e=="object"){this.serverOptions=e;const n={...this.$router.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};this.$router.replace({query:n})}this.init(),this.moreActions=!1},refreshTests(){this.searchValue="",this.search="",this.init()},update(e){this.search=e,this.searchValue=e;const n={...this.$router.currentRoute.value.query,search:e};this.$router.replace({query:n}),e!==""?this.checkTrackingNumber(e)?this.searchNlims(e):this.updateTests(e):this.init()},handleClick(){this.moreActions=!this.moreActions},redirect(e,o){this.$router.push(o)},checkTrackingNumber(e){return/^(x|l).*\d/.test(e.toLowerCase())},updateOnStatus(e){if(e.name!=="select status"){const a=this.filters.find(t=>t.origin==="statuses");a?a.value=e.name:this.filters.push({origin:"statuses",value:e.name})}this.statusSelected=e;const n={...this.$router.currentRoute.value.query,status:e.name.toLowerCase()=="select status"?"":e.name.toLowerCase()};this.$router.replace({query:n}),this.init()},removeFilter(e){e.origin==="statuses"&&this.statusSelected.name!=="select status"&&this.updateOnStatus({name:"select status"});const o=this.filters.findIndex(n=>n.origin===e.origin);o!==-1&&this.filters.splice(o,1),this.init()},isCompletedByCurrentUserOrSuperAdmin(e){const o=this.authStore.user,n=e.completed_by;if(n){if(n.id!==o.id)return!0;if(n.is_super_admin===!0)return!0}return!1},shouldDisplayButton(e,o){const{hasPermission:n}=te(),a=e.status.toLowerCase(),t=o.show.toLowerCase();if(a===t){const r=this.isCompletedByCurrentUserOrSuperAdmin(e);return a==="pending"&&e.order_status.toLowerCase()==="specimen not collected"?!1:o.permission?r&&n.value(String(o.permission)):r}return!1},hideRejectActions(e){const{can:o}=te();return!["voided","test-rejected","verified","rejected"].includes(e.name.toLowerCase())&&o.void("test")},cleared(){this.dateRange=["",""]},openTestsDialog(e){this.$refs.testsDialog!=null&&this.$refs.testsDialog!==void 0&&this.$refs.testsDialog.init(e)}},watch:{authStore:{handler(){this.init()},deep:!0},dateRange:{handler(e,o){const n=e[0].toString()!==""?Y(e[0].toString()).format("YYYY-MM-DD"):"",a=e[1].toString()!==""?Y(e[1].toString()).format("YYYY-MM-DD"):"",r={...this.$router.currentRoute.value.query,from:n,to:a};this.$router.replace({query:r}),this.init()},deep:!0},statusSelected:{handler(e){this.updateOnStatus(e)},deep:!0}}},Qo=""+new URL("experiment-results.CJ8ZtMc5.png",import.meta.url).href,Wo={class:"py-5 px-5"},Jo=s("div",{class:"flex items-center space-x-2 py-5"},[s("img",{src:Qo,alt:"experiment-results-icon",class:"w-auto h-8"}),s("h3",{class:"text-2xl font-semibold uppercase"},"Tests List")],-1),en={class:"flex justify-between items-center w-full py-2 mb-2"},tn={class:"flex items-center space-x-2"},sn={class:"relative z-10 w-40"},on={class:"pt-1"},nn={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},rn={class:"w-72 ml-2"},ln={class:"py-3 flex items-center space-x-3"},an={class:"py-2 flex items-center"},cn={class:"w-full flex items-center justify-between space-x-2"},un={key:0,class:"flex items-center space-x-2"},dn={key:0,class:"flex items-center space-x-2"},pn=s("div",{id:"tests-container"},null,-1);function mn(e,o,n,a,t,r){const l=et,i=pe,P=rt,T=x("FunnelIcon"),w=x("datepicker"),p=it,$=ss,v=So,R=Xo,C=vt;return g(),D("div",Wo,[u(l,{pages:t.pages},null,8,["pages"]),Jo,s("div",en,[s("div",tn,[u(i,{text:"Refresh",color:"warning",icon:t.refreshIcon,click:()=>{r.refreshTests()},loading:t.loading},null,8,["icon","click","loading"]),s("div",sn,[u(P,{items:t.testStatuses,modelValue:t.statusSelected,"onUpdate:modelValue":o[0]||(o[0]=d=>t.statusSelected=d)},null,8,["items","modelValue"])]),s("div",on,[s("div",nn,[u(T,{class:"w-5 h-5 mr-2"}),W(" Filter By Date Range "),s("div",rn,[u(w,{required:"",position:"left",onCleared:r.cleared,placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:t.dateRange,"onUpdate:modelValue":o[1]||(o[1]=d=>t.dateRange=d)},null,8,["onCleared","modelValue"])])])])]),u(p,{onUpdate:r.update,search:t.search,"onUpdate:search":o[2]||(o[2]=d=>t.search=d)},null,8,["onUpdate","search"])]),s("div",ln,[(g(!0),D(K,null,le(t.filters,(d,_)=>(g(),U($,{value:{origin:"statuses",text:d.value},close:"",color:"green",key:_,onUpdate:r.removeFilter},null,8,["value","onUpdate"]))),128))]),u(C,{headers:t.headers,data:t.data,loading:t.loading,searchField:t.searchField,searchValue:t.searchValue,serverItemsLength:t.serverItemsLength,serverOptions:t.serverOptions,onUpdate:r.updateTests},{actions:S(({item:d})=>[s("div",an,[s("div",cn,[t.showMore!==d.id?(g(),D("div",un,[u(v,{ref:"testsDialog",onUpdate:r.updateTests},{default:S(()=>[u(i,{color:"primary",text:"View",icon:t.viewIcon,click:()=>{r.openTestsDialog(d)}},null,8,["icon","click"])]),_:2},1032,["onUpdate"]),d.status.toLowerCase()==="completed"&&("usePermissions"in e?e.usePermissions:B(te))().can.edit("test_results")?(g(),U(i,{key:0,click:()=>{r.checkStatus({status:"completed"},d)},text:"Edit",color:"success",icon:t.editIcon},null,8,["click","icon"])):V("",!0),(g(!0),D(K,null,le(t.statuses,(_,b)=>we((g(),U(i,{color:_.color,text:_.text,icon:_.icon,click:()=>{r.checkStatus(_,d)},key:b},null,8,["color","text","icon","click"])),[[xe,r.shouldDisplayButton(d,_)]])),128)),!d.status.toLowerCase().includes("rejected")&&d.order_status.toLowerCase()==="specimen not collected"?(g(),U(i,{key:1,color:"success",text:"Accept",icon:t.acceptIcon,click:()=>r.changeOrderStatus("accepted",d.order_id)},null,8,["icon","click"])):V("",!0)])):V("",!0),r.hideRejectActions(d)?(g(),U(i,{key:1,click:()=>r.shouldDisplayMore(d.id),color:"",text:"",icon:t.moreActions==!0?t.lessIcon:t.moreIcon},null,8,["click","icon"])):V("",!0)]),r.hideRejectActions(d)&&t.showMore==d.id?(g(),D("div",dn,[(g(!0),D(K,null,le(t.rejectStatuses,(_,b)=>(g(),U(R,{item:d,key:_.name,text:_.name,icon:_.icon,action:_.action,onUpdate:r.updateTests},null,8,["item","text","icon","action","onUpdate"]))),128))])):V("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"]),pn])}const tr=se(Ko,[["render",mn]]);export{tr as default};
