import{d as j,r as y,ak as Y,a5 as P,a as L,c as E,C as c,w as K,o as z,y as w,b as d,e as m,g as e,f as i,z as S,h as t,k as h,H as Q,t as f,F as M,j as $,K as T,i as H,v as J,u as C,l as W,m as X,E as Z,_ as ee,n as te}from"./BxD-h1LR.js";import{_ as oe}from"./BNhNOnHe.js";import{_ as se}from"./Cs7plFji.js";import{_ as ae}from"./B4cMvEBz.js";import{_ as re}from"./CQcCm1L6.js";import{u as ne}from"./DRcUz5ts.js";import{s as le}from"./Qw5I_VYr.js";import{r as ce}from"./BkJfYQCG.js";import{r as ie}from"./CQe3LSWs.js";const ue={class:"w-full flex items-center justify-between mb-10"},de={class:"flex items-center space-x-5"},me={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},_e={class:"w-56 ml-2"},pe={class:"w-48"},ye={class:"rounded border",id:"print-container"},fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},he=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ")],-1),ve={class:"px-4 mt-2"},xe={class:"font-semibold"},ge={key:0},be={class:"w-full mt-3",ref:"table"},Re={class:"w-full border-b border-t bg-gray-50 rounded-t"},we={class:"w-full"},Ce={class:"px-2 py-2 text-left border-r"},ke={class:"px-2 py-2 text-left border-r"},Ee=["onClick"],Se={class:"w-full items-center flex flex-col space-y-2 my-10"},Me=e("p",{class:"text-base"},[h(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),$e={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Te=e("img",{src:re,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Fe=e("p",{class:"text-base"},[h(" Please generate report data to preview the "),e("span",{class:"font-medium"},"Organisms Count"),h(" report. ")],-1),Ne=[Te,Fe],Pe=j({__name:"organisms-counts",setup(Oe){const o=y(""),F=y([{name:"Organism Name"},{name:"Period"},{name:"Total Count"}]),N=y(""),v=Y(),x=P(),O=L("token"),_=y([]),b=ne(),l=y(!1),I=E(()=>_.value.map((s,a)=>({ORGANISM:s.organism,"DATE PERIOD":c(o.value).format("MMMM/yyyy"),COUNT:s.count}))),q=(s,a,n)=>{le({test:s,type:"General Counts",count:a,associated_ids:n,date_filter:c(o.value).format("YYYY-MM-DD")},C())},D=()=>{o.value=""};async function k(){l.value=!0;let s=o.value?c(o.value).format("M"):"",a=o.value?c(o.value).format("yyyy"):"";const n={route:`${W.aggregateReports}culture/organisms_based_counts?year=${a}&month=${s}&report_id=${v.query.report_id}`,method:"GET",token:`${O.value}`},{data:u,error:g,pending:R}=await X(n);l.value=R,u.value&&(_.value=u.value.data,l.value=!1,U(u.value.report_id),C().$toast.success("Report data generated successfully")),g.value&&(console.error(g.value),l.value=!1,C().$toast.error(Z))}const U=s=>{N.value=s;const n={...x.currentRoute.value.query,report_id:s};x.replace({query:n}).catch(u=>{console.error("Failed to replace route:",u)})};K(o,()=>{if(o){const a={...x.currentRoute.value.query,dateFrom:o?c(o.value).format("M/yyyy"):""};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0});const V=E(()=>v.query.dateFrom!==void 0&&v.query.dateFrom!=="");return z(()=>{V.value&&k()}),(s,a)=>{const n=w("datepicker"),u=ee,g=w("FormKit"),R=oe,A=w("excel"),G=se,B=te;return d(),m("div",null,[e("div",ue,[i(g,{type:"form","submit-label":"Update",onSubmit:k,actions:!1},{default:S(({value:r})=>[e("div",de,[e("div",me,[i(t(ce),{class:"w-5 h-5 mr-2"}),h(" Filter By Date Range "),e("div",_e,[i(n,{onCleared:D,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:t(o),"onUpdate:modelValue":a[0]||(a[0]=p=>Q(o)?o.value=p:null),format:"M/yyyy"},null,8,["modelValue"])])]),e("div",pe,[i(u,{type:"submit",color:"primary",text:"Generate Report",icon:t(ie),click:()=>{},loading:t(l)},null,8,["icon","loading"])])])]),_:1}),e("div",null,[i(A,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ${t(c)(t(o)).format("M/yyyy")}`,t(b).details.name,t(b).details.address,t(b).details.phone],data:t(I),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_counts_report_${t(c)(t(o)).format("M_yyyy")}.xls`},{default:S(()=>[i(R,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",ye,[e("div",fe,[he,i(G)]),e("div",null,[e("h3",ve,[h(" Data for period: "),e("span",xe,f(t(o)==""?" - ":t(c)(t(o)).format("M/yyyy")),1)])]),t(_).length>0&&!t(l)?(d(),m("div",ge,[e("table",be,[e("thead",Re,[e("tr",we,[(d(!0),m(M,null,$(t(F),(r,p)=>(d(),m("th",{class:"px-2 py-2 border-r text-left",key:p},f(r.name),1))),128))])]),e("tbody",null,[(d(!0),m(M,null,$(t(_),(r,p)=>(d(),m("tr",{key:p,class:"border-b"},[e("td",Ce,f(r.organism),1),e("td",ke,f(String(t(v).query.dateFrom)),1),e("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:Ie=>q(`Organisms Based Counts (${r.organism}) - ${r.ward}, ${r.encounter}`,r.count,r.associated_ids)},f(r.count),9,Ee)]))),128))])],512)])):T("",!0),H(e("div",Se,[i(B),Me],512),[[J,t(l)]]),t(_).length==0&&!t(l)?(d(),m("div",$e,Ne)):T("",!0)])])}}});export{Pe as default};
