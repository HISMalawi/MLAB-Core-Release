import{_ as ie}from"./EhL4ITZ8.js";import{_ as ue}from"./DfD4Z7nW.js";import{s as de,x as M,b,H as ce,d as me,r as x,u as pe,a as _e,al as fe,M as ve,c as q,z as v,w as Y,o as ye,e as A,f as m,h as t,g as o,t as c,y as G,j as H,A as B,X as D,F as Te,k as he,J as ge,C,l as xe,E as be,_ as Re}from"./BXyMujmX.js";import{_ as Ae}from"./DMFHDiSo.js";import{_ as we}from"./BfsOaWVQ.js";import{_ as De}from"./CTTfLw4L.js";import{C as $e,b as Ee,L as ke,B as qe,c as Ce,p as Me,a as Ne,d as Fe}from"./C0GaFM61.js";import{_ as Se}from"./CZ3iYi4-.js";import{_ as Oe}from"./DxWPenel.js";import{_ as Ye}from"./CLjkZCUy.js";import{u as Be}from"./EpKhHjE4.js";import{P as Ue}from"./CrZr7riT.js";import{u as Ve}from"./BrSykilB.js";import{u as Pe}from"./jYNjYE_F.js";import{r as Ie}from"./j1ItqFOA.js";import{r as Le}from"./BUs6Eooc.js";import"./9_0iIVXm.js";import"./B1ZrIgkL.js";import"./CZ7m8Kmu.js";import"./Bp1ZQY1w.js";import"./CzikmzDu.js";import"./CIiMT7Ls.js";import"./Dfr3EQSc.js";import"./C1rT4RS7.js";import"./C0lYrmTo.js";$e.register(Ee,ke,qe,Ce,Me,Ne);const je={components:{Bar:Fe},props:{chartData:{required:!0,type:Object}},data(){return{data:this.chartData,options:{responsive:!0,maintainAspectRatio:!1}}},watch:{chartData:{handler(N){this.data=N},deep:!0}}};function Ge(N,U,w,f,u,V){const F=M("Bar");return b(),ce(F,{data:u.data,options:u.options},null,8,["data","options"])}const He=de(je,[["render",Ge]]),We={class:"px-5 py-5"},Qe={class:"flex justify-between items-center"},ze={class:"w-full flex items-center space-x-3"},Ke={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Je={class:"w-72 ml-2"},Xe={class:"w-48"},Ze={class:"w-48"},et={class:"w-48"},tt={class:"border rounded mt-10",id:"print-container"},ot={class:"flex items-center justify-between px-5 py-5 border-b"},rt={class:"m-3"},at={class:"font-semibold mb-2"},nt={class:"text-normal font-normal"},st={key:0},lt={class:"w-full rounded"},it={class:"border-t bg-gray-50 border-b"},ut={class:"text-left px-2 py-2 border-r uppercase"},dt={class:"text-left px-2 py-2 uppercase"},ct={class:"text-left px-2 py-2 border-r border-b"},mt={class:"text-left px-2 py-2 border-r border-b"},pt={class:"text-left px-2 py-2 border-b border-r"},_t=["onClick"],ft=["onClick"],vt={class:"text-left px-2 py-2 border-b"},yt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Tt={key:0,class:"bg-gray-50 rounded mt-5 border"},ht={class:"px-5 py-5 flex flex-col items-center"},gt={class:"mt-1"},xt={key:0,style:{height:"400px"}},bt="Turn Around Time Report",Qt=me({__name:"turn-around-time",setup(N){Ve({title:`${Ue.name.toUpperCase()} - Turn Around Time Reports`});const U=x([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),w=x([]),f=x({name:"select department",id:0}),{loading:u,executeCancellableRequest:V,cancelRequest:F}=Pe(),W=x([{name:"Minutes"},{name:"Hours"},{name:"Days"},{name:"Weeks"}]),p=x({name:"select unit"}),_=x([]),S=Be(),{$toast:$,$metadata:Q}=pe(),z=_e("token"),y=fe(),n=ve(),O=x({}),l=x(new Array("","")),K=()=>{l.value=new Array("","")},T=q(()=>l.value[0]?v(l.value[0]).format("YYYY-MM-DD"):""),h=q(()=>l.value[1]?v(l.value[1]).format("YYYY-MM-DD"):""),J=q(()=>_.value.length>0?_.value.map(r=>{var e,a;return{"TEST TYPE":r.test_type,UNITS:p.value.name,"TURN AROUND TIME":r.turn_around_time,AVERAGE:r.average,"TOTAL TESTS":((e=r.total_tests)==null?void 0:e.count)||0,"TESTS WITHIN NORMAL TAT":((a=r.tests_within_normal_tat)==null?void 0:a.count)||0,"PERCENTAGE OF TESTS WITHIN NORMAL TAT":`${r.percentage_within_normal_tat}%`}}):[]);async function P(){u.value=!0,O.value={};let r=`from=${T.value}&to=${h.value}&department=${f.value.id}&unit=${p.value.name.toLowerCase()}&report_id=${n.query.report_id||""}`;const e={route:`${xe.aggregateReports}turn_around_time?${r}`,method:"GET",token:`${z.value}`},{data:a,error:s,pending:d}=await V(e);u.value=d,a.value&&(u.value=!1,_.value=a.value.data,Z(a.value.id),O.value={labels:a.value.data.map(R=>R.test_type),datasets:[{label:"Turn Around Time",backgroundColor:"#030712",data:a.value.data.map(R=>R.turn_around_time)},{label:"Average Turn Around Time",backgroundColor:"#0284c7",data:a.value.data.map(R=>Number(R.average))}]},a.value.data.length>0?$.success("Report data generated successfully"):$.warning(`No data found in period ${v(T.value).format(D)} - ${v(h.value).format(D)}`)),s.value&&(u.value=!1,console.error(s.value),$.error(be))}function X(){const r=f.value.name==="select department"||p.value.name==="select unit";return r&&$.warning("Please select a department and unit"),!r}const Z=r=>{const a={...y.currentRoute.value.query,report_id:r};y.replace({query:a}).catch(s=>{console.error("Failed to replace route:",s)})},I=(r,e,a,s)=>{a!==0&&s!==""?y.push(`/reports/${s}?origin=aggregate&type=turn-around-time-report&from=${T.value}&to=${h.value}&test=${r} - ${e}&department=${f.value.name}&department_id=${f.value.id}&unit=${p.value.name}&report_id=${n.query.report_id||""}&count=${a}`):$.warning("No data found for this selection")};Y(l,()=>{const r=l.value[0]?v(l.value[0]).format("YYYY-MM-DD"):"",e=l.value[1]?v(l.value[1]).format("YYYY-MM-DD"):"";if(r||e){const s={...y.currentRoute.value.query,...r&&{from:r},...e&&{to:e},report_id:""};y.replace({query:s}).catch(d=>{console.error("Failed to replace route:",d)})}_.value=[]},{deep:!0}),Y(f,(r,e)=>{if(r!==e){const s={...y.currentRoute.value.query,department:r.name||void 0,department_id:r.id||void 0,report_id:""};y.replace({query:s}).catch(d=>{console.error("Failed to replace route:",d)}),_.value=[]}}),Y(p,(r,e)=>{if(r!==e){const s={...y.currentRoute.value.query,unit:r.name||void 0,report_id:""};y.replace({query:s}).catch(d=>{console.error("Failed to replace route:",d)}),_.value=[]}});const ee=q(()=>{if(n.query.to!==void 0&&n.query.from!==void 0&&n.query.department!==void 0&&n.query.unit!==void 0&&n.query.report_id!==void 0){l.value=[new Date(String(n.query.from)),new Date(String(n.query.to))];const r=String(n.query.department),e=n.query.department_id?Number(n.query.department_id):0;f.value={id:e,name:r};const a=String(n.query.unit);return p.value={name:a},n.query.to!==""&&n.query.from!==""&&n.query.department!==""&&n.query.unit!==""&&n.query.report_id!==""}return!1});return ye(()=>{u.value=!1,w.value=Q.departments,w.value.some(e=>e.name=="All")||w.value.push({id:0,name:"All"}),w.value.sort((e,a)=>{const s=e.name.toUpperCase(),d=a.name.toUpperCase();return s<d?-1:s>d?1:0}),ee.value&&P()}),(r,e)=>{const a=ie,s=M("datepicker"),d=ue,R=Re,te=M("FormKit"),oe=Ae,re=M("excel"),ae=we,ne=De,se=He;return b(),A("div",We,[m(a,{pages:t(U)},null,8,["pages"]),o("div",{class:"flex items-center py-5"},[e[4]||(e[4]=o("img",{src:Se,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),o("h3",{class:"text-2xl font-semibold uppercase"},c(bt))]),o("div",Qe,[m(te,{type:"form","submit-label":"Update",onSubmit:e[3]||(e[3]=i=>X()&&P()),actions:!1,id:"submitForm"},{default:G(({value:i})=>[o("div",ze,[o("div",Ke,[m(t(Ie),{class:"w-5 h-5 mr-2"}),e[5]||(e[5]=H(" Filter By Date Range ")),o("div",Je,[m(s,{onCleared:K,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(l),"onUpdate:modelValue":e[0]||(e[0]=g=>B(l)?l.value=g:null),format:"dd/MM/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),o("div",Xe,[m(d,{items:t(w),modelValue:t(f),"onUpdate:modelValue":e[1]||(e[1]=g=>B(f)?f.value=g:null)},null,8,["items","modelValue"])]),o("div",Ze,[m(d,{items:t(W),modelValue:t(p),"onUpdate:modelValue":e[2]||(e[2]=g=>B(p)?p.value=g:null)},null,8,["items","modelValue"])]),o("div",et,[m(R,{type:"submit",color:"primary",text:"Generate Report",icon:t(Le),click:()=>{},loading:t(u)},null,8,["icon","loading"])])])]),_:1}),m(re,{class:"btn btn-default",header:[`TURN AROUND TIME REPORT ${t(T)} - ${t(h)}`,t(S).details.name,t(S).details.address,t(S).details.phone],data:t(J),worksheet:"report-work-sheet",name:`turn_around_time_${t(T)}_to_${t(h)}.xls`},{default:G(()=>[m(oe,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),o("div",tt,[o("div",ot,[e[6]||(e[6]=o("div",{class:"flex flex-col space-y-2"},[o("img",{src:Oe,alt:"app-logo",class:"w-24 h-24 object-cover"}),o("h3",{class:"text-xl font-semibold"}," TURN AROUND TIME REPORT ")],-1)),m(ae)]),o("div",rt,[o("h3",at,[e[7]||(e[7]=H("Tests Performed Period: ")),o("span",nt,c(t(T)!==""?t(v)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(D)):"")+" - "+c(t(h)!==""?t(v)(t(h)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(D)):""),1)])]),t(_).length>0&&!t(u)?(b(),A("div",st,[o("table",lt,[o("thead",null,[o("tr",it,[e[8]||(e[8]=o("th",{class:"text-left px-2 py-2 border-r uppercase"},"Test Type",-1)),o("th",ut,"Target TAT ("+c(t(p).name)+")",1),o("th",dt,"Average TAT ("+c(t(p).name)+")",1),e[9]||(e[9]=o("th",{class:"text-left px-2 py-2 uppercase"},"Total Tests",-1)),e[10]||(e[10]=o("th",{class:"text-left px-2 py-2 uppercase"},"Tests Within Normal TAT",-1)),e[11]||(e[11]=o("th",{class:"text-left px-2 py-2 uppercase"},"Percentage of tests within Normal TAT",-1))])]),o("tbody",null,[(b(!0),A(Te,null,he(t(_),(i,g)=>{var L,j;return b(),A("tr",{key:g,class:ge({"bg-white":g%2===0,"bg-gray-50":g%2!==0})},[o("td",ct,c(i.test_type),1),o("td",mt,c(i.turn_around_time),1),o("td",pt,c(i.average),1),o("td",{class:"text-left px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:le=>{var E,k;return I(i.test_type,"Total Tests",((E=i.total_tests)==null?void 0:E.count)||0,((k=i.total_tests)==null?void 0:k.associated_ids)||"")}},c(((L=i.total_tests)==null?void 0:L.count)||0),9,_t),o("td",{class:"text-left px-2 py-2 border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:le=>{var E,k;return I(i.test_type,"Tests Within Normal TAT",((E=i.tests_within_normal_tat)==null?void 0:E.count)||0,((k=i.tests_within_normal_tat)==null?void 0:k.associated_ids)||"")}},c(((j=i.tests_within_normal_tat)==null?void 0:j.count)||0),9,ft),o("td",vt,c(i.percentage_within_normal_tat)+"%",1)],2)}),128))])])])):C("",!0),t(_).length==0&&!t(u)?(b(),A("div",yt,e[12]||(e[12]=[o("img",{src:Ye,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),o("p",null,"Data not found, please generate report",-1)]))):C("",!0),m(ne,{condition:t(u),cancelReportGeneration:()=>t(F)()},null,8,["condition","cancelReportGeneration"])]),t(_).length>0&&!t(u)?(b(),A("div",Tt,[o("div",ht,[e[13]||(e[13]=o("h3",{class:"text-lg font-medium"},"Average Turn Around Time",-1)),o("p",gt,"From: "+c(t(T)!==""?t(v)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(D)):"")+" - To: "+c(t(h)!==""?t(v)(t(h)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(D)):""),1)]),t(_).length>0?(b(),A("div",xt,[m(se,{"chart-data":t(O)},null,8,["chart-data"])])):C("",!0)])):C("",!0)])}}});export{Qt as default};
