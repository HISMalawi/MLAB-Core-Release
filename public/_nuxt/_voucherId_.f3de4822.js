import{_ as G}from"./Breadcrumb.cfeb06ed.js";import{o as _,c as k,d as o,u as R,a as v,_ as M,f as u,b as s,g as p,h as V,p as w,j as q,e as O,t as U,w as N,v as D,F as T,r as A}from"./entry.6a3fbfc1.js";import{_ as L}from"./OutlinedButton.e6ec900c.js";import{e as P}from"./constants.cf42f90d.js";import{S as x}from"./stock.8380d698.js";import{r as W}from"./XMarkIcon.fd9a39e2.js";import{r as J}from"./UserIcon.d8a12127.js";import{r as j}from"./ArrowDownTrayIcon.fa0f85a0.js";import{r as Y}from"./ArrowUturnLeftIcon.1ffe50ee.js";import{S as F,h as X,U as K,G as z,V as H}from"./transition.9bb58b2a.js";import{_ as Z}from"./spreadsheets.10f4fbea.js";import{r as Q}from"./NoSymbolIcon.97a83081.js";import{a as $}from"./fetch.444ade97.js";import{r as B}from"./ArchiveBoxXMarkIcon.64c67645.js";import{u as ee}from"./vue.f36acd1f.f8958c90.js";import{P as te}from"./package.d411c004.js";import{r as oe}from"./TicketIcon.2d28a504.js";import{r as se}from"./DocumentCheckIcon.f8be34d3.js";import{r as re}from"./TrashIcon.4f2791d3.js";import{_ as ie}from"./pharmacy_alt.f1200560.js";import"./nuxt-link.bebad584.js";import"./HomeIcon.54ceb79b.js";import"./hidden.e85239c2.js";import"./PencilSquareIcon.79aa7948.js";import"./PrinterIcon.b8623d34.js";function E(r,t){return _(),k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[o("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375z"}),o("path",{"fill-rule":"evenodd",d:"M3.087 9l.54 9.176A3 3 0 006.62 21h10.757a3 3 0 002.995-2.824L20.913 9H3.087zM12 10.5a.75.75 0 01.75.75v4.94l1.72-1.72a.75.75 0 111.06 1.06l-3 3a.75.75 0 01-1.06 0l-3-3a.75.75 0 111.06-1.06l1.72 1.72v-4.94a.75.75 0 01.75-.75z","clip-rule":"evenodd"})])}const ae={components:{TransitionRoot:F,TransitionChild:X,Dialog:K,DialogPanel:z,DialogTitle:H,XMarkIcon:W,UserIcon:J},props:{data:{required:!0,type:Object}},data(){return{open:!1,checkIcon:E,saveIcon:j,clearIcon:Y,cookie:R("token"),quantityRequested:0,quantityIssued:0,quantityCollected:0,notCollectedReason:"",batchNumber:"",lotNumber:"",remarks:"",expirtyDate:"",loading:!1}},computed:{isNotCollected(){return this.quantityCollected<this.quantityIssued},quantityNotCollected(){return this.quantityIssued-this.quantityCollected}},methods:{async receiveRequisition(){this.loading=!0;const r=new x,t={stock_requisition_id:this.data.id,requisition:{quantity_received:this.quantityCollected,quantity_issued:this.quantityIssued,quantity_not_collected:this.quantityNotCollected,not_collected_reason:this.notCollectedReason},transaction:{lot:this.lotNumber,batch:this.batchNumber,expiry_date:this.expirtyDate,remarks:this.remarks}},{data:l,error:d,pending:e}=await r.receiveStockOrderRequisition(`${this.cookie}`,t);this.loading=e,l.value&&(v().$toast.success("Stock order requisition received successfully"),this.$emit("update",!0),this.loading=!1,this.handleClick()),d.value&&(console.error(d.value),this.handleClick(),v().$toast.error(P),this.loading=!1)},handleClick(){this.open=!this.open}}},ne=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),le={class:"fixed inset-0 overflow-y-auto"},de={class:"flex min-h-full items-center justify-center p-4 text-center"},ce={class:"border-b px-3 py-3 flex items-center justify-between"},ue=o("img",{src:Z,class:"w-8 h-8 mr-2"},null,-1),me={class:"px-5 py-5 space-y-3"},pe={class:"relative flex flex-col space-y-2.5"},he=o("label",{class:"font-medium"},"Date Expiry",-1),_e={class:"mt-5 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function ve(r,t,l,d,e,i){const f=O,g=u("TransitionChild"),m=u("DialogTitle"),C=u("XMarkIcon"),h=u("FormKit"),n=u("datepicker"),a=L,y=u("DialogPanel"),S=u("Dialog"),I=u("TransitionRoot");return _(),k("div",null,[o("div",null,[s(f,{text:"Receive",color:"primary",icon:e.checkIcon,click:i.handleClick},null,8,["icon","click"])]),s(I,{appear:"",show:e.open,as:"template"},{default:p(()=>[s(S,{as:"div",onClose:i.handleClick,class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[ne]),_:1}),o("div",le,[o("div",de,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",ce,[s(m,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>[ue,V(" Receive Stock Requisition ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>i.handleClick&&i.handleClick(...b))},[s(C,{class:"w-5 h-5"})])]),s(h,{type:"form","submit-label":"Update",actions:!1,onSubmit:i.receiveRequisition,id:"submitForm"},{default:p(({value:b})=>[o("div",me,[s(h,{type:"number",label:"Quantity issued",modelValue:e.quantityIssued,"onUpdate:modelValue":t[1]||(t[1]=c=>e.quantityIssued=c),validation:"required"},null,8,["modelValue"]),s(h,{type:"number",label:"Quantity collected",modelValue:e.quantityCollected,"onUpdate:modelValue":t[2]||(t[2]=c=>e.quantityCollected=c),validation:"required"},null,8,["modelValue"]),i.isNotCollected?(_(),w(h,{key:0,disabled:"",type:"number",label:"Quantity not collected",modelValue:i.quantityNotCollected,"onUpdate:modelValue":t[3]||(t[3]=c=>i.quantityNotCollected=c),validation:"required"},null,8,["modelValue"])):q("",!0),i.isNotCollected?(_(),w(h,{key:1,type:"textarea",label:"Provide a reason for quantity not collected",modelValue:e.notCollectedReason,"onUpdate:modelValue":t[4]||(t[4]=c=>e.notCollectedReason=c),validation:"required"},null,8,["modelValue"])):q("",!0),s(h,{type:"text",label:"Lot number",modelValue:e.lotNumber,"onUpdate:modelValue":t[5]||(t[5]=c=>e.lotNumber=c)},null,8,["modelValue"]),s(h,{type:"text",label:"Batch number",modelValue:e.batchNumber,"onUpdate:modelValue":t[6]||(t[6]=c=>e.batchNumber=c)},null,8,["modelValue"]),o("div",pe,[he,s(n,{required:"",teleport:!0,position:"center",range:!1,placeholder:"-- select expiry date --",minDate:new Date,"input-classes":"border font-none rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.expirtyDate,"onUpdate:modelValue":t[7]||(t[7]=c=>e.expirtyDate=c),format:"dd/MM/yyyy"},null,8,["minDate","modelValue"])]),s(h,{type:"textarea",label:"Remarks",modelValue:e.remarks,"onUpdate:modelValue":t[8]||(t[8]=c=>e.remarks=c),validation:"required"},null,8,["modelValue"])]),o("div",_e,[s(a,{text:"Clear form",click:()=>{}}),s(f,{loading:e.loading,type:"submit",color:"success",icon:e.saveIcon,click:()=>{},text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const fe=M(ae,[["render",ve]]),ge={components:{TransitionRoot:F,TransitionChild:X,Dialog:K,DialogPanel:z,DialogTitle:H,XMarkIcon:W,NoSymbolIcon:Q,ExclamationTriangleIcon:$,ArchiveBoxXMarkIcon:B},data(){return{show:!1,notCollectedIcon:B,loading:!1,statusLoading:!1,reason:"",cookie:R("token")}},props:{data:{type:Object,required:!0},orderId:{type:String,required:!0}},methods:{async acceptNotCollected(){this.statusLoading=!0;const r=new x,t={route:"stock_requisition_not_collected",stock_requisition_id:this.data.id,stock_status_reason:this.reason},{data:l,error:d,pending:e}=await r.updateStockOrderStatus(`${this.cookie}`,t);this.statusLoading=e,l.value&&(this.$emit("update",!0),this.statusLoading=!1,this.reason="",this.handleClick(),v().$toast.success("Stock order requisition not collected successfully!")),d.value&&(console.error(d.value),this.statusLoading=!1)},handleClick(){this.show=!this.show}}},ye=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),ke={class:"fixed inset-0 overflow-y-auto"},be={class:"flex min-h-full items-center justify-center p-4 text-center"},xe={class:"border-b px-3 py-3 flex items-center justify-between"},Ce={class:"mt-2 space-y-3 px-5"},Ve={class:"rounded px-2 py-2"},we={class:"font-semibold text-red-500"},qe={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Se(r,t,l,d,e,i){const f=O,g=u("TransitionChild"),m=u("ArchiveBoxXMarkIcon"),C=u("DialogTitle"),h=u("XMarkIcon"),n=u("FormKit"),a=L,y=u("DialogPanel"),S=u("Dialog"),I=u("TransitionRoot");return _(),k("div",null,[s(f,{click:i.handleClick,color:"error",text:"Not Received",icon:e.notCollectedIcon},null,8,["click","icon"]),s(I,{appear:"",show:e.show,as:"template"},{default:p(()=>[s(S,{as:"div",class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[ye]),_:1}),o("div",ke,[o("div",be,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",xe,[s(C,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:p(()=>[s(m,{class:"h-5 w-5 mr-2"}),V(" Confirm Not Collected ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>i.handleClick&&i.handleClick(...b))},[s(h,{class:"w-5 h-5"})])]),s(n,{type:"form","submit-label":"Update",onSubmit:t[2]||(t[2]=b=>i.acceptNotCollected()),actions:!1},{default:p(({value:b})=>[o("div",Ce,[o("div",Ve,[V(" Please provide a reason why "),o("span",we,U(l.data.item.name),1),V(" from the Order "),o("strong",null,U(l.orderId),1),V(" was not collected? Note that once this action is completed, it can not be undone ")]),s(n,{type:"textarea",label:"Reason",validation:"required",modelValue:e.reason,"onUpdate:modelValue":t[1]||(t[1]=c=>e.reason=c)},null,8,["modelValue"])]),o("div",qe,[s(a,{click:()=>{i.handleClick()},type:"button",text:"Cancel"},null,8,["click"]),s(f,{loading:e.statusLoading,type:"submit",click:()=>{},color:"error",icon:e.notCollectedIcon,text:"Reject"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ie=M(ge,[["render",Se]]),Ne={setup(){ee({title:`${te.name.toUpperCase()} - Receive Stock Order`})},components:{TicketIcon:oe},data(){return{header:"Receive Stock Order",checkIcon:E,saveIcon:j,allIcon:se,rejectIcon:Q,pages:[{name:"Home",link:"/home"},{name:"Stock Orders",link:"/stock-management/orders"}],cookie:R("token"),deleteicon:re,loading:!1,adding:!1,receiving:!1,verifying:!1,requisitions:new Array,voidReason:"",issuerName:"",issuerDesignation:"",issuerPhone:"",issuerSignature:"",approverName:"",approverDesignation:"",approverPhone:"",approverSignature:"",pharmacyWorkers:new Array}},created(){this.init()},computed:{hasApprover(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(r=>r.record_type==="approver")},hasIssuer(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(r=>r.record_type==="issuer")}},methods:{async addPharmacyWorker(r){this.adding=!0;const t=new x,l={stock_order_id:`${this.$route.query.order_id}`,record_type:r,name:r=="issuer"?this.issuerName:this.approverName,designation:r=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:r=="issuer"?this.issuerPhone:this.approverPhone,signature:r=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:i}=await t.createStockOrderPharmacy(`${this.cookie}`,l);this.adding=i,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details saved successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(P),this.adding=!1)},async updatePharmacyWorker(r){this.adding=!0;const t=new x,l={pharmacy_id:this.pharmacyWorkers.filter(f=>f.record_type==r)[0].id,record_type:r,name:r=="issuer"?this.issuerName:this.approverName,designation:r=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:r=="issuer"?this.issuerPhone:this.approverPhone,signature:r=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:i}=await t.updateStockOrderPharmacy(`${this.cookie}`,l);this.adding=i,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details updated successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(P),this.adding=!1)},async init(){this.loading=!0;const r=new x,{data:t,error:l,pending:d}=await r.getStockOrder(`${this.cookie}`,`${this.$route.query.order_id}`);this.loading=d,t.value&&(this.requisitions=t.value.stock_requisitions,t.value.stock_pharmacy_approver_and_issuers.map(e=>{e.record_type=="issuer"?(this.issuerName=e.name,this.issuerPhone=e.phone_number,this.issuerDesignation=e.designation,this.issuerSignature=e.signature):(this.approverName=e.name,this.approverPhone=e.phone_number,this.approverDesignation=e.designation,this.approverSignature=e.signature)}),this.pharmacyWorkers=t.value.stock_pharmacy_approver_and_issuers,this.loading=!1),l.value&&(console.error(l.value),this.loading=!1)},deleteStockItem(r){r>=0&&r<this.requisitions.length&&this.requisitions.splice(r,1)},isReceivedOrNotCollected(r){for(let t=0;t<r.length;t++)if(r[t].requisition_status.toLowerCase()==="received"||r[t].requisition_status.toLowerCase()==="not collected")return!0;return!1},async receiveOrder(){if(this.isReceivedOrNotCollected(this.requisitions))if(this.hasApprover&&this.hasIssuer){this.receiving=!0;const r=new x,t={stock_order_id:`${this.$route.query.order_id}`},{data:l,error:d,pending:e}=await r.receiveStockOrder(`${this.cookie}`,t);this.receiving=e,l.value&&(v().$toast.success("Stock order received successfully!"),this.$router.push("/stock-management/orders"),this.receiving=!1),d.value&&(console.error(d.value),this.receiving=!1)}else v().$toast.warn("Order should be issued and approved by pharmacy!");else v().$toast.warn("Please enter the amount recieved or mark as not collected!")}}},De={class:"px-5 py-5"},Ue={class:"py-5 flex items-center justify-between"},Pe={class:"text-2xl font-semibold"},Re={class:"py-2"},Me=o("div",{class:"flex items-center space-x-3"},[o("img",{src:ie,class:"w-8 h-8"}),o("h3",{class:"text-xl font-semibold"},"Pharmacy")],-1),Oe={class:"border rounded mt-3"},Te=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Issuer ",-1),Ae={class:"px-5 py-5"},Be={class:"grid grid-cols-4 gap-5"},Le={class:"border rounded mt-3"},We=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Approver ",-1),je={class:"px-5 py-5"},Fe={class:"grid grid-cols-4 gap-5"},Xe={class:"rounded border"},Ke=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Stock Items ",-1),ze={class:"grid grid-cols-4 gap-4 mt-5"},He={class:"flex flex-col space-y-2"},Qe={class:"mt-8 flex space-x-2.5 items-center"},Ee=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10 mt"},null,-1),Ge=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Je=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Ye=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Ze=[Ee,Ge,Je,Ye];function $e(r,t,l,d,e,i){const f=G,g=O,m=u("FormKit"),C=fe,h=Ie;return _(),k("div",De,[s(f,{pages:e.pages},null,8,["pages"]),o("div",Ue,[o("h3",Pe,U(e.header),1),s(g,{text:"Receive Order",color:"success",icon:e.checkIcon,click:()=>i.receiveOrder()},null,8,["icon","click"])]),o("div",null,[N(o("div",Re,[Me,o("div",Oe,[Te,o("div",Ae,[s(m,{type:"form","submit-label":"Update",onSubmit:t[4]||(t[4]=n=>i.hasIssuer?i.updatePharmacyWorker("issuer"):i.addPharmacyWorker("issuer")),actions:!1},{default:p(({value:n})=>[o("div",Be,[s(m,{type:"text",label:"Name",modelValue:e.issuerName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.issuerName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.issuerDesignation,"onUpdate:modelValue":t[1]||(t[1]=a=>e.issuerDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.issuerPhone,"onUpdate:modelValue":t[2]||(t[2]=a=>e.issuerPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.issuerSignature,"onUpdate:modelValue":t[3]||(t[3]=a=>e.issuerSignature=a),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:i.hasIssuer?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:i.hasIssuer?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])]),o("div",Le,[We,o("div",je,[s(m,{type:"form","submit-label":"Update",onSubmit:t[9]||(t[9]=n=>i.hasApprover?i.updatePharmacyWorker("approver"):i.addPharmacyWorker("approver")),actions:!1},{default:p(({value:n})=>[o("div",Fe,[s(m,{type:"text",label:"Name",modelValue:e.approverName,"onUpdate:modelValue":t[5]||(t[5]=a=>e.approverName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.approverDesignation,"onUpdate:modelValue":t[6]||(t[6]=a=>e.approverDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.approverPhone,"onUpdate:modelValue":t[7]||(t[7]=a=>e.approverPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.approverSignature,"onUpdate:modelValue":t[8]||(t[8]=a=>e.approverSignature=a),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:i.hasApprover?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:i.hasApprover?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])])],512),[[D,!e.loading]]),N(o("div",Xe,[Ke,(_(!0),k(T,null,A(e.requisitions,(n,a)=>(_(),k("div",{class:"flex flex-col space-y-3 px-5 py-5",key:a},[o("div",ze,[o("div",He,[s(m,{label:"Stock item",disabled:!0,modelValue:n.item.name,"onUpdate:modelValue":y=>n.item.name=y},null,8,["modelValue","onUpdate:modelValue"])]),s(m,{label:"Quantity requested",type:"number",validation:"required",modelValue:n.quantity_requested,"onUpdate:modelValue":y=>n.quantity_requested=y,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),o("div",Qe,[n.requisition_status.toLowerCase()!=="received"?(_(),w(C,{key:0,data:n,onUpdate:i.init},null,8,["data","onUpdate"])):q("",!0),n.requisition_status.toLowerCase()!=="received"?(_(),w(h,{key:1,onUpdate:i.init,data:n,orderId:`${r.$route.params.voucherId}`},null,8,["onUpdate","data","orderId"])):q("",!0)])])]))),128))],512),[[D,!e.loading]]),N(o("div",null,[(_(),k(T,null,A(5,n=>o("div",{class:"flex items-center space-x-3 mb-3",key:n},Ze)),64))],512),[[D,e.loading]])])])}const wt=M(Ne,[["render",$e]]);export{wt as default};
