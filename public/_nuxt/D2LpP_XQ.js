var Te=Object.defineProperty;var Se=(w,y,u)=>y in w?Te(w,y,{enumerable:!0,configurable:!0,writable:!0,value:u}):w[y]=u;var U=(w,y,u)=>Se(w,typeof y!="symbol"?y+"":y,u);import{_ as Ue}from"./DnQNH6n5.js";import{d as Re,E as ke,a as Ce,r as i,w as Me,m as ae,b as V,e as E,f as a,h as l,g as t,i as R,v as Y,n as Ne,y as x,U as ne,F as j,j as B,t as De,x as Ae,s as k,p as Ie,u as O,az as $e,k as qe,_ as Pe}from"./CFJLM_Ie.js";import{_ as Ge}from"./BaCgUW4N.js";import{_ as Oe}from"./D7Zclkhu.js";import{_ as Le}from"./B4k1OJQ0.js";import{T as Fe,b as W,M as Ye,G as re,f as je,g as L,h as ie,e as Be,i as We}from"./Zs5V9wEc.js";import{e as C,r as ue,d as de,f as Qe}from"./NSQCzdgw.js";import{H as He}from"./D72LMua3.js";import{r as Q}from"./Dhp4HNmj.js";import{r as Ke}from"./C5mgOuCi.js";import{r as ze}from"./X6D5z3Ai.js";import"./0YTBxEWP.js";import"./BoZExIdM.js";import"./sen56F8u.js";import"./B307KWXK.js";import"./DL7tKmRK.js";import"./1TxO0rPq.js";import"./CIBAR2Bi.js";import"./rauhO8aD.js";import"./C6QRH5hM.js";import"./CXlG2fUz.js";import"./BwWK-syC.js";import"./BmAKWF52.js";import"./ccM_rzRE.js";class Je extends He{constructor(){super(...arguments);U(this,"ORGANISMS",C.organisms);U(this,"SPECIMENS",C.specimens);U(this,"DEPARTMENTS",C.departments);U(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(u){const _={route:this.ORGANISMS,method:"GET",token:`${u}`};return this.call(_)}async getSpecimens(u){const _={route:this.SPECIMENS,method:"GET",token:`${u}`};return this.call(_)}async getDepartments(u){const _={route:this.DEPARTMENTS,method:"GET",token:`${u}`};return this.call(_)}async getTestTypesIndicators(u){const _={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${u}`};return this.call(_)}}const Xe=Je,Ze={class:"px-5 py-5"},et=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1),tt={class:"flex items-center justify-center mx-auto my-20"},ot={class:"mt-2 space-y-3"},st={class:"grid grid-cols-2 gap-4"},lt={class:"w-full flex items-center"},at={class:"py-1 ml-2 flex flex-col space-y-2"},nt=t("p",{class:"font-medium text-base"},"Duration",-1),rt={class:"w-full flex items-center space-x-2"},it=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1),ut={class:"w-full flex flex-col space-y-2"},dt=t("label",{class:"font-medium"},"Organisms",-1),mt={class:"w-full flex flex-col space-y-2"},ct=t("label",{class:"font-medium"},"Specimens",-1),pt={class:"w-full flex items-center space-x-2"},_t=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1),vt={class:"w-full flex flex-col space-y-2"},ft=t("label",{class:"font-medium"},"Lab section",-1),gt={class:"w-full flex"},yt={class:"py-3 flex items-center justify-between"},ht={class:"text-lg text-grameasuresy-700 font-semibold"},xt=["onClick"],Vt={class:"grid grid-cols-4 gap-2 mb-3"},bt=t("p",{class:"font-medium mb-2"},"Type",-1),Et={class:"flex items-center space-x-3"},wt={class:"grid grid-cols-2 gap-2"},Tt={class:""},St=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1),Ut={class:"grid grid-cols-2 gap-2"},Rt={class:"flex flex-col"},kt=t("label",{class:"font-medium"},"Sex",-1),Ct={class:""},Mt=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1),Nt={class:"grid grid-cols-2 gap-2"},Dt=["onClick"],At={class:"w-full flex items-center justify-center space-x-2"},It={class:"w-full grid grid-cols-2 gap-4"},$t=["onClick"],qt={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},Pt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},mo=Re({__name:"index",setup(w){const y=ke(),u=Ce("token"),_=new Xe,me=i(!1),p=i([]),M=i(""),N=i(""),D=i(""),H=i([]),b=i(!1),A=i([]),K=i([]),z=i([]),I=i([]),$=i(!1),q=i(!1),ce=i(Fe),T=i({name:W}),J=i([]),X=i([]),Z=i([]),P=i(""),G=i({name:W}),pe=je,_e=async()=>{const{data:s,error:e}=await _.getOrganisms(`${u.value}`);s.value&&(K.value=s.value,z.value=s.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},ve=async()=>{const{data:s,error:e}=await _.getSpecimens(`${u.value}`);s.value&&(J.value=s.value,X.value=s.value.map(d=>d.name)),e.value&&(me.value=!1,console.error("could not load specimens: ",e.value))},fe=async()=>{const{data:s,error:e}=await _.getDepartments(`${u.value}`);s.value&&(Z.value=s.value),e.value&&console.error("could not load departments: ",e.value)},ge=async()=>{const{data:s,error:e}=await _.getTestTypesIndicators(`${u.value}`);s.value&&(H.value=s.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function ee(s,e){try{const c=(p==null?void 0:p.value[s]).indicator_ranges;let r=0;if(c.length>0){const f=c.length-1;r=c[f].id}const v={id:r&&r+1,interpretation:""},h=e.toLowerCase();h.includes("numeric")?(v.age_max=0,v.age_min=0,v.upper_range=0,v.lower_range=0,v.gender={name:L.SELECT_GENDER}):(h=="auto complete"||h.includes("alpha"))&&(v.value=""),c.push(v)}catch(d){console.error("Error: ",d)}}const te=(s,e)=>{p.value[s].indicator_ranges.splice(e,1)},oe=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ie},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},se=s=>new Set(["free text","rich text"]).has(s);async function ye(){b.value=!0;const s=p.value.map(g=>{const v=g.indicator_ranges.map(h=>{if(h.hasOwnProperty("gender")){const f=h;return{sex:f.gender.name,max_age:f.max_age,min_age:f.min_age,upper_range:f.upper_range,lower_range:f.lower_range,interpretation:f.interpretation}}else return delete h.id,h});return{...g,indicator_ranges:v,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${u.value}`,body:{name:M.value,short_name:N.value,sex:P.value,expected_turn_around_time:{value:D.value,unit:T.value.name},print_device:$.value,department_id:G.value.id,specimens:de(J.value,A.value),indicators:s,organisms:de(K.value,I.value)}},{data:d,error:c,pending:r}=await Qe(e);b.value=r,d.value&&(le(),y.push("/test-catalog/test-types?create=true"),b.value=!1),c.value&&(console.error("error creating test type: ",c.value),O().$toast.error(Be),b.value=!1)}const he=s=>{const e=new Set(We);for(const d of s)if(d.type.name.toLowerCase()==="numeric"){for(const c of d.indicator_ranges)if(!e.has(c.gender.name.toLowerCase()))return O().$toast.warning(L.GENDER_REQUIRED),!1}return!0},xe=s=>s.name===W?(O().$toast.warning(L.DURATION_REQUIRED),!1):!0,Ve=s=>{for(const e of s)if(e.type.name===ie)return O().$toast.warning(L.MEASURE_TYPE_REQUIRED),!1;return!0},be=()=>{const s=he(p.value),e=xe(T.value),d=Ve(p.value);return s&&e&&d};Me(()=>p.value.map(s=>s.type),(s,e)=>{s!==e&&s.forEach((d,c)=>{if(d!==e[c]&&new Set(Ye).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[c].type.name;ee(c,g)}})},{deep:!0});const le=()=>{$e("submitForm")};return ve(),fe(),ge(),_e(),oe(),(s,e)=>{const d=Ue,c=qe,r=ae("FormKit"),g=Ge,v=ae("multi-select"),h=Oe,f=Pe,Ee=Le;return V(),E("div",Ze,[a(d,{pages:l(pe)},null,8,["pages"]),et,t("div",null,[R(t("div",tt,[a(c,{loading:l(b)},null,8,["loading"])],512),[[Y,l(b)]]),R(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[10]||(e[10]=we=>be()&&ye()),actions:!1},{default:Ne(({value:we})=>[t("div",ot,[t("div",st,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l(M),"onUpdate:modelValue":e[0]||(e[0]=o=>x(M)?M.value=o:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:l(N),"onUpdate:modelValue":e[1]||(e[1]=o=>x(N)?N.value=o:null)},null,8,["modelValue"])]),t("div",lt,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:l(D),"onUpdate:modelValue":e[2]||(e[2]=o=>x(D)?D.value=o:null)},null,8,["modelValue"]),t("div",at,[nt,a(g,{items:l(ce),modelValue:l(T),"onUpdate:modelValue":e[3]||(e[3]=o=>x(T)?T.value=o:null)},null,8,["items","modelValue"])])]),t("div",rt,[R(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=o=>x(q)?q.value=o:null)},null,512),[[ne,l(q)]]),it]),R(t("div",ut,[dt,a(v,{style:{"--ms-max-height":"none !important"},modelValue:l(I),"onUpdate:modelValue":e[5]||(e[5]=o=>x(I)?I.value=o:null),options:l(z),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[Y,l(q)]]),t("div",mt,[ct,a(v,{style:{"--ms-max-height":"none !important"},modelValue:l(A),"onUpdate:modelValue":e[6]||(e[6]=o=>x(A)?A.value=o:null),options:l(X),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",pt,[R(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=o=>x($)?$.value=o:null)},null,512),[[ne,l($)]]),_t]),t("div",vt,[ft,a(g,{"is-searchable":!0,modelValue:l(G),"onUpdate:modelValue":e[8]||(e[8]=o=>x(G)?G.value=o:null),items:l(Z)},null,8,["modelValue","items"])]),a(h,{label:"Specific Sex","items-selected":l(P),"onUpdate:itemsSelected":e[9]||(e[9]=o=>x(P)?P.value=o:null),items:("GENDER"in s?s.GENDER:l(re)).map(o=>o.name),mode:"single"},null,8,["items-selected","items"]),t("div",gt,[a(f,{click:()=>{oe()},color:"primary",text:"Add Measure",icon:l(ue)},null,8,["click","icon"])]),l(p).length!=0?(V(!0),E(j,{key:0},B(l(p),(o,S)=>(V(),E("div",{key:o.id,class:"border px-5 py-3 rounded"},[t("div",yt,[t("h3",ht," Measures ("+De(S+1)+") ",1),t("button",{onClick:()=>{l(p).splice(S,1)}},[a(l(Q),{class:"w-5 h-5"})],8,xt)]),t("div",Vt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:o.name,"onUpdate:modelValue":n=>o.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[bt,a(g,{modelValue:o.type,"onUpdate:modelValue":n=>o.type=n,items:l(H)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:o.unit,"onUpdate:modelValue":n=>o.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:o.description,"onUpdate:modelValue":n=>o.description=n},null,8,["modelValue","onUpdate:modelValue"])]),se(o.type.name.toLowerCase())?k("",!0):(V(),Ae(f,{key:0,type:"button",click:()=>{ee(S,o.type.name)},color:"primary",text:"Add New Range",icon:l(ue)},null,8,["click","icon"])),o.indicator_ranges.length>0&&o.type.name==="Numeric"?(V(!0),E(j,{key:1},B(o.indicator_ranges,(n,F)=>(V(),E("div",{class:"w-full px-3 py-3",key:n.id},[t("div",Et,[t("div",wt,[t("div",Tt,[St,t("div",Ut,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":m=>n.min_age=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":m=>n.max_age=m},null,8,["modelValue","onUpdate:modelValue"]),t("div",Rt,[kt,a(g,{modelValue:n.gender,"onUpdate:modelValue":m=>n.gender=m,items:"GENDER"in s?s.GENDER:l(re)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",Ct,[Mt,t("div",Nt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":m=>n.upper_range=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":m=>n.lower_range=m},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(S,F)},[a(l(Q),{class:"w-5 h-5"})],8,Dt)])]))),128)):k("",!0),o.indicator_ranges.length>0&&o.type.name=="Auto Complete"||o.type.name==="Alpha Numeric"?(V(!0),E(j,{key:2},B(o.indicator_ranges,(n,F)=>(V(),E("div",{class:"px-3 py-3",key:n.id},[t("div",At,[t("div",It,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":m=>n.value=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(S,F),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(l(Q),{class:"w-5 h-5"})],8,$t)])]))),128)):k("",!0),se(o.type.name.toLowerCase())?(V(),E("div",qt,[a(l(Ke),{class:"w-5 h-5 mr-2"}),Ie(" A text box will appear for results entry ")])):k("",!0)]))),128)):k("",!0)]),t("div",Pt,[a(Ee,{type:"button",click:()=>{le()},text:"Clear form"},null,8,["click"]),a(f,{type:"submit",click:()=>{},loading:l(b),color:"success",icon:l(ze),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[Y,!l(b)]])])])}}});export{mo as default};
