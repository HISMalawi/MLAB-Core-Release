var be=Object.defineProperty;var Ee=(w,y,i)=>y in w?be(w,y,{enumerable:!0,configurable:!0,writable:!0,value:i}):w[y]=i;var U=(w,y,i)=>(Ee(w,typeof y!="symbol"?y+"":y,i),i);import{_ as we}from"./Breadcrumb.vue.27032e73.js";import{p as Te,E as Se,a as Ue,x as u,B as Re,h as se,o as x,c as E,d as a,m as s,e as t,w as R,v as F,i as ke,z as V,U as ae,F as Y,r as j,t as Ce,q as Me,l as k,j as Ae,b as O,am as Ne,g as De,f as Ie}from"./entry.717629a0.js";import{_ as $e}from"./Dropdown.729717fa.js";import{_ as qe}from"./OutlinedButton.83a5a8a0.js";import{T as Pe,S as B,M as Oe,G as Ge,b as Le,f as G,g as ne,e as Fe,h as Ye}from"./constants.75204871.js";import{H as je,e as C,r as re,i as ie,f as Be}from"./fetch.f246156a.js";import{r as W}from"./XMarkIcon.cf19f790.js";import{r as We}from"./InformationCircleIcon.43ca6dcd.js";import{r as Qe}from"./ArrowDownTrayIcon.79c6e072.js";import"./nuxt-link.1c9114c5.js";import"./HomeIcon.40653a6b.js";import"./listbox.e27c2b22.js";import"./hidden.c6e30757.js";import"./use-text-value.9d6b25b6.js";import"./CheckIcon.cf3afd16.js";import"./CheckCircleIcon.94ec606d.js";import"./MagnifyingGlassIcon.f9ead28b.js";import"./network.b529c562.js";import"./transition.df1b9b67.js";import"./PencilSquareIcon.768d5e2b.js";import"./PrinterIcon.2dd5e0f4.js";class He extends je{constructor(){super(...arguments);U(this,"ORGANISMS",C.organisms);U(this,"SPECIMENS",C.specimens);U(this,"DEPARTMENTS",C.departments);U(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(i){const _={route:this.ORGANISMS,method:"GET",token:`${i}`};return this.call(_)}async getSpecimens(i){const _={route:this.SPECIMENS,method:"GET",token:`${i}`};return this.call(_)}async getDepartments(i){const _={route:this.DEPARTMENTS,method:"GET",token:`${i}`};return this.call(_)}async getTestTypesIndicators(i){const _={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${i}`};return this.call(_)}}const Ke=He,ze={class:"px-5 py-5"},Je=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1),Xe={class:"flex items-center justify-center mx-auto my-20"},Ze={class:"mt-2 space-y-3"},et={class:"grid grid-cols-2 gap-4"},tt={class:"w-full flex items-center"},ot={class:"py-1 ml-2 flex flex-col space-y-2"},lt=t("p",{class:"font-medium text-base"},"Duration",-1),st={class:"w-full flex items-center space-x-2"},at=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1),nt={class:"w-full flex flex-col space-y-2"},rt=t("label",{class:"font-medium"},"Organisms",-1),it={class:"w-full flex flex-col space-y-2"},ut=t("label",{class:"font-medium"},"Specimens",-1),dt={class:"w-full flex items-center space-x-2"},ct=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1),mt={class:"w-full flex flex-col space-y-2"},pt=t("label",{class:"font-medium"},"Lab section",-1),_t={class:"w-full flex"},vt={class:"py-3 flex items-center justify-between"},ft={class:"text-lg text-grameasuresy-700 font-semibold"},gt=["onClick"],yt={class:"grid grid-cols-4 gap-2 mb-3"},ht=t("p",{class:"font-medium mb-2"},"Type",-1),xt={class:"flex items-center space-x-3"},Vt={class:"grid grid-cols-2 gap-2"},bt={class:""},Et=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1),wt={class:"grid grid-cols-2 gap-2"},Tt={class:"flex flex-col"},St=t("label",{class:"font-medium"},"Sex",-1),Ut={class:""},Rt=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1),kt={class:"grid grid-cols-2 gap-2"},Ct=["onClick"],Mt={class:"w-full flex items-center justify-center space-x-2"},At={class:"w-full grid grid-cols-2 gap-4"},Nt=["onClick"],Dt={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},It={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},so=Te({__name:"index",setup(w){const y=Se(),i=Ue("token"),_=new Ke,ue=u(!1),p=u([]),M=u(""),A=u(""),N=u(""),Q=u([]),b=u(!1),D=u([]),H=u([]),K=u([]),I=u([]),$=u(!1),q=u(!1),de=u(Pe),T=u({name:B}),z=u([]),J=u([]),X=u([]),P=u({name:B}),ce=Le,me=async()=>{const{data:o,error:e}=await _.getOrganisms(`${i.value}`);o.value&&(H.value=o.value,K.value=o.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},pe=async()=>{const{data:o,error:e}=await _.getSpecimens(`${i.value}`);o.value&&(z.value=o.value,J.value=o.value.map(d=>d.name)),e.value&&(ue.value=!1,console.error("could not load specimens: ",e.value))},_e=async()=>{const{data:o,error:e}=await _.getDepartments(`${i.value}`);o.value&&(X.value=o.value),e.value&&console.error("could not load departments: ",e.value)},ve=async()=>{const{data:o,error:e}=await _.getTestTypesIndicators(`${i.value}`);o.value&&(Q.value=o.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function Z(o,e){try{const m=(p==null?void 0:p.value[o]).indicator_ranges;let r=0;if(m.length>0){const h=m.length-1;r=m[h].id}const v={id:r&&r+1,interpretation:""},f=e.toLowerCase();f.includes("numeric")?(v.age_max=0,v.age_min=0,v.upper_range=0,v.lower_range=0,v.gender={name:G.SELECT_GENDER}):(f=="auto complete"||f.includes("alpha"))&&(v.value=""),m.push(v)}catch(d){console.error("Error: ",d)}}const ee=(o,e)=>{p.value[o].indicator_ranges.splice(e,1)},te=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ne},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},oe=o=>new Set(["free text","rich text"]).has(o);async function fe(){b.value=!0;const o=p.value.map(g=>{const v=g.indicator_ranges.map(f=>{if(f.hasOwnProperty("gender")){const h=f;return{sex:h.gender.name,max_age:h.max_age,min_age:h.min_age,upper_range:h.upper_range,lower_range:h.lower_range,interpretation:h.interpretation}}else return delete f.id,f});return{...g,indicator_ranges:v,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${i.value}`,body:{name:M.value,short_name:A.value,expected_turn_around_time:{value:N.value,unit:T.value.name},print_device:$.value,department_id:P.value.id,specimens:ie(z.value,D.value),indicators:o,organisms:ie(H.value,I.value)}},{data:d,error:m,pending:r}=await Be(e);b.value=r,d.value&&(le(),y.push("/test-catalog/test-types?create=true"),b.value=!1),m.value&&(console.error("error creating test type: ",m.value),O().$toast.error(Fe),b.value=!1)}const ge=o=>{const e=new Set(Ye);for(const d of o)if(d.type.name.toLowerCase()==="numeric"){for(const m of d.indicator_ranges)if(!e.has(m.gender.name.toLowerCase()))return O().$toast.warning(G.GENDER_REQUIRED),!1}return!0},ye=o=>o.name===B?(O().$toast.warning(G.DURATION_REQUIRED),!1):!0,he=o=>{for(const e of o)if(e.type.name===ne)return O().$toast.warning(G.MEASURE_TYPE_REQUIRED),!1;return!0},xe=()=>{const o=ge(p.value),e=ye(T.value),d=he(p.value);return o&&e&&d};Re(()=>p.value.map(o=>o.type),(o,e)=>{o!==e&&o.forEach((d,m)=>{if(d!==e[m]&&new Set(Oe).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[m].type.name;Z(m,g)}})},{deep:!0});const le=()=>{Ne("submitForm")};return pe(),_e(),ve(),me(),te(),(o,e)=>{const d=we,m=De,r=se("FormKit"),g=$e,v=se("multi-select"),f=Ie,h=qe;return x(),E("div",ze,[a(d,{pages:s(ce)},null,8,["pages"]),Je,t("div",null,[R(t("div",Xe,[a(m,{loading:s(b)},null,8,["loading"])],512),[[F,s(b)]]),R(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[9]||(e[9]=Ve=>xe()&&fe()),actions:!1},{default:ke(({value:Ve})=>[t("div",Ze,[t("div",et,[a(r,{type:"text",label:"Name",validation:"required",modelValue:s(M),"onUpdate:modelValue":e[0]||(e[0]=l=>V(M)?M.value=l:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:s(A),"onUpdate:modelValue":e[1]||(e[1]=l=>V(A)?A.value=l:null)},null,8,["modelValue"])]),t("div",tt,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:s(N),"onUpdate:modelValue":e[2]||(e[2]=l=>V(N)?N.value=l:null)},null,8,["modelValue"]),t("div",ot,[lt,a(g,{items:s(de),modelValue:s(T),"onUpdate:modelValue":e[3]||(e[3]=l=>V(T)?T.value=l:null)},null,8,["items","modelValue"])])]),t("div",st,[R(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>V(q)?q.value=l:null)},null,512),[[ae,s(q)]]),at]),R(t("div",nt,[rt,a(v,{style:{"--ms-max-height":"none !important"},modelValue:s(I),"onUpdate:modelValue":e[5]||(e[5]=l=>V(I)?I.value=l:null),options:s(K),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[F,s(q)]]),t("div",it,[ut,a(v,{style:{"--ms-max-height":"none !important"},modelValue:s(D),"onUpdate:modelValue":e[6]||(e[6]=l=>V(D)?D.value=l:null),options:s(J),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",dt,[R(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>V($)?$.value=l:null)},null,512),[[ae,s($)]]),ct]),t("div",mt,[pt,a(g,{"is-searchable":!0,modelValue:s(P),"onUpdate:modelValue":e[8]||(e[8]=l=>V(P)?P.value=l:null),items:s(X)},null,8,["modelValue","items"])]),t("div",_t,[a(f,{click:()=>{te()},color:"primary",text:"Add Measure",icon:s(re)},null,8,["click","icon"])]),s(p).length!=0?(x(!0),E(Y,{key:0},j(s(p),(l,S)=>(x(),E("div",{key:l.id,class:"border px-5 py-3 rounded"},[t("div",vt,[t("h3",ft," Measures ("+Ce(S+1)+") ",1),t("button",{onClick:()=>{s(p).splice(S,1)}},[a(s(W),{class:"w-5 h-5"})],8,gt)]),t("div",yt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l.name,"onUpdate:modelValue":n=>l.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[ht,a(g,{modelValue:l.type,"onUpdate:modelValue":n=>l.type=n,items:s(Q)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:l.unit,"onUpdate:modelValue":n=>l.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:l.description,"onUpdate:modelValue":n=>l.description=n},null,8,["modelValue","onUpdate:modelValue"])]),oe(l.type.name.toLowerCase())?k("",!0):(x(),Me(f,{key:0,type:"button",click:()=>{Z(S,l.type.name)},color:"primary",text:"Add New Range",icon:s(re)},null,8,["click","icon"])),l.indicator_ranges.length>0&&l.type.name==="Numeric"?(x(!0),E(Y,{key:1},j(l.indicator_ranges,(n,L)=>(x(),E("div",{class:"w-full px-3 py-3",key:n.id},[t("div",xt,[t("div",Vt,[t("div",bt,[Et,t("div",wt,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":c=>n.min_age=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":c=>n.max_age=c},null,8,["modelValue","onUpdate:modelValue"]),t("div",Tt,[St,a(g,{modelValue:n.gender,"onUpdate:modelValue":c=>n.gender=c,items:"GENDER"in o?o.GENDER:s(Ge)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",Ut,[Rt,t("div",kt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":c=>n.upper_range=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":c=>n.lower_range=c},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":c=>n.interpretation=c},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:c=>ee(S,L)},[a(s(W),{class:"w-5 h-5"})],8,Ct)])]))),128)):k("",!0),l.indicator_ranges.length>0&&l.type.name=="Auto Complete"||l.type.name==="Alpha Numeric"?(x(!0),E(Y,{key:2},j(l.indicator_ranges,(n,L)=>(x(),E("div",{class:"px-3 py-3",key:n.id},[t("div",Mt,[t("div",At,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":c=>n.value=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":c=>n.interpretation=c},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:c=>ee(S,L),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(s(W),{class:"w-5 h-5"})],8,Nt)])]))),128)):k("",!0),oe(l.type.name.toLowerCase())?(x(),E("div",Dt,[a(s(We),{class:"w-5 h-5 mr-2"}),Ae(" A text box will appear for results entry ")])):k("",!0)]))),128)):k("",!0)]),t("div",It,[a(h,{type:"button",click:()=>{le()},text:"Clear form"},null,8,["click"]),a(f,{type:"submit",click:()=>{},loading:s(b),color:"success",icon:s(Qe),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[F,!s(b)]])])])}}});export{so as default};
