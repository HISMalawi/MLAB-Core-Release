var le=Object.defineProperty;var oe=(m,l,r)=>l in m?le(m,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[l]=r;var w=(m,l,r)=>oe(m,typeof l!="symbol"?l+"":l,r);import{_ as ie}from"./Cx0ps7pt.js";import{_ as re}from"./aXJyd3_m.js";import{_ as de}from"./Uvmb4M7E.js";import{I as z,z as ce,d as ue,bp as me,R as pe,a as fe,r as o,c as h,ao as _e,w as U,bu as P,o as ve,x as J,b as H,e as M,g as t,f as c,h as a,j as L,y as Y,t as N,bt as ye,A as y,J as O,i as be,aH as xe,C as ge,l as we,m as he,u as V,_ as Ne}from"./CXJT-Lpc.js";import{_ as Ve}from"./Cp0OfiaM.js";import{A as b,u as ke,P as $e}from"./ofDBRxfJ.js";import{P as Ce}from"./DsF3fssB.js";import{u as Se}from"./Di1jx6Ca.js";import{r as Pe}from"./DkvdsjdT.js";import"./DnBD8KZ6.js";import"./DYK00w98.js";import"./CsQbGOTM.js";import"./CfgcY93V.js";import"./o7IIh7r-.js";import"./BCFPlv0Q.js";import"./72qghTLn.js";import"./CvUGzn1T.js";import"./B60x4Jja.js";class qe{constructor(l){w(this,"client",{id:"",uuid:""});w(this,"tests",[]);w(this,"order",{priority:1,requested_by:"",collected_by:z().$state.department,sample_collected_time:"",tracking_number:""});w(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=l}createEncounter(l,r){this.encounter={...this.encounter,encounter_type:l,facility_section:r}}buildOrder(l="",r=ce().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=l,this.order.sample_collected_time=r}setTests(l,r){this.tests=r.map(p=>({specimen:l,test_type:p}))}async createOrder(l){return b.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:l})}}const De={class:"py-5 px-5"},Te={class:"mt-5"},Ae={class:"flex items-center space-x-2"},Re={class:"text-xl font-semibold uppercase"},Ue={class:"border rounded mt-5"},Je={class:"w-full py-5 px-5"},Oe={class:"flex items-center space-x-20"},Be={class:"flex items-center space-x-3"},Ee={class:"mt-1 text-gray-600"},Fe={class:"flex items-center space-x-3"},He={class:"mt-1 text-gray-600"},Me={class:"flex items-center space-x-3"},Le={class:"mt-1 text-gray-600"},Ye={class:"border mt-5 rounded"},ze={class:"px-5 py-5"},Ie={class:"w-full mb-5"},Ke={class:"flex flex-col space-y-2"},We={class:"w-full flex items-center space-x-10 mb-5"},je={class:"w-1/2 flex flex-col space-y-2"},Ge={class:"w-1/2 flex flex-col space-y-2"},Qe={class:"font-medium"},Xe={class:"w-full flex items-center space-x-10 mb-5"},Ze={class:"w-1/2 flex flex-col space-y-2"},et={class:"w-1/2 flex flex-col space-y-2"},tt={class:"w-full my-6"},st={key:0,class:"w-full mb-5 flex flex-col space-y-2"},at={class:"w-full"},Nt=ue({__name:"index",setup(m){Se({title:`${Ce.name.toUpperCase()} - New Test`});const l=me(),r=pe(),p=z(),I=ke(),K=fe("token"),u=o({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),W=o([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),B=o([]),q=o([]),k=o([]),f=o([]),_=o({name:"select visit type",id:0}),d=o({name:"select specimen",id:0}),v=o({name:"select ward",id:0}),g=o([]),$=o(""),C=o(""),D=o("Requesting Ward"),S=o(!1),j=h(()=>_e(u.value.date_of_birth)),T=h(()=>u.value.sex.match(/f/i)?"Female":"Male"),E=h(()=>`${u.value.first_name} ${u.value.middle_name} ${u.value.last_name}`),G=h(()=>u.value.client_id),A=h(()=>p.user.departments.find(s=>s.name===p.department));function Q(s){const e={route:`${we.clients}/${s}`,method:"GET",token:`${K.value}`};he(e).then(({data:n,error:x})=>{n.value&&(u.value=n.value),x.value&&console.error(x.value)})}function X(s,e){const n=s.find(x=>x.name===e);return n?n.id:null}async function Z(){const s=new qe(u.value.client_id);s.createEncounter(Number(_.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(d.value.id),g.value);const e=X(p.locations,p.selectedLocation),n=await s.createOrder(Number(e));P(n)||(V().$toast.success(`Order with accession number ${n.accession_number} has been created successfully!`),await I.alertConfirmation({message:"Do you want to print specimen label?"})&&await $e.printSpecimenLabel(n.accession_number)),r.push("/tests")}function ee(){return Number(_.value.id)==0?(V().$toast.warning("Please select visit type and try again!"),!1):Number(d.value.id)==0?(V().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(V().$toast.warning("Please select ward and try again!"),!1):g.value.length==0?(V().$toast.warning("Please select tests and try again!"),!1):!0}return U(_,async s=>{s.name.toLowerCase()=="referral"?(D.value="Requesting Facility",v.value={name:"select facility",id:0}):D.value="Requesting Ward",k.value=[],P(k.value[Number(s.id)])&&(k.value=await b.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),U(d,async s=>{P(f.value[Number(s.id)])&&(f.value[Number(s.id)]=await b.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:A.value.id,sex:T.value})||[])}),U(()=>p,async s=>{for(const e in f.value)f.value.hasOwnProperty(e)&&delete f.value[e];P(d.value)||(f.value[Number(d.value.id)]=await b.getJson("specimen/test_types",{specimen_id:Number(d.value.id),department_id:s.user.departments.find(e=>e.name===s.department).id,sex:T.value})||[]),b.getJson("specimen",{department_id:A.value.id}).then(e=>q.value=e.filter(n=>n.preferred_name!==null).map(n=>({id:n.id,name:n.preferred_name})))},{deep:!0}),ve(async()=>{const s=await b.getJson("encounter_types");B.value=s.data;const e=await b.getJson("specimen",{department_id:A.value.id});q.value=e.filter(n=>n.preferred_name!==null).map(n=>({id:n.id,name:n.preferred_name})),Q(l.query.patient_id)}),(s,e)=>{const n=ie,x=re,F=J("FormKit"),R=de,te=J("multi-select"),se=J("datepicker"),ae=Ne;return H(),M("div",null,[t("div",De,[c(n,{pages:a(W)},null,8,["pages"]),t("div",Te,[t("div",Ae,[e[9]||(e[9]=t("img",{src:Ve,class:"w-auto h-6",alt:"flash-icon"},null,-1)),t("h3",Re,[e[8]||(e[8]=L(" New order for ")),t("span",null,[c(x,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${a(E).toLowerCase().replace(" ","+")}`},{default:Y(()=>[L(" “"+N(a(E))+"” ",1)]),_:1},8,["to"])])])]),t("div",Ue,[e[13]||(e[13]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("img",{src:ye,class:"h-8 w-auto",alt:"fever-icon"}),t("h3",{class:"font-semibold text-lg"},"Patient Details")],-1)),t("div",Je,[t("div",Oe,[t("div",Be,[e[10]||(e[10]=t("h3",{class:"font-medium"},"Patient Number:",-1)),t("p",Ee,N(a(G)),1)]),t("div",Fe,[e[11]||(e[11]=t("h3",{class:"font-medium"},"Age",-1)),t("p",He,N(a(j))+" years old",1)]),t("div",Me,[e[12]||(e[12]=t("h3",{class:"font-medium"},"Sex:",-1)),t("p",Le,N(a(T)),1)])])])]),c(F,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=ne=>ee()&&Z()),actions:!1,id:"submitForm"},{default:Y(({value:ne})=>[t("div",Ye,[e[19]||(e[19]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("h3",{class:"font-semibold text-lg"},"Order Details")],-1)),t("div",ze,[t("div",Ie,[t("div",Ke,[c(F,{label:"Requesting Physician",validation:"required",modelValue:a($),"onUpdate:modelValue":e[0]||(e[0]=i=>y($)?$.value=i:null)},null,8,["modelValue"])])]),t("div",We,[t("div",je,[e[14]||(e[14]=t("label",{class:"font-medium"},"Visit Type",-1)),c(R,{items:a(B),modelValue:a(_),"onUpdate:modelValue":e[1]||(e[1]=i=>y(_)?_.value=i:null),class:O(a(_).name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",Ge,[t("label",Qe,N(a(D)),1),c(R,{isSearchable:"",items:a(k),modelValue:a(v),"onUpdate:modelValue":e[2]||(e[2]=i=>y(v)?v.value=i:null),class:O(a(v).name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),t("div",Xe,[t("div",Ze,[e[15]||(e[15]=t("label",{class:"font-medium"},"Specimen Type",-1)),c(R,{items:a(q),modelValue:a(d),"onUpdate:modelValue":e[3]||(e[3]=i=>y(d)?d.value=i:null),class:O(a(d).name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",et,[e[16]||(e[16]=t("label",{class:"font-medium"},"Tests",-1)),c(te,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:a(g),"onUpdate:modelValue":e[4]||(e[4]=i=>y(g)?g.value=i:null),options:a(f)[a(d).id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",tt,[be(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=i=>y(S)?S.value=i:null)},null,512),[[xe,a(S)]]),e[17]||(e[17]=t("label",{class:"font-medium"},"Back Data Entry",-1))]),a(S)?(H(),M("div",st,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sample collection date",-1)),c(se,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:a(C),"onUpdate:modelValue":e[6]||(e[6]=i=>y(C)?C.value=i:null)},null,8,["modelValue"])])):ge("",!0),t("div",at,[c(ae,{type:"submit",text:"Place order",color:"primary",icon:a(Pe),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{Nt as default};
