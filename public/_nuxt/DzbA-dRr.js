import{_ as re}from"./u_i5tT18.js";import{_ as ne}from"./DFDCZMcv.js";import{d as le,a as ce,r as y,c as L,m as S,b as l,e as c,f as p,g as t,t as v,n as N,h as e,p as F,y as G,F as R,j as $,z as ie,s as I,i as pe,v as me,u as A,_ as ue,k as de}from"./CgCt1uig.js";import{_ as _e}from"./CMwBAeEk.js";import{_ as fe}from"./DdXQPY3w.js";import{_ as he}from"./DN8YzQnf.js";import{u as ye}from"./Kt-y9hP3.js";import{d as q,e as ve}from"./C7nrlxI_.js";import{_ as xe}from"./BGz-rnwB.js";import{_ as ge}from"./BWdvd0jv.js";import{_ as be}from"./DKnTgFGt.js";import{h as x,f as z,e as H}from"./DDP8Pd40.js";import{u as De}from"./DOBy1ww1.js";import{P as we}from"./Bf5grz7u.js";import{r as ke}from"./B4Y1aldi.js";import{r as Re}from"./B5lis3Qx.js";import"./DAatDIeb.js";import"./CDGutsna.js";import"./BvrD8SKf.js";import"./q9WmgNLv.js";import"./DESlB7Mi.js";import"./Ck2xr5Cu.js";import"./B0S8Cwtp.js";import"./CarKmmQ_.js";import"./CosnS5_S.js";import"./D8JfA7oG.js";import"./DDaZZI9g.js";import"./BBi4X6kY.js";import"./22U_Ornm.js";import"./9jRWjONT.js";const Ce={class:"px-5 py-5"},Te=t("img",{src:xe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),$e={class:"w-full flex items-center justify-between mb-3"},Me={class:"flex items-center space-x-3"},Ee={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ae={class:"w-72 ml-2"},Oe={class:"w-44"},Se={class:"flex items-center space-x-3"},Fe={class:"border rounded print-container",id:"print-container"},Ue={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},je=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ge,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"},"LABORATORY STATISTICS REPORT")],-1),Be={class:"mt-3 px-5"},Pe={class:"font-medium mb-2"},Ve={class:"font-normal"},Ye={class:"overflow-x-auto bg-white border-t"},Le={key:0,class:"w-full overflow-x-auto"},Ne={class:"uppercase bg-gray-100"},Ge={class:"text-left"},Ie=t("th",{class:"px-4 py-2"},"Tests",-1),qe=t("th",{class:"px-4 py-2"},"Total",-1),ze={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},He={class:"px-4 py-2 font-bold"},Ke=t("td",{class:"px-4 py-2"},null,-1),Je={class:"px-4 py-2"},Qe={class:"px-4 py-2"},We={class:"w-full items-center flex flex-col space-y-2 my-10"},Xe=t("p",null,[F(" Generating report, please wait"),t("span",{class:"animate-pulse"},"...")],-1),Ze={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},et=t("img",{src:be,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),tt=t("p",null,"Data not found, please generate report",-1),st=[et,tt],ot="Lab Statistics Report",Ut=le({__name:"lab-statistics",setup(at){ye({title:`${we.name.toUpperCase()} - Lab Statistics Report`});const O=De(),U=ce("token"),K=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],C=y([]),T=y({name:"select department"}),_=y(["",""]),j=y([]),b=y([]),M=y([]),B=y([]),g=y(!1),J=()=>{_.value=new Array("","")};async function Q(){const{data:s,error:o}=await z({route:H.departments,method:"GET",token:`${U}`});s.value&&(C.value=s.value,C.value.some(r=>r.name=="All")||C.value.push({id:0,name:"All"}),C.value.sort((r,m)=>{const n=r.name.toUpperCase(),i=m.name.toUpperCase();return n<i?-1:n>i?1:0})),o.value&&console.error(o.value)}function W(s){return s==="select department"||s==="-- select test type --"||s==="-- select test status --"?"":s}function X(s,o){const a=new Date(s),r=new Date(o),m=new Array;let n=a;for(;n<=r;){const i=n.toLocaleString("default",{month:"long"});m.push(i),n.setMonth(n.getMonth()+1)}b.value=m}const Z=()=>{const{value:s}=T;return s.name==="select department"?!A().$toast.warning("Please select a department"):!0},D=L(()=>_.value[0]?x(_.value[0]).format("YYYY-MM-DD"):""),w=L(()=>_.value[1]?x(_.value[1]).format("YYYY-MM-DD"):"");async function ee(){g.value=!0;let s=`from=${D.value}&to=${w.value}&department=${W(T.value.name)}`;const o={route:`${H.aggregateReports}/lab_statistics?${s}`,method:"GET",token:`${U.value}`},{data:a,error:r,pending:m}=await z(o);if(g.value=m,a.value){X(a.value.from,a.value.to),j.value=a.value.data,M.value=te(a.value.data);let n=[];M.value.forEach(i=>{const f={};f["Tests".toUpperCase()]=i.department.toUpperCase(),b.value.forEach(d=>{f[d.toUpperCase()]=""}),f["Total".toUpperCase()]="",n.push(f),i.tests.forEach(d=>{const k={};k["Tests".toUpperCase()]=d.name,b.value.forEach(E=>{k[E.toUpperCase()]=P(d,E)}),k["Total".toUpperCase()]=V(d),n.push(k)})}),B.value=n,g.value=!1,a.value.data.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found for period ${D.value} - ${w.value}`)}r.value&&(g.value=!1,console.error("error: ",r.value),A().$toast.error(ve))}function te(s){return s.map(o=>{const a=Object.keys(o)[0],r=Object.entries(o[a]).map(([m,n])=>{const i=Object.entries(n).map(([f,d])=>({[f]:d}));return{name:m,results:i}});return{department:a,tests:r}})}function P(s,o){let a=0;return s.results.forEach(r=>{a+=r[o]||0}),a}function V(s){let o=0;return s.results.forEach(a=>{Object.values(a).forEach(r=>{o+=r})}),o}function se(s){return s%2===0}return Q(),(s,o)=>{const a=re,r=S("datepicker"),m=ne,n=ue,i=S("FormKit"),f=_e,d=fe,k=S("excel"),E=he,oe=de;return l(),c("div",Ce,[p(a,{pages:K}),t("div",{class:"flex items-center py-5"},[Te,t("h3",{class:"text-2xl font-semibold uppercase"},v(ot))]),t("div",$e,[p(i,{type:"form","submit-label":"Update",onSubmit:o[2]||(o[2]=h=>Z()&&ee()),actions:!1,id:"submitForm"},{default:N(({value:h})=>[t("div",Me,[t("div",Ee,[p(e(ke),{class:"w-5 h-5 mr-2"}),F(" Filter By Date Range "),t("div",Ae,[p(r,{onCleared:J,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(_),"onUpdate:modelValue":o[0]||(o[0]=u=>G(_)?_.value=u:null)},null,8,["modelValue"])])]),t("div",Oe,[p(m,{items:e(C),modelValue:e(T),"onUpdate:modelValue":o[1]||(o[1]=u=>G(T)?T.value=u:null)},null,8,["items","modelValue"])]),p(n,{type:"submit",color:"primary",text:"Generate Report",icon:e(Re),click:()=>{},loading:e(g)},null,8,["icon","loading"])])]),_:1}),t("div",Se,[p(f),t("div",null,[p(k,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${e(x)(e(D)).format("DD-MM-yyyy")} TO ${e(x)(e(w)).format("DD-MM-yyyy")}`,e(O).details.name,e(O).details.address,e(O).details.phone],data:e(B),worksheet:"report-work-sheet",name:`lab-statistics-report_${e(x)(e(D)).format("DD_MM_yyyy")}_to_${e(x)(e(w)).format("DD_MM_yyyy")}.xls`},{default:N(()=>[p(d,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),t("div",Fe,[t("div",Ue,[je,p(E)]),t("div",Be,[t("h3",Pe,[F(" Tests Performed Period: "),t("span",Ve,v(e(D)!=""?e(x)(e(D)).format("dateFormat"in s?s.dateFormat:e(q)):"")+" - "+v(e(w)!=""?e(x)(e(w)).format("dateFormat"in s?s.dateFormat:e(q)):""),1)])]),t("div",Ye,[e(M).length>0?(l(),c("table",Le,[t("thead",Ne,[t("tr",Ge,[Ie,(l(!0),c(R,null,$(e(b),h=>(l(),c("th",{key:h,class:"px-4 py-2"},v(h),1))),128)),qe])]),t("tbody",null,[(l(!0),c(R,null,$(e(M),h=>(l(),c(R,{key:h.department},[t("tr",ze,[t("td",He,v(h.department),1),(l(!0),c(R,null,$(e(b),u=>(l(),c("td",{key:u,class:"px-4 py-2"}))),128)),Ke]),(l(!0),c(R,null,$(h.tests,(u,ae)=>(l(),c("tr",{key:u.name,class:ie({"bg-gray-50":se(ae),"border-b border-dotted":!0})},[t("td",Je,v(u.name),1),(l(!0),c(R,null,$(e(b),Y=>(l(),c("td",{key:Y,class:"px-4 py-2"},v(P(u,Y)),1))),128)),t("td",Qe,v(V(u)),1)],2))),128))],64))),128))])])):I("",!0),pe(t("div",We,[p(oe),Xe],512),[[me,e(g)]]),e(j).length==0&&!e(g)?(l(),c("div",Ze,st)):I("",!0)])])])}}});export{Ut as default};
