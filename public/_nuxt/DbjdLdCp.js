import{_ as ye}from"./BIgjk9bL.js";import{_ as he}from"./BpMjlwPN.js";import{b as P,e as N,g as r,d as ge,r as p,a as Te,a5 as Re,aj as Ee,u as C,c as E,C as y,a6 as xe,w as I,o as Z,y as F,f as d,h as e,t as T,z as x,k as j,H as V,q as Se,K as B,O as q,l as K,E as $e,m as Ae,_ as we,a3 as De,a4 as Me,x as Ce}from"./Iy63StId.js";import{_ as Pe}from"./9cDXPPtc.js";import{_ as Ne,a as be}from"./Di7YmAEr.js";import{_ as ke}from"./D2BuRAA3.js";import{u as Ie,_ as qe}from"./BTSleEc6.js";import{u as Oe}from"./dSQnwF8t.js";import{_ as Ue}from"./DMYUdFKp.js";import{_ as Ye}from"./CJfn8iQP.js";import{P as Fe}from"./yiwDnRAW.js";import{u as je}from"./DZWvke74.js";import{r as Ve}from"./Ch943h6f.js";import{r as Be}from"./5bsad-w_.js";import"./CY_pW6Pm.js";import"./Dndf7ZKt.js";import"./Byb5n9Ur.js";import"./G37wRrHr.js";import"./57K4Quj0.js";import"./BklODkO7.js";import"./CUkWAT3i.js";import"./BAFJmU_2.js";import"./DW7An3PC.js";function Le(A,h){return P(),N("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75H12a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}const O=A=>(De("data-v-d124ae20"),A=A(),Me(),A),Ge={class:"px-5 py-5"},ze={class:"flex items-center py-5"},He=O(()=>r("img",{src:Ue,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),Qe={class:"text-2xl font-semibold uppercase"},Ze={class:"w-full flex items-center justify-between mb-5"},Ke={class:"w-full flex items-center space-x-3"},Je={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Xe={class:"w-72 ml-2"},We={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},et={class:"w-48 ml-2"},tt={class:"flex justify-end py-2"},at={class:"bg-gray-100 rounded flex items-center text-zinc-500"},st={class:"w-48"},rt={class:"w-48"},ot={class:"border rounded print-container mt-5"},nt={class:"w-full rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},lt=O(()=>r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ye,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"USER STATISTICS REPORT")],-1)),ct={class:"mt-3 px-5"},it={class:"font-medium mb-2"},ut={class:"font-normal"},dt={key:0,id:"print-container"},mt=["onClick"],pt=["onClick"],_t=["onClick"],vt=["onClick"],ft=["onClick"],yt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},ht=O(()=>r("img",{src:be,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1)),gt=O(()=>r("p",null,"Data not found, please generate report",-1)),Tt=[ht,gt],Rt=ge({__name:"user-statistics",setup(A){Oe({title:`${Fe.name.toUpperCase()} - User Statistics Report`});const{loading:h,executeCancellableRequest:J,cancelRequest:X}=Ie(),L=p(""),W=p(""),ee=Be,S=p(new Array),G=Te("token"),b=p({page:1,rowsPerPage:20,sortBy:"name"}),z=p(0),l=p([]),te=p("User Statistics Report"),H=p([]),U=je(),g=Re(),_=Ee(),m=p({name:_.query["report-type"]||"select report type"}),{$toast:ae}=C(),u=p({name:"Select and search for user..."}),se=p([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),re=p([{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}]),v=E(()=>S.value.map(t=>({...t,created_date:y(t.created_date).format("DD/MMM/YYYY"),age:xe(t.date_of_birth)}))),oe=E(()=>{const t=m.value,s=()=>v.value.length>0&&t.name=="Summary"?v.value.map(a=>({USER:a.user,"TESTS COMPLETED":a.tests_completed.count,"TESTS RECEIVED":a.tests_received.count,"SPECIMEN COLLECTED":a.specimen_collected.count,"SPECIMEN REJECTED":a.specimen_rejected.count,"TESTS AUTHORIZED":a.tests_authorized.count})):[],c=()=>v.value.length>0&&t.name=="Patient Registry"?v.value.map(a=>({"PATIENT NO":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,AGE:a.age,SEX:a.sex})):[],n=()=>v.value.length>0&&t.name=="Tests Registry"?v.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[],i=()=>v.value.length>0&&t.name=="Specimen Registry"?v.value.map(a=>({"SPECIMEN NUMBER":a.id,"PATIENT NAME":a.patient_name,"PATIENT NUMBER":a.patient_no,"DATE REGISTERED":a.created_date})):[],R=()=>v.value.length>0&&t.name=="Tests Performed"?v.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":a.patient_name,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[];return{Summary:s(),"Patient Registry":c(),"Tests Registry":n(),"Specimen Registry":i(),"Tests Performed":R()}[t.name]}),Y=E(()=>H.value.map(t=>({id:t.id,name:`${t.first_name} ${t.last_name}`}))),ne=E(()=>{const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},s=m.value.name.toLowerCase();return t[s]||""}),le=E(()=>{const t={summary:new Array({text:"Name",value:"user"},{text:"Tests Received",value:"tests_received"},{text:"Specimen Collected",value:"specimen_collected"},{text:"Specimen Rejected",value:"specimen_rejected"},{text:"Tests Performed",value:"tests_completed"},{text:"Tests Authorized",value:"tests_authorized"}),"specimen registry":new Array({text:"Specimen Number",value:"id"},{text:"Name",value:"specimen"},{text:"Patient Number",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Date Registered",value:"created_date"}),"tests registry":new Array({text:"Test Type",value:"test_type_name"},{text:"Patient Number",value:"client.id"},{text:"Patient Name",value:"actions"},{text:"Specimen",value:"specimen_type"},{text:"Date Registered",value:"created_date"}),"patients registry":new Array({text:"Patient Number",value:"id"},{text:"Name",value:"actions"},{text:"Gender",value:"sex"},{text:"Age",value:"age"},{text:"Date Registered",value:"created_date"}),"tests performed":new Array({text:"Test Id",value:"test_id"},{text:"Test Type",value:"test_type"},{text:"Patient No",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Accession Number",value:"accession_number"},{text:"Date Registered",value:"created_date"})},s=m.value.name.toLowerCase();return t[s]||new Array}),w=E(()=>l.value[0]?y(l.value[0]).format("YYYY-MM-DD"):""),D=E(()=>l.value[1]?y(l.value[1]).format("YYYY-MM-DD"):"");async function k(){if(Q(m.value)=="")C().$toast.warning("Please select a report type!");else{h.value=!0;const{page:t,rowsPerPage:s}=b.value;let c=`from=${w.value}&to=${D.value}&report_type=${Q(m.value).toLocaleLowerCase()}&page=${t}&limit=${s}&user=${u.value.id}&report_id=${_.query.report_id||""}`;const n={route:`${K.aggregateReports}user_statistics?${c}`,method:"GET",token:`${G.value}`},{data:i,error:R,pending:$}=await J(n);h.value=$,i.value&&(h.value=!1,S.value=i.value.data.tests,z.value=i.value.data.metadata.total_count,ce(i.value.data.report_id),i.value.data.tests.length>0?C().$toast.success("Report data generated successfully"):C().$toast.warning(`No data found in period ${w.value} - ${D.value}`)),R.value&&(h.value=!1,console.error(R.value),C().$toast.error($e))}}const ce=t=>{const c={...g.currentRoute.value.query,report_id:t};g.replace({query:c}).catch(n=>{console.error("Failed to replace route:",n)})};async function ie(){const{data:t,error:s}=await Ae({route:`${K.users}?page=1&per_page=2000`,method:"GET",token:`${G.value}`});t.value&&(H.value=t.value.data,Y.value.some(n=>n.name=="All")||Y.value.unshift({id:0,name:"All"})),s.value&&console.error(s.value)}const M=(t,s,c,n)=>{c!==0&&n!==""?g.push(`/reports/${n}?origin=aggregate&type=user-statistics-report&from=${w.value}&to=${D.value}&test=${t} - ${s}&department=&count=${c}`):ae.warning("No data found!")};function Q(t){return t.name=="select report type"?"":t.name}function ue(t){typeof t=="object"&&(b.value=t)}function de(t){L.value=t,W.value=t,k()}I(()=>b.value,(t,s)=>{t!=s&&k()}),I(()=>m.value,(t,s)=>{if(t!==s){S.value=[];const n={...g.currentRoute.value.query,"report-type":t.name,report_id:""};g.replace({query:n}).catch(i=>{console.error("Failed to replace route:",i)})}}),I(()=>u.value,(t,s)=>{if(t!==s){S.value=[];const n={...g.currentRoute.value.query,user:t.name,report_id:""};g.replace({query:n}).catch(i=>{console.error("Failed to replace route:",i)})}}),I(l,(t,s)=>{if(t!==s&&t.length>0){const c=l.value[0]?y(l.value[0]).format("YYYY-MM-DD"):"",n=l.value[1]?y(l.value[1]).format("YYYY-MM-DD"):"";if(c||n){const R={...g.currentRoute.value.query,...c&&{from:c},...n&&{to:n},report_id:""};g.replace({query:R}).catch($=>{console.error("Failed to replace route:",$)})}}},{deep:!0});const me=E(()=>_.query.to!==void 0&&_.query.from!==void 0&&_.query.user!==void 0?(l.value=[new Date(String(_.query.from)),new Date(String(_.query.to))],u.value.name=`${_.query.user}`,_.query.to!==""&&_.query.from!==""&&_.query.user!==""):!1);return Z(()=>{me.value?k():h.value=!1}),Z(async()=>{await ie()}),(t,s)=>{const c=ye,n=F("datepicker"),i=he,R=we,$=F("FormKit"),a=Pe,pe=F("excel"),_e=Ne,ve=ke,fe=qe;return P(),N("div",Ge,[d(c,{pages:e(se)},null,8,["pages"]),r("div",ze,[He,r("h3",Qe,T(e(te)),1)]),r("div",Ze,[d($,{type:"form","submit-label":"Update",onSubmit:k,actions:!1,id:"submitForm"},{default:x(({value:o})=>[r("div",Ke,[r("div",Je,[d(e(Ve),{class:"w-5 h-5 mr-2"}),j(" Filter By Date Range "),r("div",Xe,[d(n,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(l),"onUpdate:modelValue":s[0]||(s[0]=f=>V(l)?l.value=f:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),r("div",We,[d(e(Le),{class:"w-5 h-5 mr-2 my-2.5"}),j(" Report Type "),r("div",et,[d(i,{class:"bg-white",items:e(re),modelValue:e(m),"onUpdate:modelValue":s[1]||(s[1]=f=>V(m)?m.value=f:null)},null,8,["items","modelValue"])])]),r("div",tt,[r("div",at,[r("div",st,[d(i,{class:"bg-white rounded",isSearchable:!0,items:e(Y),modelValue:e(u),"onUpdate:modelValue":s[2]||(s[2]=f=>V(u)?u.value=f:null),onUpdate:de},null,8,["items","modelValue"])]),e(u).name!=null&&e(u).name!=="Select and search for user..."?(P(),N("button",{key:0,type:"button",onClick:s[3]||(s[3]=f=>u.value={name:"Select and search for user..."})},[d(e(Se),{class:"w-5 h-5 mx-2 my-2.5"})])):B("",!0)])]),r("div",rt,[d(R,{type:"submit",color:"primary",text:"Generate Report",icon:e(ee),click:()=>{},loading:e(h)},null,8,["icon","loading"])])])]),_:1}),d(pe,{class:"btn btn-default",header:[`USER STATISTICS ${e(m).name.toUpperCase()} REPORT`,`PERIOD FROM ${e(y)(e(w)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(q))} TO ${e(y)(e(D)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(q))}`,e(U).details.name,e(U).details.address,e(U).details.phone],data:e(oe),worksheet:"report-work-sheet",name:`user_statistics_report_${e(m).name.toLowerCase().split(" ").join("_")}_${e(y)(e(w)).format("DD_MM_yyyy")}_to_${e(y)(e(D)).format("DD_MM_yyyy")}.xls`},{default:x(()=>[d(a,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),r("div",ot,[r("div",nt,[lt,d(_e)]),r("div",ct,[r("h3",it,[j(" Tests Performed Period: "),r("span",ut,T(e(l).length>0&&e(l)[0].toString()!=""?e(y)(e(l)[0].toString()).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(q)):"")+" - "+T(e(l).length>0&&e(l)[1].toString()!=""?e(y)(e(l)[1].toString()).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(q)):""),1)])]),e(S).length>0?(P(),N("div",dt,[d(ve,{headers:e(le),data:e(v),serverItemsLength:e(z),serverOptions:e(b),loading:e(h),"search-field":e(ne),"search-value":e(L),onUpdate:ue},{actions:x(({item:o})=>[r("td",null,T(e(m).name.toLowerCase()=="patients registry"?`${o.first_name}
                            ${o.middle_name} ${o.last_name}`:`${o.client.first_name}
                            ${o.client.middle_name}
                            ${o.client.last_name}`),1)]),"item-tests_received":x(({item:o})=>[r("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>M("Tests Received",e(u).name,o.tests_received.count,o.tests_received.associated_ids)},T(o.tests_received.count),9,mt)]),"item-specimen_collected":x(({item:o})=>[r("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>M("Tests Received",e(u).name,o.specimen_collected.count,o.specimen_collected.associated_ids)},T(o.specimen_collected.count),9,pt)]),"item-specimen_rejected":x(({item:o})=>[r("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>M("Tests Received",e(u).name,o.specimen_rejected.count,o.specimen_rejected.associated_ids)},T(o.specimen_rejected.count),9,_t)]),"item-tests_completed":x(({item:o})=>[r("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>M("Tests Received",e(u).name,o.tests_completed.count,o.tests_completed.associated_ids)},T(o.tests_completed.count),9,vt)]),"item-tests_authorized":x(({item:o})=>[r("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>M("Tests Received",e(u).name,o.tests_authorized.count,o.tests_authorized.associated_ids)},T(o.tests_received.count),9,ft)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value"])])):B("",!0),d(fe,{condition:e(h),cancelReportGeneration:()=>e(X)()},null,8,["condition","cancelReportGeneration"]),e(S).length==0&&!e(h)?(P(),N("div",yt,Tt)):B("",!0)])])}}}),Gt=Ce(Rt,[["__scopeId","data-v-d124ae20"]]);export{Gt as default};
