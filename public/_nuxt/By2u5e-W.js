import{_ as Z}from"./COJDNupw.js";import{b as _,e as k,g as o,S as W,p as j,Y as F,G as X,V as E,q as K,a as O,u as v,E as U,x as M,y as u,f as s,z as p,k as V,L as q,K as S,_ as T,D as Y,t as R,P as w,i as D,v as P,F as A,j as B}from"./BxD-h1LR.js";import{_ as H}from"./DlrUcOnO.js";import{S as x}from"./BiIHRAGV.js";import{r as J}from"./BsvR1uat.js";import{r as Q}from"./BPzJPC5B.js";import{r as $}from"./Dyp74E1c.js";import{_ as ee}from"./CaB7BVGy.js";import{r as z}from"./By_14Whu.js";import{r as L}from"./DedCeG2P.js";import{u as te}from"./BmiBNsbw.js";import{P as oe}from"./C1C0mJ5v.js";import{r as se}from"./B2FDJykG.js";import{r as ie}from"./CBdnuxgw.js";import{r as ae}from"./DbyLJe1U.js";import{_ as re}from"./IQzdcCmk.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CmGziMTe.js";function G(i,t){return _(),k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375Z"}),o("path",{"fill-rule":"evenodd",d:"m3.087 9 .54 9.176A3 3 0 0 0 6.62 21h10.757a3 3 0 0 0 2.995-2.824L20.913 9H3.087ZM12 10.5a.75.75 0 0 1 .75.75v4.94l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72v-4.94a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const ne={components:{TransitionRoot:W,TransitionChild:j,Dialog:F,DialogPanel:X,DialogTitle:E,XMarkIcon:K,UserIcon:J},props:{data:{required:!0,type:Object}},data(){return{open:!1,checkIcon:G,saveIcon:Q,clearIcon:$,cookie:O("token"),quantityRequested:0,quantityIssued:0,quantityCollected:0,notCollectedReason:"",batchNumber:"",lotNumber:"",remarks:"",expirtyDate:"",loading:!1}},computed:{isNotCollected(){return this.quantityCollected<this.quantityIssued},quantityNotCollected(){return this.quantityIssued-this.quantityCollected}},methods:{async receiveRequisition(){this.loading=!0;const i=new x,t={stock_requisition_id:this.data.id,requisition:{quantity_received:this.quantityCollected,quantity_issued:this.quantityIssued,quantity_not_collected:this.quantityNotCollected,not_collected_reason:this.notCollectedReason},transaction:{lot:this.lotNumber,batch:this.batchNumber,expiry_date:this.expirtyDate,remarks:this.remarks}},{data:l,error:d,pending:e}=await i.receiveStockOrderRequisition(`${this.cookie}`,t);this.loading=e,l.value&&(v().$toast.success("Stock order requisition received successfully"),this.$emit("update",!0),this.loading=!1,this.handleClick()),d.value&&(console.error(d.value),this.handleClick(),v().$toast.error(U),this.loading=!1)},handleClick(){this.open=!this.open}}},le=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),de={class:"fixed inset-0 overflow-y-auto"},ce={class:"flex min-h-full items-center justify-center p-4 text-center"},ue={class:"border-b px-3 py-3 flex items-center justify-between"},me=o("img",{src:ee,class:"w-8 h-8 mr-2"},null,-1),pe={class:"px-5 py-5 space-y-3"},he={class:"relative flex flex-col space-y-2.5"},_e=o("label",{class:"font-medium"},"Date Expiry",-1),ve={class:"mt-5 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function fe(i,t,l,d,e,a){const f=T,g=u("TransitionChild"),m=u("DialogTitle"),C=u("XMarkIcon"),h=u("FormKit"),n=u("datepicker"),r=H,y=u("DialogPanel"),I=u("Dialog"),N=u("TransitionRoot");return _(),k("div",null,[o("div",null,[s(f,{text:"Receive",color:"primary",icon:e.checkIcon,click:a.handleClick},null,8,["icon","click"])]),s(N,{appear:"",show:e.open,as:"template"},{default:p(()=>[s(I,{as:"div",onClose:a.handleClick,class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[le]),_:1}),o("div",de,[o("div",ce,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",ue,[s(m,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>[me,V(" Receive Stock Requisition ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>a.handleClick&&a.handleClick(...b))},[s(C,{class:"w-5 h-5"})])]),s(h,{type:"form","submit-label":"Update",actions:!1,onSubmit:a.receiveRequisition,id:"submitForm"},{default:p(({value:b})=>[o("div",pe,[s(h,{type:"number",label:"Quantity issued",modelValue:e.quantityIssued,"onUpdate:modelValue":t[1]||(t[1]=c=>e.quantityIssued=c),validation:"required"},null,8,["modelValue"]),s(h,{type:"number",label:"Quantity collected",modelValue:e.quantityCollected,"onUpdate:modelValue":t[2]||(t[2]=c=>e.quantityCollected=c),validation:"required"},null,8,["modelValue"]),a.isNotCollected?(_(),q(h,{key:0,disabled:"",type:"number",label:"Quantity not collected",modelValue:a.quantityNotCollected,"onUpdate:modelValue":t[3]||(t[3]=c=>a.quantityNotCollected=c),validation:"required"},null,8,["modelValue"])):S("",!0),a.isNotCollected?(_(),q(h,{key:1,type:"textarea",label:"Provide a reason for quantity not collected",modelValue:e.notCollectedReason,"onUpdate:modelValue":t[4]||(t[4]=c=>e.notCollectedReason=c),validation:"required"},null,8,["modelValue"])):S("",!0),s(h,{type:"text",label:"Lot number",modelValue:e.lotNumber,"onUpdate:modelValue":t[5]||(t[5]=c=>e.lotNumber=c)},null,8,["modelValue"]),s(h,{type:"text",label:"Batch number",modelValue:e.batchNumber,"onUpdate:modelValue":t[6]||(t[6]=c=>e.batchNumber=c)},null,8,["modelValue"]),o("div",he,[_e,s(n,{required:"",teleport:!0,position:"center",range:!1,placeholder:"-- select expiry date --",minDate:new Date,"input-classes":"border font-none rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.expirtyDate,"onUpdate:modelValue":t[7]||(t[7]=c=>e.expirtyDate=c),format:"dd/MM/yyyy"},null,8,["minDate","modelValue"])]),s(h,{type:"textarea",label:"Remarks",modelValue:e.remarks,"onUpdate:modelValue":t[8]||(t[8]=c=>e.remarks=c),validation:"required"},null,8,["modelValue"])]),o("div",ve,[s(r,{text:"Clear form",click:()=>{}}),s(f,{loading:e.loading,type:"submit",color:"success",icon:e.saveIcon,click:()=>{},text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ge=M(ne,[["render",fe]]),ye={components:{TransitionRoot:W,TransitionChild:j,Dialog:F,DialogPanel:X,DialogTitle:E,XMarkIcon:K,NoSymbolIcon:z,ExclamationTriangleIcon:Y,ArchiveBoxXMarkIcon:L},data(){return{show:!1,notCollectedIcon:L,loading:!1,statusLoading:!1,reason:"",cookie:O("token")}},props:{data:{type:Object,required:!0},orderId:{type:String,required:!0}},methods:{async acceptNotCollected(){this.statusLoading=!0;const i=new x,t={route:"stock_requisition_not_collected",stock_requisition_id:this.data.id,stock_status_reason:this.reason},{data:l,error:d,pending:e}=await i.updateStockOrderStatus(`${this.cookie}`,t);this.statusLoading=e,l.value&&(this.$emit("update",!0),this.statusLoading=!1,this.reason="",this.handleClick(),v().$toast.success("Stock order requisition not collected successfully!")),d.value&&(console.error(d.value),this.statusLoading=!1)},handleClick(){this.show=!this.show}}},ke=o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),be={class:"fixed inset-0 overflow-y-auto"},xe={class:"flex min-h-full items-center justify-center p-4 text-center"},Ce={class:"border-b px-3 py-3 flex items-center justify-between"},Ve={class:"mt-2 space-y-3 px-5"},we={class:"rounded px-2 py-2"},qe={class:"font-semibold text-red-500"},Se={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Ie(i,t,l,d,e,a){const f=T,g=u("TransitionChild"),m=u("ArchiveBoxXMarkIcon"),C=u("DialogTitle"),h=u("XMarkIcon"),n=u("FormKit"),r=H,y=u("DialogPanel"),I=u("Dialog"),N=u("TransitionRoot");return _(),k("div",null,[s(f,{click:a.handleClick,color:"error",text:"Not Received",icon:e.notCollectedIcon},null,8,["click","icon"]),s(N,{appear:"",show:e.show,as:"template"},{default:p(()=>[s(I,{as:"div",class:"relative z-10"},{default:p(()=>[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[ke]),_:1}),o("div",be,[o("div",xe,[s(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",Ce,[s(C,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:p(()=>[s(m,{class:"h-5 w-5 mr-2"}),V(" Confirm Not Collected ")]),_:1}),o("button",{onClick:t[0]||(t[0]=(...b)=>a.handleClick&&a.handleClick(...b))},[s(h,{class:"w-5 h-5"})])]),s(n,{type:"form","submit-label":"Update",onSubmit:t[2]||(t[2]=b=>a.acceptNotCollected()),actions:!1},{default:p(({value:b})=>[o("div",Ve,[o("div",we,[V(" Please provide a reason why "),o("span",qe,R(l.data.item.name),1),V(" from the Order "),o("strong",null,R(l.orderId),1),V(" was not collected? Note that once this action is completed, it can not be undone ")]),s(n,{type:"textarea",label:"Reason",validation:"required",modelValue:e.reason,"onUpdate:modelValue":t[1]||(t[1]=c=>e.reason=c)},null,8,["modelValue"])]),o("div",Se,[s(r,{click:()=>{a.handleClick()},type:"button",text:"Cancel"},null,8,["click"]),s(f,{loading:e.statusLoading,type:"submit",click:()=>{},color:"error",icon:e.notCollectedIcon,text:"Reject"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ne=M(ye,[["render",Ie]]),De={setup(){te({title:`${oe.name.toUpperCase()} - Receive Stock Order`})},components:{TicketIcon:se},data(){return{header:"Receive Stock Order",checkIcon:G,saveIcon:Q,allIcon:ie,rejectIcon:z,pages:[{name:"Home",link:"/home"},{name:"Stock Orders",link:"/stock-management/orders"}],cookie:O("token"),deleteicon:ae,loading:!1,adding:!1,receiving:!1,verifying:!1,requisitions:new Array,voidReason:"",issuerName:"",issuerDesignation:"",issuerPhone:"",issuerSignature:"",approverName:"",approverDesignation:"",approverPhone:"",approverSignature:"",pharmacyWorkers:new Array}},created(){this.init()},computed:{hasApprover(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="approver")},hasIssuer(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="issuer")}},methods:{async addPharmacyWorker(i){this.adding=!0;const t=new x,l={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:a}=await t.createStockOrderPharmacy(`${this.cookie}`,l);this.adding=a,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details saved successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(U),this.adding=!1)},async updatePharmacyWorker(i){this.adding=!0;const t=new x,l={pharmacy_id:this.pharmacyWorkers.filter(f=>f.record_type==i)[0].id,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:e,pending:a}=await t.updateStockOrderPharmacy(`${this.cookie}`,l);this.adding=a,d.value&&(this.init(),v().$toast.success("Stock order pharmacy details updated successfully"),this.adding=!1),e.value&&(console.error(e.value),v().$toast.error(U),this.adding=!1)},async init(){this.loading=!0;const i=new x,{data:t,error:l,pending:d}=await i.getStockOrder(`${this.cookie}`,`${(this._.provides[w]||this.$route).query.order_id}`);this.loading=d,t.value&&(this.requisitions=t.value.stock_requisitions,t.value.stock_pharmacy_approver_and_issuers.map(e=>{e.record_type=="issuer"?(this.issuerName=e.name,this.issuerPhone=e.phone_number,this.issuerDesignation=e.designation,this.issuerSignature=e.signature):(this.approverName=e.name,this.approverPhone=e.phone_number,this.approverDesignation=e.designation,this.approverSignature=e.signature)}),this.pharmacyWorkers=t.value.stock_pharmacy_approver_and_issuers,this.loading=!1),l.value&&(console.error(l.value),this.loading=!1)},deleteStockItem(i){i>=0&&i<this.requisitions.length&&this.requisitions.splice(i,1)},isReceivedOrNotCollected(i){for(let t=0;t<i.length;t++)if(i[t].requisition_status.toLowerCase()==="received"||i[t].requisition_status.toLowerCase()==="not collected")return!0;return!1},async receiveOrder(){if(this.isReceivedOrNotCollected(this.requisitions))if(this.hasApprover&&this.hasIssuer){this.receiving=!0;const i=new x,t={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`},{data:l,error:d,pending:e}=await i.receiveStockOrder(`${this.cookie}`,t);this.receiving=e,l.value&&(v().$toast.success("Stock order received successfully!"),this.$router.push("/stock-management/orders"),this.receiving=!1),d.value&&(console.error(d.value),this.receiving=!1)}else v().$toast.warn("Order should be issued and approved by pharmacy!");else v().$toast.warn("Please enter the amount recieved or mark as not collected!")}}},Pe={class:"px-5 py-5"},Ue={class:"py-5 flex items-center justify-between"},Re={class:"text-2xl font-semibold"},Oe={class:"py-2"},Me=o("div",{class:"flex items-center space-x-3"},[o("img",{src:re,class:"w-8 h-8"}),o("h3",{class:"text-xl font-semibold"},"Pharmacy")],-1),Te={class:"border rounded mt-3"},Ae=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Issuer ",-1),Be={class:"px-5 py-5"},Le={class:"grid grid-cols-4 gap-5"},We={class:"border rounded mt-3"},je=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Approver ",-1),Fe={class:"px-5 py-5"},Xe={class:"grid grid-cols-4 gap-5"},Ee={class:"rounded border"},Ke=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Stock Items ",-1),He={class:"grid grid-cols-4 gap-4 mt-5"},Qe={class:"flex flex-col space-y-2"},ze={class:"mt-8 flex space-x-2.5 items-center"},Ge=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10 mt"},null,-1),Ze=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Ye=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),Je=o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),$e=[Ge,Ze,Ye,Je];function et(i,t,l,d,e,a){const f=Z,g=T,m=u("FormKit"),C=ge,h=Ne;return _(),k("div",Pe,[s(f,{pages:e.pages},null,8,["pages"]),o("div",Ue,[o("h3",Re,R(e.header),1),s(g,{text:"Receive Order",color:"success",icon:e.checkIcon,click:()=>a.receiveOrder()},null,8,["icon","click"])]),o("div",null,[D(o("div",Oe,[Me,o("div",Te,[Ae,o("div",Be,[s(m,{type:"form","submit-label":"Update",onSubmit:t[4]||(t[4]=n=>a.hasIssuer?a.updatePharmacyWorker("issuer"):a.addPharmacyWorker("issuer")),actions:!1},{default:p(({value:n})=>[o("div",Le,[s(m,{type:"text",label:"Name",modelValue:e.issuerName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.issuerName=r),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.issuerDesignation,"onUpdate:modelValue":t[1]||(t[1]=r=>e.issuerDesignation=r),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.issuerPhone,"onUpdate:modelValue":t[2]||(t[2]=r=>e.issuerPhone=r)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.issuerSignature,"onUpdate:modelValue":t[3]||(t[3]=r=>e.issuerSignature=r),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:a.hasIssuer?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:a.hasIssuer?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])]),o("div",We,[je,o("div",Fe,[s(m,{type:"form","submit-label":"Update",onSubmit:t[9]||(t[9]=n=>a.hasApprover?a.updatePharmacyWorker("approver"):a.addPharmacyWorker("approver")),actions:!1},{default:p(({value:n})=>[o("div",Xe,[s(m,{type:"text",label:"Name",modelValue:e.approverName,"onUpdate:modelValue":t[5]||(t[5]=r=>e.approverName=r),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:e.approverDesignation,"onUpdate:modelValue":t[6]||(t[6]=r=>e.approverDesignation=r),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:e.approverPhone,"onUpdate:modelValue":t[7]||(t[7]=r=>e.approverPhone=r)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:e.approverSignature,"onUpdate:modelValue":t[8]||(t[8]=r=>e.approverSignature=r),validation:"required"},null,8,["modelValue"])]),s(g,{type:"submit",class:"mt-3",text:a.hasApprover?"Update changes":"Save changes",icon:e.saveIcon,loading:e.adding,click:()=>{},color:a.hasApprover?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])])],512),[[P,!e.loading]]),D(o("div",Ee,[Ke,(_(!0),k(A,null,B(e.requisitions,(n,r)=>(_(),k("div",{class:"flex flex-col space-y-3 px-5 py-5",key:r},[o("div",He,[o("div",Qe,[s(m,{label:"Stock item",disabled:!0,modelValue:n.item.name,"onUpdate:modelValue":y=>n.item.name=y},null,8,["modelValue","onUpdate:modelValue"])]),s(m,{label:"Quantity requested",type:"number",validation:"required",modelValue:n.quantity_requested,"onUpdate:modelValue":y=>n.quantity_requested=y,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),o("div",ze,[n.requisition_status.toLowerCase()!=="received"?(_(),q(C,{key:0,data:n,onUpdate:a.init},null,8,["data","onUpdate"])):S("",!0),n.requisition_status.toLowerCase()!=="received"?(_(),q(h,{key:1,onUpdate:a.init,data:n,orderId:`${(i._.provides[w]||i.$route).params.voucherId}`},null,8,["onUpdate","data","orderId"])):S("",!0)])])]))),128))],512),[[P,!e.loading]]),D(o("div",null,[(_(),k(A,null,B(5,n=>o("div",{class:"flex items-center space-x-3 mb-3",key:n},$e)),64))],512),[[P,e.loading]])])])}const kt=M(De,[["render",et]]);export{kt as default};
