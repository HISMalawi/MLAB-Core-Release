import{S,p as I,Y as q,G as D,V as A,q as L,a as R,l as f,m as _,u as y,aG as v,s as V,x as a,b as k,e as N,f as o,y as l,g as c,j as O,H as z,C as j,_ as B}from"./BXyMujmX.js";import{r as F}from"./DoDvC37F.js";import{r as x}from"./Ac8CVCKi.js";const U={components:{TransitionRoot:S,TransitionChild:I,Dialog:q,DialogPanel:D,DialogTitle:A,XMarkIcon:L,ExclamationTriangleIcon:F,PrinterIcon:x},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1},encounter_id:{type:Number,required:!1},orderTests:{type:Array,required:!1}},data(){return{show:!1,printIcon:x,cookie:R("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const i={route:f.printers,method:"GET",token:`${this.cookie}`},{data:e,error:r}=await _(i);e.value&&(this.printers=new Array,e.value.map(d=>{this.printers.push(d.name)})),r.value&&console.error(r.value)},isCrossMatchTest(){var i;return this.orderTests?(i=this.orderTests)==null?void 0:i.some(e=>e.test_type_name.toLowerCase()=="cross-match"):!1},async toPrintSmallLabel(){this.zebraPrinting=!0;const i={route:f.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests,is_cross_match:this.isCrossMatchTest()}},{data:e,error:r,pending:d}=await _(i);if(this.zebraPrinting=d,e.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const n=URL.createObjectURL(e.value),s=document.createElement("a");s.href=n,s.setAttribute("download",`${Date.now()}.lbl`),s.click(),URL.revokeObjectURL(n)},t.readAsText(e.value)}r.value&&(this.zebraPrinting=!1,console.error(r.value))},containsWords(i,...e){for(let r=0;r<e.length;r++)if(i.cssText.includes(e[r]))return!0;return!1},async submitForm(i){var p,m;let e=new FormData;this.loading=!0;let r=new Array;r.push(Number(this.orderId));let d=this.id,t=this.encounter_id;e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(r)),e.append("client_id",d),t&&e.append("encounter_id",t.toString());const n={route:f.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:s,error:u,pending:h}=await _(n);this.loading=h,s.value&&(s.value.printed?y().$toast.success("Patient report printed successfully!"):y().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((p=(this._.provides[v]||this.$route).query.printer)==null?void 0:p.toString())=="true"&&this.$router.push("/tests"),this.handleClick()),u.value&&(this.loading=!1,console.error(u.value),y().$toast.error("An error occurred while printing patient report"),this.handleClick(),((m=(this._.provides[v]||this.$route).query.printer)==null?void 0:m.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show,this.show==!1&&this.$router.back()}}},M={class:"fixed inset-0 overflow-y-auto"},E={class:"flex top-0 items-center justify-center p-4 text-center"},G={class:"border-b px-3 py-3 flex items-center justify-between"},$={class:"py-5 px-5"},X={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function K(i,e,r,d,t,n){const s=B,u=a("TransitionChild"),h=a("PrinterIcon"),p=a("DialogTitle"),m=a("XMarkIcon"),g=a("FormKit"),w=a("DialogPanel"),P=a("Dialog"),T=a("TransitionRoot");return k(),N("div",null,[o(s,{click:n.init,color:"primary",text:"Print",icon:t.printIcon},null,8,["click","icon"]),o(T,{appear:"",show:t.show,as:"template"},{default:l(()=>[o(P,{as:"div",class:"relative z-10"},{default:l(()=>[o(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>e[2]||(e[2]=[c("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),c("div",M,[c("div",E,[o(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[o(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[c("div",G,[o(p,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>[o(h,{class:"h-5 w-5 mr-2"}),e[3]||(e[3]=O(" Print "))]),_:1}),c("button",{onClick:e[0]||(e[0]=(...b)=>n.handleClick&&n.handleClick(...b))},[o(m,{class:"w-5 h-5"})])]),o(g,{type:"form","submit-label":"Update",onSubmit:n.submitForm,actions:!1},{default:l(({value:b})=>[c("div",$,[o(g,{validation:"required",label:"Select a printer",type:"radio",modelValue:t.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=C=>t.selectedPrinter=C),options:t.printers},null,8,["modelValue","options"])]),c("div",X,[r.printSmallLabel?(k(),z(s,{key:0,type:"button",loading:t.zebraPrinting,click:()=>{n.toPrintSmallLabel()},icon:t.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):j("",!0),o(s,{click:()=>{},loading:t.loading,type:"submit",icon:t.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const W=V(U,[["render",K]]);export{W as _};
