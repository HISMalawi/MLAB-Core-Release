import{_ as ae}from"./CGGtvusN.js";import{S as le,p as ne,Y as re,G as ie,V as ce,q as de,a as L,u as me,E as ue,s as pe,x as _,b as f,e as b,f as a,y,g as t,j as U,t as S,F as P,k as W,H as q,C as E,_ as K,d as fe,r as p,c as _e,w as ve,aF as ye,o as be,h as o,A as T,i as z,v as G,n as ke,l as xe,m as H}from"./D6i_IOc_.js";import{S as O}from"./v49nXNIB.js";import{r as ge}from"./DlFmXbdc.js";import{r as he}from"./DZMBDnl3.js";import{r as we}from"./-mp5v0R0.js";import{_ as Se}from"./BM3s60a1.js";import{_ as Ve}from"./D2qt2bNp.js";import{_ as Ce}from"./C72LZpGV.js";import{_ as Ie}from"./PHlxz6BT.js";import{P as $e}from"./BZSIQZRS.js";import{u as Re}from"./DWAwhHUi.js";import{r as De}from"./CfESIv2Q.js";import{r as Fe}from"./CfwkTFBk.js";import{r as Me}from"./nQf0Gylo.js";import"./By9LU-fN.js";import"./DWXm4k5R.js";import"./DvwXNZux.js";import"./BwU-8tyK.js";import"./CcV7c9GQ.js";import"./DgPl_XGR.js";import"./B-kA0EYn.js";import"./CuTMbTZk.js";import"./DnZ6mysu.js";const Ee={components:{TransitionRoot:le,TransitionChild:ne,Dialog:re,DialogPanel:ie,DialogTitle:ce,XMarkIcon:de},data(){return{transferIcon:ge,saveIcon:he,show:!1,loading:!1,editIcon:we,cookie:L("token")}},props:{data:{type:Object,required:!0}},computed:{filteredRequisitions(){return this.data.requisitions.map((i,l)=>{i.stock_item.name=="-- select item --"&&this.data.requisitions.splice(l,1)}),this.data.requisitions.map(i=>({stock_item_name:i.stock_item.name,stock_item_id:i.stock_item.id,quantity:i.quantity_requested,lot:i.lot_number,batch:i.batch_number,expiry_date:i.expiry_date}))}},methods:{async submitForm(){this.loading=!0;const i=new O,l={receiving_from:this.data.receiving_from,stock_status_reason:this.data.reason,stock_items:this.filteredRequisitions},{data:k,error:x,pending:n}=await i.receiveExternalStock(`${this.cookie}`,l);this.loading=n,k.value&&(this.loading=!1,me().$toast.success("Stock received successfully"),this.handleClick(),this.$router.push("/stock-management/transactions")),x.value&&(this.loading=!1,console.error(x.value),this.$toast.error(ue),this.handleClick())},handleClick(){this.show=!this.show}}},Te={class:"fixed inset-0 overflow-y-auto"},Ue={class:"flex min-h-full items-center justify-center p-4 text-center"},qe={class:"border-b px-3 py-3 flex items-center justify-between"},je={class:"py-5 px-5"},Be={class:"w-full flex items-center space-x-2"},Ae={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},Ne={class:"w-full flex items-center space-x-2 mt-2"},ze={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},Ge={class:"w-full"},He={class:"px-2 py-2 border-r"},Le={class:"px-2 py-2 border-r"},Pe={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function We(i,l,k,x,n,m){const c=K,g=_("TransitionChild"),h=_("DialogTitle"),V=_("XMarkIcon"),C=_("FormKit"),I=_("DialogPanel"),$=_("Dialog"),v=_("TransitionRoot");return f(),b("div",null,[a(c,{click:m.handleClick,color:"success",text:"Receive",icon:n.transferIcon},null,8,["click","icon"]),a(v,{appear:"",show:n.show,as:"template"},{default:y(()=>[a($,{as:"div",class:"relative z-10"},{default:y(()=>[a(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:y(()=>l[1]||(l[1]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Te,[t("div",Ue,[a(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:y(()=>[a(I,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:y(()=>[t("div",qe,[a(h,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:y(()=>l[2]||(l[2]=[t("img",{src:Se,class:"w-8 h-8 mr-2",alt:"ambulance-svg"},null,-1),U(" Checkout Stock Transfer ")])),_:1}),t("button",{onClick:l[0]||(l[0]=(...R)=>m.handleClick&&m.handleClick(...R))},[a(V,{class:"w-5 h-5"})])]),a(C,{type:"form","submit-label":"Update",onSubmit:m.submitForm,actions:!1,id:"submitForm"},{default:y(({value:R})=>[t("div",je,[t("div",Be,[l[3]||(l[3]=t("p",{class:"w-72 font-medium"},"From: ",-1)),t("span",Ae,S(k.data.receiving_from),1)]),t("div",Ne,[l[4]||(l[4]=t("p",{class:"w-72 font-medium"},"Reason for transfer: ",-1)),t("span",ze,S(k.data.reason),1)]),l[6]||(l[6]=t("div",{class:"bg-gray-50 px-2 py-2 border rounded-t mt-4"},[t("h3",{class:"font-semibold"},"Stock In Items")],-1)),t("table",Ge,[l[5]||(l[5]=t("thead",{clas:"w-full border-l border-r"},[t("tr",{class:"border-b border-r border-l rounded"},[t("th",{class:"px-2 py-2 text-left border-r"}," Item "),t("th",{class:"px-2 py-2 text-left"}," Quantity ")])],-1)),t("tbody",null,[(f(!0),b(P,null,W(m.filteredRequisitions,(w,D)=>(f(),b("tr",{key:D,class:"border-b border-t border-r border-l rounded"},[t("td",He,S(w.stock_item_name),1),t("td",Le,S(w.quantity),1)]))),128))])])]),t("div",Pe,[m.filteredRequisitions.length>0?(f(),q(c,{key:0,loading:n.loading,type:"submit",click:()=>{},color:"success",icon:n.transferIcon,text:"Continue"},null,8,["loading","icon"])):E("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ke=pe(Ee,[["render",We]]),Oe={class:"px-5 py-5"},Xe={class:"flex items-center justify-between py-5"},Qe={class:"w-full mt-2 grid grid-cols-5 gap-2"},Ye={class:"col-span-1 order-2 rounded border"},Je={class:"flex flex-col space-y-2 px-5 py-5"},Ze={class:"w-full flex flex-col space-y-2"},et={key:0,class:"w-full flex flex-col space-y-2"},tt={class:"font-medium"},ot={class:"col-span-4 order-1 rounded border"},st={class:"px-5 py-5"},at={class:"grid grid-cols-6 gap-5 mb-5"},lt={class:"items-center space-y-2"},nt={class:"mt-8 flex items-center space-x-2"},rt={class:"flex flex-col items-center justify-center space-y-2"},Mt=fe({__name:"receive-stock",setup(i){Re({title:`${$e.name.toUpperCase()} - Receive Stock`});const l=Fe,k=Me,x=p([]),n=p({name:"-- select sender --"}),m=p(""),c=p([]),g=p([]),h=L("token"),V=new O,C=p([]),I=p([]),$=p([]),v=p({name:"-- select item --"}),R=p([{name:"Home",link:"/home"},{name:"Stock Management",link:"#"},{name:"Transactions",link:"/stock-management/transactions"}]),w=p({id:0,value:!1}),D=_e(()=>{const s={Supplier:C.value,Facility:I.value,Ward:$.value},e={Supplier:{name:"-- select supplier --"},Facility:{name:"-- select facility --"},Ward:{name:"-- select ward --"}};return v.value=e[n.value.name]||{name:"-- select item --"},s[n.value.name]||[]}),X=async()=>{const{data:s,error:e}=await V.getStockItem(h.value);s.value&&(g.value=s.value),e.value&&console.error(e.value)},Q=async()=>{const s={route:xe.facility,method:"GET",token:h.value},{data:e,error:d}=await H(s);e.value&&(I.value=e.value.data),d.value&&console.error(d.value)},Y=async()=>{const{data:s,error:e}=await V.getStockSupplier(h.value);s.value&&(C.value=s.value),e.value&&console.error(e.value)},J=async()=>{const s={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:h.value},{data:e,error:d}=await H(s);e.value&&($.value=e.value),d.value&&console.error(d.value)},j=()=>{c.value.push({id:0,stock_item:{name:"-- select item --",id:0},quantity_requested:0,batch_number:"",lot_number:"",expiry_date:""})},Z=s=>{s>=0&&s<c.value.length&&c.value.splice(s,1)},ee=()=>{["Supplier","Ward","Facility"].forEach(e=>x.value.push({name:e}))};return ve(()=>n.value,s=>{const d={Supplier:Y,Facility:Q,Ward:J}[s.name];d&&d()},{deep:!0}),ye(()=>{const s=Object.fromEntries(g.value.map(e=>[e.name,e.id]));c.value.forEach((e,d)=>{const F=s[e.stock_item.name]||0;F!==e.stock_item.id&&(c.value[d]={...e,stock_item:{...e.stock_item,id:F}})})}),be(()=>{ee(),X()}),(s,e)=>{const d=ae,F=Ke,B=Ve,M=_("FormKit"),A=K,te=Ce,oe=_("datepicker"),se=ke;return f(),b("div",Oe,[a(d,{pages:o(R)},null,8,["pages"]),t("div",Xe,[e[3]||(e[3]=t("h3",{class:"text-2xl font-semibold capitalize"},"Receive External Stock",-1)),a(F,{data:{reason:o(m),receiving_from:`${o(v).name.includes("select")?"":o(v).name} ${o(n).name.includes("select")?"":o(n).name}`,requisitions:o(c)}},null,8,["data"])]),t("div",null,[t("div",Qe,[t("div",Ye,[e[6]||(e[6]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Details")],-1)),t("div",Je,[t("div",Ze,[e[4]||(e[4]=t("label",{class:"font-medium"},"Receive From",-1)),a(B,{items:o(x),modelValue:o(n),"onUpdate:modelValue":e[0]||(e[0]=r=>T(n)?n.value=r:null)},null,8,["items","modelValue"])]),o(n)&&o(D).length>0?(f(),b("div",et,[t("label",tt,[U("Select "+S(o(n).name.toLowerCase()),1),e[5]||(e[5]=t("span",{class:"text-red-600 font-medium"},"*",-1))]),a(B,{"is-searchable":!0,items:o(D),modelValue:o(v),"onUpdate:modelValue":e[1]||(e[1]=r=>T(v)?v.value=r:null)},null,8,["items","modelValue"])])):E("",!0),a(M,{label:"Reason for receiving",type:"textarea",modelValue:o(m),"onUpdate:modelValue":e[2]||(e[2]=r=>T(m)?m.value=r:null),validation:"required"},null,8,["modelValue"])])]),t("div",ot,[e[11]||(e[11]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Stock Items")],-1)),t("div",st,[z(a(A,{color:"primary",click:j,text:"Add items",icon:o(l)},null,8,["icon"]),[[G,o(c).length>0]]),(f(!0),b(P,null,W(o(c),(r,N)=>(f(),b("div",{class:"flex flex-col space-y-3 mt-5",key:N},[t("div",at,[a(te,{label:"Stock item",mode:"single",items:o(g).map(u=>u.name),"items-selected":r.stock_item.name,"onUpdate:itemsSelected":u=>r.stock_item.name=u},null,8,["items","items-selected","onUpdate:itemsSelected"]),a(M,{label:"Quantity requested",type:"number",validation:"required",modelValue:r.quantity_requested,"onUpdate:modelValue":u=>r.quantity_requested=u,modelModifiers:{lazy:!0},delay:1e3},null,8,["modelValue","onUpdate:modelValue"]),a(M,{label:"Batch",type:"text",validation:"required",modelValue:r.batch_number,"onUpdate:modelValue":u=>r.batch_number=u,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),a(M,{label:"Lot",type:"text",validation:"required",modelValue:r.lot_number,"onUpdate:modelValue":u=>r.lot_number=u,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),t("div",lt,[e[7]||(e[7]=t("label",{class:"font-medium"},"Expiry Date",-1)),a(oe,{required:"",position:"left",placeholder:"select start & end date",range:!1,"input-class-name":"datepicker",format:"dd/MM/yyyy",modelValue:r.expiry_date,"onUpdate:modelValue":u=>r.expiry_date=u},null,8,["modelValue","onUpdate:modelValue"])]),t("div",nt,[o(w).id==r.id&&o(w).value?(f(),q(se,{key:0,class:"w-5 h-5"})):E("",!0),o(w).value?E("",!0):(f(),q(A,{key:1,icon:o(k),text:"Delete",color:"error",click:()=>{Z(N)}},null,8,["icon","click"]))])])]))),128)),z(t("div",rt,[e[9]||(e[9]=t("img",{src:Ie,class:"w-28 h-28 text-red-500",alt:"stock-out-icon"},null,-1)),e[10]||(e[10]=t("p",{class:"flex items-center"},"No stock items entered for receive",-1)),t("button",{onClick:j,type:"button",class:"flex items-center text-sky-500 font-medium"},[a(o(De),{class:"w-5 h-5 mr-2"}),e[8]||(e[8]=U(" Add stock item "))])],512),[[G,o(c).length==0]])])])])])])}}});export{Mt as default};
