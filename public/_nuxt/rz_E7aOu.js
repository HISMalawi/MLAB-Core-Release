import{_ as me}from"./CUGREwii.js";import{_ as he}from"./D-ktHv4g.js";import{d as V,C as w,x as F,b as n,e as l,g as e,F as S,j as k,t as r,h as s,O,K as $,k as C,a6 as Z,r as u,a as fe,c as Y,w as J,y as X,f as m,H as N,z as be,L as U,l as M,m as I,u as q,_ as ye,n as ve,aC as xe}from"./JEpZiKDn.js";import{_ as $e}from"./jcukMvCQ.js";import{_ as Ee,a as Te}from"./BuvA2s-D.js";import{u as ge}from"./Bl4Rx-lb.js";import{_ as Re}from"./DRxg2Ufn.js";import{_ as Ae}from"./DNbyhRT_.js";import{u as De}from"./DPv16rA3.js";import{P as Se}from"./DObdreHM.js";import{r as ke}from"./BByxu38V.js";import{r as Ne}from"./DpXPT2CW.js";import"./DGM4Jn_4.js";import"./Cd90EHgg.js";import"./BcRhypLO.js";import"./D9psU6J9.js";import"./BO5pWTJR.js";import"./DHOH29o0.js";import"./BhA5OI8I.js";import"./IQ2PmlzZ.js";import"./BcteEfoI.js";const we=V({props:{data:{required:!0,type:Object}},data(){return{moment:w,headers:[{name:"SN"},{name:"Patient ID"},{name:"Patient Name"},{name:"Accession Number"},{name:"Specimen"},{name:"Receipt Date"},{name:"Tests"},{name:"Performed By"},{name:"Results"},{name:"Remarks"},{name:"Results Entry Date"},{name:"Authorized By"}],reportData:this.data}}}),Ce={class:"w-full overflow-x-auto"},Pe={class:"w-full text-left overflow-y-auto"},Me={class:"uppercase bg-gray-100"},Ie={class:"border-b"},Oe={class:"px-2 py-2 font-normal border-r"},Ve={class:"px-2 py-2 font-normal border-r"},Le={class:"px-2 py-2 font-normal border-r"},je={class:"px-2 py-2 font-normal border-r"},Be={class:"px-2 py-2 font-normal border-r"},Ye={class:"px-2 py-2 font-normal border-r"},Ue={class:"px-2 py-2 font-normal border-r"},qe={class:"px-2 py-2 font-normal border-r"},Fe={class:"px-2 py-2 font-normal border-r"},Ge={key:0,class:"font-medium"},ze={class:"px-2 py-2 font-normal border-r"},He={class:"px-2 py-2 font-normal border-r"},Ke={class:"px-2 py-2 font-normal"};function Je(a,E,A,f,T,b){return n(),l("div",Ce,[e("table",Pe,[e("thead",Me,[e("tr",Ie,[(n(!0),l(S,null,k(a.headers,(o,i)=>(n(),l("th",{class:"uppercase py-2 px-2 border-r",key:i},r(o.name),1))),128))])]),e("tbody",null,[(n(!0),l(S,null,k(a.data.data,(o,i)=>(n(),l("tr",{class:"bg-white border-b",key:i},[e("th",Oe,r(i+1),1),e("th",Ve,r(o.patient_id),1),e("th",Le,r(o.patient_name),1),e("th",je,r(o.accession_number),1),e("th",Be,r(o.specimen),1),e("th",Ye,r(a.moment(o.receipt_date).format("DATE_FORMAT"in a?a.DATE_FORMAT:s(O))),1),e("th",Ue,r(o.test),1),e("th",qe,r(o.performed_by),1),e("th",Fe,[(n(!0),l(S,null,k(o.results,(h,g)=>(n(),l("p",{key:g},[h!=null&&h!==""?(n(),l("span",Ge,r(`${g}:`),1)):$("",!0),C(" "+r(h),1)]))),128))]),e("th",ze,r(o.remarks),1),e("th",He,r(a.moment(o.result_date).format("DATE_FORMAT"in a?a.DATE_FORMAT:s(O))),1),e("th",Ke,r(o.authorized_by),1)]))),128))])])])}const Xe=F(we,[["render",Je]]),Ze=V({props:{data:{required:!0,type:Object}},data(){var a;return{details:(a=this.data)==null?void 0:a.data}},methods:{removeDuplicates(a){return a.filter((A,f)=>a.findIndex(T=>T.patient_no===A.patient_no)===f)}}}),Qe={class:"w-full text-left"},We=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"},"SN"),e("th",{class:"uppercase py-2 px-2 border-r"},"PATIENT NO"),e("th",{class:"uppercase py-2 px-2 border-r"},"PATIENT NAME"),e("th",{class:"uppercase py-2 px-2 border-r"},"AGE"),e("th",{class:"uppercase py-2 px-2 border-r"},"SEX"),e("th",{class:"uppercase py-2 px-2 border-r"},"ACCESSION NUMBER"),e("th",{class:"uppercase py-2 px-2 border-r"},"SPECIMEN TYPE"),e("th",{class:"uppercase py-2 px-2 border-r"},"TESTS")])],-1),et={class:"px-2 py-2 font-normal border-r border-b"},tt={class:"px-2 py-2 font-normal border-r border-b"},st={class:"px-2 py-2 font-normal border-r border-b"},ot={class:"px-2 py-2 font-normal border-r border-b"},rt={class:"px-2 py-2 font-normal border-r border-b"},at={class:"px-2 py-2 font-normal border-r border-b"},nt={class:"px-2 py-2 font-normal border-r border-b"},lt={class:"px-2 py-2 font-normal border-r border-b space-y-1"},ct=e("div",{class:"px-3 py-3 uppercase"},"SUMMARY",-1),dt={class:"w-full text-left"},pt=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"},"TOTAL VISITS"),e("th",{class:"uppercase py-2 px-2 border-r"},"MALE"),e("th",{class:"uppercase py-2 px-2 border-r"},"FEMALE")])],-1),it={class:"px-2 py-2 font-normal border-r border-b"},ut={class:"px-2 py-2 font-normal border-r border-b"},_t={class:"px-2 py-2 font-normal border-r border-b"};function mt(a,E,A,f,T,b){return n(),l("div",null,[e("div",null,[e("table",Qe,[We,e("tbody",null,[(n(!0),l(S,null,k(a.details,(o,i)=>(n(),l("tr",{key:i},[e("th",et,r(i+1),1),e("th",tt,r(o.patient_no),1),e("th",st,r(o.patient_name),1),e("th",ot,r(("calculateAge"in a?a.calculateAge:s(Z))(o.dob)),1),e("th",rt,r(o.gender),1),e("th",at,r(o.accession_number),1),e("th",nt,r(o.specimen),1),e("th",lt,[(n(!0),l(S,null,k(o.test_type,(h,g)=>(n(),l("p",{key:g},r(h),1))),128))])]))),128))])])]),ct,e("table",dt,[pt,e("tbody",null,[e("tr",null,[e("th",it,r(a.data.visits.length),1),e("th",ut,r(a.removeDuplicates(a.details).filter(o=>o.gender=="M").length),1),e("th",_t,r(a.removeDuplicates(a.details).filter(o=>o.gender=="F").length),1)])])])])}const ht=F(Ze,[["render",mt]]),ft=V({props:{data:{required:!0,type:Object}},data(){var a;return{details:(a=this.data)==null?void 0:a.data}}}),bt={class:"w-full text-left"},yt=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"}," SN "),e("th",{class:"uppercase py-2 px-2 border-r"}," ACCESSION NUMBER "),e("th",{class:"uppercase py-2 px-2 border-r"}," SPECIMEN "),e("th",{class:"uppercase py-2 px-2 border-r"}," RECEIPT DATE "),e("th",{class:"uppercase py-2 px-2 border-r"}," TESTS "),e("th",{class:"uppercase py-2 px-2 border-r"}," LAB selection "),e("th",{class:"uppercase py-2 px-2 border-r"}," REJECTION REASON "),e("th",{class:"uppercase py-2 px-2 border-r"}," PERSON TALKED TO "),e("th",{class:"uppercase py-2 px-2 border-r"}," DATE REJECTED ")])],-1),vt={class:"px-2 py-2 font-normal border-r border-b"},xt={class:"px-2 py-2 font-normal border-r border-b"},$t={class:"px-2 py-2 font-normal border-r border-b"},Et={class:"px-2 py-2 font-normal border-r border-b"},Tt={class:"px-2 py-2 font-normal border-r border-b"},gt={class:"px-2 py-2 font-normal border-r border-b"},Rt={class:"px-2 py-2 font-normal border-r border-b"},At={class:"px-2 py-2 font-normal border-r border-b"},Dt={class:"px-2 py-2 font-normal border-r border-b"};function St(a,E,A,f,T,b){return n(),l("div",null,[e("table",bt,[yt,e("tbody",null,[(n(!0),l(S,null,k(a.details,(o,i)=>(n(),l("tr",{key:i},[e("th",vt,r(i+1),1),e("th",xt,r(o.accession_number),1),e("th",$t,r(o.specimen),1),e("th",Et,r(o.receipt_date),1),e("th",Tt,r(o.test),1),e("th",gt,r(o.department),1),e("th",Rt,r(o.rejection_reason),1),e("th",At,r(o.person_talked_to),1),e("th",Dt,r(o.test_status_date),1)]))),128))])])])}const kt=F(ft,[["render",St]]),Nt={class:"px-5 py-5"},wt=e("div",{class:"flex items-center py-5"},[e("img",{src:Re,alt:"report-icon",class:"w-8 h-8 mr-2"}),e("h3",{class:"text-2xl font-semibold uppercase"},"Daily Log Report")],-1),Ct={class:"flex items-center"},Pt={class:"bg-white flex space-x-5 py-5 flex-wrap"},Mt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},It={class:"w-72 ml-2"},Ot={class:"flex flex-col"},Vt={class:"flex flex-col"},Lt={class:"flex flex-col"},jt={class:"flex flex-col"},Bt={class:"border rounded"},Yt={class:"flex items-center justify-between px-5 py-5 border-b"},Ut=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:Ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"},"DAILY LOG REPORT")],-1),qt={class:"px-5 py-3"},Ft={key:0,class:"text-lg font-semibold"},Gt={class:"text-md font-normal"},zt={class:"text-lg font-semibold"},Ht={class:"text-md font-normal"},Kt={key:0,class:"w-full border-t"},Jt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Xt=e("img",{src:Te,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Zt=e("p",null,"Data not found, please generate report",-1),Qt=[Xt,Zt],Wt={key:2,class:"mx-auto justify-center flex flex-col items-center space-y-3 py-10"},es=e("p",{class:"text-base"},[C(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1),Es=V({__name:"daily-log",setup(a){ge({title:`${Se.name} - Daily Log Reports`});const E=De(),A=u([{name:"Home",link:"/home"},{name:"Reports",link:"#"}]),f=fe("token"),T=u([]),b=u({name:"select department"}),o=u([]),i=new xe,h=u({name:"select test type"}),g=u([]),R=u({name:"select test status"}),v=u(["",""]),_=u({}),G=u(0),Q=u([{name:"Test record",value:"test_record"},{name:"Patient record",value:"patient_record"}]),p=u({name:"select report type",value:"select report type"}),x=u(!1),L=Y(()=>v.value[0]?w(v.value[0]).format("YYYY-MM-DD"):""),j=Y(()=>v.value[1]?w(v.value[1]).format("YYYY-MM-DD"):""),W=()=>{v.value=["",""]};async function ee(){const c={route:M.departments,method:"GET",token:`${f.value}`},{data:t,error:d}=await I(c);t.value&&(T.value=t.value),d.value&&console.error(d.value)}async function z(){const c={route:`${M.testTypes}/by_department?department_id=${b.value.id}`,method:"GET",token:`${f.value}`},{data:t,error:d}=await I(c);t.value&&(o.value=t.value),d.value&&console.error(d.value)}function B(c){let t="";return c=="select department"||c==="select test type"||c==="select test status"?t="":t=c,t}async function te(){const c={route:`${M.testStatus}/all`,method:"GET",token:`${f.value}`},{data:t,error:d}=await I(c);t.value&&(g.value=t.value),d.value&&console.error(d.value)}const se=c=>Object.entries(c).map(([t,d])=>`${t}: ${d}`).join(", "),oe=Y(()=>{let c=new Array;return p.value.value=="test_record"&&_.value.data&&_.value.data.map(t=>{c.push({"PATIENT ID":t.patient_id,"PATIENT NAME":t.patient_name,"ACCESSION NUMBER":t.accession_number,SPECIMEN:t.specimen,"RECEIPT DATE":w(t.receipt_date).format(O),TEST:t.test,"PERFORMED BY":t.performed_by,RESULTS:se(t.results),REMARKS:t.remarks,"RESULTS ENTRY DATE":w(t.result_date).format(O),"AUTHORIZED BY":t.authorized_by})}),p.value.value=="patient_record"&&_.value.data&&_.value.data.map(t=>{c.push({"PATIENT ID":t.patient_no,"PATIENT NAME":t.patient_name,AGE:Z(t.dob),SEX:t.gender,"ACCESSION NUMBER":t.accession_number,"SPECIMEN TYPE":t.specimen,TESTS:t.test_type.join(", ")})}),c}),re=()=>{i.cancel(q)};async function ae(){var c;if(x.value=!0,p.value.value!="select report type"){let t=`from=${L.value}&to=${j.value}&department=${B(b.value.name)}&report_type=${p.value.value}&test_status=${B(R.value.name)}&test_type=${B(h.value.name)}`;const{data:d,error:P,pending:D}=await I({route:`${M.dailyReports}/daily_log?${t}`,method:"GET",token:`${f.value}`},i);x.value=D,d.value&&(x.value=!1,((c=d.value)==null?void 0:c.data.length)==0&&q().$toast.warning("No data found for specified parameters"),_.value=d.value,p.value.value=="test_record"&&(G.value=d.value.completed_tests)),P.value&&(x.value=!1,console.error(P.value))}else q().$toast.warning("Please select the report type before generating the report"),x.value=!1}return J(()=>b.value,()=>{z()}),J(()=>p.value,()=>{_.value=[]}),ee(),z(),te(),(c,t)=>{var H,K;const d=me,P=X("datepicker"),D=he,ne=ye,le=$e,ce=X("excel"),de=Ee,pe=Xe,ie=ht,ue=kt,_e=ve;return n(),l("div",Nt,[m(d,{pages:s(A)},null,8,["pages"]),wt,e("div",Ct,[e("div",Pt,[e("div",Mt,[m(s(ke),{class:"w-5 h-5 mr-2"}),C(" Filter By Date Range "),e("div",It,[m(P,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy",onCleared:W,"input-class-name":"datepicker",modelValue:s(v),"onUpdate:modelValue":t[0]||(t[0]=y=>N(v)?v.value=y:null)},null,8,["modelValue"])])]),e("div",Ot,[m(D,{items:s(T),modelValue:s(b),"onUpdate:modelValue":t[1]||(t[1]=y=>N(b)?b.value=y:null)},null,8,["items","modelValue"])]),e("div",Vt,[m(D,{items:s(o),modelValue:s(h),"onUpdate:modelValue":t[2]||(t[2]=y=>N(h)?h.value=y:null)},null,8,["items","modelValue"])]),e("div",Lt,[m(D,{items:s(g),modelValue:s(R),"onUpdate:modelValue":t[3]||(t[3]=y=>N(R)?R.value=y:null)},null,8,["items","modelValue"])]),e("div",jt,[m(D,{items:s(Q),modelValue:s(p),"onUpdate:modelValue":t[4]||(t[4]=y=>N(p)?p.value=y:null)},null,8,["items","modelValue"])]),m(ne,{color:"primary",text:"Generate Report",icon:s(Ne),loading:s(x),click:()=>ae()},null,8,["icon","loading","click"]),m(ce,{class:"btn btn-default",header:[`DAILY LOG ${s(p).name.toUpperCase()} REPORT`,`PERIOD: ${s(L)} - ${s(j)}`,s(E).details.name,s(E).details.address,s(E).details.phone],data:s(oe),worksheet:"report-work-sheet",name:`daily_log_${s(p).value}_report.xls`},{default:be(()=>[m(le,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",Bt,[e("div",Yt,[Ut,m(de)]),e("div",qt,[s(p).value=="test_record"&&s(R).name!=="test-rejected"?(n(),l("h3",Ft,[C(" Test Record: "),e("span",Gt,r(s(G).toLocaleString())+" completed tests",1)])):$("",!0),e("h3",zt,[C(" Tests Performed Period: "),e("span",Ht,r(s(L))+" - "+r(s(j)),1)])]),((K=(H=s(_))==null?void 0:H.data)==null?void 0:K.length)>0?(n(),l("div",Kt,[s(p).value=="test_record"&&s(R).name!=="test-rejected"?(n(),U(pe,{key:0,data:s(_)},null,8,["data"])):$("",!0),s(p).value=="patient_record"?(n(),U(ie,{key:1,data:s(_)},null,8,["data"])):$("",!0),s(R).name=="test-rejected"?(n(),U(ue,{key:2,data:s(_)},null,8,["data"])):$("",!0)])):$("",!0),s(_).length==0&&!s(x)?(n(),l("div",Jt,Qt)):$("",!0),s(x)&&s(_).length==0?(n(),l("div",Wt,[m(_e),es,e("button",{class:"font-medium text-base text-sky-500",onClick:re},"Cancel")])):$("",!0)])])}}});export{Es as default};
