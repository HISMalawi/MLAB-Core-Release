import{_ as M}from"./Breadcrumb.vue.af519b7d.js";import{u as V,a as Y,_ as U,g as T,o as d,c as p,d as f,e,i as b,t as o,w as N,V as E,q as O,k as w,l as y,F as g,r as x,v as F,f as G}from"./entry.64b6b942.js";import{_ as H}from"./index.e387e18f.js";import{_ as Q}from"./Address.vue.0136ab68.js";import{_ as Z}from"./Loader.52c40d31.js";import{a as I,d as R}from"./constants.31b85c3a.js";import{h as A,e as C,f as P,d as q}from"./fetch.8fd817fe.js";import{u as J}from"./facility.a7378ed6.js";import{P as K}from"./package.70b788f3.js";import{r as W}from"./UserIcon.5f6aced0.js";import{r as X}from"./QrCodeIcon.d30a71bf.js";import{r as $}from"./FunnelIcon.73d98fcb.js";import{r as ee}from"./PrinterIcon.5a175993.js";import{r as te}from"./ArrowPathIcon.b9b688c3.js";import{_ as se}from"./logo.9f0778b3.js";import"./nuxt-link.f9df4f37.js";import"./HomeIcon.4d524c11.js";import"./jspdf.es.min.168aff09.js";import"./XMarkIcon.64f3f5c2.js";import"./transition.5b1867a1.js";import"./hidden.a9fd55b4.js";import"./PencilSquareIcon.f5030dad.js";const re={name:"PatientReport",components:{UserIcon:W,QrCodeIcon:X,FunnelIcon:$},setup(){V({title:`${K.name} - Patient Report`})},data(){return{dateRange:[],pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:ee,refreshIcon:te,cookie:Y("token"),moment:A,facility:J(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){this.loading=!0;const t=this.$route.query.order_id;let r=I[0].toString()!=""?A(I[0].toString()).format("YYYY-MM-DD"):"",i=I[1].toString()!=""?A(I[1].toString()).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const l={route:`${C.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await P(l);if(this.loading=v,s.value){this.loading=!1,this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let S=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=S}n.value&&(this.loading=!1,console.error(n.value))}else{const l={route:`${C.tests}/${this.patientId}/report?from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await P(l);if(this.loading=v,s.value){this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let S=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=S,this.loading=!1}n.value&&(console.error(n.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],i=t.find(l=>r.includes(l.status.name));return i?`${i.initiator.first_name} ${i.initiator.last_name}`:""},getOrderStatus(t){return t!==null?this.capitalizeStr(t.split("-")[1]):""},getTestStatusInitiatorName(t,r){const i=t.find(l=>r===l.status.name);return i?{name:`${i.initiator.first_name} ${i.initiator.last_name}`,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(i=>i.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,i)=>r+i.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0?`Growth of ${r.map(i=>i.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.tests.some(i=>i.print_device))},getSmallLabelPrintTests(t){const r=[];return t.forEach(i=>{i.tests.forEach(l=>{l.print_device&&r.push(l.id)})}),r},getPrintCount(t){return t.reduce((r,i)=>r+i.print_count,0)},getRequiredRange(t,r){const i=t.sex=="M"?"Male":"Female",l=Number(q(t.date_of_birth));return r.filter(s=>s.sex===i&&l>Number(s.min_age)&&l<Number(s.max_age)||s.sex==="Both"&&l>Number(s.min_age)&&l<Number(s.max_age))[0]},shouldDisplayRange(t,r,i){let l=null;return this.showIndicatorRanges(t)&&(l=this.getRequiredRange(r,i.indicator_ranges)),l}}},oe=""+new URL("medical-record.2202ac05.png",import.meta.url).href,ne={class:"py-5 px-5"},ae={class:"flex items-center py-5"},ie=e("img",{src:oe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),le={class:"text-2xl font-semibold uppercase"},de={class:"text-sky-500 text-2xl"},ce={class:"mt-2 space-y-3"},pe={class:"w-full flex items-center justify-between"},_e={class:"flex items-center space-x-5"},ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},me={class:"w-72 ml-2"},he={class:"flex items-center space-x-2"},fe=e("label",null,"Include pending tests",-1),be={key:0,class:"border rounded print-container mt-10"},ye={class:"rounded-tr rounded-tl border-b px-5 py-5"},ge={class:"flex items-center justify-between"},xe=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:se,alt:"app-logo",class:"w-24 h-24 object-cover"})],-1),ve={class:"flex items-center justify-between mt-5"},Se=e("span",{class:"font-medium"},"Report Date:",-1),ke=e("span",{class:"font-medium"},"No. Printed:",-1),we=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Re={class:"w-full mt-2"},De=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Ie={class:"border px-2 py-2"},Te=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Ne={class:"border px-2 py-2"},Ae=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Fe={class:"border px-2 py-2"},Ce=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),Pe={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),Le={class:"border px-2 py-2",colspan:"2"},Be={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},je={class:"flex items-center"},ze={class:"border-collapse border-slate-500 w-full"},Me=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Specimen Type",-1),Ve={class:"border-b border-r px-2 py-2"},Ye=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Date Registered",-1),Ue={class:"border-b px-2 py-2"},Ee=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Test Type(s)",-1),Oe={class:"border-b border-r px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Lab Sections",-1),He={class:"border-b px-2 py-2"},Qe=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Specimen Status",-1),Ze={class:"border-b border-r px-2 py-2"},Je=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Received By",-1),Ke={class:"border-b px-2 py-2"},We={class:"border-collapse w-full"},Xe={class:"bg-gray-100 text-gray-600"},$e=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),et={colspan:3,class:"px-2 py-2 text-lg font-semibold"},tt=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),st={class:"border px-2 py-2"},rt={class:"border"},ot={class:"w-full h-full"},nt=e("tr",null,[e("td",{class:"border px-2 py-2 font-bold"},"Measure"),e("td",{class:"border px-2 py-2 font-bold"},"Result"),e("td",{class:"border px-2 py-2 font-bold"},"Range")],-1),at={class:"border px-2 py-2"},it={class:"border-b px-2 py-2 flex items-center"},lt=["innerHTML"],dt={key:0,class:"text-xs pt-1 pl-1"},ct={key:0,class:"border px-2 py-2 font-bold"},pt={key:1,class:"border px-2 py-2"},_t={class:"border px-2 py-2"},ut={class:"border px-2 py-2"},mt={class:"test-status"},ht=e("p",{class:"font-bold"},"Test Status",-1),ft={class:"px-2"},bt={class:"px-2"},yt={class:"px-2"},gt={key:0,class:"performed-by"},xt=e("p",{class:"font-bold"},"Performed By",-1),vt={class:"px-2"},St={class:"px-2"},kt={class:"m-2"},wt=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"},"Suscpeptibility Test Results",-1),Rt={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},Dt={class:"w-full"},It=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),Tt={classs:"border-l border-r"},Nt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},At={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Ft={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Ct={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Pt=e("p",{class:"text-base"},[b("Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function qt(t,r,i,l,s,n){const v=M,S=T("FunnelIcon"),u=T("datepicker"),m=G,k=H,L=Q,B=T("QrCodeIcon"),j=Z;return d(),p("div",ne,[f(v,{pages:s.pages},null,8,["pages"]),e("div",ae,[ie,e("h3",le,[b("patient report for "),e("span",de,'"'+o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`)+'"',1)])]),e("div",ce,[e("div",pe,[e("div",_e,[e("div",ue,[f(S,{class:"w-5 h-5 mr-2"}),b(" Filter By Date Range "),e("div",me,[f(u,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=c=>s.dateRange=c)},null,8,["modelValue"])])]),e("div",he,[N(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=c=>s.showPendingTests=c)},null,512),[[E,s.showPendingTests]]),fe]),f(m,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])]),e("div",null,[n.getAuthorizedTestCount(s.reportData)>0?(d(),O(k,{key:0,"print-small-label":n.shouldPrintSmallLabel(s.reportData),id:n.patientId,orderId:n.orderId,tests:n.getSmallLabelPrintTests(s.reportData),onUpdate:n.updateReport},null,8,["print-small-label","id","orderId","tests","onUpdate"])):w("",!0)])]),s.reportData.length>0?(d(),p("div",be,[e("div",ye,[e("div",ge,[xe,f(L)]),e("div",ve,[e("div",null,[Se,b(" "+o(s.moment(new Date).format("dateFormat"in t?t.dateFormat:y(R))),1)]),e("div",null,[ke,b(" "+o(n.getPrintCount(s.reportData)),1)]),e("div",null,[we,b(" "+o(s.reportData.length>0&&s.moment(s.reportData[0].sample_collected_time).format("dateFormat"in t?t.dateFormat:y(R))),1)])]),e("table",Re,[e("tbody",null,[e("tr",null,[De,e("td",Ie,o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`),1),Te,e("td",Ne,o(s.person.sex==="F"?"Female":"Male"),1),Ae,e("td",Fe,o(("calculateAge"in t?t.calculateAge:y(q))(s.person.date_of_birth))+" yr(s)",1)]),e("tr",null,[Ce,e("td",Pe,o(s.person.id),1),qe,e("td",Le,o(n.getPhysicalAddress),1)])])])]),(d(!0),p(g,null,x(s.reportData,(c,z)=>(d(),p("div",{key:z},[e("div",Be,[e("div",je,[f(B,{class:"w-5 h-5 mr-2"}),b(" Accession No: "+o(c.accession_number),1)]),e("div",null,"Requested By: "+o(c.requested_by)+" ("+o(c.requesting_ward)+")",1)]),e("table",ze,[e("tbody",null,[e("tr",null,[Me,e("td",Ve,o(c.specimen),1),Ye,e("td",Ue,o(s.moment(c.created_date).format("dateFormat"in t?t.dateFormat:y(R))),1)]),e("tr",null,[Ee,e("td",Oe,o(n.getTestTypes(c.test_types)),1),Ge,e("td",He,o(n.getDepartments(c.test_types)),1)]),e("tr",null,[Qe,e("td",Ze,o(n.getOrderStatus(c.order_status)),1),Je,e("td",Ke,o(n.getOrderStatusInitiatorName(c.order_status_trail)),1)])])]),e("table",We,[e("thead",null,[e("tr",Xe,[$e,e("th",et,"Tests Authorized("+o(c.tests_verified)+") ",1)])]),e("tbody",null,[tt,(d(!0),p(g,null,x(s.showPendingTests?c.tests:c.tests.filter(a=>a.status.toLowerCase()!=="pending"),a=>(d(),p("tr",{key:a.id},[e("td",st,o(a.test_type_name),1),e("td",rt,[e("table",ot,[nt,(d(!0),p(g,null,x(a.indicators,_=>{var D,h;return d(),p("tr",null,[e("td",at,o(_.name),1),e("td",it,[e("p",{innerHTML:n.showResult(((D=_.result)==null?void 0:D.value)??"",a==null?void 0:a.suscept_test_result)},null,8,lt),(h=_.result)!=null&&h.value?(d(),p("span",dt,o((a==null?void 0:a.suscept_test_result.length)>0?"":_==null?void 0:_.unit),1)):w("",!0)]),n.shouldDisplayRange(a.indicators,s.person,_)!==void 0&&n.shouldDisplayRange(a.indicators,s.person,_)!==null?(d(),p("td",ct," ("+o(n.shouldDisplayRange(a.indicators,s.person,_).lower_range)+" - "+o(n.shouldDisplayRange(a.indicators,s.person,_).upper_range)+") ",1)):(d(),p("td",pt," N/A "))])}),256))])]),e("td",_t,o((a==null?void 0:a.remarks)??"N/A"),1),e("td",ut,[e("div",mt,[ht,e("p",ft,o(n.getTestStatusName(a.status)),1),e("p",bt,"By: "+o(n.getTestStatusInitiatorName(a.status_trail,a.status).name),1),e("p",yt,"On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,a.status).created_at).format("dateFormat"in t?t.dateFormat:y(R))),1)]),n.getTestStatusInitiatorName(a.status_trail,"completed").name?(d(),p("div",gt,[xt,e("p",vt,o(n.getTestStatusInitiatorName(a.status_trail,"completed").name),1),e("p",St,"On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:y(R))),1)])):w("",!0)])]))),128))])]),N(e("div",kt,[wt,e("div",null,[(d(!0),p(g,null,x(c.tests,a=>(d(),p("div",{class:"grid grid-cols-2 gap-4",key:a.id},[a.test_type_name.toLowerCase().includes("culture")?(d(!0),p(g,{key:0},x(a.suscept_test_result,(_,D)=>(d(),p("div",{key:D},[e("div",Rt,o(_.name),1),e("table",Dt,[It,e("tbody",Tt,[(d(!0),p(g,null,x(n.getFilteredDrugs(_.drugs),h=>(d(),p("tr",{key:h.drug_id},[e("th",Nt,o(h.name),1),e("th",At,o(h.zone),1),e("th",Ft,o(h.interpretation),1)]))),128))])])]))),128)):w("",!0)]))),128))])],512),[[F,n.checkSusceptibilityResults(c)]])]))),128))])):w("",!0),e("div",null,[N(e("div",Ct,[f(j),Pt],512),[[F,s.loading]])])])])}const rs=U(re,[["render",qt]]);export{rs as default};
