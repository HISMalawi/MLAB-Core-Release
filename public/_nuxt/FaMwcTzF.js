import{_ as re}from"./CdrT672K.js";import{b as R,e as P,g as e,d as ce,u as F,r as m,a as L,w as W,x as p,f as o,h as n,y as l,Y as Z,p as N,G as X,V as H,j as B,q as z,A as I,H as de,D as ue,S as K,z as ee,L as te,E as oe,_ as G,s as Y,t as C}from"./BbkUq3pP.js";import{_ as me}from"./hcyw4BxI.js";import{_ as pe}from"./CGQhUj9Z.js";import{S as $}from"./DrAKmsfg.js";import{r as fe}from"./DC48ZIun.js";import{_ as ve}from"./BFpTpfkK.js";import{r as _e}from"./C7SUZWvt.js";import{r as xe}from"./aOGwGJoO.js";import{_ as ge}from"./PHlxz6BT.js";import{_ as he}from"./Chqi5ygk.js";import{r as ye}from"./DxY9coLf.js";import{r as ke}from"./CxMCxToh.js";import{_ as be}from"./NdHSzRU-.js";import{P as we}from"./Cno8v37U.js";import{u as Se}from"./BZTj5M85.js";import"./CfIHGZVq.js";import"./GKXdb3Iz.js";import"./DDyamxLR.js";import"./CF9TYKcD.js";import"./CLuuOqS6.js";import"./pkSlw8mP.js";import"./BC5bLOnc.js";import"./E3GA-zZE.js";import"./BIuVjvou.js";function je(f,t){return R(),P("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M6 12a.75.75 0 0 1-.75-.75v-7.5a.75.75 0 1 1 1.5 0v7.5A.75.75 0 0 1 6 12ZM18 12a.75.75 0 0 1-.75-.75v-7.5a.75.75 0 0 1 1.5 0v7.5A.75.75 0 0 1 18 12ZM6.75 20.25v-1.5a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0ZM18.75 18.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 1.5 0ZM12.75 5.25v-1.5a.75.75 0 0 0-1.5 0v1.5a.75.75 0 0 0 1.5 0ZM12 21a.75.75 0 0 1-.75-.75v-7.5a.75.75 0 0 1 1.5 0v7.5A.75.75 0 0 1 12 21ZM3.75 15a2.25 2.25 0 1 0 4.5 0 2.25 2.25 0 0 0-4.5 0ZM12 11.25a2.25 2.25 0 1 1 0-4.5 2.25 2.25 0 0 1 0 4.5ZM15.75 15a2.25 2.25 0 1 0 4.5 0 2.25 2.25 0 0 0-4.5 0Z"})])}const Ce=f=>({"Misplace stock":"pos","Incorrect entry":"pos","Negative reasons":"neg",Damaged:"neg","Phased out":"neg",Banned:"neg",Missing:"neg","Transfer to another facility":"neg","For trainings":"neg"})[f]||"neg",Me={class:"fixed inset-0 overflow-y-auto"},De={class:"flex min-h-full items-center justify-center p-4 text-center"},Ae={class:"border-b px-3 py-3 flex items-center justify-between"},Ie={class:"py-5 px-5 space-y-3"},Ve={class:"flex flex-col space-y-1.5"},Te={class:"mt-2"},$e={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Re=ce({__name:"index",emits:["update"],setup(f,{emit:t}){const d=t,{$toast:g}=F(),s=m(!1),i=fe,h=je,y=m([]),k=m(!1),v=m({name:"select reason"}),w=m({id:0,name:"select stock item"}),b=m([]),_=L("token"),j=m(0),M=m(0),S=m(0),D=m(),V=m(""),q=m(""),U=m(""),E=m(""),Q=m([]),J=m([]),O=()=>{s.value=!s.value},ae=async()=>{const u=new $,{data:a,error:r}=await u.getStockAdjustmentReasons(`${_.value}`);a.value&&(y.value=a.value),r.value&&(console.error(r.value),g.error("Error fetching stock adjustment reasons"))},se=async()=>{O(),await ae();const u=new $,{data:a,error:r}=await u.getStockItem(`${_.value}`);a.value&&(b.value=a.value.map(x=>({...x,created_date:ee(x.created_date).format(te)}))),r.value&&(console.error(r.value),g.error("Error fetching stock items"))},ne=async u=>{const a=new $,{data:r,error:x}=await a.readStockItem(`${_.value}`,{id:u});r.value&&(M.value=0,S.value=0,j.value=r.value.stock.quantity,D.value=r.value.stock,Q.value=r.value.batches,J.value=r.value.lots),x.value&&console.error(x.value)},le=async()=>{var T;k.value=!0;const u=new $,a={stock_id:(T=D==null?void 0:D.value)==null?void 0:T.id,lot:V.value,batch:q.value,quantity_to_adjusted:S.value,reason:U.value===""?v.value.name:U.value,notes:E.value},{data:r,error:x,pending:A}=await u.adjustStock(`${_.value}`,a);k.value=A,r.value&&(M.value=0,S.value=0,k.value=!1,b.value=[],y.value=[],v.value={name:"select reason"},w.value={name:"select stock item"},d("update"),O(),g.success("Stock adjustment successfully done!")),x.value&&(console.error(x.value),k.value=!1,g.error(oe))};W(w,u=>{var a;if(u.name!=="select stock item"){const r=((a=b.value.find(x=>x.name===u.name))==null?void 0:a.id)||0;ne(r)}},{deep:!0});const ie=(u,a)=>Ce(a)==="pos"?Math.abs(u):-Math.abs(u);return W(S,u=>{const a=j.value+Number(u);M.value=a,S.value=ie(u,v.value.name)},{deep:!0}),(u,a)=>{const r=G,x=me,A=p("FormKit"),T=pe;return R(),P("div",null,[e("div",null,[o(r,{text:"Create Stock Adjustment",color:"primary",icon:n(i),click:se},null,8,["icon"])]),o(n(K),{appear:"",show:n(s),as:"template"},{default:l(()=>[o(n(Z),{as:"div",onClose:O,class:"relative z-10"},{default:l(()=>[o(n(N),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>a[9]||(a[9]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Me,[e("div",De,[o(n(N),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[o(n(X),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[e("div",Ae,[o(n(H),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:l(()=>a[10]||(a[10]=[B(" Create Stock Adjustment ")])),_:1}),e("button",{onClick:O},[o(n(z),{class:"w-5 h-5"})])]),o(A,{type:"form","submit-label":"Update",onSubmit:le,actions:!1,id:"submitForm"},{default:l(()=>[e("div",Ie,[e("div",Ve,[a[11]||(a[11]=e("label",{class:"font-medium"},"Reason",-1)),o(x,{items:n(y),modelValue:n(v),"onUpdate:modelValue":a[0]||(a[0]=c=>I(v)?v.value=c:null)},null,8,["items","modelValue"]),e("div",Te,[n(v).name.toLowerCase()=="other"?(R(),de(A,{key:0,type:"textarea",label:"Please write your reason for (Other)",validation:"required",modelValue:n(U),"onUpdate:modelValue":a[1]||(a[1]=c=>I(U)?U.value=c:null)},null,8,["modelValue"])):ue("",!0)])]),o(T,{label:"Stock item",mode:"single",items:n(b).map(c=>c.name),"items-selected":n(w).name,"onUpdate:itemsSelected":a[2]||(a[2]=c=>n(w).name=c)},null,8,["items","items-selected"]),o(A,{type:"number",label:"In Stock",disabled:"",modelValue:n(j),"onUpdate:modelValue":a[3]||(a[3]=c=>I(j)?j.value=c:null)},null,8,["modelValue"]),o(A,{type:"number",label:"Adjustment",validation:"required",modelValue:n(S),"onUpdate:modelValue":a[4]||(a[4]=c=>I(S)?S.value=c:null)},null,8,["modelValue"]),o(A,{type:"number",label:"Stock After",disabled:"",modelValue:n(M),"onUpdate:modelValue":a[5]||(a[5]=c=>I(M)?M.value=c:null)},null,8,["modelValue"]),o(T,{label:"Batch",mode:"single",items:n(Q),"items-selected":n(q),"onUpdate:itemsSelected":a[6]||(a[6]=c=>I(q)?q.value=c:null)},null,8,["items","items-selected"]),o(T,{label:"Lot",mode:"single",items:n(J),"items-selected":n(V),"onUpdate:itemsSelected":a[7]||(a[7]=c=>I(V)?V.value=c:null)},null,8,["items","items-selected"]),o(A,{type:"textarea",label:"Notes",validation:"required",modelValue:n(E),"onUpdate:modelValue":a[8]||(a[8]=c=>I(E)?E.value=c:null)},null,8,["modelValue"])]),e("div",$e,[o(r,{loading:n(k),type:"submit",click:()=>{},color:"success",icon:n(h),text:"Adjust"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),Ue={components:{TransitionRoot:K,TransitionChild:N,Dialog:Z,DialogPanel:X,DialogTitle:H,XMarkIcon:z},data(){return{viewIcon:_e,show:!1,editIcon:xe}},props:{data:{type:Object,required:!0}},methods:{handleClick(){this.show=!this.show}}},Be={class:"fixed inset-0 overflow-y-auto"},Pe={class:"flex min-h-full items-center justify-center p-4 text-center"},qe={class:"border-b px-3 py-3 flex items-center justify-between"},Ee={class:"space-y-3 px-5 py-5"},Oe={class:"w-full flex flex-col space-y-1"},Ne={class:"w-full flex flex-col space-y-1"},Fe={class:"w-full flex flex-col space-y-1"},Le={class:"w-full flex flex-col space-y-1"},Ze={class:"w-full flex flex-col space-y-1"},Xe={class:"w-full flex flex-col space-y-1"},He={class:"w-full flex flex-col space-y-1"},ze={class:"w-full flex flex-col space-y-1"};function Ke(f,t,d,g,s,i){const h=G,y=p("TransitionChild"),k=p("DialogTitle"),v=p("XMarkIcon"),w=p("DialogPanel"),b=p("Dialog"),_=p("TransitionRoot");return R(),P("div",null,[o(h,{click:()=>{i.handleClick()},color:"primary",text:"View",icon:s.viewIcon},null,8,["click","icon"]),o(_,{appear:"",show:s.show,as:"template"},{default:l(()=>[o(b,{as:"div",class:"relative z-10"},{default:l(()=>[o(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>t[1]||(t[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Be,[e("div",Pe,[o(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[o(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[e("div",qe,[o(k,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>t[2]||(t[2]=[e("img",{src:ge,class:"w-8 h-8 mr-2"},null,-1),B(" View Stock Adjustment ")])),_:1}),e("button",{onClick:t[0]||(t[0]=(...j)=>i.handleClick&&i.handleClick(...j))},[o(v,{class:"w-5 h-5"})])]),e("div",Ee,[e("div",Oe,[t[3]||(t[3]=e("label",{class:"font-semibold text-lg"},"Name",-1)),e("p",null,C(d.data.name),1)]),e("div",Ne,[t[4]||(t[4]=e("label",{class:"font-semibold text-lg"},"Description",-1)),e("p",null,C(d.data.description),1)]),e("div",Fe,[t[5]||(t[5]=e("label",{class:"font-semibold text-lg"},"Lot",-1)),e("p",null,C(d.data.lot),1)]),e("div",Le,[t[6]||(t[6]=e("label",{class:"font-semibold text-lg"},"Batch",-1)),e("p",null,C(d.data.batch),1)]),e("div",Ze,[t[7]||(t[7]=e("label",{class:"font-semibold text-lg"},"Quantity Adjusted",-1)),e("p",null,C(d.data.transacted_quantity),1)]),e("div",Xe,[t[8]||(t[8]=e("label",{class:"font-semibold text-lg"},"Reason",-1)),e("p",null,C(d.data.reason),1)]),e("div",He,[t[9]||(t[9]=e("label",{class:"font-semibold text-lg"},"Remarks",-1)),e("p",null,C(d.data.remarks),1)]),e("div",ze,[t[10]||(t[10]=e("label",{class:"font-semibold text-lg"},"Transaction Date",-1)),e("p",null,C(d.data.transaction_date),1)])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Ge=Y(Ue,[["render",Ke]]),Ye={components:{TransitionRoot:K,TransitionChild:N,Dialog:Z,DialogPanel:X,DialogTitle:H,XMarkIcon:z,ExclamationTriangleIcon:ye},data(){return{show:!1,reverseIcon:ke,loading:!1,reason:"",cookie:L("token")}},props:{data:{type:Object,required:!0}},methods:{async voidStockSupplier(f){this.loading=!0;const t=new $,d={stock_transaction_id:this.data.id,reason:this.reason,id:f},{data:g,error:s,pending:i}=await t.reverseStockAdjustment(`${this.cookie}`,d);this.loading=i,g.value&&(this.handleClick(),F().$toast.success("Stock adjustment reversed successfully!"),this.loading=!1,this.reason="",this.$emit("update",!0)),s.value&&(console.error(s.value),F().$toast.error(oe),this.loading=!1)},handleClick(){this.show=!this.show}}},Qe={class:"fixed inset-0 overflow-y-auto"},Je={class:"flex min-h-full items-center justify-center p-4 text-center"},We={class:"border-b px-3 py-3 flex items-center justify-between"},et={class:"mt-2 space-y-3 px-5"},tt={class:"rounded px-2 py-2"},ot={class:"font-semibold text-red-500"},at={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function st(f,t,d,g,s,i){const h=G,y=p("TransitionChild"),k=p("ExclamationTriangleIcon"),v=p("DialogTitle"),w=p("XMarkIcon"),b=p("FormKit"),_=he,j=p("DialogPanel"),M=p("Dialog"),S=p("TransitionRoot");return R(),P("div",null,[o(h,{click:i.handleClick,color:"error",text:"Reverse",icon:s.reverseIcon},null,8,["click","icon"]),o(S,{appear:"",show:s.show,as:"template"},{default:l(()=>[o(M,{as:"div",class:"relative z-10"},{default:l(()=>[o(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>t[3]||(t[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Qe,[e("div",Je,[o(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[o(j,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[e("div",We,[o(v,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>[o(k,{class:"h-5 w-5 mr-2"}),t[4]||(t[4]=B(" Confirm reverse "))]),_:1}),e("button",{onClick:t[0]||(t[0]=(...D)=>i.handleClick&&i.handleClick(...D))},[o(w,{class:"w-5 h-5"})])]),o(b,{type:"form","submit-label":"Update",onSubmit:t[2]||(t[2]=D=>i.voidStockSupplier(d.data.id)),actions:!1},{default:l(({value:D})=>[e("div",et,[e("div",tt,[t[5]||(t[5]=B(" Do you really want to reverse adjustment of ")),e("span",ot,C(d.data.name),1),t[6]||(t[6]=B("? Note that once this action is completed, it can not be undone "))]),o(b,{type:"textarea",label:"Reason",validation:"required",modelValue:s.reason,"onUpdate:modelValue":t[1]||(t[1]=V=>s.reason=V)},null,8,["modelValue"])]),e("div",at,[o(_,{click:()=>{i.handleClick()},type:"button",text:"Cancel"},null,8,["click"]),o(h,{loading:s.loading,type:"submit",click:()=>{},color:"error",icon:s.reverseIcon,text:"Reverse"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const nt=Y(Ye,[["render",st]]),lt={setup(){Se({title:`${we.name.toUpperCase()} - Stock Adjustments`})},data(){return{pages:[{name:"Home",link:"/home"},{name:"Stock Management",link:"#"}],header:"Stock Adjustments",search:"",loading:!1,headers:[{text:"item",value:"name",sortable:!0},{text:"lot",value:"lot"},{text:"batch",value:"batch"},{text:"adjustment",value:"transacted_quantity"},{text:"reason",value:"reason"},{text:"date created",value:"transaction_date"},{text:"actions",value:"actions"}],cookie:L("token"),adjustments:new Array,serverItemsLength:0,serverOptions:{page:1,rowsPerPage:25,sortBy:"name"}}},computed:{filteredAdjustments(){return this.adjustments.map(f=>({...f,transaction_date:ee(f.transaction_date).format(te)}))}},created(){this.init()},methods:{async init(){this.loading=!0;const f=new $,{page:t,rowsPerPage:d}=this.serverOptions,g=`search=${this.search}&page=${t}&per_page=${d}&transaction_type=adjust stock`,{data:s,pending:i,error:h}=await f.getStockTransactions(`${this.cookie}`,g);this.loading=i,s.value&&(this.adjustments=s.value.data,this.loading=!1,this.serverItemsLength=s.value.meta.total_count),h.value&&(console.error(h.value),this.loading=!1)}},watch:{search(f){this.init()}}},it={class:"px-5 py-5"},rt={class:"flex items-center justify-between py-5"},ct={class:"flex items-center space-x-3"},dt={class:"flex items-center justify-end py-5"},ut={class:"py-2 flex items-center space-x-2"};function mt(f,t,d,g,s,i){const h=re,y=Re,k=ve,v=Ge,w=nt,b=be;return R(),P("div",it,[o(h,{pages:s.pages},null,8,["pages"]),e("div",rt,[t[1]||(t[1]=e("h3",{class:"text-2xl font-semibold"},"Stock Adjustments",-1)),e("div",ct,[o(y,{onUpdate:i.init},null,8,["onUpdate"])])]),e("div",dt,[o(k,{search:s.search,"onUpdate:search":t[0]||(t[0]=_=>s.search=_)},null,8,["search"])]),e("div",null,[o(b,{loading:s.loading,headers:s.headers,data:i.filteredAdjustments,"search-value":s.search,"search-field":"name",serverItemsLength:s.serverItemsLength,serverOptions:s.serverOptions,onUpdate:i.init},{actions:l(({item:_})=>[e("div",ut,[o(v,{data:_},null,8,["data"]),o(w,{data:_,onUpdate:i.init},null,8,["data","onUpdate"])])]),_:1},8,["loading","headers","data","search-value","serverItemsLength","serverOptions","onUpdate"])])])}const qt=Y(lt,[["render",mt]]);export{qt as default};
