import{_ as ie}from"./Breadcrumb.vue.7a457d8b.js";import{_ as ce}from"./Dropdown.e58140fb.js";import{o as E,c as T,e as r,m as me,u as ue,C as n,a as de,L as v,H as j,g as M,d as l,l as e,t as z,h as k,i as V,E as U,k as N,b as A,f as pe,A as _e,B as ve,_ as fe}from"./entry.18364f1c.js";import{_ as ge}from"./ExportButton.vue.24739b4a.js";import{_ as ye}from"./Datatable.9ecef914.js";import{_ as he}from"./Loader.888095c3.js";import{h as f,d as xe,e as G,f as H}from"./fetch.5f03fbcc.js";import{d as q,e as Ee}from"./constants.86829aaf.js";import{_ as Te}from"./report.b706b044.js";import{_ as Re}from"./page.da78683c.js";import{P as Se}from"./package.b965e1b0.js";import{u as we}from"./facility.f011c060.js";import{r as $e}from"./FunnelIcon.238c88c3.js";import{r as Pe}from"./XMarkIcon.13f92378.js";import{r as Ne}from"./ArrowPathIcon.cb4e24ae.js";import"./nuxt-link.eb4fc10e.js";import"./HomeIcon.8d531f3f.js";import"./listbox.e7ac43d3.js";import"./hidden.d8a7e9c3.js";import"./use-text-value.d8341020.js";import"./CheckIcon.9b9f88b3.js";import"./CheckCircleIcon.b928c17b.js";import"./MagnifyingGlassIcon.570b6e64.js";import"./transition.bca0aae9.js";import"./PencilSquareIcon.5a78d442.js";import"./PrinterIcon.46fc5b73.js";function Ae(R,o){return E(),T("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",d:"M3 6.75A.75.75 0 013.75 6h16.5a.75.75 0 010 1.5H3.75A.75.75 0 013 6.75zM3 12a.75.75 0 01.75-.75H12a.75.75 0 010 1.5H3.75A.75.75 0 013 12zm0 5.25a.75.75 0 01.75-.75h16.5a.75.75 0 010 1.5H3.75a.75.75 0 01-.75-.75z","clip-rule":"evenodd"})])}const b=R=>(_e("data-v-16eaabb0"),R=R(),ve(),R),be={class:"px-5 py-5"},De={class:"flex items-center py-5"},Ce=b(()=>r("img",{src:Te,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),Ie={class:"text-2xl font-semibold uppercase"},Me={class:"w-full flex items-center justify-between mb-5"},ke={class:"w-full flex items-center space-x-3"},Ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ve={class:"w-72 ml-2"},Be={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Le={class:"w-48 ml-2"},Ye={class:"flex justify-end py-2"},Fe={class:"bg-gray-100 rounded flex items-center text-zinc-500"},Oe={class:"w-48"},je={class:"w-48"},ze={key:0,id:"print-container"},Ge={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},He=b(()=>r("img",{src:Re,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1)),qe=b(()=>r("p",null,"Data not found, please generate report",-1)),Ke=[He,qe],Je={key:2,class:"mx-auto justify-center flex flex-col items-center space-y-3"},Xe=b(()=>r("p",{class:"text-base"},[V("Generating report, please wait"),r("span",{class:"animate-ping"},"...")],-1)),Ze=me({__name:"user-statistics",setup(R){ue({title:`${Se.name.toUpperCase()} - User Statistics Report`});const o=n({name:"select report type"}),B=n(""),K=n(""),J=Ne,g=n(new Array),L=de("token"),S=n({page:1,rowsPerPage:20,sortBy:"name"}),Y=n(0),m=n(!1),u=n([]),X=n("User Statistics Report"),F=n([]);n(!1);const D=we(),d=n({name:"Select and search for user..."}),Z=n([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),Q=n([{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}]),i=v(()=>g.value.map(t=>({...t,created_date:f(t.created_date).format("DD/MMM/YYYY"),age:xe(t.date_of_birth)}))),W=v(()=>{const t=o.value,s=()=>i.value.length>0&&t.name=="Summary"?i.value.map(a=>({USER:a.user,"TESTS COMPLETED":a.tests_completed,"TESTS RECEIVED":a.tests_received,"SPECIMEN COLLECTED":a.specimen_collected,"SPECIMEN REJECTED":a.specimen_rejected,"TESTS AUTHORIZED":a.tests_authorized})):[],y=()=>i.value.length>0&&t.name=="Patient Registry"?i.value.map(a=>({"PATIENT NO":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,AGE:a.age,SEX:a.sex})):[],p=()=>i.value.length>0&&t.name=="Tests Registry"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[],c=()=>i.value.length>0&&t.name=="Specimen Registry"?i.value.map(a=>({"SPECIMEN NUMBER":a.id,"PATIENT NAME":a.patient_name,"PATIENT NUMBER":a.patient_no,"DATE REGISTERED":a.created_date})):[],h=()=>i.value.length>0&&t.name=="Tests Performed"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":a.patient_name,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[];return{Summary:s(),"Patient Registry":y(),"Tests Registry":p(),"Specimen Registry":c(),"Tests Performed":h()}[t.name]}),C=v(()=>F.value.map(t=>({id:t.id,name:`${t.first_name} ${t.last_name}`}))),ee=v(()=>{const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},s=o.value.name.toLowerCase();return t[s]||""}),te=v(()=>{const t={summary:new Array({text:"Name",value:"user"},{text:"Tests Received",value:"tests_received"},{text:"Specimen Collected",value:"specimen_collected"},{text:"Specimen Rejected",value:"specimen_rejected"},{text:"Tests Performed",value:"tests_completed"},{text:"Tests Authorized",value:"tests_authorized"}),"specimen registry":new Array({text:"Specimen Number",value:"id"},{text:"Name",value:"specimen"},{text:"Patient Number",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Date Registered",value:"created_date"}),"tests registry":new Array({text:"Test Type",value:"test_type_name"},{text:"Patient Number",value:"client.id"},{text:"Patient Name",value:"actions"},{text:"Specimen",value:"specimen_type"},{text:"Date Registered",value:"created_date"}),"patients registry":new Array({text:"Patient Number",value:"id"},{text:"Name",value:"actions"},{text:"Gender",value:"sex"},{text:"Age",value:"age"},{text:"Date Registered",value:"created_date"}),"tests performed":new Array({text:"Test Id",value:"test_id"},{text:"Test Type",value:"test_type"},{text:"Patient No",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Accession Number",value:"accession_number"},{text:"Date Registered",value:"created_date"})},s=o.value.name.toLowerCase();return t[s]||new Array}),w=v(()=>u.value[0]?f(u.value[0]).format("YYYY-MM-DD"):""),$=v(()=>u.value[1]?f(u.value[1]).format("YYYY-MM-DD"):"");async function I(){if(O(o.value)=="")A().$toast.warning("Please select a report type!");else{m.value=!0;const{page:t,rowsPerPage:s}=S.value;let y=`from=${w.value}&to=${$.value}&report_type=${O(o.value).toLocaleLowerCase()}&page=${t}&limit=${s}&user=${d.value.id}`;const p={route:`${G.aggregateReports}user_statistics?${y}`,method:"GET",token:`${L.value}`},{data:c,error:h,pending:P}=await H(p);m.value=P,c.value&&(m.value=!1,g.value=c.value.data.tests,Y.value=c.value.data.metadata.total_count,c.value.data.tests.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found in period ${w.value} - ${$.value}`)),h.value&&(m.value=!1,console.error(h.value),A().$toast.error(Ee))}}async function ae(){const{data:t,error:s}=await H({route:`${G.users}?page=1&per_page=2000`,method:"GET",token:`${L.value}`});t.value&&(F.value=t.value.data,C.value.some(p=>p.name=="All")||C.value.unshift({id:0,name:"All"})),s.value&&console.error(s.value)}function O(t){return t.name=="select report type"?"":t.name}function se(t){typeof t=="object"&&(S.value=t)}function re(t){B.value=t,K.value=t,I()}return j(()=>S.value,(t,s)=>{t!=s&&I()}),j(()=>o.value,(t,s)=>{t!=s&&(g.value=[])}),ae(),(t,s)=>{const y=ie,p=M("datepicker"),c=ce,h=pe,P=M("FormKit"),a=ge,ne=M("excel"),oe=ye,le=he;return E(),T("div",be,[l(y,{pages:e(Z)},null,8,["pages"]),r("div",De,[Ce,r("h3",Ie,z(e(X)),1)]),r("div",Me,[l(P,{type:"form","submit-label":"Update",onSubmit:I,actions:!1,id:"submitForm"},{default:k(({value:_})=>[r("div",ke,[r("div",Ue,[l(e($e),{class:"w-5 h-5 mr-2"}),V(" Filter By Date Range "),r("div",Ve,[l(p,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(u),"onUpdate:modelValue":s[0]||(s[0]=x=>U(u)?u.value=x:null)},null,8,["modelValue"])])]),r("div",Be,[l(e(Ae),{class:"w-5 h-5 mr-2 my-2.5"}),V(" Report Type "),r("div",Le,[l(c,{class:"bg-white",items:e(Q),modelValue:e(o),"onUpdate:modelValue":s[1]||(s[1]=x=>U(o)?o.value=x:null)},null,8,["items","modelValue"])])]),r("div",Ye,[r("div",Fe,[r("div",Oe,[l(c,{class:"bg-white rounded",isSearchable:!0,items:e(C),modelValue:e(d),"onUpdate:modelValue":s[2]||(s[2]=x=>U(d)?d.value=x:null),onUpdate:re},null,8,["items","modelValue"])]),e(d).name!=null&&e(d).name!=="Select and search for user..."?(E(),T("button",{key:0,type:"button",onClick:s[3]||(s[3]=x=>d.value={name:"Select and search for user..."})},[l(e(Pe),{class:"w-5 h-5 mx-2 my-2.5"})])):N("",!0)])]),r("div",je,[l(h,{type:"submit",color:"primary",text:"Generate Report",icon:e(J),click:()=>{},loading:e(m)},null,8,["icon","loading"])])])]),_:1}),l(ne,{class:"btn btn-default",header:[`USER STATISTICS ${e(o).name.toUpperCase()} REPORT`,`PERIOD FROM ${e(f)(e(w)).format("dateFormat"in t?t.dateFormat:e(q))} TO ${e(f)(e($)).format("dateFormat"in t?t.dateFormat:e(q))}`,e(D).details.name,e(D).details.address,e(D).details.phone],data:e(W),worksheet:"report-work-sheet",name:`user_statistics_report_${e(o).name.toLowerCase().split(" ").join("_")}_${e(f)(e(w)).format("DD_MM_yyyy")}_to_${e(f)(e($)).format("DD_MM_yyyy")}.xls`},{default:k(()=>[l(a,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),e(g).length>0?(E(),T("div",ze,[l(oe,{headers:e(te),data:e(i),serverItemsLength:e(Y),serverOptions:e(S),loading:e(m),"search-field":e(ee),"search-value":e(B),onUpdate:se},{actions:k(({item:_})=>[r("td",null,z(e(o).name.toLowerCase()=="patients registry"?`${_.first_name}
                            ${_.middle_name} ${_.last_name}`:`${_.client.first_name} ${_.client.middle_name}
                            ${_.client.last_name}`),1)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value"])])):N("",!0),e(g).length==0&&!e(m)?(E(),T("div",Ge,Ke)):N("",!0),e(m)&&e(g).length==0?(E(),T("div",Je,[l(le),Xe])):N("",!0)])}}});const St=fe(Ze,[["__scopeId","data-v-16eaabb0"]]);export{St as default};
