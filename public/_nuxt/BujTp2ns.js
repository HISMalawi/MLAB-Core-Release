import{_ as pe}from"./B38OGO74.js";import{_ as me}from"./BWe303fu.js";import{d as _e,a as fe,r as w,a5 as ye,aj as ve,u as A,c as j,C as _,w as L,o as he,y as U,b as c,e as u,f as p,g as s,t as b,z as G,h as t,k as I,H as z,O as H,F as C,j as E,N as ge,K,l as Re,E as be,_ as xe}from"./DaVfplCl.js";import{_ as De}from"./DjvDPQpG.js";import{_ as $e}from"./BNBlrbgu.js";import{_ as we,a as Te}from"./B5IH3IIM.js";import{u as ke,_ as Ce}from"./qDaxYYZu.js";import{u as Me}from"./MuIwof8c.js";import{_ as Ae}from"./aVKuZZVS.js";import{_ as Ee}from"./DlVh0w5e.js";import{u as qe}from"./TCrkXuHj.js";import{P as Oe}from"./Dr0mg474.js";import{r as Ye}from"./B6aIjIoK.js";import{r as Fe}from"./Dqe_SWQt.js";import"./CaCwXEk-.js";import"./Bk1fID9q.js";import"./CrLTzj8x.js";import"./BeuONbta.js";import"./C4Sn6TUr.js";import"./WTOBM9CX.js";import"./BBPlnGp-.js";import"./dfRNb6Oz.js";import"./zVsiTWFb.js";const Se={class:"px-5 py-5"},je=s("img",{src:Ae,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Ue={class:"w-full flex items-center justify-between mb-3"},Be={class:"flex items-center space-x-3"},Pe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ve={class:"w-72 ml-2"},Ne={class:"w-44"},Le={class:"flex items-center space-x-3"},Ge={class:"border rounded print-container",id:"print-container"},Ie={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},ze=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:Ee,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold"},"LABORATORY STATISTICS REPORT")],-1),He={class:"mt-3 px-5"},Ke={class:"font-medium mb-2"},Qe={class:"font-normal"},Je={class:"overflow-x-auto bg-white border-t"},We={key:0,class:"w-full overflow-x-auto"},Xe={class:"uppercase bg-gray-100"},Ze={class:"text-left"},et=s("th",{class:"px-4 py-2"},"Tests",-1),tt=s("th",{class:"px-4 py-2"},"Total",-1),ot={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},st={class:"px-4 py-2 font-bold"},rt=s("td",{class:"px-4 py-2"},null,-1),at={class:"px-4 py-2"},nt=["onClick"],lt={class:"px-4 py-2"},ct={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},ut=s("img",{src:Te,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),it=s("p",null,"Data not found, please generate report",-1),dt=[ut,it],pt="Lab Statistics Report",Ut=_e({__name:"lab-statistics",setup(mt){Me({title:`${Oe.name.toUpperCase()} - Lab Statistics Report`});const F=qe(),Q=fe("token"),J=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],M=w([]),v=w({name:"select department"}),l=w(["",""]),B=w([]),T=w([]),q=w([]),P=w([]),x=ye(),m=ve(),{$toast:W,$metadata:X}=A(),{loading:f,executeCancellableRequest:Z,cancelRequest:ee}=ke(),te=()=>{l.value=new Array("","")};function oe(e){return e==="select department"||e==="-- select test type --"||e==="-- select test status --"?"":e}function se(e,o){const r=new Date(e),a=new Date(o),n=new Array;let i=r;for(;i<=a;){const h=i.toLocaleString("default",{month:"long"});n.push(h),i.setMonth(i.getMonth()+1)}T.value=n}const re=()=>{const{value:e}=v;return e.name==="select department"?!A().$toast.warning("Please select a department"):!0},D=j(()=>l.value[0]?_(l.value[0]).format("YYYY-MM-DD"):""),$=j(()=>l.value[1]?_(l.value[1]).format("YYYY-MM-DD"):"");async function V(){f.value=!0;let e=`from=${D.value}&to=${$.value}&department=${oe(v.value.name)}&report_id=${m.query.report_id}`;const o={route:`${Re.aggregateReports}/lab_statistics?${e}`,method:"GET",token:`${Q.value}`},{data:r,error:a,pending:n}=await Z(o);if(f.value=n,r.value){se(r.value.from,r.value.to),B.value=r.value.data,q.value=ne(r.value.data);let i=[];q.value.forEach(h=>{const g={};g["Tests".toUpperCase()]=h.department.toUpperCase(),T.value.forEach(y=>{g[y.toUpperCase()]=""}),g["Total".toUpperCase()]="",i.push(g),h.tests.forEach(y=>{const k={};k["Tests".toUpperCase()]=y.name,T.value.forEach(O=>{k[O.toUpperCase()]=S(y,O)}),k["Total".toUpperCase()]=N(y),i.push(k)})}),P.value=i,f.value=!1,ae(r.value.report_id),r.value.data.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found for period ${D.value} - ${$.value}`)}a.value&&(f.value=!1,console.error("error: ",a.value),A().$toast.error(be))}const ae=e=>{const r={...x.currentRoute.value.query,report_id:e};x.replace({query:r}).catch(a=>{console.error("Failed to replace route:",a)})};function ne(e){return e.map(o=>{const r=Object.keys(o)[0],a=Object.entries(o[r]).map(([n,i])=>{const h=Object.entries(i).map(([g,y])=>({[g]:y}));return{name:n,results:h}});return{department:r,tests:a}})}function S(e,o){let r=0;return e.results.forEach(a=>{let n=a[o]!==void 0?a[o].total:0;r+=n}),r}function N(e){let o=0;return e.results.forEach(r=>{Object.values(r).forEach(a=>{o+=a.total})}),o}const le=(e,o,r)=>{const a=e.results.find(n=>n[o]!==void 0);a?x.push(`/reports/${a[o].associated_ids}?origin=aggregate&type=lab-statistics-report&from=${D.value}&to=${$.value}&test=${e.name}&department=${v.value.name}&count=${r}&page=1&rowsPerPage=10`):W.warning("No data found for this month")};function ce(e){return e%2===0}L(l,()=>{const e=l.value[0]?_(l.value[0]).format("YYYY-MM-DD"):"",o=l.value[1]?_(l.value[1]).format("YYYY-MM-DD"):"";if(e||o){const a={...x.currentRoute.value.query,...e&&{from:e},...o&&{to:o}};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0}),L(v,(e,o)=>{if(e!==o){const a={...x.currentRoute.value.query,department:e.name||void 0,report_id:""};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}});const ue=j(()=>m.query.to!==void 0&&m.query.from!==void 0&&m.query.department!==void 0?(l.value=[m.query.from,m.query.to],v.value.name=`${m.query.department}`,m.query.to!==""&&m.query.from!==""&&m.query.department!==""):!1);return he(()=>{ue.value?V():f.value=!1,M.value=X.departments,M.value.some(o=>o.name=="All")||M.value.push({id:0,name:"All"}),M.value.sort((o,r)=>{const a=o.name.toUpperCase(),n=r.name.toUpperCase();return a<n?-1:a>n?1:0})}),(e,o)=>{const r=pe,a=U("datepicker"),n=me,i=xe,h=U("FormKit"),g=De,y=$e,k=U("excel"),O=we,ie=Ce;return c(),u("div",Se,[p(r,{pages:J}),s("div",{class:"flex items-center py-5"},[je,s("h3",{class:"text-2xl font-semibold uppercase"},b(pt))]),s("div",Ue,[p(h,{type:"form","submit-label":"Update",onSubmit:o[2]||(o[2]=R=>re()&&V()),actions:!1,id:"submitForm"},{default:G(({value:R})=>[s("div",Be,[s("div",Pe,[p(t(Ye),{class:"w-5 h-5 mr-2"}),I(" Filter By Date Range "),s("div",Ve,[p(a,{onCleared:te,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(l),"onUpdate:modelValue":o[0]||(o[0]=d=>z(l)?l.value=d:null)},null,8,["modelValue"])])]),s("div",Ne,[p(n,{items:t(M),modelValue:t(v),"onUpdate:modelValue":o[1]||(o[1]=d=>z(v)?v.value=d:null)},null,8,["items","modelValue"])]),p(i,{type:"submit",color:"primary",text:"Generate Report",icon:t(Fe),click:()=>{},loading:t(f)},null,8,["icon","loading"])])]),_:1}),s("div",Le,[p(g),s("div",null,[p(k,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${t(_)(t(D)).format("DD-MM-yyyy")} TO ${t(_)(t($)).format("DD-MM-yyyy")}`,t(F).details.name,t(F).details.address,t(F).details.phone],data:t(P),worksheet:"report-work-sheet",name:`lab-statistics-report_${t(_)(t(D)).format("DD_MM_yyyy")}_to_${t(_)(t($)).format("DD_MM_yyyy")}.xls`},{default:G(()=>[p(y,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),s("div",Ge,[s("div",Ie,[ze,p(O)]),s("div",He,[s("h3",Ke,[I(" Tests Performed Period: "),s("span",Qe,b(t(D)!=""?t(_)(t(D)).format("DATE_FORMAT"in e?e.DATE_FORMAT:t(H)):"")+" - "+b(t($)!=""?t(_)(t($)).format("DATE_FORMAT"in e?e.DATE_FORMAT:t(H)):""),1)])]),s("div",Je,[t(q).length>0&&!t(f)?(c(),u("table",We,[s("thead",Xe,[s("tr",Ze,[et,(c(!0),u(C,null,E(t(T),R=>(c(),u("th",{key:R,class:"px-4 py-2"},b(R),1))),128)),tt])]),s("tbody",null,[(c(!0),u(C,null,E(t(q),R=>(c(),u(C,{key:R.department},[s("tr",ot,[s("td",st,b(R.department),1),(c(!0),u(C,null,E(t(T),d=>(c(),u("td",{key:d,class:"px-4 py-2"}))),128)),rt]),(c(!0),u(C,null,E(R.tests,(d,de)=>(c(),u("tr",{key:d.name,class:ge({"bg-gray-50":ce(de),"border-b border-dotted":!0})},[s("td",at,b(d.name),1),(c(!0),u(C,null,E(t(T),Y=>(c(),u("td",{onClick:_t=>le(d,Y,S(d,Y)),key:Y,class:"px-4 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},b(S(d,Y)),9,nt))),128)),s("td",lt,b(N(d)),1)],2))),128))],64))),128))])])):K("",!0),p(ie,{condition:t(f),cancelReportGeneration:()=>t(ee)()},null,8,["condition","cancelReportGeneration"]),t(B).length==0&&!t(f)?(c(),u("div",ct,dt)):K("",!0)])])])}}});export{Ut as default};
