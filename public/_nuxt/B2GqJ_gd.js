import{P as $e}from"./DsF3fssB.js";import{d as X,u as B,r as h,o as ee,x as D,b as p,e as y,g as e,f as l,y as S,h as t,A as J,t as x,j as L,l as H,m as U,_ as te,p as Q,S as se,Y as oe,G as ae,V as re,q as ie,a as de,E as ce,s as ue,i as pe,v as ve,F as Y,k as G,z as xe,n as ne,I as Te,J as R,K as Z,C as E,w as ge,H as W,L as Ve,c as he,M as De,N as Pe}from"./CXJT-Lpc.js";import{u as ye}from"./B6c0AK0M.js";import{r as fe}from"./eyAL3cGy.js";import{r as be}from"./CMZoitPD.js";import{r as Ie}from"./BHoqqOvu.js";import{r as Ne}from"./C6YNPTYJ.js";import{r as Me}from"./B60x4Jja.js";import{r as Ae}from"./Cm6Ngi-s.js";import{u as _e}from"./CYhEBZLq.js";import{s as we}from"./DWmjL3KU.js";import{u as Fe}from"./eCzQTRux.js";import{r as je}from"./kGOxXp0n.js";import{u as Oe}from"./Di1jx6Ca.js";const He="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M9.17647%208.5C7.42215%208.5%206%209.93908%206%2011.7143V31C6%2032.7752%207.42215%2034.2143%209.17647%2034.2143H19.7646V36.3572H15.5293V38.5H32.4705V36.3572H28.2353V34.2143H38.8235C40.5778%2034.2143%2042%2032.7752%2042%2031V11.7143C42%209.93908%2040.5778%208.5%2038.8235%208.5H9.17647ZM21.8823%2036.3572V34.2143H26.1177V36.3572H21.8823ZM13.4119%2012.7858H15.5296V14.9286H17.6475V17.0715H15.5296V19.2143H13.4119V17.0715H11.2945L11.2945%2014.9286H13.4119V12.7858ZM11.2939%2023.5001C11.2939%2022.9083%2011.768%2022.4286%2012.3528%2022.4286H16.5881C17.1728%2022.4286%2017.6469%2022.9083%2017.6469%2023.5001V27.7858C17.6469%2028.3775%2017.1728%2028.8572%2016.5881%2028.8572H12.3528C11.768%2028.8572%2011.2939%2028.3775%2011.2939%2027.7858V23.5001ZM20.8234%2013.8572C20.8234%2013.2655%2021.2974%2012.7858%2021.8822%2012.7858H26.1175C26.7023%2012.7858%2027.1763%2013.2655%2027.1763%2013.8572V18.1429C27.1763%2018.7346%2026.7023%2019.2143%2026.1175%2019.2143H21.8822C21.2974%2019.2143%2020.8234%2018.7346%2020.8234%2018.1429V13.8572ZM20.8232%2023.5001C20.8232%2022.9083%2021.2973%2022.4286%2021.8821%2022.4286H26.1174C26.7021%2022.4286%2027.1762%2022.9083%2027.1762%2023.5001V27.7858C27.1762%2028.3775%2026.7021%2028.8572%2026.1174%2028.8572H21.8821C21.2973%2028.8572%2020.8232%2028.3775%2020.8232%2027.7858V23.5001ZM30.3527%2013.8572C30.3527%2013.2655%2030.8268%2012.7858%2031.4116%2012.7858H35.6469C36.2316%2012.7858%2036.7057%2013.2655%2036.7057%2013.8572V18.1429C36.7057%2018.7346%2036.2316%2019.2143%2035.6469%2019.2143H31.4116C30.8268%2019.2143%2030.3527%2018.7346%2030.3527%2018.1429V13.8572Z'%20fill='%23333333'/%3e%3c/svg%3e",Ee={class:"flex gap-6"},Ue={class:"flex-1"},qe={class:"grid grid-cols-2 gap-4"},Le={class:"mt-4"},Re={class:"flex-1"},ze={class:"p-4"},Be={class:"overflow-hidden"},Ze={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},Ye={class:"font-normal"},Ge={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},Ke={class:"flex items-center not-italic text-gray-600"},Xe={class:"flex items-center not-italic text-gray-600"},Je={class:"mt-4"},We={class:"flex items-center bg-gray-50 p-2 rounded border border-dotted"},Qe={class:"text-md font-mono"},et=X({__name:"FacilityTab",emits:["update"],setup(F,{emit:a}){const v=a,{$toast:r}=B(),f=ye(),d=fe,i=h(""),u=h(""),b=h(""),k=h(""),V=h(""),c=h(!1),w=h(new Date().getFullYear().toString().slice(-2)),P=()=>{i.value=f.details.name,b.value=f.details.phone,u.value=f.details.code,k.value=f.details.address,V.value=f.details.district},j=async()=>{c.value=!0;const C={route:`${H.global}/${f.details.id}`,method:"PUT",body:{name:i.value,code:u.value,address:k.value,phone:b.value,district:V.value}},{data:n,error:s,pending:T}=await U(C);c.value=T,n.value&&(r.success("Facility updated successfully!"),v("update",!0),$(),c.value=!1),s.value&&(console.error(s.value),r.error("Error updating facility"),c.value=!1)},$=async()=>{const{fetchFacility:C}=ye(),n={route:H.global,method:"GET"},{data:s,error:T}=await U(n);T.value&&console.error(T.value),s.value&&C(s.value)};return ee(()=>{P()}),(C,n)=>{const s=D("FormKit"),T=te;return p(),y("div",Ee,[e("div",Ue,[l(s,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:S(()=>[e("div",qe,[l(s,{label:"Name",type:"text",modelValue:t(i),"onUpdate:modelValue":n[0]||(n[0]=m=>J(i)?i.value=m:null)},null,8,["modelValue"]),l(s,{label:"Code",type:"text",modelValue:t(u),"onUpdate:modelValue":n[1]||(n[1]=m=>J(u)?u.value=m:null)},null,8,["modelValue"]),l(s,{label:"District",type:"text",modelValue:t(V),"onUpdate:modelValue":n[2]||(n[2]=m=>J(V)?V.value=m:null)},null,8,["modelValue"]),l(s,{label:"Address",type:"text",modelValue:t(k),"onUpdate:modelValue":n[3]||(n[3]=m=>J(k)?k.value=m:null)},null,8,["modelValue"]),l(s,{label:"Phone Number",type:"text",modelValue:t(b),"onUpdate:modelValue":n[4]||(n[4]=m=>J(b)?b.value=m:null)},null,8,["modelValue"])]),e("div",Le,[l(T,{click:()=>{},type:"submit",loading:t(c),icon:t(d),text:"Save Changes",color:"success"},null,8,["loading","icon"])])]),_:1})]),e("div",Re,[e("div",ze,[n[8]||(n[8]=e("h3",{class:"text-lg font-medium mb-3"},"Report Preview",-1)),e("div",Be,[e("div",Ze,[e("address",Ye,[e("span",Ge,x(t(i)||"Facility Name"),1),e("span",Ke,[n[5]||(n[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4 mr-1"},[e("path",{"fill-rule":"evenodd",d:"M8.161 2.58a1.875 1.875 0 0 1 1.678 0l4.993 2.498c.106.052.23.052.336 0l3.869-1.935A1.875 1.875 0 0 1 21.75 4.82v12.485c0 .71-.401 1.36-1.037 1.677l-4.875 2.437a1.875 1.875 0 0 1-1.676 0l-4.994-2.497a.375.375 0 0 0-.336 0l-3.868 1.935A1.875 1.875 0 0 1 2.25 19.18V6.695c0-.71.401-1.36 1.036-1.677l4.875-2.437ZM9 6a.75.75 0 0 1 .75.75V15a.75.75 0 0 1-1.5 0V6.75A.75.75 0 0 1 9 6Zm6.75 3a.75.75 0 0 0-1.5 0v8.25a.75.75 0 0 0 1.5 0V9Z","clip-rule":"evenodd"})],-1)),L(" "+x(t(k)||"Address"),1)]),e("span",Xe,[n[6]||(n[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4 mr-1"},[e("path",{"fill-rule":"evenodd",d:"M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z","clip-rule":"evenodd"})],-1)),L(" "+x(t(b)||"Phone Number"),1)])])]),e("div",Je,[n[7]||(n[7]=e("h4",{class:"text-lg font-medium mb-2"},"Accession Number Preview",-1)),e("div",We,[e("div",Qe,x(t(u)||"CODE")+x(t(w))+"000001 ",1)])])])])])])}}}),tt={components:{TransitionChild:Q,TransitionRoot:se,Dialog:oe,DialogPanel:ae,DialogTitle:re,XMarkIcon:ie,PrinterIcon:be},data(){return{addIcon:Ie,saveIcon:fe,open:!1,loading:!1,cookie:de("token"),name:"",description:""}},methods:{async submitForm(){this.loading=!1;const F={route:H.printers,method:"POST",token:`${this.cookie}`,body:{name:this.name,description:this.description}},{data:a,error:v,pending:r}=await U(F);this.loading=r,a.value&&(B().$toast.success("Facility created successfully!"),this.$emit("update",!0),this.loading=!1,this.handleClick()),v.value&&(console.error(v.value),B().$toast.error(ce),this.loading=!1)},handleClick(){this.open=!this.open}}},st={class:"fixed inset-0 overflow-y-auto"},ot={class:"flex min-h-full items-center justify-center p-4 text-center"},at={class:"border-b px-3 py-3 flex items-center justify-between"},nt={class:"px-5 py-5"},lt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function rt(F,a,v,r,f,d){const i=te,u=D("TransitionChild"),b=D("PrinterIcon"),k=D("DialogTitle"),V=D("XMarkIcon"),c=D("FormKit"),w=D("DialogPanel"),P=D("Dialog"),j=D("TransitionRoot");return p(),y("div",null,[e("div",null,[l(i,{click:d.handleClick,text:"Add printer",color:"primary",icon:f.addIcon},null,8,["click","icon"])]),l(j,{appear:"",show:f.open,as:"template"},{default:S(()=>[l(P,{as:"div",onClose:d.handleClick,class:"relative z-10"},{default:S(()=>[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>a[3]||(a[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",st,[e("div",ot,[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[l(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[e("div",at,[l(k,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>[l(b,{class:"w-8 h-8 mr-2"}),a[4]||(a[4]=L(" Add printer "))]),_:1}),e("button",{onClick:a[0]||(a[0]=(...$)=>d.handleClick&&d.handleClick(...$))},[l(V,{class:"w-5 h-5"})])]),l(c,{type:"form","submit-label":"Update",onSubmit:d.submitForm,actions:!1},{default:S(({value:$})=>[e("div",nt,[l(c,{type:"text",label:"Name",validation:"required",modelValue:f.name,"onUpdate:modelValue":a[1]||(a[1]=C=>f.name=C)},null,8,["modelValue"]),l(c,{type:"textarea",label:"Description",validation:"required",modelValue:f.description,"onUpdate:modelValue":a[2]||(a[2]=C=>f.description=C)},null,8,["modelValue"])]),e("div",lt,[l(i,{click:()=>{},type:"submit",color:"success",icon:f.saveIcon,text:"Save chages",loading:f.loading},null,8,["icon","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const it=ue(tt,[["render",rt]]),dt={components:{TransitionRoot:se,TransitionChild:Q,Dialog:oe,DialogPanel:ae,DialogTitle:re,XMarkIcon:ie,PrinterIcon:be},data(){return{editIcon:Ne,show:!1,saveIcon:fe,loading:!1,cookie:de("token")}},props:{data:{type:Object,required:!0}},methods:{async submitForm(){this.loading=!0;const F={route:`${H.printers}/${this.data.id}`,method:"PUT",token:`${this.cookie}`,body:this.data},{pending:a,error:v,data:r}=await U(F);this.loading=a,r.value&&(this.handleClick(),B().$toast.success("Printer updated successfully!"),this.loading=!1,this.$emit("update",!0)),v.value&&(B().$toast.success(ce),this.handleClick(),console.error(v.value),this.loading=!1)},handleClick(){this.show=!this.show}}},ct={class:"fixed inset-0 overflow-y-auto"},ut={class:"flex min-h-full items-center justify-center p-4 text-center"},ft={class:"border-b px-3 py-3 flex items-center justify-between"},mt={class:"mt-2 space-y-3"},pt={class:"w-full flex items-center px-5"},vt={class:"w-full flex flex-col space-y-2"},gt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function yt(F,a,v,r,f,d){const i=te,u=D("TransitionChild"),b=D("PrinterIcon"),k=D("DialogTitle"),V=D("XMarkIcon"),c=D("FormKit"),w=D("DialogPanel"),P=D("Dialog"),j=D("TransitionRoot");return p(),y("div",null,[l(i,{click:d.handleClick,text:"Edit",icon:f.editIcon,color:"success"},null,8,["click","icon"]),l(j,{appear:"",show:f.show,as:"template"},{default:S(()=>[l(P,{as:"div",class:"relative z-10"},{default:S(()=>[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>a[3]||(a[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",ct,[e("div",ut,[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[l(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[e("div",ft,[l(k,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>[l(b,{class:"w-8 h-8 mr-2"}),a[4]||(a[4]=L(" Edit printer "))]),_:1}),e("button",{onClick:a[0]||(a[0]=(...$)=>d.handleClick&&d.handleClick(...$))},[l(V,{class:"w-5 h-5"})])]),l(c,{type:"form","submit-label":"Update",onSubmit:d.submitForm,actions:!1},{default:S(({value:$})=>[e("div",mt,[e("div",pt,[e("div",vt,[l(c,{type:"text",label:"Name",validation:"required",modelValue:v.data.name,"onUpdate:modelValue":a[1]||(a[1]=C=>v.data.name=C)},null,8,["modelValue"]),l(c,{type:"textarea",label:"Description",validation:"required",modelValue:v.data.description,"onUpdate:modelValue":a[2]||(a[2]=C=>v.data.description=C)},null,8,["modelValue"])])]),e("div",gt,[l(i,{type:"submit",click:()=>{},color:"success",loading:f.loading,icon:f.saveIcon,text:"Save changes"},null,8,["loading","icon"])])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const xt=ue(dt,[["render",yt]]),ht={components:{TransitionRoot:se,TransitionChild:Q,Dialog:oe,DialogPanel:ae,DialogTitle:re,XMarkIcon:ie,ExclamationTriangleIcon:Me},data(){return{show:!1,deleteIcon:Ae,loading:!1,cookie:de("token"),reason:""}},props:{data:{type:Object,required:!0}},methods:{async deleteData(F){this.loading=!0;const a={route:`${H.printers}/${F}`,method:"DELETE",token:`${this.cookie}`,body:{voided_reason:this.reason}},{data:v,error:r,pending:f}=await U(a);this.loading=f,v.value&&(this.handleClick(),B().$toast.success("Printer deleted successfully!"),this.loading=!1,this.$emit("update",!0)),r.value&&(console.error(r.value),B().$toast.error(ce),this.loading=!1)},handleClick(){this.show=!this.show}}},bt={class:"fixed inset-0 overflow-y-auto"},_t={class:"flex min-h-full items-center justify-center p-4 text-center"},wt={class:"border-b px-3 py-3 flex items-center justify-between"},kt={class:"mt-2 space-y-3 px-5"},Ct={class:"rounded px-2 py-2"},St={class:"font-semibold text-red-500"},$t={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Tt(F,a,v,r,f,d){const i=te,u=D("TransitionChild"),b=D("ExclamationTriangleIcon"),k=D("DialogTitle"),V=D("XMarkIcon"),c=D("FormKit"),w=D("DialogPanel"),P=D("Dialog"),j=D("TransitionRoot");return p(),y("div",null,[l(i,{click:d.handleClick,color:"error",text:"Delete",icon:f.deleteIcon},null,8,["click","icon"]),l(j,{appear:"",show:f.show,as:"template"},{default:S(()=>[l(P,{as:"div",class:"relative z-10"},{default:S(()=>[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>a[3]||(a[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",bt,[e("div",_t,[l(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[l(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[e("div",wt,[l(k,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>[l(b,{class:"h-5 w-5 mr-2"}),a[4]||(a[4]=L(" Confirm delete "))]),_:1}),e("button",{onClick:a[0]||(a[0]=(...$)=>d.handleClick&&d.handleClick(...$))},[l(V,{class:"w-5 h-5"})])]),l(c,{type:"form","submit-label":"Update",onSubmit:a[2]||(a[2]=$=>d.deleteData(v.data.id)),actions:!1},{default:S(({value:$})=>[e("div",kt,[e("div",Ct,[a[5]||(a[5]=L(" Do you really want to delete ")),e("span",St,x(v.data.name),1),a[6]||(a[6]=L("? Note that once this action is completed, it can not be undone "))]),l(c,{type:"textarea",label:"Reason",validation:"required",modelValue:f.reason,"onUpdate:modelValue":a[1]||(a[1]=C=>f.reason=C)},null,8,["modelValue"])]),e("div",$t,[l(i,{loading:f.loading,type:"submit",click:()=>{},color:"error",icon:f.deleteIcon,text:"Delete"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Vt=ue(ht,[["render",Tt]]),Dt={class:"flex items-center justify-end mb-5"},Pt={class:"flex items-center mx-auto justify-center py-20"},It={class:"relative overflow-x-auto"},Nt={class:"w-full text-left border rounded-lg"},Mt={class:"uppercase bg-gray-100"},At={class:"px-2 py-2 font-normal"},Ft={class:"px-2 py-2"},jt={class:"px-2 py-2"},Ot={class:"flex items-center space-x-2"},Ht="YYYY-MM-DD",Et=X({__name:"PrintersTab",setup(F){const a=h([{text:"name",value:"name"},{text:"description",value:"description"},{text:"date created",value:"date_created"},{text:"Actions",value:"actions"}]),v=h([]),r=h(!1),f=async()=>{r.value=!0;const d={route:H.printers,method:"GET"},{data:i,error:u,pending:b}=await U(d);r.value=b,i.value&&(v.value=i.value,r.value=!1),u.value&&(console.error(u.value),r.value=!1)};return ee(()=>{f()}),(d,i)=>{const u=it,b=ne,k=xt,V=Vt;return p(),y("div",null,[e("div",Dt,[l(u,{onUpdate:f})]),pe(e("div",Pt,[l(b,{loading:t(r)},null,8,["loading"])],512),[[ve,t(r)]]),pe(e("div",It,[e("table",Nt,[e("thead",Mt,[e("tr",null,[(p(!0),y(Y,null,G(t(a),(c,w)=>(p(),y("th",{class:"uppercase py-2 px-2",key:w},x(c.text),1))),128))])]),e("tbody",null,[(p(!0),y(Y,null,G(t(v),(c,w)=>(p(),y("tr",{class:"bg-white border-b",key:w},[e("th",At,x(c.name),1),e("td",Ft,x(c.description),1),e("td",jt,x(t(xe)(c.created_date).format(Ht)),1),e("td",null,[e("div",Ot,[l(k,{data:c,onUpdate:f},null,8,["data"]),l(V,{data:c,onUpdate:f},null,8,["data"])])])]))),128))])])],512),[[ve,!t(r)]])])}}}),Ut={key:0,class:"flex flex-col space-y-2 items-center justify-center py-10"},qt={key:1},Lt={class:"w-full flex flex-col border border-gray-200 rounded p-4 mb-4"},Rt={class:"w-full flex flex-col sm:flex-row gap-6"},zt={key:0,class:"absolute -right-3 -top-3 text-sky-500 bg-white rounded-full"},Bt={class:"flex-1 grid grid-cols-3 gap-2"},Zt={key:0,class:"absolute -right-3 -top-3 text-sky-500 bg-white rounded-full"},Yt={class:"flex-1 flex flex-col gap-2"},Gt={class:"w-full border border-gray-200 rounded p-4 mb-4"},Kt={class:"flex items-center space-x-4"},Xt={class:"form-control"},Jt={class:"flex items-center cursor-pointer space-x-2"},Wt=["checked"],Qt={class:"form-control"},es={class:"flex items-center cursor-pointer space-x-2"},ts=["checked"],ss={class:"w-full border border-gray-200 rounded p-4"},os={class:"w-full flex flex-col sm:flex-row gap-6"},as={key:0,class:"absolute -right-3 -top-3 text-sky-500 bg-white rounded-full"},ns={key:0,class:"absolute -right-3 -top-3 text-sky-500 bg-white rounded-full"},ls=X({__name:"PreferencesTab",setup(F){const{$toast:a}=B(),{can:v}=_e(),r=Te(),f=h([]),d=h("grid"),i=h("true"),u=h("full_name"),b=h(!1),k=async()=>{b.value=!0;const n={route:H.preferences,method:"GET"},{data:s,error:T}=await U(n);T.value&&(console.error(T.value),b.value=!1,a.error("Failed to load preferences")),s.value&&(f.value=s.value,s.value.forEach(m=>{try{if(m.name==="grid_or_list_enter_result_view"){const M=JSON.parse(m.value),N=r.user.preferences.find(I=>I.name===m.name);d.value=(N==null?void 0:N.value)||M.default}else if(m.name==="elasticsearch_enable_high_accuracy"){const M=JSON.parse(m.value),N=r.user.preferences.find(I=>I.name===m.name);i.value=(N==null?void 0:N.value)||M.default}else if(m.name==="test_name_display"){const M=JSON.parse(m.value),N=r.user.preferences.find(I=>I.name===m.name);u.value=(N==null?void 0:N.value)||M.default}}catch(M){console.error("Error parsing preference:",M)}}),b.value=!1)},V=async n=>{if(d.value===n)return;d.value=n;const s=r.user.preferences.find(T=>T.name==="grid_or_list_enter_result_view");s?await C("user",{preferenceId:s.id,name:s.name,value:n}):await $("grid_or_list_enter_result_view",n)},c=async n=>{if(i.value===n)return;i.value=n;const s=r.user.preferences.find(T=>T.name==="elasticsearch_enable_high_accuracy");s?await C("user",{preferenceId:s.id,name:s.name,value:n}):await $("elasticsearch_enable_high_accuracy",n)},w=async n=>{if(u.value===n)return;u.value=n,f.value.find(T=>T.name==="test_name_display")?await P("test_name_display",n):(console.error("System preference 'test_name_display' not found"),a.error("Failed to update preference: System setting not found"))},P=async(n,s)=>{const T={route:`${H.global}/app_settings/${n}`,method:"PUT",body:{app_setting_id:n,value:s}},{data:m,error:M,pending:N}=await U(T);if(m.value){const I=[...r.user.preferences],z=I.findIndex(K=>K.name===n);z!==-1&&(I[z]={...I[z],value:s},r.updateUserPreferences(I)),a.success("Preference updated successfully!")}M.value&&console.error(M.value)},j=async(n,s,T)=>{const m={route:`${H.userPreferences}/${n}`,method:"PUT",body:{name:s,value:T}},{data:M,error:N}=await U(m);if(N.value&&(console.error(N.value),a.error("Failed to update preference")),M.value){const I=[...r.user.preferences],z=I.findIndex(K=>K.id===n);z!==-1&&(I[z]={...I[z],value:T},r.updateUserPreferences(I)),a.success("Preference updated successfully!")}},$=async(n,s)=>{const T={route:H.userPreferences,method:"POST",body:{name:n,value:s}},{data:m,error:M}=await U(T);if(M.value&&(console.error(M.value),a.error("Failed to create preference")),m.value){const N=[...r.user.preferences,m.value];r.updateUserPreferences(N),a.success("Preference created successfully!")}},C=async(n,s)=>{P(String(s.app_settting_id),s.value),j(Number(s.preferenceId),String(s.name),s.value)};return ee(()=>{k()}),(n,s)=>{const T=ne;return p(),y("div",null,[t(b)?(p(),y("div",Ut,[l(T,{loading:t(b)},null,8,["loading"]),s[6]||(s[6]=e("p",{class:"text-base mt-2"},"Loading preferences, please wait...",-1))])):(p(),y("div",qt,[e("div",Lt,[s[14]||(s[14]=e("div",{class:"flex justify-between items-start mb-4"},[e("div",null,[e("h3",{class:"font-bold text-gray-900 text-lg"},"Results Panel"),e("p",{class:"text-gray-500"}," Modify default layout when entering results ")])],-1)),e("div",Rt,[e("div",{class:"w-full sm:w-1/2 cursor-pointer",onClick:s[0]||(s[0]=m=>V("grid"))},[e("div",{class:R(["bg-white border-2 rounded p-3 h-40 flex flex-col relative",{"border-sky-500":t(d)==="grid","border-gray-100":t(d)!=="grid"}])},[t(d)==="grid"?(p(),y("div",zt,s[7]||(s[7]=[Z('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" class="w-5 h-5"><defs><mask id="ipSCheckOne0"><g fill="none" stroke-linejoin="round" stroke-width="4"><path fill="#fff" stroke="#fff" d="M24 44a19.94 19.94 0 0 0 14.142-5.858A19.94 19.94 0 0 0 44 24a19.94 19.94 0 0 0-5.858-14.142A19.94 19.94 0 0 0 24 4A19.94 19.94 0 0 0 9.858 9.858A19.94 19.94 0 0 0 4 24a19.94 19.94 0 0 0 5.858 14.142A19.94 19.94 0 0 0 24 44Z"></path><path stroke="#000" stroke-linecap="round" d="m16 24l6 6l12-12"></path></g></mask></defs><path fill="currentColor" d="M0 0h48v48H0z" mask="url(#ipSCheckOne0)"></path></svg>',1)]))):E("",!0),s[8]||(s[8]=e("div",{class:"flex mb-2 space-x-1"},[e("div",{class:"w-2 h-2 rounded-full bg-red-500"}),e("div",{class:"w-2 h-2 rounded-full bg-yellow-500"}),e("div",{class:"w-2 h-2 rounded-full bg-green-500"})],-1)),e("div",Bt,[(p(),y(Y,null,G(9,m=>e("div",{key:m,class:"bg-gray-100 rounded flex items-center justify-center"})),64))])],2),s[9]||(s[9]=e("div",null,[e("h3",{class:"text-base py-2.5 font-medium"},"Grid (Default)")],-1))]),e("div",{class:"w-full sm:w-1/2 cursor-pointer",onClick:s[1]||(s[1]=m=>V("list"))},[e("div",{class:R(["bg-white border-2 rounded p-3 h-40 flex flex-col relative",{"border-sky-500":t(d)==="list","border-gray-100":t(d)!=="list"}])},[t(d)==="list"?(p(),y("div",Zt,s[10]||(s[10]=[Z('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" class="w-5 h-5"><defs><mask id="ipSCheckOne0"><g fill="none" stroke-linejoin="round" stroke-width="4"><path fill="#fff" stroke="#fff" d="M24 44a19.94 19.94 0 0 0 14.142-5.858A19.94 19.94 0 0 0 44 24a19.94 19.94 0 0 0-5.858-14.142A19.94 19.94 0 0 0 24 4A19.94 19.94 0 0 0 9.858 9.858A19.94 19.94 0 0 0 4 24a19.94 19.94 0 0 0 5.858 14.142A19.94 19.94 0 0 0 24 44Z"></path><path stroke="#000" stroke-linecap="round" d="m16 24l6 6l12-12"></path></g></mask></defs><path fill="currentColor" d="M0 0h48v48H0z" mask="url(#ipSCheckOne0)"></path></svg>',1)]))):E("",!0),s[12]||(s[12]=e("div",{class:"flex mb-2 space-x-1"},[e("div",{class:"w-2 h-2 rounded-full bg-red-500"}),e("div",{class:"w-2 h-2 rounded-full bg-yellow-500"}),e("div",{class:"w-2 h-2 rounded-full bg-green-500"})],-1)),e("div",Yt,[(p(),y(Y,null,G(3,m=>e("div",{key:m,class:"bg-gray-100 rounded flex items-center p-1"},s[11]||(s[11]=[e("div",{class:"flex-1"},[e("div",{class:"h-3 w-1/4 bg-gray-300 rounded"}),e("div",{class:"h-2 w-3/4 bg-gray-200 rounded mt-1"})],-1)]))),64))])],2),s[13]||(s[13]=e("div",null,[e("h3",{class:"text-base py-2.5 font-medium"},"ListView")],-1))])])]),e("div",Gt,[s[17]||(s[17]=e("div",{class:"flex justify-between items-start mb-4"},[e("div",null,[e("h3",{class:"font-bold text-gray-900 text-lg"}," Tests Search Settings "),e("p",{class:"text-gray-500"},"Configure tests search accuracy")])],-1)),e("div",Kt,[e("div",Xt,[e("label",Jt,[e("input",{type:"radio",name:"elasticsearch",class:"radio checked:bg-sky-500",checked:t(i)==="true",onChange:s[2]||(s[2]=m=>c("true"))},null,40,Wt),s[15]||(s[15]=e("span",{class:"label-text"},"High Accuracy, requires both first name and last name (Default)",-1))])]),e("div",Qt,[e("label",es,[e("input",{type:"radio",name:"elasticsearch",class:"radio checked:bg-sky-500",checked:t(i)==="false",onChange:s[3]||(s[3]=m=>c("false"))},null,40,ts),s[16]||(s[16]=e("span",{class:"label-text"},"Standard Accuracy",-1))])])])]),e("div",ss,[s[24]||(s[24]=e("div",{class:"flex justify-between items-start mb-4"},[e("div",null,[e("h3",{class:"font-bold text-gray-900 text-lg"},"Test Name Display"),e("p",{class:"text-gray-500"}," Choose how test names appear throughout the application ")])],-1)),e("div",os,[e("div",{class:R(["w-full sm:w-1/2",{"cursor-pointer":!t(v).manage("site_preferences"),"opacity-50 pointer-events-none":t(v).manage("site_preferences")}]),onClick:s[4]||(s[4]=m=>w("full_name"))},[e("div",{class:R(["bg-white border-2 rounded p-3 h-40 flex flex-col relative",{"border-sky-500":t(u)==="full_name","border-gray-100":t(u)!=="full_name"}])},[t(u)==="full_name"?(p(),y("div",as,s[18]||(s[18]=[Z('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" class="w-5 h-5"><defs><mask id="ipSCheckOne1"><g fill="none" stroke-linejoin="round" stroke-width="4"><path fill="#fff" stroke="#fff" d="M24 44a19.94 19.94 0 0 0 14.142-5.858A19.94 19.94 0 0 0 44 24a19.94 19.94 0 0 0-5.858-14.142A19.94 19.94 0 0 0 24 4A19.94 19.94 0 0 0 9.858 9.858A19.94 19.94 0 0 0 4 24a19.94 19.94 0 0 0 5.858 14.142A19.94 19.94 0 0 0 24 44Z"></path><path stroke="#000" stroke-linecap="round" d="m16 24l6 6l12-12"></path></g></mask></defs><path fill="currentColor" d="M0 0h48v48H0z" mask="url(#ipSCheckOne1)"></path></svg>',1)]))):E("",!0),s[19]||(s[19]=Z('<div class="flex mb-2 space-x-1"><div class="w-2 h-2 rounded-full bg-red-500"></div><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div><div class="flex-1 flex flex-col justify-center items-center"><div class="bg-gray-50 rounded-lg p-3 w-4/5"><div class="font-semibold text-sm text-center"> Full Blood Count </div><div class="text-xs text-gray-500 text-center"> (Test Type Name) </div><div class="mt-2 flex justify-between"><div class="h-2 bg-gray-200 w-1/4 rounded"></div><div class="h-2 bg-gray-300 w-1/3 rounded"></div></div></div><div class="text-xs mt-2 text-gray-500"> Shows the official test type name </div></div>',2))],2),s[20]||(s[20]=e("div",null,[e("h3",{class:"text-base py-2.5 font-medium"}," Test Type Name (Default) ")],-1))],2),e("div",{class:R(["w-full sm:w-1/2",{"cursor-pointer":!t(v).manage("site_preferences"),"opacity-50 pointer-events-none":t(v).manage("site_preferences")}]),onClick:s[5]||(s[5]=m=>w("preferred_name"))},[e("div",{class:R(["bg-white border-2 rounded p-3 h-40 flex flex-col relative",{"border-sky-500":t(u)==="preferred_name","border-gray-100":t(u)!=="preferred_name"}])},[t(u)==="preferred_name"?(p(),y("div",ns,s[21]||(s[21]=[Z('<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" class="w-5 h-5"><defs><mask id="ipSCheckOne2"><g fill="none" stroke-linejoin="round" stroke-width="4"><path fill="#fff" stroke="#fff" d="M24 44a19.94 19.94 0 0 0 14.142-5.858A19.94 19.94 0 0 0 44 24a19.94 19.94 0 0 0-5.858-14.142A19.94 19.94 0 0 0 24 4A19.94 19.94 0 0 0 9.858 9.858A19.94 19.94 0 0 0 4 24a19.94 19.94 0 0 0 5.858 14.142A19.94 19.94 0 0 0 24 44Z"></path><path stroke="#000" stroke-linecap="round" d="m16 24l6 6l12-12"></path></g></mask></defs><path fill="currentColor" d="M0 0h48v48H0z" mask="url(#ipSCheckOne2)"></path></svg>',1)]))):E("",!0),s[22]||(s[22]=Z('<div class="flex mb-2 space-x-1"><div class="w-2 h-2 rounded-full bg-red-500"></div><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div><div class="flex-1 flex flex-col justify-center items-center"><div class="bg-gray-50 rounded-lg p-3 w-4/5"><div class="font-semibold text-sm text-center">FBC</div><div class="text-xs text-gray-500 text-center"> (Preferred Name) </div><div class="mt-2 flex justify-between"><div class="h-2 bg-gray-200 w-1/4 rounded"></div><div class="h-2 bg-gray-300 w-1/3 rounded"></div></div></div><div class="text-xs mt-2 text-gray-500"> Shows the shorter preferred name </div></div>',2))],2),s[23]||(s[23]=e("div",null,[e("h3",{class:"text-base py-2.5 font-medium"},"Preferred Name")],-1))],2)])])]))])}}}),rs={class:"fixed inset-0 overflow-y-auto"},is={class:"flex min-h-full items-center justify-center p-4 text-center"},ds={class:"flex items-center space-x-4"},cs={class:"flex-shrink-0"},us={class:"flex-1"},fs={class:"text-lg font-semibold text-gray-900"},ms={class:"text-sm text-gray-500 mt-1"},ps={class:"mt-3"},vs={class:"bg-gray-200 rounded-full h-2"},gs={class:"text-xs text-gray-500 mt-1"},ys={key:0,class:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-md"},xs={class:"mt-4 flex justify-end"},hs=X({__name:"SyncDialog",props:{show:{type:Boolean},progress:{},status:{},syncType:{}},emits:["cancel"],setup(F){const a=F,v=h(null),r=h(!1);ge(()=>a.show,d=>{if(d){v.value=Date.now(),r.value=!1;const i=we(()=>{v.value&&Date.now()-v.value>12e4&&(r.value=!0,clearInterval(i))},3e4);ge(()=>a.show,u=>{u||(clearInterval(i),v.value=null,r.value=!1)})}});const f=d=>d.charAt(0).toUpperCase()+d.slice(1);return(d,i)=>{const u=ne;return p(),W(t(se),{appear:"",show:d.show,as:"template"},{default:S(()=>[l(t(oe),{as:"div",onClose:()=>{},class:"relative z-10"},{default:S(()=>[l(t(Q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>i[1]||(i[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-50"},null,-1)])),_:1}),e("div",rs,[e("div",is,[l(t(Q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[l(t(ae),{class:"w-full max-w-md transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all py-8 px-6"},{default:S(()=>[e("div",ds,[e("div",cs,[l(u,{width:80,height:80})]),e("div",us,[e("h3",fs,x(d.syncType==="full"?"Syncing Test Catalog":`Syncing ${f(d.syncType)}`),1),e("p",ms,x(d.status),1),e("div",ps,[e("div",vs,[e("div",{class:"bg-gradient-to-r from-sky-300 to-sky-600 animate-pulse h-2 rounded-full transition-all duration-300",style:Ve({width:`${Math.floor(d.progress)}%`})},null,4)]),e("p",gs,x(Math.floor(d.progress))+"% complete",1)]),t(r)?(p(),y("div",ys,i[2]||(i[2]=[e("div",{class:"flex"},[e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])]),e("div",{class:"ml-3"},[e("p",{class:"text-sm text-yellow-800"}," Syncing is taking longer than expected. This may indicate a network issue or heavy server load. ")])],-1)]))):E("",!0),e("div",xs,[e("button",{onClick:i[0]||(i[0]=b=>d.$emit("cancel")),class:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-0 focus:ring-offset-0 focus:ring-sky-500"}," Cancel ")])])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),bs={class:"space-y-6"},_s={class:"border-b border-gray-200"},ws={class:"-mb-px flex space-x-8","aria-label":"test-catalog-sync-tabs"},ks=["onClick"],Cs={class:"py-4"},Ss={key:0,class:"space-y-6"},$s={class:"bg-white border border-gray-200 rounded-lg"},Ts={key:0,class:"px-6 py-4"},Vs={class:"flex items-center justify-between"},Ds={class:"flex items-center space-x-4"},Ps={class:"text-sm font-medium text-gray-900"},Is={class:"text-sm text-gray-500"},Ns={key:0,class:"mt-4 grid grid-cols-2 md:grid-cols-4 gap-4"},Ms={class:"text-center p-4 bg-gray-50 rounded-lg"},As={class:"text-2xl font-semibold text-gray-900"},Fs={class:"text-center p-4 bg-gray-50 rounded-lg"},js={class:"text-2xl font-semibold text-gray-900"},Os={class:"text-center p-4 bg-gray-50 rounded-lg"},Hs={class:"text-2xl font-semibold text-gray-900"},Es={class:"text-center p-4 bg-gray-50 rounded-lg"},Us={class:"text-2xl font-semibold text-gray-900"},qs={key:1,class:"px-6 py-4 flex flex-col items-center justify-center space-y-2"},Ls={key:2,class:"px-6 py-4 flex flex-col items-center justify-center space-y-2"},Rs={class:"bg-white border border-gray-200 rounded-lg"},zs={key:0,class:"px-6 py-8"},Bs={class:"flex flex-col items-center justify-center"},Zs={key:1,class:"px-6 py-8"},Ys={key:2,class:"divide-y divide-gray-200"},Gs={class:"flex items-center justify-between"},Ks={class:"flex items-center space-x-4"},Xs={class:"flex-shrink-0"},Js={class:"text-sm font-medium text-gray-900"},Ws={class:"text-sm text-gray-500"},Qs={class:"flex items-center space-x-3"},eo=["onClick","disabled"],to={key:1,class:"space-y-6"},so={class:"bg-white border border-gray-200 rounded-lg"},oo={class:"px-6 py-4 border-b border-gray-200"},ao={class:"flex items-center justify-between"},no=["disabled"],lo={key:0,class:"px-6 py-4"},ro={class:"flex items-center justify-between"},io={class:"flex items-center space-x-4"},co={class:"flex-shrink-0"},uo={class:"text-sm font-medium text-gray-900"},fo={class:"text-sm text-gray-500"},mo={class:"flex items-center space-x-2"},po={key:1,class:"px-6 py-4"},vo={class:"bg-white border border-gray-200 rounded-lg"},go={class:"px-6 py-4 space-y-4"},yo={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},xo={class:"p-4 border border-gray-200 rounded-lg"},ho={class:"flex items-center justify-between mb-3"},bo=["disabled"],_o={class:"text-xs text-gray-500"},wo={class:"p-4 border border-gray-200 rounded-lg"},ko={class:"flex items-center justify-between mb-3"},Co=["disabled"],So={class:"text-xs text-gray-500"},$o={class:"p-4 border border-gray-200 rounded-lg"},To={class:"flex items-center justify-between mb-3"},Vo=["disabled"],Do={class:"text-xs text-gray-500"},Po={class:"p-4 border border-gray-200 rounded-lg"},Io={class:"flex items-center justify-between mb-3"},No=["disabled"],Mo={class:"text-xs text-gray-500"},Ao={class:"p-4 border border-gray-200 rounded-lg"},Fo={class:"flex items-center justify-between mb-3"},jo=["disabled"],Oo={class:"text-xs text-gray-500"},Ho=X({__name:"Management",setup(F){const a=[{id:"versions",name:"Versions"},{id:"sync",name:"Sync"}],v=h(0),{$toast:r}=B(),f=h(!1),d=h(!1),i=h(null),u=h([]),b=h(""),k=h(!1),V=he(()=>!u.value||u.value.length===0?!0:!u.value.some(_=>_.status==="available")),c=h(null),w=h({organisms:null,specimens:null,drugs:null,testTypes:null,labTestSites:null}),P=h(!1),j=h(!1),$=h(0),C=h(""),n=h(""),{executeCancellableRequest:s,cancelRequest:T}=Fe(),m=_=>xe(_).format("MMM DD, YYYY HH:mm"),M=async _=>{k.value=!0;try{const o={route:`${H.checkTestCatalogVersion}?version=${_.version}`,method:"GET"},{data:A,error:O}=await U(o);A.value&&A.value!==null?(i.value={..._,status:"active"},u.value=u.value.map(g=>({...g,status:g.id===_.id?"active":g.status==="active"?"available":g.status})),r.success(`Version ${_.version} activated successfully!`)):(console.error("Failed to activate version: No data received"),r.error("Failed to activate version: No data received from server")),O.value&&(console.error("Failed to activate version:",O.value),r.error("Failed to activate version. Please try again."))}finally{k.value=!1}},N=async()=>{if(!b.value){r.error("No available versions for sync");return}n.value="full",await me()},I=async _=>{if(!b.value){r.error("No available versions for sync");return}n.value=_,await me()},z=async()=>{d.value=!0,c.value={status:"checking",timestamp:new Date().toISOString(),message:"Checking for updates..."};try{const _={route:H.checkTestCatalogVersion,method:"GET"},{data:o,error:A}=await U(_);if(A.value)throw new Error(A.value.message||"Request failed");if(!o.value)throw new Error("No data received from server");o.value.is_new_version_available?(r.info(`New version available: ${o.value.version}`),b.value=o.value.version,c.value={status:"success",timestamp:new Date().toISOString(),message:`New version ${o.value.version} available`}):(r.info("No new versions available, please try again later!"),c.value={status:"success",timestamp:new Date().toISOString(),message:"You are using the latest version"})}catch(_){console.error("Failed to check for updates:",_),c.value={status:"error",timestamp:new Date().toISOString(),message:_ instanceof Error?_.message:"Failed to check for updates"},r.error(c.value.message)}finally{d.value=!1}},K=async()=>{f.value=!0;try{const _={route:H.testCatalogVersions,method:"GET"},{data:o,error:A}=await U(_);if(o.value&&o.value!==null){const O=o.value;if(u.value=O.map(g=>({...g,status:"available"})),O.length>0){const g=O.reduce((q,le)=>new Date(le.created_date)>new Date(q.created_date)?le:q);i.value={...g,status:"active"},u.value=u.value.map(q=>({...q,status:q.id===g.id?"active":"available"}))}}else console.error("Failed to fetch versions: No data received"),r.error("Failed to load test catalog versions: No data received");A.value&&(console.error("Failed to fetch versions:",A.value),r.error("Failed to load test catalog versions"))}finally{f.value=!1}},ke=_=>{var O;const o=n.value==="full"?"test catalog":Ce(n.value);return((O=[{threshold:20,status:"Connecting to NLIMS..."},{threshold:40,status:`Fetching ${o} data...`},{threshold:60,status:"Processing data..."},{threshold:80,status:"Updating local database..."},{threshold:1/0,status:"Finalizing sync..."}].find(g=>_<g.threshold))==null?void 0:O.status)||"Finalizing sync..."},Ce=_=>({organisms:"organisms",specimens:"specimens",drugs:"drugs",test_types:"test types",lab_test_sites:"lab test sites"})[_]||_,me=async()=>{P.value=!0,j.value=!0,$.value=0,C.value="Initializing sync...";let _=null;try{_=we(()=>{$.value<90&&($.value+=Math.random()*10,C.value=ke($.value))},500);const o={route:H.syncTestCatalog,method:"POST",body:n.value==="full"?{version:b.value,sections:""}:{version:b.value,sections:n.value}},{error:A,data:O}=await s(o);if(_&&clearInterval(_),O.value&&O.value!==null)$.value=100,C.value="Sync completed successfully!",r.success("Test catalog synced successfully!"),c.value={status:"success",timestamp:new Date().toISOString(),message:"Sync completed successfully"};else{if($.value=0,C.value="Sync failed - No data received",console.error("Sync failed: No data received from server"),r.error("Sync failed: No data received from server"),c.value={status:"error",timestamp:new Date().toISOString(),message:"Sync failed: No data received"},n.value==="full"){const g=new Date().toISOString();w.value={organisms:g,specimens:g,drugs:g,testTypes:g,labTestSites:g}}else{const q={organisms:"organisms",specimens:"specimens",drugs:"drugs",test_types:"testTypes",lab_test_sites:"labTestSites"}[n.value];q&&(w.value[q]=new Date().toISOString())}await K()}A.value&&(_&&clearInterval(_),$.value=0,C.value="Sync failed",console.error(A.value),r.error("Sync failed. Please try again."),c.value={status:"error",timestamp:new Date().toISOString(),message:"Sync failed"})}catch(o){_&&clearInterval(_),$.value=0,C.value="Sync failed",console.error("Sync error:",o),o instanceof Error&&o.name==="AbortError"?(r.warning("Sync cancelled"),c.value={status:"error",timestamp:new Date().toISOString(),message:"Sync cancelled"}):(r.error("Sync failed. Please try again."),c.value={status:"error",timestamp:new Date().toISOString(),message:"Sync failed"})}finally{setTimeout(()=>{j.value=!1,P.value=!1,$.value=0,C.value=""},2e3)}},Se=()=>{T(),P.value=!1,j.value=!1,$.value=0,C.value="",c.value={status:"error",timestamp:new Date().toISOString(),message:"Sync cancelled by user"}};return ee(async()=>{await K(),c.value||(c.value={status:"success",timestamp:new Date().toISOString(),message:"Ready to sync"})}),(_,o)=>{const A=ne,O=hs;return p(),y("div",bs,[o[25]||(o[25]=e("div",{class:"flex items-center justify-between"},[e("div",null,[e("h3",{class:"text-lg font-medium text-gray-900"}," Test Catalog Management "),e("p",{class:"text-sm text-gray-500"},[L(" Manage test catalog versions and synchronization with "),e("b",null,"National LIMS")])])],-1)),e("div",_s,[e("nav",ws,[(p(),y(Y,null,G(a,(g,q)=>e("button",{key:g.id,onClick:le=>v.value=q,class:R([t(v)===q?"border-sky-500 text-sky-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},x(g.name),11,ks)),64))])]),e("div",Cs,[t(v)===0?(p(),y("div",Ss,[e("div",$s,[o[13]||(o[13]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h4",{class:"text-lg font-medium text-gray-900"},"Current Version"),e("p",{class:"text-sm text-gray-500"}," Currently active test catalog version ")],-1)),t(i)?(p(),y("div",Ts,[e("div",Vs,[e("div",Ds,[o[5]||(o[5]=e("div",{class:"flex-shrink-0"},[e("div",{class:"w-3 h-3 bg-green-500 rounded-full"})],-1)),e("div",null,[e("p",Ps," Version "+x(t(i).version),1),e("p",Is," Created: "+x(m(t(i).created_date)),1)])]),o[6]||(o[6]=e("div",{class:"flex items-center space-x-2"},[e("span",{class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-600 border border-green-200"}," Active ")],-1))]),t(i).stats?(p(),y("div",Ns,[e("div",Ms,[e("p",As,x(t(i).stats.organisms),1),o[7]||(o[7]=e("p",{class:"text-sm text-gray-500"},"Organisms",-1))]),e("div",Fs,[e("p",js,x(t(i).stats.specimens),1),o[8]||(o[8]=e("p",{class:"text-sm text-gray-500"},"Specimens",-1))]),e("div",Os,[e("p",Hs,x(t(i).stats.drugs),1),o[9]||(o[9]=e("p",{class:"text-sm text-gray-500"},"Drugs",-1))]),e("div",Es,[e("p",Us,x(t(i).stats.testTypes),1),o[10]||(o[10]=e("p",{class:"text-sm text-gray-500"},"Test Types",-1))])])):E("",!0)])):t(f)?(p(),y("div",qs,[l(A,{height:80,width:80}),o[11]||(o[11]=e("p",{class:"text-sm text-gray-500"},"Loading version information...",-1))])):(p(),y("div",Ls,o[12]||(o[12]=[e("div",{class:"flex items-center justify-center p-4 bg-gray-50 rounded-lg w-full"},[e("p",{class:"text-sm text-gray-500"},"No current version available")],-1)])))]),e("div",Rs,[o[16]||(o[16]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h4",{class:"text-lg font-medium text-gray-900"}," Available Versions "),e("p",{class:"text-sm text-gray-500"}," Test catalog versions available for activation ")],-1)),t(f)?(p(),y("div",zs,[e("div",Bs,[l(A,{height:80,width:80}),o[14]||(o[14]=e("span",{class:"ml-2 text-sm text-gray-500"},"Loading versions...",-1))])])):t(u).length===0?(p(),y("div",Zs,o[15]||(o[15]=[e("p",{class:"text-center text-sm text-gray-500"}," No versions available ",-1)]))):(p(),y("div",Ys,[(p(!0),y(Y,null,G(t(u),g=>(p(),y("div",{key:g.id,class:"px-6 py-4 hover:bg-gray-50"},[e("div",Gs,[e("div",Ks,[e("div",Xs,[e("div",{class:R(["w-3 h-3 rounded-full",g.status==="active"?"bg-green-500":g.status==="available"?"bg-sky-500":"bg-gray-400"])},null,2)]),e("div",null,[e("p",Js," Version "+x(g.version),1),e("p",Ws," Created: "+x(m(g.created_date)),1)])]),e("div",Qs,[e("span",{class:R(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",g.status==="active"?"bg-green-100 text-green-800":g.status==="available"?"bg-sky-100 text-sky-800":"bg-gray-100 text-gray-800"])},x(g.status==="active"?"Active":g.status==="available"?"Available":"Draft"),3),g.status==="available"?(p(),y("button",{key:0,onClick:q=>M(g),disabled:t(k),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-sky-500 hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"},[t(k)?(p(),W(t(je),{key:0,class:"animate-spin -ml-1 mr-1 h-3 w-3"})):E("",!0),L(" "+x(t(k)?"Activating...":"Activate"),1)],8,eo)):E("",!0)])])]))),128))]))])])):E("",!0),t(v)===1?(p(),y("div",to,[e("div",so,[e("div",oo,[e("div",ao,[o[17]||(o[17]=e("div",null,[e("h4",{class:"text-lg font-medium text-gray-900"},"Sync Status"),e("p",{class:"text-sm text-gray-500"},[L(" Current synchronization status with "),e("b",null,"National LIMS")])],-1)),e("button",{onClick:z,disabled:t(d),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"},[t(d)?(p(),W(A,{key:0,class:"-ml-1 mr-2",height:5,width:5,color:"rgb(3 105 161 / 1)"})):E("",!0),L(" "+x(t(d)?"Checking...":"Check for Updates"),1)],8,no)])]),t(c)?(p(),y("div",lo,[e("div",ro,[e("div",io,[e("div",co,[e("div",{class:R(["w-4 h-4 rounded-full",t(c).status==="success"?"bg-green-500":t(c).status==="error"?"bg-red-500":t(c).status==="checking"?"bg-sky-500":"bg-yellow-500"])},null,2)]),e("div",null,[e("p",uo,x(t(c).status==="success"?"Successfully synced":t(c).status==="error"?"Sync failed":t(c).status==="checking"?"Checking for updates":"Sync in progress"),1),e("p",fo,x(t(c).message||`Last sync: ${m(t(c).timestamp)}`),1)])]),e("div",mo,[e("button",{onClick:N,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded text-white bg-sky-500 hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"},[t(P)?(p(),W(A,{key:0,class:"-ml-1 mr-2",height:5,width:5,color:"white"})):E("",!0),L(" "+x(t(P)?"Syncing...":"Start Full Sync"),1)])])])])):(p(),y("div",po,o[18]||(o[18]=[e("p",{class:"text-sm text-gray-500"},"Loading sync status...",-1)])))]),e("div",vo,[o[24]||(o[24]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h4",{class:"text-lg font-medium text-gray-900"},"Sync Actions"),e("p",{class:"text-sm text-gray-500"}," Synchronize test catalog data with NLIMS ")],-1)),e("div",go,[e("div",yo,[e("div",xo,[e("div",ho,[o[19]||(o[19]=e("h5",{class:"text-sm font-medium text-gray-900"},"Organisms",-1)),e("button",{onClick:o[0]||(o[0]=g=>I("organisms")),disabled:t(P)||t(V),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"}," Sync ",8,bo)]),e("p",_o," Last synced: "+x(t(w).organisms?m(t(w).organisms):"Never"),1)]),e("div",wo,[e("div",ko,[o[20]||(o[20]=e("h5",{class:"text-sm font-medium text-gray-900"},"Specimens",-1)),e("button",{onClick:o[1]||(o[1]=g=>I("specimens")),disabled:t(P)||t(V),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"}," Sync ",8,Co)]),e("p",So," Last synced: "+x(t(w).specimens?m(t(w).specimens):"Never"),1)]),e("div",$o,[e("div",To,[o[21]||(o[21]=e("h5",{class:"text-sm font-medium text-gray-900"},"Drugs",-1)),e("button",{onClick:o[2]||(o[2]=g=>I("drugs")),disabled:t(P)||t(V),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"}," Sync ",8,Vo)]),e("p",Do," Last synced: "+x(t(w).drugs?m(t(w).drugs):"Never"),1)]),e("div",Po,[e("div",Io,[o[22]||(o[22]=e("h5",{class:"text-sm font-medium text-gray-900"},"Test Types",-1)),e("button",{onClick:o[3]||(o[3]=g=>I("test_types")),disabled:t(P)||t(V),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"}," Sync ",8,No)]),e("p",Mo," Last synced: "+x(t(w).testTypes?m(t(w).testTypes):"Never"),1)]),e("div",Ao,[e("div",Fo,[o[23]||(o[23]=e("h5",{class:"text-sm font-medium text-gray-900"}," Lab Test Sites ",-1)),e("button",{onClick:o[4]||(o[4]=g=>I("lab_test_sites")),disabled:t(P)||t(V),class:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-sky-700 bg-sky-100 hover:bg-sky-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 disabled:opacity-50"}," Sync ",8,jo)]),e("p",Oo," Last synced: "+x(t(w).labTestSites?m(t(w).labTestSites):"Never"),1)])])])])])):E("",!0)]),l(O,{show:t(j),progress:t($),status:t(C),"sync-type":t(n),onCancel:Se},null,8,["show","progress","status","sync-type"])])}}}),Eo={class:"px-5 py-5"},Uo={class:"font-medium text-center text-gray-500 bg-gray-50"},qo={class:"flex flex-wrap -mb-px"},Lo=["onClick"],Ro={class:"py-5"},aa=X({__name:"index",setup(F){Oe({title:`${$e.name.toUpperCase()} - Configuration`});const a=De(),{can:v}=_e(),r=h(["Facility","Printers","Preferences","Test Catalog"]),f=he(()=>v.manage("lab_configurations")?r.value:[r.value[2]]),d={0:et,1:Et,2:ls,3:Ho},i=h(v.manage("lab_configurations")?0:2),u=k=>{i.value===0&&k&&console.log("Facility updated successfully")},b={printers:1,preferences:2,"test-catalog":3};return ee(()=>{const k=a.query.tab;k&&b[k]!==void 0&&(i.value=b[k])}),(k,V)=>(p(),y("div",Eo,[V[0]||(V[0]=Z('<div class="mb-4"><div class="flex items-center"><img src="'+He+'" class="w-16 h-16 mr-3" alt="desktop-app-icon"><div><h2 class="text-2xl font-semibold text-gray-900">IBLIS Configuration</h2><p class="text-sm text-gray-500 mt-1">Manage facility details, printers, and system preferences</p></div></div></div>',1)),e("div",Uo,[e("ul",qo,[(p(!0),y(Y,null,G(t(f),(c,w)=>(p(),y("li",{onClick:P=>i.value=w,class:"mr-2",key:w},[e("a",{href:"#",class:R(t(i)==w?"inline-block py-2 px-4 text-white bg-sky-500 active dark:text-sky-500 dark:border-sky-500":"inline-block p-2 border-b-2 border-transparent rounded-t-lg hover:text-sky-500 hover:border-sky-500")},x(c),3)],8,Lo))),128))])]),e("div",Ro,[d[t(i)]?(p(),W(Pe(d[t(i)]),{key:0,onUpdate:u},null,32)):E("",!0)])]))}});export{aa as default};
