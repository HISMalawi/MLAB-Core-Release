import{_ as qt}from"./D2iAdfOK.js";import{d as fe,r as k,c as K,b3 as Re,a8 as f,bv as qe,b9 as ce,b7 as at,b8 as Vt,ba as ye,bw as Et,bx as Ft,aH as Ve,by as Ot,b4 as Bt,b5 as Ht,b6 as Ut,a9 as se,ad as Ee,F as le,a6 as de,o as Fe,av as it,bz as ct,aa as Le,ac as Ae,bA as ne,be as J,bb as Nt,bc as nt,a7 as Oe,af as oe,bB as ee,bC as Me,b as S,e as q,g as t,f as d,z as D,h as m,j as te,U as zt,H as be,_ as ve,q as xe,x as Ce,y as j,t as P,i as Be,v as He,N as ut,S as Ue,p as Ne,Y as ze,G as Ze,V as Ge,B as Ye,a as ke,l as G,m as Y,u as W,E as me,bD as Zt,bE as Gt,bF as Yt,C as ie,A as dt,s as pt,bG as mt,M as Xt,bH as lt,a5 as we,a_ as Kt,K as X,bI as Wt,a4 as ft,O as rt,Z as Qt,L as Q,k as ge,n as Jt,bJ as es,ai as ts,w as De,aB as ss,bK as os}from"./CpqwsBCr.js";import{_ as ns}from"./Br9vj_ue.js";import{_ as ls}from"./DZ2v71Rq.js";import{s as rs}from"./B_QPvgsy.js";import{_ as as}from"./BBzQqOzR.js";import{_ as is}from"./CYtyQhEY.js";import{_ as vt}from"./BeBt5uam.js";import{u as Xe}from"./CBnClnGu.js";import{r as ht}from"./pZMJ6Qi7.js";import{r as _t}from"./DgbeGPrl.js";import{r as bt}from"./C0WmLC-R.js";import{u as pe}from"./Dkj5C81l.js";import{r as je}from"./BqzVtKbV.js";import{_ as cs}from"./DFbPGSN_.js";import{u as us}from"./3Owfe8OW.js";import{P as ds}from"./CejigzqB.js";import{r as ps}from"./Db8h4FWL.js";import{r as ms}from"./CnwrY77L.js";import{r as fs}from"./Bp9TMy1J.js";import{r as vs,a as hs}from"./DWVEDoWf.js";import{r as Ie}from"./CoNHojaV.js";import"./C1gcPR4j.js";import"./DicwA20n.js";import"./CKPCLqUK.js";import"./DS4aECqC.js";import"./C6ZEX6BQ.js";import"./BDG2LYcH.js";import"./CLDpmtkZ.js";import"./BK-u_zKT.js";import"./CX_spC93.js";var _s=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(_s||{});let gt=Symbol("PopoverContext");function Ke(l){let e=Oe(gt,null);if(e===null){let o=new Error(`<${l} /> is missing a parent <${xt.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(o,Ke),o}return e}let bs=Symbol("PopoverGroupContext");function yt(){return Oe(bs,null)}let wt=Symbol("PopoverPanelContext");function gs(){return Oe(wt,null)}let xt=fe({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(l,{slots:e,attrs:o,expose:v}){var s;let u=k(null);v({el:u,$el:u});let c=k(1),r=k(null),$=k(null),g=k(null),h=k(null),x=K(()=>Re(u)),V=K(()=>{var i,b;if(!f(r)||!f(h))return!1;for(let B of document.querySelectorAll("body > *"))if(Number(B==null?void 0:B.contains(f(r)))^Number(B==null?void 0:B.contains(f(h))))return!0;let _=qe(),R=_.indexOf(f(r)),Z=(R+_.length-1)%_.length,O=(R+1)%_.length,re=_[Z],Se=_[O];return!((i=f(h))!=null&&i.contains(re))&&!((b=f(h))!=null&&b.contains(Se))}),M={popoverState:c,buttonId:k(null),panelId:k(null),panel:h,button:r,isPortalled:V,beforePanelSentinel:$,afterPanelSentinel:g,togglePopover(){c.value=ce(c.value,{0:1,1:0})},closePopover(){c.value!==1&&(c.value=1)},close(i){M.closePopover();let b=i?i instanceof HTMLElement?i:i.value instanceof HTMLElement?f(i):f(M.button):f(M.button);b==null||b.focus()}};at(gt,M),Vt(K(()=>ce(c.value,{0:ye.Open,1:ye.Closed})));let z={buttonId:M.buttonId,panelId:M.panelId,close(){M.closePopover()}},E=yt(),T=E==null?void 0:E.registerPopover,[C,I]=Et(),L=Ft({mainTreeNodeRef:E==null?void 0:E.mainTreeNodeRef,portals:C,defaultContainers:[r,h]});function y(){var i,b,_,R;return(R=E==null?void 0:E.isFocusWithinPopoverGroup())!=null?R:((i=x.value)==null?void 0:i.activeElement)&&(((b=f(r))==null?void 0:b.contains(x.value.activeElement))||((_=f(h))==null?void 0:_.contains(x.value.activeElement)))}return Ve(()=>T==null?void 0:T(z)),Ot((s=x.value)==null?void 0:s.defaultView,"focus",i=>{var b,_;i.target!==window&&i.target instanceof HTMLElement&&c.value===0&&(y()||r&&h&&(L.contains(i.target)||(b=f(M.beforePanelSentinel))!=null&&b.contains(i.target)||(_=f(M.afterPanelSentinel))!=null&&_.contains(i.target)||M.closePopover()))},!0),Bt(L.resolveContainers,(i,b)=>{var _;M.closePopover(),Ht(b,Ut.Loose)||(i.preventDefault(),(_=f(r))==null||_.focus())},K(()=>c.value===0)),()=>{let i={open:c.value===0,close:M.close};return se(le,[se(I,{},()=>Ee({theirProps:{...l,...o},ourProps:{ref:u},slot:i,slots:e,attrs:o,name:"Popover"})),se(L.MainTreeNode)])}}}),ys=fe({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(l,{attrs:e,slots:o,expose:v}){var s;let u=(s=l.id)!=null?s:`headlessui-popover-button-${de()}`,c=Ke("PopoverButton"),r=K(()=>Re(c.button));v({el:c.button,$el:c.button}),Fe(()=>{c.buttonId.value=u}),it(()=>{c.buttonId.value=null});let $=yt(),g=$==null?void 0:$.closeOthers,h=gs(),x=K(()=>h===null?!1:h.value===c.panelId.value),V=k(null),M=`headlessui-focus-sentinel-${de()}`;x.value||Ve(()=>{c.button.value=f(V)});let z=rs(K(()=>({as:l.as,type:e.type})),V);function E(i){var b,_,R,Z,O;if(x.value){if(c.popoverState.value===1)return;switch(i.key){case oe.Space:case oe.Enter:i.preventDefault(),(_=(b=i.target).click)==null||_.call(b),c.closePopover(),(R=f(c.button))==null||R.focus();break}}else switch(i.key){case oe.Space:case oe.Enter:i.preventDefault(),i.stopPropagation(),c.popoverState.value===1&&(g==null||g(c.buttonId.value)),c.togglePopover();break;case oe.Escape:if(c.popoverState.value!==0)return g==null?void 0:g(c.buttonId.value);if(!f(c.button)||(Z=r.value)!=null&&Z.activeElement&&!((O=f(c.button))!=null&&O.contains(r.value.activeElement)))return;i.preventDefault(),i.stopPropagation(),c.closePopover();break}}function T(i){x.value||i.key===oe.Space&&i.preventDefault()}function C(i){var b,_;l.disabled||(x.value?(c.closePopover(),(b=f(c.button))==null||b.focus()):(i.preventDefault(),i.stopPropagation(),c.popoverState.value===1&&(g==null||g(c.buttonId.value)),c.togglePopover(),(_=f(c.button))==null||_.focus()))}function I(i){i.preventDefault(),i.stopPropagation()}let L=ct();function y(){let i=f(c.panel);if(!i)return;function b(){ce(L.value,{[ee.Forwards]:()=>ne(i,J.First),[ee.Backwards]:()=>ne(i,J.Last)})===Me.Error&&ne(qe().filter(_=>_.dataset.headlessuiFocusGuard!=="true"),ce(L.value,{[ee.Forwards]:J.Next,[ee.Backwards]:J.Previous}),{relativeTo:f(c.button)})}b()}return()=>{let i=c.popoverState.value===0,b={open:i},{..._}=l,R=x.value?{ref:V,type:z.value,onKeydown:E,onClick:C}:{ref:V,id:u,type:z.value,"aria-expanded":c.popoverState.value===0,"aria-controls":f(c.panel)?c.panelId.value:void 0,disabled:l.disabled?!0:void 0,onKeydown:E,onKeyup:T,onClick:C,onMousedown:I};return se(le,[Ee({ourProps:R,theirProps:{...e,..._},slot:b,attrs:e,slots:o,name:"PopoverButton"}),i&&!x.value&&c.isPortalled.value&&se(Le,{id:M,features:Ae.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:y})])}}}),ws=fe({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(l,{attrs:e,slots:o,expose:v}){var s;let u=(s=l.id)!=null?s:`headlessui-popover-panel-${de()}`,{focus:c}=l,r=Ke("PopoverPanel"),$=K(()=>Re(r.panel)),g=`headlessui-focus-sentinel-before-${de()}`,h=`headlessui-focus-sentinel-after-${de()}`;v({el:r.panel,$el:r.panel}),Fe(()=>{r.panelId.value=u}),it(()=>{r.panelId.value=null}),at(wt,r.panelId),Ve(()=>{var I,L;if(!c||r.popoverState.value!==0||!r.panel)return;let y=(I=$.value)==null?void 0:I.activeElement;(L=f(r.panel))!=null&&L.contains(y)||ne(f(r.panel),J.First)});let x=Nt(),V=K(()=>x!==null?(x.value&ye.Open)===ye.Open:r.popoverState.value===0);function M(I){var L,y;switch(I.key){case oe.Escape:if(r.popoverState.value!==0||!f(r.panel)||$.value&&!((L=f(r.panel))!=null&&L.contains($.value.activeElement)))return;I.preventDefault(),I.stopPropagation(),r.closePopover(),(y=f(r.button))==null||y.focus();break}}function z(I){var L,y,i,b,_;let R=I.relatedTarget;R&&f(r.panel)&&((L=f(r.panel))!=null&&L.contains(R)||(r.closePopover(),((i=(y=f(r.beforePanelSentinel))==null?void 0:y.contains)!=null&&i.call(y,R)||(_=(b=f(r.afterPanelSentinel))==null?void 0:b.contains)!=null&&_.call(b,R))&&R.focus({preventScroll:!0})))}let E=ct();function T(){let I=f(r.panel);if(!I)return;function L(){ce(E.value,{[ee.Forwards]:()=>{var y;ne(I,J.First)===Me.Error&&((y=f(r.afterPanelSentinel))==null||y.focus())},[ee.Backwards]:()=>{var y;(y=f(r.button))==null||y.focus({preventScroll:!0})}})}L()}function C(){let I=f(r.panel);if(!I)return;function L(){ce(E.value,{[ee.Forwards]:()=>{let y=f(r.button),i=f(r.panel);if(!y)return;let b=qe(),_=b.indexOf(y),R=b.slice(0,_+1),Z=[...b.slice(_+1),...R];for(let O of Z.slice())if(O.dataset.headlessuiFocusGuard==="true"||i!=null&&i.contains(O)){let re=Z.indexOf(O);re!==-1&&Z.splice(re,1)}ne(Z,J.First,{sorted:!1})},[ee.Backwards]:()=>{var y;ne(I,J.Previous)===Me.Error&&((y=f(r.button))==null||y.focus())}})}L()}return()=>{let I={open:r.popoverState.value===0,close:r.close},{focus:L,...y}=l,i={ref:r.panel,id:u,onKeydown:M,onFocusout:c&&r.popoverState.value===0?z:void 0,tabIndex:-1};return Ee({ourProps:i,theirProps:{...e,...y},attrs:e,slot:I,slots:{...o,default:(...b)=>{var _;return[se(le,[V.value&&r.isPortalled.value&&se(Le,{id:g,ref:r.beforePanelSentinel,features:Ae.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:T}),(_=o.default)==null?void 0:_.call(o,...b),V.value&&r.isPortalled.value&&se(Le,{id:h,ref:r.afterPanelSentinel,features:Ae.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:C})])]}},features:nt.RenderStrategy|nt.Static,visible:V.value,name:"PopoverPanel"})}}});function xs(l,e){return S(),q("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 0 1 1.06 0l6 6a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l4.72-4.72H9a5.25 5.25 0 1 0 0 10.5h3a.75.75 0 0 1 0 1.5H9a6.75 6.75 0 0 1 0-13.5h10.19l-4.72-4.72a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Cs(l,e){return S(),q("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z","clip-rule":"evenodd"})])}const ks={class:"px-5 py-3"},Ss={class:"flex items-end justify-end space-x-2 border-t px-4 py-2"},Ts=fe({__name:"FilterWards",props:{wards:{type:Array,required:!0}},emits:["update:items-selected"],setup(l,{emit:e}){const o=e,v=l,s=K(()=>v.wards.map(r=>r.name)),u=k([]),c=r=>{o("update:items-selected",u.value),r()};return(r,$)=>{const g=ls,h=ve;return S(),q("div",null,[d(m(xt),{class:"relative"},{default:D(({close:x})=>[d(m(ys),{class:"bg-gray-50 text-zinc-500 flex items-center space-x-2 rounded border px-2 py-1.5"},{default:D(()=>$[1]||($[1]=[t("svg",{class:"mr-2",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 48 48"},[t("path",{fill:"currentColor","fill-rule":"evenodd",d:"M29 6v2c0 1.306.835 2.418 2 2.83V12h-1a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1h-1v-1h5v12.066H20.11a.3.3 0 0 1-.218-.09l-.366-.37l.369-.367a3.77 3.77 0 0 0 .001-5.333l-1.8-1.8a3.77 3.77 0 0 0-5.333-.003l-.704.704a3.95 3.95 0 0 0-3.892 1.021a4.034 4.034 0 0 0 0 5.676l.833.839V34H6v2h3.05a3.5 3.5 0 1 0 4.899 0h20.102a3.5 3.5 0 1 0 4.899 0H42v-2h-4v-3h.066C40.24 31 42 29.224 42 27.033a3.97 3.97 0 0 0-2-3.455V11a2 2 0 0 0-2-2h-6a1 1 0 0 1-1-1V6zM13.826 16.868l4.29 4.32l.365-.364a1.77 1.77 0 0 0 0-2.504l-1.8-1.8a1.77 1.77 0 0 0-2.504-.002zM36 34H11v-8.644l5.275 5.311c.212.213.498.333.797.333H36z","clip-rule":"evenodd"})],-1),te(" Filter By Wards ")])),_:1}),d(zt,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:D(()=>[d(m(ws),{class:"absolute z-10 mt-0 w-screen bg-white border shadow-2xl rounded max-w-2xl transform px-4 sm:px-0 lg:max-w-3xl"},{default:D(()=>[t("div",ks,[d(g,{placeholder:"click to select wards",label:"Select ward(s)",mode:"tags",items:m(s),"items-selected":m(u),"onUpdate:itemsSelected":$[0]||($[0]=V=>be(u)?u.value=V:null)},null,8,["items","items-selected"])]),t("div",Ss,[d(h,{text:"Apply",icon:m(xs),color:"primary",click:()=>{c(x)}},null,8,["icon","click"])])]),_:2},1024)]),_:2},1024)]),_:1})])}}}),$s={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:xe}},Ps={class:"text-sm"};function Ds(l,e,o,v,s,u){const c=j("XMarkIcon");return S(),q("div",{class:ut(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${o.color}-500`])},[t("p",Ps,P(o.value.value),1),Be(t("button",{onClick:e[0]||(e[0]=(...r)=>u.removeLabel&&u.removeLabel(...r)),class:"ml-2"},[d(c,{class:"w-4 h-4"})],512),[[He,o.close]])],2)}const Is=Ce($s,[["render",Ds]]),Ls={components:{TransitionRoot:Ue,TransitionChild:Ne,Dialog:ze,DialogPanel:Ze,DialogTitle:Ge,XMarkIcon:xe,UserIcon:ht},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:Ye,saveIcon:_t,clearIcon:bt,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:ke("token"),authStore:Xe(),departmentId:0}},methods:{async init(){this.handleClick();const l=this.authStore.department,e=this.authStore.user.departments.find(o=>o.name===l);e&&(this.departmentId=e.id),this.selectedDepartment=l,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(l){var u;const e=(u=this.item.client)!=null&&u.sex.match(/f/i)?"Female":"Male",o={route:`${G.specimenTestTypes}?department_id=${l}&specimen_id=${this.item.specimen_id}&sex=${e}`,method:"GET",token:`${this.cookie}`},{error:v,data:s}=await Y(o);s.value&&(this.rawTestTypes=s.value,this.testTypes=s.value),v.value&&console.error("error: ",v.value)},async submitForm(){this.loading=!0;let l=this.testTypesSelected.map(s=>({specimen:this.item.specimen_id,test_type:s}));const e={route:`${G.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:l}},{data:o,error:v}=await Y(e);o.value&&(this.handleClick(),W().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),v.value&&(this.handleClick(),console.error("error: ",v.value),W().$toast.error(me),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(l,e){if(l!==e){const o=this.authStore.user.departments.find(v=>v.name===l);o&&(this.departmentId=o.id,this.getTestTypes(this.departmentId))}}}},As={class:"fixed inset-0 overflow-y-auto"},Ms={class:"flex min-h-full items-center justify-center p-4 text-center"},js={class:"border-b px-3 py-3 flex items-center justify-between"},Rs={class:"mt-2 space-y-3 pb-40"},qs={class:"w-full flex flex-col space-y-2 px-5"},Vs={class:"w-full flex flex-col space-y-2 px-5"},Es={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Fs(l,e,o,v,s,u){const c=ve,r=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=j("multi-select"),x=vt,V=j("FormKit"),M=j("DialogPanel"),z=j("Dialog"),E=j("TransitionRoot");return S(),q("div",null,[t("div",null,[d(c,{text:"Add test to current order",color:"warning",icon:s.editIcon,click:u.init},null,8,["icon","click"])]),d(E,{appear:"",show:s.open,as:"template"},{default:D(()=>[d(z,{as:"div",onClose:u.handleClick,class:"relative z-10"},{default:D(()=>[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[3]||(e[3]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",As,[t("div",Ms,[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",js,[d($,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:D(()=>e[4]||(e[4]=[te(" Add Test To Current Order ")])),_:1}),t("button",{onClick:e[0]||(e[0]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),d(V,{type:"form","submit-label":"Update",onSubmit:u.submitForm,actions:!1,id:"submitForm"},{default:D(({value:T})=>[t("div",Rs,[t("div",qs,[e[5]||(e[5]=t("label",{class:"font-medium"},"Department",-1)),d(h,{style:{"--ms-max-height":"none !important"},modelValue:s.selectedDepartment,"onUpdate:modelValue":e[1]||(e[1]=C=>s.selectedDepartment=C),options:s.departments.map(C=>C.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",Vs,[e[6]||(e[6]=t("label",{class:"font-medium"},"Tests",-1)),d(h,{style:{"--ms-max-height":"none !important"},modelValue:s.testTypesSelected,"onUpdate:modelValue":e[2]||(e[2]=C=>s.testTypesSelected=C),options:s.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Es,[d(x,{type:"button",click:()=>u.resetForm(),text:"Clear form"},null,8,["click"]),d(c,{loading:s.loading,type:"submit",click:()=>{},color:"success",icon:s.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Os=Ce(Ls,[["render",Fs]]),Bs={components:{TransitionRoot:Ue,TransitionChild:Ne,Dialog:ze,DialogPanel:Ze,DialogTitle:Ge,XMarkIcon:xe,PhoneIcon:Zt,EnvelopeIcon:Gt,MapPinIcon:Yt},data(){return{moment:ie,viewIcon:dt,show:this.open,addIcon:pt,checkIcon:je,editIcon:Ye,acceptIcon:mt,printerIcon:Xt,cookie:ke("token"),authStore:Xe(),details:{},loading:!1,verifying:!1,zebraPrinting:!1}},props:{open:{type:Boolean,required:!1}},methods:{async init(l){this.loading=!0;const e={route:`${G.tests}/${l.id}`,method:"GET",token:`${this.cookie}`},{data:o,error:v,pending:s}=await Y(e);this.loading=s,o.value&&(this.details=o.value,typeof this.details=="object"&&this.handleClick()),v.value&&(this.loading=!1,console.error(v.value),W().$toast.error(me))},async printBBResults(){const l={route:G.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.details.order_id,tests:[this.details.id],is_cross_match:!0}},{data:e,error:o,pending:v}=await Y(l);if(this.zebraPrinting=v,e.value){this.zebraPrinting=!1;const s=new FileReader;s.onload=()=>{const u=URL.createObjectURL(e.value),c=document.createElement("a");c.href=u,c.setAttribute("download",`${Date.now()}.lbl`),c.click(),URL.revokeObjectURL(u)},s.readAsText(e.value),W().$toast.success("Results printed successfully!")}o.value&&(this.zebraPrinting=!1,W().$toast.error(me),console.error(o.value))},async changeStatus(l,e){this.verifying=!0;const o={route:`${G.testStatus}/${e}/${l}`,method:"PUT",token:`${this.cookie}`},{data:v,error:s,pending:u}=await Y(o);this.verifying=u,v.value&&(this.verifying=!1,W().$toast.success(`${this.details.test_type_name} test for ${this.details.client.first_name} ${this.details.client.middle_name!==null?this.details.client.middle_name:""} ${this.details.client.last_name} verified successfully!`),this.viewReport(!0)),s.value&&(console.error(s.value),this.verifying=!1)},updateChanges(){this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return lt.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return lt.printTrackingNumber(this.details.tracking_number)},viewReport(l=!1){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}&printer=${l}`)},getRequestedBy(l){let e="";return l.forEach(o=>{o.status.name==="pending"&&(e=`${o.initiator.first_name} ${o.initiator.last_name}`)}),we(e)},isRejectedOrVoided(l){return new Set(["voided","test-rejected","rejected","not-done"]).has(l.toLowerCase())},isCompletedByCurrentUserOrSuperAdmin(l){const e=this.authStore.user,o=l.completed_by;if(o){if(o.id!==e.id)return!0;if(o.is_super_admin===!0)return!0}return!1},getTurnAroundTime(l){const e=new Date(l.created_date),o=l.status_trail.find(x=>x.status.name.toLowerCase()==="verified");if(!o)return"In progress...";const s=new Date(o.created_date).getTime()-e.getTime(),u=Math.floor(s/1e3),c=Math.floor(u/(3600*24)),r=Math.floor(u%(3600*24)/3600),$=Math.floor(u%3600/60),g=u%60,h=[];return c>0&&h.push(`${c} day${c>1?"s":""}`),r>0&&h.push(`${r} hour${r>1?"s":""}`),$>0&&h.push(`${$} minute${$>1?"s":""}`),g>0&&h.push(`${g} second${g>1?"s":""}`),h.length>0?h.join(", "):"0 seconds"}}},Hs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27%2015V4H10C9.44772%204%209%204.44772%209%205V43C9%2043.5523%209.44772%2044%2010%2044H38C38.5523%2044%2039%2043.5523%2039%2043V16H28C27.4477%2016%2027%2015.5523%2027%2015ZM29%2014V4.58579L38.4142%2014H29ZM17%2019C17%2018.4477%2017.4477%2018%2018%2018H23C25.2091%2018%2027%2019.7909%2027%2022C27%2024.0759%2025.4186%2025.7825%2023.3948%2025.9808L27%2029.5859L30.2929%2026.293L31.7072%2027.7072L28.4142%2031.0001L31.7071%2034.293L30.2928%2035.7072L27%2032.4143L23.7072%2035.7072L22.2929%2034.293L25.5858%2031.0001L20.5857%2026H19V33H17V25V19ZM23%2024H19V20H23C24.1046%2020%2025%2020.8954%2025%2022C25%2023.1046%2024.1046%2024%2023%2024Z'%20fill='currentColor'/%3e%3c/svg%3e",Us="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M19%204C18.4477%204%2018%204.44772%2018%205V8C18%208.55228%2018.4477%209%2019%209H20V11.2729C19.4174%2011.4788%2019%2012.0344%2019%2012.6875V39C19%2041.7614%2021.2386%2044%2024%2044C26.7614%2044%2029%2041.7614%2029%2039V12.6875C29%2012.0344%2028.5826%2011.4788%2028%2011.2729V9H29C29.5523%209%2030%208.55228%2030%208V5C30%204.44772%2029.5523%204%2029%204H19ZM22%2011.6875V9H26V11.6875C26%2012.3406%2026.4174%2012.8962%2027%2013.1021V18H21V13.1021C21.5826%2012.8962%2022%2012.3406%2022%2011.6875Z'%20fill='currentColor'/%3e%3c/svg%3e",Ns="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M28.7526%206.3415C28.4782%206.02797%2028.0383%205.91736%2027.6483%206.0639C27.2583%206.21043%2027%206.58339%2027%207V14C27%2015.1046%2027.8954%2016%2029%2016H35C35.3924%2016%2035.7485%2015.7705%2035.9106%2015.4132C36.0728%2015.0559%2036.011%2014.6368%2035.7526%2014.3415L28.7526%206.3415ZM20.75%2023H19.25L20%2021.2L20.75%2023ZM27.5576%205L37%2015.3866V40C37%2041.6569%2035.6569%2043%2034%2043H14C12.3431%2043%2011%2041.6569%2011%2040V8C11%206.34315%2012.3431%205%2014%205H27.5576ZM21.8462%2015.2308C21.5356%2014.4855%2020.8074%2014%2020%2014C19.1926%2014%2018.4644%2014.4855%2018.1538%2015.2308L13.1538%2027.2308C12.729%2028.2504%2013.2112%2029.4213%2014.2308%2029.8462C15.2504%2030.271%2016.4213%2029.7888%2016.8462%2028.7692L17.5833%2027H22.4167L23.1538%2028.7692C23.5787%2029.7888%2024.7496%2030.271%2025.7692%2029.8462C26.7888%2029.4213%2027.271%2028.2504%2026.8462%2027.2308L26.7432%2026.9837C26.8273%2026.9944%2026.913%2027%2027%2027H28V28C28%2029.1046%2028.8954%2030%2030%2030C31.1046%2030%2032%2029.1046%2032%2028V27H33C34.1046%2027%2035%2026.1046%2035%2025C35%2023.8954%2034.1046%2023%2033%2023H32V22C32%2020.8954%2031.1046%2020%2030%2020C28.8954%2020%2028%2020.8954%2028%2022V23H27C26.3521%2023%2025.7762%2023.3081%2025.4107%2023.7857L21.8462%2015.2308ZM15%2031C13.8954%2031%2013%2031.8954%2013%2033C13%2034.1046%2013.8954%2035%2015%2035C13.8954%2035%2013%2035.8954%2013%2037C13%2038.1046%2013.8954%2039%2015%2039H27C28.1046%2039%2029%2038.1046%2029%2037C29%2035.8962%2028.1058%2035.0012%2027.0023%2035H33C34.1046%2035%2035%2034.1046%2035%2033C35%2031.8954%2034.1046%2031%2033%2031L15%2031Z'%20fill='currentColor'%20stroke='%23333333'%20stroke-width='2'%20stroke-linejoin='round'/%3e%3c/svg%3e",Ct="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M40%2024.0005C40%2027.3142%2037.3137%2030.0005%2034%2030.0005H32.566L27.7629%2024.9453C27.9142%2024.6638%2028%2024.3419%2028%2024C28%2022.8954%2027.1046%2022%2026%2022H24.9645L21.1644%2018.0005H34C37.3137%2018.0005%2040%2020.6868%2040%2024.0005ZM36%2023.9995C36%2023.1711%2035.3284%2022.4995%2034.5%2022.4995C33.6716%2022.4995%2033%2023.1711%2033%2023.9995C33%2024.8279%2033.6716%2025.4995%2034.5%2025.4995C35.3284%2025.4995%2036%2024.8279%2036%2023.9995ZM30.752%2023.25C31.1673%2023.25%2031.504%2023.5858%2031.504%2024C31.504%2024.4142%2031.1673%2024.75%2030.752%2024.75C30.3367%2024.75%2030%2024.4142%2030%2024C30%2023.5858%2030.3367%2023.25%2030.752%2023.25Z'%20fill='%23333333'/%3e%3cpath%20d='M12%2024C12%2022.8954%2012.8954%2022%2014%2022H16.6881L12.9715%2018.0883C10.1478%2018.5761%208%2021.0375%208%2024.0005C8%2027.3142%2010.6863%2030.0005%2014%2030.0005H24.2896L20.4886%2026H14C12.8954%2026%2012%2025.1046%2012%2024Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44%2024C44%2035.0457%2035.0457%2044%2024%2044C12.9543%2044%204%2035.0457%204%2024C4%2012.9543%2012.9543%204%2024%204C35.0457%204%2044%2012.9543%2044%2024ZM42%2024C42%2029.1085%2039.8719%2033.7199%2036.4539%2036.9962L11.6573%2010.8981C14.8798%207.86121%2019.2226%206%2024%206C33.9411%206%2042%2014.0589%2042%2024ZM24%2042C28.1125%2042%2031.9028%2040.6209%2034.9338%2038.2999L10.2781%2012.35C7.60984%2015.4897%206%2019.5569%206%2024C6%2033.9411%2014.0589%2042%2024%2042Z'%20fill='%23333333'/%3e%3c/svg%3e",zs={key:0},Zs={class:"fixed inset-0 overflow-y-auto"},Gs={class:"flex min-h-full items-center justify-center text-center"},Ys={class:"border-b px-3 py-3 flex items-center justify-between"},Xs={class:"flex items-center justify-center mx-auto my-20"},Ks={class:"grid grid-cols-3 gap-4 px-5 py-5"},Ws={class:"rounded border"},Qs={class:"w-full space-y-2 py-2"},Js={class:"w-full flex justify-between px-4 py-1"},eo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},to={class:"w-full flex justify-between px-4 py-1"},so={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},oo={class:"rounded border"},no={class:"w-full space-y-2 py-2"},lo={class:"w-full flex justify-between px-4 py-1"},ro={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ao={class:"w-full flex justify-between px-4 py-1"},io={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},co={class:"w-full flex justify-between px-4 py-1"},uo={class:"rounded border max-h-72 overflow-y-auto"},po={class:"w-full space-y-2 py-2"},mo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},fo={class:"w-full flex justify-between px-4 py-1"},vo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ho={class:"w-full flex justify-between px-4 py-1"},_o={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},bo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},go={class:"w-full flex justify-between px-4 py-1"},yo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},wo={class:"mx-5 rounded border mb-5"},xo={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},Co={class:"justify-end flex items-center space-x-3"},ko={key:0},So={class:"flex items-center space-x-1"},To=["innerHTML"],$o={key:1,class:"text-xs"},Po={key:1,class:"px-4 py-2 flex items-center"},Do={class:"text-lg font-semibold"},Io={class:"text-base text-gray-600 font-normal"},Lo={key:2,class:"px-2.5 py-2.5 border-t"};function Ao(l,e,o,v,s,u){const c=is,r=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=Jt,x=ve,V=Os,M=j("DialogPanel"),z=j("Dialog"),E=j("TransitionRoot");return S(),q("div",null,[Kt(l.$slots,"default",{onClick:e[0]||(e[0]=(...T)=>u.init&&u.init(...T))}),s.details!==null&&s.details.client!==void 0?(S(),q("div",zs,[d(c,{class:"hidden",ref:"corePrinter",orderId:`${s.details.order_id}`,id:`${s.details.client.id}`},null,8,["orderId","id"])])):X("",!0),d(E,{appear:"",show:s.show,as:"template"},{default:D(()=>[d(z,{as:"div",class:"relative z-10"},{default:D(()=>[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[2]||(e[2]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Zs,[t("div",Gs,[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",Ys,[d($,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:D(()=>e[3]||(e[3]=[t("img",{src:Hs,class:"w-8 h-8 mr-2"},null,-1),te(" View Test ")])),_:1}),t("button",{onClick:e[1]||(e[1]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),Be(t("div",Xs,[d(h,{loading:s.loading},null,8,["loading"])],512),[[He,s.loading]]),t("div",Ks,[t("div",Ws,[e[8]||(e[8]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[t("h3",{class:"text-lg font-semibold text-black flex items-center"},[t("img",{src:Wt,class:"w-7 h-7 mr-1"}),te(" Patient ")])],-1)),t("div",Qs,[t("div",Js,[e[4]||(e[4]=t("h3",{class:"font-semibold"},"Patient Number",-1)),t("p",null,P(s.details.client.id),1)]),t("div",eo,[e[5]||(e[5]=t("h3",{class:"font-semibold"},"Name",-1)),t("p",null,P(("capitalize"in l?l.capitalize:m(we))(`${s.details.client.first_name} ${s.details.client.middle_name!==null?s.details.client.middle_name:""} ${s.details.client.last_name}`)),1)]),t("div",to,[e[6]||(e[6]=t("h3",{class:"font-semibold"},"Sex",-1)),t("p",null,P(s.details.client.sex),1)]),t("div",so,[e[7]||(e[7]=t("h3",{class:"font-semibold"},"Age",-1)),t("p",null,P(("calculateAge"in l?l.calculateAge:m(ft))(s.details.client.date_of_birth)),1)])])]),t("div",oo,[e[14]||(e[14]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[t("h3",{class:"text-lg font-semibold text-black flex items-center"},[t("img",{src:Us,class:"w-7 h-7 mr-1"}),te(" Specimen ")])],-1)),t("div",no,[t("div",lo,[e[9]||(e[9]=t("h3",{class:"font-semibold"},"Specimen Type",-1)),t("p",null,P(s.details.specimen_type),1)]),t("div",ro,[e[10]||(e[10]=t("h3",{class:"font-semibold"},"Tracking Number",-1)),t("p",null,P(s.details.tracking_number),1)]),t("div",ao,[e[11]||(e[11]=t("h3",{class:"font-semibold"},"Accession Number",-1)),t("p",null,P(s.details.accession_number),1)]),t("div",io,[e[12]||(e[12]=t("h3",{class:"font-semibold"},"Status",-1)),t("p",null,P(("capitalize"in l?l.capitalize:m(we))(s.details.order_status.split("-").join(" "))),1)]),t("div",co,[e[13]||(e[13]=t("h3",{class:"font-semibold"},"Turn Around Time",-1)),t("p",null,P(u.getTurnAroundTime(s.details)),1)])])]),t("div",uo,[e[23]||(e[23]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[t("img",{src:Ns,class:"w-7 h-7 mr-1"}),t("h3",{class:"text-lg font-semibold text-black"},"Test")],-1)),t("div",po,[t("div",mo,[e[15]||(e[15]=t("h3",{class:"font-semibold"},"Name",-1)),t("p",null,P(s.details.test_type_name),1)]),t("div",fo,[e[16]||(e[16]=t("h3",{class:"font-semibold"},"Date Registered",-1)),t("p",null,P(s.moment(s.details.created_date).format("DATE_FORMAT"in l?l.DATE_FORMAT:m(rt))),1)]),t("div",vo,[e[17]||(e[17]=t("h3",{class:"font-semibold"},"Receipt Date",-1)),t("p",null,P(s.moment(s.details.updated_date).format("DATE_FORMAT"in l?l.DATE_FORMAT:m(rt))),1)]),t("div",ho,[e[18]||(e[18]=t("h3",{class:"font-semibold"},"Test Status",-1)),t("p",null,P(("capitalizeStr"in l?l.capitalizeStr:m(Qt))(s.details.status.split("-").join(" "))),1)]),t("div",_o,[e[19]||(e[19]=t("h3",{class:"font-semibold"},"Ward/Location",-1)),t("p",null,P(s.details.requesting_ward),1)]),t("div",bo,[e[20]||(e[20]=t("h3",{class:"font-semibold"},"Request Origin",-1)),t("p",null,P(s.details.request_origin),1)]),t("div",go,[e[21]||(e[21]=t("h3",{class:"font-semibold"},"Registered By",-1)),t("p",null,P(u.getRequestedBy(s.details.status_trail)),1)]),t("div",yo,[e[22]||(e[22]=t("h3",{class:"font-semibold"},"Requested By",-1)),t("p",null,P(s.details.requested_by),1)])])])]),t("div",wo,[t("div",xo,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold text-black"},"Results",-1)),t("div",Co,[s.details.status.toLowerCase()==="completed"&&("usePermissions"in l?l.usePermissions:m(pe))().can.verify("test_results")&&u.isCompletedByCurrentUserOrSuperAdmin(s.details)?(S(),Q(x,{key:0,icon:s.checkIcon,text:"Authorize",click:()=>{u.changeStatus("verified",s.details.id)},color:"success",loading:s.verifying},null,8,["icon","click","loading"])):X("",!0),(s.details.status.toLowerCase()==="completed"||s.details.status.toLowerCase()==="verified"||s.details.status.toLowerCase()==="test-rejected")&&("usePermissions"in l?l.usePermissions:m(pe))().can.view("reports")?(S(),Q(x,{key:1,icon:s.viewIcon,text:"View Report",click:u.viewReport,color:"primary"},null,8,["icon","click"])):X("",!0),d(V,{item:s.details,onUpdate:u.updateChanges,color:"primary"},null,8,["item","onUpdate"]),d(x,{icon:s.printerIcon,text:"Print Accession Number",click:u.printAccessionNumber,color:"primary"},null,8,["icon","click"]),d(x,{icon:s.printerIcon,color:"success",text:"Print Tracking Number",click:u.printTrackingNumber},null,8,["icon","click"])])]),u.isRejectedOrVoided(s.details.status)?(S(),q("div",Po,[e[26]||(e[26]=t("img",{src:Ct,class:"w-6 h-6 mr-2",alt:"no-result-svg"},null,-1)),t("h3",Do,[e[25]||(e[25]=te("Test Rejected: ")),t("span",Io,P(s.details.rejection_reason),1)])])):(S(),q("div",ko,[(S(!0),q(le,null,ge(s.details.indicators,(T,C)=>{var I;return S(),q("div",{class:ut(s.details.indicators.length!==C+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:C},[t("h3",null,P(T.name),1),t("div",So,[T.result?(S(),q("p",{key:0,innerHTML:T.result.value?T.result.value:"Not done"},null,8,To)):X("",!0),(I=T.result)!=null&&I.value?(S(),q("span",$o,P(T==null?void 0:T.unit),1)):X("",!0)])],2)}),128))])),s.details.test_type_name=="Cross-match"&&s.details.status.toLowerCase()=="verified"?(S(),q("div",Lo,[d(x,{loading:s.zebraPrinting,click:()=>{u.printBBResults()},text:"Print results",color:"primary",icon:s.printerIcon},null,8,["loading","click","icon"])])):X("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Mo=Ce(Bs,[["render",Ao]]),jo={components:{TransitionRoot:Ue,TransitionChild:Ne,Dialog:ze,DialogPanel:Ze,DialogTitle:Ge,XMarkIcon:xe,UserIcon:ht},data(){return{open:!1,addIcon:pt,saveIcon:_t,clearIcon:bt,name:"",description:"",loading:!1,cookie:ke("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const l={route:G.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:e,data:o}=await Y(l);o.value&&(this.rawReasons=o.value,o.value.map(v=>{this.reasons.push(v.description)})),e.value&&console.error(e.value)},async submitForm(){this.loading=!0;let l=null;this.rawReasons.map(u=>{u.description===this.reasonsSelected&&(l=u.id)});const e={route:`${G.testStatus}/${this.item.id}/${this.action}?status_reason_id=${l}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:o,error:v,pending:s}=await Y(e);this.loading=s,o.value&&(W().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),v.value&&(console.error(v.value),W().$toast.error(me),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},Ro={class:"fixed inset-0 overflow-y-auto"},qo={class:"flex min-h-full items-center justify-center p-4 text-center"},Vo={class:"border-b px-3 py-3 flex items-center justify-between"},Eo={class:"mt-2 space-y-3 px-5 py-5"},Fo={class:"space-y-2"},Oo={class:"border-b border-dotted text-gray-600"},Bo={class:"space-y-2"},Ho={class:"border-b border-dotted text-gray-600"},Uo={class:"space-y-2"},No={class:"border-b border-dotted text-gray-600"},zo={class:"w-full flex items-center"},Zo={class:"w-full flex flex-col space-y-2"},Go={class:"w-full flex flex-col space-y-2 pb-40"},Yo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Xo(l,e,o,v,s,u){const c=ve,r=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=j("FormKit"),x=j("multi-select"),V=vt,M=j("DialogPanel"),z=j("Dialog"),E=j("TransitionRoot");return S(),q("div",null,[t("div",null,[d(c,{text:o.text,color:"error",icon:o.icon,click:u.init},null,8,["text","icon","click"])]),d(E,{appear:"",show:s.open,as:"template"},{default:D(()=>[d(z,{as:"div",onClose:u.handleClick,class:"relative z-10"},{default:D(()=>[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[3]||(e[3]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Ro,[t("div",qo,[d(r,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",Vo,[d($,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:D(()=>[e[4]||(e[4]=t("img",{src:Ct,class:"w-8 h-8 mr-2"},null,-1)),te(" "+P(o.text.charAt(0).toUpperCase()+o.text.slice(1))+" Reason ",1)]),_:1}),t("button",{onClick:e[0]||(e[0]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),d(h,{type:"form","submit-label":"Update",onSubmit:u.submitForm,actions:!1,id:"rejectionForm"},{default:D(({value:T})=>[t("div",Eo,[t("div",Fo,[e[5]||(e[5]=t("h3",{class:"font-medium"},"Test Type",-1)),t("p",Oo,P(o.item.test_type_name),1)]),t("div",Bo,[e[6]||(e[6]=t("h3",{class:"font-medium"},"Specimen",-1)),t("p",Ho,P(o.item.specimen_type),1)]),t("div",Uo,[e[7]||(e[7]=t("h3",{class:"font-medium"},"Accession Number",-1)),t("p",No,P(o.item.accession_number),1)]),t("div",zo,[t("div",Zo,[d(h,{type:"text",label:"Person Talked To",validation:o.text.toLowerCase()!=="void"?"required":"",modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=C=>s.name=C)},null,8,["validation","modelValue"])])]),t("div",Go,[e[8]||(e[8]=t("label",{class:"font-medium"},"Select Reason(s)",-1)),d(x,{style:{"--ms-max-height":"none !important"},modelValue:s.reasonsSelected,"onUpdate:modelValue":e[2]||(e[2]=C=>s.reasonsSelected=C),options:s.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Yo,[d(V,{type:"button",text:"Clear form",click:u.resetForm},null,8,["click"]),d(c,{loading:s.loading,type:"submit",click:()=>{},color:"success",icon:s.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Ko=Ce(jo,[["render",Xo]]),Wo={class:"py-5 px-5"},Qo={class:"flex items-center space-x-2 py-5"},Jo={class:"text-2xl font-semibold uppercase"},en={class:"flex justify-between items-center w-full py-2 mb-2"},tn={class:"flex items-center space-x-2"},sn={class:"relative z-10 w-40"},on={class:"w-44"},nn={class:"pt-1"},ln={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},rn={class:"w-72 ml-2"},an={class:"py-3 flex items-center space-x-3"},cn={class:"py-2 flex items-center"},un={class:"w-full flex items-center justify-between space-x-2"},dn={key:0,class:"flex items-center space-x-2"},pn={key:0,class:"flex items-center space-x-2"},Nn=fe({__name:"index",setup(l){const e=Xe(),o=es(),v=ts(),{$toast:s,$metadata:u}=W();us({title:`${ds.name.toUpperCase()} - ${e.department} Tests`});const c=k(!1),r=k(0),$=k(),g=k(["",""]),h=k(""),x=k("Tests Lists"),V=k([{name:"Home",link:"/home"}]),M=k([{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions",sortable:!1}]),z=k([{text:"Results",color:"primary",icon:ps,status:"completed",show:"started",permission:"enter_test_results"},{text:"Accept",color:"success",icon:je,status:"pending",show:"not-collected",permission:"accept_test_specimen"},{text:"Start",color:"warning",icon:Cs,status:"started",show:"pending",permission:"start_test"},{text:"Authorize",color:"success",status:"verified",icon:je,show:"completed",permission:"verify_test_results"}]),E=n=>{const a=[{name:"Reject",icon:Ie,action:"rejected",permission:"void_test"},{name:"Void",icon:Ie,action:"voided",permission:"void_test"},{name:"Notdone",icon:Ie,action:"not_done",permission:"void_test"}];return n.toLowerCase()==="verified"?a.filter(p=>p.name.toLowerCase()==="void"):a},T=k([]),C=k({name:"select status"}),I=k("accession_number"),L=k(""),y=ke("token"),i=k(!1),b=k(0),_=k([]),R=k({page:1,rowsPerPage:10,sortBy:"name"}),Z=k([]),O=k([]),re=n=>{r.value==n?r.value=0:r.value=n},Se=async n=>{i.value=!0;const a={route:`${G.nlimsTestSearch}?tracking_number=${n.replace(/\$$/,"")}`,method:"GET",token:`${y.value}`},{data:p,error:w}=await Y(a);p.value&&(os(p.value).then(F=>{const U={...o.query,search:F};v.replace({query:U}),h.value=F,L.value=F,B()}).catch(F=>{console.error("error routing to merged test: ",F)}),i.value=!1),w.value&&(console.error(w.value),s.error(`${w.value.data.error}`),i.value=!1)},B=async()=>{kt(),i.value=!0;const{page:n,rowsPerPage:a}=R.value;let p=Qe(e.user.departments,e.department),w=Qe(e.locations,e.selectedLocation),F=C.value.name==="select status"?"":C.value.name!==void 0&&C.value.name;const U=g.value[0].toString()!==""?ie(g.value[0].toString()).format("YYYY-MM-DD"):"",Te=g.value[1].toString()!==""?ie(g.value[1].toString()).format("YYYY-MM-DD"):"",$e={route:`${G.tests}?minimal=true&page=${n}&per_page=${a}&status=${F.toString().toLowerCase()}&search=${h.value}&department_id=${p}&lab_location=${w}&start_date=${U}&end_date=${Te}&facility_sections=${_.value}`,method:"GET",token:`${y.value}`},{data:ae,error:_e,pending:Pe}=await Y($e);i.value=Pe,ae.value&&(ae.value.data.length==0&&s.warning("No tests found within the specified period"),T.value=ae.value.data.map(H=>{var A,N,ue,ot;return{...H,name:`${we(`${(A=H.client)==null?void 0:A.first_name} ${((N=H.client)==null?void 0:N.middle_name)!==null?H.client.middle_name:""} ${(ue=H.client)==null?void 0:ue.last_name}`)} (${H.client.sex}, ${ft((ot=H.client)==null?void 0:ot.date_of_birth)} yrs)`,order_status:`${H.order_status!==null?(H.order_status.charAt(0).toUpperCase()+H.order_status.slice(1)).split("-").join(" "):""}`,status:`${H.status!==null?H.status.charAt(0).toUpperCase()+H.status.slice(1):""}`,created_date:ie(H.created_date).utcOffset(2).format(ss)}}),b.value=ae.value.meta.total_count,i.value=!1),_e.value&&(console.error(_e.value.data),s.error(me),i.value=!1)},kt=async()=>{const n={route:`${G.testStatus}/all`,method:"GET",token:`${y.value}`},{data:a,error:p}=await Y(n);a.value&&(Z.value=a.value.map(w=>({id:w.id,name:w.name.charAt(0).toUpperCase()+w.name.slice(1)}))),p.value&&console.error(p.value)},St=async(n,a)=>{i.value=!0;const p={route:`${G.testStatus}/${a}/${n}`,method:"PUT",token:`${y.value}`,body:{}},{data:w,error:F,pending:U}=await Y(p);i.value=U,w.value&&(B(),i.value=!1),F.value&&(console.error(F.value),i.value=!1)},Tt=async(n,a)=>{i.value=!0;const p={route:`${G.orderStatus}/${n}`,method:"PUT",token:`${y.value}`,body:{order_id:a}},{data:w,error:F,pending:U}=await Y(p);i.value=U,w.value&&(B(),i.value=!1),F.value&&(console.error(F.value),i.value=!1)},We=(n,a)=>{n.status==="completed"?a.test_type_name.toLowerCase().includes("culture")?Je(a,`/tests/result/culture-sensitivity?accession_number=${a.accession_number}&test_id=${a.id}`):Je(a,`/tests/result?accession_number=${a.accession_number}&test_id=${a.id}`):n.status==="verified"?st(a):n.status!==""&&St(n.status,a.id)},Qe=(n,a)=>{const p=n.find(w=>w.name===a);return p?p.id:null},he=n=>{if(r.value=0,typeof n=="object"){R.value=n;const a={...o.query,page:n.page,rowsPerPage:n.rowsPerPage};v.replace({query:a})}B(),c.value=!1},$t=()=>{L.value="",h.value="",B()},Pt=n=>{h.value=n,L.value=n;const a={...o.query,search:n};v.replace({query:a}),n!==""?It(n)?Se(n):he(n):B()},Dt=n=>{if(n){_.value=n;for(let a=O.value.length-1;a>=0;a--){const p=O.value[a];p.origin==="wards"&&!n.includes(p.value)&&O.value.splice(a,1)}n.forEach(a=>{O.value.some(p=>p.origin==="wards"&&p.value===a)||O.value.push({origin:"wards",value:a})}),B()}},Je=(n,a)=>{v.push(a)},It=n=>/^(x|l).*\d/.test(n.toLowerCase()),et=n=>{if(n.name!=="select status"){const p=O.value.find(w=>w.origin==="statuses");p?p.value=n.name:O.value.push({origin:"statuses",value:n.name})}C.value=n;const a={...o.query,status:n.name.toLowerCase()=="select status"?"":n.name.toLowerCase()};v.replace({query:a}),B()},Lt=n=>{if(n.origin==="statuses"&&C.value.name!=="select status"&&et({name:"select status"}),n.origin==="wards"){const p=_.value.indexOf(n.value);p!==-1&&_.value.splice(p,1)}const a=O.value.findIndex(p=>p.origin===n.origin);a!==-1&&O.value.splice(a,1),B()},At=n=>{const a=e.user,p=n.completed_by;if(p){if(p.id!==a.id)return!0;if(p.is_super_admin===!0)return!0}return!1},Mt=(n,a)=>{const{hasPermission:p}=pe(),w=n.status.toLowerCase(),F=a.show.toLowerCase();if(w===F){const U=At(n);return w==="pending"&&n.order_status.toLowerCase()==="specimen not collected"?!1:a.permission?U&&p.value(String(a.permission)):U}return!1},jt=n=>{const a=new Set(["rejected","not-done","voided"]),p=new Set(["specimen not collected"]);return!a.has(n.status.toLowerCase())&&p.has(n.order_status.toLowerCase())},tt=n=>{const{can:a}=pe();return!new Set(["voided","test-rejected","rejected","not-done"]).has(n.status.toLowerCase())&&a.void("test")},Rt=()=>{g.value=["",""]},st=n=>{$!==null&&$.value.init(n)};return De(e,()=>{B()},{deep:!0}),De(g,n=>{const a=n[0].toString()!==""?ie(n[0].toString()).format("YYYY-MM-DD"):"",p=n[1].toString()!==""?ie(n[1].toString()).format("YYYY-MM-DD"):"",w={...o.query,from:a,to:p};v.replace({query:w}),B()},{deep:!0}),De(C,n=>{et(n)},{deep:!0}),Fe(()=>{var n,a,p,w,F,U;R.value={page:Number(o.query.page?o.query.page:1),rowsPerPage:Number(o.query.rowsPerPage?o.query.rowsPerPage:10)},C.value=o.query.status?{name:o.query.status.toString()}:{name:"select status"},h.value=(n=o.query.search)!=null&&n.toString()?(a=o.query.search)==null?void 0:a.toString():"",g.value=[`${(p=o.query.from)!=null&&p.toString()?(w=o.query.from)==null?void 0:w.toString():""}`,`${(F=o.query.to)!=null&&F.toString()?(U=o.query.to)==null?void 0:U.toString():""}`],B()}),(n,a)=>{const p=qt,w=ve,F=ns,U=Ts,Te=j("datepicker"),$e=as,ae=Is,_e=Mo,Pe=Ko,H=cs;return S(),q("div",Wo,[d(p,{pages:m(V)},null,8,["pages"]),t("div",Qo,[a[3]||(a[3]=t("svg",{class:"w-auto h-8",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M20 17c1.105 0 2-.933 2-2.083c0-.72-.783-1.68-1.37-2.3a.86.86 0 0 0-1.26 0c-.587.62-1.37 1.58-1.37 2.3c0 1.15.895 2.083 2 2.083m-3.722-6.432l1.505-2.598l-8.41-4.826L2.65 14.746a4.827 4.827 0 0 0 1.776 6.606a4.86 4.86 0 0 0 6.629-1.77l1.12-1.932z",opacity:"0.5"}),t("path",{fill:"currentColor",d:"M9.294 1.354a.75.75 0 0 0-.763 1.292l.835.494l.006.003l8.41 4.827l.844.484a.75.75 0 1 0 .747-1.3l-9.247-5.308zm3.633 14.998l-.002-.002l-2.612-1.503a.75.75 0 0 0-.748 1.3l2.61 1.503zm1.638-2.827l-.002-.001l-4.203-2.418a.75.75 0 0 0-.748 1.3l4.2 2.417zm1.711-2.958l-2.558-1.472a.75.75 0 0 0-.748 1.3l2.556 1.47z"})],-1)),t("h3",Jo,P(m(x)),1)]),t("div",en,[t("div",tn,[d(w,{text:"Refresh",color:"warning",icon:m(ms),click:()=>{$t()},loading:m(i)},null,8,["icon","click","loading"]),t("div",sn,[d(F,{items:m(Z),modelValue:m(C),"onUpdate:modelValue":a[0]||(a[0]=A=>be(C)?C.value=A:null)},null,8,["items","modelValue"])]),t("div",on,[d(U,{wards:m(u).wards,"onUpdate:itemsSelected":Dt},null,8,["wards"])]),t("div",nn,[t("div",ln,[d(m(fs),{class:"w-5 h-5 mr-2"}),a[4]||(a[4]=te(" Date Range ")),t("div",rn,[d(Te,{required:"",position:"left",onCleared:Rt,placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:m(g),"onUpdate:modelValue":a[1]||(a[1]=A=>be(g)?g.value=A:null)},null,8,["modelValue"])])])])]),d($e,{onUpdate:Pt,search:m(h),"onUpdate:search":a[2]||(a[2]=A=>be(h)?h.value=A:null)},null,8,["search"])]),t("div",an,[(S(!0),q(le,null,ge(m(O),(A,N)=>(S(),Q(ae,{value:A,close:"",color:"green",key:N,onUpdate:Lt},null,8,["value"]))),128))]),d(H,{headers:m(M),data:m(T),loading:m(i),searchField:m(I),searchValue:m(L),serverItemsLength:m(b),serverOptions:m(R),onUpdate:he},{actions:D(({item:A})=>[t("div",cn,[t("div",un,[m(r)!==A.id?(S(),q("div",dn,[d(_e,{ref_key:"testsDialog",ref:$,onUpdate:he},{default:D(()=>[d(w,{color:"primary",text:"View",icon:m(dt),click:()=>{st(A)}},null,8,["icon","click"])]),_:2},1536),A.status.toLowerCase()==="completed"&&("usePermissions"in n?n.usePermissions:m(pe))().can.edit("test_results")?(S(),Q(w,{key:0,click:()=>{We({status:"completed"},A)},text:"Edit",color:"success",icon:m(Ye)},null,8,["click","icon"])):X("",!0),(S(!0),q(le,null,ge(m(z),(N,ue)=>Be((S(),Q(w,{color:N.color,text:N.text,icon:N.icon,click:()=>{We(N,A)},key:ue},null,8,["color","text","icon","click"])),[[He,Mt(A,N)]])),128)),jt(A)?(S(),Q(w,{key:1,color:"success",text:"Accept",icon:m(mt),click:()=>Tt("accepted",A.order_id)},null,8,["icon","click"])):X("",!0)])):X("",!0),tt(A)?(S(),Q(w,{key:1,click:()=>re(A.id),color:"",text:"",icon:m(c)==!0?m(vs):m(hs)},null,8,["click","icon"])):X("",!0)]),tt(A)&&m(r)==A.id?(S(),q("div",pn,[(S(!0),q(le,null,ge(E(A.status),(N,ue)=>(S(),Q(Pe,{key:N.name,item:A,text:N.name,icon:N.icon,action:N.action,onUpdate:he},null,8,["item","text","icon","action"]))),128))])):X("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions"]),a[5]||(a[5]=t("div",{id:"tests-container"},null,-1))])}}});export{Nn as default};
