import{_ as de}from"./Db3TL93P.js";import{_ as me}from"./Dr8Bfetn.js";import{d as fe,a as _e,r as w,a2 as ye,ag as ve,u as A,c as U,C as f,w as L,o as ge,y as j,b as u,e as i,f as d,g as r,t as b,z as G,h as o,j as I,H as z,O as H,F as C,k as E,N as he,K,l as Re,E as be,_ as xe}from"./CexOikvH.js";import{_ as De}from"./C_7ebej8.js";import{_ as $e}from"./CEe5HprD.js";import{_ as we,a as Te}from"./CIyabxcS.js";import{u as ke,_ as Ce}from"./DRpLAozC.js";import{_ as Me}from"./C2yrLssJ.js";import{_ as Ae}from"./DX8X79la.js";import{u as Ee}from"./CHlGJM3Y.js";import{P as qe}from"./DwOgcnpE.js";import{u as Oe}from"./8eNCHlT3.js";import{r as Ye}from"./Bz5c_L39.js";import{r as Fe}from"./rlM72evK.js";import"./Cr2uUJHO.js";import"./Cg8mjwS6.js";import"./Dvnrc7nB.js";import"./DViz-wMw.js";import"./DoESIRUl.js";import"./BTdDQQhE.js";import"./CGOuUVVI.js";import"./DFofCUUM.js";import"./CrmKolap.js";const Se={class:"px-5 py-5"},Ue={class:"w-full flex items-center justify-between mb-3"},je={class:"flex items-center space-x-3"},Be={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Pe={class:"w-72 ml-2"},Ve={class:"w-44"},Ne={class:"flex items-center space-x-3"},Le={class:"border rounded print-container",id:"print-container"},Ge={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ie={class:"mt-3 px-5"},ze={class:"font-medium mb-2"},He={class:"font-normal"},Ke={class:"overflow-x-auto bg-white border-t"},Qe={key:0,class:"w-full overflow-x-auto"},Je={class:"uppercase bg-gray-100"},We={class:"text-left"},Xe={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},Ze={class:"px-4 py-2 font-bold"},et={class:"px-4 py-2"},tt=["onClick"],ot={class:"px-4 py-2"},rt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},st="Lab Statistics Report",At=fe({__name:"lab-statistics",setup(at){Oe({title:`${qe.name.toUpperCase()} - Lab Statistics Report`});const F=Ee(),Q=_e("token"),J=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],M=w([]),v=w({name:"select department"}),l=w(["",""]),B=w([]),T=w([]),q=w([]),P=w([]),x=ye(),m=ve(),{$toast:W,$metadata:X}=A(),{loading:_,executeCancellableRequest:Z,cancelRequest:ee}=ke(),te=()=>{l.value=new Array("","")};function oe(t){return t==="select department"||t==="-- select test type --"||t==="-- select test status --"?"":t}function re(t,e){const s=new Date(t),a=new Date(e),n=new Array;let c=s;for(;c<=a;){const g=c.toLocaleString("default",{month:"long"});n.push(g),c.setMonth(c.getMonth()+1)}T.value=n}const se=()=>{const{value:t}=v;return t.name==="select department"?!A().$toast.warning("Please select a department"):!0},D=U(()=>l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):""),$=U(()=>l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"");async function V(){_.value=!0;let t=`from=${D.value}&to=${$.value}&department=${oe(v.value.name)}&report_id=${m.query.report_id}`;const e={route:`${Re.aggregateReports}/lab_statistics?${t}`,method:"GET",token:`${Q.value}`},{data:s,error:a,pending:n}=await Z(e);if(_.value=n,s.value){re(s.value.from,s.value.to),B.value=s.value.data,q.value=ne(s.value.data);let c=[];q.value.forEach(g=>{const h={};h["Tests".toUpperCase()]=g.department.toUpperCase(),T.value.forEach(y=>{h[y.toUpperCase()]=""}),h["Total".toUpperCase()]="",c.push(h),g.tests.forEach(y=>{const k={};k["Tests".toUpperCase()]=y.name,T.value.forEach(O=>{k[O.toUpperCase()]=S(y,O)}),k["Total".toUpperCase()]=N(y),c.push(k)})}),P.value=c,_.value=!1,ae(s.value.report_id),s.value.data.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found for period ${D.value} - ${$.value}`)}a.value&&(_.value=!1,console.error("error: ",a.value),A().$toast.error(be))}const ae=t=>{const s={...x.currentRoute.value.query,report_id:t};x.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})};function ne(t){return t.map(e=>{const s=Object.keys(e)[0],a=Object.entries(e[s]).map(([n,c])=>{const g=Object.entries(c).map(([h,y])=>({[h]:y}));return{name:n,results:g}});return{department:s,tests:a}})}function S(t,e){let s=0;return t.results.forEach(a=>{let n=a[e]!==void 0?a[e].total:0;s+=n}),s}function N(t){let e=0;return t.results.forEach(s=>{Object.values(s).forEach(a=>{e+=a.total})}),e}const le=(t,e,s)=>{const a=t.results.find(n=>n[e]!==void 0);a?x.push(`/reports/${a[e].associated_ids}?origin=aggregate&type=lab-statistics-report&from=${D.value}&to=${$.value}&test=${t.name}&department=${v.value.name}&count=${s}&page=1&rowsPerPage=10`):W.warning("No data found for this month")};function ue(t){return t%2===0}L(l,()=>{const t=l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):"",e=l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"";if(t||e){const a={...x.currentRoute.value.query,...t&&{from:t},...e&&{to:e}};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0}),L(v,(t,e)=>{if(t!==e){const a={...x.currentRoute.value.query,department:t.name||void 0,report_id:""};x.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}});const ie=U(()=>m.query.to!==void 0&&m.query.from!==void 0&&m.query.department!==void 0?(l.value=[m.query.from,m.query.to],v.value.name=`${m.query.department}`,m.query.to!==""&&m.query.from!==""&&m.query.department!==""):!1);return ge(()=>{ie.value?V():_.value=!1,M.value=X.departments,M.value.some(e=>e.name=="All")||M.value.push({id:0,name:"All"}),M.value.sort((e,s)=>{const a=e.name.toUpperCase(),n=s.name.toUpperCase();return a<n?-1:a>n?1:0})}),(t,e)=>{const s=de,a=j("datepicker"),n=me,c=xe,g=j("FormKit"),h=De,y=$e,k=j("excel"),O=Te,ce=Ce;return u(),i("div",Se,[d(s,{pages:J}),r("div",{class:"flex items-center py-5"},[e[3]||(e[3]=r("img",{src:Me,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),r("h3",{class:"text-2xl font-semibold uppercase"},b(st))]),r("div",Ue,[d(g,{type:"form","submit-label":"Update",onSubmit:e[2]||(e[2]=R=>se()&&V()),actions:!1,id:"submitForm"},{default:G(({value:R})=>[r("div",je,[r("div",Be,[d(o(Ye),{class:"w-5 h-5 mr-2"}),e[4]||(e[4]=I(" Filter By Date Range ")),r("div",Pe,[d(a,{onCleared:te,format:"dd/MM/yyyy",required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:o(l),"onUpdate:modelValue":e[0]||(e[0]=p=>z(l)?l.value=p:null)},null,8,["modelValue"])])]),r("div",Ve,[d(n,{items:o(M),modelValue:o(v),"onUpdate:modelValue":e[1]||(e[1]=p=>z(v)?v.value=p:null)},null,8,["items","modelValue"])]),d(c,{type:"submit",color:"primary",text:"Generate Report",icon:o(Fe),click:()=>{},loading:o(_)},null,8,["icon","loading"])])]),_:1}),r("div",Ne,[d(h),r("div",null,[d(k,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${o(f)(o(D)).format("DD-MM-yyyy")} TO ${o(f)(o($)).format("DD-MM-yyyy")}`,o(F).details.name,o(F).details.address,o(F).details.phone],data:o(P),worksheet:"report-work-sheet",name:`lab-statistics-report_${o(f)(o(D)).format("DD_MM_yyyy")}_to_${o(f)(o($)).format("DD_MM_yyyy")}.xls`},{default:G(()=>[d(y,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),r("div",Le,[r("div",Ge,[e[5]||(e[5]=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"LABORATORY STATISTICS REPORT")],-1)),d(O)]),r("div",Ie,[r("h3",ze,[e[6]||(e[6]=I(" Tests Performed Period: ")),r("span",He,b(o(D)!=""?o(f)(o(D)).format("DATE_FORMAT"in t?t.DATE_FORMAT:o(H)):"")+" - "+b(o($)!=""?o(f)(o($)).format("DATE_FORMAT"in t?t.DATE_FORMAT:o(H)):""),1)])]),r("div",Ke,[o(q).length>0&&!o(_)?(u(),i("table",Qe,[r("thead",Je,[r("tr",We,[e[7]||(e[7]=r("th",{class:"px-4 py-2"},"Tests",-1)),(u(!0),i(C,null,E(o(T),R=>(u(),i("th",{key:R,class:"px-4 py-2"},b(R),1))),128)),e[8]||(e[8]=r("th",{class:"px-4 py-2"},"Total",-1))])]),r("tbody",null,[(u(!0),i(C,null,E(o(q),R=>(u(),i(C,{key:R.department},[r("tr",Xe,[r("td",Ze,b(R.department),1),(u(!0),i(C,null,E(o(T),p=>(u(),i("td",{key:p,class:"px-4 py-2"}))),128)),e[9]||(e[9]=r("td",{class:"px-4 py-2"},null,-1))]),(u(!0),i(C,null,E(R.tests,(p,pe)=>(u(),i("tr",{key:p.name,class:he({"bg-gray-50":ue(pe),"border-b border-dotted":!0})},[r("td",et,b(p.name),1),(u(!0),i(C,null,E(o(T),Y=>(u(),i("td",{onClick:nt=>le(p,Y,S(p,Y)),key:Y,class:"px-4 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},b(S(p,Y)),9,tt))),128)),r("td",ot,b(N(p)),1)],2))),128))],64))),128))])])):K("",!0),d(ce,{condition:o(_),cancelReportGeneration:()=>o(ee)()},null,8,["condition","cancelReportGeneration"]),o(B).length==0&&!o(_)?(u(),i("div",rt,e[10]||(e[10]=[r("img",{src:we,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),r("p",null,"Data not found, please generate report",-1)]))):K("",!0)])])])}}});export{At as default};
