import{_ as ie}from"./COJDNupw.js";import{_ as ce}from"./CoQgzhbz.js";import{b as h,e as x,g as n,d as me,r as o,a as ue,c as v,C as f,a6 as de,w as j,y as I,f as l,h as e,t as G,z as k,k as O,H as U,q as pe,K as P,O as H,u as N,l as z,m as q,E as _e,_ as ve,n as fe,a3 as ge,a4 as ye,x as Ee}from"./BxD-h1LR.js";import{_ as Te}from"./BNhNOnHe.js";import{_ as he}from"./DCLH_TIo.js";import{u as xe}from"./BmiBNsbw.js";import{_ as Re}from"./CKMQEpqg.js";import{_ as Se}from"./CQcCm1L6.js";import{P as Ae}from"./C1C0mJ5v.js";import{u as we}from"./DRcUz5ts.js";import{r as $e}from"./BkJfYQCG.js";import{r as Pe}from"./CQe3LSWs.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";function Ne(R,r){return h(),x("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[n("path",{"fill-rule":"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75H12a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}const D=R=>(ge("data-v-ede776e7"),R=R(),ye(),R),De={class:"px-5 py-5"},Me={class:"flex items-center py-5"},Ce=D(()=>n("img",{src:Re,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),be={class:"text-2xl font-semibold uppercase"},Ie={class:"w-full flex items-center justify-between mb-5"},ke={class:"w-full flex items-center space-x-3"},Ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Oe={class:"w-72 ml-2"},Ve={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ye={class:"w-48 ml-2"},Be={class:"flex justify-end py-2"},Le={class:"bg-gray-100 rounded flex items-center text-zinc-500"},Fe={class:"w-48"},je={class:"w-48"},Ge={key:0,id:"print-container"},He={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},ze=D(()=>n("img",{src:Se,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1)),qe=D(()=>n("p",null,"Data not found, please generate report",-1)),Ze=[ze,qe],Ke={key:2,class:"mx-auto justify-center flex flex-col items-center space-y-3"},Je=D(()=>n("p",{class:"text-base"},[O("Generating report, please wait"),n("span",{class:"animate-ping"},"...")],-1)),Xe=me({__name:"user-statistics",setup(R){xe({title:`${Ae.name.toUpperCase()} - User Statistics Report`});const r=o({name:"select report type"}),V=o(""),Z=o(""),K=Pe,g=o(new Array),Y=ue("token"),S=o({page:1,rowsPerPage:20,sortBy:"name"}),B=o(0),m=o(!1),u=o([]),J=o("User Statistics Report"),L=o([]),M=we(),d=o({name:"Select and search for user..."}),X=o([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),Q=o([{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}]),i=v(()=>g.value.map(t=>({...t,created_date:f(t.created_date).format("DD/MMM/YYYY"),age:de(t.date_of_birth)}))),W=v(()=>{const t=r.value,s=()=>i.value.length>0&&t.name=="Summary"?i.value.map(a=>({USER:a.user,"TESTS COMPLETED":a.tests_completed,"TESTS RECEIVED":a.tests_received,"SPECIMEN COLLECTED":a.specimen_collected,"SPECIMEN REJECTED":a.specimen_rejected,"TESTS AUTHORIZED":a.tests_authorized})):[],y=()=>i.value.length>0&&t.name=="Patient Registry"?i.value.map(a=>({"PATIENT NO":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,AGE:a.age,SEX:a.sex})):[],p=()=>i.value.length>0&&t.name=="Tests Registry"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[],c=()=>i.value.length>0&&t.name=="Specimen Registry"?i.value.map(a=>({"SPECIMEN NUMBER":a.id,"PATIENT NAME":a.patient_name,"PATIENT NUMBER":a.patient_no,"DATE REGISTERED":a.created_date})):[],E=()=>i.value.length>0&&t.name=="Tests Performed"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":a.patient_name,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[];return{Summary:s(),"Patient Registry":y(),"Tests Registry":p(),"Specimen Registry":c(),"Tests Performed":E()}[t.name]}),C=v(()=>L.value.map(t=>({id:t.id,name:`${t.first_name} ${t.last_name}`}))),ee=v(()=>{const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},s=r.value.name.toLowerCase();return t[s]||""}),te=v(()=>{const t={summary:new Array({text:"Name",value:"user"},{text:"Tests Received",value:"tests_received"},{text:"Specimen Collected",value:"specimen_collected"},{text:"Specimen Rejected",value:"specimen_rejected"},{text:"Tests Performed",value:"tests_completed"},{text:"Tests Authorized",value:"tests_authorized"}),"specimen registry":new Array({text:"Specimen Number",value:"id"},{text:"Name",value:"specimen"},{text:"Patient Number",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Date Registered",value:"created_date"}),"tests registry":new Array({text:"Test Type",value:"test_type_name"},{text:"Patient Number",value:"client.id"},{text:"Patient Name",value:"actions"},{text:"Specimen",value:"specimen_type"},{text:"Date Registered",value:"created_date"}),"patients registry":new Array({text:"Patient Number",value:"id"},{text:"Name",value:"actions"},{text:"Gender",value:"sex"},{text:"Age",value:"age"},{text:"Date Registered",value:"created_date"}),"tests performed":new Array({text:"Test Id",value:"test_id"},{text:"Test Type",value:"test_type"},{text:"Patient No",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Accession Number",value:"accession_number"},{text:"Date Registered",value:"created_date"})},s=r.value.name.toLowerCase();return t[s]||new Array}),A=v(()=>u.value[0]?f(u.value[0]).format("YYYY-MM-DD"):""),w=v(()=>u.value[1]?f(u.value[1]).format("YYYY-MM-DD"):"");async function b(){if(F(r.value)=="")N().$toast.warning("Please select a report type!");else{m.value=!0;const{page:t,rowsPerPage:s}=S.value;let y=`from=${A.value}&to=${w.value}&report_type=${F(r.value).toLocaleLowerCase()}&page=${t}&limit=${s}&user=${d.value.id}`;const p={route:`${z.aggregateReports}user_statistics?${y}`,method:"GET",token:`${Y.value}`},{data:c,error:E,pending:$}=await q(p);m.value=$,c.value&&(m.value=!1,g.value=c.value.data.tests,B.value=c.value.data.metadata.total_count,c.value.data.tests.length>0?N().$toast.success("Report data generated successfully"):N().$toast.warning(`No data found in period ${A.value} - ${w.value}`)),E.value&&(m.value=!1,console.error(E.value),N().$toast.error(_e))}}async function ae(){const{data:t,error:s}=await q({route:`${z.users}?page=1&per_page=2000`,method:"GET",token:`${Y.value}`});t.value&&(L.value=t.value.data,C.value.some(p=>p.name=="All")||C.value.unshift({id:0,name:"All"})),s.value&&console.error(s.value)}function F(t){return t.name=="select report type"?"":t.name}function se(t){typeof t=="object"&&(S.value=t)}function ne(t){V.value=t,Z.value=t,b()}return j(()=>S.value,(t,s)=>{t!=s&&b()}),j(()=>r.value,(t,s)=>{t!=s&&(g.value=[])}),ae(),(t,s)=>{const y=ie,p=I("datepicker"),c=ce,E=ve,$=I("FormKit"),a=Te,re=I("excel"),oe=he,le=fe;return h(),x("div",De,[l(y,{pages:e(X)},null,8,["pages"]),n("div",Me,[Ce,n("h3",be,G(e(J)),1)]),n("div",Ie,[l($,{type:"form","submit-label":"Update",onSubmit:b,actions:!1,id:"submitForm"},{default:k(({value:_})=>[n("div",ke,[n("div",Ue,[l(e($e),{class:"w-5 h-5 mr-2"}),O(" Filter By Date Range "),n("div",Oe,[l(p,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(u),"onUpdate:modelValue":s[0]||(s[0]=T=>U(u)?u.value=T:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),n("div",Ve,[l(e(Ne),{class:"w-5 h-5 mr-2 my-2.5"}),O(" Report Type "),n("div",Ye,[l(c,{class:"bg-white",items:e(Q),modelValue:e(r),"onUpdate:modelValue":s[1]||(s[1]=T=>U(r)?r.value=T:null)},null,8,["items","modelValue"])])]),n("div",Be,[n("div",Le,[n("div",Fe,[l(c,{class:"bg-white rounded",isSearchable:!0,items:e(C),modelValue:e(d),"onUpdate:modelValue":s[2]||(s[2]=T=>U(d)?d.value=T:null),onUpdate:ne},null,8,["items","modelValue"])]),e(d).name!=null&&e(d).name!=="Select and search for user..."?(h(),x("button",{key:0,type:"button",onClick:s[3]||(s[3]=T=>d.value={name:"Select and search for user..."})},[l(e(pe),{class:"w-5 h-5 mx-2 my-2.5"})])):P("",!0)])]),n("div",je,[l(E,{type:"submit",color:"primary",text:"Generate Report",icon:e(K),click:()=>{},loading:e(m)},null,8,["icon","loading"])])])]),_:1}),l(re,{class:"btn btn-default",header:[`USER STATISTICS ${e(r).name.toUpperCase()} REPORT`,`PERIOD FROM ${e(f)(e(A)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(H))} TO ${e(f)(e(w)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(H))}`,e(M).details.name,e(M).details.address,e(M).details.phone],data:e(W),worksheet:"report-work-sheet",name:`user_statistics_report_${e(r).name.toLowerCase().split(" ").join("_")}_${e(f)(e(A)).format("DD_MM_yyyy")}_to_${e(f)(e(w)).format("DD_MM_yyyy")}.xls`},{default:k(()=>[l(a,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),e(g).length>0?(h(),x("div",Ge,[l(oe,{headers:e(te),data:e(i),serverItemsLength:e(B),serverOptions:e(S),loading:e(m),"search-field":e(ee),"search-value":e(V),onUpdate:se},{actions:k(({item:_})=>[n("td",null,G(e(r).name.toLowerCase()=="patients registry"?`${_.first_name}
                            ${_.middle_name} ${_.last_name}`:`${_.client.first_name} ${_.client.middle_name}
                            ${_.client.last_name}`),1)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value"])])):P("",!0),e(g).length==0&&!e(m)?(h(),x("div",He,Ze)):P("",!0),e(m)&&e(g).length==0?(h(),x("div",Ke,[l(le),Je])):P("",!0)])}}}),Et=Ee(Xe,[["__scopeId","data-v-ede776e7"]]);export{Et as default};
