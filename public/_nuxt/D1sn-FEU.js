import{_ as tt}from"./BIgjk9bL.js";import{d as ge,r as O,c as B,b1 as be,ab as m,bt as ye,b7 as W,b5 as Ve,b6 as st,b8 as ce,bu as ot,bv as nt,aH as we,bw as rt,b2 as it,b3 as lt,b4 as at,ac as z,ag as xe,F as K,a9 as J,o as Fe,ay as qe,bx as Oe,ad as me,af as he,b9 as ct,ba as Ae,aa as Ce,ai as G,by as X,bc as H,bz as Z,bA as fe,b as v,e as I,g as s,q as se,x as oe,y as x,t as C,i as ke,v as Se,f as u,N as Ee,S as Te,p as $e,Y as Pe,G as Ie,V as Re,B as De,a as de,l as M,m as j,u as F,E as ee,z as S,k as Q,_ as pe,bB as ut,bC as dt,bD as pt,C as Y,A as Be,s as Ne,bE as Ue,M as mt,bF as Me,a8 as ue,a_ as ht,K as V,h as E,a6 as He,O as _e,Z as ft,L as U,j as le,bG as _t,n as vt,P as A,bH as gt}from"./Iy63StId.js";import{r as bt,_ as yt}from"./BpMjlwPN.js";import{_ as wt}from"./DjSWCjs7.js";import{_ as xt}from"./CSpDwL0e.js";import{_ as Ze}from"./UunfBM1U.js";import{u as ve}from"./CLgq2Dg7.js";import{r as ze}from"./CRyrbPUx.js";import{r as Ge}from"./WL2XSp5i.js";import{r as Ye}from"./B3GTD7OD.js";import{u as te}from"./CJ1lh5Jd.js";import{r as ae}from"./bCj5yvO4.js";import{_ as Ct}from"./D2BuRAA3.js";import{u as kt}from"./dSQnwF8t.js";import{P as St}from"./yiwDnRAW.js";import{r as Tt}from"./DW7An3PC.js";import{r as $t}from"./BcFcAWuT.js";import{r as Pt}from"./CUkWAT3i.js";import{s as It}from"./57K4Quj0.js";import{r as Rt}from"./BAFJmU_2.js";import{r as Dt}from"./Ch943h6f.js";import{r as je}from"./CkZ5Ux7J.js";import{r as Lt}from"./B0fmNuu3.js";import{a as At,r as Mt}from"./BBLjmq0h.js";import{r as jt}from"./i8co_XWI.js";import{r as ie}from"./Bb_i7a5u.js";import{r as Vt}from"./5bsad-w_.js";import{I as Ft,j as qt,E as Ot,A as Et,F as Bt}from"./Byb5n9Ur.js";import{g as Nt,S as Ut,M as Ht,b as Zt}from"./bnDe_-fm.js";import"./CY_pW6Pm.js";import"./Dndf7ZKt.js";import"./BYvWnHVP.js";import"./G37wRrHr.js";import"./BklODkO7.js";var zt=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(zt||{});let Xe=Symbol("PopoverContext");function Le(e){let o=Ce(Xe,null);if(o===null){let n=new Error(`<${e} /> is missing a parent <${We.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Le),n}return o}let Gt=Symbol("PopoverGroupContext");function Ke(){return Ce(Gt,null)}let Qe=Symbol("PopoverPanelContext");function Yt(){return Ce(Qe,null)}let We=ge({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(e,{slots:o,attrs:n,expose:a}){var t;let r=O(null);a({el:r,$el:r});let l=O(1),i=O(null),T=O(null),$=O(null),w=O(null),p=B(()=>be(r)),P=B(()=>{var c,f;if(!m(i)||!m(w))return!1;for(let re of document.querySelectorAll("body > *"))if(Number(re==null?void 0:re.contains(m(i)))^Number(re==null?void 0:re.contains(m(w))))return!0;let h=ye(),D=h.indexOf(m(i)),q=(D+h.length-1)%h.length,N=(D+1)%h.length,ne=h[q],et=h[N];return!((c=m(w))!=null&&c.contains(ne))&&!((f=m(w))!=null&&f.contains(et))}),g={popoverState:l,buttonId:O(null),panelId:O(null),panel:w,button:i,isPortalled:P,beforePanelSentinel:T,afterPanelSentinel:$,togglePopover(){l.value=W(l.value,{0:1,1:0})},closePopover(){l.value!==1&&(l.value=1)},close(c){g.closePopover();let f=c?c instanceof HTMLElement?c:c.value instanceof HTMLElement?m(c):m(g.button):m(g.button);f==null||f.focus()}};Ve(Xe,g),st(B(()=>W(l.value,{0:ce.Open,1:ce.Closed})));let L={buttonId:g.buttonId,panelId:g.panelId,close(){g.closePopover()}},k=Ke(),d=k==null?void 0:k.registerPopover,[_,b]=ot(),R=nt({mainTreeNodeRef:k==null?void 0:k.mainTreeNodeRef,portals:_,defaultContainers:[i,w]});function y(){var c,f,h,D;return(D=k==null?void 0:k.isFocusWithinPopoverGroup())!=null?D:((c=p.value)==null?void 0:c.activeElement)&&(((f=m(i))==null?void 0:f.contains(p.value.activeElement))||((h=m(w))==null?void 0:h.contains(p.value.activeElement)))}return we(()=>d==null?void 0:d(L)),rt((t=p.value)==null?void 0:t.defaultView,"focus",c=>{var f,h;c.target!==window&&c.target instanceof HTMLElement&&l.value===0&&(y()||i&&w&&(R.contains(c.target)||(f=m(g.beforePanelSentinel))!=null&&f.contains(c.target)||(h=m(g.afterPanelSentinel))!=null&&h.contains(c.target)||g.closePopover()))},!0),it(R.resolveContainers,(c,f)=>{var h;g.closePopover(),lt(f,at.Loose)||(c.preventDefault(),(h=m(i))==null||h.focus())},B(()=>l.value===0)),()=>{let c={open:l.value===0,close:g.close};return z(K,[z(b,{},()=>xe({theirProps:{...e,...n},ourProps:{ref:r},slot:c,slots:o,attrs:n,name:"Popover"})),z(R.MainTreeNode)])}}}),Xt=ge({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(e,{attrs:o,slots:n,expose:a}){var t;let r=(t=e.id)!=null?t:`headlessui-popover-button-${J()}`,l=Le("PopoverButton"),i=B(()=>be(l.button));a({el:l.button,$el:l.button}),Fe(()=>{l.buttonId.value=r}),qe(()=>{l.buttonId.value=null});let T=Ke(),$=T==null?void 0:T.closeOthers,w=Yt(),p=B(()=>w===null?!1:w.value===l.panelId.value),P=O(null),g=`headlessui-focus-sentinel-${J()}`;p.value||we(()=>{l.button.value=m(P)});let L=It(B(()=>({as:e.as,type:o.type})),P);function k(c){var f,h,D,q,N;if(p.value){if(l.popoverState.value===1)return;switch(c.key){case G.Space:case G.Enter:c.preventDefault(),(h=(f=c.target).click)==null||h.call(f),l.closePopover(),(D=m(l.button))==null||D.focus();break}}else switch(c.key){case G.Space:case G.Enter:c.preventDefault(),c.stopPropagation(),l.popoverState.value===1&&($==null||$(l.buttonId.value)),l.togglePopover();break;case G.Escape:if(l.popoverState.value!==0)return $==null?void 0:$(l.buttonId.value);if(!m(l.button)||(q=i.value)!=null&&q.activeElement&&!((N=m(l.button))!=null&&N.contains(i.value.activeElement)))return;c.preventDefault(),c.stopPropagation(),l.closePopover();break}}function d(c){p.value||c.key===G.Space&&c.preventDefault()}function _(c){var f,h;e.disabled||(p.value?(l.closePopover(),(f=m(l.button))==null||f.focus()):(c.preventDefault(),c.stopPropagation(),l.popoverState.value===1&&($==null||$(l.buttonId.value)),l.togglePopover(),(h=m(l.button))==null||h.focus()))}function b(c){c.preventDefault(),c.stopPropagation()}let R=Oe();function y(){let c=m(l.panel);if(!c)return;function f(){W(R.value,{[Z.Forwards]:()=>X(c,H.First),[Z.Backwards]:()=>X(c,H.Last)})===fe.Error&&X(ye().filter(h=>h.dataset.headlessuiFocusGuard!=="true"),W(R.value,{[Z.Forwards]:H.Next,[Z.Backwards]:H.Previous}),{relativeTo:m(l.button)})}f()}return()=>{let c=l.popoverState.value===0,f={open:c},{...h}=e,D=p.value?{ref:P,type:L.value,onKeydown:k,onClick:_}:{ref:P,id:r,type:L.value,"aria-expanded":l.popoverState.value===0,"aria-controls":m(l.panel)?l.panelId.value:void 0,disabled:e.disabled?!0:void 0,onKeydown:k,onKeyup:d,onClick:_,onMousedown:b};return z(K,[xe({ourProps:D,theirProps:{...o,...h},slot:f,attrs:o,slots:n,name:"PopoverButton"}),c&&!p.value&&l.isPortalled.value&&z(me,{id:g,features:he.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:y})])}}}),Kt=ge({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(e,{attrs:o,slots:n,expose:a}){var t;let r=(t=e.id)!=null?t:`headlessui-popover-panel-${J()}`,{focus:l}=e,i=Le("PopoverPanel"),T=B(()=>be(i.panel)),$=`headlessui-focus-sentinel-before-${J()}`,w=`headlessui-focus-sentinel-after-${J()}`;a({el:i.panel,$el:i.panel}),Fe(()=>{i.panelId.value=r}),qe(()=>{i.panelId.value=null}),Ve(Qe,i.panelId),we(()=>{var b,R;if(!l||i.popoverState.value!==0||!i.panel)return;let y=(b=T.value)==null?void 0:b.activeElement;(R=m(i.panel))!=null&&R.contains(y)||X(m(i.panel),H.First)});let p=ct(),P=B(()=>p!==null?(p.value&ce.Open)===ce.Open:i.popoverState.value===0);function g(b){var R,y;switch(b.key){case G.Escape:if(i.popoverState.value!==0||!m(i.panel)||T.value&&!((R=m(i.panel))!=null&&R.contains(T.value.activeElement)))return;b.preventDefault(),b.stopPropagation(),i.closePopover(),(y=m(i.button))==null||y.focus();break}}function L(b){var R,y,c,f,h;let D=b.relatedTarget;D&&m(i.panel)&&((R=m(i.panel))!=null&&R.contains(D)||(i.closePopover(),((c=(y=m(i.beforePanelSentinel))==null?void 0:y.contains)!=null&&c.call(y,D)||(h=(f=m(i.afterPanelSentinel))==null?void 0:f.contains)!=null&&h.call(f,D))&&D.focus({preventScroll:!0})))}let k=Oe();function d(){let b=m(i.panel);if(!b)return;function R(){W(k.value,{[Z.Forwards]:()=>{var y;X(b,H.First)===fe.Error&&((y=m(i.afterPanelSentinel))==null||y.focus())},[Z.Backwards]:()=>{var y;(y=m(i.button))==null||y.focus({preventScroll:!0})}})}R()}function _(){let b=m(i.panel);if(!b)return;function R(){W(k.value,{[Z.Forwards]:()=>{let y=m(i.button),c=m(i.panel);if(!y)return;let f=ye(),h=f.indexOf(y),D=f.slice(0,h+1),q=[...f.slice(h+1),...D];for(let N of q.slice())if(N.dataset.headlessuiFocusGuard==="true"||c!=null&&c.contains(N)){let ne=q.indexOf(N);ne!==-1&&q.splice(ne,1)}X(q,H.First,{sorted:!1})},[Z.Backwards]:()=>{var y;X(b,H.Previous)===fe.Error&&((y=m(i.button))==null||y.focus())}})}R()}return()=>{let b={open:i.popoverState.value===0,close:i.close},{focus:R,...y}=e,c={ref:i.panel,id:r,onKeydown:g,onFocusout:l&&i.popoverState.value===0?L:void 0,tabIndex:-1};return xe({ourProps:c,theirProps:{...o,...y},attrs:o,slot:b,slots:{...n,default:(...f)=>{var h;return[z(K,[P.value&&i.isPortalled.value&&z(me,{id:$,ref:i.beforePanelSentinel,features:he.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:d}),(h=n.default)==null?void 0:h.call(n,...f),P.value&&i.isPortalled.value&&z(me,{id:w,ref:i.afterPanelSentinel,features:he.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:_})])]}},features:Ae.RenderStrategy|Ae.Static,visible:P.value,name:"PopoverPanel"})}}});function Qt(e,o){return v(),I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M12.97 3.97a.75.75 0 0 1 1.06 0l7.5 7.5a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 1 1-1.06-1.06l6.22-6.22H3a.75.75 0 0 1 0-1.5h16.19l-6.22-6.22a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Wt(e,o){return v(),I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 0 1 1.06 0l6 6a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l4.72-4.72H9a5.25 5.25 0 1 0 0 10.5h3a.75.75 0 0 1 0 1.5H9a6.75 6.75 0 0 1 0-13.5h10.19l-4.72-4.72a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function Jt(e,o){return v(),I("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z","clip-rule":"evenodd"})])}const es={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:se}},ts={class:"text-sm"};function ss(e,o,n,a,t,r){const l=x("XMarkIcon");return v(),I("button",{class:Ee(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${n.color}-500`])},[s("p",ts,C(n.value.text),1),ke(s("button",{onClick:o[0]||(o[0]=(...i)=>r.removeLabel&&r.removeLabel(...i))},[u(l,{class:"w-4 h-4"})],512),[[Se,n.close]])],2)}const os=oe(es,[["render",ss]]),ns={components:{TransitionRoot:Te,TransitionChild:$e,Dialog:Pe,DialogPanel:Ie,DialogTitle:Re,XMarkIcon:se,UserIcon:ze},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:De,saveIcon:Ge,clearIcon:Ye,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:de("token"),authStore:ve(),departmentId:0}},methods:{async init(){this.handleClick();const e=this.authStore.department,o=this.authStore.user.departments.find(n=>n.name===e);o&&(this.departmentId=o.id),this.selectedDepartment=e,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(e){var r;const o=(r=this.item.client)!=null&&r.sex.match(/f/i)?"Female":"Male",n={route:`${M.specimenTestTypes}?department_id=${e}&specimen_id=${this.item.specimen_id}&sex=${o}`,method:"GET",token:`${this.cookie}`},{error:a,data:t}=await j(n);t.value&&(this.rawTestTypes=t.value,this.testTypes=t.value),a.value&&console.error("error: ",a.value)},async submitForm(){this.loading=!0;let e=this.testTypesSelected.map(t=>({specimen:this.item.specimen_id,test_type:t}));const o={route:`${M.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:e}},{data:n,error:a}=await j(o);n.value&&(this.handleClick(),F().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),a.value&&(this.handleClick(),console.error("error: ",a.value),F().$toast.error(ee),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(e,o){if(e!==o){const n=this.authStore.user.departments.find(a=>a.name===e);n&&(this.departmentId=n.id,this.getTestTypes(this.departmentId))}}}},rs=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),is={class:"fixed inset-0 overflow-y-auto"},ls={class:"flex min-h-full items-center justify-center p-4 text-center"},as={class:"border-b px-3 py-3 flex items-center justify-between"},cs={class:"mt-2 space-y-3 pb-40"},us={class:"w-full flex flex-col space-y-2 px-5"},ds=s("label",{class:"font-medium"},"Department",-1),ps={class:"w-full flex flex-col space-y-2 px-5"},ms=s("label",{class:"font-medium"},"Tests",-1),hs={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function fs(e,o,n,a,t,r){const l=pe,i=x("TransitionChild"),T=x("DialogTitle"),$=x("XMarkIcon"),w=x("multi-select"),p=Ze,P=x("FormKit"),g=x("DialogPanel"),L=x("Dialog"),k=x("TransitionRoot");return v(),I("div",null,[s("div",null,[u(l,{text:"Add test to current order",color:"warning",icon:t.editIcon,click:r.init},null,8,["icon","click"])]),u(k,{appear:"",show:t.open,as:"template"},{default:S(()=>[u(L,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[rs]),_:1}),s("div",is,[s("div",ls,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(g,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",as,[u(T,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:S(()=>[Q(" Add Test To Current Order ")]),_:1}),s("button",{onClick:o[0]||(o[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[u($,{class:"w-5 h-5"})])]),u(P,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"submitForm"},{default:S(({value:d})=>[s("div",cs,[s("div",us,[ds,u(w,{style:{"--ms-max-height":"none !important"},modelValue:t.selectedDepartment,"onUpdate:modelValue":o[1]||(o[1]=_=>t.selectedDepartment=_),options:t.departments.map(_=>_.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),s("div",ps,[ms,u(w,{style:{"--ms-max-height":"none !important"},modelValue:t.testTypesSelected,"onUpdate:modelValue":o[2]||(o[2]=_=>t.testTypesSelected=_),options:t.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),s("div",hs,[u(p,{type:"button",click:()=>r.resetForm(),text:"Clear form"},null,8,["click"]),u(l,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const _s=oe(ns,[["render",fs]]),vs={components:{TransitionRoot:Te,TransitionChild:$e,Dialog:Pe,DialogPanel:Ie,DialogTitle:Re,XMarkIcon:se,PhoneIcon:ut,EnvelopeIcon:dt,MapPinIcon:pt},data(){return{moment:Y,viewIcon:Be,show:this.open,addIcon:Ne,checkIcon:ae,editIcon:De,acceptIcon:Ue,printerIcon:mt,cookie:de("token"),details:{},loading:!1,verifying:!1,zebraPrinting:!1}},props:{open:{type:Boolean,required:!1}},methods:{async init(e){this.loading=!0;const o={route:`${M.tests}/${e.id}`,method:"GET",token:`${this.cookie}`},{data:n,error:a,pending:t}=await j(o);this.loading=t,n.value&&(this.details=n.value,typeof this.details=="object"&&this.handleClick()),a.value&&(this.loading=!1,console.error(a.value),F().$toast.error(ee))},async printBBResults(){const e={route:M.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.details.order_id,tests:[this.details.id],is_cross_match:!0}},{data:o,error:n,pending:a}=await j(e);if(this.zebraPrinting=a,o.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const r=URL.createObjectURL(o.value),l=document.createElement("a");l.href=r,l.setAttribute("download",`${Date.now()}.lbl`),l.click(),URL.revokeObjectURL(r)},t.readAsText(o.value),F().$toast.success("Results printed successfully!")}n.value&&(this.zebraPrinting=!1,F().$toast.error(ee),console.error(n.value))},async changeStatus(e,o){this.verifying=!0;const n={route:`${M.testStatus}/${o}/${e}`,method:"PUT",token:`${this.cookie}`},{data:a,error:t,pending:r}=await j(n);this.verifying=r,a.value&&(this.verifying=!1,F().$toast.success(`${this.details.test_type_name} test for ${this.details.client.first_name} ${this.details.client.middle_name!==null?this.details.client.middle_name:""} ${this.details.client.last_name} verified successfully!`),this.viewReport(!0)),t.value&&(console.error(t.value),this.verifying=!1)},updateChanges(){this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return Me.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return Me.printTrackingNumber(this.details.tracking_number)},viewReport(e=!1){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}&printer=${e}`)},getRequestedBy(e){let o="";return e.forEach(n=>{n.status.name==="pending"&&(o=`${n.initiator.first_name} ${n.initiator.last_name}`)}),ue(o)},isRejectedOrVoided(e){return new Set(["voided","test-rejected","rejected","not-done"]).has(e.toLowerCase())}}},gs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27%2015V4H10C9.44772%204%209%204.44772%209%205V43C9%2043.5523%209.44772%2044%2010%2044H38C38.5523%2044%2039%2043.5523%2039%2043V16H28C27.4477%2016%2027%2015.5523%2027%2015ZM29%2014V4.58579L38.4142%2014H29ZM17%2019C17%2018.4477%2017.4477%2018%2018%2018H23C25.2091%2018%2027%2019.7909%2027%2022C27%2024.0759%2025.4186%2025.7825%2023.3948%2025.9808L27%2029.5859L30.2929%2026.293L31.7072%2027.7072L28.4142%2031.0001L31.7071%2034.293L30.2928%2035.7072L27%2032.4143L23.7072%2035.7072L22.2929%2034.293L25.5858%2031.0001L20.5857%2026H19V33H17V25V19ZM23%2024H19V20H23C24.1046%2020%2025%2020.8954%2025%2022C25%2023.1046%2024.1046%2024%2023%2024Z'%20fill='currentColor'/%3e%3c/svg%3e",bs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M19%204C18.4477%204%2018%204.44772%2018%205V8C18%208.55228%2018.4477%209%2019%209H20V11.2729C19.4174%2011.4788%2019%2012.0344%2019%2012.6875V39C19%2041.7614%2021.2386%2044%2024%2044C26.7614%2044%2029%2041.7614%2029%2039V12.6875C29%2012.0344%2028.5826%2011.4788%2028%2011.2729V9H29C29.5523%209%2030%208.55228%2030%208V5C30%204.44772%2029.5523%204%2029%204H19ZM22%2011.6875V9H26V11.6875C26%2012.3406%2026.4174%2012.8962%2027%2013.1021V18H21V13.1021C21.5826%2012.8962%2022%2012.3406%2022%2011.6875Z'%20fill='currentColor'/%3e%3c/svg%3e",ys="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M28.7526%206.3415C28.4782%206.02797%2028.0383%205.91736%2027.6483%206.0639C27.2583%206.21043%2027%206.58339%2027%207V14C27%2015.1046%2027.8954%2016%2029%2016H35C35.3924%2016%2035.7485%2015.7705%2035.9106%2015.4132C36.0728%2015.0559%2036.011%2014.6368%2035.7526%2014.3415L28.7526%206.3415ZM20.75%2023H19.25L20%2021.2L20.75%2023ZM27.5576%205L37%2015.3866V40C37%2041.6569%2035.6569%2043%2034%2043H14C12.3431%2043%2011%2041.6569%2011%2040V8C11%206.34315%2012.3431%205%2014%205H27.5576ZM21.8462%2015.2308C21.5356%2014.4855%2020.8074%2014%2020%2014C19.1926%2014%2018.4644%2014.4855%2018.1538%2015.2308L13.1538%2027.2308C12.729%2028.2504%2013.2112%2029.4213%2014.2308%2029.8462C15.2504%2030.271%2016.4213%2029.7888%2016.8462%2028.7692L17.5833%2027H22.4167L23.1538%2028.7692C23.5787%2029.7888%2024.7496%2030.271%2025.7692%2029.8462C26.7888%2029.4213%2027.271%2028.2504%2026.8462%2027.2308L26.7432%2026.9837C26.8273%2026.9944%2026.913%2027%2027%2027H28V28C28%2029.1046%2028.8954%2030%2030%2030C31.1046%2030%2032%2029.1046%2032%2028V27H33C34.1046%2027%2035%2026.1046%2035%2025C35%2023.8954%2034.1046%2023%2033%2023H32V22C32%2020.8954%2031.1046%2020%2030%2020C28.8954%2020%2028%2020.8954%2028%2022V23H27C26.3521%2023%2025.7762%2023.3081%2025.4107%2023.7857L21.8462%2015.2308ZM15%2031C13.8954%2031%2013%2031.8954%2013%2033C13%2034.1046%2013.8954%2035%2015%2035C13.8954%2035%2013%2035.8954%2013%2037C13%2038.1046%2013.8954%2039%2015%2039H27C28.1046%2039%2029%2038.1046%2029%2037C29%2035.8962%2028.1058%2035.0012%2027.0023%2035H33C34.1046%2035%2035%2034.1046%2035%2033C35%2031.8954%2034.1046%2031%2033%2031L15%2031Z'%20fill='currentColor'%20stroke='%23333333'%20stroke-width='2'%20stroke-linejoin='round'/%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M40%2024.0005C40%2027.3142%2037.3137%2030.0005%2034%2030.0005H32.566L27.7629%2024.9453C27.9142%2024.6638%2028%2024.3419%2028%2024C28%2022.8954%2027.1046%2022%2026%2022H24.9645L21.1644%2018.0005H34C37.3137%2018.0005%2040%2020.6868%2040%2024.0005ZM36%2023.9995C36%2023.1711%2035.3284%2022.4995%2034.5%2022.4995C33.6716%2022.4995%2033%2023.1711%2033%2023.9995C33%2024.8279%2033.6716%2025.4995%2034.5%2025.4995C35.3284%2025.4995%2036%2024.8279%2036%2023.9995ZM30.752%2023.25C31.1673%2023.25%2031.504%2023.5858%2031.504%2024C31.504%2024.4142%2031.1673%2024.75%2030.752%2024.75C30.3367%2024.75%2030%2024.4142%2030%2024C30%2023.5858%2030.3367%2023.25%2030.752%2023.25Z'%20fill='%23333333'/%3e%3cpath%20d='M12%2024C12%2022.8954%2012.8954%2022%2014%2022H16.6881L12.9715%2018.0883C10.1478%2018.5761%208%2021.0375%208%2024.0005C8%2027.3142%2010.6863%2030.0005%2014%2030.0005H24.2896L20.4886%2026H14C12.8954%2026%2012%2025.1046%2012%2024Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44%2024C44%2035.0457%2035.0457%2044%2024%2044C12.9543%2044%204%2035.0457%204%2024C4%2012.9543%2012.9543%204%2024%204C35.0457%204%2044%2012.9543%2044%2024ZM42%2024C42%2029.1085%2039.8719%2033.7199%2036.4539%2036.9962L11.6573%2010.8981C14.8798%207.86121%2019.2226%206%2024%206C33.9411%206%2042%2014.0589%2042%2024ZM24%2042C28.1125%2042%2031.9028%2040.6209%2034.9338%2038.2999L10.2781%2012.35C7.60984%2015.4897%206%2019.5569%206%2024C6%2033.9411%2014.0589%2042%2024%2042Z'%20fill='%23333333'/%3e%3c/svg%3e",ws={key:0},xs=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Cs={class:"fixed inset-0 overflow-y-auto"},ks={class:"flex min-h-full items-center justify-center text-center"},Ss={class:"border-b px-3 py-3 flex items-center justify-between"},Ts=s("img",{src:gs,class:"w-8 h-8 mr-2"},null,-1),$s={class:"flex items-center justify-center mx-auto my-20"},Ps={class:"grid grid-cols-3 gap-4 px-5 py-5"},Is={class:"rounded border"},Rs=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[s("h3",{class:"text-lg font-semibold text-black flex items-center"},[s("img",{src:_t,class:"w-7 h-7 mr-1"}),Q(" Patient ")])],-1),Ds={class:"w-full space-y-2 py-2"},Ls={class:"w-full flex justify-between px-4 py-1"},As=s("h3",{class:"font-semibold"},"Patient Number",-1),Ms={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},js=s("h3",{class:"font-semibold"},"Name",-1),Vs={class:"w-full flex justify-between px-4 py-1"},Fs=s("h3",{class:"font-semibold"},"Sex",-1),qs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Os=s("h3",{class:"font-semibold"},"Age",-1),Es={class:"rounded border"},Bs=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[s("h3",{class:"text-lg font-semibold text-black flex items-center"},[s("img",{src:bs,class:"w-7 h-7 mr-1"}),Q(" Specimen ")])],-1),Ns={class:"w-full space-y-2 py-2"},Us={class:"w-full flex justify-between px-4 py-1"},Hs=s("h3",{class:"font-semibold"},"Specimen Type",-1),Zs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},zs=s("h3",{class:"font-semibold"},"Tracking Number",-1),Gs={class:"w-full flex justify-between px-4 py-1"},Ys=s("h3",{class:"font-semibold"},"Accession Number",-1),Xs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Ks=s("h3",{class:"font-semibold"},"Status",-1),Qs={class:"rounded border max-h-72 overflow-y-auto"},Ws=s("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[s("img",{src:ys,class:"w-7 h-7 mr-1"}),s("h3",{class:"text-lg font-semibold text-black"},"Test")],-1),Js={class:"w-full space-y-2 py-2"},eo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},to=s("h3",{class:"font-semibold"},"Name",-1),so={class:"w-full flex justify-between px-4 py-1"},oo=s("h3",{class:"font-semibold"},"Date Registered",-1),no={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ro=s("h3",{class:"font-semibold"},"Receipt Date",-1),io={class:"w-full flex justify-between px-4 py-1"},lo=s("h3",{class:"font-semibold"},"Test Status",-1),ao={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},co=s("h3",{class:"font-semibold"},"Ward/Location",-1),uo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},po=s("h3",{class:"font-semibold"},"Request Origin",-1),mo={class:"w-full flex justify-between px-4 py-1"},ho=s("h3",{class:"font-semibold"},"Registered By",-1),fo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},_o=s("h3",{class:"font-semibold"},"Requested By",-1),vo={class:"mx-5 rounded border mb-5"},go={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},bo=s("h3",{class:"text-lg font-semibold text-black"},"Results",-1),yo={class:"justify-end flex items-center space-x-3"},wo={key:0},xo={class:"flex items-center space-x-1"},Co=["innerHTML"],ko={key:1,class:"text-xs"},So={key:1,class:"px-4 py-2 flex items-center"},To=s("img",{src:Je,class:"w-6 h-6 mr-2",alt:"no-result-svg"},null,-1),$o={class:"text-lg font-semibold"},Po={class:"text-base text-gray-600 font-normal"},Io={key:2,class:"px-2.5 py-2.5 border-t"};function Ro(e,o,n,a,t,r){const l=xt,i=x("TransitionChild"),T=x("DialogTitle"),$=x("XMarkIcon"),w=vt,p=pe,P=_s,g=x("DialogPanel"),L=x("Dialog"),k=x("TransitionRoot");return v(),I("div",null,[ht(e.$slots,"default",{onClick:o[0]||(o[0]=(...d)=>r.init&&r.init(...d))}),t.details!==null&&t.details.client!==void 0?(v(),I("div",ws,[u(l,{class:"hidden",ref:"corePrinter",orderId:`${t.details.order_id}`,id:`${t.details.client.id}`},null,8,["orderId","id"])])):V("",!0),u(k,{appear:"",show:t.show,as:"template"},{default:S(()=>[u(L,{as:"div",class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[xs]),_:1}),s("div",Cs,[s("div",ks,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(g,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",Ss,[u(T,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>[Ts,Q(" View Test ")]),_:1}),s("button",{onClick:o[1]||(o[1]=(...d)=>r.handleClick&&r.handleClick(...d))},[u($,{class:"w-5 h-5"})])]),ke(s("div",$s,[u(w,{loading:t.loading},null,8,["loading"])],512),[[Se,t.loading]]),s("div",Ps,[s("div",Is,[Rs,s("div",Ds,[s("div",Ls,[As,s("p",null,C(t.details.client.id),1)]),s("div",Ms,[js,s("p",null,C(("capitalize"in e?e.capitalize:E(ue))(`${t.details.client.first_name} ${t.details.client.middle_name!==null?t.details.client.middle_name:""} ${t.details.client.last_name}`)),1)]),s("div",Vs,[Fs,s("p",null,C(t.details.client.sex),1)]),s("div",qs,[Os,s("p",null,C(("calculateAge"in e?e.calculateAge:E(He))(t.details.client.date_of_birth)),1)])])]),s("div",Es,[Bs,s("div",Ns,[s("div",Us,[Hs,s("p",null,C(t.details.specimen_type),1)]),s("div",Zs,[zs,s("p",null,C(t.details.tracking_number),1)]),s("div",Gs,[Ys,s("p",null,C(t.details.accession_number),1)]),s("div",Xs,[Ks,s("p",null,C(("capitalize"in e?e.capitalize:E(ue))(t.details.order_status.split("-").join(" "))),1)])])]),s("div",Qs,[Ws,s("div",Js,[s("div",eo,[to,s("p",null,C(t.details.test_type_name),1)]),s("div",so,[oo,s("p",null,C(t.moment(t.details.created_date).format("DATE_FORMAT"in e?e.DATE_FORMAT:E(_e))),1)]),s("div",no,[ro,s("p",null,C(t.moment(t.details.updated_date).format("DATE_FORMAT"in e?e.DATE_FORMAT:E(_e))),1)]),s("div",io,[lo,s("p",null,C(("capitalizeStr"in e?e.capitalizeStr:E(ft))(t.details.status.split("-").join(" "))),1)]),s("div",ao,[co,s("p",null,C(t.details.requesting_ward),1)]),s("div",uo,[po,s("p",null,C(t.details.request_origin),1)]),s("div",mo,[ho,s("p",null,C(r.getRequestedBy(t.details.status_trail)),1)]),s("div",fo,[_o,s("p",null,C(t.details.requested_by),1)])])])]),s("div",vo,[s("div",go,[bo,s("div",yo,[t.details.status.toLowerCase()==="completed"&&("usePermissions"in e?e.usePermissions:E(te))().can.verify("test_results")?(v(),U(p,{key:0,icon:t.checkIcon,text:"Authorize",click:()=>{r.changeStatus("verified",t.details.id)},color:"success",loading:t.verifying},null,8,["icon","click","loading"])):V("",!0),(t.details.status.toLowerCase()==="completed"||t.details.status.toLowerCase()==="verified")&&("usePermissions"in e?e.usePermissions:E(te))().can.view("reports")?(v(),U(p,{key:1,icon:t.viewIcon,text:"View Report",click:r.viewReport,color:"primary"},null,8,["icon","click"])):V("",!0),u(P,{item:t.details,onUpdate:r.updateChanges,color:"primary"},null,8,["item","onUpdate"]),u(p,{icon:t.printerIcon,text:"Print Accession Number",click:r.printAccessionNumber,color:"primary"},null,8,["icon","click"]),u(p,{icon:t.printerIcon,color:"success",text:"Print Tracking Number",click:r.printTrackingNumber},null,8,["icon","click"])])]),r.isRejectedOrVoided(t.details.status)?(v(),I("div",So,[To,s("h3",$o,[Q("Test Rejected: "),s("span",Po,C(t.details.rejection_reason),1)])])):(v(),I("div",wo,[(v(!0),I(K,null,le(t.details.indicators,(d,_)=>{var b;return v(),I("div",{class:Ee(t.details.indicators.length!==_+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:_},[s("h3",null,C(d.name),1),s("div",xo,[d.result?(v(),I("p",{key:0,innerHTML:d.result.value?d.result.value:"Not done"},null,8,Co)):V("",!0),(b=d.result)!=null&&b.value?(v(),I("span",ko,C(d==null?void 0:d.unit),1)):V("",!0)])],2)}),128))])),t.details.test_type_name=="Cross-match"&&t.details.status.toLowerCase()=="verified"?(v(),I("div",Io,[u(p,{loading:t.zebraPrinting,click:()=>{r.printBBResults()},text:"Print results",color:"primary",icon:t.printerIcon},null,8,["loading","click","icon"])])):V("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Do=oe(vs,[["render",Ro]]),Lo={components:{TransitionRoot:Te,TransitionChild:$e,Dialog:Pe,DialogPanel:Ie,DialogTitle:Re,XMarkIcon:se,UserIcon:ze},data(){return{open:!1,addIcon:Ne,saveIcon:Ge,clearIcon:Ye,name:"",description:"",loading:!1,cookie:de("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const e={route:M.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:o,data:n}=await j(e);n.value&&(this.rawReasons=n.value,n.value.map(a=>{this.reasons.push(a.description)})),o.value&&console.error(o.value)},async submitForm(){this.loading=!0;let e=null;this.rawReasons.map(r=>{r.description===this.reasonsSelected&&(e=r.id)});const o={route:`${M.testStatus}/${this.item.id}/${this.action}?status_reason_id=${e}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:n,error:a,pending:t}=await j(o);this.loading=t,n.value&&(F().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),a.value&&(console.error(a.value),F().$toast.error(ee),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},Ao=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Mo={class:"fixed inset-0 overflow-y-auto"},jo={class:"flex min-h-full items-center justify-center p-4 text-center"},Vo={class:"border-b px-3 py-3 flex items-center justify-between"},Fo=s("img",{src:Je,class:"w-8 h-8 mr-2"},null,-1),qo={class:"mt-2 space-y-3 px-5 py-5"},Oo={class:"space-y-2"},Eo=s("h3",{class:"font-medium"},"Test Type",-1),Bo={class:"border-b border-dotted text-gray-600"},No={class:"space-y-2"},Uo=s("h3",{class:"font-medium"},"Specimen",-1),Ho={class:"border-b border-dotted text-gray-600"},Zo={class:"space-y-2"},zo=s("h3",{class:"font-medium"},"Accession Number",-1),Go={class:"border-b border-dotted text-gray-600"},Yo={class:"w-full flex items-center"},Xo={class:"w-full flex flex-col space-y-2"},Ko={class:"w-full flex flex-col space-y-2 pb-40"},Qo=s("label",{class:"font-medium"},"Select Reason(s)",-1),Wo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Jo(e,o,n,a,t,r){const l=pe,i=x("TransitionChild"),T=x("DialogTitle"),$=x("XMarkIcon"),w=x("FormKit"),p=x("multi-select"),P=Ze,g=x("DialogPanel"),L=x("Dialog"),k=x("TransitionRoot");return v(),I("div",null,[s("div",null,[u(l,{text:n.text,color:"error",icon:n.icon,click:r.init},null,8,["text","icon","click"])]),u(k,{appear:"",show:t.open,as:"template"},{default:S(()=>[u(L,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:S(()=>[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>[Ao]),_:1}),s("div",Mo,[s("div",jo,[u(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[u(g,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[s("div",Vo,[u(T,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:S(()=>[Fo,Q(" "+C(n.text.charAt(0).toUpperCase()+n.text.slice(1))+" Reason ",1)]),_:1}),s("button",{onClick:o[0]||(o[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[u($,{class:"w-5 h-5"})])]),u(w,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"rejectionForm"},{default:S(({value:d})=>[s("div",qo,[s("div",Oo,[Eo,s("p",Bo,C(n.item.test_type_name),1)]),s("div",No,[Uo,s("p",Ho,C(n.item.specimen_type),1)]),s("div",Zo,[zo,s("p",Go,C(n.item.accession_number),1)]),s("div",Yo,[s("div",Xo,[u(w,{type:"text",label:"Person Talked To",validation:n.text.toLowerCase()!=="void"?"required":"",modelValue:t.name,"onUpdate:modelValue":o[1]||(o[1]=_=>t.name=_)},null,8,["validation","modelValue"])])]),s("div",Ko,[Qo,u(p,{style:{"--ms-max-height":"none !important"},modelValue:t.reasonsSelected,"onUpdate:modelValue":o[2]||(o[2]=_=>t.reasonsSelected=_),options:t.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),s("div",Wo,[u(P,{type:"button",text:"Clear form",click:r.resetForm},null,8,["click"]),u(l,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const en=oe(Lo,[["render",Jo]]),tn={components:{MagnifyingGlassIcon:Tt,Listbox:Ft,ListboxButton:qt,ListboxLabel:Ot,ListboxOptions:Et,ListboxOption:Bt,ChevronUpDownIcon:bt,ArrowRightIcon:Qt,ChevronDownIcon:$t,Menu:Nt,MenuButton:Ut,MenuItems:Ht,MenuItem:Zt,CheckIcon:Pt,PopoverButton:Xt,Popover:We,PopoverPanel:Kt,XMarkIcon:se,CheckCircleIcon:Rt,FunnelIcon:Dt},setup(){const e=ve();kt({title:`${St.name.toUpperCase()} - ${e.department} Tests`})},data(){return{moment:Y,addIcon:je,filterIcon:Lt,applyIcon:Wt,acceptIcon:Ue,viewIcon:Be,moreActions:!1,showMore:0,okIcon:ae,moreIcon:At,lessIcon:Mt,clearIcon:jt,dropIcon:ie,editIcon:De,refreshIcon:Vt,dateRange:["",""],search:"",header:"Tests Lists",pages:[{name:"Home",link:"/home"}],headers:[{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions"}],statuses:[{text:"Results",color:"primary",icon:je,status:"completed",show:"started",permission:"enter_test_results"},{text:"Accept",color:"success",icon:ae,status:"pending",show:"not-collected",permission:"accept_test_specimen"},{text:"Start",color:"warning",icon:Jt,status:"started",show:"pending",permission:"start_test"},{text:"Authorize",color:"success",status:"verified",icon:ae,show:"completed",permission:"verify_test_results"}],rejectStatuses:[{name:"Reject",icon:ie,action:"rejected",permission:"void_test"},{name:"Void",icon:ie,action:"voided",permission:"void_test"},{name:"Notdone",icon:ie,action:"not_done",permission:"void_test"}],changing:!1,data:new Array,statusSelected:{name:"select status"},searchField:"accession_number",searchValue:"",cookie:de("token"),loading:!1,serverItemsLength:0,serverOptions:{page:1,rowsPerPage:10,sortBy:"name"},authStore:ve(),testStatuses:new Array,filters:new Array}},created(){var e,o,n,a,t,r;this.serverOptions={page:Number((this._.provides[A]||this.$route).query.page?(this._.provides[A]||this.$route).query.page:1),rowsPerPage:Number((this._.provides[A]||this.$route).query.rowsPerPage?(this._.provides[A]||this.$route).query.rowsPerPage:10)},this.statusSelected=(this._.provides[A]||this.$route).query.status?{name:(this._.provides[A]||this.$route).query.status.toString()}:{name:"select status"},this.search=(e=(this._.provides[A]||this.$route).query.search)!=null&&e.toString()?(o=(this._.provides[A]||this.$route).query.search)==null?void 0:o.toString():"",this.dateRange=[`${(n=(this._.provides[A]||this.$route).query.from)!=null&&n.toString()?(a=(this._.provides[A]||this.$route).query.from)==null?void 0:a.toString():""}`,`${(t=(this._.provides[A]||this.$route).query.to)!=null&&t.toString()?(r=(this._.provides[A]||this.$route).query.to)==null?void 0:r.toString():""}`]},methods:{shouldDisplayMore(e){this.showMore==e?this.showMore=0:this.showMore=e},async searchNlims(e){this.loading=!0;const o={route:`${M.nlimsTestSearch}?tracking_number=${e.replace(/\$$/,"")}`,method:"GET",token:`${this.cookie}`},{data:n,error:a}=await j(o);n.value&&(gt(n.value).then(t=>{const l={...this.$router.currentRoute.value.query,search:t};this.$router.replace({query:l}),this.search=t,this.searchValue=t,this.init()}).catch(t=>{console.error("error routing to merged test: ",t)}),this.loading=!1),a.value&&(console.error(a.value),F().$toast.error(`${a.value.data.error}`),this.loading=!1)},async init(){this.loadStatuses(),this.loading=!0;const{page:e,rowsPerPage:o}=this.serverOptions;let n=this.getIdFromName(this.authStore.user.departments,this.authStore.department),a=this.getIdFromName(this.authStore.locations,this.authStore.selectedLocation),t=this.statusSelected.name==="select status"?"":this.statusSelected.name!==void 0&&this.statusSelected.name;const r=this.dateRange[0].toString()!==""?Y(this.dateRange[0].toString()).format("YYYY-MM-DD"):"",l=this.dateRange[1].toString()!==""?Y(this.dateRange[1].toString()).format("YYYY-MM-DD"):"",i={route:`${M.tests}?minimal=true&page=${e}&per_page=${o}&status=${t.toString().toLowerCase()}&search=${this.search}&department_id=${n}&lab_location=${a}&start_date=${r}&end_date=${l}`,method:"GET",token:`${this.cookie}`},{data:T,error:$,pending:w}=await j(i);this.loading=w,T.value&&(T.value.data.length==0&&this.$toast.warning("No tests found within the specified period"),this.data=T.value.data.map(p=>{var P,g,L,k;return{...p,name:`${ue(`${(P=p.client)==null?void 0:P.first_name} ${((g=p.client)==null?void 0:g.middle_name)!==null?p.client.middle_name:""} ${(L=p.client)==null?void 0:L.last_name}`)} (${p.client.sex}, ${He((k=p.client)==null?void 0:k.date_of_birth)} yrs)`,order_status:`${p.order_status!==null?(p.order_status.charAt(0).toUpperCase()+p.order_status.slice(1)).split("-").join(" "):""}`,status:`${p.status!==null?p.status.charAt(0).toUpperCase()+p.status.slice(1):""}`,created_date:Y(p.created_date).utcOffset(2).format(_e)}}),this.serverItemsLength=T.value.meta.total_count,this.loading=!1),$.value&&(console.error($.value.data),F().$toast.error(ee),this.loading=!1)},async loadStatuses(){const e={route:`${M.testStatus}/all`,method:"GET",token:`${this.cookie}`},{data:o,error:n}=await j(e);o.value&&(this.testStatuses=o.value.map(a=>({id:a.id,name:a.name.charAt(0).toUpperCase()+a.name.slice(1)}))),n.value&&console.error(n.value)},async changeStatus(e,o){this.loading=!0;const n={route:`${M.testStatus}/${o}/${e}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:a,error:t,pending:r}=await j(n);this.loading=r,a.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},async changeOrderStatus(e,o){this.loading=!0;const n={route:`${M.orderStatus}/${e}`,method:"PUT",token:`${this.cookie}`,body:{order_id:o}},{data:a,error:t,pending:r}=await j(n);this.loading=r,a.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},checkStatus(e,o){e.status==="completed"?o.test_type_name.toLowerCase().includes("culture")?this.redirect(o,`/tests/result/culture-sensitivity?accession_number=${o.accession_number}&test_id=${o.id}`):this.redirect(o,`/tests/result?accession_number=${o.accession_number}&test_id=${o.id}`):e.status==="verified"?this.openTestsDialog(o):e.status!==""?this.changeStatus(e.status,o.id):this.printTest(o)},printTest(e){print()},getIdFromName(e,o){const n=e.find(a=>a.name===o);return n?n.id:null},updateTests(e){if(this.showMore=0,typeof e=="object"){this.serverOptions=e;const n={...this.$router.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};this.$router.replace({query:n})}this.init(),this.moreActions=!1},refreshTests(){this.searchValue="",this.search="",this.init()},update(e){this.search=e,this.searchValue=e;const n={...this.$router.currentRoute.value.query,search:e};this.$router.replace({query:n}),e!==""?this.checkTrackingNumber(e)?this.searchNlims(e):this.updateTests(e):this.init()},handleClick(){this.moreActions=!this.moreActions},redirect(e,o){this.$router.push(o)},checkTrackingNumber(e){return/^(x|l).*\d/.test(e.toLowerCase())},updateOnStatus(e){if(e.name!=="select status"){const a=this.filters.find(t=>t.origin==="statuses");a?a.value=e.name:this.filters.push({origin:"statuses",value:e.name})}this.statusSelected=e;const n={...this.$router.currentRoute.value.query,status:e.name.toLowerCase()=="select status"?"":e.name.toLowerCase()};this.$router.replace({query:n}),this.init()},removeFilter(e){e.origin==="statuses"&&this.statusSelected.name!=="select status"&&this.updateOnStatus({name:"select status"});const o=this.filters.findIndex(n=>n.origin===e.origin);o!==-1&&this.filters.splice(o,1),this.init()},isCompletedByCurrentUserOrSuperAdmin(e){const o=this.authStore.user,n=e.completed_by;if(n){if(n.id!==o.id)return!0;if(n.is_super_admin===!0)return!0}return!1},shouldDisplayButton(e,o){const{hasPermission:n}=te(),a=e.status.toLowerCase(),t=o.show.toLowerCase();if(a===t){const r=this.isCompletedByCurrentUserOrSuperAdmin(e);return a==="pending"&&e.order_status.toLowerCase()==="specimen not collected"?!1:o.permission?r&&n.value(String(o.permission)):r}return!1},hideAcceptButton(e){const o=new Set(["rejected","not-done","voided"]),n=new Set(["specimen not collected"]);return!o.has(e.status.toLowerCase())&&n.has(e.order_status.toLowerCase())},hideRejectActions(e){const{can:o}=te();return!new Set(["voided","test-rejected","verified","rejected","not-done"]).has(e.status.toLowerCase())&&o.void("test")},cleared(){this.dateRange=["",""]},openTestsDialog(e){this.$refs.testsDialog!=null&&this.$refs.testsDialog!==void 0&&this.$refs.testsDialog.init(e)}},watch:{authStore:{handler(){this.init()},deep:!0},dateRange:{handler(e,o){const n=e[0].toString()!==""?Y(e[0].toString()).format("YYYY-MM-DD"):"",a=e[1].toString()!==""?Y(e[1].toString()).format("YYYY-MM-DD"):"",r={...this.$router.currentRoute.value.query,from:n,to:a};this.$router.replace({query:r})},deep:!0},statusSelected:{handler(e){this.updateOnStatus(e)},deep:!0}}},sn=""+new URL("experiment-results.CJ8ZtMc5.png",import.meta.url).href,on={class:"py-5 px-5"},nn=s("div",{class:"flex items-center space-x-2 py-5"},[s("img",{src:sn,alt:"experiment-results-icon",class:"w-auto h-8"}),s("h3",{class:"text-2xl font-semibold uppercase"},"Tests List")],-1),rn={class:"flex justify-between items-center w-full py-2 mb-2"},ln={class:"flex items-center space-x-2"},an={class:"relative z-10 w-40"},cn={class:"pt-1"},un={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},dn={class:"w-72 ml-2"},pn={class:"py-3 flex items-center space-x-3"},mn={class:"py-2 flex items-center"},hn={class:"w-full flex items-center justify-between space-x-2"},fn={key:0,class:"flex items-center space-x-2"},_n={key:0,class:"flex items-center space-x-2"},vn=s("div",{id:"tests-container"},null,-1);function gn(e,o,n,a,t,r){const l=tt,i=pe,T=yt,$=x("FunnelIcon"),w=x("datepicker"),p=wt,P=os,g=Do,L=en,k=Ct;return v(),I("div",on,[u(l,{pages:t.pages},null,8,["pages"]),nn,s("div",rn,[s("div",ln,[u(i,{text:"Refresh",color:"warning",icon:t.refreshIcon,click:()=>{r.refreshTests()},loading:t.loading},null,8,["icon","click","loading"]),s("div",an,[u(T,{items:t.testStatuses,modelValue:t.statusSelected,"onUpdate:modelValue":o[0]||(o[0]=d=>t.statusSelected=d)},null,8,["items","modelValue"])]),s("div",cn,[s("div",un,[u($,{class:"w-5 h-5 mr-2"}),Q(" Filter By Date Range "),s("div",dn,[u(w,{required:"",position:"left",onCleared:r.cleared,placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:t.dateRange,"onUpdate:modelValue":o[1]||(o[1]=d=>t.dateRange=d)},null,8,["onCleared","modelValue"])])])])]),u(p,{onUpdate:r.update,search:t.search,"onUpdate:search":o[2]||(o[2]=d=>t.search=d)},null,8,["onUpdate","search"])]),s("div",pn,[(v(!0),I(K,null,le(t.filters,(d,_)=>(v(),U(P,{value:{origin:"statuses",text:d.value},close:"",color:"green",key:_,onUpdate:r.removeFilter},null,8,["value","onUpdate"]))),128))]),u(k,{headers:t.headers,data:t.data,loading:t.loading,searchField:t.searchField,searchValue:t.searchValue,serverItemsLength:t.serverItemsLength,serverOptions:t.serverOptions,onUpdate:r.updateTests},{actions:S(({item:d})=>[s("div",mn,[s("div",hn,[t.showMore!==d.id?(v(),I("div",fn,[u(g,{ref:"testsDialog",onUpdate:r.updateTests},{default:S(()=>[u(i,{color:"primary",text:"View",icon:t.viewIcon,click:()=>{r.openTestsDialog(d)}},null,8,["icon","click"])]),_:2},1032,["onUpdate"]),d.status.toLowerCase()==="completed"&&("usePermissions"in e?e.usePermissions:E(te))().can.edit("test_results")?(v(),U(i,{key:0,click:()=>{r.checkStatus({status:"completed"},d)},text:"Edit",color:"success",icon:t.editIcon},null,8,["click","icon"])):V("",!0),(v(!0),I(K,null,le(t.statuses,(_,b)=>ke((v(),U(i,{color:_.color,text:_.text,icon:_.icon,click:()=>{r.checkStatus(_,d)},key:b},null,8,["color","text","icon","click"])),[[Se,r.shouldDisplayButton(d,_)]])),128)),r.hideAcceptButton(d)?(v(),U(i,{key:1,color:"success",text:"Accept",icon:t.acceptIcon,click:()=>r.changeOrderStatus("accepted",d.order_id)},null,8,["icon","click"])):V("",!0)])):V("",!0),r.hideRejectActions(d)?(v(),U(i,{key:1,click:()=>r.shouldDisplayMore(d.id),color:"",text:"",icon:t.moreActions==!0?t.lessIcon:t.moreIcon},null,8,["click","icon"])):V("",!0)]),r.hideRejectActions(d)&&t.showMore==d.id?(v(),I("div",_n,[(v(!0),I(K,null,le(t.rejectStatuses,(_,b)=>(v(),U(L,{item:d,key:_.name,text:_.name,icon:_.icon,action:_.action,onUpdate:r.updateTests},null,8,["item","text","icon","action","onUpdate"]))),128))])):V("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"]),vn])}const Jn=oe(tn,[["render",gn]]);export{Jn as default};
