import{_ as me}from"./B38OGO74.js";import{_ as fe}from"./BWe303fu.js";import{d as ye,r as E,a as he,a5 as be,aj as ge,u as ve,c as U,C as h,w as I,o as Ee,y as P,b as M,e as Y,f as b,h as o,g as r,t as x,z as H,k as K,H as z,F as xe,j as Re,N as Te,K as Q,m as Le,l as J,E as Se,at as $e,_ as Me}from"./DaVfplCl.js";import{_ as Ye}from"./BNBlrbgu.js";import{_ as Ge,a as ke}from"./B5IH3IIM.js";import{u as Ne,_ as Ce}from"./qDaxYYZu.js";import{u as Ae}from"./MuIwof8c.js";import{_ as qe}from"./aVKuZZVS.js";import{_ as Ue}from"./DlVh0w5e.js";import{a as Fe}from"./C7tBKTSS.js";import{P as Oe}from"./Dr0mg474.js";import{u as We}from"./TCrkXuHj.js";import{r as je}from"./B6aIjIoK.js";import{r as Be}from"./Dqe_SWQt.js";import"./CaCwXEk-.js";import"./Bk1fID9q.js";import"./CrLTzj8x.js";import"./BeuONbta.js";import"./C4Sn6TUr.js";import"./WTOBM9CX.js";import"./BBPlnGp-.js";import"./dfRNb6Oz.js";import"./zVsiTWFb.js";const Ve={class:"px-5 py-5"},Ie={class:"flex items-center py-5"},Pe=r("img",{src:qe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),He={class:"text-2xl font-semibold uppercase"},Ke={class:"w-full flex items-center justify-between mb-5"},ze={class:"w-full flex items-center space-x-3"},Qe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Je={class:"w-72 ml-2"},Xe={class:"w-40"},Ze={class:"w-48 flex items-end justify-end"},we={class:"rounded border"},De={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},et=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ue,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold uppercase"},"INFECTION REPORT")],-1),tt={key:0},rt={class:"hidden"},ot=r("h3",null,"INFECTION REPORT",-1),st={class:"text-lg font-semibold py-2 px-2"},nt={class:"text-normal font-normal"},lt={id:"print-container"},at=["innerHTML"],ct=r("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"SUMMARY",-1),it={class:"w-full border-t"},dt=r("thead",null,[r("tr",{class:"border-b border-t bg-gray-100"},[r("th",{class:"px-2 py-2 border-r text-left"},"TESTS"),r("th",{class:"px-2 py-2 text-left"},"TOTAL")])],-1),ut={class:"px-2 py-2 border-r border-b"},_t=["onClick"],pt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},mt=r("img",{src:ke,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),ft=r("p",{class:"text-base"},"Data not found, please generate report",-1),yt=[mt,ft],Vt=ye({__name:"infection",setup(ht){Ae({title:`${Oe.name.toUpperCase()} - Infection Report`});const X=E("Infection Report"),Z=E([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),G=E([]),m=E({id:0,name:"select department"}),F=he("token"),{loading:g,executeCancellableRequest:w,cancelRequest:D}=Ne(),v=be(),f=ge(),{$toast:R}=ve(),k=We(),N=E([]),O=E([]),W=E(!1),a=E(new Array("","")),L=U(()=>a.value[0]?h(a.value[0]).format("YYYY-MM-DD"):""),S=U(()=>a.value[1]?h(a.value[1]).format("YYYY-MM-DD"):""),ee=()=>{a.value=new Array("","")},te=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',_=(s,e,l)=>{const n=s.indexOf(e);return n!==-1?s.slice(0,n)+l+s.slice(n+e.length):s},re=(s,e,l,n)=>{l!==0&&n!==""?v.push(`/reports/${n}?origin=aggregate&type=infection-report&from=${L.value}&to=${S.value}&test=${s} - ${e}&department=${m.value.name}&count=${l}`):R.warning("No data found for this month")},oe=s=>{W.value=!1;let e="",l="",n="",c="",d=0,u=0,p=0,y=0,T=0;return s.reduce((t,$)=>{const q=$.measures.flatMap(C=>C.results.flatMap(B=>{const V=Object.keys(B[0])[0],de=B[0][V];return Object.entries(de).map(([ue,_e])=>{const pe=_e;return{test_type:$.test_type,measure:C.name,result:V,gender:ue==="F"?"Female":"Male",...pe}})}));return t.push(...q),t},new Array).forEach(t=>{u++,p++,d++,n===t.test_type?(e+="<tr>",l!==t.measure?(l=t.measure,c=t.result,e=_(e,"NEW_MEASURE",u.toString()),e=e.replace("NEW_RESULT",p.toString()),e=_(e,"RESULT_TOTAL",y.toString()),u=0,p=0,y=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):c!==t.result&&(e=e.replace(/NEW_RESULT/g,p.toString()),e=_(e,"RESULT_TOTAL",y.toString()),c=t.result,p=0,y=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(n=t.test_type,l=t.measure,c=t.result,e=e.replace(/NEW_TEST/g,d.toString()),e=_(e,"NEW_MEASURE",u.toString()),e=e.replace(/NEW_RESULT/g,p.toString()),e=_(e,"RESULT_TOTAL",y.toString()),e=_(e,"TEST_TOTAL",T.toString()),u=0,p=0,y=0,d=0,T=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>";const $=A("L_E_5");e+=`
      <td
        class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${$}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">
        ${t.L_E_5?t.L_E_5.count.toString():"0"}
      </td>`;const q=A("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${q}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">`+(t.G_5_L_E_14?t.G_5_L_E_14.count:0).toString()+"</td>";const C=A("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${C}"
        data-count="${t.G_14?t.G_14.count:0}"
        data-ids="${t.G_14?t.G_14.associated_ids:""}">`+(t.G_14?t.G_14.count:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0)).toString()+"</td>",y+=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0),c===t.result&&p==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),u==0&&(T=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0))}),e=_(e,"NEW_TEST",(++d).toString()),e=_(e,"NEW_MEASURE",(++u).toString()),e=_(e,"NEW_RESULT",(++p).toString()),e=_(e,"RESULT_TOTAL",y.toString()),e=_(e,"TEST_TOTAL",T.toString()),e+="</tr>",W.value=!0,e},A=s=>({L_E_5:"Less than or equal to 5 years old",G_5_L_E_14:"Greater than 5 years old and less than or equal to 14 years old",G_14:"Greater than 14 years old"})[s],se=s=>{const e=te(),l=s.length>0?oe(s):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${l}</table>`};async function ne(){const{data:s,error:e}=await Le({route:`${J.departments}`,method:"GET",token:`${F.value}`});s.value&&(G.value=s.value,G.value.some(l=>l.id===0)||G.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function j(){if(ce())R.warning("Please select a department");else{g.value=!0;let s=a.value[0].toString()!=""?h(a.value[0].toString()).format("YYYY-MM-DD"):"",e=a.value[1].toString()!=""?h(a.value[1].toString()).format("YYYY-MM-DD"):"";const l={route:`${J.aggregateReports}infection?from=${s}&to=${e}&department=${m.value.name}&report_id=${f.query.report_id}`,method:"GET",token:`${F.value}`},{data:n,error:c,pending:d}=await w(l);g.value=d,n.value&&(g.value=!1,N.value=n.value.data,O.value=n.value.summary,ae(n.value.report_id),R.success("Report data generated successfully!")),c.value&&(console.error(c.value),g.value=!1,R.error(Se))}}const le=s=>{const e=s.target;if(e.tagName==="TD"&&e.id==="tdRef"){const{test:l,ward:n,count:c,ids:d}=e.dataset;if(c&&d){const u=parseInt(c,10);u!==0&&d!==""?v.push(`/reports/${d}?origin=aggregate&type=infection-report&from=${L.value}&to=${S.value}&test=${l} - ${n}&department=${m.value.name}&count=${u}`):R.warning("No data found for this month")}else R.warning("No data found for this month")}},ae=s=>{const l={...v.currentRoute.value.query,report_id:s};v.replace({query:l}).catch(n=>{console.error("Failed to replace route:",n)})},ce=()=>m.value.name==$e;I(a,()=>{const s=a.value[0]?h(a.value[0]).format("YYYY-MM-DD"):"",e=a.value[1]?h(a.value[1]).format("YYYY-MM-DD"):"";if(s||e){const n={...v.currentRoute.value.query,...s&&{from:s},...e&&{to:e}};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}},{deep:!0}),I(m,(s,e)=>{if(s!==e){const n={...v.currentRoute.value.query,department:s.name||void 0,report_id:""};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}});const ie=U(()=>f.query.to!==void 0&&f.query.from!==void 0&&f.query.department!==void 0?(a.value=[f.query.from,f.query.to],m.value.name=`${f.query.department}`,f.query.to!==""&&f.query.from!==""&&f.query.department!==""):!1);return Ee(()=>{ie.value?j():g.value=!1}),ne(),(s,e)=>{const l=me,n=P("datepicker"),c=fe,d=Me,u=P("FormKit"),p=Ye,y=Ge,T=Ce;return M(),Y("div",Ve,[b(l,{pages:o(Z)},null,8,["pages"]),r("div",Ie,[Pe,r("h3",He,x(o(X)),1)]),r("div",Ke,[b(u,{type:"form","submit-label":"Update",onSubmit:j,actions:!1,id:"submitForm"},{default:H(({value:i})=>[r("div",ze,[r("div",Qe,[b(o(je),{class:"w-5 h-5 mr-2"}),K(" Filter By Date Range "),r("div",Je,[b(n,{onCleared:ee,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:o(a),"onUpdate:modelValue":e[0]||(e[0]=t=>z(a)?a.value=t:null)},null,8,["modelValue"])])]),r("div",Xe,[b(c,{items:o(G),modelValue:o(m),"onUpdate:modelValue":e[1]||(e[1]=t=>z(m)?m.value=t:null)},null,8,["items","modelValue"])]),r("div",null,[b(d,{loading:o(g),color:"primary",type:"submit",text:"Generate Report",icon:o(Be),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),r("div",Ze,[b(o(Fe),{element:"print-container",filename:`infection_report_from_${o(h)(o(L)).format("DD_MM_YYYY")}_to_${o(h)(o(S)).format("DD_MM_YYYY")}_for_${o(k).details.name.toLowerCase().split(" ").join("_")}`},{default:H(()=>[b(p,{text:"Export Excel"})]),_:1},8,["filename"])])]),r("div",null,[r("div",we,[r("div",De,[et,b(y)]),o(N).length>0&&!o(g)?(M(),Y("div",tt,[r("div",rt,[ot,r("h3",null,x(o(k).details.name),1),r("p",null,x(o(k).details.address),1),r("p",null,x(o(k).details.phone),1)]),r("div",st,[K(" Tests Performed Period: "),r("span",nt,x(o(L)!=""?o(h)(o(L)).format("DD/MM/YYYY"):"")+" - "+x(o(S)!=""?o(h)(o(S)).format("DD/MM/YYYY"):""),1)]),r("div",lt,[r("div",{innerHTML:se(o(N)),onClick:le},null,8,at),r("div",null,[ct,r("table",it,[dt,r("tbody",null,[(M(!0),Y(xe,null,Re(o(O),(i,t)=>(M(),Y("tr",{key:i.name,class:Te(t%2===0?"bg-white":"bg-gray-50")},[r("td",ut,x(i.name),1),r("td",{onClick:$=>re(i.name,o(m).name,i!=null&&i.total?i.total:0,i!=null&&i.associated_ids?i.associated_ids:""),class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(i.total),9,_t)],2))),128))])])])])])):Q("",!0),o(N).length==0&&!o(g)?(M(),Y("div",pt,yt)):Q("",!0),b(T,{condition:o(g),cancelReportGeneration:()=>o(D)()},null,8,["condition","cancelReportGeneration"])])])])}}});export{Vt as default};
