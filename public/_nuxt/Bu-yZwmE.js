import{_ as he}from"./BxxC6xAb.js";import{b as D,e as $,g as e,d as ie,r as w,a as B,u as F,w as R,y,f as l,z as n,h as o,Y as z,p as H,G,V as K,j as L,q as X,H as N,S as J,l as S,m as T,E as Y,C as U,_ as O,s as j,t as I,a3 as ne,a0 as ve,A as re,x as le,i as q,v as E,n as ge,B as de,a4 as ye,F as xe,k as be,I as we,X as Ce,a5 as Ve,L as te,K as ae}from"./CUNWPMFO.js";import{_ as ce}from"./DrKpGisQ.js";import{r as oe}from"./Ibz9KHbp.js";import{r as ue}from"./CbSBsqZb.js";import{r as me}from"./WVtptseR.js";import{_ as ke}from"./DA8Al3VR.js";import{u as se}from"./C42pgIDN.js";import{P as De}from"./BSY9E36G.js";import{u as Pe}from"./C_BiN2iC.js";import{u as Me}from"./C_AIsC7W.js";import{r as $e}from"./B73RjFxO.js";import{r as Fe}from"./BE-ReBvs.js";import{r as Ie}from"./B-Af-kVh.js";import"./CDJ4C1jN.js";import"./C5KkEBG1.js";import"./CxvClpzF.js";function Ae(s,t){return D(),$("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm4.28 10.28a.75.75 0 0 0 0-1.06l-3-3a.75.75 0 1 0-1.06 1.06l1.72 1.72H8.25a.75.75 0 0 0 0 1.5h5.69l-1.72 1.72a.75.75 0 1 0 1.06 1.06l3-3Z","clip-rule":"evenodd"})])}function Ne(s,t){return D(),$("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M4.5 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0ZM14.25 8.625a3.375 3.375 0 1 1 6.75 0 3.375 3.375 0 0 1-6.75 0ZM1.5 19.125a7.125 7.125 0 0 1 14.25 0v.003l-.001.119a.75.75 0 0 1-.363.63 13.067 13.067 0 0 1-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 0 1-.364-.63l-.001-.122ZM17.25 19.128l-.001.144a2.25 2.25 0 0 1-.233.96 10.088 10.088 0 0 0 5.06-1.01.75.75 0 0 0 .42-.643 4.875 4.875 0 0 0-6.957-4.611 8.586 8.586 0 0 1 1.71 5.157v.003Z"})])}const Q="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M25.1716%208.17157C26.0154%207.32777%2027.1424%206.93977%2028.2466%207.00756C27.631%205.25582%2025.9622%204%2024%204C21.5147%204%2019.5%206.01472%2019.5%208.5C19.5%2010.9853%2021.5147%2013%2024%2013C24.1751%2013%2024.348%2012.99%2024.5179%2012.9705C23.6533%2011.4448%2023.8712%209.47191%2025.1716%208.17157Z'%20fill='%23333333'/%3e%3cpath%20d='M13.8493%2017.0002C15.0941%2015.7409%2016.8649%2015%2018.9884%2015H29.1716L26.5858%2012.4142C25.8047%2011.6332%2025.8047%2010.3668%2026.5858%209.58579C27.3668%208.80474%2028.6332%208.80474%2029.4142%209.58579L35.4142%2015.5858C35.9862%2016.1578%2036.1573%2017.018%2035.8478%2017.7654C35.5382%2018.5127%2034.8089%2019%2034%2019H30V42C30%2043.0722%2029.1544%2043.9537%2028.0831%2043.9983C27.0118%2044.0428%2026.096%2043.2346%2026.0069%2042.1661L25.1597%2032H22.8403L21.9931%2042.1661C21.904%2043.2346%2020.9882%2044.0428%2019.9169%2043.9983C18.8456%2043.9537%2018%2043.0722%2018%2042V30H21C23.2091%2030%2025%2028.2091%2025%2026C25%2023.7909%2023.2091%2022%2021%2022H18V19.1088C17.3996%2019.2527%2016.9805%2019.5224%2016.694%2019.8123C16.2492%2020.2622%2016.0063%2020.879%2016.0001%2021.5192C15.994%2022.158%2016.2233%2022.758%2016.6498%2023.1924C17.0565%2023.6064%2017.7714%2024%2018.9884%2024H20.9913C22.0959%2024%2022.9913%2024.8954%2022.9913%2026C22.9913%2027.1046%2022.0959%2028%2020.9913%2028H18.9893C16.8375%2028%2015.0466%2027.2686%2013.796%2025.9951C12.5652%2024.742%2011.9848%2023.092%2012.0003%2021.4808C12.0158%2019.871%2012.6259%2018.2378%2013.8493%2017.0002Z'%20fill='%23333333'/%3e%3c/svg%3e",Ue={class:"fixed inset-0 overflow-y-auto"},Se={class:"flex min-h-full items-center justify-center p-4 text-center"},Te={class:"border-b px-3 py-3 flex items-center justify-between"},Ye={class:"mt-2 space-y-3 px-5 py-5"},He={class:"w-full grid grid-cols-3 gap-2"},je={class:"grid grid-cols-2 gap-2 space-x-3"},qe={class:"w-full flex flex-col space-y-2"},Be={class:"w-full"},Le={class:"w-full grid grid-cols-2 gap-2"},Oe={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Ze=ie({__name:"index",props:{openForm:{type:Boolean},defaultData:{}},emits:["onPatientCreated","sethandleDialog"],setup(s,{emit:t}){const h=t,f=w(!1),a=w(!1),r=B("token"),x=F().$toast,d=s,C=w(""),b=w(""),u=w(""),c=w(""),g=w(""),v=w(""),_=w(""),P=w(!1),M=w(0),m=()=>{f.value=!f.value,h("sethandleDialog",f.value)},W=async()=>{a.value=!0;const p={route:S.clients,method:"POST",token:`${r.value}`,body:{client:{uuid:""},person:{first_name:b.value,middle_name:u.value,last_name:c.value,sex:g.value.charAt(0),date_of_birth:_.value,birth_date_estimated:P.value},client_identifiers:{current_village:"",current_district:"",current_traditional_authority:"",physical_address:v.value}}},{data:i,error:V,pending:A}=await T(p);a.value=A,i.value&&(x.success("Patient created successfully!"),m(),Z(),h("onPatientCreated",!0),a.value=!1),V.value&&(console.error(V.value),x.error(Y),a.value=!1)},Z=()=>{C.value="",b.value="",u.value="",c.value="",g.value="",v.value="",_.value="",P.value=!1,M.value=0},pe=p=>{if(p&&P.value){const V=U().year()-Number(p),A=_.value?U(_.value,"MMMM D, YYYY").format("MM-DD"):"06-01",ee=U(`${V}-${A}`,"YYYY-MM-DD");_.value=ee.format("MMMM D, YYYY")}},fe=p=>{const i=U(p,"MMMM D, YYYY"),A=U().diff(i,"years");M.value=A};return R(_,(p,i)=>{p&&p!==i&&(P.value=!1,fe(p))}),R(M,(p,i)=>{p&&p!==i&&(P.value=!0,pe(Number(p)))}),R(()=>d.defaultData,p=>{p&&(C.value=p.uuid,b.value=p.firstName,c.value=p.lastName,g.value=p.gender.toUpperCase()=="M"?"Male":"Female")}),R(()=>d.openForm,p=>{f.value=p}),(p,i)=>{const V=y("FormKit"),A=y("datepicker"),ee=ce,_e=O;return D(),$("div",null,[l(o(J),{appear:"",show:o(f),as:"template"},{default:n(()=>[l(o(z),{as:"div",onClose:m,class:"relative z-10"},{default:n(()=>[l(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>i[7]||(i[7]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Ue,[e("div",Se,[l(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:n(()=>[l(o(G),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:n(()=>[e("div",Te,[l(o(K),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:n(()=>i[8]||(i[8]=[e("img",{src:Q,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),L(" Create patient ")])),_:1}),e("button",{onClick:m},[l(o(X),{class:"w-5 h-5"})])]),l(V,{type:"form",id:"patientForm","submit-label":"Update",onSubmit:W,actions:!1},{default:n(({})=>[e("div",Ye,[e("div",He,[l(V,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:o(b),"onUpdate:modelValue":i[0]||(i[0]=k=>N(b)?b.value=k:null)},null,8,["modelValue"]),l(V,{type:"text",label:"Middle name",modelValue:o(u),"onUpdate:modelValue":i[1]||(i[1]=k=>N(u)?u.value=k:null)},null,8,["modelValue"]),l(V,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:o(c),"onUpdate:modelValue":i[2]||(i[2]=k=>N(c)?c.value=k:null)},null,8,["modelValue"])]),e("div",je,[e("div",qe,[i[9]||(i[9]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Be,[l(A,{placeholder:"Click to select a date",modelValue:o(_),"onUpdate:modelValue":i[3]||(i[3]=k=>N(_)?_.value=k:null),range:!1,"max-date":new Date,"ignore-time-validation":!0,teleport:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",required:""},null,8,["modelValue","max-date"])])]),l(V,{type:"text",label:"Age",modelValue:o(M),"onUpdate:modelValue":i[4]||(i[4]=k=>N(M)?M.value=k:null),validation:"required|number"},null,8,["modelValue"])]),e("div",Le,[l(V,{modelValue:o(g),"onUpdate:modelValue":i[5]||(i[5]=k=>N(g)?g.value=k:null),type:"radio",label:"Sex",options:["Male","Female"],validation:"required"},null,8,["modelValue"]),l(V,{type:"text",label:"Physical Address",validation:"required",modelValue:o(v),"onUpdate:modelValue":i[6]||(i[6]=k=>N(v)?v.value=k:null)},null,8,["modelValue"])])]),e("div",Oe,[l(ee,{type:"button",click:()=>{Z()},text:"Clear form"},null,8,["click"]),l(_e,{type:"submit",click:()=>{},color:"success",icon:o(oe),text:"Save changes",loading:o(a)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),Re={class:"fixed inset-0 overflow-y-auto"},Ee={class:"flex min-h-full items-center justify-center p-4 text-center"},ze={class:"border-b px-3 py-3 flex items-center justify-between"},Ge={class:"mt-2 space-y-3 px-5 py-5"},Ke={class:"w-full grid grid-cols-2 gap-2"},Xe={class:"items-center"},Je={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Qe=ie({__name:"index",emits:["action-completed"],setup(s,{emit:t}){const h=t,f=w(!1),a=w(!1),r=B("token"),{$toast:x}=F(),d=w({firstName:"",lastName:"",gender:""}),C=()=>f.value=!f.value,b=async()=>{a.value=!0;const u={route:ve(S.client.search,{first_name:d.value.firstName,last_name:d.value.lastName,gender:d.value.gender}),method:"GET",token:`${r.value}`},{data:c,error:g,pending:v}=await T(u);a.value=v,c.value&&(C(),h("action-completed",{patient:c.value,defaults:d.value}),d.value={firstName:"",lastName:"",gender:""}),g.value&&x.error(`${Y}`),a.value=f.value=!1};return(u,c)=>{const g=O,v=y("FormKit");return D(),$("div",null,[e("div",null,[l(g,{text:"Find/Create Patient",color:"primary",icon:o(j),click:C},null,8,["icon"])]),l(o(J),{appear:"",show:o(f),as:"template"},{default:n(()=>[l(o(z),{as:"div",onClose:C,class:"relative z-10"},{default:n(()=>[l(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>c[3]||(c[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Re,[e("div",Ee,[l(o(H),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:n(()=>[l(o(G),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:n(()=>[e("div",ze,[l(o(K),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:n(()=>c[4]||(c[4]=[e("img",{src:Q,class:"w-8 h-8 mr-2"},null,-1),L(" "+I("Find or Create patient"))])),_:1}),e("button",{onClick:C},[l(o(X),{class:"w-5 h-5"})])]),l(v,{type:"form",onSubmit:b,actions:!1},{default:n(({})=>[e("div",Ge,[e("div",Ke,[l(v,{type:"text",label:"First name",validation:"required",modelValue:o(d).firstName,"onUpdate:modelValue":c[0]||(c[0]=_=>o(d).firstName=_)},null,8,["modelValue"]),l(v,{type:"text",label:"Last name",validation:"required",modelValue:o(d).lastName,"onUpdate:modelValue":c[1]||(c[1]=_=>o(d).lastName=_)},null,8,["modelValue"])]),e("div",Xe,[l(v,{modelValue:o(d).gender,"onUpdate:modelValue":c[2]||(c[2]=_=>o(d).gender=_),type:"radio",label:"Gender",options:"sex"in u?u.sex:o(ne),validation:"required"},null,8,["modelValue","options"])])]),e("div",Je,[l(g,{type:"submit",click:()=>{},color:"success",icon:o(Ae),text:"Find",loading:o(a)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),We={components:{TransitionRoot:J,TransitionChild:H,Dialog:z,DialogPanel:G,DialogTitle:K,XMarkIcon:X,UserIcon:ue},props:{data:{required:!0,type:Object}},data(){return{details:new Object,open:!1,addIcon:j,viewIcon:re,saveIcon:oe,clearIcon:me,cookie:B("token"),loading:!1}},methods:{async init(){this.adjustVisibility(),this.loading=!0;const s={route:`${S.clients}/${this.data.client_id}`,method:"GET",token:`${this.cookie}`},{data:t,pending:h,error:f}=await T(s);t.value&&(this.details=t.value,this.loading=!1),f.value&&(console.log(f.value),F().$toast.error(Y))},adjustVisibility(){this.open=!this.open}}},et={class:"fixed inset-0 overflow-y-auto"},tt={class:"flex min-h-full items-center justify-center p-4 text-center"},at={class:"border-b px-3 py-3 flex items-center justify-between"},st={class:"flex items-center justify-center mx-auto my-20"},lt={class:"mt-2 space-y-3 px-5 py-5"},ot={class:"w-full flex flex-col space-y-1"},it={class:"underline"},nt={class:"w-full flex flex-col space-y-1"},rt={class:"underline"},dt={class:"w-full flex flex-col space-y-1"},ct={class:"underline"},ut={class:"w-full flex flex-col space-y-1"},mt={class:"underline"},pt={class:"w-full flex flex-col space-y-1"},ft={class:"underline"};function _t(s,t,h,f,a,r){const x=O,d=y("TransitionChild"),C=y("DialogTitle"),b=y("XMarkIcon"),u=ge,c=y("DialogPanel"),g=y("Dialog"),v=y("TransitionRoot");return D(),$("div",null,[e("div",null,[l(x,{text:"View",color:"success",icon:a.viewIcon,click:r.init},null,8,["icon","click"])]),l(v,{appear:"",show:a.open,as:"template"},{default:n(()=>[l(g,{as:"div",onClose:r.adjustVisibility,class:"relative z-10"},{default:n(()=>[l(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>t[1]||(t[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",et,[e("div",tt,[l(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:n(()=>[l(c,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:n(()=>[e("div",at,[l(C,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:n(()=>t[2]||(t[2]=[e("img",{src:Q,class:"w-8 h-8 mr-2"},null,-1),L(" View patient ")])),_:1}),e("button",{onClick:t[0]||(t[0]=(..._)=>r.adjustVisibility&&r.adjustVisibility(..._))},[l(b,{class:"w-5 h-5"})])]),q(e("div",st,[l(u,{loading:a.loading},null,8,["loading"])],512),[[E,a.loading]]),q(e("div",lt,[e("div",ot,[t[3]||(t[3]=e("label",{class:"font-semibold text-lg"},"Name",-1)),e("p",it,I(`${a.details.first_name} ${a.details.last_name}`),1)]),e("div",nt,[t[4]||(t[4]=e("label",{class:"font-semibold text-lg"},"National Patient ID",-1)),e("p",rt,I(a.details.npid),1)]),e("div",dt,[t[5]||(t[5]=e("label",{class:"font-semibold text-lg"},"Date Of Birth",-1)),e("p",ct,I(a.details.date_of_birth),1)]),e("div",ut,[t[6]||(t[6]=e("label",{class:"font-semibold text-lg"},"Sex",-1)),e("p",mt,I(a.details.sex),1)]),e("div",pt,[t[7]||(t[7]=e("label",{class:"font-semibold text-lg"},"Physical Address",-1)),e("p",ft,I(a.details.physical_address),1)])],512),[[E,!a.loading]])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ht=le(We,[["render",_t]]),vt={components:{TransitionRoot:J,TransitionChild:H,Dialog:z,DialogPanel:G,DialogTitle:K,XMarkIcon:X,UserIcon:ue},props:{data:{required:!0,type:Object}},data(){return{details:new Object,open:!1,addIcon:j,saveIcon:oe,clearIcon:me,editIcon:de,loading:!1,cookie:B("token"),updatingFromDob:!1,updatingFromAge:!1,estimatedDate:!1}},methods:{async init(){this.handleDialog();const s={route:`${S.clients}/${this.data.client_id}`,method:"GET",token:`${this.cookie}`},{data:t,error:h}=await T(s);t.value&&(this.details=t.value),h.value&&(console.error(h.value),F().$toast.error(Y))},async submitForm(){this.loading=!0;const s={route:`${S.clients}/${this.data.client_id}`,method:"PUT",token:`${this.cookie}`,body:{client:{uuid:this.details.uuid},person:{first_name:this.details.first_name,middle_name:this.details.middle_name,last_name:this.details.last_name,sex:this.details.sex.charAt(0),date_of_birth:this.details.date_of_birth,birth_date_estimated:this.estimatedDate},client_identifiers:[{type:"physical_address",value:this.details.physical_address},{type:"phone",value:this.details.phone},{type:"npid",value:this.details.npid}]}},{data:t,error:h,pending:f}=await T(s);this.loading=f,t.value&&(this.loading=!1,this.details={},F().$toast.success("Patient updated successfully!"),this.handleDialog(),this.$emit("update",!0)),h.value&&(this.loading=!1,console.error(h.value),F().$toast.error(`${Y}`))},handleDialog(){this.open=!this.open}},watch:{"details.date_of_birth"(s){this.updatingFromAge||(this.updatingFromDob=!0,this.details.age=Number(ye(s)),this.updatingFromDob=!1)},"details.age"(s,t){s!=t&&!this.updatingFromDob&&(this.updatingFromAge=!0,this.details.date_of_birth=U().subtract(s,"years").format("YYYY-MM-DD"),this.updatingFromAge=!1,this.estimatedDate=!0)}}},gt={class:"fixed inset-0 overflow-y-auto"},yt={class:"flex min-h-full items-center justify-center p-4 text-center"},xt={class:"border-b px-3 py-3 flex items-center justify-between"},bt={class:"mt-2 space-y-3 px-5 py-5"},wt={class:"w-full grid grid-cols-2 gap-2"},Ct={class:"w-full grid grid-cols-3 gap-2"},Vt={class:"grid grid-cols-2 gap-2 space-x-3"},kt={class:"w-full flex flex-col space-y-2"},Dt={class:"w-full"},Pt={class:"lex items-center"},Mt=["value"],$t={class:"ml-2"},Ft={class:"w-full grid grid-cols-2 gap-2"},It={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function At(s,t,h,f,a,r){const x=O,d=y("TransitionChild"),C=y("DialogTitle"),b=y("XMarkIcon"),u=y("FormKit"),c=y("datepicker"),g=ce,v=y("DialogPanel"),_=y("Dialog"),P=y("TransitionRoot");return D(),$("div",null,[e("div",null,[l(x,{text:"Edit",color:"primary",icon:a.editIcon,click:r.init},null,8,["icon","click"])]),l(P,{appear:"",show:a.open,as:"template"},{default:n(()=>[l(_,{as:"div",onClose:r.handleDialog,class:"relative z-10"},{default:n(()=>[l(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>t[11]||(t[11]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",gt,[e("div",yt,[l(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:n(()=>[l(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:n(()=>[e("div",xt,[l(C,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:n(()=>t[12]||(t[12]=[e("img",{src:Q,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),L(" Edit patient ")])),_:1}),e("button",{onClick:t[0]||(t[0]=(...M)=>r.handleDialog&&r.handleDialog(...M))},[l(b,{class:"w-5 h-5"})])]),l(u,{type:"form",id:"patientForm","submit-label":"Update",onSubmit:r.submitForm,actions:!1},{default:n(({value:M})=>[e("div",bt,[e("div",wt,[l(u,{type:"text",label:"Patient ID",modelValue:a.details.uuid,"onUpdate:modelValue":t[1]||(t[1]=m=>a.details.uuid=m)},null,8,["modelValue"]),l(u,{type:"text",label:"National Patient ID",modelValue:a.details.npid,"onUpdate:modelValue":t[2]||(t[2]=m=>a.details.npid=m)},null,8,["modelValue"])]),e("div",Ct,[l(u,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:a.details.first_name,"onUpdate:modelValue":t[3]||(t[3]=m=>a.details.first_name=m)},null,8,["modelValue"]),l(u,{type:"text",label:"Middle name",modelValue:a.details.middle_name,"onUpdate:modelValue":t[4]||(t[4]=m=>a.details.middle_name=m)},null,8,["modelValue"]),l(u,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:a.details.last_name,"onUpdate:modelValue":t[5]||(t[5]=m=>a.details.last_name=m)},null,8,["modelValue"])]),e("div",Vt,[e("div",kt,[t[13]||(t[13]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Dt,[l(c,{placeholder:new Date().toDateString(),"input-class-name":"datepicker","as-single":"",shortcuts:!0,modelValue:a.details.date_of_birth,"onUpdate:modelValue":t[6]||(t[6]=m=>a.details.date_of_birth=m),"text-input":!0,range:!1,"max-date":new Date,format:"dd/MM/yyyy",position:"right",teleport:!0,formatter:s.DATE_FORMATter},null,8,["placeholder","modelValue","max-date","formatter"])])]),l(u,{type:"text",label:"Age",modelValue:a.details.age,"onUpdate:modelValue":t[7]||(t[7]=m=>a.details.age=m)},null,8,["modelValue"])]),e("div",Pt,[t[14]||(t[14]=e("label",{class:"mr-5 font-medium"},"Sex",-1)),(D(!0),$(xe,null,be("sex"in s?s.sex:o(ne),(m,W)=>(D(),$("label",{class:"flex items-center mr-2",key:W},[q(e("input",{required:!0,"onUpdate:modelValue":t[8]||(t[8]=Z=>a.details.sex=Z),value:m.value,type:"radio",placeholder:"Male",class:"w-4 h-4 rounded-full bg-sky-500 border-sky-800 text-sky-500 focus:ring-sky-800"},null,8,Mt),[[we,a.details.sex]]),e("span",$t,I(m.name),1)]))),128))]),e("div",Ft,[l(u,{type:"text",label:"Physical Address",modelValue:a.details.physical_address,"onUpdate:modelValue":t[9]||(t[9]=m=>a.details.physical_address=m)},null,8,["modelValue"]),l(u,{type:"tel",label:"Phone number","prefix-icon":"telephone",modelValue:a.details.phone,"onUpdate:modelValue":t[10]||(t[10]=m=>a.details.phone=m),"prefix-icon-class":"inline-block w-5 h-5 text-gray-700 absolute mt-4 ml-2 mr-2","validation-visibility":"dirty"},null,8,["modelValue"])])]),e("div",It,[l(g,{type:"button",click:()=>{},text:"Clear form"}),l(x,{type:"submit",click:()=>{},color:"success",icon:a.saveIcon,text:"Save changes",loading:a.loading},null,8,["icon","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Nt=le(vt,[["render",At]]),Ut={components:{UsersIcon:Ne,PlusIcon:j,MagnifyingGlassIcon:$e},setup(){Me({title:`${De.name.toUpperCase()} - Patients`})},data(){return{loading:!1,openCreatePatientForm:!1,newIcon:Fe,defaultData:{},editIcon:de,viewIcon:re,refreshIcon:Ie,headers:new Array({text:"patient no",value:"client_id",sortable:!0},{text:"name",value:"name",sortable:!0},{text:"sex",value:"sex",sortable:!0},{text:"date of birth",value:"date_of_birth",sortable:!0},{text:"physical address",value:"physical_address",sortable:!0},{text:"actions",value:"actions"}),pages:[{name:"Home",link:"/home"}],data:{},addIcon:j,patients:new Array,cookie:B("token"),serverItemsLength:0,serverOptions:{page:1,rowsPerPage:25,sortBy:"name"},searchField:"name",search:"",searchValue:"",createPatient:!1,showSearch:!1}},created(){this.init()},methods:{updateSearch(s){this.searchValue=s,this.search=s,this.updatePatients(!0)},async init(){this.createPatient=!1,this.defaultData={firstName:"",lastName:"",middleName:"",gender:""},this.loading=!0;const{page:s,rowsPerPage:t}=this.serverOptions,h=Pe(),f=Ce(h.locations,h.selectedLocation),a={route:`${S.clients}?page=${s}&per_page=${t}&search=${this.search}&lab_location=${f}`,method:"GET",token:`${this.cookie}`};let{data:r,error:x,pending:d}=await T(a);this.loading=d,r.value&&(this.patients=r.value.clients,this.serverItemsLength=r.value.meta.total_count),x.value&&(console.error(x.value.data),F().$toast.error(`${Y}`))},updatePatients(s){typeof s=="object"&&(this.serverOptions=s),this.init()},async handleClick(s){this.data=s,s.source==="remote"&&await this.handleSaveRemotePatient(this.data),this.$router.push(`/tests/new-test?patient_id=${s.client_id}`)},async handleSaveRemotePatient(s){const t={route:S.clients,method:"POST",token:this.cookie,body:{client:{uuid:s.uuid},person:{first_name:s.first_name,middle_name:s.middle_name,last_name:s.last_name,sex:s.sex,date_of_birth:s.date_of_birth,birth_date_estimated:!1},client_identifiers:{current_village:s.current_village,current_district:s.current_district,current_traditional_authority:s.current_traditional_authority,physical_address:`${s.home_village} ${s.home_traditional_authority} ${s.home_district}`,npid:s.npid}}},{data:h,error:f,pending:a}=await T(t);h.value&&(this.data=h.value),f.value&&F().$toast.error(`${Y}`)},handleActionCompleted(s){s.patient.length>0?(this.createPatient=!0,this.patients=s.patient,this.serverItemsLength=s.patient.length,this.showSearch=!0):(F().$toast.warning("Patient not found"),this.openCreatePatientForm=!0,this.defaultData=s.defaults,this.showSearch=!1)},setCreatePatientFormVisibility(s){this.openCreatePatientForm=s}},computed:{filteredPatients(){return this.patients.map(s=>({...s,name:Ve(`${s.first_name} ${s.middle_name!=null?s.middle_name:""} ${s.last_name}`),date_of_birth:U(s.date_of_birth).format("DD/MMMM/YYYY")}))}}},St="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M17%2031V29H19V31H17Z'%20fill='currentColor'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M20%204C18.3431%204%2017%205.34315%2017%207H13C11.3431%207%2010%208.34315%2010%2010V41C10%2042.6569%2011.3431%2044%2013%2044H35C36.6569%2044%2038%2042.6569%2038%2041V10C38%208.34315%2036.6569%207%2035%207H31C31%205.34315%2029.6569%204%2028%204H20ZM19%207C19%206.44772%2019.4477%206%2020%206H28C28.5523%206%2029%206.44772%2029%207V9C29%209.55228%2028.5523%2010%2028%2010H20C19.4477%2010%2019%209.55228%2019%209V7ZM16%2020C15.4477%2020%2015%2020.4477%2015%2021C15%2021.5523%2015.4477%2022%2016%2022H23C23.5523%2022%2024%2021.5523%2024%2021C24%2020.4477%2023.5523%2020%2023%2020H16ZM15%2016C15%2015.4477%2015.4477%2015%2016%2015H31.5C32.0523%2015%2032.5%2015.4477%2032.5%2016C32.5%2016.5523%2032.0523%2017%2031.5%2017H16C15.4477%2017%2015%2016.5523%2015%2016ZM15%2028C15%2027.4477%2015.4477%2027%2016%2027H20C20.5523%2027%2021%2027.4477%2021%2028V32C21%2032.5523%2020.5523%2033%2020%2033H16C15.4477%2033%2015%2032.5523%2015%2032V28ZM28%2032C29.6575%2032%2031%2030.6575%2031%2029C31%2027.3425%2029.6575%2026%2028%2026C26.3425%2026%2025%2027.3425%2025%2029C25%2030.6575%2026.3425%2032%2028%2032ZM22%2036.5001C22%2034.3842%2025.9975%2033.3182%2028%2033.3182C30.0025%2033.3182%2034%2034.3842%2034%2036.5001V38.9999H22V36.5001Z'%20fill='currentColor'/%3e%3c/svg%3e",Tt={class:"py-5 px-5"},Yt={class:"flex justify-between items-center w-full px-2 py-2 mb-2"},Ht={class:"flex items-center space-x-2"},jt={class:"mb-2.5"},qt={class:"text-lg font-medium"},Bt={class:"py-2 flex items-center space-x-2"};function Lt(s,t,h,f,a,r){var v,_;const x=he,d=O,C=Ze,b=Qe,u=ht,c=Nt,g=ke;return D(),$("div",Tt,[l(x,{pages:a.pages},null,8,["pages"]),t[1]||(t[1]=e("div",{class:"flex items-center space-x-2 py-5"},[e("img",{src:St,alt:"form-icon",class:"w-auto h-10"}),e("h3",{class:"text-2xl font-semibold uppercase"},"Patients List")],-1)),e("div",Yt,[e("div",Ht,[l(d,{color:"warning",icon:a.refreshIcon,text:"Refresh",click:()=>{r.init()}},null,8,["icon","click"]),q(l(d,{click:()=>{a.openCreatePatientForm=!0},text:"Create a new patient",color:"success",icon:a.addIcon},null,8,["click","icon"]),[[E,a.createPatient]])]),("usePermissions"in s?s.usePermissions:o(se))().can.manage("patients")?(D(),te(C,{key:0,openForm:a.openCreatePatientForm,onSethandleDialog:r.setCreatePatientFormVisibility,onOnPatientCreated:r.updatePatients,"default-data":a.defaultData},null,8,["openForm","onSethandleDialog","onOnPatientCreated","default-data"])):ae("",!0),("usePermissions"in s?s.usePermissions:o(se))().can.manage("patients")?(D(),te(b,{key:1,onActionCompleted:r.handleActionCompleted},null,8,["onActionCompleted"])):ae("",!0)]),q(e("div",jt,[t[0]||(t[0]=L(" Showing results for ")),e("span",qt,I(`${(v=a.defaultData)==null?void 0:v.firstName} ${(_=a.defaultData)==null?void 0:_.lastName}`),1)],512),[[E,a.showSearch]]),("usePermissions"in s?s.usePermissions:o(se))().can.manage("patients")?(D(),te(g,{key:0,headers:a.headers,data:r.filteredPatients,loading:a.loading,searchField:a.searchField,searchValue:a.searchValue,serverItemsLength:a.serverItemsLength,serverOptions:a.serverOptions,onUpdate:r.updatePatients},{actions:n(({item:P})=>[e("div",Bt,[l(d,{click:()=>r.handleClick(P),text:"New Test",color:"primary",icon:a.newIcon},null,8,["click","icon"]),l(u,{data:P},null,8,["data"]),l(c,{data:P,onUpdate:r.updatePatients},null,8,["data","onUpdate"])])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"])):ae("",!0)])}const ia=le(Ut,[["render",Lt]]);export{ia as default};
