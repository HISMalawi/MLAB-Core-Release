import{_ as be}from"./Cx0ps7pt.js";import{_ as ge}from"./BC6blzW0.js";import{P as Re}from"./DsF3fssB.js";import{ar as $e,R as we,d as z,a as Z,M as ve,c as g,z as u,Q as ee,r as S,as as te,u as F,w as oe,o as H,x as A,b as d,e as p,g as t,at as Ce,f as c,h as e,j as I,A as re,y as K,t as y,F as V,k as B,C as Q,l as ne,E as se,_ as ae,au as ke,al as Te,J as Ne,H as Ee,N as Se}from"./CXJT-Lpc.js";import{_ as le}from"./BeoL6V4o.js";import{_ as ie}from"./Bqhq1Klu.js";import{_ as ue}from"./D_ElFC1g.js";import{_ as ce}from"./DILbrSdy.js";import{_ as de}from"./Bc48f1S8.js";import{u as me}from"./B6c0AK0M.js";import{u as pe}from"./eCzQTRux.js";import{r as _e}from"./CAmOPt-e.js";import{r as ye}from"./kGOxXp0n.js";import{u as Ie}from"./Di1jx6Ca.js";import"./aXJyd3_m.js";import"./DnBD8KZ6.js";const xe=f=>Object.values(f).every(i=>i===null),fe=(f,i)=>{f.count!==0&&f.associated_ids!==""?i.$router.push(`/reports/${f.associated_ids}?origin=culture&type=culture-sensitivity-${f.type}-report&from=${f.date_filter}&to=${f.date_filter}&test=${f.test}&department=Microbiology&count=${f.count}`):i.$toast.warning("No data found for this month")},J=$e("culture",{state:()=>({currentRoute:{index:0,reportId:"",period:""},routes:[]}),actions:{setCurrentRoute(f,i,T){this.currentRoute.index=f,this.currentRoute.reportId=i,this.currentRoute.period=T||"",this.updateRoutes(f,i,T)},revertRoute(f){this.currentRoute.index=f,this.currentRoute.reportId="",this.updateRoutes(f,"")},updateRoutes(f,i,T){const E=this.routes.findIndex(N=>N.index===f);E!==-1?i!==""?(this.routes[E].reportId=i,this.routes[E].period=T||""):this.routes.splice(E,1):i!==""&&this.routes.push({index:f,reportId:i,period:T}),this.routes.sort((N,l)=>N.index-l.index)}},persist:{storage:sessionStorage}}),he=()=>{const f=we();return{replaceQuery:l=>f.replace({query:l}),removeQuery:l=>{const C={...f.currentRoute.value.query};return Object.keys(l).forEach(R=>delete C[R]),f.replace({query:C})},removeAllQueries:()=>f.replace({query:{}}),replaceOneQuery:(l,C)=>{const R={...f.currentRoute.value.query};return R[l]=C[l],f.replace({query:R})}}},Me={class:"w-full flex items-center justify-between mb-10"},De={class:"flex flex-row items-center bg-gray-100 rounded-l pl-2 font-normal text-zinc-500"},Oe={class:"w-44 ml-2"},Ge={class:"w-48"},Ae={class:"rounded border",id:"print-container"},Ue={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ye={class:"px-4 py-2.5 font-medium"},je={class:"font-normal"},Fe={key:0,class:"w-full mt-2",ref:"table"},Pe={class:"w-full border-b border-t bg-gray-100 rounded-t"},qe={class:"w-full"},Ve={class:"border-b"},Be={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Qe=z({__name:"general-counts",async setup(f){let i,T;const E=Z("token"),N=me(),l=J(),C=ve(),R=g(()=>{const n=C.query.dateFrom;return n&&typeof n=="string"&&n.trim()!==""?u(n.split("/").join("-01-")).format(ee):""}),m=g(async()=>{const n=l.routes.find(a=>a.index==0);return(n==null?void 0:n.period)||""}),_=S(String(([i,T]=te(()=>m.value),i=await i,T(),i))),Y=he(),{$toast:M}=F(),{loading:$,executeCancellableRequest:s,cancelRequest:v}=pe(),b=S({Growth:{total:0,associated_ids:""},"No growth":{total:0,associated_ids:""},"Mixed growth; no predominant organism":{total:0,associated_ids:""},"Growth of normal flora; no pathogens isolated":{total:0,associated_ids:""},"Growth of contaminants":{total:0,associated_ids:""}}),O=S([{name:"Growth"},{name:"No Growth"},{name:"Mixed Growth:  No Predominant Organism"},{name:"Growth Normal Flora: No Pathogens Isolated"},{name:"Growth: Contaminations"}]),q=g(()=>O.value.map(n=>({NAME:n.name,COUNT:b.value[n.name]||0}))),D=(n,a,k)=>{Y.replaceOneQuery("revert",{revert:"true"}),fe({test:n,type:"General Counts",count:a,associated_ids:k,date_filter:u(_.value).format("YYYY-MM-DD")},F())},j=g(()=>_.value.length!==0?u(_.value).format("yyyy"):""),U=g(()=>_.value.length!==0?u(_.value).format("M"):"");async function r(){$.value=!0;const n=await o.value,a={route:`${ne.aggregateReports}culture/general_counts?year=${j.value}&month=${U.value}&report_id=${n||""}`,method:"GET",token:`${E.value}`},{data:k,error:G,pending:P}=await s(a);$.value=P,k.value&&(b.value=k.value,$.value=!1,l.setCurrentRoute(0,k.value.report_id,_.value),M.success("Report data generated successfully")),G.value&&(console.error(G.value),$.value=!1,M.error(se))}const o=g(async()=>{const n=l.routes.find(a=>a.index==0);return(n==null?void 0:n.reportId)||""});return oe(_,()=>{_&&l.setCurrentRoute(0,"")},{deep:!0}),H(async()=>{await o.value||R.value!==""?r():$.value=!1}),(n,a)=>{var w;const k=A("datepicker"),G=ae,P=le,L=A("excel"),W=ie,h=ue;return d(),p("div",null,[t("div",Me,[t("form",{onSubmit:a[1]||(a[1]=Ce(x=>r(),["prevent"])),class:"flex items-center space-x-5"},[t("div",De,[c(e(_e),{class:"w-4 h-4 mr-2"}),a[7]||(a[7]=I(" Filter by date ")),t("div",Oe,[c(k,{placeholder:"month & year",required:"","input-class-name":"custom-input",modelValue:e(_),"onUpdate:modelValue":a[0]||(a[0]=x=>re(_)?_.value=x:null),range:!1,format:"M/yyyy",position:"left",maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",Ge,[c(G,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e($)},null,8,["icon","loading"])])],32),t("div",null,[c(L,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY GENERAL COUNTS REPORT ${e(_)}`,e(N).details.name,e(N).details.address,e(N).details.phone,"",""],data:e(q),worksheet:"report-work-sheet",name:`culture_sensitivity_general_counts_report_${e(u)(e(_)).format("M_YYYY")}.xls`},{default:K(()=>[c(P,{text:"Export Excel",icon:"excel.png"})]),_:1},8,["header","data","name"])])]),t("div",Ae,[t("div",Ue,[a[8]||(a[8]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY GENERAL COUNTS REPORT ")],-1)),c(W)]),t("div",null,[t("h3",Ye,[a[9]||(a[9]=I(" Data for period: ")),t("span",je,y(e(_)==""?" - ":e(u)(e(_)).format("M/yyyy")),1)])]),!("isObjectNull"in n?n.isObjectNull:e(xe))(e(b))&&!e($)?(d(),p("table",Fe,[t("thead",Pe,[t("tr",qe,[(d(!0),p(V,null,B(e(O),(x,X)=>(d(),p("th",{class:"px-2 py-2 border-r text-left uppercase",key:X},y(x.name),1))),128))])]),t("tbody",null,[t("tr",Ve,[t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[2]||(a[2]=x=>D("Growth",e(b).Growth.total,e(b).Growth.associated_ids))},y(e(b).Growth.total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[3]||(a[3]=x=>D("No growth",e(b)["No growth"].total,e(b)["No growth"].associated_ids))},y(e(b)["No growth"].total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[4]||(a[4]=x=>{D("Mixed growth; no predominant organism",e(b)["Mixed growth; no predominant organism"].total,e(b)["Mixed growth; no predominant organism"].associated_ids)})},y(e(b)["Mixed growth; no predominant organism"].total),1),t("td",{class:"px-2 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[5]||(a[5]=x=>{D("Growth of normal flora; no pathogens isolated",e(b)["Growth of normal flora; no pathogens isolated"].total,e(b)["Growth of normal flora; no pathogens isolated"].associated_ids)})},y(e(b)["Growth of normal flora; no pathogens isolated"].total),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:a[6]||(a[6]=x=>D("Growth of contaminants",e(b)["Growth of contaminants"].total,e(b)["Growth of contaminants"].associated_ids))},y((w=e(b)["Growth of contaminants"])==null?void 0:w.total),1)])])],512)):Q("",!0),c(h,{condition:e($),cancelReportGeneration:()=>e(v)()},null,8,["condition","cancelReportGeneration"]),("isObjectNull"in n?n.isObjectNull:e(xe))(e(b))&&!e($)?(d(),p("div",Be,a[10]||(a[10]=[t("img",{src:de,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"General Counts"),I(" report. ")],-1)]))):Q("",!0)])])}}}),Le={class:"w-full flex items-center justify-between mb-10"},We={class:"flex items-center space-x-5"},Ke={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},ze={class:"w-56 ml-2"},He={class:"w-48"},Je={class:"rounded border"},Xe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ze={class:"px-4 mt-2 font-medium"},et={class:"font-normal"},tt={key:0,id:"print-container"},ot={class:"w-full mt-3",ref:"table"},rt={class:"w-full border-b border-t bg-gray-50 rounded-t"},nt={class:"w-full"},st={class:"px-2 py-2 border-r"},at={class:"px-2 py-2 border-r"},lt={class:"px-2 py-2 border-r"},it=["onClick"],ut={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},ct=z({__name:"wards-counts",async setup(f){let i,T;const E=S([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Total Count"}]),N=Z("token"),l=S([]);ve();const C=me(),R=J();he();const{loading:m,executeCancellableRequest:_,cancelRequest:Y}=pe(),M=g(async()=>{const r=R.routes.find(o=>o.index==1);return(r==null?void 0:r.period)||""}),$=g(async()=>{const r=await M.value;return r&&typeof r=="string"&&r.trim()!==""?u(r.split("/").join("-01-")).format(ee):""}),s=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),v=()=>{s.value=""},b=g(()=>s.value.length!==0?u(s.value).format("yyyy"):""),O=g(()=>s.value.length!==0?u(s.value).format("M"):""),q=g(()=>E.value.flatMap(()=>l.value.map(r=>({WARD:r.ward,ENCOUNTER:r.encounter,"DATE PERIOD":u(s.value).format("MMMM-yyyy"),COUNT:r.count})))),D=(r,o,n)=>{fe({test:r,type:"General Counts",count:o,associated_ids:n,date_filter:u(s.value).format("YYYY-MM-DD")},F())};async function j(){m.value=!0;const r=await U.value,o={route:`${ne.aggregateReports}culture/wards_based_counts?year=${b.value}&month=${O.value}&report_id=${r||""}`,method:"GET",token:`${N.value}`},{data:n,error:a,pending:k}=await _(o);m.value=k,n.value&&(l.value=n.value.data,m.value=!1,R.setCurrentRoute(1,n.value.report_id,s.value),F().$toast.success("Report data generated successfully")),a.value&&(console.error(a.value),m.value=!1,F().$toast.error(se))}const U=g(async()=>{const r=R.routes.find(o=>o.index==1);return(r==null?void 0:r.reportId)||""});return oe(s,()=>{s&&R.setCurrentRoute(1,"")},{deep:!0}),H(async()=>{await U.value||await $.value!==""?j():m.value=!1}),(r,o)=>{const n=A("datepicker"),a=ae,k=A("FormKit"),G=le,P=A("excel"),L=ie,W=ue;return d(),p("div",null,[t("div",Le,[c(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(()=>[t("div",We,[t("div",Ke,[c(e(_e),{class:"w-5 h-5 mr-2"}),o[1]||(o[1]=I(" Filter By Date Range ")),t("div",ze,[c(n,{onCleared:v,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(s),"onUpdate:modelValue":o[0]||(o[0]=h=>re(s)?s.value=h:null),format:"M/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",He,[c(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(m)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[c(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY WARDS COUNTS REPORT ${e(u)(e(s)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(q),worksheet:"report-work-sheet",name:`culture_sensitivity_wards_counts_report_${e(u)(e(s)).format("M_yyyy")}.xls`},{default:K(()=>[c(G,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",Je,[t("div",Xe,[o[2]||(o[2]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY WARDS COUNTS REPORT ")],-1)),c(L)]),t("div",null,[t("h3",Ze,[o[3]||(o[3]=I(" Data for period: ")),t("span",et,y(e(s)==""?" - ":e(u)(e(s)).format("M/yyyy")),1)])]),e(l).length>0&&!e(m)?(d(),p("div",tt,[t("table",ot,[t("thead",rt,[t("tr",nt,[(d(!0),p(V,null,B(e(E),(h,w)=>(d(),p("th",{class:"px-2 py-2 border-r text-left uppercase",key:w},y(h.name),1))),128))])]),t("tbody",null,[(d(!0),p(V,null,B(e(l),(h,w)=>(d(),p("tr",{key:w,class:"border-b border-l border-r"},[t("td",st,y(h.ward),1),t("td",at,y(h.encounter),1),t("td",lt,y(e(s)==""?"":e(u)(e(s)).format("M/yyyy")),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:x=>D(`Ward Based Counts - ${h.ward}, ${h.encounter}`,h.count,h.associated_ids)},y(h.count),9,it)]))),128))])],512)])):Q("",!0),c(W,{condition:e(m),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(l).length==0&&!e(m)?(d(),p("div",ut,o[4]||(o[4]=[t("img",{src:de,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"General Counts"),I(" report. ")],-1)]))):Q("",!0)])])}}}),dt={class:"w-full flex items-center justify-between mb-10"},mt={class:"flex items-center space-x-5"},pt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},_t={class:"w-56 ml-2"},yt={class:"w-48"},ft={class:"rounded border",id:"print-container"},vt={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},ht={class:"px-4 mt-2"},xt={class:"font-semibold"},bt={key:0},gt={class:"w-full mt-3",ref:"table"},Rt={class:"w-full border-b border-t bg-gray-50 rounded-t"},$t={class:"w-full"},wt={class:"px-2 py-2 text-left border-r"},Ct={class:"px-2 py-2 text-left border-r"},kt=["onClick"],Tt={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Nt=z({__name:"organisms-counts",async setup(f){let i,T;const E=S([{name:"Organism Name"},{name:"Period"},{name:"Total Count"}]),N=Z("token"),l=S([]),C=me(),R=J(),{loading:m,executeCancellableRequest:_,cancelRequest:Y}=pe(),M=g(async()=>{const r=R.routes.find(o=>o.index==2);return(r==null?void 0:r.period)||""}),$=g(async()=>{const r=await M.value;return r&&typeof r=="string"&&r.trim()!==""?u(r.split("/").join("-01-")).format(ee):""}),s=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),v=g(()=>l.value&&l.value.length>0?l.value.map(r=>({ORGANISM:r.organism,"DATE PERIOD":u(s.value).format("MMMM/yyyy"),COUNT:r.count})):[]),b=(r,o,n)=>{fe({test:r,type:"General Counts",count:o,associated_ids:n,date_filter:u(s.value).format("YYYY-MM-DD")},F())},O=()=>{s.value=""},q=g(()=>s.value.length!==0?u(s.value).format("yyyy"):""),D=g(()=>s.value.length!==0?u(s.value).format("M"):"");async function j(){m.value=!0;let r=await U.value;const o={route:`${ne.aggregateReports}culture/organisms_based_counts?year=${q.value}&month=${D.value}&report_id=${r||""}`,method:"GET",token:`${N.value}`},{data:n,error:a,pending:k}=await _(o);m.value=k,n.value&&(l.value=n.value.data,m.value=!1,R.setCurrentRoute(2,n.value.report_id,s.value),F().$toast.success("Report data generated successfully")),a.value&&(console.error(a.value),m.value=!1,F().$toast.error(se))}const U=g(async()=>{const r=R.routes.find(o=>o.index==2);return(r==null?void 0:r.reportId)||""});return oe(s,()=>{s&&R.setCurrentRoute(2,"")},{deep:!0}),H(async()=>{await U.value||await $.value!==""?j():m.value=!1}),(r,o)=>{const n=A("datepicker"),a=ae,k=A("FormKit"),G=le,P=A("excel"),L=ie,W=ue;return d(),p("div",null,[t("div",dt,[c(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(()=>[t("div",mt,[t("div",pt,[c(e(_e),{class:"w-5 h-5 mr-2"}),o[1]||(o[1]=I(" Filter By Date Range ")),t("div",_t,[c(n,{onCleared:O,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(s),"onUpdate:modelValue":o[0]||(o[0]=h=>re(s)?s.value=h:null),format:"M/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",yt,[c(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(m)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[c(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ${e(u)(e(s)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(v),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_counts_report_${e(u)(e(s)).format("M_yyyy")}.xls`},{default:K(()=>[c(G,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",ft,[t("div",vt,[o[2]||(o[2]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS COUNTS REPORT ")],-1)),c(L)]),t("div",null,[t("h3",ht,[o[3]||(o[3]=I(" Data for period: ")),t("span",xt,y(e(s)==""?" - ":e(u)(e(s)).format("M/yyyy")),1)])]),e(l)!==void 0&&e(l).length>0&&!e(m)?(d(),p("div",bt,[t("table",gt,[t("thead",Rt,[t("tr",$t,[(d(!0),p(V,null,B(e(E),(h,w)=>(d(),p("th",{class:"px-2 py-2 border-r text-left uppercase",key:w},y(h.name),1))),128))])]),t("tbody",null,[(d(!0),p(V,null,B(e(l),(h,w)=>(d(),p("tr",{key:w,class:"border-b"},[t("td",wt,y(h.organism),1),t("td",Ct,y(e(s)==""?" - ":e(u)(e(s)).format("M/yyyy")),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:x=>b(`Organisms Based Counts (${h.organism})`,h.count,h.associated_ids)},y(h.count),9,kt)]))),128))])],512)])):Q("",!0),c(W,{condition:e(m),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(l)!==void 0&&e(l).length==0&&!e(m)?(d(),p("div",Tt,o[4]||(o[4]=[t("img",{src:de,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"Organisms Count"),I(" report. ")],-1)]))):Q("",!0)])])}}}),Et={class:"w-full flex items-center justify-between mb-10"},St={class:"flex items-center space-x-5"},It={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Mt={class:"w-56 ml-2"},Dt={class:"w-48"},Ot={class:"rounded border",id:"print-container"},Gt={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},At={class:"px-4 mt-2 font-medium"},Ut={class:"font-normal"},Yt={key:0},jt={class:"w-full mt-3",ref:"table"},Ft={class:"w-full border-b border-t bg-gray-100 rounded-t"},Pt={class:"w-full"},qt={class:"px-2 py-2 text-center border-r"},Vt={class:"px-2 py-2 text-center border-r"},Bt={class:"px-2 py-2 text-center border-r"},Qt={class:"px-2 py-2 text-center border-r"},Lt=["onClick"],Wt={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Kt=z({__name:"organisms-wards-counts",async setup(f){let i,T;const E=S([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Organism Name"},{name:"Total Count"}]);ve();const N=Z("token"),l=S([]),C=me(),R=J(),{$toast:m}=F(),{loading:_,executeCancellableRequest:Y,cancelRequest:M}=pe(),$=g(async()=>{const o=R.routes.find(n=>n.index==3);return(o==null?void 0:o.period)||""}),s=g(async()=>{const o=await $.value;return o&&typeof o=="string"&&o.trim()!==""?u(o.split("/").join("-01-")).format(ee):""}),v=S(String(([i,T]=te(()=>$.value),i=await i,T(),i))),b=g(()=>l.value.map(o=>({WARD:o.ward,ENCOUNTER:o.encounter,"DATE PERIOD":u(v.value).format(ke),ORGANISMS:o.organism,COUNT:o.count}))),O=(o,n,a)=>{fe({test:o,type:"General Counts",count:n,associated_ids:a,date_filter:u(v.value).format("YYYY-MM-DD")},F())},q=()=>{v.value=""},D=g(()=>v.value.length!==0?u(v.value).format("yyyy"):""),j=g(()=>v.value.length!==0?u(v.value).format("M"):"");async function U(){_.value=!0;let o=await r.value;const n={route:`${ne.aggregateReports}culture/organisms_wards_counts?year=${D.value}&month=${j.value}&report_id=${o||""}`,method:"GET",token:`${N.value}`},{data:a,error:k,pending:G}=await Y(n);_.value=G,a.value&&(l.value=a.value.data,_.value=!1,R.setCurrentRoute(3,a.value.report_id,v.value),m.success("Report data generated successfully")),k.value&&(console.error(k.value),_.value=!1,m.error(se))}oe(v,()=>{v&&R.setCurrentRoute(3,"")},{deep:!0});const r=g(async()=>{const o=R.routes.find(n=>n.index==3);return(o==null?void 0:o.reportId)||""});return H(async()=>{await r.value||await s.value!==""?U():_.value=!1}),(o,n)=>{const a=A("datepicker"),k=ae,G=A("FormKit"),P=le,L=A("excel"),W=ie,h=ue;return d(),p("div",null,[t("div",Et,[c(G,{type:"form","submit-label":"Update",onSubmit:U,actions:!1},{default:K(({value:w})=>[t("div",St,[t("div",It,[c(e(_e),{class:"w-5 h-5 mr-2"}),n[1]||(n[1]=I(" Filter By Date Range ")),t("div",Mt,[c(a,{onCleared:q,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(v),"onUpdate:modelValue":n[0]||(n[0]=x=>re(v)?v.value=x:null),format:"M/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",Dt,[c(k,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(_)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[c(L,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ${e(u)(e(v)).format("M/yyyy")}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(b),worksheet:"report-work-sheet",name:`culture_sensitivity_organisms_in_wards_counts_report_${e(u)(e(v)).format("M_yyyy")}.xls`},{default:K(()=>[c(P,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",Ot,[t("div",Gt,[n[2]||(n[2]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ORGANISMS IN WARDS COUNTS REPORT ")],-1)),c(W)]),t("div",null,[t("h3",At,[n[3]||(n[3]=I(" Data for period: ")),t("span",Ut,y(e(v)==""?"":e(u)(e(v)).format("M/yyyy")),1)])]),e(l).length>0&&!e(_)?(d(),p("div",Yt,[t("table",jt,[t("thead",Ft,[t("tr",Pt,[(d(!0),p(V,null,B(e(E),(w,x)=>(d(),p("th",{class:"px-2 py-2 border-r text-left uppercase",key:x},y(w.name),1))),128))])]),t("tbody",null,[(d(!0),p(V,null,B(e(l),(w,x)=>(d(),p("tr",{key:x,class:"border-b"},[t("td",qt,y(w.ward),1),t("td",Vt,y(w.encounter),1),t("td",Bt,y(e(v)==""?"":e(u)(e(v)).format("M/yyyy")),1),t("td",Qt,y(w.organism),1),t("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>O(`Organisms in Wards Counts (${w.organism}) - ${w.ward}, ${w.encounter}`,w.count,w.associated_ids)},y(w.count),9,Lt)]))),128))])],512)])):Q("",!0),c(h,{condition:e(_),cancelReportGeneration:()=>e(M)()},null,8,["condition","cancelReportGeneration"]),e(l).length==0&&!e(_)?(d(),p("div",Wt,n[4]||(n[4]=[t("img",{src:de,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),t("p",{class:"text-base"},[I(" Please generate report data to preview the "),t("span",{class:"font-medium"},"Organisms in Wards Count"),I(" report. ")],-1)]))):Q("",!0)])])}}}),zt={class:"w-full flex items-center justify-between mb-10"},Ht={class:"flex items-center space-x-5"},Jt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Xt={class:"w-56 ml-2"},Zt={class:"w-48"},eo={class:"rounded border",id:"print-container"},to={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},oo={class:"px-4 mt-2 font-medium"},ro={class:"font-normal"},no={key:0},so={class:"w-full border-b border-t bg-gray-50 rounded-t"},ao={colspan:4,class:"text-left px-2 py-2"},lo={class:"border-r px-2 py-2 text-left"},io=["onClick"],uo=["onClick"],co=["onClick"],mo={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},po=z({__name:"ast",async setup(f){let i,T;const E=Z("token"),N=S([]),l=me(),C=J(),{$toast:R}=F(),{loading:m,executeCancellableRequest:_,cancelRequest:Y}=pe(),M=g(async()=>{const r=C.routes.find(o=>o.index==4);return(r==null?void 0:r.period)||""}),$=g(async()=>{const r=await M.value;return r&&typeof r=="string"&&r.trim()!==""?u(r.split("/").join("-01-")).format(ee):""}),s=S(String(([i,T]=te(()=>M.value),i=await i,T(),i))),v=g(()=>N.value.flatMap(r=>r.drugs.map(o=>({"DRUG NAME":o.drug_name,"INTERPRETATION I":o.interpretations["I - Intermediate"].count,"INTERPRETATION R":o.interpretations["R - Resistant"].count,"INTERPRETATION S":o.interpretations["S - Sensitive"].count})))),b=()=>{s.value=""},O=g(()=>s.value.length!==0?u(s.value).format("yyyy"):""),q=g(()=>s.value.length!==0?u(s.value).format("M"):""),D=(r,o,n)=>{fe({test:r,type:"General Counts",count:o,associated_ids:n,date_filter:u(s.value).format("YYYY-MM-DD")},F())};async function j(){m.value=!0;const r=await U.value,o={route:`${ne.aggregateReports}culture/ast?year=${O.value}&month=${q.value}&report_id=${r}`,method:"GET",token:`${E.value}`},{data:n,error:a,pending:k}=await _(o);m.value=k,n.value&&(N.value=n.value.data,m.value=!1,C.setCurrentRoute(4,n.value.report_id,s.value),R.success("Report data generated successfully")),a.value&&(console.error(a.value),m.value=!1,R.error(se))}oe(s,()=>{s&&C.setCurrentRoute(4,"")},{deep:!0});const U=g(async()=>{const r=C.routes.find(o=>o.index==4);return(r==null?void 0:r.reportId)||""});return H(async()=>{await U.value||await $.value!==""?j():m.value=!1}),(r,o)=>{const n=A("datepicker"),a=ae,k=A("FormKit"),G=le,P=A("excel"),L=ie,W=ue;return d(),p("div",null,[t("div",zt,[c(k,{type:"form","submit-label":"Update",onSubmit:j,actions:!1},{default:K(({value:h})=>[t("div",Ht,[t("div",Jt,[c(e(_e),{class:"w-5 h-5 mr-2"}),o[1]||(o[1]=I(" Filter By Date Range ")),t("div",Xt,[c(n,{onCleared:b,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:e(s),"onUpdate:modelValue":o[0]||(o[0]=w=>re(s)?s.value=w:null),format:"M/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",Zt,[c(a,{type:"submit",color:"primary",text:"Generate Report",icon:e(ye),click:()=>{},loading:e(m)},null,8,["icon","loading"])])])]),_:1}),t("div",null,[c(P,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ${e(u)(e(s)).format("M/yyyy")}`,e(l).details.name,e(l).details.address,e(l).details.phone],data:e(v),worksheet:"report-work-sheet",name:`culture_sensitivity_antibiotic_susceptibility_report_${e(u)(e(s)).format("M_yyyy")}.xls`},{default:K(()=>[c(G,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t("div",eo,[t("div",to,[o[2]||(o[2]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY ANTIBIOTIC SUSCEPTIBILITY REPORT ")],-1)),c(L)]),t("div",null,[t("h3",oo,[o[3]||(o[3]=I(" Data for period: ")),t("span",ro,y(e(s)==""?"":e(u)(e(s)).format("M/yyyy")),1)])]),e(N).length>0&&!e(m)?(d(),p("div",no,[(d(!0),p(V,null,B(e(N),(h,w)=>(d(),p("table",{key:w,class:"w-full mt-3",ref_for:!0,ref:"table"},[t("thead",so,[t("tr",null,[t("th",ao,y(h.name),1)]),o[4]||(o[4]=t("tr",{class:"border-r border-t"},[t("th",{class:"border-r px-2 py-2 text-left"},"Drug Name"),t("th",{class:"border-r px-2 py-2 text-center"},"I"),t("th",{class:"border-r px-2 py-2 text-center"},"R"),t("th",{class:"px-2 py-2 text-center"},"S")],-1))]),t("tbody",null,[(d(!0),p(V,null,B(h.drugs,x=>(d(),p("tr",{key:x,class:"border-b"},[t("td",lo,y(x.drug_name),1),t("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>D(`Antimicrobial Subsceptibility Testing (${h.name}) - ${x.drug_name}`,x.interpretations["I - Intermediate"].count,x.interpretations["I - Intermediate"].associated_ids)},y(x.interpretations["I - Intermediate"].count),9,io),t("td",{class:"border-r px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>D(`Antimicrobial Subsceptibility Testing (${h.name}) - ${x.drug_name}`,x.interpretations["R - Resistant"].count,x.interpretations["R - Resistant"].associated_ids)},y(x.interpretations["R - Resistant"].count),9,uo),t("td",{class:"px-2 py-2 text-center hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:X=>D(`Antimicrobial Subsceptibility Testing (${h.name}) - ${x.drug_name}`,x.interpretations["S - Sensitive"].count,x.interpretations["S - Sensitive"].associated_ids)},y(x.interpretations["S - Sensitive"].count),9,co)]))),128))])],512))),128))])):Q("",!0),c(W,{condition:e(m),cancelReportGeneration:()=>e(Y)()},null,8,["condition","cancelReportGeneration"]),e(N).length==0&&!e(m)?(d(),p("div",mo,o[5]||(o[5]=[t("img",{src:de,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),t("p",null,"Data not found, please generate report",-1)]))):Q("",!0)])])}}}),_o={class:"px-5 py-5"},yo={class:"flex items-center py-5"},fo={class:"text-2xl font-semibold uppercase"},vo={class:"font-medium bg-gray-100"},ho=["onClick"],xo={class:"mt-4"},Ao=z({__name:"culture-sensitivity",setup(f){Ie({title:`${Re.name.toUpperCase()} - Culture & Sensitivity Report`});const i=J(),T=Te(),E=ve(),N=S("Culture & Sensitivity Report"),l=S(new Array("General Counts","Ward Based Counts","Organisms Based Count","Organisms in Wards Count","Antibiotic Susceptibility Test (AST)")),C=[Qe,ct,Nt,Kt,po],R=S(Number(E.query["current-tab"])||0),m=he(),_=S(new Array({name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"})),Y=$=>{var v;const s=((v=i.routes.find(b=>b.index===$))==null?void 0:v.reportId)||"";(s!==""||s!==void 0)&&m.replaceOneQuery("current-tab",{"current-tab":$})};H(()=>{const $=Number(T.currentRoute.value.query["current-tab"])||0;R.value=$,Y($)});const M=$=>{R.value=$,Y($)};return($,s)=>{const v=be;return d(),p("div",_o,[c(v,{pages:e(_)},null,8,["pages"]),t("div",yo,[s[0]||(s[0]=t("img",{src:ge,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),t("h3",fo,y(e(N)),1)]),t("div",null,[t("div",vo,[(d(!0),p(V,null,B(e(l),(b,O)=>(d(),p("button",{key:O,onClick:q=>M(O),class:Ne(e(R)==O?"inline-block px-2 py-2 text-white bg-sky-500":"inline-block px-2 py-2 border-r hover:text-sky-500 transition duration-150")},y(b),11,ho))),128))]),t("div",xo,[(d(),Ee(Se(C[e(R)])))])])])}}});export{Ao as default};
