import{_ as Z}from"./BxxC6xAb.js";import{b as v,e as k,g as o,S as W,p as j,Y as F,G as X,V as E,q as K,a as O,u as f,E as U,x as M,y as c,f as s,z as p,j as V,L as q,K as S,_ as T,D as Y,t as R,P as w,i as D,v as P,F as A,k as B}from"./CUNWPMFO.js";import{_ as H}from"./DrKpGisQ.js";import{S as x}from"./CBdOTIS0.js";import{r as J}from"./CbSBsqZb.js";import{r as Q}from"./Ibz9KHbp.js";import{r as $}from"./WVtptseR.js";import{_ as ee}from"./CaB7BVGy.js";import{r as z}from"./Btgq-K1b.js";import{r as L}from"./CWPtXTLI.js";import{P as te}from"./BSY9E36G.js";import{u as oe}from"./C_AIsC7W.js";import{r as se}from"./CAQQi8t5.js";import{r as ie}from"./UFteP094.js";import{r as re}from"./B-Vm0IG2.js";import{_ as ae}from"./IQzdcCmk.js";import"./CDJ4C1jN.js";import"./C5KkEBG1.js";import"./CxvClpzF.js";function G(i,e){return v(),k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[o("path",{d:"M3.375 3C2.339 3 1.5 3.84 1.5 4.875v.75c0 1.036.84 1.875 1.875 1.875h17.25c1.035 0 1.875-.84 1.875-1.875v-.75C22.5 3.839 21.66 3 20.625 3H3.375Z"}),o("path",{"fill-rule":"evenodd",d:"m3.087 9 .54 9.176A3 3 0 0 0 6.62 21h10.757a3 3 0 0 0 2.995-2.824L20.913 9H3.087ZM12 10.5a.75.75 0 0 1 .75.75v4.94l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72v-4.94a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}const ne={components:{TransitionRoot:W,TransitionChild:j,Dialog:F,DialogPanel:X,DialogTitle:E,XMarkIcon:K,UserIcon:J},props:{data:{required:!0,type:Object}},data(){return{open:!1,checkIcon:G,saveIcon:Q,clearIcon:$,cookie:O("token"),quantityRequested:0,quantityIssued:0,quantityCollected:0,notCollectedReason:"",batchNumber:"",lotNumber:"",remarks:"",expirtyDate:"",loading:!1}},computed:{isNotCollected(){return this.quantityCollected<this.quantityIssued},quantityNotCollected(){return this.quantityIssued-this.quantityCollected}},methods:{async receiveRequisition(){this.loading=!0;const i=new x,e={stock_requisition_id:this.data.id,requisition:{quantity_received:this.quantityCollected,quantity_issued:this.quantityIssued,quantity_not_collected:this.quantityNotCollected,not_collected_reason:this.notCollectedReason},transaction:{lot:this.lotNumber,batch:this.batchNumber,expiry_date:this.expirtyDate,remarks:this.remarks}},{data:l,error:d,pending:t}=await i.receiveStockOrderRequisition(`${this.cookie}`,e);this.loading=t,l.value&&(f().$toast.success("Stock order requisition received successfully"),this.$emit("update",!0),this.loading=!1,this.handleClick()),d.value&&(console.error(d.value),this.handleClick(),f().$toast.error(U),this.loading=!1)},handleClick(){this.open=!this.open}}},le={class:"fixed inset-0 overflow-y-auto"},de={class:"flex min-h-full items-center justify-center p-4 text-center"},ue={class:"border-b px-3 py-3 flex items-center justify-between"},ce={class:"px-5 py-5 space-y-3"},me={class:"relative flex flex-col space-y-2.5"},pe={class:"mt-5 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function he(i,e,l,d,t,r){const g=T,y=c("TransitionChild"),m=c("DialogTitle"),C=c("XMarkIcon"),h=c("FormKit"),n=c("datepicker"),a=H,_=c("DialogPanel"),I=c("Dialog"),N=c("TransitionRoot");return v(),k("div",null,[o("div",null,[s(g,{text:"Receive",color:"primary",icon:t.checkIcon,click:r.handleClick},null,8,["icon","click"])]),s(N,{appear:"",show:t.open,as:"template"},{default:p(()=>[s(I,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:p(()=>[s(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>e[9]||(e[9]=[o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),o("div",le,[o("div",de,[s(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(_,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",ue,[s(m,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>e[10]||(e[10]=[o("img",{src:ee,class:"w-8 h-8 mr-2"},null,-1),V(" Receive Stock Requisition ")])),_:1}),o("button",{onClick:e[0]||(e[0]=(...b)=>r.handleClick&&r.handleClick(...b))},[s(C,{class:"w-5 h-5"})])]),s(h,{type:"form","submit-label":"Update",actions:!1,onSubmit:r.receiveRequisition,id:"submitForm"},{default:p(({value:b})=>[o("div",ce,[s(h,{type:"number",label:"Quantity issued",modelValue:t.quantityIssued,"onUpdate:modelValue":e[1]||(e[1]=u=>t.quantityIssued=u),validation:"required"},null,8,["modelValue"]),s(h,{type:"number",label:"Quantity collected",modelValue:t.quantityCollected,"onUpdate:modelValue":e[2]||(e[2]=u=>t.quantityCollected=u),validation:"required"},null,8,["modelValue"]),r.isNotCollected?(v(),q(h,{key:0,disabled:"",type:"number",label:"Quantity not collected",modelValue:r.quantityNotCollected,"onUpdate:modelValue":e[3]||(e[3]=u=>r.quantityNotCollected=u),validation:"required"},null,8,["modelValue"])):S("",!0),r.isNotCollected?(v(),q(h,{key:1,type:"textarea",label:"Provide a reason for quantity not collected",modelValue:t.notCollectedReason,"onUpdate:modelValue":e[4]||(e[4]=u=>t.notCollectedReason=u),validation:"required"},null,8,["modelValue"])):S("",!0),s(h,{type:"text",label:"Lot number",modelValue:t.lotNumber,"onUpdate:modelValue":e[5]||(e[5]=u=>t.lotNumber=u)},null,8,["modelValue"]),s(h,{type:"text",label:"Batch number",modelValue:t.batchNumber,"onUpdate:modelValue":e[6]||(e[6]=u=>t.batchNumber=u)},null,8,["modelValue"]),o("div",me,[e[11]||(e[11]=o("label",{class:"font-medium"},"Date Expiry",-1)),s(n,{required:"",teleport:!0,position:"center",range:!1,placeholder:"-- select expiry date --",minDate:new Date,"input-classes":"border font-none rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:t.expirtyDate,"onUpdate:modelValue":e[7]||(e[7]=u=>t.expirtyDate=u),format:"dd/MM/yyyy"},null,8,["minDate","modelValue"])]),s(h,{type:"textarea",label:"Remarks",modelValue:t.remarks,"onUpdate:modelValue":e[8]||(e[8]=u=>t.remarks=u),validation:"required"},null,8,["modelValue"])]),o("div",pe,[s(a,{text:"Clear form",click:()=>{}}),s(g,{loading:t.loading,type:"submit",color:"success",icon:t.saveIcon,click:()=>{},text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ve=M(ne,[["render",he]]),fe={components:{TransitionRoot:W,TransitionChild:j,Dialog:F,DialogPanel:X,DialogTitle:E,XMarkIcon:K,NoSymbolIcon:z,ExclamationTriangleIcon:Y,ArchiveBoxXMarkIcon:L},data(){return{show:!1,notCollectedIcon:L,loading:!1,statusLoading:!1,reason:"",cookie:O("token")}},props:{data:{type:Object,required:!0},orderId:{type:String,required:!0}},methods:{async acceptNotCollected(){this.statusLoading=!0;const i=new x,e={route:"stock_requisition_not_collected",stock_requisition_id:this.data.id,stock_status_reason:this.reason},{data:l,error:d,pending:t}=await i.updateStockOrderStatus(`${this.cookie}`,e);this.statusLoading=t,l.value&&(this.$emit("update",!0),this.statusLoading=!1,this.reason="",this.handleClick(),f().$toast.success("Stock order requisition not collected successfully!")),d.value&&(console.error(d.value),this.statusLoading=!1)},handleClick(){this.show=!this.show}}},ge={class:"fixed inset-0 overflow-y-auto"},ye={class:"flex min-h-full items-center justify-center p-4 text-center"},_e={class:"border-b px-3 py-3 flex items-center justify-between"},ke={class:"mt-2 space-y-3 px-5"},be={class:"rounded px-2 py-2"},xe={class:"font-semibold text-red-500"},Ce={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Ve(i,e,l,d,t,r){const g=T,y=c("TransitionChild"),m=c("ArchiveBoxXMarkIcon"),C=c("DialogTitle"),h=c("XMarkIcon"),n=c("FormKit"),a=H,_=c("DialogPanel"),I=c("Dialog"),N=c("TransitionRoot");return v(),k("div",null,[s(g,{click:r.handleClick,color:"error",text:"Not Received",icon:t.notCollectedIcon},null,8,["click","icon"]),s(N,{appear:"",show:t.show,as:"template"},{default:p(()=>[s(I,{as:"div",class:"relative z-10"},{default:p(()=>[s(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>e[3]||(e[3]=[o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),o("div",ge,[o("div",ye,[s(y,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[s(_,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[o("div",_e,[s(C,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:p(()=>[s(m,{class:"h-5 w-5 mr-2"}),e[4]||(e[4]=V(" Confirm Not Collected "))]),_:1}),o("button",{onClick:e[0]||(e[0]=(...b)=>r.handleClick&&r.handleClick(...b))},[s(h,{class:"w-5 h-5"})])]),s(n,{type:"form","submit-label":"Update",onSubmit:e[2]||(e[2]=b=>r.acceptNotCollected()),actions:!1},{default:p(({value:b})=>[o("div",ke,[o("div",be,[e[5]||(e[5]=V(" Please provide a reason why ")),o("span",xe,R(l.data.item.name),1),e[6]||(e[6]=V(" from the Order ")),o("strong",null,R(l.orderId),1),e[7]||(e[7]=V(" was not collected? Note that once this action is completed, it can not be undone "))]),s(n,{type:"textarea",label:"Reason",validation:"required",modelValue:t.reason,"onUpdate:modelValue":e[1]||(e[1]=u=>t.reason=u)},null,8,["modelValue"])]),o("div",Ce,[s(a,{click:()=>{r.handleClick()},type:"button",text:"Cancel"},null,8,["click"]),s(g,{loading:t.statusLoading,type:"submit",click:()=>{},color:"error",icon:t.notCollectedIcon,text:"Reject"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const we=M(fe,[["render",Ve]]),qe={setup(){oe({title:`${te.name.toUpperCase()} - Receive Stock Order`})},components:{TicketIcon:se},data(){return{header:"Receive Stock Order",checkIcon:G,saveIcon:Q,allIcon:ie,rejectIcon:z,pages:[{name:"Home",link:"/home"},{name:"Stock Orders",link:"/stock-management/orders"}],cookie:O("token"),deleteicon:re,loading:!1,adding:!1,receiving:!1,verifying:!1,requisitions:new Array,voidReason:"",issuerName:"",issuerDesignation:"",issuerPhone:"",issuerSignature:"",approverName:"",approverDesignation:"",approverPhone:"",approverSignature:"",pharmacyWorkers:new Array}},created(){this.init()},computed:{hasApprover(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="approver")},hasIssuer(){return this.pharmacyWorkers.length==0?!1:this.pharmacyWorkers.some(i=>i.record_type==="issuer")}},methods:{async addPharmacyWorker(i){this.adding=!0;const e=new x,l={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:t,pending:r}=await e.createStockOrderPharmacy(`${this.cookie}`,l);this.adding=r,d.value&&(this.init(),f().$toast.success("Stock order pharmacy details saved successfully"),this.adding=!1),t.value&&(console.error(t.value),f().$toast.error(U),this.adding=!1)},async updatePharmacyWorker(i){this.adding=!0;const e=new x,l={pharmacy_id:this.pharmacyWorkers.filter(g=>g.record_type==i)[0].id,record_type:i,name:i=="issuer"?this.issuerName:this.approverName,designation:i=="issuer"?this.issuerDesignation:this.approverDesignation,phone_number:i=="issuer"?this.issuerPhone:this.approverPhone,signature:i=="issuer"?this.issuerSignature:this.approverSignature},{data:d,error:t,pending:r}=await e.updateStockOrderPharmacy(`${this.cookie}`,l);this.adding=r,d.value&&(this.init(),f().$toast.success("Stock order pharmacy details updated successfully"),this.adding=!1),t.value&&(console.error(t.value),f().$toast.error(U),this.adding=!1)},async init(){this.loading=!0;const i=new x,{data:e,error:l,pending:d}=await i.getStockOrder(`${this.cookie}`,`${(this._.provides[w]||this.$route).query.order_id}`);this.loading=d,e.value&&(this.requisitions=e.value.stock_requisitions,e.value.stock_pharmacy_approver_and_issuers.map(t=>{t.record_type=="issuer"?(this.issuerName=t.name,this.issuerPhone=t.phone_number,this.issuerDesignation=t.designation,this.issuerSignature=t.signature):(this.approverName=t.name,this.approverPhone=t.phone_number,this.approverDesignation=t.designation,this.approverSignature=t.signature)}),this.pharmacyWorkers=e.value.stock_pharmacy_approver_and_issuers,this.loading=!1),l.value&&(console.error(l.value),this.loading=!1)},deleteStockItem(i){i>=0&&i<this.requisitions.length&&this.requisitions.splice(i,1)},isReceivedOrNotCollected(i){for(let e=0;e<i.length;e++)if(i[e].requisition_status.toLowerCase()==="received"||i[e].requisition_status.toLowerCase()==="not collected")return!0;return!1},async receiveOrder(){if(this.isReceivedOrNotCollected(this.requisitions))if(this.hasApprover&&this.hasIssuer){this.receiving=!0;const i=new x,e={stock_order_id:`${(this._.provides[w]||this.$route).query.order_id}`},{data:l,error:d,pending:t}=await i.receiveStockOrder(`${this.cookie}`,e);this.receiving=t,l.value&&(f().$toast.success("Stock order received successfully!"),this.$router.push("/stock-management/orders"),this.receiving=!1),d.value&&(console.error(d.value),this.receiving=!1)}else f().$toast.warn("Order should be issued and approved by pharmacy!");else f().$toast.warn("Please enter the amount recieved or mark as not collected!")}}},Se={class:"px-5 py-5"},Ie={class:"py-5 flex items-center justify-between"},Ne={class:"text-2xl font-semibold"},De={class:"py-2"},Pe={class:"border rounded mt-3"},Ue={class:"px-5 py-5"},Re={class:"grid grid-cols-4 gap-5"},Oe={class:"border rounded mt-3"},Me={class:"px-5 py-5"},Te={class:"grid grid-cols-4 gap-5"},Ae={class:"rounded border"},Be={class:"grid grid-cols-4 gap-4 mt-5"},Le={class:"flex flex-col space-y-2"},We={class:"mt-8 flex space-x-2.5 items-center"};function je(i,e,l,d,t,r){const g=Z,y=T,m=c("FormKit"),C=ve,h=we;return v(),k("div",Se,[s(g,{pages:t.pages},null,8,["pages"]),o("div",Ie,[o("h3",Ne,R(t.header),1),s(y,{text:"Receive Order",color:"success",icon:t.checkIcon,click:()=>r.receiveOrder()},null,8,["icon","click"])]),o("div",null,[D(o("div",De,[e[12]||(e[12]=o("div",{class:"flex items-center space-x-3"},[o("img",{src:ae,class:"w-8 h-8"}),o("h3",{class:"text-xl font-semibold"},"Pharmacy")],-1)),o("div",Pe,[e[10]||(e[10]=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Issuer ",-1)),o("div",Ue,[s(m,{type:"form","submit-label":"Update",onSubmit:e[4]||(e[4]=n=>r.hasIssuer?r.updatePharmacyWorker("issuer"):r.addPharmacyWorker("issuer")),actions:!1},{default:p(({value:n})=>[o("div",Re,[s(m,{type:"text",label:"Name",modelValue:t.issuerName,"onUpdate:modelValue":e[0]||(e[0]=a=>t.issuerName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:t.issuerDesignation,"onUpdate:modelValue":e[1]||(e[1]=a=>t.issuerDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:t.issuerPhone,"onUpdate:modelValue":e[2]||(e[2]=a=>t.issuerPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:t.issuerSignature,"onUpdate:modelValue":e[3]||(e[3]=a=>t.issuerSignature=a),validation:"required"},null,8,["modelValue"])]),s(y,{type:"submit",class:"mt-3",text:r.hasIssuer?"Update changes":"Save changes",icon:t.saveIcon,loading:t.adding,click:()=>{},color:r.hasIssuer?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])]),o("div",Oe,[e[11]||(e[11]=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Approver ",-1)),o("div",Me,[s(m,{type:"form","submit-label":"Update",onSubmit:e[9]||(e[9]=n=>r.hasApprover?r.updatePharmacyWorker("approver"):r.addPharmacyWorker("approver")),actions:!1},{default:p(({value:n})=>[o("div",Te,[s(m,{type:"text",label:"Name",modelValue:t.approverName,"onUpdate:modelValue":e[5]||(e[5]=a=>t.approverName=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Designation",modelValue:t.approverDesignation,"onUpdate:modelValue":e[6]||(e[6]=a=>t.approverDesignation=a),validation:"required"},null,8,["modelValue"]),s(m,{type:"text",label:"Phone Number",modelValue:t.approverPhone,"onUpdate:modelValue":e[7]||(e[7]=a=>t.approverPhone=a)},null,8,["modelValue"]),s(m,{type:"text",label:"Signature",modelValue:t.approverSignature,"onUpdate:modelValue":e[8]||(e[8]=a=>t.approverSignature=a),validation:"required"},null,8,["modelValue"])]),s(y,{type:"submit",class:"mt-3",text:r.hasApprover?"Update changes":"Save changes",icon:t.saveIcon,loading:t.adding,click:()=>{},color:r.hasApprover?"primary":"success"},null,8,["text","icon","loading","color"])]),_:1})])])],512),[[P,!t.loading]]),D(o("div",Ae,[e[13]||(e[13]=o("div",{class:"px-4 py-2 bg-gray-50 font-medium rounded-t border-b"}," Stock Items ",-1)),(v(!0),k(A,null,B(t.requisitions,(n,a)=>(v(),k("div",{class:"flex flex-col space-y-3 px-5 py-5",key:a},[o("div",Be,[o("div",Le,[s(m,{label:"Stock item",disabled:!0,modelValue:n.item.name,"onUpdate:modelValue":_=>n.item.name=_},null,8,["modelValue","onUpdate:modelValue"])]),s(m,{label:"Quantity requested",type:"number",validation:"required",modelValue:n.quantity_requested,"onUpdate:modelValue":_=>n.quantity_requested=_,disabled:""},null,8,["modelValue","onUpdate:modelValue"]),o("div",We,[n.requisition_status.toLowerCase()!=="received"?(v(),q(C,{key:0,data:n,onUpdate:r.init},null,8,["data","onUpdate"])):S("",!0),n.requisition_status.toLowerCase()!=="received"?(v(),q(h,{key:1,onUpdate:r.init,data:n,orderId:`${(i._.provides[w]||i.$route).params.voucherId}`},null,8,["onUpdate","data","orderId"])):S("",!0)])])]))),128))],512),[[P,!t.loading]]),D(o("div",null,[(v(),k(A,null,B(5,n=>o("div",{class:"flex items-center space-x-3 mb-3",key:n},e[14]||(e[14]=[o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10 mt"},null,-1),o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1),o("div",{class:"w-1/4 bg-gray-100 rounded animate-pulse h-10"},null,-1)]))),64))],512),[[P,t.loading]])])])}const nt=M(qe,[["render",je]]);export{nt as default};
