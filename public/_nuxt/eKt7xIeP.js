import{_ as Vt}from"./Dzn3CqtN.js";import{d as ve,r as k,c as W,b3 as qe,a8 as f,bv as Ve,b9 as ue,b7 as it,b8 as Et,ba as we,bw as Ft,bx as Ot,aH as Ee,by as Bt,b4 as Ht,b5 as Ut,b6 as Nt,a9 as oe,ad as Fe,F as re,a6 as pe,o as Oe,av as ct,bz as ut,aa as Ae,ac as Me,bA as le,be as ee,bb as zt,bc as lt,a7 as Be,af as ne,bB as te,bC as je,b as S,e as V,g as t,f as d,z as D,h as m,j as se,U as Zt,H as ge,_ as he,q as Ce,x as ke,y as j,t as P,i as He,v as Ue,N as dt,S as Ne,p as ze,Y as Ze,G as Ge,V as Ye,B as Xe,a as Se,l as G,m as Y,u as Q,E as fe,bD as Gt,bE as Yt,bF as Xt,C as ce,A as pt,s as mt,bG as ft,M as Kt,bH as rt,a5 as xe,a_ as Wt,K,bI as Qt,a4 as vt,O as at,Z as Jt,L as J,k as ye,n as es,bJ as ts,ai as ss,w as Ie,aB as os,bK as ns}from"./BO3L0kwf.js";import{_ as ls}from"./BuXepRWo.js";import{_ as rs}from"./CRdviH8L.js";import{s as as}from"./B6asxmgh.js";import{_ as is}from"./B3Ympi7T.js";import{_ as cs}from"./C8HVgxi8.js";import{_ as ht}from"./DhJUeaP0.js";import{u as Ke}from"./B8RxDlQD.js";import{r as _t}from"./CaUjzIyo.js";import{r as bt}from"./D7PDLN3i.js";import{r as gt}from"./B4sFQApe.js";import{u as me}from"./eHkbxN-m.js";import{r as Re}from"./uwC9cbOp.js";import{_ as us}from"./DO_ReOgQ.js";import{u as ds}from"./BYRXL7y9.js";import{P as ps}from"./DSb1hqrV.js";import{r as ms}from"./BqxwyILx.js";import{r as fs}from"./BJdcKMi-.js";import{r as vs}from"./Dmty_WBN.js";import{r as hs,a as _s}from"./CDc1EeaD.js";import{r as Le}from"./DkJuY9wH.js";import"./DnNgkCJc.js";import"./QUNJvIBY.js";import"./CuGXnkCA.js";import"./owp3TffR.js";import"./Bwoq8sKN.js";import"./ZhQoleTq.js";import"./CphnV1xF.js";import"./BbIt3Hzw.js";import"./BbfklrZU.js";var bs=(l=>(l[l.Open=0]="Open",l[l.Closed=1]="Closed",l))(bs||{});let yt=Symbol("PopoverContext");function We(l){let e=Be(yt,null);if(e===null){let n=new Error(`<${l} /> is missing a parent <${Ct.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,We),n}return e}let gs=Symbol("PopoverGroupContext");function wt(){return Be(gs,null)}let xt=Symbol("PopoverPanelContext");function ys(){return Be(xt,null)}let Ct=ve({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(l,{slots:e,attrs:n,expose:v}){var s;let u=k(null);v({el:u,$el:u});let c=k(1),a=k(null),$=k(null),g=k(null),h=k(null),x=W(()=>qe(u)),E=W(()=>{var i,b;if(!f(a)||!f(h))return!1;for(let ae of document.querySelectorAll("body > *"))if(Number(ae==null?void 0:ae.contains(f(a)))^Number(ae==null?void 0:ae.contains(f(h))))return!0;let _=Ve(),R=_.indexOf(f(a)),z=(R+_.length-1)%_.length,X=(R+1)%_.length,B=_[z],Te=_[X];return!((i=f(h))!=null&&i.contains(B))&&!((b=f(h))!=null&&b.contains(Te))}),M={popoverState:c,buttonId:k(null),panelId:k(null),panel:h,button:a,isPortalled:E,beforePanelSentinel:$,afterPanelSentinel:g,togglePopover(){c.value=ue(c.value,{0:1,1:0})},closePopover(){c.value!==1&&(c.value=1)},close(i){M.closePopover();let b=i?i instanceof HTMLElement?i:i.value instanceof HTMLElement?f(i):f(M.button):f(M.button);b==null||b.focus()}};it(yt,M),Et(W(()=>ue(c.value,{0:we.Open,1:we.Closed})));let N={buttonId:M.buttonId,panelId:M.panelId,close(){M.closePopover()}},F=wt(),T=F==null?void 0:F.registerPopover,[C,I]=Ft(),L=Ot({mainTreeNodeRef:F==null?void 0:F.mainTreeNodeRef,portals:C,defaultContainers:[a,h]});function y(){var i,b,_,R;return(R=F==null?void 0:F.isFocusWithinPopoverGroup())!=null?R:((i=x.value)==null?void 0:i.activeElement)&&(((b=f(a))==null?void 0:b.contains(x.value.activeElement))||((_=f(h))==null?void 0:_.contains(x.value.activeElement)))}return Ee(()=>T==null?void 0:T(N)),Bt((s=x.value)==null?void 0:s.defaultView,"focus",i=>{var b,_;i.target!==window&&i.target instanceof HTMLElement&&c.value===0&&(y()||a&&h&&(L.contains(i.target)||(b=f(M.beforePanelSentinel))!=null&&b.contains(i.target)||(_=f(M.afterPanelSentinel))!=null&&_.contains(i.target)||M.closePopover()))},!0),Ht(L.resolveContainers,(i,b)=>{var _;M.closePopover(),Ut(b,Nt.Loose)||(i.preventDefault(),(_=f(a))==null||_.focus())},W(()=>c.value===0)),()=>{let i={open:c.value===0,close:M.close};return oe(re,[oe(I,{},()=>Fe({theirProps:{...l,...n},ourProps:{ref:u},slot:i,slots:e,attrs:n,name:"Popover"})),oe(L.MainTreeNode)])}}}),ws=ve({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(l,{attrs:e,slots:n,expose:v}){var s;let u=(s=l.id)!=null?s:`headlessui-popover-button-${pe()}`,c=We("PopoverButton"),a=W(()=>qe(c.button));v({el:c.button,$el:c.button}),Oe(()=>{c.buttonId.value=u}),ct(()=>{c.buttonId.value=null});let $=wt(),g=$==null?void 0:$.closeOthers,h=ys(),x=W(()=>h===null?!1:h.value===c.panelId.value),E=k(null),M=`headlessui-focus-sentinel-${pe()}`;x.value||Ee(()=>{c.button.value=f(E)});let N=as(W(()=>({as:l.as,type:e.type})),E);function F(i){var b,_,R,z,X;if(x.value){if(c.popoverState.value===1)return;switch(i.key){case ne.Space:case ne.Enter:i.preventDefault(),(_=(b=i.target).click)==null||_.call(b),c.closePopover(),(R=f(c.button))==null||R.focus();break}}else switch(i.key){case ne.Space:case ne.Enter:i.preventDefault(),i.stopPropagation(),c.popoverState.value===1&&(g==null||g(c.buttonId.value)),c.togglePopover();break;case ne.Escape:if(c.popoverState.value!==0)return g==null?void 0:g(c.buttonId.value);if(!f(c.button)||(z=a.value)!=null&&z.activeElement&&!((X=f(c.button))!=null&&X.contains(a.value.activeElement)))return;i.preventDefault(),i.stopPropagation(),c.closePopover();break}}function T(i){x.value||i.key===ne.Space&&i.preventDefault()}function C(i){var b,_;l.disabled||(x.value?(c.closePopover(),(b=f(c.button))==null||b.focus()):(i.preventDefault(),i.stopPropagation(),c.popoverState.value===1&&(g==null||g(c.buttonId.value)),c.togglePopover(),(_=f(c.button))==null||_.focus()))}function I(i){i.preventDefault(),i.stopPropagation()}let L=ut();function y(){let i=f(c.panel);if(!i)return;function b(){ue(L.value,{[te.Forwards]:()=>le(i,ee.First),[te.Backwards]:()=>le(i,ee.Last)})===je.Error&&le(Ve().filter(_=>_.dataset.headlessuiFocusGuard!=="true"),ue(L.value,{[te.Forwards]:ee.Next,[te.Backwards]:ee.Previous}),{relativeTo:f(c.button)})}b()}return()=>{let i=c.popoverState.value===0,b={open:i},{..._}=l,R=x.value?{ref:E,type:N.value,onKeydown:F,onClick:C}:{ref:E,id:u,type:N.value,"aria-expanded":c.popoverState.value===0,"aria-controls":f(c.panel)?c.panelId.value:void 0,disabled:l.disabled?!0:void 0,onKeydown:F,onKeyup:T,onClick:C,onMousedown:I};return oe(re,[Fe({ourProps:R,theirProps:{...e,..._},slot:b,attrs:e,slots:n,name:"PopoverButton"}),i&&!x.value&&c.isPortalled.value&&oe(Ae,{id:M,features:Me.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:y})])}}}),xs=ve({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:null}},inheritAttrs:!1,setup(l,{attrs:e,slots:n,expose:v}){var s;let u=(s=l.id)!=null?s:`headlessui-popover-panel-${pe()}`,{focus:c}=l,a=We("PopoverPanel"),$=W(()=>qe(a.panel)),g=`headlessui-focus-sentinel-before-${pe()}`,h=`headlessui-focus-sentinel-after-${pe()}`;v({el:a.panel,$el:a.panel}),Oe(()=>{a.panelId.value=u}),ct(()=>{a.panelId.value=null}),it(xt,a.panelId),Ee(()=>{var I,L;if(!c||a.popoverState.value!==0||!a.panel)return;let y=(I=$.value)==null?void 0:I.activeElement;(L=f(a.panel))!=null&&L.contains(y)||le(f(a.panel),ee.First)});let x=zt(),E=W(()=>x!==null?(x.value&we.Open)===we.Open:a.popoverState.value===0);function M(I){var L,y;switch(I.key){case ne.Escape:if(a.popoverState.value!==0||!f(a.panel)||$.value&&!((L=f(a.panel))!=null&&L.contains($.value.activeElement)))return;I.preventDefault(),I.stopPropagation(),a.closePopover(),(y=f(a.button))==null||y.focus();break}}function N(I){var L,y,i,b,_;let R=I.relatedTarget;R&&f(a.panel)&&((L=f(a.panel))!=null&&L.contains(R)||(a.closePopover(),((i=(y=f(a.beforePanelSentinel))==null?void 0:y.contains)!=null&&i.call(y,R)||(_=(b=f(a.afterPanelSentinel))==null?void 0:b.contains)!=null&&_.call(b,R))&&R.focus({preventScroll:!0})))}let F=ut();function T(){let I=f(a.panel);if(!I)return;function L(){ue(F.value,{[te.Forwards]:()=>{var y;le(I,ee.First)===je.Error&&((y=f(a.afterPanelSentinel))==null||y.focus())},[te.Backwards]:()=>{var y;(y=f(a.button))==null||y.focus({preventScroll:!0})}})}L()}function C(){let I=f(a.panel);if(!I)return;function L(){ue(F.value,{[te.Forwards]:()=>{let y=f(a.button),i=f(a.panel);if(!y)return;let b=Ve(),_=b.indexOf(y),R=b.slice(0,_+1),z=[...b.slice(_+1),...R];for(let X of z.slice())if(X.dataset.headlessuiFocusGuard==="true"||i!=null&&i.contains(X)){let B=z.indexOf(X);B!==-1&&z.splice(B,1)}le(z,ee.First,{sorted:!1})},[te.Backwards]:()=>{var y;le(I,ee.Previous)===je.Error&&((y=f(a.button))==null||y.focus())}})}L()}return()=>{let I={open:a.popoverState.value===0,close:a.close},{focus:L,...y}=l,i={ref:a.panel,id:u,onKeydown:M,onFocusout:c&&a.popoverState.value===0?N:void 0,tabIndex:-1};return Fe({ourProps:i,theirProps:{...e,...y},attrs:e,slot:I,slots:{...n,default:(...b)=>{var _;return[oe(re,[E.value&&a.isPortalled.value&&oe(Ae,{id:g,ref:a.beforePanelSentinel,features:Me.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:T}),(_=n.default)==null?void 0:_.call(n,...b),E.value&&a.isPortalled.value&&oe(Ae,{id:h,ref:a.afterPanelSentinel,features:Me.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:C})])]}},features:lt.RenderStrategy|lt.Static,visible:E.value,name:"PopoverPanel"})}}});function Cs(l,e){return S(),V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 0 1 1.06 0l6 6a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l4.72-4.72H9a5.25 5.25 0 1 0 0 10.5h3a.75.75 0 0 1 0 1.5H9a6.75 6.75 0 0 1 0-13.5h10.19l-4.72-4.72a.75.75 0 0 1 0-1.06Z","clip-rule":"evenodd"})])}function ks(l,e){return S(),V("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z","clip-rule":"evenodd"})])}const Ss={class:"px-5 py-3"},Ts={class:"flex items-end justify-end space-x-2 border-t px-4 py-2"},$s=ve({__name:"FilterWards",props:{wards:{type:Array,required:!0}},emits:["update:items-selected"],setup(l,{emit:e}){const n=e,v=l,s=W(()=>v.wards.map(a=>a.name)),u=k([]),c=a=>{n("update:items-selected",u.value),a()};return(a,$)=>{const g=rs,h=he;return S(),V("div",null,[d(m(Ct),{class:"relative"},{default:D(({close:x})=>[d(m(ws),{class:"bg-gray-50 text-zinc-500 flex items-center space-x-2 rounded border px-2 py-1.5"},{default:D(()=>$[1]||($[1]=[t("svg",{class:"mr-2",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 48 48"},[t("path",{fill:"currentColor","fill-rule":"evenodd",d:"M29 6v2c0 1.306.835 2.418 2 2.83V12h-1a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1h-1v-1h5v12.066H20.11a.3.3 0 0 1-.218-.09l-.366-.37l.369-.367a3.77 3.77 0 0 0 .001-5.333l-1.8-1.8a3.77 3.77 0 0 0-5.333-.003l-.704.704a3.95 3.95 0 0 0-3.892 1.021a4.034 4.034 0 0 0 0 5.676l.833.839V34H6v2h3.05a3.5 3.5 0 1 0 4.899 0h20.102a3.5 3.5 0 1 0 4.899 0H42v-2h-4v-3h.066C40.24 31 42 29.224 42 27.033a3.97 3.97 0 0 0-2-3.455V11a2 2 0 0 0-2-2h-6a1 1 0 0 1-1-1V6zM13.826 16.868l4.29 4.32l.365-.364a1.77 1.77 0 0 0 0-2.504l-1.8-1.8a1.77 1.77 0 0 0-2.504-.002zM36 34H11v-8.644l5.275 5.311c.212.213.498.333.797.333H36z","clip-rule":"evenodd"})],-1),se(" Filter By Wards ")])),_:1}),d(Zt,{"enter-active-class":"transition duration-200 ease-out","enter-from-class":"translate-y-1 opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition duration-150 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-1 opacity-0"},{default:D(()=>[d(m(xs),{class:"absolute z-10 mt-0 w-screen bg-white border shadow-2xl rounded max-w-2xl transform px-4 sm:px-0 lg:max-w-3xl"},{default:D(()=>[t("div",Ss,[d(g,{placeholder:"click to select wards",label:"Select ward(s)",mode:"tags",items:m(s),"items-selected":m(u),"onUpdate:itemsSelected":$[0]||($[0]=E=>ge(u)?u.value=E:null)},null,8,["items","items-selected"])]),t("div",Ts,[d(h,{text:"Apply",icon:m(Cs),color:"primary",click:()=>{c(x)}},null,8,["icon","click"])])]),_:2},1024)]),_:2},1024)]),_:1})])}}}),Ps={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:Ce}},Ds={class:"text-sm"};function Is(l,e,n,v,s,u){const c=j("XMarkIcon");return S(),V("div",{class:dt(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${n.color}-500`])},[t("p",Ds,P(n.value.value),1),He(t("button",{onClick:e[0]||(e[0]=(...a)=>u.removeLabel&&u.removeLabel(...a)),class:"ml-2"},[d(c,{class:"w-4 h-4"})],512),[[Ue,n.close]])],2)}const Ls=ke(Ps,[["render",Is]]),As={components:{TransitionRoot:Ne,TransitionChild:ze,Dialog:Ze,DialogPanel:Ge,DialogTitle:Ye,XMarkIcon:Ce,UserIcon:_t},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:Xe,saveIcon:bt,clearIcon:gt,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:Se("token"),authStore:Ke(),departmentId:0}},methods:{async init(){this.handleClick();const l=this.authStore.department,e=this.authStore.user.departments.find(n=>n.name===l);e&&(this.departmentId=e.id),this.selectedDepartment=l,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(l){var u;const e=(u=this.item.client)!=null&&u.sex.match(/f/i)?"Female":"Male",n={route:`${G.specimenTestTypes}?department_id=${l}&specimen_id=${this.item.specimen_id}&sex=${e}`,method:"GET",token:`${this.cookie}`},{error:v,data:s}=await Y(n);s.value&&(this.rawTestTypes=s.value,this.testTypes=s.value),v.value&&console.error("error: ",v.value)},async submitForm(){this.loading=!0;let l=this.testTypesSelected.map(s=>({specimen:this.item.specimen_id,test_type:s}));const e={route:`${G.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:l}},{data:n,error:v}=await Y(e);n.value&&(this.handleClick(),Q().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),v.value&&(this.handleClick(),console.error("error: ",v.value),Q().$toast.error(fe),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(l,e){if(l!==e){const n=this.authStore.user.departments.find(v=>v.name===l);n&&(this.departmentId=n.id,this.getTestTypes(this.departmentId))}}}},Ms={class:"fixed inset-0 overflow-y-auto"},js={class:"flex min-h-full items-center justify-center p-4 text-center"},Rs={class:"border-b px-3 py-3 flex items-center justify-between"},qs={class:"mt-2 space-y-3 pb-40"},Vs={class:"w-full flex flex-col space-y-2 px-5"},Es={class:"w-full flex flex-col space-y-2 px-5"},Fs={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Os(l,e,n,v,s,u){const c=he,a=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=j("multi-select"),x=ht,E=j("FormKit"),M=j("DialogPanel"),N=j("Dialog"),F=j("TransitionRoot");return S(),V("div",null,[t("div",null,[d(c,{text:"Add test to current order",color:"warning",icon:s.editIcon,click:u.init},null,8,["icon","click"])]),d(F,{appear:"",show:s.open,as:"template"},{default:D(()=>[d(N,{as:"div",onClose:u.handleClick,class:"relative z-10"},{default:D(()=>[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[3]||(e[3]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Ms,[t("div",js,[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",Rs,[d($,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:D(()=>e[4]||(e[4]=[se(" Add Test To Current Order ")])),_:1}),t("button",{onClick:e[0]||(e[0]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),d(E,{type:"form","submit-label":"Update",onSubmit:u.submitForm,actions:!1,id:"submitForm"},{default:D(({value:T})=>[t("div",qs,[t("div",Vs,[e[5]||(e[5]=t("label",{class:"font-medium"},"Department",-1)),d(h,{style:{"--ms-max-height":"none !important"},modelValue:s.selectedDepartment,"onUpdate:modelValue":e[1]||(e[1]=C=>s.selectedDepartment=C),options:s.departments.map(C=>C.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",Es,[e[6]||(e[6]=t("label",{class:"font-medium"},"Tests",-1)),d(h,{style:{"--ms-max-height":"none !important"},modelValue:s.testTypesSelected,"onUpdate:modelValue":e[2]||(e[2]=C=>s.testTypesSelected=C),options:s.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Fs,[d(x,{type:"button",click:()=>u.resetForm(),text:"Clear form"},null,8,["click"]),d(c,{loading:s.loading,type:"submit",click:()=>{},color:"success",icon:s.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Bs=ke(As,[["render",Os]]),Hs={components:{TransitionRoot:Ne,TransitionChild:ze,Dialog:Ze,DialogPanel:Ge,DialogTitle:Ye,XMarkIcon:Ce,PhoneIcon:Gt,EnvelopeIcon:Yt,MapPinIcon:Xt},data(){return{moment:ce,viewIcon:pt,show:this.open,addIcon:mt,checkIcon:Re,editIcon:Xe,acceptIcon:ft,printerIcon:Kt,cookie:Se("token"),authStore:Ke(),details:{},loading:!1,verifying:!1,zebraPrinting:!1}},props:{open:{type:Boolean,required:!1}},methods:{async init(l){this.loading=!0;const e={route:`${G.tests}/${l.id}`,method:"GET",token:`${this.cookie}`},{data:n,error:v,pending:s}=await Y(e);this.loading=s,n.value&&(this.details=n.value,typeof this.details=="object"&&this.handleClick()),v.value&&(this.loading=!1,console.error(v.value),Q().$toast.error(fe))},async printBBResults(){const l={route:G.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.details.order_id,tests:[this.details.id],is_cross_match:!0}},{data:e,error:n,pending:v}=await Y(l);if(this.zebraPrinting=v,e.value){this.zebraPrinting=!1;const s=new FileReader;s.onload=()=>{const u=URL.createObjectURL(e.value),c=document.createElement("a");c.href=u,c.setAttribute("download",`${Date.now()}.lbl`),c.click(),URL.revokeObjectURL(u)},s.readAsText(e.value),Q().$toast.success("Results printed successfully!")}n.value&&(this.zebraPrinting=!1,Q().$toast.error(fe),console.error(n.value))},async changeStatus(l,e){this.verifying=!0;const n={route:`${G.testStatus}/${e}/${l}`,method:"PUT",token:`${this.cookie}`},{data:v,error:s,pending:u}=await Y(n);this.verifying=u,v.value&&(this.verifying=!1,Q().$toast.success(`${this.details.test_type_name} test for ${this.details.client.first_name} ${this.details.client.middle_name!==null?this.details.client.middle_name:""} ${this.details.client.last_name} verified successfully!`),this.viewReport(!0)),s.value&&(console.error(s.value),this.verifying=!1)},updateChanges(){this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return rt.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return rt.printTrackingNumber(this.details.tracking_number)},viewReport(l=!1){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}&printer=${l}`)},getRequestedBy(l){let e="";return l.forEach(n=>{n.status.name==="pending"&&(e=`${n.initiator.first_name} ${n.initiator.last_name}`)}),xe(e)},isRejectedOrVoided(l){return new Set(["voided","test-rejected","rejected","not-done"]).has(l.toLowerCase())},isCompletedByCurrentUserOrSuperAdmin(l){const e=this.authStore.user,n=l.completed_by;if(n){if(n.id!==e.id)return!0;if(n.is_super_admin===!0)return!0}return!1},getTurnAroundTime(l){const e=new Date(l.created_date),n=l.status_trail.find(x=>x.status.name.toLowerCase()==="verified");if(!n)return"In progress...";const s=new Date(n.created_date).getTime()-e.getTime(),u=Math.floor(s/1e3),c=Math.floor(u/(3600*24)),a=Math.floor(u%(3600*24)/3600),$=Math.floor(u%3600/60),g=u%60,h=[];return c>0&&h.push(`${c} day${c>1?"s":""}`),a>0&&h.push(`${a} hour${a>1?"s":""}`),$>0&&h.push(`${$} minute${$>1?"s":""}`),g>0&&h.push(`${g} second${g>1?"s":""}`),h.length>0?h.join(", "):"0 seconds"}}},Us="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27%2015V4H10C9.44772%204%209%204.44772%209%205V43C9%2043.5523%209.44772%2044%2010%2044H38C38.5523%2044%2039%2043.5523%2039%2043V16H28C27.4477%2016%2027%2015.5523%2027%2015ZM29%2014V4.58579L38.4142%2014H29ZM17%2019C17%2018.4477%2017.4477%2018%2018%2018H23C25.2091%2018%2027%2019.7909%2027%2022C27%2024.0759%2025.4186%2025.7825%2023.3948%2025.9808L27%2029.5859L30.2929%2026.293L31.7072%2027.7072L28.4142%2031.0001L31.7071%2034.293L30.2928%2035.7072L27%2032.4143L23.7072%2035.7072L22.2929%2034.293L25.5858%2031.0001L20.5857%2026H19V33H17V25V19ZM23%2024H19V20H23C24.1046%2020%2025%2020.8954%2025%2022C25%2023.1046%2024.1046%2024%2023%2024Z'%20fill='currentColor'/%3e%3c/svg%3e",Ns="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M19%204C18.4477%204%2018%204.44772%2018%205V8C18%208.55228%2018.4477%209%2019%209H20V11.2729C19.4174%2011.4788%2019%2012.0344%2019%2012.6875V39C19%2041.7614%2021.2386%2044%2024%2044C26.7614%2044%2029%2041.7614%2029%2039V12.6875C29%2012.0344%2028.5826%2011.4788%2028%2011.2729V9H29C29.5523%209%2030%208.55228%2030%208V5C30%204.44772%2029.5523%204%2029%204H19ZM22%2011.6875V9H26V11.6875C26%2012.3406%2026.4174%2012.8962%2027%2013.1021V18H21V13.1021C21.5826%2012.8962%2022%2012.3406%2022%2011.6875Z'%20fill='currentColor'/%3e%3c/svg%3e",zs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M28.7526%206.3415C28.4782%206.02797%2028.0383%205.91736%2027.6483%206.0639C27.2583%206.21043%2027%206.58339%2027%207V14C27%2015.1046%2027.8954%2016%2029%2016H35C35.3924%2016%2035.7485%2015.7705%2035.9106%2015.4132C36.0728%2015.0559%2036.011%2014.6368%2035.7526%2014.3415L28.7526%206.3415ZM20.75%2023H19.25L20%2021.2L20.75%2023ZM27.5576%205L37%2015.3866V40C37%2041.6569%2035.6569%2043%2034%2043H14C12.3431%2043%2011%2041.6569%2011%2040V8C11%206.34315%2012.3431%205%2014%205H27.5576ZM21.8462%2015.2308C21.5356%2014.4855%2020.8074%2014%2020%2014C19.1926%2014%2018.4644%2014.4855%2018.1538%2015.2308L13.1538%2027.2308C12.729%2028.2504%2013.2112%2029.4213%2014.2308%2029.8462C15.2504%2030.271%2016.4213%2029.7888%2016.8462%2028.7692L17.5833%2027H22.4167L23.1538%2028.7692C23.5787%2029.7888%2024.7496%2030.271%2025.7692%2029.8462C26.7888%2029.4213%2027.271%2028.2504%2026.8462%2027.2308L26.7432%2026.9837C26.8273%2026.9944%2026.913%2027%2027%2027H28V28C28%2029.1046%2028.8954%2030%2030%2030C31.1046%2030%2032%2029.1046%2032%2028V27H33C34.1046%2027%2035%2026.1046%2035%2025C35%2023.8954%2034.1046%2023%2033%2023H32V22C32%2020.8954%2031.1046%2020%2030%2020C28.8954%2020%2028%2020.8954%2028%2022V23H27C26.3521%2023%2025.7762%2023.3081%2025.4107%2023.7857L21.8462%2015.2308ZM15%2031C13.8954%2031%2013%2031.8954%2013%2033C13%2034.1046%2013.8954%2035%2015%2035C13.8954%2035%2013%2035.8954%2013%2037C13%2038.1046%2013.8954%2039%2015%2039H27C28.1046%2039%2029%2038.1046%2029%2037C29%2035.8962%2028.1058%2035.0012%2027.0023%2035H33C34.1046%2035%2035%2034.1046%2035%2033C35%2031.8954%2034.1046%2031%2033%2031L15%2031Z'%20fill='currentColor'%20stroke='%23333333'%20stroke-width='2'%20stroke-linejoin='round'/%3e%3c/svg%3e",kt="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M40%2024.0005C40%2027.3142%2037.3137%2030.0005%2034%2030.0005H32.566L27.7629%2024.9453C27.9142%2024.6638%2028%2024.3419%2028%2024C28%2022.8954%2027.1046%2022%2026%2022H24.9645L21.1644%2018.0005H34C37.3137%2018.0005%2040%2020.6868%2040%2024.0005ZM36%2023.9995C36%2023.1711%2035.3284%2022.4995%2034.5%2022.4995C33.6716%2022.4995%2033%2023.1711%2033%2023.9995C33%2024.8279%2033.6716%2025.4995%2034.5%2025.4995C35.3284%2025.4995%2036%2024.8279%2036%2023.9995ZM30.752%2023.25C31.1673%2023.25%2031.504%2023.5858%2031.504%2024C31.504%2024.4142%2031.1673%2024.75%2030.752%2024.75C30.3367%2024.75%2030%2024.4142%2030%2024C30%2023.5858%2030.3367%2023.25%2030.752%2023.25Z'%20fill='%23333333'/%3e%3cpath%20d='M12%2024C12%2022.8954%2012.8954%2022%2014%2022H16.6881L12.9715%2018.0883C10.1478%2018.5761%208%2021.0375%208%2024.0005C8%2027.3142%2010.6863%2030.0005%2014%2030.0005H24.2896L20.4886%2026H14C12.8954%2026%2012%2025.1046%2012%2024Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44%2024C44%2035.0457%2035.0457%2044%2024%2044C12.9543%2044%204%2035.0457%204%2024C4%2012.9543%2012.9543%204%2024%204C35.0457%204%2044%2012.9543%2044%2024ZM42%2024C42%2029.1085%2039.8719%2033.7199%2036.4539%2036.9962L11.6573%2010.8981C14.8798%207.86121%2019.2226%206%2024%206C33.9411%206%2042%2014.0589%2042%2024ZM24%2042C28.1125%2042%2031.9028%2040.6209%2034.9338%2038.2999L10.2781%2012.35C7.60984%2015.4897%206%2019.5569%206%2024C6%2033.9411%2014.0589%2042%2024%2042Z'%20fill='%23333333'/%3e%3c/svg%3e",Zs={key:0},Gs={class:"fixed inset-0 overflow-y-auto"},Ys={class:"flex min-h-full items-center justify-center text-center"},Xs={class:"border-b px-3 py-3 flex items-center justify-between"},Ks={class:"flex items-center justify-center mx-auto my-20"},Ws={class:"grid grid-cols-3 gap-4 px-5 py-5"},Qs={class:"rounded border"},Js={class:"w-full space-y-2 py-2"},eo={class:"w-full flex justify-between px-4 py-1"},to={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},so={class:"w-full flex justify-between px-4 py-1"},oo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},no={class:"rounded border"},lo={class:"w-full space-y-2 py-2"},ro={class:"w-full flex justify-between px-4 py-1"},ao={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},io={class:"w-full flex justify-between px-4 py-1"},co={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},uo={class:"w-full flex justify-between px-4 py-1"},po={class:"rounded border max-h-72 overflow-y-auto"},mo={class:"w-full space-y-2 py-2"},fo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},vo={class:"w-full flex justify-between px-4 py-1"},ho={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},_o={class:"w-full flex justify-between px-4 py-1"},bo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},go={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},yo={class:"w-full flex justify-between px-4 py-1"},wo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},xo={class:"mx-5 rounded border mb-5"},Co={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},ko={class:"justify-end flex items-center space-x-3"},So={key:0},To={class:"flex items-center space-x-1"},$o=["innerHTML"],Po={key:1,class:"text-xs"},Do={key:1,class:"px-4 py-2 flex items-center"},Io={class:"text-lg font-semibold"},Lo={class:"text-base text-gray-600 font-normal"},Ao={key:2,class:"px-2.5 py-2.5 border-t"};function Mo(l,e,n,v,s,u){const c=cs,a=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=es,x=he,E=Bs,M=j("DialogPanel"),N=j("Dialog"),F=j("TransitionRoot");return S(),V("div",null,[Wt(l.$slots,"default",{onClick:e[0]||(e[0]=(...T)=>u.init&&u.init(...T))}),s.details!==null&&s.details.client!==void 0?(S(),V("div",Zs,[d(c,{class:"hidden",ref:"corePrinter",orderId:`${s.details.order_id}`,id:`${s.details.client.id}`},null,8,["orderId","id"])])):K("",!0),d(F,{appear:"",show:s.show,as:"template"},{default:D(()=>[d(N,{as:"div",class:"relative z-10"},{default:D(()=>[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[2]||(e[2]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Gs,[t("div",Ys,[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",Xs,[d($,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:D(()=>e[3]||(e[3]=[t("img",{src:Us,class:"w-8 h-8 mr-2"},null,-1),se(" View Test ")])),_:1}),t("button",{onClick:e[1]||(e[1]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),He(t("div",Ks,[d(h,{loading:s.loading},null,8,["loading"])],512),[[Ue,s.loading]]),t("div",Ws,[t("div",Qs,[e[8]||(e[8]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[t("h3",{class:"text-lg font-semibold text-black flex items-center"},[t("img",{src:Qt,class:"w-7 h-7 mr-1"}),se(" Patient ")])],-1)),t("div",Js,[t("div",eo,[e[4]||(e[4]=t("h3",{class:"font-semibold"},"Patient Number",-1)),t("p",null,P(s.details.client.id),1)]),t("div",to,[e[5]||(e[5]=t("h3",{class:"font-semibold"},"Name",-1)),t("p",null,P(("capitalize"in l?l.capitalize:m(xe))(`${s.details.client.first_name} ${s.details.client.middle_name!==null?s.details.client.middle_name:""} ${s.details.client.last_name}`)),1)]),t("div",so,[e[6]||(e[6]=t("h3",{class:"font-semibold"},"Sex",-1)),t("p",null,P(s.details.client.sex),1)]),t("div",oo,[e[7]||(e[7]=t("h3",{class:"font-semibold"},"Age",-1)),t("p",null,P(("calculateAge"in l?l.calculateAge:m(vt))(s.details.client.date_of_birth)),1)])])]),t("div",no,[e[14]||(e[14]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[t("h3",{class:"text-lg font-semibold text-black flex items-center"},[t("img",{src:Ns,class:"w-7 h-7 mr-1"}),se(" Specimen ")])],-1)),t("div",lo,[t("div",ro,[e[9]||(e[9]=t("h3",{class:"font-semibold"},"Specimen Type",-1)),t("p",null,P(s.details.specimen_type),1)]),t("div",ao,[e[10]||(e[10]=t("h3",{class:"font-semibold"},"Tracking Number",-1)),t("p",null,P(s.details.tracking_number),1)]),t("div",io,[e[11]||(e[11]=t("h3",{class:"font-semibold"},"Accession Number",-1)),t("p",null,P(s.details.accession_number),1)]),t("div",co,[e[12]||(e[12]=t("h3",{class:"font-semibold"},"Status",-1)),t("p",null,P(("capitalize"in l?l.capitalize:m(xe))(s.details.order_status.split("-").join(" "))),1)]),t("div",uo,[e[13]||(e[13]=t("h3",{class:"font-semibold"},"Turn Around Time",-1)),t("p",null,P(u.getTurnAroundTime(s.details)),1)])])]),t("div",po,[e[23]||(e[23]=t("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[t("img",{src:zs,class:"w-7 h-7 mr-1"}),t("h3",{class:"text-lg font-semibold text-black"},"Test")],-1)),t("div",mo,[t("div",fo,[e[15]||(e[15]=t("h3",{class:"font-semibold"},"Name",-1)),t("p",null,P(s.details.test_type_name),1)]),t("div",vo,[e[16]||(e[16]=t("h3",{class:"font-semibold"},"Date Registered",-1)),t("p",null,P(s.moment(s.details.created_date).format("DATE_FORMAT"in l?l.DATE_FORMAT:m(at))),1)]),t("div",ho,[e[17]||(e[17]=t("h3",{class:"font-semibold"},"Receipt Date",-1)),t("p",null,P(s.moment(s.details.updated_date).format("DATE_FORMAT"in l?l.DATE_FORMAT:m(at))),1)]),t("div",_o,[e[18]||(e[18]=t("h3",{class:"font-semibold"},"Test Status",-1)),t("p",null,P(("capitalizeStr"in l?l.capitalizeStr:m(Jt))(s.details.status.split("-").join(" "))),1)]),t("div",bo,[e[19]||(e[19]=t("h3",{class:"font-semibold"},"Ward/Location",-1)),t("p",null,P(s.details.requesting_ward),1)]),t("div",go,[e[20]||(e[20]=t("h3",{class:"font-semibold"},"Request Origin",-1)),t("p",null,P(s.details.request_origin),1)]),t("div",yo,[e[21]||(e[21]=t("h3",{class:"font-semibold"},"Registered By",-1)),t("p",null,P(u.getRequestedBy(s.details.status_trail)),1)]),t("div",wo,[e[22]||(e[22]=t("h3",{class:"font-semibold"},"Requested By",-1)),t("p",null,P(s.details.requested_by),1)])])])]),t("div",xo,[t("div",Co,[e[24]||(e[24]=t("h3",{class:"text-lg font-semibold text-black"},"Results",-1)),t("div",ko,[s.details.status.toLowerCase()==="completed"&&("usePermissions"in l?l.usePermissions:m(me))().can.verify("test_results")&&u.isCompletedByCurrentUserOrSuperAdmin(s.details)?(S(),J(x,{key:0,icon:s.checkIcon,text:"Authorize",click:()=>{u.changeStatus("verified",s.details.id)},color:"success",loading:s.verifying},null,8,["icon","click","loading"])):K("",!0),(s.details.status.toLowerCase()==="completed"||s.details.status.toLowerCase()==="verified"||s.details.status.toLowerCase()==="test-rejected")&&("usePermissions"in l?l.usePermissions:m(me))().can.view("reports")?(S(),J(x,{key:1,icon:s.viewIcon,text:"View Report",click:u.viewReport,color:"primary"},null,8,["icon","click"])):K("",!0),d(E,{item:s.details,onUpdate:u.updateChanges,color:"primary"},null,8,["item","onUpdate"]),d(x,{icon:s.printerIcon,text:"Print Accession Number",click:u.printAccessionNumber,color:"primary"},null,8,["icon","click"]),d(x,{icon:s.printerIcon,color:"success",text:"Print Tracking Number",click:u.printTrackingNumber},null,8,["icon","click"])])]),u.isRejectedOrVoided(s.details.status)?(S(),V("div",Do,[e[26]||(e[26]=t("img",{src:kt,class:"w-6 h-6 mr-2",alt:"no-result-svg"},null,-1)),t("h3",Io,[e[25]||(e[25]=se("Test Rejected: ")),t("span",Lo,P(s.details.rejection_reason),1)])])):(S(),V("div",So,[(S(!0),V(re,null,ye(s.details.indicators,(T,C)=>{var I;return S(),V("div",{class:dt(s.details.indicators.length!==C+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:C},[t("h3",null,P(T.name),1),t("div",To,[T.result?(S(),V("p",{key:0,innerHTML:T.result.value?T.result.value:"Not done"},null,8,$o)):K("",!0),(I=T.result)!=null&&I.value?(S(),V("span",Po,P(T==null?void 0:T.unit),1)):K("",!0)])],2)}),128))])),s.details.test_type_name=="Cross-match"&&s.details.status.toLowerCase()=="verified"?(S(),V("div",Ao,[d(x,{loading:s.zebraPrinting,click:()=>{u.printBBResults()},text:"Print results",color:"primary",icon:s.printerIcon},null,8,["loading","click","icon"])])):K("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const jo=ke(Hs,[["render",Mo]]),Ro={components:{TransitionRoot:Ne,TransitionChild:ze,Dialog:Ze,DialogPanel:Ge,DialogTitle:Ye,XMarkIcon:Ce,UserIcon:_t},data(){return{open:!1,addIcon:mt,saveIcon:bt,clearIcon:gt,name:"",description:"",loading:!1,cookie:Se("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const l={route:G.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:e,data:n}=await Y(l);n.value&&(this.rawReasons=n.value,n.value.map(v=>{this.reasons.push(v.description)})),e.value&&console.error(e.value)},async submitForm(){this.loading=!0;let l=null;this.rawReasons.map(u=>{u.description===this.reasonsSelected&&(l=u.id)});const e={route:`${G.testStatus}/${this.item.id}/${this.action}?status_reason_id=${l}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:n,error:v,pending:s}=await Y(e);this.loading=s,n.value&&(Q().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),v.value&&(console.error(v.value),Q().$toast.error(fe),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},qo={class:"fixed inset-0 overflow-y-auto"},Vo={class:"flex min-h-full items-center justify-center p-4 text-center"},Eo={class:"border-b px-3 py-3 flex items-center justify-between"},Fo={class:"mt-2 space-y-3 px-5 py-5"},Oo={class:"space-y-2"},Bo={class:"border-b border-dotted text-gray-600"},Ho={class:"space-y-2"},Uo={class:"border-b border-dotted text-gray-600"},No={class:"space-y-2"},zo={class:"border-b border-dotted text-gray-600"},Zo={class:"w-full flex items-center"},Go={class:"w-full flex flex-col space-y-2"},Yo={class:"w-full flex flex-col space-y-2 pb-40"},Xo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Ko(l,e,n,v,s,u){const c=he,a=j("TransitionChild"),$=j("DialogTitle"),g=j("XMarkIcon"),h=j("FormKit"),x=j("multi-select"),E=ht,M=j("DialogPanel"),N=j("Dialog"),F=j("TransitionRoot");return S(),V("div",null,[t("div",null,[d(c,{text:n.text,color:"error",icon:n.icon,click:u.init},null,8,["text","icon","click"])]),d(F,{appear:"",show:s.open,as:"template"},{default:D(()=>[d(N,{as:"div",onClose:u.handleClick,class:"relative z-10"},{default:D(()=>[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:D(()=>e[3]||(e[3]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",qo,[t("div",Vo,[d(a,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:D(()=>[d(M,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:D(()=>[t("div",Eo,[d($,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:D(()=>[e[4]||(e[4]=t("img",{src:kt,class:"w-8 h-8 mr-2"},null,-1)),se(" "+P(n.text.charAt(0).toUpperCase()+n.text.slice(1))+" Reason ",1)]),_:1}),t("button",{onClick:e[0]||(e[0]=(...T)=>u.handleClick&&u.handleClick(...T))},[d(g,{class:"w-5 h-5"})])]),d(h,{type:"form","submit-label":"Update",onSubmit:u.submitForm,actions:!1,id:"rejectionForm"},{default:D(({value:T})=>[t("div",Fo,[t("div",Oo,[e[5]||(e[5]=t("h3",{class:"font-medium"},"Test Type",-1)),t("p",Bo,P(n.item.test_type_name),1)]),t("div",Ho,[e[6]||(e[6]=t("h3",{class:"font-medium"},"Specimen",-1)),t("p",Uo,P(n.item.specimen_type),1)]),t("div",No,[e[7]||(e[7]=t("h3",{class:"font-medium"},"Accession Number",-1)),t("p",zo,P(n.item.accession_number),1)]),t("div",Zo,[t("div",Go,[d(h,{type:"text",label:"Person Talked To",validation:n.text.toLowerCase()!=="void"?"required":"",modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=C=>s.name=C)},null,8,["validation","modelValue"])])]),t("div",Yo,[e[8]||(e[8]=t("label",{class:"font-medium"},"Select Reason(s)",-1)),d(x,{style:{"--ms-max-height":"none !important"},modelValue:s.reasonsSelected,"onUpdate:modelValue":e[2]||(e[2]=C=>s.reasonsSelected=C),options:s.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Xo,[d(E,{type:"button",text:"Clear form",click:u.resetForm},null,8,["click"]),d(c,{loading:s.loading,type:"submit",click:()=>{},color:"success",icon:s.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Wo=ke(Ro,[["render",Ko]]),Qo={class:"py-5 px-5"},Jo={class:"flex items-center space-x-2 py-5"},en={class:"text-2xl font-semibold uppercase"},tn={class:"flex justify-between items-center w-full py-2 mb-2"},sn={class:"flex items-center space-x-2"},on={class:"relative z-10 w-40"},nn={class:"w-44"},ln={class:"pt-1"},rn={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},an={class:"w-72 ml-2"},cn={class:"py-3 flex items-center space-x-3"},un={class:"py-2 flex items-center"},dn={class:"w-full flex items-center justify-between space-x-2"},pn={key:0,class:"flex items-center space-x-2"},mn={key:0,class:"flex items-center space-x-2"},zn=ve({__name:"index",setup(l){const e=Ke(),n=ts(),v=ss(),{$toast:s,$metadata:u}=Q();ds({title:`${ps.name.toUpperCase()} - ${e.department} Tests`});const c=k(!1),a=k(0),$=k(),g=k(["",""]),h=k(""),x=k("Tests Lists"),E=k([{name:"Home",link:"/home"}]),M=k([{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions",sortable:!1}]),N=k([{text:"Results",color:"primary",icon:ms,status:"completed",show:"started",permission:"enter_test_results"},{text:"Accept",color:"success",icon:Re,status:"pending",show:"not-collected",permission:"accept_test_specimen"},{text:"Start",color:"warning",icon:ks,status:"started",show:"pending",permission:"start_test"},{text:"Authorize",color:"success",status:"verified",icon:Re,show:"completed",permission:"verify_test_results"}]),F=o=>{const r=[{name:"Reject",icon:Le,action:"rejected",permission:"void_test"},{name:"Void",icon:Le,action:"voided",permission:"void_test"},{name:"Notdone",icon:Le,action:"not_done",permission:"void_test"}];return o.toLowerCase()==="verified"?r.filter(p=>p.name.toLowerCase()==="void"):r},T=k([]),C=k({name:"select status"}),I=k("accession_number"),L=k(""),y=Se("token"),i=k(!1),b=k(!0),_=k(0),R=k([]),z=k({page:1,rowsPerPage:10,sortBy:"name"}),X=k([]),B=k([]),Te=o=>{a.value==o?a.value=0:a.value=o},ae=async o=>{i.value=!0;const r={route:`${G.nlimsTestSearch}?tracking_number=${o.replace(/\$$/,"")}`,method:"GET",token:`${y.value}`},{data:p,error:w}=await Y(r);p.value&&(ns(p.value).then(q=>{const H={...n.query,search:q};v.replace({query:H}),h.value=q,L.value=q,Z()}).catch(q=>{console.error("error routing to merged test: ",q)}),i.value=!1),w.value&&(console.error(w.value),s.error(`${w.value.data.error}`),i.value=!1)},Z=async()=>{St(),i.value=!0;const{page:o,rowsPerPage:r}=z.value;let p=Je(e.user.departments,e.department),w=Je(e.locations,e.selectedLocation),q=C.value.name==="select status"?"":C.value.name!==void 0&&C.value.name;const H=g.value[0].toString()!==""?ce(g.value[0].toString()).format("YYYY-MM-DD"):"",$e=g.value[1].toString()!==""?ce(g.value[1].toString()).format("YYYY-MM-DD"):"",Pe={route:`${G.tests}?minimal=true&page=${o}&per_page=${r}&status=${q.toString().toLowerCase()}&search=${h.value}&department_id=${p}&lab_location=${w}&start_date=${H}&end_date=${$e}&facility_sections=${R.value}`,method:"GET",token:`${y.value}`},{data:ie,error:be,pending:De}=await Y(Pe);i.value=De,ie.value&&(ie.value.data.length==0&&s.warning("No tests found within the specified period"),T.value=ie.value.data.map(O=>{var A,U,de,nt;return{...O,name:`${xe(`${(A=O.client)==null?void 0:A.first_name} ${((U=O.client)==null?void 0:U.middle_name)!==null?O.client.middle_name:""} ${(de=O.client)==null?void 0:de.last_name}`)} (${O.client.sex}, ${vt((nt=O.client)==null?void 0:nt.date_of_birth)} yrs)`,order_status:`${O.order_status!==null?(O.order_status.charAt(0).toUpperCase()+O.order_status.slice(1)).split("-").join(" "):""}`,status:`${O.status!==null?O.status.charAt(0).toUpperCase()+O.status.slice(1):""}`,created_date:ce(O.created_date).utcOffset(2).format(os)}}),_.value=ie.value.meta.total_count,i.value=!1),be.value&&(console.error(be.value.data),s.error(fe),i.value=!1)},St=async()=>{const o={route:`${G.testStatus}/all`,method:"GET",token:`${y.value}`},{data:r,error:p}=await Y(o);r.value&&(X.value=r.value.map(w=>({id:w.id,name:w.name.charAt(0).toUpperCase()+w.name.slice(1)}))),p.value&&console.error(p.value)},Tt=async(o,r)=>{i.value=!0;const p={route:`${G.testStatus}/${r}/${o}`,method:"PUT",token:`${y.value}`,body:{}},{data:w,error:q,pending:H}=await Y(p);i.value=H,w.value&&(Z(),i.value=!1),q.value&&(console.error(q.value),i.value=!1)},$t=async(o,r)=>{i.value=!0;const p={route:`${G.orderStatus}/${o}`,method:"PUT",token:`${y.value}`,body:{order_id:r}},{data:w,error:q,pending:H}=await Y(p);i.value=H,w.value&&(Z(),i.value=!1),q.value&&(console.error(q.value),i.value=!1)},Qe=(o,r)=>{o.status==="completed"?r.test_type_name.toLowerCase().includes("culture")?et(r,`/tests/result/culture-sensitivity?accession_number=${r.accession_number}&test_id=${r.id}`):et(r,`/tests/result?accession_number=${r.accession_number}&test_id=${r.id}`):o.status==="verified"?ot(r):o.status!==""&&Tt(o.status,r.id)},Je=(o,r)=>{const p=o.find(w=>w.name===r);return p?p.id:null},_e=o=>{if(a.value=0,typeof o=="object"){z.value=o;const r={...n.query,page:o.page,rowsPerPage:o.rowsPerPage};v.replace({query:r})}Z(),c.value=!1},Pt=()=>{L.value="",h.value="",Z()},Dt=o=>{h.value=o,L.value=o;const r={...n.query,search:o};v.replace({query:r}),o!==""?Lt(o)?ae(o):_e(o):Z()},It=o=>{if(o){R.value=o;for(let r=B.value.length-1;r>=0;r--){const p=B.value[r];p.origin==="wards"&&!o.includes(p.value)&&B.value.splice(r,1)}o.forEach(r=>{B.value.some(p=>p.origin==="wards"&&p.value===r)||B.value.push({origin:"wards",value:r})}),Z()}},et=(o,r)=>{v.push(r)},Lt=o=>/^(x|l).*\d/.test(o.toLowerCase()),tt=o=>{if(o.name!=="select status"){const p=B.value.find(w=>w.origin==="statuses");p?p.value=o.name:B.value.push({origin:"statuses",value:o.name})}C.value=o;const r={...n.query,status:o.name.toLowerCase()=="select status"?"":o.name.toLowerCase()};v.replace({query:r}),r.status!==""&&Z()},At=o=>{if(o.origin==="statuses"&&C.value.name!=="select status"&&tt({name:"select status"}),o.origin==="wards"){const p=R.value.indexOf(o.value);p!==-1&&R.value.splice(p,1)}const r=B.value.findIndex(p=>p.origin===o.origin);r!==-1&&B.value.splice(r,1),Z()},Mt=o=>{const r=e.user,p=o.completed_by;if(p){if(p.id!==r.id)return!0;if(p.is_super_admin===!0)return!0}return!1},jt=(o,r)=>{const{hasPermission:p}=me(),w=o.status.toLowerCase(),q=r.show.toLowerCase();if(w===q){const H=Mt(o);return w==="pending"&&o.order_status.toLowerCase()==="specimen not collected"?!1:r.permission?H&&p.value(String(r.permission)):H}return!1},Rt=o=>{const r=new Set(["rejected","not-done","voided"]),p=new Set(["specimen not collected"]);return!r.has(o.status.toLowerCase())&&p.has(o.order_status.toLowerCase())},st=o=>{const{can:r}=me();return!new Set(["voided","test-rejected","rejected","not-done"]).has(o.status.toLowerCase())&&r.void("test")},qt=()=>{g.value=["",""]},ot=o=>{$!==null&&$.value.init(o)};return Ie(e,(o,r)=>{o!==r&&Z()},{deep:!0}),Ie(g,(o,r)=>{if(b.value){b.value=!1;return}if(o!==r){const p=o[0].toString()!==""?ce(o[0].toString()).format("YYYY-MM-DD"):"",w=o[1].toString()!==""?ce(o[1].toString()).format("YYYY-MM-DD"):"",q={...n.query,from:p,to:w};v.replace({query:q}),Z()}},{deep:!0}),Ie(C,o=>{tt(o)},{deep:!0}),Oe(()=>{var o,r,p,w,q,H;z.value={page:Number(n.query.page?n.query.page:1),rowsPerPage:Number(n.query.rowsPerPage?n.query.rowsPerPage:10)},C.value=n.query.status?{name:n.query.status.toString()}:{name:"select status"},h.value=(o=n.query.search)!=null&&o.toString()?(r=n.query.search)==null?void 0:r.toString():"",g.value=[`${(p=n.query.from)!=null&&p.toString()?(w=n.query.from)==null?void 0:w.toString():""}`,`${(q=n.query.to)!=null&&q.toString()?(H=n.query.to)==null?void 0:H.toString():""}`],Z()}),(o,r)=>{const p=Vt,w=he,q=ls,H=$s,$e=j("datepicker"),Pe=is,ie=Ls,be=jo,De=Wo,O=us;return S(),V("div",Qo,[d(p,{pages:m(E)},null,8,["pages"]),t("div",Jo,[r[3]||(r[3]=t("svg",{class:"w-auto h-8",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},[t("path",{fill:"currentColor",d:"M20 17c1.105 0 2-.933 2-2.083c0-.72-.783-1.68-1.37-2.3a.86.86 0 0 0-1.26 0c-.587.62-1.37 1.58-1.37 2.3c0 1.15.895 2.083 2 2.083m-3.722-6.432l1.505-2.598l-8.41-4.826L2.65 14.746a4.827 4.827 0 0 0 1.776 6.606a4.86 4.86 0 0 0 6.629-1.77l1.12-1.932z",opacity:"0.5"}),t("path",{fill:"currentColor",d:"M9.294 1.354a.75.75 0 0 0-.763 1.292l.835.494l.006.003l8.41 4.827l.844.484a.75.75 0 1 0 .747-1.3l-9.247-5.308zm3.633 14.998l-.002-.002l-2.612-1.503a.75.75 0 0 0-.748 1.3l2.61 1.503zm1.638-2.827l-.002-.001l-4.203-2.418a.75.75 0 0 0-.748 1.3l4.2 2.417zm1.711-2.958l-2.558-1.472a.75.75 0 0 0-.748 1.3l2.556 1.47z"})],-1)),t("h3",en,P(m(x)),1)]),t("div",tn,[t("div",sn,[d(w,{text:"Refresh",color:"warning",icon:m(fs),click:()=>{Pt()},loading:m(i)},null,8,["icon","click","loading"]),t("div",on,[d(q,{items:m(X),modelValue:m(C),"onUpdate:modelValue":r[0]||(r[0]=A=>ge(C)?C.value=A:null)},null,8,["items","modelValue"])]),t("div",nn,[d(H,{wards:m(u).wards,"onUpdate:itemsSelected":It},null,8,["wards"])]),t("div",ln,[t("div",rn,[d(m(vs),{class:"w-5 h-5 mr-2"}),r[4]||(r[4]=se(" Date Range ")),t("div",an,[d($e,{required:"",position:"left",onCleared:qt,placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:m(g),"onUpdate:modelValue":r[1]||(r[1]=A=>ge(g)?g.value=A:null)},null,8,["modelValue"])])])])]),d(Pe,{onUpdate:Dt,search:m(h),"onUpdate:search":r[2]||(r[2]=A=>ge(h)?h.value=A:null)},null,8,["search"])]),t("div",cn,[(S(!0),V(re,null,ye(m(B),(A,U)=>(S(),J(ie,{value:A,close:"",color:"green",key:U,onUpdate:At},null,8,["value"]))),128))]),d(O,{headers:m(M),data:m(T),loading:m(i),searchField:m(I),searchValue:m(L),serverItemsLength:m(_),serverOptions:m(z),onUpdate:_e},{actions:D(({item:A})=>[t("div",un,[t("div",dn,[m(a)!==A.id?(S(),V("div",pn,[d(be,{ref_key:"testsDialog",ref:$,onUpdate:_e},{default:D(()=>[d(w,{color:"primary",text:"View",icon:m(pt),click:()=>{ot(A)}},null,8,["icon","click"])]),_:2},1536),A.status.toLowerCase()==="completed"&&("usePermissions"in o?o.usePermissions:m(me))().can.edit("test_results")?(S(),J(w,{key:0,click:()=>{Qe({status:"completed"},A)},text:"Edit",color:"success",icon:m(Xe)},null,8,["click","icon"])):K("",!0),(S(!0),V(re,null,ye(m(N),(U,de)=>He((S(),J(w,{color:U.color,text:U.text,icon:U.icon,click:()=>{Qe(U,A)},key:de},null,8,["color","text","icon","click"])),[[Ue,jt(A,U)]])),128)),Rt(A)?(S(),J(w,{key:1,color:"success",text:"Accept",icon:m(ft),click:()=>$t("accepted",A.order_id)},null,8,["icon","click"])):K("",!0)])):K("",!0),st(A)?(S(),J(w,{key:1,click:()=>Te(A.id),color:"",text:"",icon:m(c)==!0?m(hs):m(_s)},null,8,["click","icon"])):K("",!0)]),st(A)&&m(a)==A.id?(S(),V("div",mn,[(S(!0),V(re,null,ye(F(A.status),(U,de)=>(S(),J(De,{key:U.name,item:A,text:U.name,icon:U.icon,action:U.action,onUpdate:_e},null,8,["item","text","icon","action"]))),128))])):K("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions"]),r[5]||(r[5]=t("div",{id:"tests-container"},null,-1))])}}});export{zn as default};
