import{_ as de}from"./DeHqjJH7.js";import{S as me,p as ue,Y as pe,G as fe,V as _e,q as ve,a as X,u as A,s as be,x as h,b as f,e as C,f as a,y as S,g as t,j as Q,t as V,F as Y,k as Z,_ as J,d as ye,r as c,c as B,o as ke,w as K,h as s,A as j,D as L,i as W,v as z,H,n as he,l as ge,m as O}from"./BLMYYBub.js";import{S as q}from"./DPmaYSTO.js";import{r as xe}from"./CFxj9TAl.js";import{r as we}from"./B77w2j_x.js";import{r as Se}from"./Cy4dTOpp.js";import{_ as Ce}from"./BM3s60a1.js";import{_ as $e}from"./BOt9Lm4e.js";import{_ as Te}from"./ymv4d8Tv.js";import{_ as Ie}from"./PHlxz6BT.js";import{P as De}from"./CM4UxiDe.js";import{u as Ve}from"./CfmpkH2n.js";import{r as Fe}from"./Dcwqosvn.js";import{r as Me}from"./DnJ5gH3O.js";import{r as Ue}from"./DedXg-G0.js";import"./sNlKP72R.js";import"./DliR-cc7.js";import"./BlFheT0q.js";import"./IJCDyQty.js";import"./cHOIL3XF.js";import"./CkgugtXF.js";import"./BpACQbkq.js";import"./OnYuLN16.js";import"./DDt9YMgi.js";const Ne={components:{TransitionRoot:me,TransitionChild:ue,Dialog:pe,DialogPanel:fe,DialogTitle:_e,XMarkIcon:ve},data(){return{transferIcon:xe,saveIcon:we,show:!1,loading:!1,editIcon:Se,cookie:X("token")}},props:{data:{type:Object,required:!0}},computed:{filteredRequisitions(){return this.data.requisitions.map(m=>({stock_item_name:m.stock_item.name,stock_item_id:m.stock_item.id,quantity:m.quantity_requested,lot:m.lot_number,batch:m.batch_number}))}},methods:{async submitForm(){this.loading=!0;const m=new q,l={sending_to:this.data.sendingTo,stock_status_reason:this.data.reason,stock_items:this.filteredRequisitions},{data:g,error:T,pending:_}=await m.stockOutTransaction(`${this.cookie}`,l);this.loading=_,g.value&&(this.loading=!1,A().$toast.success(g.value.message),this.handleClick(),this.$router.push("/stock-management/issue")),T.value&&(this.loading=!1,console.error(T.value),this.handleClick())},handleClick(){this.show=!this.show}}},Re={class:"fixed inset-0 overflow-y-auto"},Be={class:"flex min-h-full items-center justify-center p-4 text-center"},je={class:"border-b px-3 py-3 flex items-center justify-between"},Le={class:"py-5 px-5"},Ae={class:"w-full flex items-center space-x-2"},Qe={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},qe={class:"w-full flex items-center space-x-2 mt-2"},Pe={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},Ee={class:"w-full"},Ge={class:"border-b border-t border-r border-l rounded"},Ke={class:"px-2 py-2 border-r"},We={class:"px-2 py-2 border-r"},ze={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function He(m,l,g,T,_,v){const r=J,x=h("TransitionChild"),d=h("DialogTitle"),b=h("XMarkIcon"),$=h("FormKit"),F=h("DialogPanel"),M=h("Dialog"),U=h("TransitionRoot");return f(),C("div",null,[a(r,{click:v.handleClick,color:"success",text:"Transfer",icon:_.transferIcon},null,8,["click","icon"]),a(U,{appear:"",show:_.show,as:"template"},{default:S(()=>[a(M,{as:"div",class:"relative z-10"},{default:S(()=>[a(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>l[1]||(l[1]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Re,[t("div",Be,[a(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[a(F,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[t("div",je,[a(d,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>l[2]||(l[2]=[t("img",{src:Ce,class:"w-8 h-8 mr-2"},null,-1),Q(" Checkout Stock Transfer ")])),_:1}),t("button",{onClick:l[0]||(l[0]=(...u)=>v.handleClick&&v.handleClick(...u))},[a(b,{class:"w-5 h-5"})])]),a($,{type:"form","submit-label":"Update",onSubmit:v.submitForm,actions:!1,id:"submitForm"},{default:S(({value:u})=>[t("div",Le,[t("div",Ae,[l[3]||(l[3]=t("p",{class:"w-72 font-medium"},"To: ",-1)),t("span",Qe,V(g.data.sendingTo),1)]),t("div",qe,[l[4]||(l[4]=t("p",{class:"w-72 font-medium"},"Reason for transfer: ",-1)),t("span",Pe,V(g.data.reason),1)]),l[6]||(l[6]=t("div",{class:"bg-gray-50 px-2 py-2 border rounded-t mt-4"},[t("h3",{class:"font-semibold"},"Stock Out Items")],-1)),t("table",Ee,[l[5]||(l[5]=t("thead",{clas:"w-full border-l border-r"},[t("tr",{class:"border-b border-r border-l rounded"},[t("th",{class:"px-2 py-2 text-left border-r"}," Item "),t("th",{class:"px-2 py-2 text-left"}," Quantity ")])],-1)),t("tbody",null,[(f(!0),C(Y,null,Z(v.filteredRequisitions,(N,y)=>(f(),C("tr",Ge,[t("td",Ke,V(N.stock_item_name),1),t("td",We,V(N.quantity),1)]))),256))])])]),t("div",ze,[a(r,{loading:_.loading,type:"submit",click:()=>{},color:"success",icon:_.transferIcon,text:"Continue"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Oe=be(Ne,[["render",He]]),Xe={class:"px-5 py-5"},Ye={class:"flex items-center justify-between py-5"},Ze={class:""},Je={class:"w-full mt-2 grid grid-cols-3 gap-2"},et={class:"col-span-1 order-2 rounded border"},tt={class:"flex flex-col space-y-2 px-5 py-5"},ot={class:"w-full flex flex-col space-y-2"},st={key:0,class:"w-full flex flex-col space-y-2"},at={class:"font-medium"},nt={class:"col-span-2 order-1 rounded border"},lt={class:"px-5 py-5"},it={class:"grid grid-cols-5 gap-4 mb-5"},rt={class:"mt-8 flex items-center space-x-2"},ct={class:"flex flex-col items-center justify-center space-y-2"},Nt=ye({__name:"transfer-stock",setup(m){Ve({title:`${De.name.toUpperCase()} - Transfer Stock`});const l=Me,g=Ue,{$toast:T,$metadata:_}=A(),v=c([]),r=c({name:"-- select destination --"}),x=c(""),d=c([]),b=c([]),$=X("token"),F=c([]),M=c([]),U=c([]),u=c({name:"-- select item --"}),N=c([{name:"Home",link:"/home"},{name:"Stock Management",link:"#"},{name:"Transactions",link:"/stock-management/transactions"}]),y=c({id:0,value:!1}),P=B(()=>{const e={Department:{items:F,placeholder:"-- select department --"},Facility:{items:M,placeholder:"-- select facility --"},Ward:{items:U,placeholder:"-- select ward --"}}[r.value.name];return e?(u.value={name:e.placeholder},e.items.value):[]}),ee=o=>B(()=>{const e=b.value.find(n=>n.name===o);return e?e.lots:[]}),te=o=>B(()=>{const e=b.value.find(n=>n.name===o);return e?e.batches:[]});async function oe(){se(),le()}async function se(){const o=new q,{data:e,error:n}=await o.getStockItem(String($.value),"metadata=true");e.value&&(b.value=e.value),n.value&&console.error(n.value)}async function ae(){const o={route:ge.facility,method:"GET",token:$.value},{data:e,error:n}=await O(o);e.value&&(M.value=e.value.data),n.value&&console.error(n.value)}async function ne(){const o={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:$.value},{data:e,error:n}=await O(o);e.value&&(U.value=e.value,console.log(e.value)),n.value&&console.error(n.value)}function le(){let o=["Facility","Ward","Department"];v.value=o.map(e=>({name:e}))}async function ie(o){var I;y.value={id:o.id,value:!0};const e=new q,n={stock_item_id:((I=b.value.find(D=>D.name==o.stock_item.name))==null?void 0:I.id)||0,quantity:o.quantity_requested,batch:o.batch_number,lot:o.lot_number},{data:k,error:w,pending:R}=await e.checkStockQuantity($.value,n);y.value={id:o.id,value:R},k.value&&(k.value.deduction_allowed||(A().$toast.warning(k.value.message),o.quantity_requested=0),y.value={id:o.id,value:!1}),w.value&&(console.error(w.value),y.value={id:o.id,value:!1},T.error("Could not verify stock quantity for given lot and batch, please try again"))}function E(){d.value.push({id:0,stock_item:{name:"-- select item --",id:0},quantity_requested:0,batch_number:"",lot_number:""})}function re(o){o>=0&&o<d.value.length&&d.value.splice(o,1)}return ke(()=>{oe()}),K(r,o=>{const n={Department:async()=>{F.value=_.departments},Facility:ae,Ward:ne}[o.name];n&&n()},{deep:!0}),K(d,o=>{o.forEach(e=>{var k;e.stock_item.id=((k=b.value.find(w=>w.name===e.stock_item.name))==null?void 0:k.id)||0,e.quantity_requested>0&&e.batch_number!==""&&e.lot_number!==""&&ie(e)})},{deep:!0}),(o,e)=>{const n=de,k=Oe,w=$e,R=h("FormKit"),I=J,D=Te,ce=he;return f(),C("div",Xe,[a(n,{pages:s(N)},null,8,["pages"]),t("div",Ye,[e[3]||(e[3]=t("h3",{class:"text-2xl font-semibold capitalize"},"Transfer Stock",-1)),t("div",Ze,[a(k,{data:{reason:s(x),sendingTo:`${s(u).name.includes("select")?"":s(u).name} ${s(r).name.includes("select")?"":s(r).name}`,requisitions:s(d)}},null,8,["data"])])]),t("div",null,[t("div",Je,[t("div",et,[e[6]||(e[6]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Details")],-1)),t("div",tt,[t("div",ot,[e[4]||(e[4]=t("label",{class:"font-medium"},"Destination",-1)),a(w,{items:s(v),modelValue:s(r),"onUpdate:modelValue":e[0]||(e[0]=i=>j(r)?r.value=i:null)},null,8,["items","modelValue"])]),s(r)&&s(P).length>0?(f(),C("div",st,[t("label",at,[Q("Select "+V(s(r).name.toLowerCase()),1),e[5]||(e[5]=t("span",{class:"text-red-600 font-medium"},"*",-1))]),a(w,{"is-searchable":!0,items:s(P),modelValue:s(u),"onUpdate:modelValue":e[1]||(e[1]=i=>j(u)?u.value=i:null)},null,8,["items","modelValue"])])):L("",!0),a(R,{label:"Reason for transfer",type:"textarea",modelValue:s(x),"onUpdate:modelValue":e[2]||(e[2]=i=>j(x)?x.value=i:null),validation:"required"},null,8,["modelValue"])])]),t("div",nt,[e[10]||(e[10]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Stock Items")],-1)),t("div",lt,[W(a(I,{color:"primary",click:E,text:"Add items",icon:s(l)},null,8,["icon"]),[[z,s(d).length>0]]),(f(!0),C(Y,null,Z(s(d),(i,G)=>(f(),C("div",{class:"flex flex-col space-y-3 mt-5",key:G},[t("div",it,[a(D,{label:"Stock item",mode:"single",items:s(b).map(p=>p.name),"items-selected":i.stock_item.name,"onUpdate:itemsSelected":p=>i.stock_item.name=p},null,8,["items","items-selected","onUpdate:itemsSelected"]),a(R,{label:"Quantity requested",type:"number",validation:"required",modelValue:i.quantity_requested,"onUpdate:modelValue":p=>i.quantity_requested=p,modelModifiers:{lazy:!0},delay:1e3},null,8,["modelValue","onUpdate:modelValue"]),a(D,{label:"Batch",mode:"single",items:te(i.stock_item.name).value,"items-selected":i.batch_number,"onUpdate:itemsSelected":p=>i.batch_number=p,delay:5},null,8,["items","items-selected","onUpdate:itemsSelected"]),a(D,{label:"Lot",mode:"single",items:ee(i.stock_item.name).value,"items-selected":i.lot_number,"onUpdate:itemsSelected":p=>i.lot_number=p},null,8,["items","items-selected","onUpdate:itemsSelected"]),t("div",rt,[s(y).id==i.id&&s(y).value?(f(),H(ce,{key:0,height:20,width:20})):L("",!0),s(y).value?L("",!0):(f(),H(I,{key:1,type:"button",icon:s(g),text:"Delete",color:"error",click:()=>{re(G)}},null,8,["icon","click"]))])])]))),128)),W(t("div",ct,[e[8]||(e[8]=t("img",{src:Ie,class:"w-28 h-28 text-red-500",alt:"stock-out-svg"},null,-1)),e[9]||(e[9]=t("p",{class:"flex items-center"},"No stock items for transfer",-1)),t("button",{onClick:E,type:"button",class:"flex items-center text-sky-500 font-medium"},[a(s(Fe),{class:"w-5 h-5 mr-2"}),e[7]||(e[7]=Q(" Add stock item "))])],512),[[z,s(d).length==0]])])])])])])}}});export{Nt as default};
