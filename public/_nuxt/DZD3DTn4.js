import{_ as pe}from"./COJDNupw.js";import{_ as me}from"./CoQgzhbz.js";import{d as fe,r as E,a as ye,a5 as be,ak as he,u as Ee,c as U,C as f,w as I,o as ge,y as P,b as L,e as S,f as y,h as o,g as r,t as g,z as H,k as K,H as z,F as ve,j as xe,N as Re,K as Q,m as Te,l as J,E as Le,ar as Se,_ as $e}from"./BxD-h1LR.js";import{_ as Me}from"./BNhNOnHe.js";import{_ as Ye}from"./Cs7plFji.js";import{u as Ge,_ as Ne}from"./NR9_F3jh.js";import{u as ke}from"./BmiBNsbw.js";import{_ as Ae}from"./CKMQEpqg.js";import{_ as Ce}from"./B4cMvEBz.js";import{_ as qe}from"./CQcCm1L6.js";import{x as Ue}from"./D6QgC5iF.js";import{P as Fe}from"./C1C0mJ5v.js";import{u as Oe}from"./DRcUz5ts.js";import{r as We}from"./BkJfYQCG.js";import{r as je}from"./CQe3LSWs.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";const Be={class:"px-5 py-5"},Ve={class:"flex items-center py-5"},Ie=r("img",{src:Ae,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Pe={class:"text-2xl font-semibold uppercase"},He={class:"w-full flex items-center justify-between mb-5"},Ke={class:"w-full flex items-center space-x-3"},ze={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Qe={class:"w-72 ml-2"},Je={class:"w-40"},Xe={class:"w-48 flex items-end justify-end"},Ze={class:"rounded border"},we={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},De=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ce,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold uppercase"},"INFECTION REPORT")],-1),et={key:0},tt={class:"hidden"},rt=r("h3",null,"INFECTION REPORT",-1),ot={class:"text-lg font-semibold py-2 px-2"},st={class:"text-normal font-normal"},nt={id:"print-container"},at=["innerHTML"],lt=r("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"SUMMARY",-1),ct={class:"w-full border-t"},dt=r("thead",null,[r("tr",{class:"border-b border-t bg-gray-100"},[r("th",{class:"px-2 py-2 border-r text-left"},"TESTS"),r("th",{class:"px-2 py-2 text-left"},"TOTAL")])],-1),it={class:"px-2 py-2 border-r border-b"},ut={class:"px-2 py-2 border-r border-b"},_t={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},pt=r("img",{src:qe,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),mt=r("p",{class:"text-base"},"Data not found, please generate report",-1),ft=[pt,mt],Vt=fe({__name:"infection",setup(yt){ke({title:`${Fe.name.toUpperCase()} - Infection Report`});const X=E("Infection Report"),Z=E([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),$=E([]),b=E({id:0,name:"select department"}),F=ye("token"),{loading:h,executeCancellableRequest:w,cancelRequest:D}=Ge(),v=be(),p=he(),{$toast:R}=Ee(),M=Oe(),Y=E([]),O=E([]),W=E(!1),l=E(new Array("","")),G=U(()=>l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):""),N=U(()=>l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):""),ee=()=>{l.value=new Array("","")},te=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',u=(s,e,a)=>{const n=s.indexOf(e);return n!==-1?s.slice(0,n)+a+s.slice(n+e.length):s},re=s=>{W.value=!1;let e="",a="",n="",c="",d=0,i=0,_=0,m=0,x=0;return s.reduce((t,k)=>{const q=k.measures.flatMap(A=>A.results.flatMap(B=>{const V=Object.keys(B[0])[0],de=B[0][V];return Object.entries(de).map(([ie,ue])=>{const _e=ue;return{test_type:k.test_type,measure:A.name,result:V,gender:ie==="F"?"Female":"Male",..._e}})}));return t.push(...q),t},new Array).forEach(t=>{i++,_++,d++,n===t.test_type?(e+="<tr>",a!==t.measure?(a=t.measure,c=t.result,e=u(e,"NEW_MEASURE",i.toString()),e=e.replace("NEW_RESULT",_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),i=0,_=0,m=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):c!==t.result&&(e=e.replace(/NEW_RESULT/g,_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),c=t.result,_=0,m=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(n=t.test_type,a=t.measure,c=t.result,e=e.replace(/NEW_TEST/g,d.toString()),e=u(e,"NEW_MEASURE",i.toString()),e=e.replace(/NEW_RESULT/g,_.toString()),e=u(e,"RESULT_TOTAL",m.toString()),e=u(e,"TEST_TOTAL",x.toString()),i=0,_=0,m=0,d=0,x=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>";const k=C("L_E_5");e+=`
      <td
        class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${k}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">
        ${t.L_E_5?t.L_E_5.count.toString():"0"}
      </td>`;const q=C("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${q}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">`+(t.G_5_L_E_14?t.G_5_L_E_14.count:0).toString()+"</td>";const A=C("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${A}"
        data-count="${t.G_14?t.G_14.count:0}"
        data-ids="${t.G_14?t.G_14.associated_ids:""}">`+(t.G_14?t.G_14.count:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0)).toString()+"</td>",m+=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0),c===t.result&&_==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),i==0&&(x=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0))}),e=u(e,"NEW_TEST",(++d).toString()),e=u(e,"NEW_MEASURE",(++i).toString()),e=u(e,"NEW_RESULT",(++_).toString()),e=u(e,"RESULT_TOTAL",m.toString()),e=u(e,"TEST_TOTAL",x.toString()),e+="</tr>",W.value=!0,e},C=s=>({L_E_5:"Less than or equal to 5 years old",G_5_L_E_14:"Greater than 5 years old and less than or equal to 14 years old",G_14:"Greater than 14 years old"})[s],oe=s=>{const e=te(),a=s.length>0?re(s):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${a}</table>`};async function se(){const{data:s,error:e}=await Te({route:`${J.departments}`,method:"GET",token:`${F.value}`});s.value&&($.value=s.value,$.value.some(a=>a.id===0)||$.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function j(){if(le())R.warning("Please select a department");else{h.value=!0;let s=l.value[0].toString()!=""?f(l.value[0].toString()).format("YYYY-MM-DD"):"",e=l.value[1].toString()!=""?f(l.value[1].toString()).format("YYYY-MM-DD"):"";const a={route:`${J.aggregateReports}infection?from=${s}&to=${e}&department=${b.value.name}&report_id=${p.query.report_id}`,method:"GET",token:`${F.value}`},{data:n,error:c,pending:d}=await w(a);h.value=d,n.value&&(h.value=!1,Y.value=n.value.data,O.value=n.value.summary,ae(n.value.report_id),R.success("Report data generated successfully!")),c.value&&(console.error(c.value),h.value=!1,R.error(Le))}}const ne=s=>{const e=s.target;if(e.tagName==="TD"&&e.id==="tdRef"){const{test:a,ward:n,count:c,ids:d}=e.dataset;if(c&&d){const i=parseInt(c,10);i!==0&&d!==""?v.push(`/reports/${d}?origin=aggregate&type=infection-report&from=${G.value}&to=${N.value}&test=${a} - ${n}&department=${b.value.name}&count=${i}`):R.warning("No data found for this month")}else R.warning("No data found for this month")}},ae=s=>{const a={...v.currentRoute.value.query,report_id:s};v.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})},le=()=>b.value.name==Se;I(l,()=>{const s=l.value[0]?f(l.value[0]).format("YYYY-MM-DD"):"",e=l.value[1]?f(l.value[1]).format("YYYY-MM-DD"):"";if(s||e){const n={...v.currentRoute.value.query,...s&&{from:s},...e&&{to:e}};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}},{deep:!0}),I(b,(s,e)=>{if(s!==e){const n={...v.currentRoute.value.query,department:s.name||void 0,report_id:""};v.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}});const ce=U(()=>p.query.to!==void 0&&p.query.from!==void 0&&p.query.department!==void 0?(l.value=[p.query.from,p.query.to],b.value.name=`${p.query.department}`,p.query.to!==""&&p.query.from!==""&&p.query.department!==""):!1);return ge(()=>{ce.value&&j()}),se(),(s,e)=>{const a=pe,n=P("datepicker"),c=me,d=$e,i=P("FormKit"),_=Me,m=Ye,x=Ne;return L(),S("div",Be,[y(a,{pages:o(Z)},null,8,["pages"]),r("div",Ve,[Ie,r("h3",Pe,g(o(X)),1)]),r("div",He,[y(i,{type:"form","submit-label":"Update",onSubmit:j,actions:!1,id:"submitForm"},{default:H(({value:T})=>[r("div",Ke,[r("div",ze,[y(o(We),{class:"w-5 h-5 mr-2"}),K(" Filter By Date Range "),r("div",Qe,[y(n,{onCleared:ee,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:o(l),"onUpdate:modelValue":e[0]||(e[0]=t=>z(l)?l.value=t:null)},null,8,["modelValue"])])]),r("div",Je,[y(c,{items:o($),modelValue:o(b),"onUpdate:modelValue":e[1]||(e[1]=t=>z(b)?b.value=t:null)},null,8,["items","modelValue"])]),r("div",null,[y(d,{loading:o(h),color:"primary",type:"submit",text:"Generate Report",icon:o(je),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),r("div",Xe,[y(o(Ue),{element:"print-container",filename:`infection_report_from_${o(f)(o(G)).format("DD_MM_YYYY")}_to_${o(f)(o(N)).format("DD_MM_YYYY")}_for_${o(M).details.name.toLowerCase().split(" ").join("_")}`},{default:H(()=>[y(_,{text:"Export Excel"})]),_:1},8,["filename"])])]),r("div",null,[r("div",Ze,[r("div",we,[De,y(m)]),o(Y).length>0&&!o(h)?(L(),S("div",et,[r("div",tt,[rt,r("h3",null,g(o(M).details.name),1),r("p",null,g(o(M).details.address),1),r("p",null,g(o(M).details.phone),1)]),r("div",ot,[K(" Tests Performed Period: "),r("span",st,g(o(G)!=""?o(f)(o(G)).format("DD/MM/YYYY"):"")+" - "+g(o(N)!=""?o(f)(o(N)).format("DD/MM/YYYY"):""),1)]),r("div",nt,[r("div",{innerHTML:oe(o(Y)),onClick:ne},null,8,at),r("div",null,[lt,r("table",ct,[dt,r("tbody",null,[(L(!0),S(ve,null,xe(o(O),(T,t)=>(L(),S("tr",{key:T.name,class:Re(t%2===0?"bg-white":"bg-gray-50")},[r("td",it,g(T.name),1),r("td",ut,g(T.count),1)],2))),128))])])])])])):Q("",!0),o(Y).length==0&&!o(h)?(L(),S("div",_t,ft)):Q("",!0),y(x,{condition:o(h),cancelReportGeneration:()=>o(D)()},null,8,["condition","cancelReportGeneration"])])])])}}});export{Vt as default};
