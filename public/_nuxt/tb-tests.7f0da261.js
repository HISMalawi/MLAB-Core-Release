import{_ as G}from"./Breadcrumb.vue.5ee97787.js";import{m as J,u as z,C as R,a as H,L as C,g as j,o as a,c as n,d as m,l as t,e,t as _,M as I,i as O,E as K,h as Q,F as y,r as g,k as D,w as W,v as X,b as M,f as Z}from"./entry.97d0b54e.js";import{_ as ee}from"./index.7a3f7cb8.js";import{_ as te}from"./ExportButton.vue.4fdcd0b0.js";import{_ as se}from"./Address.vue.fb5f2755.js";import{_ as oe}from"./Loader.aedab139.js";import{e as re}from"./constants.0c4e4d21.js";import{_ as ae}from"./report.9c4679cd.js";import{_ as ne}from"./logo.e661b2c6.js";import{_ as le}from"./page.8232356c.js";import{h as E,e as ce,f as ie}from"./fetch.e0862392.js";import{u as de}from"./facility.288f2472.js";import{P as ue}from"./package.e5cbe000.js";import{r as pe}from"./FunnelIcon.d7b83064.js";import{r as me}from"./ArrowPathIcon.c9420c22.js";import"./nuxt-link.68cca64c.js";import"./HomeIcon.68cf51b5.js";import"./html2canvas.esm.acdae98d.js";import"./jspdf.es.min.314f3148.js";import"./XMarkIcon.14e83439.js";import"./PrinterIcon.068c8bcd.js";import"./transition.24037afa.js";import"./hidden.a4deafd9.js";import"./PencilSquareIcon.5fdb3ab6.js";const _e={class:"px-5 py-5"},fe=e("img",{src:ae,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),he={class:"flex justify-between items-center"},ye={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},be={class:"w-72 ml-2"},xe={class:"w-48"},ge={class:"flex items-center space-x-3"},ve={key:0,class:"border rounded mt-10",id:"print-container"},ke={class:"flex items-center justify-between px-5 py-5 border-b"},we=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ne,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," TB TESTS REPORT ")],-1),Re={class:"m-3"},Ee={class:"text-lg font-semibold mb-2"},Te={class:"text-normal font-normal"},$e={class:"overflow-x-auto"},Ce={class:"w-full rounded overflow-x-auto border-t"},De={class:"w-full border-b"},Me=["colspan"],Oe={class:"bg-gray-50"},Ye=e("th",{class:"px-2 py-2 border-r uppercase"},"Result",-1),je={class:"px-2 py-2 border-r capitalize"},Se={class:"bg-gray-50"},Be=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"},"Total Examined",-1),Ae={key:0,class:"border-t bg-gray-100"},Pe=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"},"Pick Up Rate",-1),Ve={class:"w-full items-center flex flex-col space-y-2 my-10"},Le=e("p",null,[O("Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),Ne={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Fe=e("img",{src:le,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Ue=e("p",null,"Data not found, please generate report",-1),qe=[Fe,Ue],Ge="TB Report",ht=J({__name:"tb-tests",setup(Je){z({title:`${ue.name.toUpperCase()} - TB Tests Reports`});const S=R([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),f=R([]),h=R(!1),c=R({months:new Array,data:new Array}),T=de(),B=H("token"),A=()=>{f.value=new Array("","")},P=(l,s)=>{let o=0;return s[Object.keys(s)[0]].forEach(r=>{o+=r.month[l]?r.month[l]:0}),o},Y=l=>l.sort((s,o)=>{const r=["January","February","March","April","May","June","July","August","September","October","November","December"];return r.indexOf(s)-r.indexOf(o)}),V=C(()=>{const l=[];return c.value.data.length>0&&c.value.data.forEach(s=>{Object.keys(s).forEach(o=>{s[o].forEach(r=>{const u={TEST:o,RESULT:r.result,...Y(Object.keys(r.month)).reduce((i,w)=>{const v=r.month[w];return i[w.toUpperCase()]=v??0,i},{})};l.push(u)})})}),l}),L=(l,s)=>{let o=1,r=1;Object.keys(s)[0].toString().toLowerCase().includes("+")&&s[Object.keys(s)[0]].forEach(i=>{r+=i.month[l]?i.month[l]:0});let u=0;return s[Object.keys(s)[0]].forEach(i=>{u+=i.month[l]?i.month[l]:0}),u>0?o=r/u*100:o=0,Math.floor(o)},b=C(()=>f.value[0]?E(f.value[0]).format("YYYY-MM-DD"):""),x=C(()=>f.value[1]?E(f.value[1]).format("YYYY-MM-DD"):"");async function N(){h.value=!0;let l=`from=${b.value}&to=${x.value}`;const s={route:`${ce.aggregateReports}tb_tests?${l}`,method:"GET",token:`${B.value}`},{data:o,error:r,pending:u}=await ie(s);h.value=u,o.value&&(h.value=!1,c.value=o.value,o.value.data.length>0?M().$toast.success("Report data generated successfully"):M().$toast.warning(`No data found in period ${b.value} - ${x.value}`)),r.value&&(h.value=!1,console.error(r.value),M().$toast.success(re))}return(l,s)=>{const o=G,r=j("datepicker"),u=Z,i=ee,w=te,v=j("excel"),F=se,U=oe;return a(),n("div",_e,[m(o,{pages:t(S)},null,8,["pages"]),e("div",{class:"flex items-center py-5"},[fe,e("h3",{class:"text-2xl font-semibold uppercase"},_(Ge))]),e("div",he,[e("form",{onSubmit:s[1]||(s[1]=I(p=>N(),["prevent"])),class:"w-full flex items-center space-x-3"},[e("div",ye,[m(t(pe),{class:"w-5 h-5 mr-2"}),O(" Filter By Date Range "),e("div",be,[m(r,{onCleared:A,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(f),"onUpdate:modelValue":s[0]||(s[0]=p=>K(f)?f.value=p:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),e("div",xe,[m(u,{type:"submit",color:"primary",text:"Generate Report",icon:t(me),click:()=>{},loading:t(h)},null,8,["icon","loading"])])],32),e("div",ge,[m(i,{printSmallLabel:!1}),m(v,{class:"btn btn-default",header:[`TB TESTS LABORATORY REPORT ${t(b)} - ${t(x)}`,t(T).details.name,t(T).details.address,t(T).details.phone],data:t(V),worksheet:"report-work-sheet",name:`tb_tests_report_from_${t(b)}_to_${t(x)}.xls`},{default:Q(()=>[m(w,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t(c).data.length>0?(a(),n("div",ve,[e("div",ke,[we,m(F)]),e("div",Re,[e("h3",Ee,[O("Tests Performed Period: "),e("span",Te,_(t(b)!=""?t(E)(t(b)).format("DD/MM/YYYY"):"")+" - "+_(t(x)!=""?t(E)(t(x)).format("DD/MM/YYYY"):""),1)])]),e("div",$e,[e("table",Ce,[(a(!0),n(y,null,g(t(c).data,(p,q)=>(a(),n(y,{key:q},[e("thead",De,[e("tr",null,[e("th",{colspan:t(c).months.length+1,class:"uppercase bg-gray-100 text-center py-2 border-b"},_(Object.keys(p)[0]),9,Me)]),e("tr",Oe,[Ye,(a(!0),n(y,null,g(t(c).months,(d,k)=>(a(),n("th",{class:"px-2 py-2 border-r",key:k},_(d),1))),128))])]),e("tbody",null,[(a(!0),n(y,null,g(p[Object.keys(p)[0]],(d,k)=>(a(),n("tr",{class:"border-b",key:k},[e("td",je,_(d.result),1),(a(!0),n(y,null,g(t(c).months,$=>(a(),n("td",{key:$,class:"px-2 py-2 border-r"},_(d.month[$]>0?d.month[$]:0),1))),128))]))),128)),e("tr",Se,[Be,(a(!0),n(y,null,g(Y(t(c).months),d=>(a(),n("td",{key:d,class:"px-2 py-2 border-r"},_(P(d,p)),1))),128))]),Object.keys(p)[0].toLowerCase()=="smear microscopy result"?(a(),n("tr",Ae,[Pe,(a(!0),n(y,null,g(t(c).months,(d,k)=>(a(),n("td",{key:k,class:"px-2 py-2 border-r"},_(L(d,p))+"% ",1))),128))])):D("",!0)])],64))),128))])])])):D("",!0),W(e("div",Ve,[m(U),Le],512),[[X,t(h)]]),t(c).data.length==0&&!t(h)?(a(),n("div",Ne,qe)):D("",!0)])}}});export{ht as default};
