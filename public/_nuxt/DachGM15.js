var ae=Object.defineProperty;var oe=(u,a,n)=>a in u?ae(u,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[a]=n;var b=(u,a,n)=>oe(u,typeof a!="symbol"?a+"":a,n);import{_ as le}from"./BIgjk9bL.js";import{_ as ne}from"./CY_pW6Pm.js";import{_ as ie}from"./BpMjlwPN.js";import{C as ce,bI as _,d as re,bJ as de,ak as ue,bK as me,a as pe,r as o,c as y,a6 as _e,w as U,bL as k,o as fe,y as J,b as F,e as R,g as e,f as r,k as L,z as M,t as x,N as O,i as ve,aC as he,K as be,h as ye,bG as xe,l as ge,m as we,u as g,bF as Ne,_ as ke}from"./Iy63StId.js";import{_ as Ve}from"./DAoM-dCf.js";import{u as $e}from"./dSQnwF8t.js";import{u as H}from"./CLgq2Dg7.js";import{P as Ce}from"./yiwDnRAW.js";import{r as Se}from"./CUkWAT3i.js";import"./Dndf7ZKt.js";import"./Byb5n9Ur.js";import"./G37wRrHr.js";import"./57K4Quj0.js";import"./BklODkO7.js";import"./BAFJmU_2.js";import"./DW7An3PC.js";import"./BYvWnHVP.js";class qe{constructor(a){b(this,"client",{id:"",uuid:""});b(this,"tests",[]);b(this,"order",{priority:1,requested_by:"",collected_by:H().$state.department,sample_collected_time:"",tracking_number:""});b(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=a}createEncounter(a,n){this.encounter={...this.encounter,encounter_type:a,facility_section:n}}buildOrder(a="",n=ce().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=a,this.order.sample_collected_time=n}setTests(a,n){this.tests=n.map(m=>({specimen:a,test_type:m}))}async createOrder(a){return _.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:a})}}const De={class:"py-5 px-5"},Pe={class:"mt-5"},Te={class:"flex items-center space-x-2"},Ue=e("img",{src:Ve,class:"w-auto h-6",alt:"flash-icon"},null,-1),Je={class:"text-xl font-semibold uppercase"},Oe={class:"border rounded mt-5"},Ae=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("img",{src:xe,class:"h-8 w-auto",alt:"fever-icon"}),e("h3",{class:"font-semibold text-lg"},"Patient Details")],-1),Be={class:"w-full py-5 px-5"},Ee={class:"flex items-center space-x-20"},Fe={class:"flex items-center space-x-3"},Re=e("h3",{class:"font-medium"},"Patient Number:",-1),Le={class:"mt-1 text-gray-600"},Me={class:"flex items-center space-x-3"},He=e("h3",{class:"font-medium"},"Age",-1),Ke={class:"mt-1 text-gray-600"},Ye={class:"flex items-center space-x-3"},ze=e("h3",{class:"font-medium"},"Sex:",-1),Ge={class:"mt-1 text-gray-600"},Ie={class:"border mt-5 rounded"},We=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("h3",{class:"font-semibold text-lg"},"Order Details")],-1),je={class:"px-5 py-5"},Qe={class:"w-full mb-5"},Xe={class:"flex flex-col space-y-2"},Ze={class:"w-full flex items-center space-x-10 mb-5"},et={class:"w-1/2 flex flex-col space-y-2"},tt=e("label",{class:"font-medium"},"Visit Type",-1),st={class:"w-1/2 flex flex-col space-y-2"},at={class:"font-medium"},ot={class:"w-full flex items-center space-x-10 mb-5"},lt={class:"w-1/2 flex flex-col space-y-2"},nt=e("label",{class:"font-medium"},"Specimen Type",-1),it={class:"w-1/2 flex flex-col space-y-2"},ct=e("label",{class:"font-medium"},"Tests",-1),rt={class:"w-full my-6"},dt=e("label",{class:"font-medium"},"Back Data Entry",-1),ut={key:0,class:"w-full mb-5 flex flex-col space-y-2"},mt=e("label",{class:"font-medium"},"Sample collection date",-1),pt={class:"w-full"},Tt=re({__name:"index",setup(u){$e({title:`${Ce.name.toUpperCase()} - New Test`});const a=de(),n=ue(),m=H(),K=me(),Y=pe("token"),d=o({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),z=o([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),A=o([]),V=o([]),w=o([]),p=o([]),f=o({name:"select visit type",id:0}),c=o({name:"select specimen",id:0}),v=o({name:"select ward",id:0}),N=o([]),$=o(""),C=o(""),S=o("Requesting Ward"),q=o(!1),G=y(()=>_e(d.value.date_of_birth)),D=y(()=>d.value.sex.match(/f/i)?"Female":"Male"),B=y(()=>`${d.value.first_name} ${d.value.middle_name} ${d.value.last_name}`),I=y(()=>d.value.client_id),P=y(()=>m.user.departments.find(s=>s.name===m.department));function W(s){const t={route:`${ge.clients}/${s}`,method:"GET",token:`${Y.value}`};we(t).then(({data:i,error:h})=>{i.value&&(d.value=i.value),h.value&&console.error(h.value)})}function j(s,t){const i=s.find(h=>h.name===t);return i?i.id:null}async function Q(){const s=new qe(d.value.client_id);s.createEncounter(Number(f.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(c.value.id),N.value);const t=j(m.locations,m.selectedLocation),i=await s.createOrder(Number(t));k(i)||(g().$toast.success(`Order with accession number ${i.accession_number} has been created successfully!`),await K.alertConfirmation({message:"Do you want to print specimen label?"})&&await Ne.printSpecimenLabel(i.accession_number)),n.push("/tests")}function X(){return Number(f.value.id)==0?(g().$toast.warning("Please select visit type and try again!"),!1):Number(c.value.id)==0?(g().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(g().$toast.warning("Please select ward and try again!"),!1):N.value.length==0?(g().$toast.warning("Please select tests and try again!"),!1):!0}return U(f,async s=>{s.name.toLowerCase()=="referral"?(S.value="Requesting Facility",v.value={name:"select facility",id:0}):S.value="Requesting Ward",w.value=[],k(w.value[Number(s.id)])&&(w.value=await _.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),U(c,async s=>{k(p.value[Number(s.id)])&&(p.value[Number(s.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:P.value.id,sex:D.value})||[])}),U(()=>m,async s=>{for(const t in p.value)p.value.hasOwnProperty(t)&&delete p.value[t];k(c.value)||(p.value[Number(c.value.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(c.value.id),department_id:s.user.departments.find(t=>t.name===s.department).id,sex:D.value})||[]),_.getJson("specimen",{department_id:P.value.id}).then(t=>V.value=t)},{deep:!0}),fe(async()=>{const s=await _.getJson("encounter_types");A.value=s.data;const t=await _.getJson("specimen",{department_id:P.value.id});V.value=t,W(a.query.patient_id)}),(s,t)=>{const i=le,h=ne,E=J("FormKit"),T=ie,Z=J("multi-select"),ee=J("datepicker"),te=ke;return F(),R("div",null,[e("div",De,[r(i,{pages:z.value},null,8,["pages"]),e("div",Pe,[e("div",Te,[Ue,e("h3",Je,[L(" New order for "),e("span",null,[r(h,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${B.value.toLowerCase().replace(" ","+")}`},{default:M(()=>[L(" “"+x(B.value)+"” ",1)]),_:1},8,["to"])])])]),e("div",Oe,[Ae,e("div",Be,[e("div",Ee,[e("div",Fe,[Re,e("p",Le,x(I.value),1)]),e("div",Me,[He,e("p",Ke,x(G.value)+" years old",1)]),e("div",Ye,[ze,e("p",Ge,x(D.value),1)])])])]),r(E,{type:"form","submit-label":"Update",onSubmit:t[7]||(t[7]=se=>X()&&Q()),actions:!1,id:"submitForm"},{default:M(({value:se})=>[e("div",Ie,[We,e("div",je,[e("div",Qe,[e("div",Xe,[r(E,{label:"Requesting Physician",validation:"required",modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=l=>$.value=l)},null,8,["modelValue"])])]),e("div",Ze,[e("div",et,[tt,r(T,{items:A.value,modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=l=>f.value=l),class:O(f.value.name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",st,[e("label",at,x(S.value),1),r(T,{isSearchable:"",items:w.value,modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),class:O(v.value.name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),e("div",ot,[e("div",lt,[nt,r(T,{items:V.value,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=l=>c.value=l),class:O(c.value.name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",it,[ct,r(Z,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=l=>N.value=l),options:p.value[c.value.id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",rt,[ve(e("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":t[5]||(t[5]=l=>q.value=l)},null,512),[[he,q.value]]),dt]),q.value?(F(),R("div",ut,[mt,r(ee,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=l=>C.value=l)},null,8,["modelValue"])])):be("",!0),e("div",pt,[r(te,{type:"submit",text:"Place order",color:"primary",icon:ye(Se),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{Tt as default};
