var ae=Object.defineProperty;var oe=(u,a,l)=>a in u?ae(u,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[a]=l;var y=(u,a,l)=>oe(u,typeof a!="symbol"?a+"":a,l);import{_ as ne}from"./BvEqexTj.js";import{_ as le}from"./Bit5kMcC.js";import{_ as ie}from"./DAN85N2r.js";import{d as ce,aC as re,aD as de,a as ue,r as o,c as b,w as T,o as me,m as U,b as J,e as R,g as e,f as r,p as F,n as M,t as x,z as A,i as pe,U as _e,s as fe,h as ve,aB as he,u as g,_ as ye}from"./DkSHUfZG.js";import{_ as be}from"./DAoM-dCf.js";import{u as xe}from"./uQJ05scD.js";import{u as H}from"./BAV13zEx.js";import{h as ge,A as _,u as we,i as Ne,p as V,e as Ve,f as ke,P as $e}from"./D2LBdSgo.js";import{P as Ce}from"./Bf5grz7u.js";import{r as Se}from"./BIVUZcpC.js";import"./jXHX7K2g.js";import"./KwrjAXlL.js";import"./DthfA08H.js";import"./fnXoGXtg.js";import"./neGiqG6Z.js";import"./CUSkJlEU.js";import"./DGb1bV5M.js";import"./B5NVDA4R.js";import"./BzCrDE1y.js";import"./C_hGcfdC.js";import"./CEYBmAkp.js";import"./CFqEtL_8.js";import"./BwUwUGKT.js";import"./_yfpsPGK.js";class De{constructor(a){y(this,"client",{id:"",uuid:""});y(this,"tests",[]);y(this,"order",{priority:1,requested_by:"",collected_by:H().$state.department,sample_collected_time:"",tracking_number:""});y(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=a}createEncounter(a,l){this.encounter={...this.encounter,encounter_type:a,facility_section:l}}buildOrder(a="",l=ge().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=a,this.order.sample_collected_time=l}setTests(a,l){this.tests=l.map(m=>({specimen:a,test_type:m}))}async createOrder(a){return _.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:a})}}const Pe={class:"py-5 px-5"},qe={class:"mt-5"},Te={class:"flex items-center space-x-2"},Ue=e("img",{src:be,class:"w-auto h-6",alt:"flash-icon"},null,-1),Ae={class:"text-xl font-semibold uppercase"},Be={class:"border rounded mt-5"},Oe=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("img",{src:he,class:"h-8 w-auto",alt:"fever-icon"}),e("h3",{class:"font-semibold text-lg"},"Patient Details")],-1),Ee={class:"w-full py-5 px-5"},Je={class:"flex items-center space-x-20"},Re={class:"flex items-center space-x-3"},Fe=e("h3",{class:"font-medium"},"Patient Number:",-1),Me={class:"mt-1 text-gray-600"},He={class:"flex items-center space-x-3"},Le=e("h3",{class:"font-medium"},"Age",-1),Ye={class:"mt-1 text-gray-600"},ze={class:"flex items-center space-x-3"},Ke=e("h3",{class:"font-medium"},"Sex:",-1),We={class:"mt-1 text-gray-600"},Ge={class:"border mt-5 rounded"},Ie=e("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[e("h3",{class:"font-semibold text-lg"},"Order Details")],-1),je={class:"px-5 py-5"},Qe={class:"w-full mb-5"},Xe={class:"flex flex-col space-y-2"},Ze={class:"w-full flex items-center space-x-10 mb-5"},et={class:"w-1/2 flex flex-col space-y-2"},tt=e("label",{class:"font-medium"},"Visit Type",-1),st={class:"w-1/2 flex flex-col space-y-2"},at={class:"font-medium"},ot={class:"w-full flex items-center space-x-10 mb-5"},nt={class:"w-1/2 flex flex-col space-y-2"},lt=e("label",{class:"font-medium"},"Specimen Type",-1),it={class:"w-1/2 flex flex-col space-y-2"},ct=e("label",{class:"font-medium"},"Tests",-1),rt={class:"w-full my-6"},dt=e("label",{class:"font-medium"},"Back Data Entry",-1),ut={key:0,class:"w-full mb-5 flex flex-col space-y-2"},mt=e("label",{class:"font-medium"},"Sample collection date",-1),pt={class:"w-full"},Rt=ce({__name:"index",setup(u){xe({title:`${Ce.name.toUpperCase()} - New Test`});const a=re(),l=de(),m=H(),L=we(),Y=ue("token"),d=o({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),z=o([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),B=o([]),k=o([]),w=o([]),p=o([]),f=o({name:"select visit type",id:0}),c=o({name:"select specimen",id:0}),v=o({name:"select ward",id:0}),N=o([]),$=o(""),C=o(""),S=o("Requesting Ward"),D=o(!1),K=b(()=>Ne(d.value.date_of_birth)),W=b(()=>d.value.sex.match(/f/i)?"Female":"Male"),O=b(()=>`${d.value.first_name} ${d.value.middle_name} ${d.value.last_name}`),G=b(()=>d.value.client_id),P=b(()=>m.user.departments.find(s=>s.name===m.department));function I(s){const t={route:`${Ve.clients}/${s}`,method:"GET",token:`${Y.value}`};ke(t).then(({data:i,error:h})=>{i.value&&(d.value=i.value),h.value&&console.error(h.value)})}function j(s,t){const i=s.find(h=>h.name===t);return i?i.id:null}async function Q(){const s=new De(d.value.client_id);s.createEncounter(Number(f.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(c.value.id),N.value);const t=j(m.locations,m.selectedLocation),i=await s.createOrder(Number(t));V(i)||(g().$toast.success(`Order with accession number ${i.accession_number} has been created successfully!`),await L.alertConfirmation({message:"Do you want to print specimen label?"})&&await $e.printSpecimenLabel(i.accession_number)),l.push("/tests")}function X(){return Number(f.value.id)==0?(g().$toast.warning("Please select visit type and try again!"),!1):Number(c.value.id)==0?(g().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(g().$toast.warning("Please select ward and try again!"),!1):N.value.length==0?(g().$toast.warning("Please select tests and try again!"),!1):!0}return T(f,async s=>{s.name.toLowerCase()=="referral"?(S.value="Requesting Facility",v.value={name:"select facility",id:0}):S.value="Requesting Ward",w.value=[],V(w.value[Number(s.id)])&&(w.value=await _.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),T(c,async s=>{V(p.value[Number(s.id)])&&(p.value[Number(s.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:P.value.id})||[])}),T(()=>m,async s=>{for(const t in p.value)p.value.hasOwnProperty(t)&&delete p.value[t];V(c.value)||(p.value[Number(c.value.id)]=await _.getJson("specimen/test_types",{specimen_id:Number(c.value.id),department_id:s.user.departments.find(t=>t.name===s.department).id})||[]),_.getJson("specimen",{department_id:P.value.id}).then(t=>k.value=t)},{deep:!0}),me(async()=>{const s=await _.getJson("encounter_types");B.value=s.data;const t=await _.getJson("specimen",{department_id:P.value.id});k.value=t,I(a.query.patient_id)}),(s,t)=>{const i=ne,h=le,E=U("FormKit"),q=ie,Z=U("multi-select"),ee=U("datepicker"),te=ye;return J(),R("div",null,[e("div",Pe,[r(i,{pages:z.value},null,8,["pages"]),e("div",qe,[e("div",Te,[Ue,e("h3",Ae,[F(" New order for "),e("span",null,[r(h,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${O.value.toLowerCase().replace(" ","+")}`},{default:M(()=>[F(" “"+x(O.value)+"” ",1)]),_:1},8,["to"])])])]),e("div",Be,[Oe,e("div",Ee,[e("div",Je,[e("div",Re,[Fe,e("p",Me,x(G.value),1)]),e("div",He,[Le,e("p",Ye,x(K.value)+" years old",1)]),e("div",ze,[Ke,e("p",We,x(W.value),1)])])])]),r(E,{type:"form","submit-label":"Update",onSubmit:t[7]||(t[7]=se=>X()&&Q()),actions:!1,id:"submitForm"},{default:M(({value:se})=>[e("div",Ge,[Ie,e("div",je,[e("div",Qe,[e("div",Xe,[r(E,{label:"Requesting Physician",validation:"required",modelValue:$.value,"onUpdate:modelValue":t[0]||(t[0]=n=>$.value=n)},null,8,["modelValue"])])]),e("div",Ze,[e("div",et,[tt,r(q,{items:B.value,modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=n=>f.value=n),class:A(f.value.name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",st,[e("label",at,x(S.value),1),r(q,{isSearchable:"",items:w.value,modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=n=>v.value=n),class:A(v.value.name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),e("div",ot,[e("div",nt,[lt,r(q,{items:k.value,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=n=>c.value=n),class:A(c.value.name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",it,[ct,r(Z,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:N.value,"onUpdate:modelValue":t[4]||(t[4]=n=>N.value=n),options:p.value[c.value.id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",rt,[pe(e("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":t[5]||(t[5]=n=>D.value=n)},null,512),[[_e,D.value]]),dt]),D.value?(J(),R("div",ut,[mt,r(ee,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=n=>C.value=n)},null,8,["modelValue"])])):fe("",!0),e("div",pt,[r(te,{type:"submit",text:"Place order",color:"primary",icon:ve(Se),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{Rt as default};
