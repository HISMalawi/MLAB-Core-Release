import{_ as Fe}from"./MtWVAv6l.js";import{d as J,a6 as Re,a7 as Le,c as O,r as u,a8 as Ne,o as Q,w as Ae,a9 as pe,aa as Oe,ab as qe,ac as je,ad as De,ae as Ie,F as he,af as me,b as j,e as D,g as s,u as Pe,a as ye,f as p,h as t,z as k,Y as Ue,p as z,G as Be,V as Me,j as G,H as ve,k as Ve,N as fe,t as V,S as He,m as K,l as Y,_ as ze,ag as Ge,a5 as Ke,a2 as Ye,C as A,O as M,y as Je,$ as Qe}from"./9XSeHgHf.js";import{_ as We}from"./sI5dgJZQ.js";import{r as Xe}from"./DNfD1q8t.js";import{d as Ze,p as et}from"./rn2SG5fd.js";import{s as tt}from"./C_uFo46x.js";import{r as at}from"./4ZgQLaQc.js";import{r as lt}from"./C3_U-c8A.js";import{_ as st}from"./D3rdnAkZ.js";import{_ as ot}from"./BJYUGtA6.js";import{u as rt}from"./0UK1qgr-.js";import{P as nt}from"./DKEHjzpY.js";import{u as it}from"./CrWhNh3r.js";import"./GyzHslbn.js";import"./IZqDdjE-.js";let ut=Symbol("GroupContext"),ct=J({name:"Switch",emits:{"update:modelValue":x=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:void 0},defaultChecked:{type:Boolean,optional:!0},form:{type:String,optional:!0},name:{type:String,optional:!0},value:{type:String,optional:!0},id:{type:String,default:null},disabled:{type:Boolean,default:!1},tabIndex:{type:Number,default:0}},inheritAttrs:!1,setup(x,{emit:i,attrs:v,slots:S,expose:q}){var C;let $=(C=x.id)!=null?C:`headlessui-switch-${Re()}`,y=Le(ut,null),[f,w]=Ze(O(()=>x.modelValue),r=>i("update:modelValue",r),O(()=>x.defaultChecked));function R(){w(!f.value)}let T=u(null),E=y===null?T:y.switchRef,_=tt(O(()=>({as:x.as,type:v.type})),E);q({el:E,$el:E});function g(r){r.preventDefault(),R()}function F(r){r.key===me.Space?(r.preventDefault(),R()):r.key===me.Enter&&et(r.currentTarget)}function n(r){r.preventDefault()}let a=O(()=>{var r,b;return(b=(r=Ne(E))==null?void 0:r.closest)==null?void 0:b.call(r,"form")});return Q(()=>{Ae([a],()=>{if(!a.value||x.defaultChecked===void 0)return;function r(){w(x.defaultChecked)}return a.value.addEventListener("reset",r),()=>{var b;(b=a.value)==null||b.removeEventListener("reset",r)}},{immediate:!0})}),()=>{let{name:r,value:b,form:c,tabIndex:L,...I}=x,H={checked:f.value},P={id:$,ref:E,role:"switch",type:_.value,tabIndex:L===-1?0:L,"aria-checked":f.value,"aria-labelledby":y==null?void 0:y.labelledby.value,"aria-describedby":y==null?void 0:y.describedby.value,onClick:g,onKeyup:F,onKeypress:n};return pe(he,[r!=null&&f.value!=null?pe(Oe,qe({features:je.Hidden,as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:f.value,form:c,disabled:I.disabled,name:r,value:b})):null,De({ourProps:P,theirProps:{...v,...Ie(I,["modelValue","defaultChecked"])},slot:H,attrs:v,slots:S,name:"Switch"})])}}});function dt(x,i){return j(),D("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const pt={class:"fixed inset-0 overflow-hidden"},mt={class:"absolute inset-0 overflow-hidden"},vt={class:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10"},ft={class:"absolute left-0 top-0 -ml-8 flex pr-2 pt-4 sm:-ml-10 sm:pr-4"},ht={class:"flex h-full flex-col overflow-y-scroll bg-white py-3 shadow-xl"},yt={class:"border-b"},_t={class:"relative mt-6 flex-1 flex flex-col space-y-3"},gt={class:"px-5 flex flex-col space-y-3"},bt={classs:"flex flex-col items-center"},xt={class:"absolute w-full border-t bottom-0 justify-end flex px-5 pt-3 items-center space-x-5"},wt=J({__name:"filters",emits:["tableFields","filterFields","specimenFields","locationField","originField","onClearFilters"],setup(x,{emit:i}){const v=u(!1),{$toast:S}=Pe(),q=()=>{v.value=!0},C=u([{label:"Show person who requested test",value:!1,property:"Requested by",table_value:"requested_by"},{label:"Show person who completed the test",value:!1,property:"Completed by",table_value:"completed"},{label:"Show test tracking numbers",value:!1,property:"tracking number",table_value:"tracking_number"},{label:"Show test result value",value:!1,property:"Test result",table_value:"result"},{label:"Show date of test result",value:!1,property:"Result date",table_value:"result_date"}]),$=u([]),y=u([]),f=u([]),w=u([]),R=ye("token"),T=i,E=()=>{const n=C.value.filter(a=>a.value);T("tableFields",n),T("specimenFields",f.value.join(",")),T("locationField",w.value.join(",")),v.value=!1,S.success("Filters applied successfully")},_=()=>{v.value=!1,C.value=C.value.map(n=>({...n,value:!1})),f.value=[],w.value=[],T("onClearFilters",C.value),S.success("Filters reset successfully")},g=async()=>{const{data:n,error:a,pending:r}=await K({route:Y.specimens,method:"GET",token:`${R.value}`});n&&($.value=n.value)},F=async()=>{const{data:n,error:a,pending:r}=await K({route:Y.locations,method:"GET",token:`${R.value}`});n&&(y.value=n.value)};return Q(()=>{g(),F()}),(n,a)=>{const r=ze,b=We;return j(),D("div",null,[p(r,{text:"Apply filters",color:"primary",icon:t(Xe),click:q},null,8,["icon"]),p(t(He),{as:"template",show:t(v)},{default:k(()=>[p(t(Ue),{class:"relative z-10",onClose:a[3]||(a[3]=c=>v.value=!1)},{default:k(()=>[p(t(z),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>a[4]||(a[4]=[s("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity"},null,-1)])),_:1}),s("div",pt,[s("div",mt,[s("div",vt,[p(t(z),{as:"template",enter:"transform transition ease-in-out duration-500 sm:duration-700","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:k(()=>[p(t(Be),{class:"pointer-events-auto relative w-screen max-w-md"},{default:k(()=>[p(t(z),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[s("div",ft,[s("button",{type:"button",class:"relative text-gray-100 hover:text-white",onClick:a[0]||(a[0]=c=>v.value=!1)},[a[5]||(a[5]=s("span",{class:"absolute -inset-2.5"},null,-1)),a[6]||(a[6]=s("span",{class:"sr-only"},"Close panel",-1)),p(t(dt),{class:"h-6 w-6","aria-hidden":"true"})])])]),_:1}),s("div",ht,[s("div",yt,[p(t(Me),{class:"text-xl font-semibold leading-6 text-gray-900 px-4 py-2"},{default:k(()=>a[7]||(a[7]=[G("Filters")])),_:1})]),s("div",_t,[s("div",gt,[s("div",null,[p(b,{label:"Specimen",mode:"tags",items:t($).map(c=>c.name),"items-selected":t(f),"onUpdate:itemsSelected":a[1]||(a[1]=c=>ve(f)?f.value=c:null)},null,8,["items","items-selected"])]),s("div",null,[p(b,{label:"Lab location",mode:"tags",items:t(y).map(c=>c.name),"items-selected":t(w),"onUpdate:itemsSelected":a[2]||(a[2]=c=>ve(w)?w.value=c:null)},null,8,["items","items-selected"])]),s("div",bt,[(j(!0),D(he,null,Ve(t(C),c=>(j(),D("label",{key:c.label,class:"flex items-center pt-3"},[p(t(ct),{modelValue:c.value,"onUpdate:modelValue":L=>c.value=L,class:fe([c.value?"bg-sky-500":"bg-gray-200","relative mr-2 inline-flex w-11 h-6 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75"])},{default:k(()=>[s("span",{"aria-hidden":"true",class:fe([c.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"])},null,2)]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),G(" "+V(c.label),1)]))),128))])]),s("div",xt,[p(r,{text:"Reset",color:"error",icon:t(at),click:_},null,8,["icon"]),p(r,{text:"Apply",color:"success",icon:t(lt),click:E},null,8,["icon"])])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["show"])])}}}),St=""+new URL("report_details.CM__hAjw.png",import.meta.url).href,Ct={class:"px-5 py-5"},Et={class:"bg-gray-50 border border-gray-100 rounded"},kt={class:"flex px-2 py-2 items-center"},$t={class:"px-2 text-base font-medium uppercase"},Tt={class:"flex px-2 py-2 items-center"},Ft={class:"px-2 text-base font-medium"},Rt={class:"w-full flex items-center justify-between mt-3"},Lt={class:"flex items-center space-x-3"},Nt={class:"mt-5"},Yt=J({__name:"[associated_id]",setup(x){var W,X;const i=Ge();it({title:`${Ke(((X=(W=i.query.type)==null?void 0:W.toString())==null?void 0:X.toUpperCase().replaceAll("-"," "))??"")} Drilldown - ${nt.name.toUpperCase()}`});const v=u([]),S=u(!1),q=u(""),C=ye("token"),$=rt(),y=Ye(),f=u("name"),w=u(0),R=u([10,25,50,100,500,1e3]),T=u("patient_name"),E=u("asc"),_=u([]),g=u([]),F=u({page:1,rowsPerPage:10,sortBy:"name"}),n=u([{text:"SN",value:"sn",sortable:!1},{text:"PATIENT NO",value:"patient_id",sortable:!0},{text:"PATIENT NAME",value:"patient_name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"DATE REGISTERED",value:"date_registered",sortable:!0}]),a=u(n.value),r=u([]),b=[{name:"Home",link:"/home"},{name:"Reports",link:"#"}],c=(e,l,d,o)=>{const m=A(o).format("MMMM"),h=A(o).format("yyyy");return{aggregate:`${A(l).format(M)} - ${A(d).format(M)}`,culture:`${m}, ${h}`,moh:`${o}`}[e]},L=O(()=>v.value.map((e,l)=>{const d=e.completed_by&&e.completed_by.username?e.completed_by.username:"",o=e.results&&e.results.length>0?e.results.find(h=>h.value!==null):{},m=e.results&&e.results.length>0?e.results.filter(h=>h.name!=="Lab Tech. Name:").map(h=>`${h.name}: ${h.value}`).join(", "):"";return{sn:l+1,patient_id:e.client.patient_no,patient_name:`${e.client.first_name} ${e.client.last_name}`,accession_number:e.accession_number,test_type_name:e.test_type_name,specimen_type:e.specimen_type,result:m,result_date:A(o.result_date).format(M),completed:d,requested_by:e.requested_by,tracking_number:e.tracking_number,lab_location:e.lab_location.name,rejection_reason:e.rejection_reason,date_registered:A(e.created_date).format(M)}}).filter(e=>_.value.length===0||_.value.includes(e.specimen_type)).filter(e=>g.value.length===0||g.value.includes(e.lab_location))),I=O(()=>L.value.map(e=>{let l={SN:e.sn,"PATIENT NO":e.patient_id,"PATIENT NAME":e.patient_name,"ACCESSION NO":e.accession_number,TEST:e.test_type_name,SPECIMEN:e.specimen_type,"TEST RESULT":e.result.replace(/,/g,`
`),"LAB LOCATION":e.lab_location,"RESULT DATE":e.result_date,"COMPLETED BY":e.completed,"REQUESTED BY":e.requested_by,"REJECTION EASON":e.rejection_reason,"TRACKING NUMBER":e.tracking_number,"DATE REGISTERED":e.date_registered};const d=[...r.value.length>0?[([o])=>r.value.map(m=>m.toUpperCase()).includes(o.toUpperCase())||n.value.some(m=>m.text===o.toUpperCase())]:[],..._.value.length>0?[([o])=>o.toUpperCase()==="SPECIMEN"]:[],...g.value.length>0?[([o])=>o.toUpperCase()==="LAB LOCATION"]:[],([o])=>a.value.map(m=>m.text.toUpperCase()).includes(o.toUpperCase())];return Object.fromEntries(Object.entries(l).filter(o=>d.some(m=>m(o))))})),H=u([{origin:"aggregate",path:`${Y.aggregateDrilldown}?associated_ids=${i.params.associated_id}`}]),P=async()=>{var h;S.value=!0;const e=H.value.find(N=>N.origin==="aggregate");if(!e){console.error("Endpoint not found");return}const l={route:`${e.path}&page=${F.value.page}&per_page=${F.value.rowsPerPage}`,method:"GET",token:`${C.value}`},{data:d,error:o,pending:m}=await K(l);if(S.value=m,d.value&&(v.value=d.value.data,w.value=d.value.meta.total_count,S.value=!1,(h=i.query.type)!=null&&h.includes("reject"))){const N=n.value.findIndex(B=>B.value==="test_type_name")+1,U={text:"REJECTION REASON",value:"rejection_reason",sortable:!0};n.value.splice(N,0,U)}o.value&&(console.error(o.value),S.value=!1)},_e=e=>{if(typeof e=="object"){F.value=e;const d={...y.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};y.replace({query:d}),P()}},ge=e=>{_.value=[],g.value=[],xe(e),a.value=n.value.filter(l=>!l.text.includes("Specimen")).filter(l=>!l.text.includes("Lab Location"))},be=e=>{if(a.value=[...n.value],r.value=[],e.length>0){const l=new Set(a.value.map(o=>o.text));e.forEach(o=>{l.has(o.property)||(a.value.push({text:o.property,value:o.table_value,sortable:!0}),r.value.push(o.property))});const d=new Set(e.map(o=>o.property));a.value=a.value.filter(o=>d.has(o.text)||n.value.some(m=>m.text===o.text))}},xe=e=>{e.forEach(l=>{l.value||(a.value=a.value.filter(d=>d.text!==l.property))}),_.value.length===0&&g.value.length===0&&(a.value=[...n.value])},we=e=>{const l=e.split(",").filter(d=>d.trim()!=="");_.value=l,l.length>0?Ce({text:"Specimen",value:"specimen_type",sortable:!0}):Ee(),_.value.length===0&&g.value.length===0&&(n.value=[...n.value])},Se=e=>{const l=e.split(",").filter(d=>d.trim()!=="");g.value=l,l.length>0?ke({text:"Lab Location",value:"lab_location",sortable:!0}):$e(),_.value.length===0&&g.value.length===0&&(n.value=[...n.value])},Ce=e=>{a.value.some(l=>l.text==="Specimen")||a.value.push(e)},Ee=()=>{a.value=a.value.filter(e=>e.text!=="Specimen")},ke=e=>{a.value.some(l=>l.text==="Lab Location")||a.value.push(e)},$e=()=>{a.value=a.value.filter(e=>e.text!=="Lab Location")},Te=e=>e.join("-").toLowerCase().replace(/ /g,"-");return Q(()=>{P()}),(e,l)=>{var U,B,Z,ee,te,ae,le,se,oe,re,ne,ie,ue,ce,de;const d=Fe,o=wt,m=st,h=Je("excel"),N=ot;return j(),D("div",Ct,[p(d,{pages:b}),l[3]||(l[3]=s("div",{class:"py-4 flex items-center"},[s("img",{src:St,alt:"report-icon",class:"w-8 h-8 mr-2"}),s("h3",{class:"text-2xl font-semibold uppercase"},"Report Details")],-1)),s("div",null,[s("div",Et,[s("div",kt,[l[0]||(l[0]=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M31 10a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2h-8a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2H9a1 1 0 1 0 0 2v7H7v-3H5v3H4v2h1v13H4v2h1v2h2v-2h34v2h2v-2h1v-2h-1V21h1v-2h-1v-3h-2v3h-2v-7a1 1 0 1 0 0-2zm6 9v-7h-4v7zm-4 2h4v5h-4zm-2 0v8a4 4 0 0 0 8 0v-8h2v13H7V21h2v8a4 4 0 0 0 8 0v-8h3v8a4 4 0 0 0 8 0v-8zm-5-2v-7h-4v7zm-11 0v-7h-4v7zm-4 2h4v2h-4z","clip-rule":"evenodd"})],-1)),s("p",$t,V(t(i).query.test)+" (total tests count: "+V(t(i).query.count)+") ",1)]),s("div",Tt,[l[2]||(l[2]=Qe('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 512 512"><rect width="416" height="384" x="48" y="80" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M128 48v32m256-32v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path></svg>',1)),s("p",Ft,[l[1]||(l[1]=s("span",{class:"font-medium text-black uppercase"},"Report period:",-1)),G(" "+V(c((U=t(i).query.origin)==null?void 0:U.toString(),(B=t(i).query.from)==null?void 0:B.toString(),(Z=t(i).query.to)==null?void 0:Z.toString(),(ee=t(i).query.dateRange)==null?void 0:ee.toString())),1)])])]),s("div",Rt,[s("div",null,[p(o,{onTableFields:be,onSpecimenFields:we,onLocationField:Se,onOnClearFilters:ge})]),s("div",Lt,[p(h,{class:"btn btn-default",header:[`${(te=t(i).query.origin)==null?void 0:te.toString().toUpperCase()} - ${(ae=t(i).query.type)==null?void 0:ae.toString().replaceAll("-"," ").toUpperCase()} `,`FOR PERIOD ${c((le=t(i).query.origin)==null?void 0:le.toString(),(se=t(i).query.from)==null?void 0:se.toString(),(oe=t(i).query.to)==null?void 0:oe.toString(),(re=t(i).query.dateRange)==null?void 0:re.toString())}`,t($).details.name,t($).details.address,t($).details.phone,`${(ie=(ne=t(i).query.test)==null?void 0:ne.toString())==null?void 0:ie.toUpperCase()}`],data:t(I),worksheet:"report-work-sheet",name:Te([`${(ue=t(i).query.origin)==null?void 0:ue.toString()}`,`${(ce=t(i).query.type)==null?void 0:ce.toString()}`,`${(de=t(i).query.test)==null?void 0:de.toString()}`,".xls"])},{default:k(()=>[p(m,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),s("div",Nt,[p(N,{headers:t(a),data:t(L),loading:t(S),"rows-per-items":t(R),searchField:t(q),searchValue:t(f),serverItemsLength:t(w),serverOptions:t(F),sortBy:t(T),sortType:t(E),onUpdate:_e},null,8,["headers","data","loading","rows-per-items","searchField","searchValue","serverItemsLength","serverOptions","sortBy","sortType"])])])])}}});export{Yt as default};
