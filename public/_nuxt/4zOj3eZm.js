import{_ as ie}from"./DnQNH6n5.js";import{_ as me}from"./BaCgUW4N.js";import{b as E,e as T,g as r,d as ce,r as o,a as ue,c as v,w as j,m as I,f as l,h as e,t as G,n as k,p as V,y as U,s as N,u as A,_ as de,k as pe,C as _e,D as ve,l as fe}from"./CFJLM_Ie.js";import{_ as ge}from"./ClsdQHz_.js";import{_ as ye}from"./CNyqjQsr.js";import{u as he}from"./CbkhdmMI.js";import{h as f,i as xe,e as H,f as z}from"./NSQCzdgw.js";import{d as q,e as Ee}from"./Zs5V9wEc.js";import{_ as Te}from"./D-kCw6VY.js";import{_ as Re}from"./Cq9kDafQ.js";import{P as Se}from"./DnWkowi2.js";import{u as we}from"./DEAa7C1n.js";import{r as $e}from"./BL5kvFFC.js";import{r as Pe}from"./Dhp4HNmj.js";import{r as Ne}from"./DVj5woSA.js";import"./0YTBxEWP.js";import"./BoZExIdM.js";import"./sen56F8u.js";import"./B307KWXK.js";import"./DL7tKmRK.js";import"./1TxO0rPq.js";import"./CIBAR2Bi.js";import"./rauhO8aD.js";import"./C6QRH5hM.js";import"./CXlG2fUz.js";import"./BwWK-syC.js";import"./BmAKWF52.js";import"./ccM_rzRE.js";function Ae(R,n){return E(),T("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[r("path",{"fill-rule":"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75H12a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}const D=R=>(_e("data-v-fe30f375"),R=R(),ve(),R),De={class:"px-5 py-5"},Ce={class:"flex items-center py-5"},Me=D(()=>r("img",{src:Te,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),be={class:"text-2xl font-semibold uppercase"},Ie={class:"w-full flex items-center justify-between mb-5"},ke={class:"w-full flex items-center space-x-3"},Ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ve={class:"w-72 ml-2"},Ye={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Be={class:"w-48 ml-2"},Le={class:"flex justify-end py-2"},Fe={class:"bg-gray-100 rounded flex items-center text-zinc-500"},Oe={class:"w-48"},je={class:"w-48"},Ge={key:0,id:"print-container"},He={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},ze=D(()=>r("img",{src:Re,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1)),qe=D(()=>r("p",null,"Data not found, please generate report",-1)),Ze=[ze,qe],Ke={key:2,class:"mx-auto justify-center flex flex-col items-center space-y-3"},Je=D(()=>r("p",{class:"text-base"},[V("Generating report, please wait"),r("span",{class:"animate-ping"},"...")],-1)),Xe=ce({__name:"user-statistics",setup(R){he({title:`${Se.name.toUpperCase()} - User Statistics Report`});const n=o({name:"select report type"}),Y=o(""),Z=o(""),K=Ne,g=o(new Array),B=ue("token"),S=o({page:1,rowsPerPage:20,sortBy:"name"}),L=o(0),c=o(!1),u=o([]),J=o("User Statistics Report"),F=o([]),C=we(),d=o({name:"Select and search for user..."}),X=o([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),Q=o([{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}]),i=v(()=>g.value.map(t=>({...t,created_date:f(t.created_date).format("DD/MMM/YYYY"),age:xe(t.date_of_birth)}))),W=v(()=>{const t=n.value,s=()=>i.value.length>0&&t.name=="Summary"?i.value.map(a=>({USER:a.user,"TESTS COMPLETED":a.tests_completed,"TESTS RECEIVED":a.tests_received,"SPECIMEN COLLECTED":a.specimen_collected,"SPECIMEN REJECTED":a.specimen_rejected,"TESTS AUTHORIZED":a.tests_authorized})):[],y=()=>i.value.length>0&&t.name=="Patient Registry"?i.value.map(a=>({"PATIENT NO":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,AGE:a.age,SEX:a.sex})):[],p=()=>i.value.length>0&&t.name=="Tests Registry"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[],m=()=>i.value.length>0&&t.name=="Specimen Registry"?i.value.map(a=>({"SPECIMEN NUMBER":a.id,"PATIENT NAME":a.patient_name,"PATIENT NUMBER":a.patient_no,"DATE REGISTERED":a.created_date})):[],h=()=>i.value.length>0&&t.name=="Tests Performed"?i.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":a.patient_name,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[];return{Summary:s(),"Patient Registry":y(),"Tests Registry":p(),"Specimen Registry":m(),"Tests Performed":h()}[t.name]}),M=v(()=>F.value.map(t=>({id:t.id,name:`${t.first_name} ${t.last_name}`}))),ee=v(()=>{const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},s=n.value.name.toLowerCase();return t[s]||""}),te=v(()=>{const t={summary:new Array({text:"Name",value:"user"},{text:"Tests Received",value:"tests_received"},{text:"Specimen Collected",value:"specimen_collected"},{text:"Specimen Rejected",value:"specimen_rejected"},{text:"Tests Performed",value:"tests_completed"},{text:"Tests Authorized",value:"tests_authorized"}),"specimen registry":new Array({text:"Specimen Number",value:"id"},{text:"Name",value:"specimen"},{text:"Patient Number",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Date Registered",value:"created_date"}),"tests registry":new Array({text:"Test Type",value:"test_type_name"},{text:"Patient Number",value:"client.id"},{text:"Patient Name",value:"actions"},{text:"Specimen",value:"specimen_type"},{text:"Date Registered",value:"created_date"}),"patients registry":new Array({text:"Patient Number",value:"id"},{text:"Name",value:"actions"},{text:"Gender",value:"sex"},{text:"Age",value:"age"},{text:"Date Registered",value:"created_date"}),"tests performed":new Array({text:"Test Id",value:"test_id"},{text:"Test Type",value:"test_type"},{text:"Patient No",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Accession Number",value:"accession_number"},{text:"Date Registered",value:"created_date"})},s=n.value.name.toLowerCase();return t[s]||new Array}),w=v(()=>u.value[0]?f(u.value[0]).format("YYYY-MM-DD"):""),$=v(()=>u.value[1]?f(u.value[1]).format("YYYY-MM-DD"):"");async function b(){if(O(n.value)=="")A().$toast.warning("Please select a report type!");else{c.value=!0;const{page:t,rowsPerPage:s}=S.value;let y=`from=${w.value}&to=${$.value}&report_type=${O(n.value).toLocaleLowerCase()}&page=${t}&limit=${s}&user=${d.value.id}`;const p={route:`${H.aggregateReports}user_statistics?${y}`,method:"GET",token:`${B.value}`},{data:m,error:h,pending:P}=await z(p);c.value=P,m.value&&(c.value=!1,g.value=m.value.data.tests,L.value=m.value.data.metadata.total_count,m.value.data.tests.length>0?A().$toast.success("Report data generated successfully"):A().$toast.warning(`No data found in period ${w.value} - ${$.value}`)),h.value&&(c.value=!1,console.error(h.value),A().$toast.error(Ee))}}async function ae(){const{data:t,error:s}=await z({route:`${H.users}?page=1&per_page=2000`,method:"GET",token:`${B.value}`});t.value&&(F.value=t.value.data,M.value.some(p=>p.name=="All")||M.value.unshift({id:0,name:"All"})),s.value&&console.error(s.value)}function O(t){return t.name=="select report type"?"":t.name}function se(t){typeof t=="object"&&(S.value=t)}function re(t){Y.value=t,Z.value=t,b()}return j(()=>S.value,(t,s)=>{t!=s&&b()}),j(()=>n.value,(t,s)=>{t!=s&&(g.value=[])}),ae(),(t,s)=>{const y=ie,p=I("datepicker"),m=me,h=de,P=I("FormKit"),a=ge,ne=I("excel"),oe=ye,le=pe;return E(),T("div",De,[l(y,{pages:e(X)},null,8,["pages"]),r("div",Ce,[Me,r("h3",be,G(e(J)),1)]),r("div",Ie,[l(P,{type:"form","submit-label":"Update",onSubmit:b,actions:!1,id:"submitForm"},{default:k(({value:_})=>[r("div",ke,[r("div",Ue,[l(e($e),{class:"w-5 h-5 mr-2"}),V(" Filter By Date Range "),r("div",Ve,[l(p,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(u),"onUpdate:modelValue":s[0]||(s[0]=x=>U(u)?u.value=x:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),r("div",Ye,[l(e(Ae),{class:"w-5 h-5 mr-2 my-2.5"}),V(" Report Type "),r("div",Be,[l(m,{class:"bg-white",items:e(Q),modelValue:e(n),"onUpdate:modelValue":s[1]||(s[1]=x=>U(n)?n.value=x:null)},null,8,["items","modelValue"])])]),r("div",Le,[r("div",Fe,[r("div",Oe,[l(m,{class:"bg-white rounded",isSearchable:!0,items:e(M),modelValue:e(d),"onUpdate:modelValue":s[2]||(s[2]=x=>U(d)?d.value=x:null),onUpdate:re},null,8,["items","modelValue"])]),e(d).name!=null&&e(d).name!=="Select and search for user..."?(E(),T("button",{key:0,type:"button",onClick:s[3]||(s[3]=x=>d.value={name:"Select and search for user..."})},[l(e(Pe),{class:"w-5 h-5 mx-2 my-2.5"})])):N("",!0)])]),r("div",je,[l(h,{type:"submit",color:"primary",text:"Generate Report",icon:e(K),click:()=>{},loading:e(c)},null,8,["icon","loading"])])])]),_:1}),l(ne,{class:"btn btn-default",header:[`USER STATISTICS ${e(n).name.toUpperCase()} REPORT`,`PERIOD FROM ${e(f)(e(w)).format("dateFormat"in t?t.dateFormat:e(q))} TO ${e(f)(e($)).format("dateFormat"in t?t.dateFormat:e(q))}`,e(C).details.name,e(C).details.address,e(C).details.phone],data:e(W),worksheet:"report-work-sheet",name:`user_statistics_report_${e(n).name.toLowerCase().split(" ").join("_")}_${e(f)(e(w)).format("DD_MM_yyyy")}_to_${e(f)(e($)).format("DD_MM_yyyy")}.xls`},{default:k(()=>[l(a,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),e(g).length>0?(E(),T("div",Ge,[l(oe,{headers:e(te),data:e(i),serverItemsLength:e(L),serverOptions:e(S),loading:e(c),"search-field":e(ee),"search-value":e(Y),onUpdate:se},{actions:k(({item:_})=>[r("td",null,G(e(n).name.toLowerCase()=="patients registry"?`${_.first_name}
                            ${_.middle_name} ${_.last_name}`:`${_.client.first_name} ${_.client.middle_name}
                            ${_.client.last_name}`),1)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value"])])):N("",!0),e(g).length==0&&!e(c)?(E(),T("div",He,Ze)):N("",!0),e(c)&&e(g).length==0?(E(),T("div",Ke,[l(le),Je])):N("",!0)])}}}),$t=fe(Xe,[["__scopeId","data-v-fe30f375"]]);export{$t as default};
