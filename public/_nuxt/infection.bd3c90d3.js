import{_ as oe}from"./Breadcrumb.vue.28eeda34.js";import{_ as ne}from"./Dropdown.fb72c7e0.js";import{l as le,s as b,u as ae,H as G,f as O,o as v,c as T,b as _,k as r,d as s,t as g,g as F,h as M,y as w,F as ce,r as ie,n as de,j as V,w as pe,v as _e,a as j,e as ue}from"./entry.7897c13a.js";import{_ as me}from"./ExportButton.vue.80cf08c8.js";import{_ as fe}from"./Address.vue.636436a9.js";import{_ as be}from"./Loader.5ae19c0c.js";import{u as ge}from"./vue.f36acd1f.187defeb.js";import{e as he}from"./constants.62e440a8.js";import{_ as ye}from"./report.3310e038.js";import{_ as xe}from"./logo.acaf563c.js";import{_ as Ee}from"./page.5828a0c0.js";import{h,f as B,e as H}from"./fetch.00e05314.js";import{k as ve}from"./vue-doc-download.6324708c.js";import{P as Te}from"./package.9331fd8f.js";import{u as Se}from"./facility.9d750171.js";import{r as Re}from"./FunnelIcon.98e649cd.js";import{r as Le}from"./ArrowPathIcon.e8a9d883.js";import"./nuxt-link.b77691a3.js";import"./HomeIcon.cdb6968c.js";import"./listbox.fd701fc9.js";import"./hidden.2913a642.js";import"./use-text-value.242d3331.js";import"./CheckIcon.c011ad86.js";import"./CheckCircleIcon.d85f8f8d.js";import"./MagnifyingGlassIcon.afa0e37c.js";import"./transition.b5d3dcf7.js";import"./XMarkIcon.a7881734.js";import"./PencilSquareIcon.b19e0a71.js";import"./PrinterIcon.2af29564.js";const Me={class:"px-5 py-5"},Ye={class:"flex items-center py-5"},Ne=s("img",{src:ye,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ke={class:"text-2xl font-semibold uppercase"},Ue={class:"w-full flex items-center justify-between mb-5"},Ae={class:"w-full flex items-center space-x-3"},Ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},$e={class:"w-72 ml-2"},We={class:"w-40"},Ge={class:"w-48 flex items-end justify-end"},Oe={class:"rounded border"},Fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},we=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:xe,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold uppercase"}," INFECTION REPORT ")],-1),Ve={key:0,id:"print-container"},je={class:"hidden"},Be=s("h3",null,"INFECTION REPORT",-1),He={class:"text-lg font-semibold py-2 px-2"},Pe={class:"text-normal font-normal"},Ie=["innerHTML"],qe=s("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"Summary",-1),Ke={class:"w-full border-t"},ze=s("thead",null,[s("tr",{class:"border-b border-t bg-gray-100"},[s("th",{class:"px-2 py-2 border-r text-left"},"Tests"),s("th",{class:"px-2 py-2 text-left"},"Total")])],-1),Je={class:"px-2 py-2 border-r border-b"},Qe={class:"px-2 py-2 border-r border-b"},Xe={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Ze=s("img",{src:Ee,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),De=s("p",{class:"text-base"},"Data not found, please generate report",-1),et=[Ze,De],tt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},st=s("p",{class:"text-base"},[M("Generating report, please wait"),s("span",{class:"animate-ping"},"...")],-1),$t=le({__name:"infection",setup(rt){ge({title:`${Te.name.toUpperCase()} - Infection Report`});const P=b("Infection Report"),I=b([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),S=b([]),x=b({id:0,name:"select department"}),Y=ae("token"),m=b(!1),L=Se(),R=b([]),N=b([]),n=b(new Array("","")),k=G(()=>n.value[0]?h(n.value[0]).format("YYYY-MM-DD"):""),U=G(()=>n.value[1]?h(n.value[1]).format("YYYY-MM-DD"):""),q=()=>{n.value=new Array("","")},K=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',c=(o,e,l)=>{const a=o.indexOf(e);return a!==-1?o.slice(0,a)+l+o.slice(a+e.length):o},z=o=>{let e="",l="",a="",d="",f=0,u=0,i=0,p=0,y=0;return o.reduce((t,A)=>{const D=A.measures.flatMap(C=>C.results.flatMap($=>{const W=Object.keys($[0])[0],ee=$[0][W];return Object.entries(ee).map(([te,se])=>{const re=se;return{test_type:A.test_type,measure:C.name,result:W,gender:te==="F"?"Female":"Male",...re}})}));return t.push(...D),t},new Array).forEach(t=>{u++,i++,f++,a===t.test_type?(e+="<tr>",l!==t.measure?(l=t.measure,d=t.result,e=c(e,"NEW_MEASURE",u.toString()),e=e.replace("NEW_RESULT",i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),u=0,i=0,p=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):d!==t.result&&(e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),d=t.result,i=0,p=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(a=t.test_type,l=t.measure,d=t.result,e=e.replace(/NEW_TEST/g,f.toString()),e=c(e,"NEW_MEASURE",u.toString()),e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),u=0,i=0,p=0,f=0,y=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.L_E_5?t.L_E_5:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_5_L_E_14?t.G_5_L_E_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_14?t.G_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0)).toString()+"</td>",p+=(t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0),d===t.result&&i==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),u==0&&(y=t.L_E_5+t.G_5_L_E_14+t.G_14)}),e=c(e,"NEW_TEST",(++f).toString()),e=c(e,"NEW_MEASURE",(++u).toString()),e=c(e,"NEW_RESULT",(++i).toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),e+="</tr>",e},J=o=>{const e=K(),l=o.length>0?z(o):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${l}</table>`};async function Q(){const{data:o,error:e}=await B({route:`${H.departments}`,method:"GET",token:`${Y.value}`});o.value&&(S.value=o.value,S.value.some(l=>l.id===0)||S.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function X(){if(Z())j().$toast.warning("Please select a department");else{m.value=!0;let o=n.value[0].toString()!=""?h(n.value[0].toString()).format("YYYY-MM-DD"):"",e=n.value[1].toString()!=""?h(n.value[1].toString()).format("YYYY-MM-DD"):"";const l={route:`${H.aggregateReports}infection?from=${o}&to=${e}&department=${x.value.id}`,method:"GET",token:`${Y.value}`},{data:a,error:d,pending:f}=await B(l);m.value=f,a.value&&(m.value=!1,R.value=a.value.data,N.value=a.value.summary),d.value&&(console.error(d.value),m.value=!1,j().$toast.error(he))}}function Z(){return x.value.name=="select department"}return Q(),(o,e)=>{const l=oe,a=O("datepicker"),d=ne,f=ue,u=O("FormKit"),i=me,p=fe,y=be;return v(),T("div",Me,[_(l,{pages:r(I)},null,8,["pages"]),s("div",Ye,[Ne,s("h3",ke,g(r(P)),1)]),s("div",Ue,[_(u,{type:"form","submit-label":"Update",onSubmit:X,actions:!1,id:"submitForm"},{default:F(({value:E})=>[s("div",Ae,[s("div",Ce,[_(r(Re),{class:"w-5 h-5 mr-2"}),M(" Filter By Date Range "),s("div",$e,[_(a,{onCleared:q,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r(n),"onUpdate:modelValue":e[0]||(e[0]=t=>w(n)?n.value=t:null)},null,8,["modelValue"])])]),s("div",We,[_(d,{items:r(S),modelValue:r(x),"onUpdate:modelValue":e[1]||(e[1]=t=>w(x)?x.value=t:null)},null,8,["items","modelValue"])]),s("div",null,[_(f,{loading:r(m),color:"primary",type:"submit",text:"Generate Report",icon:r(Le),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),s("div",Ge,[_(r(ve),{element:"print-container",filename:`infection_report_from_${r(h)(r(n)[0].toString()).format("DD_MM_YYYY")}_to_${r(h)(r(n)[1].toString()).format("DD_MM_YYYY")}`},{default:F(()=>[_(i,{text:"Export Excel"})]),_:1},8,["filename"])])]),s("div",null,[s("div",Oe,[s("div",Fe,[we,_(p)]),r(R).length>0&&!r(m)?(v(),T("div",Ve,[s("div",je,[Be,s("h3",null,g(r(L).details.name),1),s("p",null,g(r(L).details.address),1),s("p",null,g(r(L).details.phone),1)]),s("div",He,[M("Tests Performed Period: "),s("span",Pe,g(r(k)!=""?r(h)(r(k)).format("DD/MM/YYYY"):"")+" - "+g(r(U)!=""?r(h)(r(U)).format("DD/MM/YYYY"):""),1)]),s("div",{innerHTML:J(r(R))},null,8,Ie),s("div",null,[qe,s("table",Ke,[ze,s("tbody",null,[(v(!0),T(ce,null,ie(r(N),(E,t)=>(v(),T("tr",{key:E.name,class:de(t%2===0?"bg-white":"bg-gray-50")},[s("td",Je,g(E.name),1),s("td",Qe,g(E.count),1)],2))),128))])])])])):V("",!0),r(R).length==0&&!r(m)?(v(),T("div",Xe,et)):V("",!0),pe(s("div",tt,[_(y),st],512),[[_e,r(m)]])])])])}}});export{$t as default};
