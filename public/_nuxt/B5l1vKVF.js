var Se=Object.defineProperty;var Te=(w,y,u)=>y in w?Se(w,y,{enumerable:!0,configurable:!0,writable:!0,value:u}):w[y]=u;var R=(w,y,u)=>Te(w,typeof y!="symbol"?y+"":y,u);import{_ as Re}from"./CUGREwii.js";import{l as C,d as Ue,a5 as ke,a as Ce,r as i,bk as De,bl as Y,w as Ne,bm as Ae,y as ae,b as V,e as E,f as a,h as o,g as t,i as U,v as j,z as Me,H as x,aD as ne,bn as re,s as ie,F as B,j as W,t as $e,q as H,L as Ie,K as k,k as qe,bo as Pe,bp as O,bq as ue,a2 as de,m as Ge,u as L,E as Oe,J as Le,n as Fe,_ as Ye,br as je}from"./JEpZiKDn.js";import{_ as Be}from"./D-ktHv4g.js";import{_ as We}from"./CQGLbxfD.js";import{_ as He}from"./wJ75NN9-.js";import{H as Ke}from"./Drn6De9M.js";import{r as Qe}from"./BjubWsap.js";import{r as ze}from"./C1QrZmAh.js";import"./DGM4Jn_4.js";import"./Cd90EHgg.js";import"./BcRhypLO.js";import"./D9psU6J9.js";import"./BO5pWTJR.js";import"./DHOH29o0.js";import"./BhA5OI8I.js";import"./IQ2PmlzZ.js";import"./BcteEfoI.js";class Je extends Ke{constructor(){super(...arguments);R(this,"ORGANISMS",C.organisms);R(this,"SPECIMENS",C.specimens);R(this,"DEPARTMENTS",C.departments);R(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(u){const _={route:this.ORGANISMS,method:"GET",token:`${u}`};return this.call(_)}async getSpecimens(u){const _={route:this.SPECIMENS,method:"GET",token:`${u}`};return this.call(_)}async getDepartments(u){const _={route:this.DEPARTMENTS,method:"GET",token:`${u}`};return this.call(_)}async getTestTypesIndicators(u){const _={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${u}`};return this.call(_)}}const Xe=Je,Ze={class:"px-5 py-5"},et=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1),tt={class:"flex items-center justify-center mx-auto my-20"},lt={class:"mt-2 space-y-3"},st={class:"grid grid-cols-2 gap-4"},ot={class:"w-full flex items-center"},at={class:"py-1 ml-2 flex flex-col space-y-2"},nt=t("p",{class:"font-medium text-base"},"Duration",-1),rt={class:"w-full flex items-center space-x-2"},it=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1),ut={class:"w-full flex flex-col space-y-2"},dt=t("label",{class:"font-medium"},"Organisms",-1),ct={class:"w-full flex flex-col space-y-2"},mt=t("label",{class:"font-medium"},"Specimens",-1),pt={class:"w-full flex items-center space-x-2"},_t=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1),vt={class:"w-full flex flex-col space-y-2"},ft=t("label",{class:"font-medium"},"Lab section",-1),gt={class:"w-full flex"},yt={class:"py-3 flex items-center justify-between"},ht={class:"text-lg text-grameasuresy-700 font-semibold"},xt=["onClick"],Vt={class:"grid grid-cols-4 gap-2 mb-3"},bt=t("p",{class:"font-medium mb-2"},"Type",-1),Et={class:"flex items-center space-x-3"},wt={class:"grid grid-cols-2 gap-2"},St={class:""},Tt=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1),Rt={class:"grid grid-cols-2 gap-2"},Ut={class:"flex flex-col"},kt=t("label",{class:"font-medium"},"Sex",-1),Ct={class:""},Dt=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1),Nt={class:"grid grid-cols-2 gap-2"},At=["onClick"],Mt={class:"w-full flex items-center justify-center space-x-2"},$t={class:"w-full grid grid-cols-2 gap-4"},It=["onClick"],qt={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},Pt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},sl=Ue({__name:"index",setup(w){const y=ke(),u=Ce("token"),_=new Xe,ce=i(!1),p=i([]),D=i(""),N=i(""),A=i(""),K=i([]),b=i(!1),M=i([]),Q=i([]),z=i([]),$=i([]),I=i(!1),q=i(!1),me=i(De),S=i({name:Y}),J=i([]),X=i([]),Z=i([]),P=i(""),G=i({name:Y}),pe=Pe,_e=async()=>{const{data:s,error:e}=await _.getOrganisms(`${u.value}`);s.value&&(Q.value=s.value,z.value=s.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},ve=async()=>{const{data:s,error:e}=await _.getSpecimens(`${u.value}`);s.value&&(J.value=s.value,X.value=s.value.map(d=>d.name)),e.value&&(ce.value=!1,console.error("could not load specimens: ",e.value))},fe=async()=>{const{data:s,error:e}=await _.getDepartments(`${u.value}`);s.value&&(Z.value=s.value),e.value&&console.error("could not load departments: ",e.value)},ge=async()=>{const{data:s,error:e}=await _.getTestTypesIndicators(`${u.value}`);s.value&&(K.value=s.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function ee(s,e){try{const m=(p==null?void 0:p.value[s]).indicator_ranges;let r=0;if(m.length>0){const f=m.length-1;r=m[f].id}const v={id:r&&r+1,interpretation:""},h=e.toLowerCase();h.includes("numeric")?(v.age_max=0,v.age_min=0,v.upper_range=0,v.lower_range=0,v.gender={name:O.SELECT_GENDER}):(h=="auto complete"||h.includes("alpha"))&&(v.value=""),m.push(v)}catch(d){console.error("Error: ",d)}}const te=(s,e)=>{p.value[s].indicator_ranges.splice(e,1)},le=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ue},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},se=s=>new Set(["free text","rich text"]).has(s);async function ye(){b.value=!0;const s=p.value.map(g=>{const v=g.indicator_ranges.map(h=>{if(h.hasOwnProperty("gender")){const f=h;return{sex:f.gender.name,max_age:f.max_age,min_age:f.min_age,upper_range:f.upper_range,lower_range:f.lower_range,interpretation:f.interpretation}}else return delete h.id,h});return{...g,indicator_ranges:v,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${u.value}`,body:{name:D.value,short_name:N.value,sex:P.value,expected_turn_around_time:{value:A.value,unit:S.value.name},print_device:I.value,department_id:G.value.id,specimens:de(J.value,M.value),indicators:s,organisms:de(Q.value,$.value)}},{data:d,error:m,pending:r}=await Ge(e);b.value=r,d.value&&(oe(),y.push("/test-catalog/test-types?create=true"),b.value=!1),m.value&&(console.error("error creating test type: ",m.value),L().$toast.error(Oe),b.value=!1)}const he=s=>{const e=new Set(je);for(const d of s)if(d.type.name.toLowerCase()==="numeric"){for(const m of d.indicator_ranges)if(!e.has(m.gender.name.toLowerCase()))return L().$toast.warning(O.GENDER_REQUIRED),!1}return!0},xe=s=>s.name===Y?(L().$toast.warning(O.DURATION_REQUIRED),!1):!0,Ve=s=>{for(const e of s)if(e.type.name===ue)return L().$toast.warning(O.MEASURE_TYPE_REQUIRED),!1;return!0},be=()=>{const s=he(p.value),e=xe(S.value),d=Ve(p.value);return s&&e&&d};Ne(()=>p.value.map(s=>s.type),(s,e)=>{s!==e&&s.forEach((d,m)=>{if(d!==e[m]&&new Set(Ae).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[m].type.name;ee(m,g)}})},{deep:!0});const oe=()=>{Le("submitForm")};return ve(),fe(),ge(),_e(),le(),(s,e)=>{const d=Re,m=Fe,r=ae("FormKit"),g=Be,v=ae("multi-select"),h=We,f=Ye,Ee=He;return V(),E("div",Ze,[a(d,{pages:o(pe)},null,8,["pages"]),et,t("div",null,[U(t("div",tt,[a(m,{loading:o(b)},null,8,["loading"])],512),[[j,o(b)]]),U(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[10]||(e[10]=we=>be()&&ye()),actions:!1},{default:Me(({value:we})=>[t("div",lt,[t("div",st,[a(r,{type:"text",label:"Name",validation:"required",modelValue:o(D),"onUpdate:modelValue":e[0]||(e[0]=l=>x(D)?D.value=l:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:o(N),"onUpdate:modelValue":e[1]||(e[1]=l=>x(N)?N.value=l:null)},null,8,["modelValue"])]),t("div",ot,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:o(A),"onUpdate:modelValue":e[2]||(e[2]=l=>x(A)?A.value=l:null)},null,8,["modelValue"]),t("div",at,[nt,a(g,{items:o(me),modelValue:o(S),"onUpdate:modelValue":e[3]||(e[3]=l=>x(S)?S.value=l:null)},null,8,["items","modelValue"])])]),t("div",rt,[U(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>x(q)?q.value=l:null)},null,512),[[ne,o(q)]]),it]),U(t("div",ut,[dt,a(v,{style:{"--ms-max-height":"none !important"},modelValue:o($),"onUpdate:modelValue":e[5]||(e[5]=l=>x($)?$.value=l:null),options:o(z),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[j,o(q)]]),t("div",ct,[mt,a(v,{style:{"--ms-max-height":"none !important"},modelValue:o(M),"onUpdate:modelValue":e[6]||(e[6]=l=>x(M)?M.value=l:null),options:o(X),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",pt,[U(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>x(I)?I.value=l:null)},null,512),[[ne,o(I)]]),_t]),t("div",vt,[ft,a(g,{"is-searchable":!0,modelValue:o(G),"onUpdate:modelValue":e[8]||(e[8]=l=>x(G)?G.value=l:null),items:o(Z)},null,8,["modelValue","items"])]),a(h,{label:"Specific Sex","items-selected":o(P),"onUpdate:itemsSelected":e[9]||(e[9]=l=>x(P)?P.value=l:null),items:("GENDER"in s?s.GENDER:o(re)).map(l=>l.name),mode:"single"},null,8,["items-selected","items"]),t("div",gt,[a(f,{click:()=>{le()},color:"primary",text:"Add Measure",icon:o(ie)},null,8,["click","icon"])]),o(p).length!=0?(V(!0),E(B,{key:0},W(o(p),(l,T)=>(V(),E("div",{key:l.id,class:"border px-5 py-3 rounded"},[t("div",yt,[t("h3",ht," Measures ("+$e(T+1)+") ",1),t("button",{onClick:()=>{o(p).splice(T,1)}},[a(o(H),{class:"w-5 h-5"})],8,xt)]),t("div",Vt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l.name,"onUpdate:modelValue":n=>l.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[bt,a(g,{modelValue:l.type,"onUpdate:modelValue":n=>l.type=n,items:o(K)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:l.unit,"onUpdate:modelValue":n=>l.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:l.description,"onUpdate:modelValue":n=>l.description=n},null,8,["modelValue","onUpdate:modelValue"])]),se(l.type.name.toLowerCase())?k("",!0):(V(),Ie(f,{key:0,type:"button",click:()=>{ee(T,l.type.name)},color:"primary",text:"Add New Range",icon:o(ie)},null,8,["click","icon"])),l.indicator_ranges.length>0&&l.type.name==="Numeric"?(V(!0),E(B,{key:1},W(l.indicator_ranges,(n,F)=>(V(),E("div",{class:"w-full px-3 py-3",key:n.id},[t("div",Et,[t("div",wt,[t("div",St,[Tt,t("div",Rt,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":c=>n.min_age=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":c=>n.max_age=c},null,8,["modelValue","onUpdate:modelValue"]),t("div",Ut,[kt,a(g,{modelValue:n.gender,"onUpdate:modelValue":c=>n.gender=c,items:"GENDER"in s?s.GENDER:o(re)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",Ct,[Dt,t("div",Nt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":c=>n.upper_range=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":c=>n.lower_range=c},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":c=>n.interpretation=c},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:c=>te(T,F)},[a(o(H),{class:"w-5 h-5"})],8,At)])]))),128)):k("",!0),l.indicator_ranges.length>0&&l.type.name=="Auto Complete"||l.type.name==="Alpha Numeric"?(V(!0),E(B,{key:2},W(l.indicator_ranges,(n,F)=>(V(),E("div",{class:"px-3 py-3",key:n.id},[t("div",Mt,[t("div",$t,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":c=>n.value=c},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":c=>n.interpretation=c},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:c=>te(T,F),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(o(H),{class:"w-5 h-5"})],8,It)])]))),128)):k("",!0),se(l.type.name.toLowerCase())?(V(),E("div",qt,[a(o(Qe),{class:"w-5 h-5 mr-2"}),qe(" A text box will appear for results entry ")])):k("",!0)]))),128)):k("",!0)]),t("div",Pt,[a(Ee,{type:"button",click:()=>{oe()},text:"Clear form"},null,8,["click"]),a(f,{type:"submit",click:()=>{},loading:o(b),color:"success",icon:o(ze),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[j,!o(b)]])])])}}});export{sl as default};
