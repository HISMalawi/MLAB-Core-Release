var be=Object.defineProperty;var Ee=(w,y,u)=>y in w?be(w,y,{enumerable:!0,configurable:!0,writable:!0,value:u}):w[y]=u;var U=(w,y,u)=>Ee(w,typeof y!="symbol"?y+"":y,u);import{_ as we}from"./D-VwM6QD.js";import{d as Te,E as Se,a as Ue,r as i,w as ke,m as le,b as x,e as E,f as a,h as l,g as t,i as k,v as F,n as Re,y as V,U as ae,F as Y,j,t as Ce,x as Me,s as R,p as Ae,u as O,az as Ne,k as De,_ as Ie}from"./Cg5p-McN.js";import{_ as $e}from"./CsQFVusk.js";import{_ as qe}from"./CqDTxBUP.js";import{T as Pe,b as B,M as Oe,G as Ge,f as Le,g as G,h as ne,e as Fe,i as Ye}from"./RKiNshLb.js";import{e as C,r as re,d as ie,f as je}from"./DR38mcEF.js";import{H as Be}from"./CGvpn_em.js";import{r as W}from"./aBMXVFc4.js";import{r as We}from"./DkvBJ1ni.js";import{r as Qe}from"./dK18VoWV.js";import"./sm8AiluA.js";import"./BAL5lcly.js";import"./TTHnbI5R.js";import"./84ogm7K5.js";import"./BGlWJtXj.js";import"./CN2A0733.js";import"./Dj-q_rGi.js";import"./CyrOhIst.js";import"./3LKeHVyH.js";import"./D1U45QuX.js";import"./D-clyhuy.js";import"./Cjc4v2I0.js";import"./BVCtdeh2.js";class He extends Be{constructor(){super(...arguments);U(this,"ORGANISMS",C.organisms);U(this,"SPECIMENS",C.specimens);U(this,"DEPARTMENTS",C.departments);U(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(u){const _={route:this.ORGANISMS,method:"GET",token:`${u}`};return this.call(_)}async getSpecimens(u){const _={route:this.SPECIMENS,method:"GET",token:`${u}`};return this.call(_)}async getDepartments(u){const _={route:this.DEPARTMENTS,method:"GET",token:`${u}`};return this.call(_)}async getTestTypesIndicators(u){const _={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${u}`};return this.call(_)}}const Ke=He,ze={class:"px-5 py-5"},Je=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1),Xe={class:"flex items-center justify-center mx-auto my-20"},Ze={class:"mt-2 space-y-3"},et={class:"grid grid-cols-2 gap-4"},tt={class:"w-full flex items-center"},ot={class:"py-1 ml-2 flex flex-col space-y-2"},st=t("p",{class:"font-medium text-base"},"Duration",-1),lt={class:"w-full flex items-center space-x-2"},at=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1),nt={class:"w-full flex flex-col space-y-2"},rt=t("label",{class:"font-medium"},"Organisms",-1),it={class:"w-full flex flex-col space-y-2"},ut=t("label",{class:"font-medium"},"Specimens",-1),dt={class:"w-full flex items-center space-x-2"},mt=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1),ct={class:"w-full flex flex-col space-y-2"},pt=t("label",{class:"font-medium"},"Lab section",-1),_t={class:"w-full flex"},vt={class:"py-3 flex items-center justify-between"},ft={class:"text-lg text-grameasuresy-700 font-semibold"},gt=["onClick"],yt={class:"grid grid-cols-4 gap-2 mb-3"},ht=t("p",{class:"font-medium mb-2"},"Type",-1),xt={class:"flex items-center space-x-3"},Vt={class:"grid grid-cols-2 gap-2"},bt={class:""},Et=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1),wt={class:"grid grid-cols-2 gap-2"},Tt={class:"flex flex-col"},St=t("label",{class:"font-medium"},"Sex",-1),Ut={class:""},kt=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1),Rt={class:"grid grid-cols-2 gap-2"},Ct=["onClick"],Mt={class:"w-full flex items-center justify-center space-x-2"},At={class:"w-full grid grid-cols-2 gap-4"},Nt=["onClick"],Dt={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},It={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},no=Te({__name:"index",setup(w){const y=Se(),u=Ue("token"),_=new Ke,ue=i(!1),p=i([]),M=i(""),A=i(""),N=i(""),Q=i([]),b=i(!1),D=i([]),H=i([]),K=i([]),I=i([]),$=i(!1),q=i(!1),de=i(Pe),T=i({name:B}),z=i([]),J=i([]),X=i([]),P=i({name:B}),me=Le,ce=async()=>{const{data:o,error:e}=await _.getOrganisms(`${u.value}`);o.value&&(H.value=o.value,K.value=o.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},pe=async()=>{const{data:o,error:e}=await _.getSpecimens(`${u.value}`);o.value&&(z.value=o.value,J.value=o.value.map(d=>d.name)),e.value&&(ue.value=!1,console.error("could not load specimens: ",e.value))},_e=async()=>{const{data:o,error:e}=await _.getDepartments(`${u.value}`);o.value&&(X.value=o.value),e.value&&console.error("could not load departments: ",e.value)},ve=async()=>{const{data:o,error:e}=await _.getTestTypesIndicators(`${u.value}`);o.value&&(Q.value=o.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function Z(o,e){try{const c=(p==null?void 0:p.value[o]).indicator_ranges;let r=0;if(c.length>0){const h=c.length-1;r=c[h].id}const v={id:r&&r+1,interpretation:""},f=e.toLowerCase();f.includes("numeric")?(v.age_max=0,v.age_min=0,v.upper_range=0,v.lower_range=0,v.gender={name:G.SELECT_GENDER}):(f=="auto complete"||f.includes("alpha"))&&(v.value=""),c.push(v)}catch(d){console.error("Error: ",d)}}const ee=(o,e)=>{p.value[o].indicator_ranges.splice(e,1)},te=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ne},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},oe=o=>new Set(["free text","rich text"]).has(o);async function fe(){b.value=!0;const o=p.value.map(g=>{const v=g.indicator_ranges.map(f=>{if(f.hasOwnProperty("gender")){const h=f;return{sex:h.gender.name,max_age:h.max_age,min_age:h.min_age,upper_range:h.upper_range,lower_range:h.lower_range,interpretation:h.interpretation}}else return delete f.id,f});return{...g,indicator_ranges:v,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${u.value}`,body:{name:M.value,short_name:A.value,expected_turn_around_time:{value:N.value,unit:T.value.name},print_device:$.value,department_id:P.value.id,specimens:ie(z.value,D.value),indicators:o,organisms:ie(H.value,I.value)}},{data:d,error:c,pending:r}=await je(e);b.value=r,d.value&&(se(),y.push("/test-catalog/test-types?create=true"),b.value=!1),c.value&&(console.error("error creating test type: ",c.value),O().$toast.error(Fe),b.value=!1)}const ge=o=>{const e=new Set(Ye);for(const d of o)if(d.type.name.toLowerCase()==="numeric"){for(const c of d.indicator_ranges)if(!e.has(c.gender.name.toLowerCase()))return O().$toast.warning(G.GENDER_REQUIRED),!1}return!0},ye=o=>o.name===B?(O().$toast.warning(G.DURATION_REQUIRED),!1):!0,he=o=>{for(const e of o)if(e.type.name===ne)return O().$toast.warning(G.MEASURE_TYPE_REQUIRED),!1;return!0},xe=()=>{const o=ge(p.value),e=ye(T.value),d=he(p.value);return o&&e&&d};ke(()=>p.value.map(o=>o.type),(o,e)=>{o!==e&&o.forEach((d,c)=>{if(d!==e[c]&&new Set(Oe).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[c].type.name;Z(c,g)}})},{deep:!0});const se=()=>{Ne("submitForm")};return pe(),_e(),ve(),ce(),te(),(o,e)=>{const d=we,c=De,r=le("FormKit"),g=$e,v=le("multi-select"),f=Ie,h=qe;return x(),E("div",ze,[a(d,{pages:l(me)},null,8,["pages"]),Je,t("div",null,[k(t("div",Xe,[a(c,{loading:l(b)},null,8,["loading"])],512),[[F,l(b)]]),k(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[9]||(e[9]=Ve=>xe()&&fe()),actions:!1},{default:Re(({value:Ve})=>[t("div",Ze,[t("div",et,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l(M),"onUpdate:modelValue":e[0]||(e[0]=s=>V(M)?M.value=s:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:l(A),"onUpdate:modelValue":e[1]||(e[1]=s=>V(A)?A.value=s:null)},null,8,["modelValue"])]),t("div",tt,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:l(N),"onUpdate:modelValue":e[2]||(e[2]=s=>V(N)?N.value=s:null)},null,8,["modelValue"]),t("div",ot,[st,a(g,{items:l(de),modelValue:l(T),"onUpdate:modelValue":e[3]||(e[3]=s=>V(T)?T.value=s:null)},null,8,["items","modelValue"])])]),t("div",lt,[k(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=s=>V(q)?q.value=s:null)},null,512),[[ae,l(q)]]),at]),k(t("div",nt,[rt,a(v,{style:{"--ms-max-height":"none !important"},modelValue:l(I),"onUpdate:modelValue":e[5]||(e[5]=s=>V(I)?I.value=s:null),options:l(K),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[F,l(q)]]),t("div",it,[ut,a(v,{style:{"--ms-max-height":"none !important"},modelValue:l(D),"onUpdate:modelValue":e[6]||(e[6]=s=>V(D)?D.value=s:null),options:l(J),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",dt,[k(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=s=>V($)?$.value=s:null)},null,512),[[ae,l($)]]),mt]),t("div",ct,[pt,a(g,{"is-searchable":!0,modelValue:l(P),"onUpdate:modelValue":e[8]||(e[8]=s=>V(P)?P.value=s:null),items:l(X)},null,8,["modelValue","items"])]),t("div",_t,[a(f,{click:()=>{te()},color:"primary",text:"Add Measure",icon:l(re)},null,8,["click","icon"])]),l(p).length!=0?(x(!0),E(Y,{key:0},j(l(p),(s,S)=>(x(),E("div",{key:s.id,class:"border px-5 py-3 rounded"},[t("div",vt,[t("h3",ft," Measures ("+Ce(S+1)+") ",1),t("button",{onClick:()=>{l(p).splice(S,1)}},[a(l(W),{class:"w-5 h-5"})],8,gt)]),t("div",yt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:s.name,"onUpdate:modelValue":n=>s.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[ht,a(g,{modelValue:s.type,"onUpdate:modelValue":n=>s.type=n,items:l(Q)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:s.unit,"onUpdate:modelValue":n=>s.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:s.description,"onUpdate:modelValue":n=>s.description=n},null,8,["modelValue","onUpdate:modelValue"])]),oe(s.type.name.toLowerCase())?R("",!0):(x(),Me(f,{key:0,type:"button",click:()=>{Z(S,s.type.name)},color:"primary",text:"Add New Range",icon:l(re)},null,8,["click","icon"])),s.indicator_ranges.length>0&&s.type.name==="Numeric"?(x(!0),E(Y,{key:1},j(s.indicator_ranges,(n,L)=>(x(),E("div",{class:"w-full px-3 py-3",key:n.id},[t("div",xt,[t("div",Vt,[t("div",bt,[Et,t("div",wt,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":m=>n.min_age=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":m=>n.max_age=m},null,8,["modelValue","onUpdate:modelValue"]),t("div",Tt,[St,a(g,{modelValue:n.gender,"onUpdate:modelValue":m=>n.gender=m,items:"GENDER"in o?o.GENDER:l(Ge)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",Ut,[kt,t("div",Rt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":m=>n.upper_range=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":m=>n.lower_range=m},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>ee(S,L)},[a(l(W),{class:"w-5 h-5"})],8,Ct)])]))),128)):R("",!0),s.indicator_ranges.length>0&&s.type.name=="Auto Complete"||s.type.name==="Alpha Numeric"?(x(!0),E(Y,{key:2},j(s.indicator_ranges,(n,L)=>(x(),E("div",{class:"px-3 py-3",key:n.id},[t("div",Mt,[t("div",At,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":m=>n.value=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>ee(S,L),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(l(W),{class:"w-5 h-5"})],8,Nt)])]))),128)):R("",!0),oe(s.type.name.toLowerCase())?(x(),E("div",Dt,[a(l(We),{class:"w-5 h-5 mr-2"}),Ae(" A text box will appear for results entry ")])):R("",!0)]))),128)):R("",!0)]),t("div",It,[a(h,{type:"button",click:()=>{se()},text:"Clear form"},null,8,["click"]),a(f,{type:"submit",click:()=>{},loading:l(b),color:"success",icon:l(Qe),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[F,!l(b)]])])])}}});export{no as default};
