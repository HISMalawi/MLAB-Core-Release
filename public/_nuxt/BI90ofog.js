import{_ as q}from"./BJooVA_-.js";import{M as j,a as B,C as k,P as I,l as F,m as E,Z as V,a5 as N,x as U,y as M,b as a,e as p,f as h,g as e,j as y,t as n,i as P,aA as Y,L as H,K as g,h as x,O as A,F as v,k as T,v as L,_ as G,n as Z}from"./CYcp6nS7.js";import{_ as K}from"./CY3odhSs.js";import{u as Q}from"./Bb40XinX.js";import{P as X}from"./lDJ8LIwH.js";import{u as J}from"./CySQNWaz.js";import{r as W}from"./Di9J9FJg.js";import{r as $}from"./Bh20xM4C.js";import{r as ee}from"./DD1XQcSB.js";import{r as te}from"./B576kTo_.js";import{_ as se}from"./C7TiL_M-.js";import"./CiPuaXMZ.js";import"./BD7R0M9r.js";const re={name:"PatientReport",components:{UserIcon:W,QrCodeIcon:$,FunnelIcon:ee},setup(){J({title:`${X.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:j,refreshIcon:te,cookie:B("token"),moment:k,facility:Q(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String((this._.provides[I]||this.$route).query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(s=>{(s.identifier_type==="current_traditional_authority"||s.identifier_type==="physical_address")&&(this.physicalAddress=s.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){var d;this.loading=!0;const s=(d=(this._.provides[I]||this.$route).query.order_id)==null?void 0:d.toString(),t=this.dateRange!==null&&this.dateRange.length>0&&k(this.dateRange[0]).isValid()?k(this.dateRange[0]).format("YYYY-MM-DD"):"",i=this.dateRange!==null&&this.dateRange.length>1&&k(this.dateRange[1]).isValid()?k(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,s!=null){const r={route:`${F.tests}/${this.patientId}/report?order_id=${s}&from=${t}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:_,pending:R}=await E(r);if(this.loading=R,o.value){this.loading=!1,this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let D=o.value.orders.map(m=>{let b=0;return m.tests!==void 0&&(b+=m.tests.filter(w=>w.status.toLowerCase()==="verified").length),{...m,tests_verified:b}});this.reportData=D,this.showPrinterDialog()}_.value&&(this.loading=!1,console.error(_.value))}else{const r={route:`${F.tests}/${this.patientId}/report?from=${t}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:_,pending:R}=await E(r);if(this.loading=R,o.value){this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let D=o.value.orders.map(m=>{let b=0;return m.tests!==void 0&&(b+=m.tests.filter(w=>w.status.toLowerCase()==="verified").length),{...m,tests_verified:b}});this.reportData=D,this.loading=!1,this.showPrinterDialog()}_.value&&(console.error(_.value),this.loading=!1)}},getOrderStatusInitiatorName(s){const t=["specimen-accepted","specimen-rejected"],i=s.find(d=>t.includes(d.status.name));return i?`${i.initiator.first_name} ${i.initiator.last_name}`:""},getOrderStatus(s){return s!==null?V(s.split("-").join(" ")):""},getTestStatusInitiatorName(s,t){const i=s.find(d=>t===d.status.name);return i?{name:`${i.initiator.first_name} ${i.initiator.last_name}`,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(s){return s.map(t=>t.name).join(", ")},getDepartments(s){return[...new Set(s.map(i=>i.department))].join(", ")},getAuthorizedTestCount(s){return s.reduce((t,i)=>t+i.tests_verified,0)},showIndicatorRanges(s){return s.some(t=>t.test_indicator_type==="numeric")},getTestStatusName(s){return s=="verified"?s="Authorized":s=s.split("-").map(t=>this.capitalizeStr(t)).join(" "),s},capitalizeStr(s){return s.charAt(0).toUpperCase()+s.slice(1)},updateReport(s){s&&this.init()},checkSusceptibilityResults(s){return s.tests.some(t=>t.suscept_test_result.length!==0)},getFilteredDrugs(s){return s.filter(t=>t.zone!==null)},showResult(s,t){return t.length>0&&s.toLowerCase()==="growth"?`Growth of ${[...new Set(t)].map(i=>i.name).join(", ")}`:s},shouldPrintSmallLabel(s){return s.some(t=>t.test_types.some(i=>i.print_device))},getSmallLabelPrintTests(s){const t=[],i=new Set;return s.forEach(d=>{d.test_types.forEach(r=>{r.print_device&&i.add(r.name)})}),s.forEach(d=>{d.tests.forEach(r=>{i.has(r.test_type_name)&&t.push(String(r.id))})}),t},getPrintCount(s){return s.reduce((t,i)=>t+i.print_count,0)},getRequiredRange(s,t){const i=s.sex=="M"?"Male":"Female",d=Math.ceil(Number(N(s.date_of_birth)==0?1:Number(N(s.date_of_birth))));return t.filter(r=>r.sex===i&&d>Number(r.min_age)&&d<Number(r.max_age)||r.sex==="Both"&&d>Number(r.min_age)&&d<Number(r.max_age))[0]},shouldDisplayRange(s,t,i){let d=null;return this.showIndicatorRanges(s)&&(d=this.getRequiredRange(t,i.indicator_ranges)),d},getMachineName(s){return s[0].result.machine_name},getCompletedTests(s){const t=new Set(["completed","verified"]);return s.filter(i=>t.has(i.status.toLowerCase()))},showPrinterDialog(){this.$nextTick(()=>{var s;((s=(this._.provides[I]||this.$route).query.printer)==null?void 0:s.toString())=="true"&&this.$refs.corePrinter.init()})}}},oe=""+new URL("medical-record.B8XPaMkU.png",import.meta.url).href,ne={class:"py-5 px-5"},ie={class:"flex items-center py-5"},le={class:"text-2xl font-semibold uppercase",style:{"font-size":"24px","line-height":"2rem"}},ae={class:"text-sky-500 text-2xl",style:{"font-size":"24px","line-height":"2rem"}},de={class:"mt-2 space-y-3"},pe={class:"w-full flex items-center justify-between"},ue={class:"flex items-center space-x-5"},ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},me={class:"w-72 ml-2"},_e={class:"flex items-center space-x-2"},be={key:0,class:"border rounded print-container mt-10"},fe={class:"rounded-tr rounded-tl border-b px-5 py-5"},he={class:"flex items-center justify-between"},ye={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},ge={class:"font-normal"},xe={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted",style:{"font-size":"20px","line-height":"2rem"}},ve={class:"flex items-center not-italic text-gray-600"},Te={class:"flex items-center not-italic text-gray-600"},Re={class:"flex items-center justify-between mt-5"},De={class:"w-full mt-2"},we={class:"border px-2 py-2"},ke={class:"border px-2 py-2"},Ae={class:"border px-2 py-2"},Se={class:"border px-2 py-2"},Ie={class:"border px-2 py-2",colspan:"2"},Me={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Pe={class:"flex items-center"},Ne={class:"border-collapse border-slate-500 w-full"},Ce={class:"border-b border-r px-2 py-2"},Fe={class:"border-b px-2 py-2"},Ee={class:"border-b border-r px-2 py-2"},Le={class:"border-b px-2 py-2"},Oe={class:"border-b border-r px-2 py-2"},ze={class:"border-b px-2 py-2"},qe={class:"border-collapse w-full"},je={class:"bg-gray-100 text-gray-600"},Be={colspan:3,class:"px-2 py-2 text-lg font-semibold"},Ve={class:"border px-2 py-2 text-left"},Ue={class:"p-0 border-b",style:{padding:"0 !important"}},Ye={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},He={class:"border-b"},Ge={class:"border-r px-2 py-2"},Ze={class:"px-2 py-2 flex items-center border-r"},Ke=["innerHTML"],Qe={key:0},Xe={class:"px-2"},Je={key:0,class:"border-t border-l px-2 py-2 font-bold"},We={key:1,class:"border px-2 py-2"},$e={class:"border px-2 py-2"},et=["innerHTML"],tt={class:"border px-2 py-2"},st={class:"test-status"},rt={class:"px-2"},ot={class:"px-2"},nt={class:"px-2"},it={key:0},lt={class:"px-2"},at={class:"px-2 mb-2"},dt={key:0,class:"mb-2"},pt={class:"m-2"},ut={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},ct={class:"w-full"},mt={classs:"border-l border-r"},_t={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},bt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},ft={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},ht={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"};function yt(s,t,i,d,r,o){const _=q,R=M("FunnelIcon"),D=M("datepicker"),m=G,b=K,w=M("barcode"),O=Z;return a(),p("div",ne,[h(_,{pages:r.pages},null,8,["pages"]),e("div",ie,[t[3]||(t[3]=e("img",{src:oe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),e("h3",le,[t[2]||(t[2]=y(" patient report for ")),e("span",ae,'"'+n(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`)+'"',1)])]),e("div",de,[e("div",pe,[e("div",ue,[e("div",ce,[h(R,{class:"w-5 h-5 mr-2"}),t[4]||(t[4]=y(" Filter By Date Range ")),e("div",me,[h(D,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r.dateRange,"onUpdate:modelValue":t[0]||(t[0]=u=>r.dateRange=u)},null,8,["modelValue"])])]),e("div",_e,[P(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=u=>r.showPendingTests=u)},null,512),[[Y,r.showPendingTests]]),t[5]||(t[5]=e("label",null,"Include pending tests",-1))]),h(m,{loading:r.loading,color:"primary",text:"Generate Report",icon:r.refreshIcon,click:()=>o.init()},null,8,["loading","icon","click"])]),e("div",null,[o.getAuthorizedTestCount(r.reportData)>0?(a(),H(b,{key:0,"print-small-label":o.shouldPrintSmallLabel(r.reportData),id:o.patientId,orderId:o.orderId,tests:o.getSmallLabelPrintTests(r.reportData),orderTests:r.reportData[0].tests,onUpdate:o.updateReport,ref:"corePrinter"},null,8,["print-small-label","id","orderId","tests","orderTests","onUpdate"])):g("",!0)])]),r.reportData.length>0?(a(),p("div",be,[e("div",fe,[e("div",he,[t[6]||(t[6]=e("div",{class:"flex items-center space-x-2"},[e("img",{src:se,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold",style:{"font-size":"24px","line-height":"2rem"}}," PATIENT REPORT ")],-1)),e("div",null,[h(w,{value:r.reportData[0].accession_number,"display-value":!1,height:50},null,8,["value"])]),e("div",ye,[e("address",ge,[e("span",xe,n(r.facility.details.name),1),e("span",ve,n(r.facility.details.address),1),e("span",Te,n(r.facility.details.phone),1)])])]),e("div",Re,[e("div",null,[t[7]||(t[7]=e("span",{class:"font-medium"},"Report Date:",-1)),y(" "+n(r.moment(new Date).format("DATE_FORMAT"in s?s.DATE_FORMAT:x(A))),1)]),e("div",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"No. Printed:",-1)),y(" "+n(o.getPrintCount(r.reportData)),1)]),e("div",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"Date Sample Collected:",-1)),y(" "+n(r.reportData.length>0&&r.moment(r.reportData[0].sample_collection_time).format("DATE_FORMAT"in s?s.DATE_FORMAT:x(A))),1)])]),e("table",De,[e("tbody",null,[e("tr",null,[t[10]||(t[10]=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1)),e("td",we,n(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`),1),t[11]||(t[11]=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1)),e("td",ke,n(r.person.sex==="F"?"Female":"Male"),1),t[12]||(t[12]=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1)),e("td",Ae,n(("calculateAge"in s?s.calculateAge:x(N))(r.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[t[13]||(t[13]=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1)),e("td",Se,n(r.person.id),1),t[14]||(t[14]=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1)),e("td",Ie,n(o.getPhysicalAddress),1)])])])]),(a(!0),p(v,null,T(r.reportData,(u,z)=>(a(),p("div",{key:z},[e("div",Me,[e("div",Pe," Accession No: "+n(u.accession_number),1),e("div",null," Requested By: "+n(u.requested_by)+" ("+n(u.requesting_ward)+") ",1)]),e("table",Ne,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1)),e("td",Ce,n(u.specimen),1),t[16]||(t[16]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1)),e("td",Fe,n(r.moment(u.created_date).format("DATE_FORMAT"in s?s.DATE_FORMAT:x(A))),1)]),e("tr",null,[t[17]||(t[17]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1)),e("td",Ee,n(o.getTestTypes(u.test_types)),1),t[18]||(t[18]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1)),e("td",Le,n(o.getDepartments(u.test_types)),1)]),e("tr",null,[t[19]||(t[19]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1)),e("td",Oe,n(o.getOrderStatus(u.order_status)),1),t[20]||(t[20]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1)),e("td",ze,n(o.getOrderStatusInitiatorName(u.order_status_trail)),1)])])]),e("table",qe,[e("thead",null,[e("tr",je,[t[21]||(t[21]=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1)),e("th",Be," Tests Authorized("+n(u.tests_verified)+") ",1)])]),e("tbody",null,[t[26]||(t[26]=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1)),(a(!0),p(v,null,T(r.showPendingTests?u.tests:o.getCompletedTests(u.tests),l=>(a(),p("tr",{key:l.id},[e("td",Ve,n(l.test_type_name),1),e("td",Ue,[e("table",Ye,[t[22]||(t[22]=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Units "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1)),e("tbody",He,[(a(!0),p(v,null,T(l.indicators,(c,S)=>{var f,C;return a(),p("tr",{key:S,class:"border-b"},[e("td",Ge,n(c.name),1),e("td",Ze,[e("p",{innerHTML:o.showResult(((f=c.result)==null?void 0:f.value)??"",l==null?void 0:l.suscept_test_result)},null,8,Ke),(C=c.result)!=null&&C.value?g("",!0):(a(),p("span",Qe,"Not done"))]),e("td",Xe,n(c==null?void 0:c.unit),1),o.shouldDisplayRange(l.indicators,r.person,c)!==void 0&&o.shouldDisplayRange(l.indicators,r.person,c)!==null?(a(),p("td",Je," ("+n(o.shouldDisplayRange(l.indicators,r.person,c).lower_range)+" - "+n(o.shouldDisplayRange(l.indicators,r.person,c).upper_range)+") ",1)):(a(),p("td",We))])}),128))])])]),e("td",$e,[e("p",{innerHTML:l!=null&&l.result_remarks?l==null?void 0:l.result_remarks.value:"N/A"},null,8,et)]),e("td",tt,[e("div",st,[t[23]||(t[23]=e("p",{class:"font-bold"},"Test Status",-1)),e("p",rt,n(o.getTestStatusName(l.status)),1),e("p",ot," By: "+n(o.getTestStatusInitiatorName(l.status_trail,l.status).name),1),e("p",nt," On: "+n(r.moment(o.getTestStatusInitiatorName(l.status_trail,l.status).created_at).format("DATE_FORMAT"in s?s.DATE_FORMAT:x(A))),1)]),o.getTestStatusInitiatorName(l.status_trail,"completed").name?(a(),p("div",it,[t[25]||(t[25]=e("p",{class:"font-bold"},"Performed By",-1)),e("p",lt,n(o.getTestStatusInitiatorName(l.status_trail,"completed").name),1),e("p",at," On: "+n(r.moment(o.getTestStatusInitiatorName(l.status_trail,"completed").created_at).format("DATE_FORMAT"in s?s.DATE_FORMAT:x(A))),1),o.getMachineName(l.indicators)?(a(),p("div",dt,[t[24]||(t[24]=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1)),e("p",null,n(o.getMachineName(l.indicators)),1)])):g("",!0)])):g("",!0)])]))),128))])]),P(e("div",pt,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1)),e("div",null,[(a(!0),p(v,null,T(u.tests,l=>(a(),p("div",{class:"grid grid-cols-2 gap-4",key:l.id},[l.test_type_name.toLowerCase().includes("culture")?(a(!0),p(v,{key:0},T(l.suscept_test_result,(c,S)=>(a(),p("div",{key:S},[e("div",ut,n(c.name),1),e("table",ct,[t[27]||(t[27]=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1)),e("tbody",mt,[(a(!0),p(v,null,T(o.getFilteredDrugs(c.drugs),f=>(a(),p("tr",{key:f.drug_id},[e("th",_t,n(f.name),1),e("th",bt,n(f.zone),1),e("th",ft,n(f.interpretation),1)]))),128))])])]))),128)):g("",!0)]))),128))])],512),[[L,o.checkSusceptibilityResults(u)]])]))),128))])):g("",!0),e("div",null,[P(e("div",ht,[h(O),t[29]||(t[29]=e("p",{class:"text-base"},[y(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1))],512),[[L,r.loading]])])])])}const Nt=U(re,[["render",yt]]);export{Nt as default};
