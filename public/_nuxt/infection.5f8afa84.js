import{_ as oe}from"./Breadcrumb.vue.29096239.js";import{_ as ne}from"./Dropdown.b76af8d6.js";import{m as le,u as ae,s as b,a as ce,I as G,g as O,o as v,c as T,d as _,l as r,e as s,t as g,h as F,i as M,y as w,F as ie,r as de,n as pe,k as V,w as _e,v as ue,b as B,f as me}from"./entry.8b130418.js";import{_ as fe}from"./ExportButton.vue.2aea1df0.js";import{_ as be}from"./Address.vue.b3425546.js";import{_ as ge}from"./Loader.d7f1913d.js";import{e as he}from"./constants.71ae81d4.js";import{_ as ye}from"./report.f12e8797.js";import{_ as xe}from"./logo.7772852c.js";import{_ as Ee}from"./page.ae16c829.js";import{h,f as j,e as I}from"./fetch.6ed6d8be.js";import{k as ve}from"./vue-doc-download.83ac7e78.js";import{P as Te}from"./package.651db5f9.js";import{u as Se}from"./facility.89075c79.js";import{r as Re}from"./FunnelIcon.d3368d75.js";import{r as Le}from"./ArrowPathIcon.f2fac6c8.js";import"./nuxt-link.a6b19347.js";import"./HomeIcon.75dd900a.js";import"./listbox.232a252f.js";import"./hidden.94b93f99.js";import"./use-text-value.d90f1789.js";import"./CheckIcon.54595a00.js";import"./CheckCircleIcon.78765db9.js";import"./MagnifyingGlassIcon.a1000dd2.js";import"./network.9f9ddcab.js";import"./transition.0c9cdf07.js";import"./XMarkIcon.2df3c244.js";import"./PencilSquareIcon.e8095535.js";import"./PrinterIcon.55ff5c9e.js";const Me={class:"px-5 py-5"},Ye={class:"flex items-center py-5"},Ne=s("img",{src:ye,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ke={class:"text-2xl font-semibold uppercase"},Ue={class:"w-full flex items-center justify-between mb-5"},Ae={class:"w-full flex items-center space-x-3"},Ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},$e={class:"w-72 ml-2"},We={class:"w-40"},Ge={class:"w-48 flex items-end justify-end"},Oe={class:"rounded border"},Fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},we=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:xe,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold uppercase"}," INFECTION REPORT ")],-1),Ve={key:0,id:"print-container"},Be={class:"hidden"},je=s("h3",null,"INFECTION REPORT",-1),Ie={class:"text-lg font-semibold py-2 px-2"},Pe={class:"text-normal font-normal"},He=["innerHTML"],qe=s("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"Summary",-1),Ke={class:"w-full border-t"},ze=s("thead",null,[s("tr",{class:"border-b border-t bg-gray-100"},[s("th",{class:"px-2 py-2 border-r text-left"},"Tests"),s("th",{class:"px-2 py-2 text-left"},"Total")])],-1),Je={class:"px-2 py-2 border-r border-b"},Qe={class:"px-2 py-2 border-r border-b"},Xe={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Ze=s("img",{src:Ee,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),De=s("p",{class:"text-base"},"Data not found, please generate report",-1),et=[Ze,De],tt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},st=s("p",{class:"text-base"},[M("Generating report, please wait"),s("span",{class:"animate-ping"},"...")],-1),$t=le({__name:"infection",setup(rt){ae({title:`${Te.name.toUpperCase()} - Infection Report`});const P=b("Infection Report"),H=b([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),S=b([]),x=b({id:0,name:"select department"}),Y=ce("token"),m=b(!1),L=Se(),R=b([]),N=b([]),n=b(new Array("","")),k=G(()=>n.value[0]?h(n.value[0]).format("YYYY-MM-DD"):""),U=G(()=>n.value[1]?h(n.value[1]).format("YYYY-MM-DD"):""),q=()=>{n.value=new Array("","")},K=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',c=(o,e,l)=>{const a=o.indexOf(e);return a!==-1?o.slice(0,a)+l+o.slice(a+e.length):o},z=o=>{let e="",l="",a="",d="",f=0,u=0,i=0,p=0,y=0;return o.reduce((t,A)=>{const D=A.measures.flatMap(C=>C.results.flatMap($=>{const W=Object.keys($[0])[0],ee=$[0][W];return Object.entries(ee).map(([te,se])=>{const re=se;return{test_type:A.test_type,measure:C.name,result:W,gender:te==="F"?"Female":"Male",...re}})}));return t.push(...D),t},new Array).forEach(t=>{u++,i++,f++,a===t.test_type?(e+="<tr>",l!==t.measure?(l=t.measure,d=t.result,e=c(e,"NEW_MEASURE",u.toString()),e=e.replace("NEW_RESULT",i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),u=0,i=0,p=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):d!==t.result&&(e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),d=t.result,i=0,p=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(a=t.test_type,l=t.measure,d=t.result,e=e.replace(/NEW_TEST/g,f.toString()),e=c(e,"NEW_MEASURE",u.toString()),e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),u=0,i=0,p=0,f=0,y=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.L_E_5?t.L_E_5:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_5_L_E_14?t.G_5_L_E_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_14?t.G_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0)).toString()+"</td>",p+=(t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0),d===t.result&&i==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),u==0&&(y=t.L_E_5+t.G_5_L_E_14+t.G_14)}),e=c(e,"NEW_TEST",(++f).toString()),e=c(e,"NEW_MEASURE",(++u).toString()),e=c(e,"NEW_RESULT",(++i).toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),e+="</tr>",e},J=o=>{const e=K(),l=o.length>0?z(o):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${l}</table>`};async function Q(){const{data:o,error:e}=await j({route:`${I.departments}`,method:"GET",token:`${Y.value}`});o.value&&(S.value=o.value,S.value.some(l=>l.id===0)||S.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function X(){if(Z())B().$toast.warning("Please select a department");else{m.value=!0;let o=n.value[0].toString()!=""?h(n.value[0].toString()).format("YYYY-MM-DD"):"",e=n.value[1].toString()!=""?h(n.value[1].toString()).format("YYYY-MM-DD"):"";const l={route:`${I.aggregateReports}infection?from=${o}&to=${e}&department=${x.value.id}`,method:"GET",token:`${Y.value}`},{data:a,error:d,pending:f}=await j(l);m.value=f,a.value&&(m.value=!1,R.value=a.value.data,N.value=a.value.summary),d.value&&(console.error(d.value),m.value=!1,B().$toast.error(he))}}function Z(){return x.value.name=="select department"}return Q(),(o,e)=>{const l=oe,a=O("datepicker"),d=ne,f=me,u=O("FormKit"),i=fe,p=be,y=ge;return v(),T("div",Me,[_(l,{pages:r(H)},null,8,["pages"]),s("div",Ye,[Ne,s("h3",ke,g(r(P)),1)]),s("div",Ue,[_(u,{type:"form","submit-label":"Update",onSubmit:X,actions:!1,id:"submitForm"},{default:F(({value:E})=>[s("div",Ae,[s("div",Ce,[_(r(Re),{class:"w-5 h-5 mr-2"}),M(" Filter By Date Range "),s("div",$e,[_(a,{onCleared:q,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r(n),"onUpdate:modelValue":e[0]||(e[0]=t=>w(n)?n.value=t:null)},null,8,["modelValue"])])]),s("div",We,[_(d,{items:r(S),modelValue:r(x),"onUpdate:modelValue":e[1]||(e[1]=t=>w(x)?x.value=t:null)},null,8,["items","modelValue"])]),s("div",null,[_(f,{loading:r(m),color:"primary",type:"submit",text:"Generate Report",icon:r(Le),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),s("div",Ge,[_(r(ve),{element:"print-container",filename:`infection_report_from_${r(h)(r(n)[0].toString()).format("DD_MM_YYYY")}_to_${r(h)(r(n)[1].toString()).format("DD_MM_YYYY")}`},{default:F(()=>[_(i,{text:"Export Excel"})]),_:1},8,["filename"])])]),s("div",null,[s("div",Oe,[s("div",Fe,[we,_(p)]),r(R).length>0&&!r(m)?(v(),T("div",Ve,[s("div",Be,[je,s("h3",null,g(r(L).details.name),1),s("p",null,g(r(L).details.address),1),s("p",null,g(r(L).details.phone),1)]),s("div",Ie,[M("Tests Performed Period: "),s("span",Pe,g(r(k)!=""?r(h)(r(k)).format("DD/MM/YYYY"):"")+" - "+g(r(U)!=""?r(h)(r(U)).format("DD/MM/YYYY"):""),1)]),s("div",{innerHTML:J(r(R))},null,8,He),s("div",null,[qe,s("table",Ke,[ze,s("tbody",null,[(v(!0),T(ie,null,de(r(N),(E,t)=>(v(),T("tr",{key:E.name,class:pe(t%2===0?"bg-white":"bg-gray-50")},[s("td",Je,g(E.name),1),s("td",Qe,g(E.count),1)],2))),128))])])])])):V("",!0),r(R).length==0&&!r(m)?(v(),T("div",Xe,et)):V("",!0),_e(s("div",tt,[_(y),st],512),[[ue,r(m)]])])])])}}});export{$t as default};
