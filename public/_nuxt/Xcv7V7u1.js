import{_ as Fe}from"./ucPVlGIa.js";import{d as G,aa as Le,ab as Re,c as N,r as c,ac as Ae,o as K,w as Ne,ad as pe,ae as qe,af as Oe,ag as De,ah as Pe,ai as Ue,F as he,aj as me,b as O,e as D,g as l,u as Be,a as _e,f as p,h as t,z as k,Y as Ie,p as M,G as je,V as Me,k as V,H as ve,j as Ve,N as fe,t as I,S as He,m as H,l as z,_ as ze,ak as Ge,a9 as Ke,a5 as Ye,C as A,O as B,y as Qe,a0 as Je}from"./CnHVHtNb.js";import{_ as We}from"./dNe-8R2B.js";import{r as Xe}from"./YtRYkxjm.js";import{d as Ze,p as et}from"./BNP8985R.js";import{s as tt}from"./DHZFDxBX.js";import{r as at}from"./BKTUVHTR.js";import{r as lt}from"./ENbaFwPK.js";import{_ as st}from"./BmVeJhZC.js";import{_ as ot}from"./D79OLBMa.js";import{u as rt}from"./Bnl9n6mh.js";import{u as nt}from"./DY202iD-.js";import{P as it}from"./O-3ebvIT.js";import"./BZb3bzVo.js";import"./n6mkMIpm.js";let ct=Symbol("GroupContext"),ut=G({name:"Switch",emits:{"update:modelValue":x=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:void 0},defaultChecked:{type:Boolean,optional:!0},form:{type:String,optional:!0},name:{type:String,optional:!0},value:{type:String,optional:!0},id:{type:String,default:null},disabled:{type:Boolean,default:!1},tabIndex:{type:Number,default:0}},inheritAttrs:!1,setup(x,{emit:n,attrs:v,slots:S,expose:q}){var C;let E=(C=x.id)!=null?C:`headlessui-switch-${Le()}`,h=Re(ct,null),[f,w]=Ze(N(()=>x.modelValue),o=>n("update:modelValue",o),N(()=>x.defaultChecked));function L(){w(!f.value)}let T=c(null),$=h===null?T:h.switchRef,_=tt(N(()=>({as:x.as,type:v.type})),$);q({el:$,$el:$});function y(o){o.preventDefault(),L()}function F(o){o.key===me.Space?(o.preventDefault(),L()):o.key===me.Enter&&et(o.currentTarget)}function i(o){o.preventDefault()}let a=N(()=>{var o,g;return(g=(o=Ae($))==null?void 0:o.closest)==null?void 0:g.call(o,"form")});return K(()=>{Ne([a],()=>{if(!a.value||x.defaultChecked===void 0)return;function o(){w(x.defaultChecked)}return a.value.addEventListener("reset",o),()=>{var g;(g=a.value)==null||g.removeEventListener("reset",o)}},{immediate:!0})}),()=>{let{name:o,value:g,form:u,tabIndex:R,...P}=x,j={checked:f.value},U={id:E,ref:$,role:"switch",type:_.value,tabIndex:R===-1?0:R,"aria-checked":f.value,"aria-labelledby":h==null?void 0:h.labelledby.value,"aria-describedby":h==null?void 0:h.describedby.value,onClick:y,onKeyup:F,onKeypress:i};return pe(he,[o!=null&&f.value!=null?pe(qe,Oe({features:De.Hidden,as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:f.value,form:u,disabled:P.disabled,name:o,value:g})):null,Pe({ourProps:U,theirProps:{...v,...Ue(P,["modelValue","defaultChecked"])},slot:j,attrs:v,slots:S,name:"Switch"})])}}});function dt(x,n){return O(),D("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const pt=l("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity"},null,-1),mt={class:"fixed inset-0 overflow-hidden"},vt={class:"absolute inset-0 overflow-hidden"},ft={class:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10"},ht={class:"absolute left-0 top-0 -ml-8 flex pr-2 pt-4 sm:-ml-10 sm:pr-4"},_t=l("span",{class:"absolute -inset-2.5"},null,-1),yt=l("span",{class:"sr-only"},"Close panel",-1),gt={class:"flex h-full flex-col overflow-y-scroll bg-white py-3 shadow-xl"},bt={class:"border-b"},xt={class:"relative mt-6 flex-1 flex flex-col space-y-3"},wt={class:"px-5 flex flex-col space-y-3"},St={classs:"flex flex-col items-center"},Ct={class:"absolute w-full border-t bottom-0 justify-end flex px-5 pt-3 items-center space-x-5"},$t=G({__name:"filters",emits:["tableFields","filterFields","specimenFields","locationField","originField","onClearFilters"],setup(x,{emit:n}){const v=c(!1),{$toast:S}=Be(),q=()=>{v.value=!0},C=c([{label:"Show person who requested test",value:!1,property:"Requested by",table_value:"requested_by"},{label:"Show person who completed the test",value:!1,property:"Completed by",table_value:"completed"},{label:"Show test tracking numbers",value:!1,property:"tracking number",table_value:"tracking_number"},{label:"Show test result value",value:!1,property:"Test result",table_value:"result"},{label:"Show date of test result",value:!1,property:"Result date",table_value:"result_date"}]),E=c([]),h=c([]),f=c([]),w=c([]),L=_e("token"),T=n,$=()=>{const i=C.value.filter(a=>a.value);T("tableFields",i),T("specimenFields",f.value.join(",")),T("locationField",w.value.join(",")),v.value=!1,S.success("Filters applied successfully")},_=()=>{v.value=!1,C.value=C.value.map(i=>({...i,value:!1})),f.value=[],w.value=[],T("onClearFilters",C.value),S.success("Filters reset successfully")},y=async()=>{const{data:i,error:a,pending:o}=await H({route:z.specimens,method:"GET",token:`${L.value}`});i&&(E.value=i.value)},F=async()=>{const{data:i,error:a,pending:o}=await H({route:z.locations,method:"GET",token:`${L.value}`});i&&(h.value=i.value)};return K(()=>{y(),F()}),(i,a)=>{const o=ze,g=We;return O(),D("div",null,[p(o,{text:"Apply filters",color:"primary",icon:t(Xe),click:q},null,8,["icon"]),p(t(He),{as:"template",show:t(v)},{default:k(()=>[p(t(Ie),{class:"relative z-10",onClose:a[3]||(a[3]=u=>v.value=!1)},{default:k(()=>[p(t(M),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[pt]),_:1}),l("div",mt,[l("div",vt,[l("div",ft,[p(t(M),{as:"template",enter:"transform transition ease-in-out duration-500 sm:duration-700","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:k(()=>[p(t(je),{class:"pointer-events-auto relative w-screen max-w-md"},{default:k(()=>[p(t(M),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[l("div",ht,[l("button",{type:"button",class:"relative text-gray-100 hover:text-white",onClick:a[0]||(a[0]=u=>v.value=!1)},[_t,yt,p(t(dt),{class:"h-6 w-6","aria-hidden":"true"})])])]),_:1}),l("div",gt,[l("div",bt,[p(t(Me),{class:"text-xl font-semibold leading-6 text-gray-900 px-4 py-2"},{default:k(()=>[V("Filters")]),_:1})]),l("div",xt,[l("div",wt,[l("div",null,[p(g,{label:"Specimen",mode:"tags",items:t(E).map(u=>u.name),"items-selected":t(f),"onUpdate:itemsSelected":a[1]||(a[1]=u=>ve(f)?f.value=u:null)},null,8,["items","items-selected"])]),l("div",null,[p(g,{label:"Lab location",mode:"tags",items:t(h).map(u=>u.name),"items-selected":t(w),"onUpdate:itemsSelected":a[2]||(a[2]=u=>ve(w)?w.value=u:null)},null,8,["items","items-selected"])]),l("div",St,[(O(!0),D(he,null,Ve(t(C),u=>(O(),D("label",{key:u.label,class:"flex items-center pt-3"},[p(t(ut),{modelValue:u.value,"onUpdate:modelValue":R=>u.value=R,class:fe([u.value?"bg-sky-500":"bg-gray-200","relative mr-2 inline-flex w-11 h-6 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75"])},{default:k(()=>[l("span",{"aria-hidden":"true",class:fe([u.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"])},null,2)]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),V(" "+I(u.label),1)]))),128))])]),l("div",Ct,[p(o,{text:"Reset",color:"error",icon:t(at),click:_},null,8,["icon"]),p(o,{text:"Apply",color:"success",icon:t(lt),click:$},null,8,["icon"])])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["show"])])}}}),kt=""+new URL("report_details.CM__hAjw.png",import.meta.url).href,Et={class:"px-5 py-5"},Tt=l("div",{class:"py-4 flex items-center"},[l("img",{src:kt,alt:"report-icon",class:"w-8 h-8 mr-2"}),l("h3",{class:"text-2xl font-semibold uppercase"},"Report Details")],-1),Ft={class:"bg-gray-50 border border-gray-100 rounded"},Lt={class:"flex px-2 py-2 items-center"},Rt=l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[l("path",{fill:"currentColor","fill-rule":"evenodd",d:"M31 10a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2h-8a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2H9a1 1 0 1 0 0 2v7H7v-3H5v3H4v2h1v13H4v2h1v2h2v-2h34v2h2v-2h1v-2h-1V21h1v-2h-1v-3h-2v3h-2v-7a1 1 0 1 0 0-2zm6 9v-7h-4v7zm-4 2h4v5h-4zm-2 0v8a4 4 0 0 0 8 0v-8h2v13H7V21h2v8a4 4 0 0 0 8 0v-8h3v8a4 4 0 0 0 8 0v-8zm-5-2v-7h-4v7zm-11 0v-7h-4v7zm-4 2h4v2h-4z","clip-rule":"evenodd"})],-1),At={class:"px-2 text-base font-medium uppercase"},Nt={class:"flex px-2 py-2 items-center"},qt=Je('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 512 512"><rect width="416" height="384" x="48" y="80" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M128 48v32m256-32v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path></svg>',1),Ot={class:"px-2 text-base font-medium"},Dt=l("span",{class:"font-medium text-black uppercase"},"Report period:",-1),Pt={class:"w-full flex items-center justify-between mt-3"},Ut={class:"flex items-center space-x-3"},Bt={class:"mt-5"},ta=G({__name:"[associated_id]",setup(x){var Y,Q;const n=Ge();rt({title:`${Ke(((Q=(Y=n.query.type)==null?void 0:Y.toString())==null?void 0:Q.toUpperCase().replaceAll("-"," "))??"")} Drilldown - ${it.name.toUpperCase()}`});const v=c([]),S=c(!1),q=c(""),C=_e("token"),E=nt(),h=Ye(),f=c("name"),w=c(0),L=c([10,25,50,100,500,1e3]),T=c("patient_name"),$=c("asc"),_=c([]),y=c([]),F=c({page:1,rowsPerPage:10,sortBy:"name"}),i=c([{text:"SN",value:"sn",sortable:!1},{text:"PATIENT NO",value:"patient_id",sortable:!0},{text:"PATIENT NAME",value:"patient_name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"DATE REGISTERED",value:"date_registered",sortable:!0}]),a=c(i.value),o=c([]),g=[{name:"Home",link:"/home"},{name:"Reports",link:"#"}],u=(e,r,d,s)=>{const m=A(s).format("MMMM"),b=A(s).format("yyyy");return{aggregate:`${A(r).format(B)} - ${A(d).format(B)}`,culture:`${m}, ${b}`,moh:`${s}`}[e]},R=N(()=>v.value.map((e,r)=>{const d=e.completed_by&&e.completed_by.username?e.completed_by.username:"",s=e.results&&e.results.length>0?e.results.find(b=>b.value!==null):{},m=e.results&&e.results.length>0?e.results.filter(b=>b.name!=="Lab Tech. Name:").map(b=>`${b.name}: ${b.value}`).join(", "):"";return{sn:r+1,patient_id:e.client.patient_no,patient_name:`${e.client.first_name} ${e.client.last_name}`,accession_number:e.accession_number,test_type_name:e.test_type_name,specimen_type:e.specimen_type,result:m,result_date:A(s.result_date).format(B),completed:d,requested_by:e.requested_by,tracking_number:e.tracking_number,lab_location:e.lab_location.name,date_registered:A(e.created_date).format(B)}}).filter(e=>_.value.length===0||_.value.includes(e.specimen_type)).filter(e=>y.value.length===0||y.value.includes(e.lab_location))),P=N(()=>R.value.map(e=>{let r={SN:e.sn,"PATIENT NO":e.patient_id,"PATIENT NAME":e.patient_name,"ACCESSION NO":e.accession_number,TEST:e.test_type_name,SPECIMEN:e.specimen_type,"TEST RESULT":e.result.replace(/,/g,`
`),"LAB LOCATION":e.lab_location,"RESULT DATE":e.result_date,"COMPLETED BY":e.completed,"REQUESTED BY":e.requested_by,"TRACKING NUMBER":e.tracking_number,"DATE REGISTERED":e.date_registered};const d=[...o.value.length>0?[([s])=>o.value.map(m=>m.toUpperCase()).includes(s.toUpperCase())||i.value.some(m=>m.text===s.toUpperCase())]:[],..._.value.length>0?[([s])=>s.toUpperCase()==="SPECIMEN"]:[],...y.value.length>0?[([s])=>s.toUpperCase()==="LAB LOCATION"]:[],([s])=>a.value.map(m=>m.text.toUpperCase()).includes(s.toUpperCase())];return Object.fromEntries(Object.entries(r).filter(s=>d.some(m=>m(s))))})),j=c([{origin:"aggregate",path:`${z.aggregateDrilldown}?associated_ids=${n.params.associated_id}`}]),U=async()=>{S.value=!0;const e=j.value.find(b=>b.origin==="aggregate");if(!e){console.error("Endpoint not found");return}const r={route:`${e.path}&page=${F.value.page}&per_page=${F.value.rowsPerPage}`,method:"GET",token:`${C.value}`},{data:d,error:s,pending:m}=await H(r);S.value=m,d.value&&(v.value=d.value.data,w.value=d.value.meta.total_count,S.value=!1),s.value&&(console.error(s.value),S.value=!1)},ye=e=>{if(typeof e=="object"){F.value=e;const d={...h.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};h.replace({query:d}),U()}},ge=e=>{_.value=[],y.value=[],xe(e),a.value=i.value.filter(r=>!r.text.includes("Specimen")).filter(r=>!r.text.includes("Lab Location"))},be=e=>{if(a.value=[...i.value],o.value=[],e.length>0){const r=new Set(a.value.map(s=>s.text));e.forEach(s=>{r.has(s.property)||(a.value.push({text:s.property,value:s.table_value,sortable:!0}),o.value.push(s.property))});const d=new Set(e.map(s=>s.property));a.value=a.value.filter(s=>d.has(s.text)||i.value.some(m=>m.text===s.text))}},xe=e=>{e.forEach(r=>{r.value||(a.value=a.value.filter(d=>d.text!==r.property))}),_.value.length===0&&y.value.length===0&&(a.value=[...i.value])},we=e=>{const r=e.split(",").filter(d=>d.trim()!=="");_.value=r,r.length>0?Ce({text:"Specimen",value:"specimen_type",sortable:!0}):$e(),_.value.length===0&&y.value.length===0&&(i.value=[...i.value])},Se=e=>{const r=e.split(",").filter(d=>d.trim()!=="");y.value=r,r.length>0?ke({text:"Lab Location",value:"lab_location",sortable:!0}):Ee(),_.value.length===0&&y.value.length===0&&(i.value=[...i.value])},Ce=e=>{a.value.some(r=>r.text==="Specimen")||a.value.push(e)},$e=()=>{a.value=a.value.filter(e=>e.text!=="Specimen")},ke=e=>{a.value.some(r=>r.text==="Lab Location")||a.value.push(e)},Ee=()=>{a.value=a.value.filter(e=>e.text!=="Lab Location")},Te=e=>e.join("-").toLowerCase().replace(/ /g,"-");return K(()=>{U()}),(e,r)=>{var W,X,Z,ee,te,ae,le,se,oe,re,ne,ie,ce,ue,de;const d=Fe,s=$t,m=st,b=Qe("excel"),J=ot;return O(),D("div",Et,[p(d,{pages:g}),Tt,l("div",null,[l("div",Ft,[l("div",Lt,[Rt,l("p",At,I(t(n).query.test)+" (total tests count: "+I(t(n).query.count)+") ",1)]),l("div",Nt,[qt,l("p",Ot,[Dt,V(" "+I(u((W=t(n).query.origin)==null?void 0:W.toString(),(X=t(n).query.from)==null?void 0:X.toString(),(Z=t(n).query.to)==null?void 0:Z.toString(),(ee=t(n).query.dateRange)==null?void 0:ee.toString())),1)])])]),l("div",Pt,[l("div",null,[p(s,{onTableFields:be,onSpecimenFields:we,onLocationField:Se,onOnClearFilters:ge})]),l("div",Ut,[p(b,{class:"btn btn-default",header:[`${(te=t(n).query.origin)==null?void 0:te.toString().toUpperCase()} - ${(ae=t(n).query.type)==null?void 0:ae.toString().replaceAll("-"," ").toUpperCase()} `,`FOR PERIOD ${u((le=t(n).query.origin)==null?void 0:le.toString(),(se=t(n).query.from)==null?void 0:se.toString(),(oe=t(n).query.to)==null?void 0:oe.toString(),(re=t(n).query.dateRange)==null?void 0:re.toString())}`,t(E).details.name,t(E).details.address,t(E).details.phone,`${(ie=(ne=t(n).query.test)==null?void 0:ne.toString())==null?void 0:ie.toUpperCase()}`],data:t(P),worksheet:"report-work-sheet",name:Te([`${(ce=t(n).query.origin)==null?void 0:ce.toString()}`,`${(ue=t(n).query.type)==null?void 0:ue.toString()}`,`${(de=t(n).query.test)==null?void 0:de.toString()}`,".xls"])},{default:k(()=>[p(m,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),l("div",Bt,[p(J,{headers:t(a),data:t(R),loading:t(S),"rows-per-items":t(L),searchField:t(q),searchValue:t(f),serverItemsLength:t(w),serverOptions:t(F),sortBy:t(T),sortType:t($),onUpdate:ye},null,8,["headers","data","loading","rows-per-items","searchField","searchValue","serverItemsLength","serverOptions","sortBy","sortType"])])])])}}});export{ta as default};
