import{d as ne,r as w,b as a,L as we,z as P,f as v,h as o,Y as De,p as ee,g as e,G as Ce,S as Oe,n as $e,a as Te,a5 as Ee,ak as Ae,u as Y,c as M,C as O,Z as te,w as oe,o as Me,y as re,e as n,t as m,k as B,H as se,O as ae,F as b,j as g,K as V,ao as je,ap as Se,aq as Pe,l as qe,_ as Le}from"./BxD-h1LR.js";import{_ as Ne}from"./COJDNupw.js";import{_ as Ye}from"./CoQgzhbz.js";import{_ as Be}from"./C2S1Arkw.js";import{_ as Ve}from"./BNhNOnHe.js";import{_ as Fe}from"./Cs7plFji.js";import{u as Ue,_ as ze}from"./NR9_F3jh.js";import{u as Ge}from"./BmiBNsbw.js";import{_ as Ie}from"./CKMQEpqg.js";import{_ as We}from"./B4cMvEBz.js";import{_ as He}from"./CQcCm1L6.js";import{P as Je}from"./C1C0mJ5v.js";import{u as Qe}from"./DRcUz5ts.js";import{r as Ke}from"./BkJfYQCG.js";import{r as Ze}from"./CQe3LSWs.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";const Xe=e("div",{class:"fixed inset-0 bg-black bg-opacity-50"},null,-1),et={class:"fixed inset-0 overflow-y-auto top-0"},tt={class:"flex min-h-full items-start justify-end top-0 p-4 text-center"},ot={class:"flex items-center space-x-2"},rt=e("div",null,[e("h3",{class:"text-xl font-semibold"},"Downloading"),e("p",{class:"text-gray-500"}," Please wait patiently, it may take 1-4 minutes to download the files ")],-1),st=ne({__name:"DownloadingDialog",setup(le,{expose:q}){const j=w(!1);function f(){j.value=!1}function F(){j.value=!0}return q({openModal:F,closeModal:f}),(D,W)=>{const $=$e;return a(),we(o(Oe),{appear:"",show:o(j),as:"template"},{default:P(()=>[v(o(De),{as:"div",onClose:f,class:"relative z-10"},{default:P(()=>[v(o(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:P(()=>[Xe]),_:1}),e("div",et,[e("div",tt,[v(o(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:P(()=>[v(o(Ce),{class:"w-full max-w-md transform overflow-hidden rounded bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:P(()=>[e("div",ot,[v($),rt])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),at={class:"px-5 py-5"},nt=e("img",{src:Ie,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),lt={class:"w-full flex items-center justify-between"},ct={class:"flex items-center space-x-3"},it={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},dt={class:"w-72 ml-2"},ut={class:"w-44"},pt={class:"flex items-center space-x-3"},_t={class:"border rounded print-container mt-5"},mt={class:"w-full rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},ft=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:We,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"},"LABORATORY DEPARTMENT REPORT")],-1),bt={class:"mt-3 px-5 border-b"},yt={class:"font-medium mb-2"},ht={class:"font-normal"},vt={key:0,class:"overflow-x-auto",id:"print-container"},xt={class:"w-full border border-dotted rounded overflow-x-auto"},gt={class:"w-full"},kt=e("th",{class:"px-2 py-2 text-center border-r"},"TESTS",-1),Rt=["colspan"],wt=e("th",{class:"px-2 py-2 text-center"},"TOTAL",-1),Dt={class:"border-b"},Ct=e("th",{class:"border-r"},null,-1),Ot={class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},$t=e("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},null,-1),Tt={class:"capitalize font-medium px-2 py-2 text-center border-r bg-gray-50"},Et=["onClick"],At={class:"px-2 py-2 text-center font-medium"},Mt={key:0,class:"w-full border border-dotted rounded overflow-x-auto mt-10"},jt=e("th",{class:"border-b px-2 py-2 uppercase",rowspan:4}," Blood Products ",-1),St=e("th",{class:"border-b px-2 py-2"},null,-1),Pt=["colspan"],qt={class:"border-t"},Lt={class:"capitalize px-2 py-2 text-center bg-gray-50 border-r"},Nt=e("td",{class:"px-2 py-2 border-r border-b"},null,-1),Yt=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),Bt=e("td",{class:"px-2 py-2 border-b border-r"},"Age-Ranges",-1),Vt=e("td",{class:"px-2 py-2 border-b border-r"},"0-5",-1),Ft=e("td",{class:"px-2 py-2 border-b border-r"},"6-14",-1),Ut=e("td",{class:"border-r px-2 py-2 border-b"},"15-120",-1),zt=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),Gt=e("td",{class:"px-2 py-2 border-b border-r"},"Female",-1),It=["onClick"],Wt=["onClick"],Ht=["onClick"],Jt=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),Qt=e("td",{class:"px-2 py-2 border-b border-r"},"Male",-1),Kt=["onClick"],Zt=["onClick"],Xt=["onClick"],eo=e("div",{class:"w-full py-2 mt-2.5 border-b"},[e("h3",{class:"text-xl font-semibold uppercase text-center"}," CRITICAL VALUES ")],-1),to={key:1,class:"w-full border border-dotted rounded overflow-x-auto"},oo=e("th",{class:"px-2 py-2 text-center border-r"},"Measure",-1),ro=["colspan"],so=e("th",{class:"px-2 py-2 text-center font-bold uppercase"},"Total",-1),ao={class:"border-b"},no=e("th",{class:"border-r"},null,-1),lo={class:"px-2 py-2 text-center uppercase bg-gray-50 border-b border-t"},co=e("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},null,-1),io={class:"capitalize px-2 py-2 text-center border-r"},uo=["onClick"],po={class:"px-2 py-2 text-center font-bold"},_o={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},mo=e("img",{src:He,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),fo={class:"font-medium"},bo="Department Report",Vo=ne({__name:"department",setup(le){Ge({title:`${Je.name.toUpperCase()} - Department Report`});const q=Qe(),j=w(new Array),f=w(new Array("","")),F=()=>{f.value=new Array("","")},D=w({name:"select department"}),W=Te("token"),$=Ee(),C=Ae(),{$toast:U}=Y(),{loading:A,executeCancellableRequest:ce,cancelRequest:ie}=Ue(),de=w(null),H=w([]),J=w(""),Q=w([]),K=w(),z=w(null),i=w({wards:[],data:[]}),ue=w([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),pe=M(()=>{const{id:r,name:l}=D.value;return r===0||r===void 0?"":l}),L=M(()=>f.value[0]?O(f.value[0]).format("YYYY-MM-DD"):""),N=M(()=>f.value[1]?O(f.value[1]).format("YYYY-MM-DD"):""),_e=M(()=>{const r=[];return i.value.data.length>0&&i.value.data.forEach(l=>{Object.keys(l).forEach(d=>{l[d].forEach(c=>{const p={TEST:c.test_type.toString().toUpperCase(),MONTH:te(d)};i.value.wards.forEach(u=>{p[u.toUpperCase()]=0}),Object.keys(c.ward).forEach(u=>{p[u.toUpperCase()]=c.ward[u].total});const _=Object.values(c.ward).reduce((u,y)=>u+y.total,0);p.total=_,r.push(p)})})}),r}),me=M(()=>{const r=[];return i.value.critical_values.forEach(l=>{Object.keys(l).forEach(d=>{l[d].forEach(p=>{const _={TEST:d,"CRITICAL VALUE LEVEL":p.critical_value_level};i.value.wards.forEach(u=>{_[u.toUpperCase()]=0}),Object.keys(p.ward).forEach(u=>{_[u.toUpperCase()]=p.ward[u].total}),_.TOTAL=Object.values(p.ward).reduce((u,y)=>u+y.total,0),r.push(_)})})}),r}),fe=M(()=>{const r=[];return i.value.blood_bank_products.length>0&&i.value.blood_bank_products.forEach(l=>{Object.keys(l).forEach(d=>{l[d].forEach(c=>{c.ward.forEach(p=>{Object.keys(p).forEach(_=>{const u=p[_];Object.keys(u).forEach(y=>{const k=u[y],G={PRODUCT:d,GENDER:te(c.gender),"AGE RANGE":y,"WARD ":_.toUpperCase(),"TOTAL COUNT":k.total};r.push(G)})})})})})}),r}),be=async()=>{var r,l,d;(r=z.value)==null||r.openModal();try{const c=[_e.value,fe.value,me.value],p=["Department Report","Department - Blood Bank Products Report","Department - Hematology Critical Values Report"];for(let _=0;_<c.length;_++){const u=c[_],y=p[_].toLowerCase().replace(/ /g,"_");H.value=u,J.value=`${y}_${O(L.value).format("DD_MM_yyyy")}_to_${O(N.value).format("DD_MM_yyyy")}.xls`,Q.value=["LABORATORY DEPARTMENT REPORT",y,`PERIOD FROM ${O(L.value).format("DD-MM-yyyy")} TO ${O(N.value).format("DD-MM-yyyy")}`,q.details.name,q.details.address,q.details.phone],await je(),(l=K.value)==null||l.click(),await new Promise(k=>setTimeout(k,500))}U.success(Se)}catch(c){console.error("error dowloading reports: ",c),U.error(Pe)}(d=z.value)==null||d.closeModal()};async function Z(){if(ve())Y().$toast.warning("Please select a department!");else{A.value=!0,i.value={wards:[],data:[]};let r=`from=${L.value}&to=${N.value}&department=${he(D.value.name)}&report_id=${C.query.report_id}`;const l={route:`${qe.aggregateReports}/department?${r}`,method:"GET",token:`${W.value}`},{data:d,error:c,pending:p}=await ce(l);A.value=p,d.value&&(A.value=!1,i.value=d.value,ye(d.value.report_id),Y().$toast.success("Report generated successfully!")),c.value&&(A.value=!1,console.error(c.value))}}const ye=r=>{const d={...$.currentRoute.value.query,report_id:r};$.replace({query:d}).catch(c=>{console.error("Failed to replace route:",c)})};function he(r){return r==="select department"||r==="-- select test type --"||r==="-- select test status --"?"":r}function ve(){return D.value.name=="select department"}const E=(r,l,d,c)=>{d!==0&&c!==""?$.push(`/reports/${c}?origin=aggregate&type=department-report&from=${L.value}&to=${N.value}&test=${r} - ${l}&department=${D.value.name}&count=${d}`):U.warning("No data found for this month")};function X(r){return i.value.wards.reduce((d,c)=>d+(r.ward[c]?r.ward[c].total:0),0)}function R(r,l,d,c){const _=JSON.parse(JSON.stringify(r[Object.keys(r)[0]])).find(k=>k.gender===l);if(!_)return 0;const u=_.ward.find(k=>Object.keys(k)[0]===d.toLowerCase());if(!u)return 0;const y=u[d.toLowerCase()][c];return y===void 0?0:y.total}function S(r,l,d,c){const _=JSON.parse(JSON.stringify(r[Object.keys(r)[0]])).find(k=>k.gender===l);if(!_)return 0;const u=_.ward.find(k=>Object.keys(k)[0]===d.toLowerCase());if(!u)return 0;const y=u[d.toLowerCase()][c];return y===void 0?0:y.associated_ids}oe(f,()=>{const r=f.value[0]?O(f.value[0]).format("YYYY-MM-DD"):"",l=f.value[1]?O(f.value[1]).format("YYYY-MM-DD"):"";if(r||l){const c={...$.currentRoute.value.query,...r&&{from:r},...l&&{to:l}};$.replace({query:c}).catch(p=>{console.error("Failed to replace route:",p)})}},{deep:!0}),oe(D,(r,l)=>{if(r!==l){const c={...$.currentRoute.value.query,department:r.name||void 0,report_id:""};$.replace({query:c}).catch(p=>{console.error("Failed to replace route:",p)})}});const xe=M(()=>C.query.to!==void 0&&C.query.from!==void 0&&C.query.department!==void 0?(f.value=[C.query.from,C.query.to],D.value.name=`${C.query.department}`,C.query.to!==""&&C.query.from!==""&&C.query.department!==""):!1);return Me(()=>{xe.value&&Z(),j.value=Y().$metadata.departments}),(r,l)=>{const d=st,c=Ne,p=re("datepicker"),_=Ye,u=Le,y=Be,k=re("excel"),G=Ve,ge=Fe,ke=ze;return a(),n("div",at,[v(d,{ref_key:"downloadModalRef",ref:z},null,512),v(c,{pages:o(ue)},null,8,["pages"]),e("div",{class:"flex items-center py-5"},[nt,e("h3",{class:"text-2xl font-semibold uppercase"},m(bo))]),e("div",lt,[e("div",ct,[e("div",it,[v(o(Ke),{class:"w-5 h-5 mr-2"}),B(" Filter By Date Range "),e("div",dt,[v(p,{onCleared:F,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",modelValue:o(f),"onUpdate:modelValue":l[0]||(l[0]=s=>se(f)?f.value=s:null)},null,8,["modelValue"])])]),e("div",ut,[v(_,{items:o(j),modelValue:o(D),"onUpdate:modelValue":l[1]||(l[1]=s=>se(D)?D.value=s:null)},null,8,["items","modelValue"])]),e("div",null,[v(u,{color:"primary",text:"Generate Report",icon:o(Ze),click:()=>Z(),loading:o(A)},null,8,["icon","click","loading"])])]),e("div",pt,[v(y,{printSmallLabel:!1}),v(k,{class:"btn btn-default",ref_key:"excelRef",ref:de,header:o(Q),data:o(H),worksheet:"report-work-sheet",name:o(J)},{default:P(()=>[e("button",{ref_key:"excelTriggerRef",ref:K},null,512)]),_:1},8,["header","data","name"]),v(G,{onClick:be,text:"Export Excel"})])]),e("div",_t,[e("div",mt,[ft,v(ge)]),e("div",bt,[e("h3",yt,[B(" Tests Performed Period: "),e("span",ht,m(o(f)[0].toString()!=""?o(O)(o(f)[0].toString()).format("DATE_FORMAT"in r?r.DATE_FORMAT:o(ae)):"")+" - "+m(o(f)[1].toString()!=""?o(O)(o(f)[1].toString()).format("DATE_FORMAT"in r?r.DATE_FORMAT:o(ae)):""),1)])]),o(i).wards.length>0&&o(i).data.length>0?(a(),n("div",vt,[e("table",xt,[e("thead",gt,[e("tr",null,[kt,e("th",{class:"px-2 py-2 text-center border-r border-b bg-gray-100",colspan:o(i).wards.length}," WARDS ",8,Rt),wt]),e("tr",Dt,[Ct,(a(!0),n(b,null,g(o(i).wards,(s,T)=>(a(),n("th",{class:"px-2 py-2 text-center border-r",key:T},m(s),1))),128))])]),e("tbody",null,[(a(!0),n(b,null,g(o(i).data,(s,T)=>(a(),n(b,{key:T},[e("th",Ot,m(Object.keys(s)[0].toString().toUpperCase()),1),(a(!0),n(b,null,g(o(i).wards,(t,h)=>(a(),n("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t",key:h}))),128)),$t,(a(!0),n(b,null,g(s[Object.keys(s)[0]],(t,h)=>(a(),n("tr",{class:"border-t border-b",key:h},[e("td",Tt,m(t.test_type),1),(a(!0),n(b,null,g(o(i).wards,(x,I)=>(a(),n("td",{onClick:Re=>E(t.test_type,x,t.ward[x]?t.ward[x].total:0,t.ward[x]?t.ward[x].associated_ids:""),key:I,class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},m(t.ward[x]?t.ward[x].total:0),9,Et))),128)),e("td",At,m(X(t)),1)]))),128))],64))),128))])]),o(i).blood_bank_products.length>0?(a(),n("table",Mt,[e("thead",null,[e("tr",null,[jt,St,e("th",{class:"border-b px-2 py-2 bg-gray-100",colspan:o(i).wards.length}," Wards ",8,Pt)])]),e("tbody",null,[(a(!0),n(b,null,g(o(i).blood_bank_products,(s,T)=>(a(),n(b,{key:T},[e("tr",qt,[e("td",Lt,m(Object.keys(s)[0]),1),Nt,(a(!0),n(b,null,g(o(i).wards,(t,h)=>(a(),n("th",{colspan:3,class:"px-2 py-2 text-center border-r border-b",key:h},m(t),1))),128))]),e("tr",null,[Yt,Bt,(a(!0),n(b,null,g(o(i).wards,(t,h)=>(a(),n(b,{key:h},[Vt,Ft,Ut],64))),128))]),e("tr",null,[zt,Gt,(a(!0),n(b,null,g(o(i).wards,t=>(a(),n(b,{key:t},[e("td",{class:"px-4 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for females, `,t,R(s,"female",t,"0-5"),S(s,"female",t,"0-5"))},m(R(s,"female",t,"0-5")),9,It),e("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for females, `,t,R(s,"female",t,"6-14"),S(s,"female",t,"6-14"))},m(R(s,"female",t,"6-14")),9,Wt),e("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for females, `,t,R(s,"female",t,"15-120"),S(s,"female",t,"15-120"))},m(R(s,"female",t,"15-120")),9,Ht)],64))),128))]),e("tr",null,[Jt,Qt,(a(!0),n(b,null,g(o(i).wards,t=>(a(),n(b,{key:t},[e("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for males`,t,R(s,"male",t,"0-5"),S(s,"male",t,"0-5"))},m(R(s,"male",t,"0-5")),9,Kt),e("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for males`,t,R(s,"male",t,"6-14"),S(s,"male",t,"6-14"))},m(R(s,"male",t,"6-14")),9,Zt),e("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:h=>E(`${Object.keys(s)[0]} for males`,t,R(s,"male",t,"15-120"),S(s,"male",t,"15-120"))},m(R(s,"male",t,"15-120")),9,Xt)],64))),128))])],64))),128))])])):V("",!0),eo,o(i).critical_values.length>0?(a(),n("table",to,[e("thead",null,[e("tr",null,[oo,e("th",{class:"px-2 py-2 text-center border-r border-b bg-gray-100",colspan:o(i).wards.length}," Wards ",8,ro),so]),e("tr",ao,[no,(a(!0),n(b,null,g(o(i).wards,(s,T)=>(a(),n("th",{class:"px-2 py-2 text-center border-r",key:T},m(s),1))),128))])]),e("tbody",null,[(a(!0),n(b,null,g(o(i).critical_values,(s,T)=>(a(),n(b,{key:T},[e("th",lo,m(Object.keys(s)[0]),1),(a(!0),n(b,null,g(o(i).wards,(t,h)=>(a(),n("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t",key:h}))),128)),co,(a(!0),n(b,null,g(s[Object.keys(s)[0]],(t,h)=>(a(),n("tr",{class:"border-t border-b",key:h},[e("td",io,m(t.critical_value_level),1),(a(!0),n(b,null,g(o(i).wards,(x,I)=>(a(),n("td",{key:I,onClick:Re=>E(`${Object.keys(s)[0]} - Critical value (${t.critical_value_level})`,x,t.ward[x]?t.ward[x].total:0,t.ward[x]?t.ward[x].associated_ids:""),class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},m(t.ward[x]?t.ward[x].total:0),9,uo))),128)),e("td",po,m(X(t)),1)]))),128))],64))),128))])])):V("",!0)])):V("",!0),v(ke,{condition:o(A),cancelReportGeneration:()=>o(ie)()},null,8,["condition","cancelReportGeneration"]),o(i).wards.length==0&&o(i).data.length==0&&!o(A)?(a(),n("div",_o,[mo,e("p",null,[B(" Please generate report data to preview the "),e("span",fo,m(o(pe)),1),B(" report. ")])])):V("",!0)])])}}});export{Vo as default};
