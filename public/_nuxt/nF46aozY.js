var le=Object.defineProperty;var oe=(m,n,i)=>n in m?le(m,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[n]=i;var h=(m,n,i)=>oe(m,typeof n!="symbol"?n+"":n,i);import{_ as ie}from"./FSyX_QAo.js";import{_ as re}from"./CRggh57R.js";import{_ as de}from"./BVbKE4I5.js";import{C as ce,bN as y,d as ue,bJ as me,ah as pe,bK as fe,a as _e,r as l,c as w,a4 as ve,w as A,bL as q,o as be,y as J,b as H,e as L,g as t,f as c,h as a,j as M,z as K,t as N,bI as ye,H as b,O as R,i as xe,aA as ge,K as he,l as we,m as Ne,u as V,bH as Ve,_ as ke}from"./fgAWut4R.js";import{_ as $e}from"./DAoM-dCf.js";import{u as Y}from"./DJSU0WEk.js";import{P as Ce}from"./D60l4UIm.js";import{u as Se}from"./DHxBKYG_.js";import{r as qe}from"./BMlEGhQ0.js";import"./Qv-HZX4d.js";import"./b5sOyOyw.js";import"./C5yTkR2T.js";import"./Cko9ZNcE.js";import"./CepswtFc.js";import"./xRdLAUoX.js";import"./CLX9t2Lo.js";import"./DKDwsOy3.js";import"./DWLeWjtr.js";class De{constructor(n){h(this,"client",{id:"",uuid:""});h(this,"tests",[]);h(this,"order",{priority:1,requested_by:"",collected_by:Y().$state.department,sample_collected_time:"",tracking_number:""});h(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=n}createEncounter(n,i){this.encounter={...this.encounter,encounter_type:n,facility_section:i}}buildOrder(n="",i=ce().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=n,this.order.sample_collected_time=i}setTests(n,i){this.tests=i.map(p=>({specimen:n,test_type:p}))}async createOrder(n){return y.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:n})}}const Pe={class:"py-5 px-5"},Te={class:"mt-5"},Oe={class:"flex items-center space-x-2"},Ue={class:"text-xl font-semibold uppercase"},Ae={class:"border rounded mt-5"},Je={class:"w-full py-5 px-5"},Re={class:"flex items-center space-x-20"},Be={class:"flex items-center space-x-3"},Ee={class:"mt-1 text-gray-600"},Fe={class:"flex items-center space-x-3"},He={class:"mt-1 text-gray-600"},Le={class:"flex items-center space-x-3"},Me={class:"mt-1 text-gray-600"},Ke={class:"border mt-5 rounded"},Ye={class:"px-5 py-5"},ze={class:"w-full mb-5"},Ie={class:"flex flex-col space-y-2"},We={class:"w-full flex items-center space-x-10 mb-5"},je={class:"w-1/2 flex flex-col space-y-2"},Ge={class:"w-1/2 flex flex-col space-y-2"},Qe={class:"font-medium"},Xe={class:"w-full flex items-center space-x-10 mb-5"},Ze={class:"w-1/2 flex flex-col space-y-2"},et={class:"w-1/2 flex flex-col space-y-2"},tt={class:"w-full my-6"},st={key:0,class:"w-full mb-5 flex flex-col space-y-2"},at={class:"w-full"},Nt=ue({__name:"index",setup(m){Se({title:`${Ce.name.toUpperCase()} - New Test`});const n=me(),i=pe(),p=Y(),z=fe(),I=_e("token"),u=l({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),W=l([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),B=l([]),D=l([]),k=l([]),f=l([]),_=l({name:"select visit type",id:0}),r=l({name:"select specimen",id:0}),v=l({name:"select ward",id:0}),g=l([]),$=l(""),C=l(""),P=l("Requesting Ward"),S=l(!1),j=w(()=>ve(u.value.date_of_birth)),T=w(()=>u.value.sex.match(/f/i)?"Female":"Male"),E=w(()=>`${u.value.first_name} ${u.value.middle_name} ${u.value.last_name}`),G=w(()=>u.value.client_id),O=w(()=>p.user.departments.find(s=>s.name===p.department));function Q(s){const e={route:`${we.clients}/${s}`,method:"GET",token:`${I.value}`};Ne(e).then(({data:d,error:x})=>{d.value&&(u.value=d.value),x.value&&console.error(x.value)})}function X(s,e){const d=s.find(x=>x.name===e);return d?d.id:null}async function Z(){const s=new De(u.value.client_id);s.createEncounter(Number(_.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(r.value.id),g.value);const e=X(p.locations,p.selectedLocation),d=await s.createOrder(Number(e));q(d)||(V().$toast.success(`Order with accession number ${d.accession_number} has been created successfully!`),await z.alertConfirmation({message:"Do you want to print specimen label?"})&&await Ve.printSpecimenLabel(d.accession_number)),i.push("/tests")}function ee(){return Number(_.value.id)==0?(V().$toast.warning("Please select visit type and try again!"),!1):Number(r.value.id)==0?(V().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(V().$toast.warning("Please select ward and try again!"),!1):g.value.length==0?(V().$toast.warning("Please select tests and try again!"),!1):!0}return A(_,async s=>{s.name.toLowerCase()=="referral"?(P.value="Requesting Facility",v.value={name:"select facility",id:0}):P.value="Requesting Ward",k.value=[],q(k.value[Number(s.id)])&&(k.value=await y.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),A(r,async s=>{q(f.value[Number(s.id)])&&(f.value[Number(s.id)]=await y.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:O.value.id,sex:T.value})||[])}),A(()=>p,async s=>{for(const e in f.value)f.value.hasOwnProperty(e)&&delete f.value[e];q(r.value)||(f.value[Number(r.value.id)]=await y.getJson("specimen/test_types",{specimen_id:Number(r.value.id),department_id:s.user.departments.find(e=>e.name===s.department).id,sex:T.value})||[]),y.getJson("specimen",{department_id:O.value.id}).then(e=>D.value=e)},{deep:!0}),be(async()=>{const s=await y.getJson("encounter_types");B.value=s.data;const e=await y.getJson("specimen",{department_id:O.value.id});D.value=e,Q(n.query.patient_id)}),(s,e)=>{const d=ie,x=re,F=J("FormKit"),U=de,te=J("multi-select"),se=J("datepicker"),ae=ke;return H(),L("div",null,[t("div",Pe,[c(d,{pages:a(W)},null,8,["pages"]),t("div",Te,[t("div",Oe,[e[9]||(e[9]=t("img",{src:$e,class:"w-auto h-6",alt:"flash-icon"},null,-1)),t("h3",Ue,[e[8]||(e[8]=M(" New order for ")),t("span",null,[c(x,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${a(E).toLowerCase().replace(" ","+")}`},{default:K(()=>[M(" “"+N(a(E))+"” ",1)]),_:1},8,["to"])])])]),t("div",Ae,[e[13]||(e[13]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("img",{src:ye,class:"h-8 w-auto",alt:"fever-icon"}),t("h3",{class:"font-semibold text-lg"},"Patient Details")],-1)),t("div",Je,[t("div",Re,[t("div",Be,[e[10]||(e[10]=t("h3",{class:"font-medium"},"Patient Number:",-1)),t("p",Ee,N(a(G)),1)]),t("div",Fe,[e[11]||(e[11]=t("h3",{class:"font-medium"},"Age",-1)),t("p",He,N(a(j))+" years old",1)]),t("div",Le,[e[12]||(e[12]=t("h3",{class:"font-medium"},"Sex:",-1)),t("p",Me,N(a(T)),1)])])])]),c(F,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=ne=>ee()&&Z()),actions:!1,id:"submitForm"},{default:K(({value:ne})=>[t("div",Ke,[e[19]||(e[19]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("h3",{class:"font-semibold text-lg"},"Order Details")],-1)),t("div",Ye,[t("div",ze,[t("div",Ie,[c(F,{label:"Requesting Physician",validation:"required",modelValue:a($),"onUpdate:modelValue":e[0]||(e[0]=o=>b($)?$.value=o:null)},null,8,["modelValue"])])]),t("div",We,[t("div",je,[e[14]||(e[14]=t("label",{class:"font-medium"},"Visit Type",-1)),c(U,{items:a(B),modelValue:a(_),"onUpdate:modelValue":e[1]||(e[1]=o=>b(_)?_.value=o:null),class:R(a(_).name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",Ge,[t("label",Qe,N(a(P)),1),c(U,{isSearchable:"",items:a(k),modelValue:a(v),"onUpdate:modelValue":e[2]||(e[2]=o=>b(v)?v.value=o:null),class:R(a(v).name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),t("div",Xe,[t("div",Ze,[e[15]||(e[15]=t("label",{class:"font-medium"},"Specimen Type",-1)),c(U,{items:a(D),modelValue:a(r),"onUpdate:modelValue":e[3]||(e[3]=o=>b(r)?r.value=o:null),class:R(a(r).name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",et,[e[16]||(e[16]=t("label",{class:"font-medium"},"Tests",-1)),c(te,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:a(g),"onUpdate:modelValue":e[4]||(e[4]=o=>b(g)?g.value=o:null),options:a(f)[a(r).id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",tt,[xe(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=o=>b(S)?S.value=o:null)},null,512),[[ge,a(S)]]),e[17]||(e[17]=t("label",{class:"font-medium"},"Back Data Entry",-1))]),a(S)?(H(),L("div",st,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sample collection date",-1)),c(se,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:a(C),"onUpdate:modelValue":e[6]||(e[6]=o=>b(C)?C.value=o:null)},null,8,["modelValue"])])):he("",!0),t("div",at,[c(ae,{type:"submit",text:"Place order",color:"primary",icon:a(qe),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{Nt as default};
