import{_ as it}from"./Breadcrumb.vue.49302d56.js";import{o as p,c as g,d as e,l as we,s as M,H as Y,ae as He,a0 as Pe,K as se,F as H,M as Ge,a7 as Xe,af as Re,_ as me,f as P,t as i,w as ae,v as ce,b as u,n as Ke,u as _e,k as w,h as Z,r as X,j as E,a as W,g as F,e as ke,aj as at,p as J,ap as ct}from"./entry.c551b705.js";import{r as dt,_ as ut}from"./Dropdown.257a05bd.js";import{_ as pt}from"./SearchBar.d6891e1c.js";import{r as fe}from"./XMarkIcon.455acd8f.js";import{_ as mt}from"./index.0de76924.js";import{h as K,j as ye,e as q,f as V,u as Se,n as _t,o as ft,p as ht,r as Ye,q as We,P as qe,k as ge,c as bt,s as vt}from"./fetch.7df80c03.js";import{d as Q,e as pe}from"./constants.c32bb852.js";import{_ as yt}from"./logo.a42aceaa.js";import{u as gt}from"./facility.01164380.js";import{_ as xt}from"./Loader.11946374.js";import{_ as Ze}from"./OutlinedButton.ac1ef570.js";import{r as Je}from"./UserIcon.b736b259.js";import{a as De,r as Qe}from"./PencilSquareIcon.c201b425.js";import{r as et}from"./ArrowDownTrayIcon.075e33ea.js";import{r as tt}from"./ArrowUturnLeftIcon.a3fd9b0b.js";import{a as wt,p as kt,E as $t,n as st,d as ee,S as Ae,h as je,U as Fe,G as Le,V as Ne}from"./transition.fe0cdd04.js";import{r as ve}from"./CheckBadgeIcon.98ccad2b.js";import{r as St}from"./PrinterIcon.de9e1628.js";import{_ as Tt}from"./Datatable.18ff387f.js";import{u as Ct}from"./vue.f36acd1f.e050a771.js";import{P as It}from"./package.6096f694.js";import{r as Pt}from"./MagnifyingGlassIcon.b78898e0.js";import{r as Rt}from"./ChevronDownIcon.ec23d505.js";import{r as Dt}from"./CheckIcon.a577c05b.js";import{m as Oe,o as x,E as Be,u as de,g as At,l as xe,y as jt,i as Ft,j as Lt,H as Ee,t as ue,f as Te,a as Ce,p as Nt,d as Ve,b as oe,P as ne,N as te,T as Ie}from"./hidden.1f7f321e.js";import{b as Ot}from"./use-text-value.ab7c4736.js";import{r as Bt}from"./CheckCircleIcon.4f65d1ec.js";import{r as Et}from"./FunnelIcon.c896a477.js";import{r as ze}from"./SquaresPlusIcon.e1dc5d0b.js";import{r as Mt}from"./AdjustmentsVerticalIcon.de873512.js";import{a as Ut,r as qt}from"./ChevronRightIcon.b4a9b90a.js";import{r as Vt}from"./ArchiveBoxXMarkIcon.d1981d73.js";import{r as be}from"./HandThumbDownIcon.379fcb86.js";import{r as zt}from"./ArrowPathIcon.4d5c879a.js";import{B as Ht,N as Gt,K as Xt,H as Kt,U as Yt}from"./listbox.3dedabc4.js";import{M as Wt,R as Zt,h as Jt,y as Qt}from"./menu.5470d3c9.js";import"./nuxt-link.11cd23df.js";import"./HomeIcon.81b6cbd7.js";import"./jspdf.es.min.5362a8cb.js";function es(s,n){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12.97 3.97a.75.75 0 011.06 0l7.5 7.5a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 11-1.06-1.06l6.22-6.22H3a.75.75 0 010-1.5h16.19l-6.22-6.22a.75.75 0 010-1.06z","clip-rule":"evenodd"})])}function ts(s,n){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 011.06 0l6 6a.75.75 0 010 1.06l-6 6a.75.75 0 11-1.06-1.06l4.72-4.72H9a5.25 5.25 0 100 10.5h3a.75.75 0 010 1.5H9a6.75 6.75 0 010-13.5h10.19l-4.72-4.72a.75.75 0 010-1.06z","clip-rule":"evenodd"})])}function ss(s,n){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z","clip-rule":"evenodd"})])}var os=(s=>(s[s.Open=0]="Open",s[s.Closed=1]="Closed",s))(os||{});let ot=Symbol("PopoverContext");function Me(s){let n=Re(ot,null);if(n===null){let r=new Error(`<${s} /> is missing a parent <${lt.name} /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Me),r}return n}let ns=Symbol("PopoverGroupContext");function nt(){return Re(ns,null)}let rt=Symbol("PopoverPanelContext");function rs(){return Re(rt,null)}let lt=we({name:"Popover",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"}},setup(s,{slots:n,attrs:r,expose:c}){var t;let o=M(null);c({el:o,$el:o});let f=M(1),h=M(null),L=M(null),D=M(null),_=M(null),N=Y(()=>Oe(o)),A=Y(()=>{var v,S;if(!x(h)||!x(_))return!1;for(let l of document.querySelectorAll("body > *"))if(Number(l==null?void 0:l.contains(x(h)))^Number(l==null?void 0:l.contains(x(_))))return!0;let C=Be(),U=C.indexOf(x(h)),re=(U+C.length-1)%C.length,le=(U+1)%C.length,he=C[re],$e=C[le];return!((v=x(_))!=null&&v.contains(he))&&!((S=x(_))!=null&&S.contains($e))}),$={popoverState:f,buttonId:M(null),panelId:M(null),panel:_,button:h,isPortalled:A,beforePanelSentinel:L,afterPanelSentinel:D,togglePopover(){f.value=de(f.value,{[0]:1,[1]:0})},closePopover(){f.value!==1&&(f.value=1)},close(v){$.closePopover();let S=(()=>v?v instanceof HTMLElement?v:v.value instanceof HTMLElement?x(v):x($.button):x($.button))();S==null||S.focus()}};He(ot,$),At(Y(()=>de(f.value,{[0]:xe.Open,[1]:xe.Closed})));let O={buttonId:$.buttonId,panelId:$.panelId,close(){$.closePopover()}},I=nt(),d=I==null?void 0:I.registerPopover,[a,k]=wt(),b=kt({mainTreeNodeRef:I==null?void 0:I.mainTreeNodeRef,portals:a,defaultContainers:[h,_]});function R(){var v,S,C,U;return(U=I==null?void 0:I.isFocusWithinPopoverGroup())!=null?U:((v=N.value)==null?void 0:v.activeElement)&&(((S=x(h))==null?void 0:S.contains(N.value.activeElement))||((C=x(_))==null?void 0:C.contains(N.value.activeElement)))}return Pe(()=>d==null?void 0:d(O)),$t((t=N.value)==null?void 0:t.defaultView,"focus",v=>{var S,C;v.target!==window&&v.target instanceof HTMLElement&&f.value===0&&(R()||h&&_&&(b.contains(v.target)||(S=x($.beforePanelSentinel))!=null&&S.contains(v.target)||(C=x($.afterPanelSentinel))!=null&&C.contains(v.target)||$.closePopover()))},!0),jt(b.resolveContainers,(v,S)=>{var C;$.closePopover(),Ft(S,Lt.Loose)||(v.preventDefault(),(C=x(h))==null||C.focus())},Y(()=>f.value===0)),()=>{let v={open:f.value===0,close:$.close};return se(H,[se(k,{},()=>Ee({theirProps:{...s,...r},ourProps:{ref:o},slot:v,slots:n,attrs:r,name:"Popover"})),se(b.MainTreeNode)])}}}),ls=we({name:"PopoverButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-popover-button-${ue()}`}},inheritAttrs:!1,setup(s,{attrs:n,slots:r,expose:c}){let t=Me("PopoverButton"),o=Y(()=>Oe(t.button));c({el:t.button,$el:t.button}),Ge(()=>{t.buttonId.value=s.id}),Xe(()=>{t.buttonId.value=null});let f=nt(),h=f==null?void 0:f.closeOthers,L=rs(),D=Y(()=>L===null?!1:L.value===t.panelId.value),_=M(null),N=`headlessui-focus-sentinel-${ue()}`;D.value||Pe(()=>{t.button.value=_.value});let A=Ot(Y(()=>({as:s.as,type:n.type})),_);function $(b){var R,v,S,C,U;if(D.value){if(t.popoverState.value===1)return;switch(b.key){case oe.Space:case oe.Enter:b.preventDefault(),(v=(R=b.target).click)==null||v.call(R),t.closePopover(),(S=x(t.button))==null||S.focus();break}}else switch(b.key){case oe.Space:case oe.Enter:b.preventDefault(),b.stopPropagation(),t.popoverState.value===1&&(h==null||h(t.buttonId.value)),t.togglePopover();break;case oe.Escape:if(t.popoverState.value!==0)return h==null?void 0:h(t.buttonId.value);if(!x(t.button)||(C=o.value)!=null&&C.activeElement&&!((U=x(t.button))!=null&&U.contains(o.value.activeElement)))return;b.preventDefault(),b.stopPropagation(),t.closePopover();break}}function O(b){D.value||b.key===oe.Space&&b.preventDefault()}function I(b){var R,v;s.disabled||(D.value?(t.closePopover(),(R=x(t.button))==null||R.focus()):(b.preventDefault(),b.stopPropagation(),t.popoverState.value===1&&(h==null||h(t.buttonId.value)),t.togglePopover(),(v=x(t.button))==null||v.focus()))}function d(b){b.preventDefault(),b.stopPropagation()}let a=st();function k(){let b=x(t.panel);if(!b)return;function R(){de(a.value,{[ee.Forwards]:()=>ne(b,te.First),[ee.Backwards]:()=>ne(b,te.Last)})===Ie.Error&&ne(Be().filter(v=>v.dataset.headlessuiFocusGuard!=="true"),de(a.value,{[ee.Forwards]:te.Next,[ee.Backwards]:te.Previous}),{relativeTo:x(t.button)})}R()}return()=>{let b=t.popoverState.value===0,R={open:b},{id:v,...S}=s,C=D.value?{ref:_,type:A.value,onKeydown:$,onClick:I}:{ref:_,id:v,type:A.value,"aria-expanded":t.popoverState.value===0,"aria-controls":x(t.panel)?t.panelId.value:void 0,disabled:s.disabled?!0:void 0,onKeydown:$,onKeyup:O,onClick:I,onMousedown:d};return se(H,[Ee({ourProps:C,theirProps:{...n,...S},slot:R,attrs:n,slots:r,name:"PopoverButton"}),b&&!D.value&&t.isPortalled.value&&se(Te,{id:N,features:Ce.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:k})])}}}),is=we({name:"PopoverPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},focus:{type:Boolean,default:!1},id:{type:String,default:()=>`headlessui-popover-panel-${ue()}`}},inheritAttrs:!1,setup(s,{attrs:n,slots:r,expose:c}){let{focus:t}=s,o=Me("PopoverPanel"),f=Y(()=>Oe(o.panel)),h=`headlessui-focus-sentinel-before-${ue()}`,L=`headlessui-focus-sentinel-after-${ue()}`;c({el:o.panel,$el:o.panel}),Ge(()=>{o.panelId.value=s.id}),Xe(()=>{o.panelId.value=null}),He(rt,o.panelId),Pe(()=>{var d,a;if(!t||o.popoverState.value!==0||!o.panel)return;let k=(d=f.value)==null?void 0:d.activeElement;(a=x(o.panel))!=null&&a.contains(k)||ne(x(o.panel),te.First)});let D=Nt(),_=Y(()=>D!==null?(D.value&xe.Open)===xe.Open:o.popoverState.value===0);function N(d){var a,k;switch(d.key){case oe.Escape:if(o.popoverState.value!==0||!x(o.panel)||f.value&&!((a=x(o.panel))!=null&&a.contains(f.value.activeElement)))return;d.preventDefault(),d.stopPropagation(),o.closePopover(),(k=x(o.button))==null||k.focus();break}}function A(d){var a,k,b,R,v;let S=d.relatedTarget;S&&x(o.panel)&&((a=x(o.panel))!=null&&a.contains(S)||(o.closePopover(),((b=(k=x(o.beforePanelSentinel))==null?void 0:k.contains)!=null&&b.call(k,S)||(v=(R=x(o.afterPanelSentinel))==null?void 0:R.contains)!=null&&v.call(R,S))&&S.focus({preventScroll:!0})))}let $=st();function O(){let d=x(o.panel);if(!d)return;function a(){de($.value,{[ee.Forwards]:()=>{var k;ne(d,te.First)===Ie.Error&&((k=x(o.afterPanelSentinel))==null||k.focus())},[ee.Backwards]:()=>{var k;(k=x(o.button))==null||k.focus({preventScroll:!0})}})}a()}function I(){let d=x(o.panel);if(!d)return;function a(){de($.value,{[ee.Forwards]:()=>{let k=x(o.button),b=x(o.panel);if(!k)return;let R=Be(),v=R.indexOf(k),S=R.slice(0,v+1),C=[...R.slice(v+1),...S];for(let U of C.slice())if(U.dataset.headlessuiFocusGuard==="true"||b!=null&&b.contains(U)){let re=C.indexOf(U);re!==-1&&C.splice(re,1)}ne(C,te.First,{sorted:!1})},[ee.Backwards]:()=>{var k;ne(d,te.Previous)===Ie.Error&&((k=x(o.button))==null||k.focus())}})}a()}return()=>{let d={open:o.popoverState.value===0,close:o.close},{id:a,focus:k,...b}=s,R={ref:o.panel,id:a,onKeydown:N,onFocusout:t&&o.popoverState.value===0?A:void 0,tabIndex:-1};return Ee({ourProps:R,theirProps:{...n,...b},attrs:n,slot:d,slots:{...r,default:(...v)=>{var S;return[se(H,[_.value&&o.isPortalled.value&&se(Te,{id:h,ref:o.beforePanelSentinel,features:Ce.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:O}),(S=r.default)==null?void 0:S.call(r,...v),_.value&&o.isPortalled.value&&se(Te,{id:L,ref:o.afterPanelSentinel,features:Ce.Focusable,"data-headlessui-focus-guard":!0,as:"button",type:"button",onFocus:I})])]}},features:Ve.RenderStrategy|Ve.Static,visible:_.value,name:"PopoverPanel"})}}});const as={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:fe}},cs={class:"text-sm"};function ds(s,n,r,c,t,o){const f=P("XMarkIcon");return p(),g("button",{class:Ke(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${r.color}-500`])},[e("p",cs,i(r.value.text),1),ae(e("button",{onClick:n[0]||(n[0]=(...h)=>o.removeLabel&&o.removeLabel(...h))},[u(f,{class:"w-4 h-4"})],512),[[ce,r.close]])],2)}const us=me(as,[["render",ds]]),ps={key:0,class:"border rounded print-container mt-10"},ms={class:"rounded-tr rounded-tl border-b px-5 py-5"},_s={class:"flex items-center justify-between"},fs=e("div",{class:"flex items-center space-x-2"},[e("img",{src:yt,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold"},"PATIENT REPORT")],-1),hs={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},bs={class:"font-normal"},vs={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},ys={class:"flex items-center not-italic text-gray-600"},gs={class:"flex items-center not-italic text-gray-600"},xs={class:"flex items-center justify-between mt-5"},ws=e("span",{class:"font-medium"},"Report Date:",-1),ks=e("span",{class:"font-medium"},"No. Printed:",-1),$s=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Ss={class:"w-full mt-2"},Ts=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Cs={class:"border px-2 py-2"},Is=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Ps={class:"border px-2 py-2"},Rs=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Ds={class:"border px-2 py-2"},As=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),js={class:"border px-2 py-2"},Fs=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),Ls={class:"border px-2 py-2",colspan:"2"},Ns={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Os={class:"flex items-center"},Bs={class:"border-collapse border-slate-500 w-full"},Es=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),Ms={class:"border-b border-r px-2 py-2"},Us=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),qs={class:"border-b px-2 py-2"},Vs=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),zs={class:"border-b border-r px-2 py-2"},Hs=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),Gs={class:"border-b px-2 py-2"},Xs=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),Ks={class:"border-b border-r px-2 py-2"},Ys=e("td",{class:"border-b border-r px-2 py-2 font-bold"},"Received By",-1),Ws={class:"border-b px-2 py-2"},Zs={class:"border-collapse w-full"},Js={class:"bg-gray-100 text-gray-600"},Qs=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),eo={colspan:3,class:"px-2 py-2 text-lg font-semibold"},to=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),so={class:"border px-2 py-2 text-left"},oo={class:"p-0 border-b",style:{padding:"0 !important"}},no={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},ro=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1),lo={class:"border-b"},io={class:"border-r px-2 py-2"},ao={class:"px-2 py-2 flex items-center"},co=["innerHTML"],uo={key:0,class:"text-xs"},po={key:1},mo={key:0,class:"border-t border-l px-2 py-2 font-bold"},_o={key:1,class:"border px-2 py-2"},fo={class:"border px-2 py-2"},ho=["innerHTML"],bo={class:"border px-2 py-2"},vo={class:"test-status"},yo=e("p",{class:"font-bold"},"Test Status",-1),go={class:"px-2"},xo={class:"px-2"},wo={class:"px-2"},ko={key:0},$o=e("p",{class:"font-bold"},"Performed By",-1),So={class:"px-2"},To={class:"px-2 mb-2"},Co={key:0,class:"mb-2"},Io=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1),Po={class:"m-2"},Ro=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Do={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},Ao={class:"w-full"},jo=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),Fo={classs:"border-l border-r"},Lo={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},No={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Oo={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Bo=we({__name:"index",setup(s,{expose:n}){const r=_e("token"),c=gt(),t=M([]),o=M({id:0,client_id:0,first_name:"",middle_name:"",last_name:"",sex:"",uuid:"",npid:"",gender:"",phone:"",date_of_birth:"",birth_date_estimated:!1,value:void 0}),f=M([]),h=M([]),L=M(""),D=M(!1),_=Y(()=>(h.value.length>0&&h.value.forEach(l=>{(l.identifier_type==="current_traditional_authority"||l.identifier_type==="physical_address")&&(L.value=l.value)}),L.value));n({initialize:l=>{A(l)}});async function A(l){const T=l.order_id;if(T!=null){const y={route:`${q.tests}/${l.client.id}/report?order_id=${l.order_id}`,method:"GET",token:`${r.value}`},{data:j,error:m}=await V(y);if(j.value){o.value=j.value.client.person,t.value=j.value.client.client_identifiers;let B=j.value.orders.map(G=>{let z=0;return G.tests!==void 0&&(z+=G.tests.filter(ie=>ie.status.toLowerCase()==="verified").length),{...G,tests_verified:z}});f.value=B}m.value&&console.error(m.value)}else{const y={route:`${q.tests}/${l.client.client_id}/report`,method:"GET",token:`${r.value}`},{data:j,error:m}=await V(y);if(j.value){o.value=j.value.client.person,t.value=j.value.client.client_identifiers;let B=j.value.orders.map(G=>{let z=0;return G.tests!==void 0&&(z+=G.tests.filter(ie=>ie.status.toLowerCase()==="verified").length),{...G,tests_verified:z}});f.value=B}m.value&&console.error(m.value)}}function $(l){const T=["specimen-accepted","specimen-rejected"],y=l.find(j=>T.includes(j.status.name));return y?`${y.initiator.first_name} ${y.initiator.last_name}`:""}function O(l){return l!==null?R(l.split("-").join(" ")):""}function I(l,T){const y=l.find(j=>T===j.status.name);return y?{name:`${y.initiator.first_name} ${y.initiator.last_name}`,created_at:y.created_date}:{name:"",created_at:""}}function d(l){return l.map(T=>T.name).join(", ")}function a(l){return[...new Set(l.map(y=>y.department))].join(", ")}function k(l){return l.some(T=>T.test_indicator_type==="numeric")}function b(l){return l=="verified"?l="Authorized":l=l.split("-").map(T=>R(T)).join(" "),l}function R(l){return l.charAt(0).toUpperCase()+l.slice(1)}function v(l){return l.tests.some(T=>T.suscept_test_result.length!==0)}function S(l){return l.filter(T=>T.zone!==null)}function C(l,T){return T.length>0?`Growth of ${T.map(y=>y.name).join(", ")}`:l}function U(l){return l.reduce((T,y)=>T+y.print_count,0)}function re(l,T){const y=l.sex=="M"?"Male":"Female",j=Number(ye(l.date_of_birth));return T.filter(m=>m.sex===y&&j>Number(m.min_age)&&j<Number(m.max_age)||m.sex==="Both"&&j>Number(m.min_age)&&j<Number(m.max_age))[0]}function le(l,T,y){let j=null;return k(l)&&(j=re(T,y.indicator_ranges)),j}function he(l){return l[0].result.machine_name}function $e(l){const T=new Set(["completed","verified"]);return l.filter(y=>T.has(y.status.toLowerCase()))}return(l,T)=>(p(),g("div",null,[w(f).length>0?(p(),g("div",ps,[e("div",ms,[e("div",_s,[fs,e("div",hs,[e("address",bs,[e("span",vs,i(w(c).details.name),1),e("span",ys,i(w(c).details.address),1),e("span",gs,i(w(c).details.phone),1)])])]),e("div",xs,[e("div",null,[ws,Z(" "+i(w(K)(new Date).format("dateFormat"in l?l.dateFormat:w(Q))),1)]),e("div",null,[ks,Z(" "+i(U(w(f))),1)]),e("div",null,[$s,Z(" "+i(w(f).length>0&&w(K)(w(f)[0].sample_collection_time).format("dateFormat"in l?l.dateFormat:w(Q))),1)])]),e("table",Ss,[e("tbody",null,[e("tr",null,[Ts,e("td",Cs,i(`${w(o).first_name} ${w(o).middle_name?w(o).middle_name:""} ${w(o).last_name}`),1),Is,e("td",Ps,i(w(o).sex==="F"?"Female":"Male"),1),Rs,e("td",Ds,i(("calculateAge"in l?l.calculateAge:w(ye))(w(o).date_of_birth))+" yr(s) ",1)]),e("tr",null,[As,e("td",js,i(w(o).id),1),Fs,e("td",Ls,i(w(_)),1)])])])]),(p(!0),g(H,null,X(w(f),(y,j)=>(p(),g("div",{key:j},[e("div",Ns,[e("div",Os," Accession No: "+i(y.accession_number),1),e("div",null," Requested By: "+i(y.requested_by)+" ("+i(y.requesting_ward)+") ",1)]),e("table",Bs,[e("tbody",null,[e("tr",null,[Es,e("td",Ms,i(y.specimen),1),Us,e("td",qs,i(w(K)(y.created_date).format("dateFormat"in l?l.dateFormat:w(Q))),1)]),e("tr",null,[Vs,e("td",zs,i(d(y.test_types)),1),Hs,e("td",Gs,i(a(y.test_types)),1)]),e("tr",null,[Xs,e("td",Ks,i(O(y.order_status)),1),Ys,e("td",Ws,i($(y.order_status_trail)),1)])])]),e("table",Zs,[e("thead",null,[e("tr",Js,[Qs,e("th",eo," Tests Authorized("+i(y.tests_verified)+") ",1)])]),e("tbody",null,[to,(p(!0),g(H,null,X(w(D)?y.tests:$e(y.tests),m=>(p(),g("tr",{key:m.id},[e("td",so,i(m.test_type_name),1),e("td",oo,[e("table",no,[ro,e("tbody",lo,[(p(!0),g(H,null,X(m.indicators,(B,G)=>{var z,ie,Ue;return p(),g("tr",{key:G,class:"border-b"},[e("td",io,i(B.name),1),e("td",ao,[e("p",{innerHTML:C(((z=B.result)==null?void 0:z.value)??"",m==null?void 0:m.suscept_test_result)},null,8,co),(ie=B.result)!=null&&ie.value?(p(),g("span",uo,i((m==null?void 0:m.suscept_test_result.length)>0?"":B==null?void 0:B.unit),1)):E("",!0),(Ue=B.result)!=null&&Ue.value?E("",!0):(p(),g("span",po,"Not done"))]),le(m.indicators,w(o),B)!==void 0&&le(m.indicators,w(o),B)!==null?(p(),g("td",mo," ("+i(le(m.indicators,w(o),B).lower_range)+" - "+i(le(m.indicators,w(o),B).upper_range)+") ",1)):(p(),g("td",_o,"N/A"))])}),128))])])]),e("td",fo,[e("p",{innerHTML:m!=null&&m.result_remarks?m==null?void 0:m.result_remarks.value:"N/A"},null,8,ho)]),e("td",bo,[e("div",vo,[yo,e("p",go,i(b(m.status)),1),e("p",xo," By: "+i(I(m.status_trail,m.status).name),1),e("p",wo," On: "+i(w(K)(I(m.status_trail,m.status).created_at).format("dateFormat"in l?l.dateFormat:w(Q))),1)]),I(m.status_trail,"completed").name?(p(),g("div",ko,[$o,e("p",So,i(I(m.status_trail,"completed").name),1),e("p",To," On: "+i(w(K)(I(m.status_trail,"completed").created_at).format("dateFormat"in l?l.dateFormat:w(Q))),1),he(m.indicators)?(p(),g("div",Co,[Io,e("p",null,i(he(m.indicators)),1)])):E("",!0)])):E("",!0)])]))),128))])]),ae(e("div",Po,[Ro,e("div",null,[(p(!0),g(H,null,X(y.tests,m=>(p(),g("div",{class:"grid grid-cols-2 gap-4",key:m.id},[m.test_type_name.toLowerCase().includes("culture")?(p(!0),g(H,{key:0},X(m.suscept_test_result,(B,G)=>(p(),g("div",{key:G},[e("div",Do,i(B.name),1),e("table",Ao,[jo,e("tbody",Fo,[(p(!0),g(H,null,X(S(B.drugs),z=>(p(),g("tr",{key:z.drug_id},[e("th",Lo,i(z.name),1),e("th",No,i(z.zone),1),e("th",Oo,i(z.interpretation),1)]))),128))])])]))),128)):E("",!0)]))),128))])],512),[[ce,v(y)]])]))),128))])):E("",!0)]))}}),Eo={components:{TransitionRoot:Ae,TransitionChild:je,Dialog:Fe,DialogPanel:Le,DialogTitle:Ne,XMarkIcon:fe,UserIcon:Je},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:De,saveIcon:et,clearIcon:tt,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:_e("token"),authStore:Se(),departmentId:0}},methods:{async init(){this.handleClick();const s=this.authStore.department,n=this.authStore.user.departments.find(r=>r.name===s);n&&(this.departmentId=n.id),this.selectedDepartment=s,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(s){const n={route:`${q.specimenTestTypes}?department_id=${s}&specimen_id=${this.item.specimen_id}`,method:"GET",token:`${this.cookie}`},{error:r,data:c}=await V(n);c.value&&(this.rawTestTypes=c.value,this.testTypes=c.value),r.value&&console.error("error: ",r.value)},async submitForm(){this.loading=!0;let s=this.testTypesSelected.map(t=>({specimen:this.item.specimen_id,test_type:t}));const n={route:`${q.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:s}},{data:r,error:c}=await V(n);r.value&&(this.handleClick(),W().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),c.value&&(this.handleClick(),console.error("error: ",c.value),W().$toast.error(pe),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(s,n){if(s!==n){const r=this.authStore.user.departments.find(c=>c.name===s);r&&(this.departmentId=r.id,this.getTestTypes(this.departmentId))}}}},Mo=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Uo={class:"fixed inset-0 overflow-y-auto"},qo={class:"flex min-h-full items-center justify-center p-4 text-center"},Vo={class:"border-b px-3 py-3 flex items-center justify-between"},zo={class:"mt-2 space-y-3 pb-40"},Ho={class:"w-full flex flex-col space-y-2 px-5"},Go=e("label",{class:"font-medium"},"Department",-1),Xo={class:"w-full flex flex-col space-y-2 px-5"},Ko=e("label",{class:"font-medium"},"Tests",-1),Yo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Wo(s,n,r,c,t,o){const f=ke,h=P("TransitionChild"),L=P("DialogTitle"),D=P("XMarkIcon"),_=P("multi-select"),N=Ze,A=P("FormKit"),$=P("DialogPanel"),O=P("Dialog"),I=P("TransitionRoot");return p(),g("div",null,[e("div",null,[u(f,{text:"Add test to current order",color:"warning",icon:t.editIcon,click:o.init},null,8,["icon","click"])]),u(I,{appear:"",show:t.open,as:"template"},{default:F(()=>[u(O,{as:"div",onClose:o.handleClick,class:"relative z-10"},{default:F(()=>[u(h,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:F(()=>[Mo]),_:1}),e("div",Uo,[e("div",qo,[u(h,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:F(()=>[u($,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:F(()=>[e("div",Vo,[u(L,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:F(()=>[Z(" Add Test To Current Order ")]),_:1}),e("button",{onClick:n[0]||(n[0]=(...d)=>o.handleClick&&o.handleClick(...d))},[u(D,{class:"w-5 h-5"})])]),u(A,{type:"form","submit-label":"Update",onSubmit:o.submitForm,actions:!1,id:"submitForm"},{default:F(({value:d})=>[e("div",zo,[e("div",Ho,[Go,u(_,{style:{"--ms-max-height":"none !important"},modelValue:t.selectedDepartment,"onUpdate:modelValue":n[1]||(n[1]=a=>t.selectedDepartment=a),options:t.departments.map(a=>a.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),e("div",Xo,[Ko,u(_,{style:{"--ms-max-height":"none !important"},modelValue:t.testTypesSelected,"onUpdate:modelValue":n[2]||(n[2]=a=>t.testTypesSelected=a),options:t.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",Yo,[u(N,{type:"button",click:()=>o.resetForm(),text:"Clear form"},null,8,["click"]),u(f,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Zo=me(Eo,[["render",Wo]]),Jo={components:{TransitionRoot:Ae,TransitionChild:je,Dialog:Fe,DialogPanel:Le,DialogTitle:Ne,XMarkIcon:fe,PhoneIcon:_t,EnvelopeIcon:ft,MapPinIcon:ht},data(){return{moment:K,viewIcon:Qe,show:this.open,addIcon:Ye,checkIcon:ve,editIcon:De,acceptIcon:We,printerIcon:St,cookie:_e("token"),details:{},loading:!1,verifying:!1,zebraPrinting:!1}},props:{open:{type:Boolean,required:!1}},methods:{async init(s){this.loading=!0;const n={route:`${q.tests}/${s.id}`,method:"GET",token:`${this.cookie}`},{data:r,error:c,pending:t}=await V(n);this.loading=t,r.value&&(this.details=r.value,typeof this.details=="object"&&this.handleClick()),c.value&&(this.loading=!1,console.error(c.value),W().$toast.error(pe))},async printBBResults(){const s={route:q.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.details.order_id,tests:[this.details],is_cross_match:!0}},{data:n,error:r,pending:c}=await V(s);if(this.zebraPrinting=c,n.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const o=URL.createObjectURL(n.value),f=document.createElement("a");f.href=o,f.setAttribute("download",`${Date.now()}.lbl`),f.click(),URL.revokeObjectURL(o)},t.readAsText(n.value),W().$toast.success("Results printed successfully!")}r.value&&(this.zebraPrinting=!1,W().$toast.error(pe),console.error(r.value))},async changeStatus(s,n){this.verifying=!0;const r={route:`${q.testStatus}/${n}/${s}`,method:"PUT",token:`${this.cookie}`},{data:c,error:t,pending:o}=await V(r);this.verifying=o,c.value&&(this.verifying=!1,W().$toast.success(`${this.details.test_type_name} test for ${this.details.client.first_name} ${this.details.client.middle_name!==null?this.details.client.middle_name:""} ${this.details.client.last_name} verified successfully!`),this.init(this.details),this.updateChanges(),this.$refs.corePrinter!=null&&this.$refs.corePrinter!==void 0&&this.$refs.corePrinter.init(),this.$refs.patientReportTemplate!=null&&this.$refs.patientReportTemplate!==void 0&&this.$refs.patientReportTemplate.initialize(this.details)),t.value&&(console.error(t.value),this.verifying=!1)},updateChanges(){this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return qe.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return qe.printTrackingNumber(this.details.tracking_number)},viewReport(){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}`)},getRequestedBy(s){let n="";return s.forEach(r=>{r.status.name==="pending"&&(n=`${r.initiator.first_name} ${r.initiator.last_name}`)}),ge(n)}}},Qo=""+new URL("prescription_document.18f957e1.svg",import.meta.url).href,en=""+new URL("test_tube.2b522cf2.svg",import.meta.url).href,tn=""+new URL("i_exam_qualification.dd473ba6.svg",import.meta.url).href,sn={key:0},on=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),nn={class:"fixed inset-0 overflow-y-auto"},rn={class:"flex min-h-full items-center justify-center text-center"},ln={class:"border-b px-3 py-3 flex items-center justify-between"},an=e("img",{src:Qo,class:"w-8 h-8 mr-2"},null,-1),cn={class:"flex items-center justify-center mx-auto my-20"},dn={class:"grid grid-cols-3 gap-4 px-5 py-5"},un={class:"rounded border"},pn=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:ct,class:"w-7 h-7 mr-1"}),Z(" Patient ")])],-1),mn={class:"w-full space-y-2 py-2"},_n={class:"w-full flex justify-between px-4 py-1"},fn=e("h3",{class:"font-semibold"},"Patient Number",-1),hn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},bn=e("h3",{class:"font-semibold"},"Name",-1),vn={class:"w-full flex justify-between px-4 py-1"},yn=e("h3",{class:"font-semibold"},"Sex",-1),gn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},xn=e("h3",{class:"font-semibold"},"Age",-1),wn={class:"rounded border"},kn=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:en,class:"w-7 h-7 mr-1"}),Z(" Specimen ")])],-1),$n={class:"w-full space-y-2 py-2"},Sn={class:"w-full flex justify-between px-4 py-1"},Tn=e("h3",{class:"font-semibold"},"Specimen Type",-1),Cn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},In=e("h3",{class:"font-semibold"},"Tracking Number",-1),Pn={class:"w-full flex justify-between px-4 py-1"},Rn=e("h3",{class:"font-semibold"},"Accession Number",-1),Dn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},An=e("h3",{class:"font-semibold"},"Status",-1),jn={class:"rounded border max-h-72 overflow-y-auto"},Fn=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[e("img",{src:tn,class:"w-7 h-7 mr-1"}),e("h3",{class:"text-lg font-semibold text-black"},"Test")],-1),Ln={class:"w-full space-y-2 py-2"},Nn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},On=e("h3",{class:"font-semibold"},"Name",-1),Bn={class:"w-full flex justify-between px-4 py-1"},En=e("h3",{class:"font-semibold"},"Date Registered",-1),Mn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Un=e("h3",{class:"font-semibold"},"Receipt Date",-1),qn={class:"w-full flex justify-between px-4 py-1"},Vn=e("h3",{class:"font-semibold"},"Test Status",-1),zn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Hn=e("h3",{class:"font-semibold"},"Ward/Location",-1),Gn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Xn=e("h3",{class:"font-semibold"},"Request Origin",-1),Kn={class:"w-full flex justify-between px-4 py-1"},Yn=e("h3",{class:"font-semibold"},"Registered By",-1),Wn={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Zn=e("h3",{class:"font-semibold"},"Requested By",-1),Jn={class:"mx-5 rounded border mb-5"},Qn={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},er=e("h3",{class:"text-lg font-semibold text-black"},"Results",-1),tr={class:"justify-end flex items-center space-x-3"},sr={class:"flex items-center space-x-1"},or=["innerHTML"],nr={key:1,class:"text-xs"},rr={key:0,class:"px-2.5 py-2.5 border-t"};function lr(s,n,r,c,t,o){const f=mt,h=Bo,L=P("TransitionChild"),D=P("DialogTitle"),_=P("XMarkIcon"),N=xt,A=ke,$=Zo,O=P("DialogPanel"),I=P("Dialog"),d=P("TransitionRoot");return p(),g("div",null,[at(s.$slots,"default",{onClick:n[0]||(n[0]=(...a)=>o.init&&o.init(...a))}),t.details!==null&&t.details.client!==void 0?(p(),g("div",sn,[u(f,{class:"hidden",ref:"corePrinter",orderId:`${t.details.order_id}`,id:`${t.details.client.id}`},null,8,["orderId","id"])])):E("",!0),u(h,{class:"hidden",ref:"patientReportTemplate"},null,512),u(d,{appear:"",show:t.show,as:"template"},{default:F(()=>[u(I,{as:"div",class:"relative z-10"},{default:F(()=>[u(L,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:F(()=>[on]),_:1}),e("div",nn,[e("div",rn,[u(L,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:F(()=>[u(O,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:F(()=>[e("div",ln,[u(D,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:F(()=>[an,Z(" View Test ")]),_:1}),e("button",{onClick:n[1]||(n[1]=(...a)=>o.handleClick&&o.handleClick(...a))},[u(_,{class:"w-5 h-5"})])]),ae(e("div",cn,[u(N,{loading:t.loading},null,8,["loading"])],512),[[ce,t.loading]]),e("div",dn,[e("div",un,[pn,e("div",mn,[e("div",_n,[fn,e("p",null,i(t.details.client.id),1)]),e("div",hn,[bn,e("p",null,i(("capitalize"in s?s.capitalize:w(ge))(`${t.details.client.first_name} ${t.details.client.middle_name!==null?t.details.client.middle_name:""} ${t.details.client.last_name}`)),1)]),e("div",vn,[yn,e("p",null,i(t.details.client.sex),1)]),e("div",gn,[xn,e("p",null,i(("calculateAge"in s?s.calculateAge:w(ye))(t.details.client.date_of_birth)),1)])])]),e("div",wn,[kn,e("div",$n,[e("div",Sn,[Tn,e("p",null,i(t.details.specimen_type),1)]),e("div",Cn,[In,e("p",null,i(t.details.tracking_number),1)]),e("div",Pn,[Rn,e("p",null,i(t.details.accession_number),1)]),e("div",Dn,[An,e("p",null,i(("capitalize"in s?s.capitalize:w(ge))(t.details.order_status.split("-").join(" "))),1)])])]),e("div",jn,[Fn,e("div",Ln,[e("div",Nn,[On,e("p",null,i(t.details.test_type_name),1)]),e("div",Bn,[En,e("p",null,i(t.moment(t.details.created_date).format("dateFormat"in s?s.dateFormat:w(Q))),1)]),e("div",Mn,[Un,e("p",null,i(t.moment(t.details.updated_date).format("dateFormat"in s?s.dateFormat:w(Q))),1)]),e("div",qn,[Vn,e("p",null,i(("capitalizeStr"in s?s.capitalizeStr:w(bt))(t.details.status.split("-").join(" "))),1)]),e("div",zn,[Hn,e("p",null,i(t.details.requesting_ward),1)]),e("div",Gn,[Xn,e("p",null,i(t.details.request_origin),1)]),e("div",Kn,[Yn,e("p",null,i(o.getRequestedBy(t.details.status_trail)),1)]),e("div",Wn,[Zn,e("p",null,i(t.details.requested_by),1)])])])]),e("div",Jn,[e("div",Qn,[er,e("div",tr,[t.details.status.toLowerCase()==="completed"?(p(),J(A,{key:0,icon:t.checkIcon,text:"Authorize",click:()=>{o.changeStatus("verified",t.details.id)},color:"success",loading:t.verifying},null,8,["icon","click","loading"])):E("",!0),t.details.status.toLowerCase()==="completed"||t.details.status.toLowerCase()==="verified"?(p(),J(A,{key:1,icon:t.viewIcon,text:"View Report",click:o.viewReport,color:"primary"},null,8,["icon","click"])):E("",!0),u($,{item:t.details,onUpdate:o.updateChanges,color:"primary"},null,8,["item","onUpdate"]),u(A,{icon:t.printerIcon,text:"Print Accession Number",click:o.printAccessionNumber,color:"primary"},null,8,["icon","click"]),u(A,{icon:t.printerIcon,color:"success",text:"Print Tracking Number",click:o.printTrackingNumber},null,8,["icon","click"])])]),(p(!0),g(H,null,X(t.details.indicators,(a,k)=>{var b;return p(),g("div",{class:Ke(t.details.indicators.length!==k+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:k},[e("h3",null,i(a.name),1),e("div",sr,[a.result?(p(),g("p",{key:0,innerHTML:a.result.value?a.result.value:"Not done"},null,8,or)):E("",!0),(b=a.result)!=null&&b.value?(p(),g("span",nr,i(a==null?void 0:a.unit),1)):E("",!0)])],2)}),128)),t.details.test_type_name=="Cross-match"&&t.details.status.toLowerCase()=="verified"?(p(),g("div",rr,[u(A,{loading:t.zebraPrinting,click:()=>{o.printBBResults()},text:"Print results",color:"primary",icon:t.printerIcon},null,8,["loading","click","icon"])])):E("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const ir=me(Jo,[["render",lr]]),ar={components:{TransitionRoot:Ae,TransitionChild:je,Dialog:Fe,DialogPanel:Le,DialogTitle:Ne,XMarkIcon:fe,UserIcon:Je},data(){return{open:!1,addIcon:Ye,saveIcon:et,clearIcon:tt,name:"",description:"",loading:!1,cookie:_e("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const s={route:q.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:n,data:r}=await V(s);r.value&&(this.rawReasons=r.value,r.value.map(c=>{this.reasons.push(c.description)})),n.value&&console.error(n.value)},async submitForm(){this.loading=!0;let s=null;this.rawReasons.map(o=>{o.description===this.reasonsSelected&&(s=o.id)});const n={route:`${q.testStatus}/${this.item.id}/${this.action}?status_reason_id=${s}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:r,error:c,pending:t}=await V(n);this.loading=t,r.value&&(W().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),c.value&&(console.error(c.value),W().$toast.error(pe),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},cr=""+new URL("rdt_result_no_test.6a8034c1.svg",import.meta.url).href,dr=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),ur={class:"fixed inset-0 overflow-y-auto"},pr={class:"flex min-h-full items-center justify-center p-4 text-center"},mr={class:"border-b px-3 py-3 flex items-center justify-between"},_r=e("img",{src:cr,class:"w-8 h-8 mr-2"},null,-1),fr={class:"mt-2 space-y-3 px-5 py-5"},hr={class:"space-y-2"},br=e("h3",{class:"font-medium"},"Test Type",-1),vr={class:"border-b border-dotted text-gray-600"},yr={class:"space-y-2"},gr=e("h3",{class:"font-medium"},"Specimen",-1),xr={class:"border-b border-dotted text-gray-600"},wr={class:"space-y-2"},kr=e("h3",{class:"font-medium"},"Accession Number",-1),$r={class:"border-b border-dotted text-gray-600"},Sr={class:"w-full flex items-center"},Tr={class:"w-full flex flex-col space-y-2"},Cr={class:"w-full flex flex-col space-y-2 pb-40"},Ir=e("label",{class:"font-medium"},"Select Reason(s)",-1),Pr={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Rr(s,n,r,c,t,o){const f=ke,h=P("TransitionChild"),L=P("DialogTitle"),D=P("XMarkIcon"),_=P("FormKit"),N=P("multi-select"),A=Ze,$=P("DialogPanel"),O=P("Dialog"),I=P("TransitionRoot");return p(),g("div",null,[e("div",null,[u(f,{text:r.text,color:"error",icon:r.icon,click:o.init},null,8,["text","icon","click"])]),u(I,{appear:"",show:t.open,as:"template"},{default:F(()=>[u(O,{as:"div",onClose:o.handleClick,class:"relative z-10"},{default:F(()=>[u(h,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:F(()=>[dr]),_:1}),e("div",ur,[e("div",pr,[u(h,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:F(()=>[u($,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:F(()=>[e("div",mr,[u(L,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:F(()=>[_r,Z(" "+i(r.text.charAt(0).toUpperCase()+r.text.slice(1))+" Reason ",1)]),_:1}),e("button",{onClick:n[0]||(n[0]=(...d)=>o.handleClick&&o.handleClick(...d))},[u(D,{class:"w-5 h-5"})])]),u(_,{type:"form","submit-label":"Update",onSubmit:o.submitForm,actions:!1,id:"rejectionForm"},{default:F(({value:d})=>[e("div",fr,[e("div",hr,[br,e("p",vr,i(r.item.test_type_name),1)]),e("div",yr,[gr,e("p",xr,i(r.item.specimen_type),1)]),e("div",wr,[kr,e("p",$r,i(r.item.accession_number),1)]),e("div",Sr,[e("div",Tr,[u(_,{type:"text",label:"Person Talked To",validation:"required",modelValue:t.name,"onUpdate:modelValue":n[1]||(n[1]=a=>t.name=a)},null,8,["modelValue"])])]),e("div",Cr,[Ir,u(N,{style:{"--ms-max-height":"none !important"},modelValue:t.reasonsSelected,"onUpdate:modelValue":n[2]||(n[2]=a=>t.reasonsSelected=a),options:t.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",Pr,[u(A,{type:"button",text:"Clear form",click:o.resetForm},null,8,["click"]),u(f,{loading:t.loading,type:"submit",click:()=>{},color:"success",icon:t.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Dr=me(ar,[["render",Rr]]),Ar={components:{MagnifyingGlassIcon:Pt,Listbox:Ht,ListboxButton:Gt,ListboxLabel:Xt,ListboxOptions:Kt,ListboxOption:Yt,ChevronUpDownIcon:dt,ArrowRightIcon:es,ChevronDownIcon:Rt,Menu:Wt,MenuButton:Zt,MenuItems:Jt,MenuItem:Qt,CheckIcon:Dt,PopoverButton:ls,Popover:lt,PopoverPanel:is,XMarkIcon:fe,CheckCircleIcon:Bt,FunnelIcon:Et},setup(){const s=Se();Ct({title:`${It.name.toUpperCase()} - ${s.department} Tests`})},data(){return{moment:K,addIcon:ze,filterIcon:Mt,applyIcon:ts,acceptIcon:We,viewIcon:Qe,moreActions:!1,okIcon:ve,moreIcon:Ut,lessIcon:qt,clearIcon:Vt,dropIcon:be,editIcon:De,refreshIcon:zt,dateRange:[],search:"",header:"Tests Lists",pages:[{name:"Home",link:"/home"}],headers:[{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions"}],statuses:[{text:"Results",color:"primary",icon:ze,status:"completed",show:"started"},{text:"Accept",color:"success",icon:ve,status:"pending",show:"not-collected"},{text:"Start",color:"warning",icon:ss,status:"started",show:"pending"},{text:"Authorize",color:"success",status:"verified",icon:ve,show:"completed"}],rejectStatuses:[{name:"Reject",icon:be,action:"rejected"},{name:"Void",icon:be,action:"voided"},{name:"Not-done",icon:be,action:"not_done"}],changing:!1,data:new Array,statusSelected:{name:"select status"},searchField:"accession_number",searchValue:"",cookie:_e("token"),loading:!1,serverItemsLength:0,serverOptions:{page:1,rowsPerPage:10,sortBy:"name"},authStore:Se(),testStatuses:new Array,filters:new Array}},created(){this.init()},methods:{async searchNlims(s){this.loading=!0;const n={route:`${q.nlimsTestSearch}?tracking_number=${s.replace(/\$$/,"")}`,method:"GET",token:`${this.cookie}`},{data:r,error:c}=await V(n);r.value&&(vt(r.value),this.loading=!1),c.value&&(console.error(c.value),W().$toast.error(`${c.value.data.error}`),this.loading=!1)},async init(){this.loadStatuses(),this.loading=!0;const{page:s,rowsPerPage:n}=this.serverOptions;let r=this.getIdFromName(this.authStore.user.departments,this.authStore.department),c=this.statusSelected.name==="select status"?"":this.statusSelected.name;const t=this.dateRange!==null&&this.dateRange.length>0?K(this.dateRange[0]).format("YYYY-MM-DD"):"",o=this.dateRange!==null&&this.dateRange.length>1?K(this.dateRange[1]).format("YYYY-MM-DD"):"",f={route:`${q.tests}?minimal=true&page=${s}&per_page=${n}&status=${c.toLowerCase()}&search=${this.search}&department_id=${r}&start_date=${t}&end_date=${o}`,method:"GET",token:`${this.cookie}`},{data:h,error:L,pending:D}=await V(f);this.loading=D,h.value&&(this.data=h.value.data.map(_=>{var N,A,$,O;return{..._,name:`${ge(`${(N=_.client)==null?void 0:N.first_name} ${((A=_.client)==null?void 0:A.middle_name)!==null?_.client.middle_name:""} ${($=_.client)==null?void 0:$.last_name}`)} (${_.client.sex}, ${ye((O=_.client)==null?void 0:O.date_of_birth)} yrs)`,order_status:`${_.order_status!==null?(_.order_status.charAt(0).toUpperCase()+_.order_status.slice(1)).split("-").join(" "):""}`,status:`${_.status!==null?_.status.charAt(0).toUpperCase()+_.status.slice(1):""}`,created_date:K(_.created_date).utcOffset(2).format(Q)}}),this.serverItemsLength=h.value.meta.total_count,this.loading=!1),L.value&&(console.error(L.value.data),W().$toast.error(pe),this.loading=!1)},async loadStatuses(){const s={route:`${q.testStatus}/all`,method:"GET",token:`${this.cookie}`},{data:n,error:r}=await V(s);n.value&&(this.testStatuses=n.value.map(c=>({id:c.id,name:c.name.charAt(0).toUpperCase()+c.name.slice(1)}))),r.value&&console.error(r.value)},async changeStatus(s,n){this.loading=!0;const r={route:`${q.testStatus}/${n}/${s}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:c,error:t,pending:o}=await V(r);this.loading=o,c.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},async changeOrderStatus(s,n){this.loading=!0;const r={route:`${q.orderStatus}/${s}`,method:"PUT",token:`${this.cookie}`,body:{order_id:n}},{data:c,error:t,pending:o}=await V(r);this.loading=o,c.value&&(this.init(),this.loading=!1),t.value&&(console.error(t.value),this.loading=!1)},checkStatus(s,n){s.status==="completed"?n.test_type_name.toLowerCase().includes("culture")?this.redirect(n,`/tests/result/culture-sensitivity?accession_number=${n.accession_number}&test_id=${n.id}`):this.redirect(n,`/tests/result?accession_number=${n.accession_number}&test_id=${n.id}`):s.status==="verified"?this.openTestsDialog(n):s.status!==""?this.changeStatus(s.status,n.id):this.printTest(n)},printTest(s){print()},getIdFromName(s,n){const r=s.find(c=>c.name===n);return r?r.id:null},updateTests(s){typeof s=="object"&&(this.serverOptions=s),this.init(),this.moreActions=!1},refreshTests(){this.searchValue="",this.search="",this.init()},update(s){this.search=s,this.searchValue=s,s!==""?this.checkTrackingNumber(s)?this.searchNlims(s):this.updateTests(s):this.init()},handleClick(){this.moreActions=!this.moreActions},redirect(s,n){this.$router.push(n)},checkTrackingNumber(s){return/^(x|l).*\d/.test(s.toLowerCase())},updateOnStatus(s){if(s.name!=="select status"){const n=this.filters.find(r=>r.origin==="statuses");n?n.value=s.name:this.filters.push({origin:"statuses",value:s.name})}this.statusSelected=s,this.init()},removeFilter(s){s.origin==="statuses"&&this.statusSelected.name!=="select status"&&this.updateOnStatus({name:"select status"});const n=this.filters.findIndex(r=>r.origin===s.origin);n!==-1&&this.filters.splice(n,1),this.init()},isCompletedByCurrentUserOrSuperAdmin(s){const n=this.authStore.user,r=s.completed_by;if(r){if(r.id!==n.id)return!0;if(r.is_super_admin===!0)return!0}return!1},shouldDisplayButton(s,n){const r=s.status.toLowerCase(),c=n.show.toLowerCase();if(r===c){const t=this.isCompletedByCurrentUserOrSuperAdmin(s);return r==="pending"&&s.order_status.toLowerCase()==="specimen not collected"?!1:t}return!1},hideRejectActions(s){return!["voided","test-rejected","verified","rejected"].includes(s.toLowerCase())},openTestsDialog(s){this.$refs.testsDialog!=null&&this.$refs.testsDialog!==void 0&&this.$refs.testsDialog.init(s)}},watch:{authStore:{handler(){this.init()},deep:!0},dateRange:{handler(){this.init()},deep:!0},statusSelected:{handler(s){this.updateOnStatus(s)},deep:!0}}},jr=""+new URL("experiment-results.d7dc2871.png",import.meta.url).href,Fr={class:"py-5 px-5"},Lr=e("div",{class:"flex items-center space-x-2 py-5"},[e("img",{src:jr,alt:"experiment-results-icon",class:"w-auto h-8"}),e("h3",{class:"text-2xl font-semibold uppercase"},"Tests List")],-1),Nr={class:"flex justify-between items-center w-full py-2 mb-2"},Or={class:"flex items-center space-x-2"},Br={class:"relative z-10 w-40"},Er={class:"pt-1"},Mr={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ur={class:"w-72 ml-2"},qr={class:"py-3 flex items-center space-x-3"},Vr={class:"py-2 flex items-center"},zr={class:"w-full flex items-center justify-between space-x-2"},Hr={class:"flex items-center space-x-2"},Gr={key:0,class:"flex items-center space-x-2"},Xr={key:0,class:"flex items-center space-x-2"},Kr=e("div",{id:"tests-container"},null,-1);function Yr(s,n,r,c,t,o){const f=it,h=ke,L=ut,D=P("FunnelIcon"),_=P("datepicker"),N=pt,A=us,$=ir,O=Dr,I=Tt;return p(),g("div",Fr,[u(f,{pages:t.pages},null,8,["pages"]),Lr,e("div",Nr,[e("div",Or,[u(h,{text:"Refresh",color:"warning",icon:t.refreshIcon,click:()=>{o.refreshTests()},loading:t.loading},null,8,["icon","click","loading"]),e("div",Br,[u(L,{items:t.testStatuses,modelValue:t.statusSelected,"onUpdate:modelValue":n[0]||(n[0]=d=>t.statusSelected=d)},null,8,["items","modelValue"])]),e("div",Er,[e("div",Mr,[u(D,{class:"w-5 h-5 mr-2"}),Z(" Filter By Date Range "),e("div",Ur,[u(_,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:t.dateRange,"onUpdate:modelValue":n[1]||(n[1]=d=>t.dateRange=d)},null,8,["modelValue"])])])])]),u(N,{onUpdate:o.update,search:t.search},null,8,["onUpdate","search"])]),e("div",qr,[(p(!0),g(H,null,X(t.filters,(d,a)=>(p(),J(A,{value:{origin:"statuses",text:d.value},close:"",color:"green",key:a,onUpdate:o.removeFilter},null,8,["value","onUpdate"]))),128))]),u(I,{headers:t.headers,data:t.data,loading:t.loading,searchField:t.searchField,searchValue:t.searchValue,serverItemsLength:t.serverItemsLength,serverOptions:t.serverOptions,onUpdate:o.updateTests},{actions:F(({item:d})=>[e("div",Vr,[e("div",zr,[ae(e("div",Hr,[u($,{ref:"testsDialog",onUpdate:o.updateTests},{default:F(()=>[u(h,{color:"primary",text:"View",icon:t.viewIcon,click:()=>{o.openTestsDialog(d)}},null,8,["icon","click"])]),_:2},1032,["onUpdate"]),d.status.toLowerCase()==="completed"?(p(),J(h,{key:0,click:()=>{o.checkStatus({status:"completed"},d)},text:"Edit",color:"success",icon:t.editIcon},null,8,["click","icon"])):E("",!0),(p(!0),g(H,null,X(t.statuses,(a,k)=>ae((p(),J(h,{color:a.color,text:a.text,icon:a.icon,click:()=>{o.checkStatus(a,d)},key:k},null,8,["color","text","icon","click"])),[[ce,o.shouldDisplayButton(d,a)]])),128)),!d.status.toLowerCase().includes("rejected")&&d.order_status.toLowerCase()==="specimen not collected"?(p(),J(h,{key:1,color:"success",text:"Accept",icon:t.acceptIcon,click:()=>o.changeOrderStatus("accepted",d.order_id)},null,8,["icon","click"])):E("",!0)],512),[[ce,!t.moreActions]]),o.hideRejectActions(d.status)?(p(),J(h,{key:0,click:o.handleClick,color:"",text:"",icon:t.moreActions==!0?t.lessIcon:t.moreIcon},null,8,["click","icon"])):E("",!0)]),o.hideRejectActions(d.status)?ae((p(),g("div",Gr,[o.hideRejectActions(d.status)?(p(),g("div",Xr,[(p(!0),g(H,null,X(t.rejectStatuses,(a,k)=>(p(),J(O,{item:d,key:k,text:a.name,icon:a.icon,action:a.action,onUpdate:o.updateTests},null,8,["item","text","icon","action","onUpdate"]))),128))])):E("",!0)],512)),[[ce,t.moreActions]]):E("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"]),Kr])}const Nl=me(Ar,[["render",Yr]]);export{Nl as default};
