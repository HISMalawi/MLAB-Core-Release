import{_ as C}from"./Breadcrumb.vue.7469196c.js";import{_ as E}from"./Dropdown.57ff97da.js";import{u as V,a as j,b as f,_ as P,g as x,o as l,c as d,d as m,e as t,t as a,h as S,i as A,l as k,F as p,r as _,f as B}from"./entry.3ba6d4d3.js";import{_ as I}from"./index.926fd39d.js";import{e as L,d as v}from"./constants.1010fcbd.js";import{h,e as D,f as T}from"./fetch.17eaab73.js";import{u as N}from"./facility.8721fb0c.js";import{k as U}from"./vue-doc-download.966702c9.js";import{P as q}from"./package.babe1e72.js";import{r as G}from"./ArrowPathIcon.36a7e1d6.js";import{r as H}from"./DocumentTextIcon.9e480cdd.js";import{_ as O}from"./logo.dd361e1d.js";import"./nuxt-link.24ac1730.js";import"./HomeIcon.e4f6e8f1.js";import"./listbox.752e36d3.js";import"./hidden.c42221ac.js";import"./use-text-value.1a122419.js";import"./CheckIcon.7ae673cc.js";import"./CheckCircleIcon.78484015.js";import"./MagnifyingGlassIcon.7fabd2c6.js";import"./jspdf.es.min.a1626d9b.js";import"./XMarkIcon.7262efd1.js";import"./PrinterIcon.93c5df84.js";import"./transition.7e81bdc8.js";import"./PencilSquareIcon.ded5f0ed.js";const W={setup(){V({title:`${q.name.toUpperCase()} - Rejected Samples Reports`})},components:{ExportToExcel:U},data(){return{refreshIcon:G,exportIcon:H,moment:h,title:"Rejected Samples Reports",facility:N(),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],departments:new Array,selectedDepartment:{name:"-- select department --"},dateFrom:"",dateTo:"",cookie:j("token"),reportData:{},loading:!1}},created(){this.getDepartments()},computed:{getTotalCountForReport(){const o={};return this.reportData.result.forEach(r=>{r.test_types.forEach(s=>{o[s.name]?o[s.name]+=s.count:o[s.name]=s.count})}),o}},methods:{async getDepartments(){const o={route:D.departments,method:"GET",token:`${this.cookie}`},{data:r,error:s}=await T(o);r.value&&(this.departments=r.value),s.value&&console.error(s.value)},async generateReport(){if(this.validate())f().$toast.warning("Please select a department");else{this.loading=!0;let o=this.dateFrom!=""?h(this.dateFrom).format("YYYY-MM-DD"):"",r=this.dateTo!=""?h(this.dateTo).format("YYYY-MM-DD"):"";const s={route:`${D.aggregateReports}rejected?from=${o}&to=${r}&department=${this.selectedDepartment.id}`,method:"GET",token:`${this.cookie}`},{data:n,error:e,pending:u}=await T(s);this.loading=u,n.value&&(this.loading=!1,this.reportData=n.value.data,console.log(n.value.data),f().$toast.success("Report generated successfully!")),e.value&&(console.log(e.value),this.loading=!1,f().$toast.error(L))}},validate(){return this.selectedDepartment.name=="-- select department --"},hasCountInTestTypes(o,r){return this.reportData.result.find(n=>n.name===o).test_types.some(n=>n.ward===r&&n.count>0)},getCountForWard(o,r){const n=this.reportData.result.find(e=>e.name===o).test_types.find(e=>e.ward===r);return n?n.count:0}}},z={class:"px-5 py-5"},J={class:"flex items-center justify-between py-5"},K={class:"text-2xl font-semibold"},Q={class:"w-full flex items-center justify-between"},X={class:"flex items-center space-x-3"},Z={class:"w-40"},$={class:"w-40"},ee={class:"w-44"},te={class:"flex items-center space-x-3"},oe={class:"mt-3"},re={class:"text-lg font-semibold mb-2"},se={class:"text-normal font-normal"},ne={class:"border rounded print-container",id:"print-container"},ae={class:"bg-gray-50 rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},le=t("img",{src:O,alt:"app-logo",class:"w-24 h-24 object-cover"},null,-1),de={class:"space-y-2 py-5"},ie={class:"uppercase font-medium"},ce={class:"uppercase font-medium"},me={class:"uppercase font-medium"},pe=t("p",{class:"uppercase font-medium underline"},"Laboratory Report",-1),ue={class:"mt-10"},_e={class:"w-full border border-dotted rounded overflow-x-auto"},fe={class:"bg-gray-50 border-b border-dotted rounded-t"},he=t("th",{class:"border-r"},null,-1),be=["colspan"],ge=t("th",null,"TOTAL",-1),ye=t("td",{class:"border-r border-b border-dotted px-2 py-2"},null,-1),xe={class:"border-r border-b border-dotted px-2 py-2"},ke={class:"border-r border-t border-b border-dotted px-2 py-2"};function ve(o,r,s,n,e,u){const w=C,b=x("datepicker"),F=E,g=B,R=I,Y=x("ExportToExcel");return l(),d("div",z,[m(w,{pages:e.pages},null,8,["pages"]),t("div",J,[t("h3",K,a(e.title),1)]),t("div",Q,[t("div",X,[t("div",Z,[m(b,{position:"left",range:!1,placeholder:"-- start date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateFrom,"onUpdate:modelValue":r[0]||(r[0]=i=>e.dateFrom=i),format:"dd/MM/yyyy"},null,8,["modelValue"])]),t("div",$,[m(b,{range:!1,placeholder:"-- end date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateTo,"onUpdate:modelValue":r[1]||(r[1]=i=>e.dateTo=i),format:"dd/MM/yyyy"},null,8,["modelValue"])]),t("div",ee,[m(F,{items:e.departments,modelValue:e.selectedDepartment,"onUpdate:modelValue":r[2]||(r[2]=i=>e.selectedDepartment=i)},null,8,["items","modelValue"])]),t("div",null,[m(g,{color:"success",text:"Generate Report",icon:e.refreshIcon,click:()=>u.generateReport()},null,8,["icon","click"])])]),t("div",te,[m(R,{printSmallLabel:!1}),m(Y,{element:"print-container",filename:`rejected_samples_report_from_${e.moment(e.dateFrom).format("DD_MM_YYYY")}_to_${e.moment(e.dateTo).format("DD_MM_YYYY")}`},{default:S(()=>[m(g,{click:()=>{},text:"Export",color:"success",icon:e.exportIcon},null,8,["icon"])]),_:1},8,["filename"])])]),t("div",oe,[t("h3",re,[A("Tests Performed Period: "),t("span",se,a(e.dateFrom!=""?e.moment(e.dateFrom).format("dateFormat"in o?o.dateFormat:k(v)):"")+" - "+a(e.dateTo!=""?e.moment(e.dateTo).format("dateFormat"in o?o.dateFormat:k(v)):""),1)])]),t("div",ne,[t("div",ae,[le,t("div",de,[t("p",ie,a(e.facility.details.name),1),t("p",ce,a(e.facility.details.address),1),t("p",me,a(e.facility.details.phone),1),pe])]),t("div",ue,[t("table",_e,[(l(!0),d(p,null,_(e.reportData.result,(i,M)=>(l(),d(p,{key:M},[t("thead",fe,[t("tr",null,[he,t("th",{colspan:e.reportData.wards.length,class:"px-5 py-2 border-r"},a(i.name),9,be),ge])]),t("tbody",null,[t("tr",null,[ye,(l(!0),d(p,null,_(e.reportData.wards,c=>(l(),d("td",{key:c,class:"border-r border-b border-dotted px-2 py-2"},a(c),1))),128))]),(l(!0),d(p,null,_(i.test_types,c=>(l(),d("tr",{key:c.name},[t("td",xe,a(c.name),1),(l(!0),d(p,null,_(e.reportData.wards,y=>(l(),d("td",{key:y,class:"border-r border-b border-dotted px-2 py-2"},a(c.ward===y?c.count:0),1))),128)),t("td",ke,a(u.getTotalCountForReport[c.name]),1)]))),128))])],64))),128))])])])])}const Je=P(W,[["render",ve]]);export{Je as default};
