import{_ as ze}from"./CRuJk1iG.js";import{b as d,e as c,g as t,s as Ke,i as U,v as G,F as N,k as I,K as x,d as We,I as Je,$ as Qe,r as o,a as Xe,u as ve,J as et,c as h,o as tt,x as H,f as v,h as s,t as i,z as w,L as _e,D as k,H as ge,A as st,l as $,m as T,a2 as nt,E as ot,_ as lt,n as at}from"./DbJ6VTtH.js";import{_ as rt}from"./DWLbqF1n.js";import{u as ye,P as it}from"./BWLa3Ypm.js";import{P as ut}from"./BJRIIcKh.js";import{u as dt}from"./BoB3wlvU.js";import{r as ct}from"./nNMAiyHf.js";import{r as pt}from"./Dqw-T9oa.js";import{r as mt}from"./CShMPq9h.js";import{r as ft}from"./CkbGasXy.js";import"./CCijkVrC.js";import"./DXbs9UP2.js";import"./DrWiBr7_.js";import"./BAOx6ser.js";import"./BpK1kqyf.js";import"./BSqQh_RF.js";import"./DSMSy7oD.js";import"./D-AVtor4.js";import"./CkQvy5WJ.js";import"./mn5DLNYF.js";function vt(O,_){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M2.625 6.75a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0A.75.75 0 0 1 8.25 6h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75ZM2.625 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0ZM7.5 12a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12A.75.75 0 0 1 7.5 12Zm-4.875 5.25a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0a.75.75 0 0 1 .75-.75h12a.75.75 0 0 1 0 1.5h-12a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}function _t(O,_){return d(),c("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M15 3.75H9v16.5h6V3.75ZM16.5 20.25h3.375c1.035 0 1.875-.84 1.875-1.875V5.625c0-1.036-.84-1.875-1.875-1.875H16.5v16.5ZM4.125 3.75H7.5v16.5H4.125a1.875 1.875 0 0 1-1.875-1.875V5.625c0-1.036.84-1.875 1.875-1.875Z"})])}const gt={props:{loading:{required:!0,type:Boolean},isGrid:{required:!0,type:Boolean}}},yt={class:"py-3 px-3"};function bt(O,_,b,V,C,R){return U((d(),c("div",yt,[t("div",{class:x({"grid grid-cols-3 gap-3":b.isGrid,"flex flex-col gap-3":!b.isGrid})},[(d(),c(N,null,I(6,P=>t("div",{key:P,class:x({"w-full col-span-1 h-8 bg-gray-100 rounded animate-pulse":b.isGrid,"w-full h-8 bg-gray-100 rounded animate-pulse":!b.isGrid})},null,2)),64))],2),_[0]||(_[0]=t("div",{class:"w-full h-32 bg-gray-100 rounded animate-pulse mt-3"},null,-1)),_[1]||(_[1]=t("div",{class:"w-32 h-8 bg-gray-100 rounded animate-pulse mt-3"},null,-1))],512)),[[G,b.loading]])}const wt=Ke(gt,[["render",bt]]),xt={class:"p-5"},ht={class:"flex items-center justify-between py-5"},kt={class:"text-2xl font-semibold"},Mt={class:"grid grid-cols-5 gap-4"},$t={class:"flex flex-col space-y-4 col-span-2 order-2"},Tt={class:"rounded border"},Ct={class:"w-full flex items-center",style:{"padding-bottom":"20px"}},Rt={class:"w-full space-y-2.5 py-5"},Dt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},At={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Yt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Et={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},qt={class:"rounded border"},St={class:"w-full flex items-center"},jt={class:"w-full space-y-2.5 py-5"},Lt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Bt={class:"w-full py-2 px-4 flex justify-between items-center"},Vt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Pt={class:"w-full py-2 px-4 flex justify-between items-center"},Ut={class:"rounded border"},Gt={class:"w-full flex items-center max-h-60 overflow-y-auto"},Nt={class:"w-full py-5"},It={class:"w-full flex items-center pb-0 pt-72"},Ot={class:"w-full space-y-2 py-5"},Ft={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Zt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Ht={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},zt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Kt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Wt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Jt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Qt={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Xt={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},es={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},ts={class:"rounded border order-1 col-span-3"},ss={class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-medium text-md gap-5 flex justify-between items-center"},ns={class:"w-full flex items-center gap-5 flex-row"},os={class:"mr-2"},ls={class:"flex space-x-2 items-center bg-gray-200 rounded"},as={class:"flex items-center bg-gray-200 rounded"},rs={class:"p-5"},is=["id"],us={key:0},ds={key:0,class:"relative flex items-center space-x-1.5"},cs={class:"absolute top-10 right-2"},ps=["id"],ms={class:"text-base font-medium mb-2"},fs=["id"],vs={class:"font-medium mb-2"},_s={class:"w-full mt-3 relative"},Bs=We({__name:"index",setup(O){dt({title:`${ut.name.toUpperCase()} - Enter Test Results`});const _=Je(),b=Qe(),V=o(_.query.accession_number),C=o(_.query.test_id),R=Xe("token"),P=ve(),z=et(),{$toast:F}=ve(),be=o({}),we=o("Enter Test Results"),K=o(""),W=o(""),J=o(""),Q=o(""),X=o(""),ee=o(""),te=o(""),se=o(""),ne=o(""),oe=o(""),le=o(""),D=o(""),ae=o(""),re=o(""),ie=o(""),ue=o(""),A=o({value:"",unit:""}),g=o([]),M=o(!1),Y=o(!1),E=o(!1),q=o(!1),S=o(!1),de=o(!0),j=o(""),ce=o(!1),pe=o({}),Z=o(""),xe=o({id:0,initiator:{id:0}}),he=ct,ke=pt,Me=mt,$e=ft,Te=o([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),Ce=h(()=>{const n=z.user.preferences.find(e=>e.name==="grid_or_list_enter_result_view");return((n==null?void 0:n.value)??"grid")==="grid"}),f=o(Ce.value),Re=h(()=>g.value.filter(n=>n.type==="numeric"||n.type==="free_text")),De=h(()=>{const n=g.value.filter(e=>e.type==="auto_complete"||e.type==="alpha_numeric");return n.forEach(e=>{e.ranges.unshift({name:"-- select result --"})}),n}),Ae=h(()=>g.value.filter(n=>n.type==="rich_text")),Ye=h(()=>g.value.filter(n=>n.type==="numeric"||n.type==="free_text").length>0),Ee=h(()=>g.value.filter(n=>n.type==="alpha_numeric"||n.type==="auto_complete").length>0),qe=h(()=>g.value.filter(n=>n.type==="rich_text").length>0),me=n=>{f.value=n};async function Se(n){const e={route:`${$.resultsAvailable}?accession_number=${n}`,method:"GET",token:`${R.value}`},{data:a,error:r}=await T(e);a.value&&(de.value=!a.value.result_available),r.value&&console.error(r.value)}async function je(){Y.value=!0;const n={route:`${$.fetchResults}?accession_number=${V.value}`,method:"GET",token:`${R.value}`},{data:e,error:a,pending:r}=await T(n);Y.value=r,e.value&&(g.value.forEach(p=>{e.value.forEach(u=>{String(p.id)===String(u.indicator_id)&&(p.value.name=u.value,Z.value=u.machine_name)})}),Y.value=!1),a.value&&(console.error(a.value),Y.value=!1)}function Le(n){g.value=[],n&&n.forEach(e=>{var a,r,p,u,m,L;g.value.push({name:e.name,id:e.id,machine_name:(a=e.result)==null?void 0:a.machine_name,value:e.test_indicator_type==="free_text"||e.test_indicator_type==="numeric"?{name:e.name.toLowerCase().includes("date")?w((r=e.result)==null?void 0:r.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(p=e.result)==null?void 0:p.value}:((u=e.result)==null?void 0:u.value)!=null?{name:e.name.toLowerCase().includes("date")?w((m=e.result)==null?void 0:m.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(L=e.result)==null?void 0:L.value}:e.test_indicator_type=="rich_text"?{name:""}:{name:"-- select result --"},type:e.test_indicator_type,unit:e.unit,ranges:Be(e.indicator_ranges,e.id)})})}function Be(n,e){let a=[];return n&&n.forEach(r=>{a.push({id:e,name:r.value,lowerRange:r.lower_range,upperRange:r.upper_range})}),a}function Ve(){let n=new Array;return g.value.forEach(e=>{n.push({indicator:e.id,value:e.type=="free_text"?e.value.name!==void 0?e.name.toLowerCase().includes("date")?w(e.value.name).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?w(e.value.name).format("DD/MMM/YYYY"):"":e.value.name:null:e.value!==void 0?e.name.toLowerCase().includes("date")?w(e.value).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?w(e.value).format("DD/MMM/YYYY"):"":e.value:null,machine_name:e.value!==null?Z.value===""?e.machine_name:Z.value:null})}),n}async function Pe(){E.value=!0;let n=Ve().map(u=>(typeof u.value=="object"&&u.value!==null&&(u.value=u.value.name=="-- select result --"?null:u.value.name),u));const e={route:`${$.updateResults}`,method:"POST",token:`${R.value}`,body:{test_id:C.value,test_indicators:n,remarks:j.value}},{data:a,error:r,pending:p}=await T(e);E.value=p,a.value&&(E.value=!1,P.$toast.success("Test results updated successfully"),b.back()),r.value&&(E.value=!1,console.error(r.value))}async function Ue(){S.value=!0;const n={route:`${$.testStatus}/${C.value}/verified`,method:"PUT",token:`${R.value}`},{data:e,error:a,pending:r}=await T(n);S.value=r,e.value&&(S.value=!1,P.$toast.success("Test status authorized successfully!"),b.push("/tests")),a.value&&(console.error(a.value),S.value=!1)}function Ge(n){const e=z.user,a=n.completed_by;if(a){if(a.id!==e.id)return!0;if(a.is_super_admin===!0)return!0}return!1}function Ne(n){return n.status.toLowerCase()==="completed"?Ge(n):!1}async function Ie(){const{alertConfirmation:n}=ye();await n({message:"Do you want to print specimen label?"})&&await it.printSpecimenLabel(V.value)}function Oe(n){if(n.length===0)return"";const e=n[0];return e.lowerRange==null?"":`(Ref ${e.lowerRange} - ${e.upperRange})`}async function Fe(){var p,u;M.value=!0;const n={route:`${$.tests}/${C.value}`,method:"GET"},{data:e,error:a,pending:r}=await T(n);M.value=r,e.value&&(M.value=!1,W.value=e.value.client.first_name+" "+((p=e.value.client)==null?void 0:p.last_name),K.value=e.value.id,Q.value=(u=e.value.client)==null?void 0:u.sex,J.value=nt(e.value.client.date_of_birth)+"",ee.value=e.value.tracking_number,te.value=e.value.accession_number,D.value=e.value.status,X.value=e.value.specimen_type,ae.value=e.value.requested_by,se.value=e.value.test_type_name,ne.value=e.value.requesting_ward,oe.value=e.value.created_date,le.value=e.value.created_date,re.value=e.value.request_origin,A.value=e.value.expected_turn_around_time,j.value=e.value.result_remarks?e.value.result_remarks.value:"",Le(e.value.indicators),e.value.status_trail.map(m=>{m.status.name.toLowerCase()==="completed"&&(xe.value=m,ue.value=`${m.initiator.first_name} ${m.initiator.last_name}`)}),e.value.status_trail.map(m=>{m.status.name.toLowerCase()==="pending"&&(ie.value=`${m.initiator.first_name} ${m.initiator.last_name}`)}),Se(e.value.accession_number),ce.value=e.value.is_machine_oriented,pe.value=e.value.completed_by,be.value=e.value),a.value&&(console.error(a.value),M.value=!1)}const Ze=async(n,e)=>{const a=ye();if(n.name.toLowerCase()!=="pack no."||e==="")return;q.value=!0;const r={route:`${$.processCrossMatch}/pack_number_exist?pack_number=${e.replaceAll("$","")}`,method:"GET"},{data:p,error:u,pending:m}=await T(r);q.value=m,p.value&&(q.value=!1,p.value.pack_number_exist&&(F.warning("Pack number already exists"),await a.alertConfirmation({message:`Pack number already exists, you wish to continue? A suffix ${p.value.next_suffix} will be logged`})?F.warning("A suffix will be logged"):n.value="")),u.value&&(console.error(u.value),F.error(ot),q.value=!1)};return tt(()=>{V.value=`${_.query.accession_number}`,C.value=`${_.query.test_id}`,Fe()}),(n,e)=>{const a=ze,r=lt,p=rt,u=H("FormKit"),m=at,L=H("datepicker"),fe=H("RichTextEditor"),He=wt;return d(),c("div",xt,[v(a,{pages:s(Te)},null,8,["pages"]),t("div",ht,[t("h3",kt,i(s(we)),1)]),t("div",Mt,[t("div",$t,[t("div",Tt,[e[7]||(e[7]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-semibold text-lg"}," Patient Details ",-1)),t("div",null,[t("div",Ct,[t("div",Rt,[t("div",Dt,[e[3]||(e[3]=t("p",{class:"font-medium"},"Patient No",-1)),t("p",null,i(s(K)),1)]),t("div",At,[e[4]||(e[4]=t("p",{class:"font-medium"},"Name",-1)),t("p",null,i(s(W)),1)]),t("div",Yt,[e[5]||(e[5]=t("p",{class:"font-medium"},"Age",-1)),t("p",null,i(s(J)),1)]),t("div",Et,[e[6]||(e[6]=t("p",{class:"font-medium"},"Sex",-1)),t("p",null,i(s(Q)),1)])])])])]),t("div",qt,[e[12]||(e[12]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Specimen Details ",-1)),t("div",null,[t("div",St,[t("div",jt,[t("div",Lt,[e[8]||(e[8]=t("p",{class:"font-medium"},"Specimen Type",-1)),t("p",null,i(s(X)),1)]),t("div",Bt,[e[9]||(e[9]=t("p",{class:"font-medium"},"Tracking Number",-1)),t("p",null,i(s(ee)),1)]),t("div",Vt,[e[10]||(e[10]=t("p",{class:"font-medium"},"Accession Number",-1)),t("p",null,i(s(te)),1)]),t("div",Pt,[e[11]||(e[11]=t("p",{class:"font-medium"},"Status",-1)),t("p",null,i(s(D)),1)])])])])]),t("div",Ut,[e[23]||(e[23]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Test Details ",-1)),t("div",Gt,[t("div",Nt,[t("div",It,[t("div",Ot,[t("div",Ft,[e[13]||(e[13]=t("p",{class:"font-medium"},"Test Type",-1)),t("p",null,i(s(se)),1)]),t("div",Zt,[e[14]||(e[14]=t("p",{class:"font-medium"},"Requesting Ward/Location",-1)),t("p",null,i(s(ne)),1)]),t("div",Ht,[e[15]||(e[15]=t("p",{class:"font-medium"},"Date Registered",-1)),t("p",null,i(s(w)(s(oe)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(_e))),1)]),t("div",zt,[e[16]||(e[16]=t("p",{class:"font-medium"},"Receipt Date",-1)),t("p",null,i(s(w)(s(le)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(_e))),1)]),t("div",Kt,[e[17]||(e[17]=t("p",{class:"font-medium"},"Test Status",-1)),t("p",null,i(s(D)),1)]),t("div",Wt,[e[18]||(e[18]=t("p",{class:"font-medium"},"Requesting Physician",-1)),t("p",null,i(s(ae)),1)]),t("div",Jt,[e[19]||(e[19]=t("p",{class:"font-medium"},"Request Origin",-1)),t("p",null,i(s(re)),1)]),t("div",Qt,[e[20]||(e[20]=t("p",{class:"font-medium"},"Registered By",-1)),t("p",null,i(s(ie)),1)]),t("div",Xt,[e[21]||(e[21]=t("p",{class:"font-medium"},"Performed By",-1)),t("p",null,i(s(ue)),1)]),t("div",es,[e[22]||(e[22]=t("p",{class:"font-medium"},"Turn around time",-1)),t("p",null,i(`${s(A).value} ${Number(s(A).value)==1?s(A).unit.toLowerCase().slice(0,-1):s(A).unit}`),1)])])])])])])]),t("div",ts,[t("div",ss,[t("div",ns,[U(v(r,{text:"Fetch results",color:"warning",icon:s(he),loading:s(Y),disabled:s(de),click:()=>je()},null,8,["icon","loading","disabled","click"]),[[G,s(ce)]]),v(r,{text:"Print Accession Number",color:"primary",icon:s(ke),click:()=>Ie()},null,8,["icon","click"]),U(v(r,{text:"Authorize",color:"success",icon:s(Me),click:()=>Ue(),loading:s(S)},null,8,["icon","click","loading"]),[[G,Ne({status:s(D),completed_by:s(pe)})]])]),t("div",os,[t("div",ls,[t("div",as,[t("button",{onClick:e[0]||(e[0]=l=>me(!0)),class:x([{"bg-sky-500 text-white":s(f),"text-gray-500":!s(f)},"rounded p-2"])},[v(s(_t),{class:"w-5 h-5"})],2),t("button",{onClick:e[1]||(e[1]=l=>me(!1)),class:x([{"bg-sky-500 text-white":!s(f),"text-gray-500":s(f)},"rounded p-2"])},[v(s(vt),{class:"w-5 h-5"})],2)])])])]),U(t("div",rs,[s(g).length!==0?(d(),c("div",{key:0,class:x({"w-full grid grid-cols-3 gap-4":s(f),"flex flex-col gap-4":!s(f)})},[s(Ee)?(d(),c("div",{key:0,class:x({"col-span-3 grid grid-cols-3 gap-3":s(f),"flex flex-col":!s(f)})},[(d(!0),c(N,null,I(s(De),(l,B)=>(d(),c("div",{key:B},[t("div",null,[t("p",{class:"font-medium",id:`measure-mapping-id:${l.id}`},i(l.name),9,is),v(p,{items:l.ranges,modelValue:l.value,"onUpdate:modelValue":y=>l.value=y},null,8,["items","modelValue","onUpdate:modelValue"])])]))),128))],2)):k("",!0),s(Ye)?(d(),c("div",{key:1,class:x({"col-span-3 grid grid-cols-3 gap-3":s(f),"flex flex-col":!s(f)})},[(d(!0),c(N,null,I(s(Re),(l,B)=>(d(),c("div",{key:B},[l.type==="numeric"||l.type==="free_text"?(d(),c("div",us,[l.name.toLowerCase().includes("date")?(d(),c("div",{key:1,id:`measure-mapping-id:${l.id}`},[t("p",ms,i(l.name),1),v(L,{label:l.name,"input-class-name":"datepicker",placeholder:"dd/MM/yyyy",modelValue:l.value.name,"onUpdate:modelValue":y=>l.value.name=y,"text-input":"",format:"dd/MM/yyyy","min-date":new Date},null,8,["label","modelValue","onUpdate:modelValue","min-date"])],8,ps)):(d(),c("div",ds,[v(u,{type:l.name.toLowerCase().includes("comment")?"textarea":"text",label:l.name,modelValue:l.value.name,"onUpdate:modelValue":y=>l.value.name=y,modelModifiers:{lazy:!0},help:`${Oe(l.ranges)} ${l.unit}`,delay:1e3,id:`measure-mapping-id:${l.id}`,onInput:y=>Ze(l,y)},null,8,["type","label","modelValue","onUpdate:modelValue","help","id","onInput"]),t("div",cs,[l.name.toLowerCase()=="pack no."&&s(q)?(d(),ge(m,{key:0,height:20,width:20})):k("",!0)])]))])):k("",!0)]))),128))],2)):k("",!0),s(qe)?(d(),c("div",{key:2,class:x({"col-span-3":s(f),"flex flex-col":!s(f)})},[(d(!0),c(N,null,I(s(Ae),(l,B)=>(d(),c("div",{key:B},[t("div",{id:`measure-mapping-id:${l.id}`},[t("p",vs,i(l.name),1),v(fe,{theme:"snow",class:"editor",content:l.value.name,"onUpdate:content":y=>l.value.name=y,contentType:"html"},null,8,["content","onUpdate:content"])],8,fs)]))),128))],2)):k("",!0)],2)):k("",!0),t("div",_s,[e[24]||(e[24]=t("p",{class:"font-medium mb-2"},"Remarks",-1)),v(fe,{theme:"snow",class:"editor",content:s(j),"onUpdate:content":e[2]||(e[2]=l=>st(j)?j.value=l:null),contentType:"html"},null,8,["content"])]),s(D).toLowerCase()!=="verified"?(d(),ge(r,{key:1,loading:s(E),text:"Update Test Results",color:"success",icon:s($e),click:()=>Pe(),class:"mt-5"},null,8,["loading","icon","click"])):k("",!0)],512),[[G,!s(M)]]),v(He,{loading:s(M),isGrid:s(f)},null,8,["loading","isGrid"])])])])}}});export{Bs as default};
