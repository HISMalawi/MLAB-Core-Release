import{_ as z}from"./Breadcrumb.vue.b73741aa.js";import{u as V,_ as E,f as N,o as l,c as d,b as y,d as e,h as R,t as n,w as P,Q as U,p as Y,j as f,k as g,F as x,r as v,v as M,e as O}from"./entry.0879c7d5.js";import{_ as H}from"./index.b50546e4.js";import{_ as G}from"./Loader.7369c2e5.js";import{d as S}from"./constants.1331d04e.js";import{h as T,e as L,f as j,c as Q,j as A}from"./fetch.dce1d52e.js";import{u as Z}from"./vue.f36acd1f.aa0d3b05.js";import{u as J}from"./facility.8b020bb8.js";import{P as K}from"./package.56414df9.js";import{r as W}from"./UserIcon.7ba9dcee.js";import{r as X}from"./QrCodeIcon.3051a9c2.js";import{r as $}from"./FunnelIcon.e7fe6273.js";import{r as ee}from"./PrinterIcon.8a7d7efd.js";import{r as te}from"./ArrowPathIcon.8622676a.js";import{_ as se}from"./logo.f22d35a1.js";import"./nuxt-link.496c02dd.js";import"./HomeIcon.b7f124e7.js";import"./jspdf.es.min.d7717b26.js";import"./XMarkIcon.98c7f7ed.js";import"./transition.174a4272.js";import"./hidden.4eb37939.js";import"./PencilSquareIcon.9968ff52.js";const re={name:"PatientReport",components:{UserIcon:W,QrCodeIcon:X,FunnelIcon:$},setup(){Z({title:`${K.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:ee,refreshIcon:te,cookie:V("token"),moment:T,facility:J(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){var c;this.loading=!0;const t=(c=this.$route.query.order_id)==null?void 0:c.toString(),r=this.dateRange!==null&&this.dateRange.length>0&&T(this.dateRange[0]).isValid()?T(this.dateRange[0]).format("YYYY-MM-DD"):"",i=this.dateRange!==null&&this.dateRange.length>1&&T(this.dateRange[1]).isValid()?T(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const s={route:`${L.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:k}=await j(s);if(this.loading=k,o.value){this.loading=!1,this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let w=o.value.orders.map(u=>{let h=0;return u.tests!==void 0&&(h+=u.tests.filter(D=>D.status.toLowerCase()==="verified").length),{...u,tests_verified:h}});this.reportData=w,this.showPrinterDialog()}m.value&&(this.loading=!1,console.error(m.value))}else{const s={route:`${L.tests}/${this.patientId}/report?from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:k}=await j(s);if(this.loading=k,o.value){this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let w=o.value.orders.map(u=>{let h=0;return u.tests!==void 0&&(h+=u.tests.filter(D=>D.status.toLowerCase()==="verified").length),{...u,tests_verified:h}});this.reportData=w,this.loading=!1,this.showPrinterDialog()}m.value&&(console.error(m.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],i=t.find(c=>r.includes(c.status.name));return i?`${i.initiator.first_name} ${i.initiator.last_name}`:""},getOrderStatus(t){return t!==null?Q(t.split("-").join(" ")):""},getTestStatusInitiatorName(t,r){const i=t.find(c=>r===c.status.name);return i?{name:`${i.initiator.first_name} ${i.initiator.last_name}`,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(i=>i.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,i)=>r+i.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0?`Growth of ${r.map(i=>i.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.tests.some(i=>i.print_device))},getSmallLabelPrintTests(t){const r=[];return t.forEach(i=>{i.tests.forEach(c=>{c.print_device&&r.push(c.id)})}),r},getPrintCount(t){return t.reduce((r,i)=>r+i.print_count,0)},getRequiredRange(t,r){const i=t.sex=="M"?"Male":"Female",c=Math.ceil(Number(A(t.date_of_birth)==0?1:Number(A(t.date_of_birth))));return r.filter(s=>s.sex===i&&c>Number(s.min_age)&&c<Number(s.max_age)||s.sex==="Both"&&c>Number(s.min_age)&&c<Number(s.max_age))[0]},shouldDisplayRange(t,r,i){let c=null;return this.showIndicatorRanges(t)&&(c=this.getRequiredRange(r,i.indicator_ranges)),c},getMachineName(t){return t[0].result.machine_name},getCompletedTests(t){const r=new Set(["completed","verified"]);return t.filter(i=>r.has(i.status.toLowerCase()))},showPrinterDialog(){this.$nextTick(()=>{var t;((t=this.$route.query.printer)==null?void 0:t.toString())=="true"&&this.$refs.corePrinter.init()})}}},oe=""+new URL("medical-record.2202ac05.png",import.meta.url).href,ne={class:"py-5 px-5"},ae={class:"flex items-center py-5"},ie=e("img",{src:oe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),le={class:"text-2xl font-semibold uppercase"},de={class:"text-sky-500 text-2xl"},ce={class:"mt-2 space-y-3"},pe={class:"w-full flex items-center justify-between"},_e={class:"flex items-center space-x-5"},ue={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},me={class:"w-72 ml-2"},he={class:"flex items-center space-x-2"},be=e("label",null,"Include pending tests",-1),fe={key:0,class:"border rounded print-container mt-10"},ye={class:"rounded-tr rounded-tl border-b px-5 py-5"},ge={class:"flex items-center justify-between"},xe=e("div",{class:"flex items-center space-x-2"},[e("img",{src:se,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold"},"PATIENT REPORT")],-1),ve={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},Re={class:"font-normal"},ke={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},we={class:"flex items-center not-italic text-gray-600"},De={class:"flex items-center not-italic text-gray-600"},Se={class:"flex items-center justify-between mt-5"},Te=e("span",{class:"font-medium"},"Report Date:",-1),Ie=e("span",{class:"font-medium"},"No. Printed:",-1),Ne=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Pe={class:"w-full mt-2"},Ae=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Fe={class:"border px-2 py-2"},Ce=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Me={class:"border px-2 py-2"},Le=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),je={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),Be={class:"border px-2 py-2"},ze=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),Ve={class:"border px-2 py-2",colspan:"2"},Ee={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Ue={class:"flex items-center"},Ye={class:"border-collapse border-slate-500 w-full"},Oe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),He={class:"border-b border-r px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),Qe={class:"border-b px-2 py-2"},Ze=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),Je={class:"border-b border-r px-2 py-2"},Ke=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),We={class:"border-b px-2 py-2"},Xe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),$e={class:"border-b border-r px-2 py-2"},et=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1),tt={class:"border-b px-2 py-2"},st={class:"border-collapse w-full"},rt={class:"bg-gray-100 text-gray-600"},ot=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),nt={colspan:3,class:"px-2 py-2 text-lg font-semibold"},at=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),it={class:"border px-2 py-2 text-left"},lt={class:"p-0 border-b",style:{padding:"0 !important"}},dt={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},ct=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1),pt={class:"border-b"},_t={class:"border-r px-2 py-2"},ut={class:"px-2 py-2 flex items-center"},mt=["innerHTML"],ht={key:0,class:"text-xs"},bt={key:1},ft={key:0,class:"border-t border-l px-2 py-2 font-bold"},yt={key:1,class:"border px-2 py-2"},gt={class:"border px-2 py-2"},xt=["innerHTML"],vt={class:"border px-2 py-2"},Rt={class:"test-status"},kt=e("p",{class:"font-bold"},"Test Status",-1),wt={class:"px-2"},Dt={class:"px-2"},St={class:"px-2"},Tt={key:0},It=e("p",{class:"font-bold"},"Performed By",-1),Nt={class:"px-2"},Pt={class:"px-2 mb-2"},At={key:0,class:"mb-2"},Ft=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1),Ct={class:"m-2"},Mt=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Lt={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},jt={class:"w-full"},qt=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),Bt={classs:"border-l border-r"},zt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Vt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Et={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Ut={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Yt=e("p",{class:"text-base"},[R(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function Ot(t,r,i,c,s,o){const m=z,k=N("FunnelIcon"),w=N("datepicker"),u=O,h=H,D=N("barcode"),q=G;return l(),d("div",ne,[y(m,{pages:s.pages},null,8,["pages"]),e("div",ae,[ie,e("h3",le,[R(" patient report for "),e("span",de,'"'+n(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`)+'"',1)])]),e("div",ce,[e("div",pe,[e("div",_e,[e("div",ue,[y(k,{class:"w-5 h-5 mr-2"}),R(" Filter By Date Range "),e("div",me,[y(w,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=p=>s.dateRange=p)},null,8,["modelValue"])])]),e("div",he,[P(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=p=>s.showPendingTests=p)},null,512),[[U,s.showPendingTests]]),be]),y(u,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>o.init()},null,8,["loading","icon","click"])]),e("div",null,[o.getAuthorizedTestCount(s.reportData)>0?(l(),Y(h,{key:0,"print-small-label":o.shouldPrintSmallLabel(s.reportData),id:o.patientId,orderId:o.orderId,tests:o.getSmallLabelPrintTests(s.reportData),onUpdate:o.updateReport,ref:"corePrinter"},null,8,["print-small-label","id","orderId","tests","onUpdate"])):f("",!0)])]),s.reportData.length>0?(l(),d("div",fe,[e("div",ye,[e("div",ge,[xe,e("div",null,[y(D,{value:s.reportData[0].accession_number,"display-value":!1,height:50},null,8,["value"])]),e("div",ve,[e("address",Re,[e("span",ke,n(s.facility.details.name),1),e("span",we,n(s.facility.details.address),1),e("span",De,n(s.facility.details.phone),1)])])]),e("div",Se,[e("div",null,[Te,R(" "+n(s.moment(new Date).format("dateFormat"in t?t.dateFormat:g(S))),1)]),e("div",null,[Ie,R(" "+n(o.getPrintCount(s.reportData)),1)]),e("div",null,[Ne,R(" "+n(s.reportData.length>0&&s.moment(s.reportData[0].sample_collection_time).format("dateFormat"in t?t.dateFormat:g(S))),1)])]),e("table",Pe,[e("tbody",null,[e("tr",null,[Ae,e("td",Fe,n(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`),1),Ce,e("td",Me,n(s.person.sex==="F"?"Female":"Male"),1),Le,e("td",je,n(("calculateAge"in t?t.calculateAge:g(A))(s.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[qe,e("td",Be,n(s.person.id),1),ze,e("td",Ve,n(o.getPhysicalAddress),1)])])])]),(l(!0),d(x,null,v(s.reportData,(p,B)=>(l(),d("div",{key:B},[e("div",Ee,[e("div",Ue," Accession No: "+n(p.accession_number),1),e("div",null," Requested By: "+n(p.requested_by)+" ("+n(p.requesting_ward)+") ",1)]),e("table",Ye,[e("tbody",null,[e("tr",null,[Oe,e("td",He,n(p.specimen),1),Ge,e("td",Qe,n(s.moment(p.created_date).format("dateFormat"in t?t.dateFormat:g(S))),1)]),e("tr",null,[Ze,e("td",Je,n(o.getTestTypes(p.test_types)),1),Ke,e("td",We,n(o.getDepartments(p.test_types)),1)]),e("tr",null,[Xe,e("td",$e,n(o.getOrderStatus(p.order_status)),1),et,e("td",tt,n(o.getOrderStatusInitiatorName(p.order_status_trail)),1)])])]),e("table",st,[e("thead",null,[e("tr",rt,[ot,e("th",nt," Tests Authorized("+n(p.tests_verified)+") ",1)])]),e("tbody",null,[at,(l(!0),d(x,null,v(s.showPendingTests?p.tests:o.getCompletedTests(p.tests),a=>(l(),d("tr",{key:a.id},[e("td",it,n(a.test_type_name),1),e("td",lt,[e("table",dt,[ct,e("tbody",pt,[(l(!0),d(x,null,v(a.indicators,(_,I)=>{var b,F,C;return l(),d("tr",{key:I,class:"border-b"},[e("td",_t,n(_.name),1),e("td",ut,[e("p",{innerHTML:o.showResult(((b=_.result)==null?void 0:b.value)??"",a==null?void 0:a.suscept_test_result)},null,8,mt),(F=_.result)!=null&&F.value?(l(),d("span",ht,n((a==null?void 0:a.suscept_test_result.length)>0?"":_==null?void 0:_.unit),1)):f("",!0),(C=_.result)!=null&&C.value?f("",!0):(l(),d("span",bt,"Not done"))]),o.shouldDisplayRange(a.indicators,s.person,_)!==void 0&&o.shouldDisplayRange(a.indicators,s.person,_)!==null?(l(),d("td",ft," ("+n(o.shouldDisplayRange(a.indicators,s.person,_).lower_range)+" - "+n(o.shouldDisplayRange(a.indicators,s.person,_).upper_range)+") ",1)):(l(),d("td",yt,"N/A"))])}),128))])])]),e("td",gt,[e("p",{innerHTML:a!=null&&a.result_remarks?a==null?void 0:a.result_remarks.value:"N/A"},null,8,xt)]),e("td",vt,[e("div",Rt,[kt,e("p",wt,n(o.getTestStatusName(a.status)),1),e("p",Dt," By: "+n(o.getTestStatusInitiatorName(a.status_trail,a.status).name),1),e("p",St," On: "+n(s.moment(o.getTestStatusInitiatorName(a.status_trail,a.status).created_at).format("dateFormat"in t?t.dateFormat:g(S))),1)]),o.getTestStatusInitiatorName(a.status_trail,"completed").name?(l(),d("div",Tt,[It,e("p",Nt,n(o.getTestStatusInitiatorName(a.status_trail,"completed").name),1),e("p",Pt," On: "+n(s.moment(o.getTestStatusInitiatorName(a.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:g(S))),1),o.getMachineName(a.indicators)?(l(),d("div",At,[Ft,e("p",null,n(o.getMachineName(a.indicators)),1)])):f("",!0)])):f("",!0)])]))),128))])]),P(e("div",Ct,[Mt,e("div",null,[(l(!0),d(x,null,v(p.tests,a=>(l(),d("div",{class:"grid grid-cols-2 gap-4",key:a.id},[a.test_type_name.toLowerCase().includes("culture")?(l(!0),d(x,{key:0},v(a.suscept_test_result,(_,I)=>(l(),d("div",{key:I},[e("div",Lt,n(_.name),1),e("table",jt,[qt,e("tbody",Bt,[(l(!0),d(x,null,v(o.getFilteredDrugs(_.drugs),b=>(l(),d("tr",{key:b.drug_id},[e("th",zt,n(b.name),1),e("th",Vt,n(b.zone),1),e("th",Et,n(b.interpretation),1)]))),128))])])]))),128)):f("",!0)]))),128))])],512),[[M,o.checkSusceptibilityResults(p)]])]))),128))])):f("",!0),e("div",null,[P(e("div",Ut,[y(q),Yt],512),[[M,s.loading]])])])])}const us=E(re,[["render",Ot]]);export{us as default};
