import{_ as ce}from"./Breadcrumb.vue.af519b7d.js";import{o as p,c as g,e,_ as U,g as c,t as u,w as j,v as O,d as i,n as te,a as V,b as I,h,i as N,f as E,l as D,F as q,r as F,k as R,an as de,u as ue,ao as me,q as A}from"./entry.64b6b942.js";import{r as pe,_ as he}from"./Dropdown.c3b078e3.js";import{_ as _e}from"./SearchBar.9f32155f.js";import{r as L}from"./XMarkIcon.64f3f5c2.js";import{_ as fe}from"./Loader.52c40d31.js";import{_ as se}from"./OutlinedButton.9b576682.js";import{e as B,d as X,f as ge}from"./constants.31b85c3a.js";import{u as z,e as k,f as T,j as be,m as ye,n as xe,h as $,r as oe,o as ne,P as Z,i as G,d as re,s as ve,S as we}from"./fetch.8fd817fe.js";import{r as ie}from"./UserIcon.5f6aced0.js";import{a as H,r as ke}from"./PencilSquareIcon.f5030dad.js";import{r as ae}from"./ArrowDownTrayIcon.b526c915.js";import{r as le}from"./ArrowUturnLeftIcon.61799fb4.js";import{S as Y,h as K,U as W,G as J,V as Q}from"./transition.5b1867a1.js";import{r as Te}from"./PrinterIcon.5a175993.js";import{_ as Se}from"./Datatable.d42f9ec8.js";import{P as Ce}from"./package.70b788f3.js";import{r as Ie}from"./MagnifyingGlassIcon.12344835.js";import{r as Ae}from"./ChevronDownIcon.d505c274.js";import{r as Re}from"./CheckIcon.b87f947f.js";import{r as De}from"./CheckCircleIcon.acd40d04.js";import{r as ee}from"./SquaresPlusIcon.5cb3c426.js";import{r as $e}from"./AdjustmentsVerticalIcon.b2373e77.js";import{r as M}from"./CheckBadgeIcon.6a031229.js";import{a as je,r as Oe}from"./ChevronRightIcon.b30edbb3.js";import{r as Ue}from"./ArchiveBoxXMarkIcon.321b231f.js";import{r as P}from"./HandThumbDownIcon.47b73efc.js";import{r as Ne}from"./ArrowPathIcon.b9b688c3.js";import{F as Le,K as Pe,B as qe,N as Fe,H as Ve}from"./listbox.947b1eda.js";import{M as Ee,R as Be,h as Me,y as Xe}from"./menu.59663b98.js";import{j as ze,g as Ge,W as He}from"./popover.bb54c46e.js";import"./nuxt-link.f9df4f37.js";import"./HomeIcon.4d524c11.js";import"./hidden.a9fd55b4.js";import"./use-text-value.cb6830ee.js";function Ye(t,s){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M12.97 3.97a.75.75 0 011.06 0l7.5 7.5a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 11-1.06-1.06l6.22-6.22H3a.75.75 0 010-1.5h16.19l-6.22-6.22a.75.75 0 010-1.06z","clip-rule":"evenodd"})])}function Ke(t,s){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M14.47 2.47a.75.75 0 011.06 0l6 6a.75.75 0 010 1.06l-6 6a.75.75 0 11-1.06-1.06l4.72-4.72H9a5.25 5.25 0 100 10.5h3a.75.75 0 010 1.5H9a6.75 6.75 0 010-13.5h10.19l-4.72-4.72a.75.75 0 010-1.06z","clip-rule":"evenodd"})])}function We(t,s){return p(),g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z","clip-rule":"evenodd"})])}const Je={props:{value:{type:Object,required:!0},close:{type:Boolean,required:!0},color:{required:!1,type:String,default:"green"},icon:{required:!1,type:Object}},methods:{removeLabel(){this.$emit("update",this.value)}},components:{XMarkIcon:L}},Qe={class:"text-sm"};function Ze(t,s,n,a,o,r){const f=c("XMarkIcon");return p(),g("button",{class:te(["flex items-center space-x-2 px-2 py-1 text-white rounded",`bg-${n.color}-500`])},[e("p",Qe,u(n.value.text),1),j(e("button",{onClick:s[0]||(s[0]=(..._)=>r.removeLabel&&r.removeLabel(..._))},[i(f,{class:"w-4 h-4"})],512),[[O,n.close]])],2)}const et=U(Je,[["render",Ze]]),tt={components:{TransitionRoot:Y,TransitionChild:K,Dialog:W,DialogPanel:J,DialogTitle:Q,XMarkIcon:L,UserIcon:ie},props:{item:{required:!0,type:Object}},data(){return{open:!1,editIcon:H,saveIcon:ae,clearIcon:le,name:"",description:"",testTypesSelected:[],loading:!1,testTypes:new Array,rawTestTypes:new Array,departments:new Array,selectedDepartment:"-- select department",cookie:V("token"),authStore:z(),departmentId:0}},methods:{async init(){this.handleClick();const t=this.authStore.department,s=this.authStore.user.departments.find(n=>n.name===t);s&&(this.departmentId=s.id),this.selectedDepartment=t,this.departments=this.authStore.user.departments,await this.getTestTypes(this.departmentId)},async getTestTypes(t){const s={route:`${k.specimenTestTypes}?department_id=${t}&specimen_id=${this.item.specimen_id}`,method:"GET",token:`${this.cookie}`},{error:n,data:a}=await T(s);a.value&&(this.rawTestTypes=a.value,this.testTypes=a.value),n.value&&console.error("error: ",n.value)},async submitForm(){this.loading=!0;let t=this.testTypesSelected.map(o=>({specimen:this.item.specimen_id,test_type:o}));const s={route:`${k.addTestOrder}`,method:"POST",token:`${this.cookie}`,body:{order_id:this.item.order_id,tests:t}},{data:n,error:a}=await T(s);n.value&&(this.handleClick(),I().$toast.success("Tests added to current order successfully!"),this.loading=!1,this.$emit("update",!0)),a.value&&(this.handleClick(),console.error("error: ",a.value),I().$toast.error(B),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.testTypesSelected=new Array}},watch:{selectedDepartment(t,s){if(t!==s){const n=this.authStore.user.departments.find(a=>a.name===t);n&&(this.departmentId=n.id,this.getTestTypes(this.departmentId))}}}},st=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),ot={class:"fixed inset-0 overflow-y-auto"},nt={class:"flex min-h-full items-center justify-center p-4 text-center"},rt={class:"border-b px-3 py-3 flex items-center justify-between"},it={class:"mt-2 space-y-3 pb-40"},at={class:"w-full flex flex-col space-y-2 px-5"},lt=e("label",{class:"font-medium"},"Department",-1),ct={class:"w-full flex flex-col space-y-2 px-5"},dt=e("label",{class:"font-medium"},"Tests",-1),ut={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function mt(t,s,n,a,o,r){const f=E,_=c("TransitionChild"),S=c("DialogTitle"),x=c("XMarkIcon"),y=c("multi-select"),C=se,m=c("FormKit"),v=c("DialogPanel"),w=c("Dialog"),l=c("TransitionRoot");return p(),g("div",null,[e("div",null,[i(f,{text:"Add test to current order",color:"warning",icon:o.editIcon,click:r.init},null,8,["icon","click"])]),i(l,{appear:"",show:o.open,as:"template"},{default:h(()=>[i(w,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:h(()=>[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:h(()=>[st]),_:1}),e("div",ot,[e("div",nt,[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:h(()=>[i(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:h(()=>[e("div",rt,[i(S,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:h(()=>[N(" Add Test To Current Order ")]),_:1}),e("button",{onClick:s[0]||(s[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[i(x,{class:"w-5 h-5"})])]),i(m,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"submitForm"},{default:h(({value:d})=>[e("div",it,[e("div",at,[lt,i(y,{style:{"--ms-max-height":"none !important"},modelValue:o.selectedDepartment,"onUpdate:modelValue":s[1]||(s[1]=b=>o.selectedDepartment=b),options:o.departments.map(b=>b.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),e("div",ct,[dt,i(y,{style:{"--ms-max-height":"none !important"},modelValue:o.testTypesSelected,"onUpdate:modelValue":s[2]||(s[2]=b=>o.testTypesSelected=b),options:o.testTypes,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",ut,[i(C,{type:"button",click:()=>r.resetForm(),text:"Clear form"},null,8,["click"]),i(f,{loading:o.loading,type:"submit",click:()=>{},color:"success",icon:o.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const pt=U(tt,[["render",mt]]),ht={components:{TransitionRoot:Y,TransitionChild:K,Dialog:W,DialogPanel:J,DialogTitle:Q,XMarkIcon:L,PhoneIcon:be,EnvelopeIcon:ye,MapPinIcon:xe},data(){return{moment:$,viewIcon:ke,show:this.open,addIcon:oe,editIcon:H,acceptIcon:ne,printerIcon:Te,cookie:V("token"),details:{},loading:!1}},props:{data:{type:Object,required:!0},open:{type:Boolean,required:!1}},methods:{async init(){this.loading=!0;const t={route:`${k.tests}/${this.data.id}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:a}=await T(t);this.loading=a,s.value&&(this.details=s.value,typeof this.details=="object"&&this.handleClick()),n.value&&(this.loading=!1,console.error(n.value),I().$toast.error(B))},updateChanges(){this.show=!1,this.$emit("update",!0)},handleClick(){this.show=!this.show},printAccessionNumber(){return Z.printSpecimenLabel(this.details.accession_number)},printTrackingNumber(){return Z.printTrackingNumber(this.details.tracking_number)},viewReport(){return this.$router.push(`/reports/daily/patient-report/${this.details.client.id}?order_id=${this.details.order_id}`)},getRequestedBy(t){let s="";return t.map(n=>{n.status.name==="pending"&&(s=`${n.initiator.first_name} ${n.initiator.last_name}`)}),G(s)}}},_t=""+new URL("prescription_document.18f957e1.svg",import.meta.url).href,ft=""+new URL("test_tube.2b522cf2.svg",import.meta.url).href,gt=""+new URL("i_exam_qualification.dd473ba6.svg",import.meta.url).href,bt=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),yt={class:"fixed inset-0 overflow-y-auto"},xt={class:"flex min-h-full items-center justify-center text-center"},vt={class:"border-b px-3 py-3 flex items-center justify-between"},wt=e("img",{src:_t,class:"w-8 h-8 mr-2"},null,-1),kt={class:"flex items-center justify-center mx-auto my-20"},Tt={class:"grid grid-cols-3 gap-4 px-5 py-5"},St={class:"rounded border"},Ct=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:de,class:"w-7 h-7 mr-1"}),N(" Patient ")])],-1),It={class:"w-full space-y-2 py-2"},At={class:"w-full flex justify-between px-4 py-1"},Rt=e("h3",{class:"font-semibold"},"Patient Number",-1),Dt={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},$t=e("h3",{class:"font-semibold"},"Name",-1),jt={class:"w-full flex justify-between px-4 py-1"},Ot=e("h3",{class:"font-semibold"},"Sex",-1),Ut={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Nt=e("h3",{class:"font-semibold"},"Age",-1),Lt={class:"rounded border"},Pt=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:ft,class:"w-7 h-7 mr-1"}),N(" Specimen ")])],-1),qt={class:"w-full space-y-2 py-2"},Ft={class:"w-full flex justify-between px-4 py-1"},Vt=e("h3",{class:"font-semibold"},"Specimen Type",-1),Et={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Bt=e("h3",{class:"font-semibold"},"Tracking Number",-1),Mt={class:"w-full flex justify-between px-4 py-1"},Xt=e("h3",{class:"font-semibold"},"Accession Number",-1),zt={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Gt=e("h3",{class:"font-semibold"},"Status",-1),Ht={class:"rounded border max-h-72 overflow-y-auto"},Yt=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[e("img",{src:gt,class:"w-7 h-7 mr-1"}),e("h3",{class:"text-lg font-semibold text-black"},"Test")],-1),Kt={class:"w-full space-y-2 py-2"},Wt={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Jt=e("h3",{class:"font-semibold"},"Name",-1),Qt={class:"w-full flex justify-between px-4 py-1"},Zt=e("h3",{class:"font-semibold"},"Date Registered",-1),es={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ts=e("h3",{class:"font-semibold"},"Receipt Date",-1),ss={class:"w-full flex justify-between px-4 py-1"},os=e("h3",{class:"font-semibold"},"Test Status",-1),ns={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},rs=e("h3",{class:"font-semibold"},"Ward/Location",-1),is={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},as=e("h3",{class:"font-semibold"},"Request Origin",-1),ls={class:"w-full flex justify-between px-4 py-1"},cs=e("h3",{class:"font-semibold"},"Registered By",-1),ds={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},us=e("h3",{class:"font-semibold"},"Requested By",-1),ms={class:"mx-5 rounded border mb-5"},ps={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},hs=e("h3",{class:"text-lg font-semibold text-black"},"Results",-1),_s={class:"justify-end flex items-center space-x-3"},fs=["innerHTML"];function gs(t,s,n,a,o,r){const f=E,_=c("TransitionChild"),S=c("DialogTitle"),x=c("XMarkIcon"),y=fe,C=pt,m=c("DialogPanel"),v=c("Dialog"),w=c("TransitionRoot");return p(),g("div",null,[i(f,{click:r.init,color:"primary",text:"View",icon:o.viewIcon},null,8,["click","icon"]),i(w,{appear:"",show:o.show,as:"template"},{default:h(()=>[i(v,{as:"div",class:"relative z-10"},{default:h(()=>[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:h(()=>[bt]),_:1}),e("div",yt,[e("div",xt,[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:h(()=>[i(m,{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:h(()=>[e("div",vt,[i(S,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:h(()=>[wt,N(" View Test ")]),_:1}),e("button",{onClick:s[0]||(s[0]=(...l)=>r.handleClick&&r.handleClick(...l))},[i(x,{class:"w-5 h-5"})])]),j(e("div",kt,[i(y,{loading:o.loading},null,8,["loading"])],512),[[O,o.loading]]),e("div",Tt,[e("div",St,[Ct,e("div",It,[e("div",At,[Rt,e("p",null,u(o.details.client.id),1)]),e("div",Dt,[$t,e("p",null,u(("capitalize"in t?t.capitalize:D(G))(`${o.details.client.first_name} ${o.details.client.middle_name} ${o.details.client.last_name}`)),1)]),e("div",jt,[Ot,e("p",null,u(o.details.client.sex),1)]),e("div",Ut,[Nt,e("p",null,u(("calculateAge"in t?t.calculateAge:D(re))(o.details.client.date_of_birth)),1)])])]),e("div",Lt,[Pt,e("div",qt,[e("div",Ft,[Vt,e("p",null,u(o.details.specimen_type),1)]),e("div",Et,[Bt,e("p",null,u(o.details.tracking_number),1)]),e("div",Mt,[Xt,e("p",null,u(o.details.accession_number),1)]),e("div",zt,[Gt,e("p",null,u(o.details.status),1)])])]),e("div",Ht,[Yt,e("div",Kt,[e("div",Wt,[Jt,e("p",null,u(o.details.test_type_name),1)]),e("div",Qt,[Zt,e("p",null,u(o.moment(o.details.created_date).format("dateFormat"in t?t.dateFormat:D(X))),1)]),e("div",es,[ts,e("p",null,u(o.moment(o.details.updated_date).format("dateFormat"in t?t.dateFormat:D(X))),1)]),e("div",ss,[os,e("p",null,u(o.details.status),1)]),e("div",ns,[rs,e("p",null,u(o.details.requesting_ward),1)]),e("div",is,[as,e("p",null,u(o.details.request_origin),1)]),e("div",ls,[cs,e("p",null,u(r.getRequestedBy(o.details.status_trail)),1)]),e("div",ds,[us,e("p",null,u(o.details.requested_by),1)])])])]),e("div",ms,[e("div",ps,[hs,e("div",_s,[i(f,{icon:o.viewIcon,text:"View Report",click:r.viewReport,color:"primary"},null,8,["icon","click"]),i(C,{item:o.details,onUpdate:r.updateChanges,color:"primary"},null,8,["item","onUpdate"]),i(f,{icon:o.printerIcon,text:"Print Accession Number",click:r.printAccessionNumber,color:"primary"},null,8,["icon","click"]),i(f,{icon:o.printerIcon,color:"success",text:"Print Tracking Number",click:r.printTrackingNumber},null,8,["icon","click"])])]),(p(!0),g(q,null,F(o.details.indicators,(l,d)=>(p(),g("div",{class:te(o.details.indicators.length!==d+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:d},[e("h3",null,u(l.name),1),e("div",null,[l.result?(p(),g("p",{key:0,innerHTML:l.result.value?l.result.value:"Not done"},null,8,fs)):R("",!0)])],2))),128))])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const bs=U(ht,[["render",gs]]),ys={components:{TransitionRoot:Y,TransitionChild:K,Dialog:W,DialogPanel:J,DialogTitle:Q,XMarkIcon:L,UserIcon:ie},data(){return{open:!1,addIcon:oe,saveIcon:ae,clearIcon:le,name:"",description:"",loading:!1,cookie:V("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const t={route:k.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:s,data:n}=await T(t);n.value&&(this.rawReasons=n.value,n.value.map(a=>{this.reasons.push(a.description)})),s.value&&console.error(s.value)},async submitForm(){this.loading=!0;let t=null;this.rawReasons.map(r=>{r.description===this.reasonsSelected&&(t=r.id)});const s={route:`${k.testStatus}/${this.item.id}/${this.action}?status_reason_id=${t}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:n,error:a,pending:o}=await T(s);this.loading=o,n.value&&(I().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),a.value&&(console.error(a.value),I().$toast.error(B),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},xs=""+new URL("rdt_result_no_test.6a8034c1.svg",import.meta.url).href,vs=e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),ws={class:"fixed inset-0 overflow-y-auto"},ks={class:"flex min-h-full items-center justify-center p-4 text-center"},Ts={class:"border-b px-3 py-3 flex items-center justify-between"},Ss=e("img",{src:xs,class:"w-8 h-8 mr-2"},null,-1),Cs={class:"mt-2 space-y-3 px-5 py-5"},Is={class:"space-y-2"},As=e("h3",{class:"font-medium"},"Test Type",-1),Rs={class:"border-b border-dotted text-gray-600"},Ds={class:"space-y-2"},$s=e("h3",{class:"font-medium"},"Specimen",-1),js={class:"border-b border-dotted text-gray-600"},Os={class:"space-y-2"},Us=e("h3",{class:"font-medium"},"Accession Number",-1),Ns={class:"border-b border-dotted text-gray-600"},Ls={class:"w-full flex items-center"},Ps={class:"w-full flex flex-col space-y-2"},qs={class:"w-full flex flex-col space-y-2 pb-40"},Fs=e("label",{class:"font-medium"},"Select Reason(s)",-1),Vs={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Es(t,s,n,a,o,r){const f=E,_=c("TransitionChild"),S=c("DialogTitle"),x=c("XMarkIcon"),y=c("FormKit"),C=c("multi-select"),m=se,v=c("DialogPanel"),w=c("Dialog"),l=c("TransitionRoot");return p(),g("div",null,[e("div",null,[i(f,{text:n.text,color:"error",icon:n.icon,click:r.init},null,8,["text","icon","click"])]),i(l,{appear:"",show:o.open,as:"template"},{default:h(()=>[i(w,{as:"div",onClose:r.handleClick,class:"relative z-10"},{default:h(()=>[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:h(()=>[vs]),_:1}),e("div",ws,[e("div",ks,[i(_,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:h(()=>[i(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:h(()=>[e("div",Ts,[i(S,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:h(()=>[Ss,N(" "+u(n.text.charAt(0).toUpperCase()+n.text.slice(1))+" Reason ",1)]),_:1}),e("button",{onClick:s[0]||(s[0]=(...d)=>r.handleClick&&r.handleClick(...d))},[i(x,{class:"w-5 h-5"})])]),i(y,{type:"form","submit-label":"Update",onSubmit:r.submitForm,actions:!1,id:"rejectionForm"},{default:h(({value:d})=>[e("div",Cs,[e("div",Is,[As,e("p",Rs,u(n.item.test_type_name),1)]),e("div",Ds,[$s,e("p",js,u(n.item.specimen_type),1)]),e("div",Os,[Us,e("p",Ns,u(n.item.accession_number),1)]),e("div",Ls,[e("div",Ps,[i(y,{type:"text",label:"Person Talked To",validation:"required",modelValue:o.name,"onUpdate:modelValue":s[1]||(s[1]=b=>o.name=b)},null,8,["modelValue"])])]),e("div",qs,[Fs,i(C,{style:{"--ms-max-height":"none !important"},modelValue:o.reasonsSelected,"onUpdate:modelValue":s[2]||(s[2]=b=>o.reasonsSelected=b),options:o.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",Vs,[i(m,{type:"button",text:"Clear form",click:r.resetForm},null,8,["click"]),i(f,{loading:o.loading,type:"submit",click:()=>{},color:"success",icon:o.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Bs=U(ys,[["render",Es]]),Ms={components:{MagnifyingGlassIcon:Ie,Listbox:Le,ListboxButton:Pe,ListboxLabel:qe,ListboxOptions:Fe,ListboxOption:Ve,ChevronUpDownIcon:pe,ArrowRightIcon:Ye,ChevronDownIcon:Ae,Menu:Ee,MenuButton:Be,MenuItems:Me,MenuItem:Xe,CheckIcon:Re,PopoverButton:ze,Popover:Ge,PopoverPanel:He,XMarkIcon:L,CheckCircleIcon:De},setup(){const t=z();ue({title:`${Ce.name.toUpperCase()} - ${t.department} Tests`})},data(){return{moment:$,addIcon:ee,filterIcon:$e,applyIcon:Ke,acceptIcon:ne,moreActions:!1,okIcon:M,moreIcon:je,lessIcon:Oe,clearIcon:Ue,dropIcon:P,editIcon:H,refreshIcon:Ne,dateRange:[],search:"",header:"Tests Lists",pages:[{name:"Home",link:"/home"}],headers:[{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions"}],statuses:[{text:"Results",color:"primary",icon:ee,status:"completed",show:"started"},{text:"Accept",color:"success",icon:M,status:"pending",show:"not-collected"},{text:"Start",color:"warning",icon:We,status:"started",show:"pending"},{text:"Authorize",color:"success",status:"verified",icon:M,show:"completed"}],rejectStatuses:[{name:"Reject",icon:P,action:"rejected"},{name:"Void",icon:P,action:"voided"},{name:"Not-done",icon:P,action:"not_done"}],changing:!1,data:new Array,statusSelected:{name:"select status"},searchField:"accession_number",searchValue:"",cookie:V("token"),loading:!1,serverItemsLength:0,serverOptions:{page:1,rowsPerPage:25,sortBy:"name"},authStore:z(),testStatuses:new Array,filters:new Array,i18n:me()}},created(){this.init()},methods:{async searchNlims(t){this.loading=!0;const s={route:`${k.nlimsTestSearch}?tracking_number=${t.replace(/\$$/,"")}`,method:"GET",token:`${this.cookie}`},{data:n,error:a}=await T(s);n.value&&(ve(n.value),this.loading=!1),a.value&&(console.error(a.value),I().$toast.error(`${a.value.data.error}`),this.loading=!1)},async init(){this.loadStatuses(),this.loading=!0;const{t}=this.i18n;for(var s=0;s<this.headers.length;++s)switch(this.headers[s].text){case"PATIENT":this.headers[s].text=t("patient");break;case"ACCESSION NO":this.headers[s].text=t("ACCESSION_NO");break;case"TEST":this.headers[s].text=t("TEST");break;case"LOCATION":this.headers[s].text=t("LOCATION");break;case"ORDER STATUS":this.headers[s].text=t("ORDER_STATUS");break;case"STATUS":this.headers[s].text=t("STATUS");break;case"DATE REGISTERED":this.headers[s].text=t("DATE_REGISTERED");break;case"ACTIONS":this.headers[s].text=t("ACTIONS");break}this.statusSelected.name==="select status"&&(this.statusSelected.name=t("select_status"));const{page:n,rowsPerPage:a}=this.serverOptions;let o=this.getIdFromName(this.authStore.user.departments,this.authStore.department),r=this.statusSelected.name==="select status"?"":this.statusSelected.name;const f=this.dateRange!==null&&this.dateRange.length>0?$(this.dateRange[0]).format("YYYY-MM-DD"):"",_=this.dateRange!==null&&this.dateRange.length>1?$(this.dateRange[1]).format("YYYY-MM-DD"):"",S={route:`${k.tests}?minimal=true&page=${n}&per_page=${a}&status=${r.toLowerCase()}&search=${this.search}&department_id=${o}&start_date=${f}&end_date=${_}`,method:"GET",token:`${this.cookie}`},{data:x,error:y,pending:C}=await T(S);this.loading=C,x.value&&(this.data=x.value.data.map(m=>{var v,w,l,d;return{...m,name:`${G(((v=m.client)==null?void 0:v.first_name)+" "+((w=m.client)==null?void 0:w.middle_name)+" "+((l=m.client)==null?void 0:l.last_name))}(${m.client.sex}, ${re((d=m.client)==null?void 0:d.date_of_birth)} yrs)`,order_status:`${m.order_status!==null?(m.order_status.charAt(0).toUpperCase()+m.order_status.slice(1)).split("-").join(" "):""}`,status:`${m.status!==null?m.status.charAt(0).toUpperCase()+m.status.slice(1):""}`,created_date:$(m.created_date).format(X)}}),this.serverItemsLength=x.value.meta.total_count,this.loading=!1),y.value&&(console.error(y.value.data),I().$toast.error(B),this.loading=!1)},async loadStatuses(){const t={route:`${k.testStatus}/all`,method:"GET",token:`${this.cookie}`},{data:s,error:n}=await T(t);s.value&&(this.testStatuses=s.value.map(a=>({id:a.id,name:a.name.charAt(0).toUpperCase()+a.name.slice(1)}))),n.value&&console.error(n.value)},async changeStatus(t,s){this.loading=!0;const n={route:`${k.testStatus}/${s}/${t}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:a,error:o,pending:r}=await T(n);this.loading=r,a.value&&(this.init(),this.loading=!1),o.value&&(console.error(o.value),this.loading=!1)},async changeOrderStatus(t,s){this.loading=!0;const n={route:`${k.orderStatus}/${t}`,method:"PUT",token:`${this.cookie}`,body:{order_id:s}},{data:a,error:o,pending:r}=await T(n);this.loading=r,a.value&&(this.init(),this.loading=!1),o.value&&(console.error(o.value),this.loading=!1)},checkStatus(t,s){t.status==="completed"?s.test_type_name.toLowerCase().includes("culture")?this.redirect(s,`/tests/result/culture-sensitivity?accession_number=${s.accession_number}&test_id=${s.id}`):this.redirect(s,`/tests/result?accession_number=${s.accession_number}&test_id=${s.id}`):t.status!==""?this.changeStatus(t.status,s.id):this.printTest(s)},printTest(t){print()},statusList(t,s){for(var n="",a=0;a<t.length;++a)n=we(t[a].name,s),t[a].name=n;return t},chaStatusSelected(t,s){t.name==="select status"?this.statusSelected.name=s("select_status"):this.statusSelected=t},getIdFromName(t,s){const n=t.find(a=>a.name===s);return n?n.id:null},updateTests(t){typeof t=="object"&&(this.serverOptions=t),this.init(),this.moreActions=!1},refreshTests(){this.searchValue="",this.search="",this.init()},update(t){this.search=t,this.searchValue=t,t!==""?this.checkTrackingNumber(t)?this.searchNlims(t):this.updateTests(t):this.init()},handleClick(){this.moreActions=!this.moreActions},redirect(t,s){this.$router.push(s)},checkTrackingNumber(t){return/^(x|l).*\d/.test(t.toLowerCase())},updateOnStatus(t){if(t.name!=="select status"){const s=this.filters.find(n=>n.origin==="statuses");s?s.value=t.name:this.filters.push({origin:"statuses",value:t.name})}this.statusSelected=t,this.init()},removeFilter(t){t.origin==="statuses"&&this.statusSelected.name!=="select status"&&this.updateOnStatus({name:"select status"});const s=this.filters.findIndex(n=>n.origin===t.origin);s!==-1&&this.filters.splice(s,1),this.init()},isCompletedByCurrentUserOrSuperAdmin(t){const s=this.authStore.user,n=t.completed_by;if(n){if(n.id!==s.id)return!0;if(n.is_super_admin===!0)return!0}return!1},shouldDisplayButton(t,s){const n=t.status.toLowerCase(),a=s.show.toLowerCase();if(n===a){const o=this.isCompletedByCurrentUserOrSuperAdmin(t);return n==="pending"&&t.order_status.toLowerCase()==="specimen not collected"?!1:o}return!1},hideRejectActions(t){return!["voided","test-rejected","verified"].includes(t.toLowerCase())}},watch:{authStore:{handler(){this.init()},deep:!0},dateRange:{handler(){this.init()},deep:!0},statusSelected:{handler(t){this.updateOnStatus(t)},deep:!0}}},Xs={class:"py-5 px-5"},zs={class:"flex items-center justify-between py-5"},Gs={class:"text-2xl font-semibold"},Hs={class:"flex justify-between items-center w-full py-2 mb-2"},Ys={class:"flex items-center space-x-2"},Ks={class:"relative z-10 w-40"},Ws={class:"w-72 pt-1"},Js={class:"py-3 flex items-center space-x-3"},Qs={class:"py-2 flex items-center"},Zs={class:"w-full flex items-center justify-between space-x-2"},eo={class:"flex items-center space-x-2"},to={key:0,class:"flex items-center space-x-2"},so=e("div",{id:"tests-container"},null,-1);function oo(t,s,n,a,o,r){const f=ce,_=E,S=he,x=c("datepicker"),y=_e,C=et,m=bs,v=Bs,w=Se;return p(),g("div",Xs,[i(f,{pages:o.pages},null,8,["pages"]),e("div",zs,[e("h3",Gs,u(t.$t("Tests_Lists")),1)]),e("div",Hs,[e("div",Ys,[i(_,{text:t.$t("Refresh"),color:"warning",icon:o.refreshIcon,click:()=>{r.refreshTests()},loading:o.loading},null,8,["text","icon","click","loading"]),e("div",Ks,[i(S,{items:r.statusList(o.testStatuses,t.$t),modelValue:o.statusSelected,"onUpdate:modelValue":s[0]||(s[0]=l=>o.statusSelected=l)},null,8,["items","modelValue"])]),e("div",Ws,[i(x,{placeholder:t.$t("start_enddate"),range:"","input-classes":"border font-normal rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:o.dateRange,"onUpdate:modelValue":s[1]||(s[1]=l=>o.dateRange=l),format:"datePickerFormat"in t?t.datePickerFormat:D(ge)},null,8,["placeholder","modelValue","format"])])]),i(y,{onUpdate:r.update,search:o.search},null,8,["onUpdate","search"])]),e("div",Js,[(p(!0),g(q,null,F(o.filters,(l,d)=>(p(),A(C,{value:{origin:"statuses",text:l.value},close:"",color:"green",key:d,onUpdate:r.removeFilter},null,8,["value","onUpdate"]))),128))]),i(w,{headers:o.headers,data:o.data,loading:o.loading,searchField:o.searchField,searchValue:o.searchValue,serverItemsLength:o.serverItemsLength,serverOptions:o.serverOptions,onUpdate:r.updateTests},{actions:h(({item:l})=>[e("div",Qs,[e("div",Zs,[j(e("div",eo,[i(m,{data:l,onUpdate:r.updateTests},null,8,["data","onUpdate"]),l.status.toLowerCase()==="completed"?(p(),A(_,{key:0,click:()=>{r.checkStatus({status:"completed"},l)},text:"Edit",color:"success",icon:o.editIcon},null,8,["click","icon"])):R("",!0),(p(!0),g(q,null,F(o.statuses,(d,b)=>j((p(),A(_,{color:d.color,text:d.text,icon:d.icon,click:()=>{r.checkStatus(d,l)},key:b},null,8,["color","text","icon","click"])),[[O,r.shouldDisplayButton(l,d)]])),128)),l.order_status.toLowerCase()==="specimen not collected"?(p(),A(_,{key:1,color:"success",text:"Accept",icon:o.acceptIcon,click:()=>r.changeOrderStatus("accepted",l.order_id)},null,8,["icon","click"])):R("",!0)],512),[[O,!o.moreActions]]),r.hideRejectActions(l.status)?(p(),A(_,{key:0,click:r.handleClick,color:"",text:"",icon:o.moreActions==!0?o.lessIcon:o.moreIcon},null,8,["click","icon"])):R("",!0)]),r.hideRejectActions(l.status)?j((p(),g("div",to,[r.hideRejectActions(l.status)?(p(!0),g(q,{key:0},F(o.rejectStatuses,(d,b)=>(p(),A(v,{item:l,key:b,text:d.name,icon:d.icon,action:d.action,onUpdate:r.updateTests},null,8,["item","text","icon","action","onUpdate"]))),128)):R("",!0)],512)),[[O,o.moreActions]]):R("",!0)])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"]),so])}const Vo=U(Ms,[["render",oo]]);export{Vo as default};
