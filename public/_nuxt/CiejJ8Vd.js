import{_ as ae}from"./CNMhSPC9.js";import{_ as ne}from"./CDRCXyuD.js";import{d as le,r as M,a as de,al as ie,M as ue,u as ce,ay as O,c as k,z as v,w as N,o as me,x as L,b as m,e as p,f as y,h as t,g as a,t as x,j as B,A as V,y as pe,X as q,F as $,k as C,C as S,l as _e,E as fe,_ as ve}from"./B6cxelmB.js";import{_ as ye}from"./BVsjZ3M-.js";import{_ as be}from"./Da23Wecq.js";import{_ as Re}from"./C6204BTj.js";import{_ as ge}from"./B89sC22T.js";import{_ as he}from"./B4T1yN21.js";import{_ as xe}from"./DmiAZkRe.js";import{_ as De}from"./ZGUkzQQ_.js";import{u as Ee}from"./DsqkzYFl.js";import{P as Te}from"./D4--2Hlb.js";import{u as we}from"./CZuTiJYT.js";import{u as Ae}from"./DfYfzQ7B.js";import{r as Me}from"./DPQIzDnK.js";import{r as ke}from"./DZ0fSVSz.js";import"./ggmJqlUs.js";import"./D3aePf0O.js";import"./D2wjyI06.js";import"./1lOtxyWh.js";import"./DnKNuaHm.js";import"./CRKLI29b.js";import"./48QfwrLv.js";import"./81D-L97k.js";import"./KGHA3aGV.js";import"./CW8KkBU1.js";import"./D4gN629H.js";const $e={class:"px-5 py-5"},qe={class:"w-full flex items-center justify-between"},Ce={class:"flex items-center space-x-3"},Fe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Oe={class:"w-72 ml-2"},Se={class:"w-44"},Ye={class:"flex items-center space-x-3"},je={class:"border rounded mt-5"},Pe={class:"flex items-center justify-between px-5 py-5 border-b"},Ne={class:"mt-3 px-5"},Le={class:"text-lg font-semibold mb-2"},Be={class:"text-normal font-normal"},Ve={key:0,class:"print-container",id:"print-container"},Ue={class:"w-full border border-dotted rounded overflow-x-auto"},Ge={key:0,class:"w-full px-2 py-2 bg-gray-100 text-sky-500 uppercase text-lg font-semibold"},Ie={class:"bg-gray-50 border-b border-dotted rounded-t"},Qe={class:"border-r border-b border-dotted px-2 py-2"},ze=["onClick"],He={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},Je={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Xe="Rejected Samples Report",wt=le({__name:"rejected-samples",setup(Ke){we({title:`${Te.name.toUpperCase()} - Rejected Samples Report`});const U=M([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),E=M([]),G=de("token"),F=Ee(),D=ie(),l=ue(),{loading:b,executeCancellableRequest:I,cancelRequest:Q}=Ae(),u=M(["",""]),{$toast:A,$metadata:z}=ce(),i=M({name:l.query.department?String(l.query.department):O,id:l.query.department_id?Number(l.query.department_id):void 0}),H=()=>{u.value=new Array("","")},R=M({results:[],value:void 0,wards:[]}),Y=k(()=>R.value.results.map(r=>{const e={};r.test_types.forEach(s=>{const{name:o,ward:d,count:_,associated_ids:f}=s;e[o]||(e[o]={}),e[o][d]||(e[o][d]={count:0,associated_ids:""}),e[o][d].count+=_,e[o][d].associated_ids=f});const n=Object.keys(e).map(s=>({name:s,wards:e[s]}));return{name:r.name,testTypes:n}})),J=k(()=>{const r=[];return R.value.results.forEach(e=>{const n={},s={};e.test_types.forEach(o=>{const{name:d,ward:_,count:f}=o;n[d]||(n[d]={},s[d]=0),n[d][_]=f||0,s[d]+=f});for(const o in n){const d=n[o],_={TESTS:o};R.value.wards.forEach(f=>{_[f]=d[f]!==void 0?d[f]:0}),_.REASON=e.name,_.TOTAL=s[o],r.push(_)}}),r}),X=(r,e)=>{const n=Y.value.find(o=>o.name===r),s=n==null?void 0:n.testTypes.find(o=>o.name===e);return s?Object.values(s.wards).reduce((o,d)=>o+d.count,0):0},T=k(()=>u.value[0]?v(u.value[0]).format("YYYY-MM-DD"):""),w=k(()=>u.value[1]?v(u.value[1]).format("YYYY-MM-DD"):"");async function j(){if(K())A.warning("Please select a department");else{b.value=!0;const r={route:`${_e.aggregateReports}rejected?from=${T.value}&to=${w.value}&department=${i.value.id==0?"":i.value.id}&report_id=${l.query.report_id}`,method:"GET",token:`${G.value}`},{data:e,error:n,pending:s}=await I(r);b.value=s,e.value&&(console.log(e.value),b.value=!1,R.value=e.value,W(e.value.report_id),e.value.results.length>0?A.success("Report generated successfully!"):A.warning("Data not found within the specified period")),n.value&&(console.error(n.value),b.value=!1,A.error(fe))}}const K=()=>i.value.name==O,W=r=>{const n={...D.currentRoute.value.query,report_id:r};D.replace({query:n}).catch(s=>{console.error("Failed to replace route:",s)})},Z=(r,e,n,s)=>{if(n!==0&&s!==""){const o=i.value.name,d=i.value.id;D.push(`/reports/${s}?origin=aggregate&type=rejected-samples-report&from=${T.value}&to=${w.value}&test=${r} - ${e}&department=${o}&department_id=${d}&count=${n}`)}else A.warning("No data found for this month")};N(u,()=>{const r=u.value[0]?v(u.value[0]).format("YYYY-MM-DD"):"",e=u.value[1]?v(u.value[1]).format("YYYY-MM-DD"):"";if(r||e){const s={...D.currentRoute.value.query,...r&&{from:r},...e&&{to:e},...i.value.name!==O&&{department:i.value.name,department_id:i.value.id},...l.query.report_id&&{report_id:""}};D.replace({query:s}).catch(o=>{console.error("Failed to replace route:",o)})}},{deep:!0}),N(i,(r,e)=>{if(r!==e){const s={...D.currentRoute.value.query,department:r.name||"",department_id:r.id,report_id:""};D.replace({query:s}).catch(o=>{console.error("Failed to replace route:",o)})}});const P=()=>{if(l.query.department){const r=E.value.find(e=>e.name===l.query.department);r?i.value={name:r.name,id:r.id}:l.query.department_id&&(i.value={name:String(l.query.department),id:Number(l.query.department_id)})}},ee=k(()=>l.query.to!==void 0&&l.query.from!==void 0&&l.query.department!==void 0?(u.value=[l.query.from,l.query.to],P(),l.query.to!==""&&l.query.from!==""&&l.query.department!==""):!1);return me(()=>{E.value=z.departments,E.value.some(e=>e.name=="All")||E.value.push({id:0,name:"All"}),E.value.sort((e,n)=>{const s=e.name.toUpperCase(),o=n.name.toUpperCase();return s<o?-1:s>o?1:0}),P(),ee.value?j():b.value=!1}),(r,e)=>{const n=ae,s=L("datepicker"),o=ne,d=ve,_=ye,f=be,te=L("excel"),re=Re,oe=ge;return m(),p("div",$e,[y(n,{pages:t(U)},null,8,["pages"]),a("div",{class:"flex items-center py-5"},[e[2]||(e[2]=a("img",{src:he,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),a("h3",{class:"text-2xl font-semibold uppercase"},x(Xe))]),a("div",qe,[a("div",Ce,[a("div",Fe,[y(t(Me),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=B(" Filter By Date Range ")),a("div",Oe,[y(s,{onCleared:H,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(u),"onUpdate:modelValue":e[0]||(e[0]=g=>V(u)?u.value=g:null),format:"dd/MM/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),a("div",Se,[y(o,{items:t(E),modelValue:t(i),"onUpdate:modelValue":e[1]||(e[1]=g=>V(i)?i.value=g:null)},null,8,["items","modelValue"])]),y(d,{color:"primary",text:"Generate Report",icon:t(ke),click:()=>j(),loading:t(b)},null,8,["icon","click","loading"])]),a("div",Ye,[y(_,{printSmallLabel:!1}),y(te,{class:"btn btn-default",header:[`REJECTED ${t(i).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${t(v)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(q))} TO ${t(v)(t(w)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(q))}`,t(F).details.name,t(F).details.address,t(F).details.phone],data:t(J),worksheet:"report-work-sheet",name:`rejected_${t(i).name.toLowerCase().split(" ").join("_")}_report_${t(v)(t(T)).format("DD_MM_yyyy")}_to_${t(v)(t(w)).format("DD_MM_yyyy")}.xls`},{default:pe(()=>[y(f,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),a("div",je,[a("div",Pe,[e[4]||(e[4]=a("div",{class:"flex flex-col space-y-2"},[a("img",{src:xe,alt:"app-logo",class:"w-24 h-24 object-cover"}),a("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1)),y(re)]),a("div",Ne,[a("h3",Le,[e[5]||(e[5]=B(" Tests Performed Period: ")),a("span",Be,x(t(T)!=""?t(v)(t(T)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(q)):"")+" - "+x(t(w)!=""?t(v)(t(w)).format("DATE_FORMAT"in r?r.DATE_FORMAT:t(q)):""),1)])]),t(R).results.length>0&&!t(b)?(m(),p("div",Ve,[a("table",Ue,[(m(!0),p($,null,C(t(Y),(g,se)=>(m(),p($,{key:se},[g.name?(m(),p("div",Ge,x(g.name),1)):S("",!0),a("thead",Ie,[a("tr",null,[e[6]||(e[6]=a("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1)),(m(!0),p($,null,C(t(R).wards,c=>(m(),p("th",{key:c,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(c),1))),128)),e[7]||(e[7]=a("th",{class:"border-r border-t border-b border-dotted px-2 py-2"}," TOTAL ",-1))])]),a("tbody",null,[(m(!0),p($,null,C(g.testTypes,c=>(m(),p("tr",{key:c.name},[a("td",Qe,x(c.name),1),(m(!0),p($,null,C(t(R).wards,h=>(m(),p("td",{key:h,onClick:We=>Z(c.name,h,c.wards[h]?c.wards[h].count:0,c.wards[h]?c.wards[h].associated_ids:""),class:"px-4 border-r border-b border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(c.wards[h]?c.wards[h].count:0),9,ze))),128)),a("td",He,x(X(g.name,c.name)),1)]))),128))])],64))),128))])])):S("",!0),y(oe,{condition:t(b),cancelReportGeneration:()=>t(Q)()},null,8,["condition","cancelReportGeneration"]),t(R).wards.length==0&&t(R).results.length==0&&!t(b)?(m(),p("div",Je,e[8]||(e[8]=[a("img",{src:De,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),a("p",{class:"text-base"}," Please generate report data to preview the report ",-1)]))):S("",!0)])])}}});export{wt as default};
