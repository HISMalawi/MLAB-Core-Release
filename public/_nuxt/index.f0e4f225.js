import{a as C,b as y,_ as I,g as p,o as w,c as D,d as s,h as u,e as m,i as T,q,k as z,f as F}from"./entry.2f1e42b9.js";import{h as L,E as R}from"./jspdf.es.min.c7b75303.js";import{a as A,e as b,f as k}from"./fetch.f66c8189.js";import{r as U}from"./XMarkIcon.a6ae467b.js";import{r as x}from"./PrinterIcon.d705e3fe.js";import{S as V,h as N,U as O,G as B,V as $}from"./transition.0eb804de.js";const j={components:{TransitionRoot:V,TransitionChild:N,Dialog:O,DialogPanel:B,DialogTitle:$,XMarkIcon:U,ExclamationTriangleIcon:A,PrinterIcon:x},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1}},data(){return{show:!1,printIcon:x,cookie:C("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const c={route:b.printers,method:"GET",token:`${this.cookie}`},{data:e,error:i,pending:o}=await k(c);e.value&&(this.printers=new Array,e.value.map(t=>{this.printers.push(t.name)})),i.value&&console.error(i.value)},async toPrintSmallLabel(){this.zebraPrinting=!0;const c={route:b.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests}},{data:e,error:i,pending:o}=await k(c);if(this.zebraPrinting=o,e.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const n=URL.createObjectURL(e.value),a=document.createElement("a");a.href=n,a.setAttribute("download",`${Date.now()}.lbl`),a.click(),URL.revokeObjectURL(n)},t.readAsText(e.value)}i.value&&(this.zebraPrinting=!1,console.error(i.value))},async generatePDF(){this.loading=!0;const c=document.querySelector(".print-container"),e=await L(c,{scale:1,onclone:r=>{const f=r.body.querySelector(".print-container");f.style.display="block"}}),i=e.toDataURL("image/png"),o=new R({orientation:"portrait",unit:"px",format:"a4",hotfixes:["px_scaling"]}),t=o.internal.pageSize.getHeight(),n=o.internal.pageSize.getWidth(),a=e.height*n/e.width;let l=0;const d=10;let h=d,g=!0;const _=(r=0)=>{l++,g||o.addPage(),o.addImage(i,"PNG",0,-r,n,a),h+=t-2*d,g=!1};for(;h<a+d;)_(h);for(let r=1;r<=l;r++)o.setPage(r),o.setFontSize(12),o.text(`Page ${r} of ${l}`,10,t-10);await(async r=>{const f=r.output("blob");await this.submitForm(f)})(o)},async submitForm(c){var l,d;let e=new FormData,i=new Array;i.push(Number(this.orderId)),e.append("pdf",c,`patient-name-${this.id}`),e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(i));const o={route:b.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:t,error:n,pending:a}=await k(o);this.loading=a,t.value&&(t.value.printed?y().$toast.success("Patient report printed successfully!"):y().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((l=this.$route.query.printer)==null?void 0:l.toString())=="true"&&this.$router.back(),this.handleClick()),n.value&&(this.loading=!1,console.error(n.value),y().$toast.error("An error occurred while printing patient report"),this.handleClick(),((d=this.$route.query.printer)==null?void 0:d.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show}}},E=m("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),G={class:"fixed inset-0 overflow-y-auto"},H={class:"flex top-0 items-center justify-center p-4 text-center"},M={class:"border-b px-3 py-3 flex items-center justify-between"},X={class:"py-5 px-5"},K={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function W(c,e,i,o,t,n){const a=F,l=p("TransitionChild"),d=p("PrinterIcon"),h=p("DialogTitle"),g=p("XMarkIcon"),_=p("FormKit"),v=p("DialogPanel"),r=p("Dialog"),f=p("TransitionRoot");return w(),D("div",null,[s(a,{click:n.init,color:"primary",text:"Print",icon:t.printIcon},null,8,["click","icon"]),s(f,{appear:"",show:t.show,as:"template"},{default:u(()=>[s(r,{as:"div",class:"relative z-10"},{default:u(()=>[s(l,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:u(()=>[E]),_:1}),m("div",G,[m("div",H,[s(l,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:u(()=>[s(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:u(()=>[m("div",M,[s(h,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:u(()=>[s(d,{class:"h-5 w-5 mr-2"}),T(" Print ")]),_:1}),m("button",{onClick:e[0]||(e[0]=(...P)=>n.handleClick&&n.handleClick(...P))},[s(g,{class:"w-5 h-5"})])]),s(_,{type:"form","submit-label":"Update",onSubmit:n.generatePDF,actions:!1},{default:u(({value:P})=>[m("div",X,[s(_,{validation:"required",label:"Select a printer",type:"radio",modelValue:t.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=S=>t.selectedPrinter=S),options:t.printers},null,8,["modelValue","options"])]),m("div",K,[i.printSmallLabel?(w(),q(a,{key:0,type:"button",loading:t.zebraPrinting,click:()=>{n.toPrintSmallLabel()},icon:t.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):z("",!0),s(a,{click:()=>{},loading:t.loading,type:"submit",icon:t.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const oe=I(j,[["render",W]]);export{oe as _};
