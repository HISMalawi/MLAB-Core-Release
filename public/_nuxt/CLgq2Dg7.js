var H=Object.defineProperty;var M=(o,t,s)=>t in o?H(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var A=(o,t,s)=>M(o,typeof t!="symbol"?t+"":t,s);import{u as d,a$ as P,b0 as z,r as b,c as D,al as w,a as F,l as q,m as C}from"./Iy63StId.js";import{H as O}from"./BYvWnHVP.js";function U(o,t){const s=t/o*100;return 2/Math.PI*100*Math.atan(s/50)}function K(o={}){const{duration:t=2e3,throttle:s=200,hideDelay:g=500,resetDelay:f=400}=o,u=o.estimatedProgress||U,n=d(),e=b(0),r=b(!1),p=b(!1);let l=!1,c,m,v,_;const y=()=>{p.value=!1,h(0)};function h(a=0){if(!n.isHydrating){if(a>=100)return i();T(),e.value=a<0?0:a,s?m=setTimeout(()=>{r.value=!0,R()},s):(r.value=!0,R())}}function S(){v=setTimeout(()=>{r.value=!1,_=setTimeout(()=>{e.value=0},f)},g)}function i(a={}){e.value=100,l=!0,T(),L(),a.error&&(p.value=!0),a.force?(e.value=0,r.value=!1):S()}function L(){clearTimeout(v),clearTimeout(_)}function T(){clearTimeout(m),cancelAnimationFrame(c)}function R(){l=!1;let a;function k(I){if(l)return;a??(a=I);const E=I-a;e.value=Math.max(0,Math.min(100,u(t,E))),c=requestAnimationFrame(k)}c=requestAnimationFrame(k)}let x=()=>{};{const a=n.hook("page:loading:start",()=>{y()}),k=n.hook("page:loading:end",()=>{i()}),I=n.hook("vue:error",()=>i());x=()=>{I(),a(),k(),T()}}return{_cleanup:x,progress:D(()=>e.value),isLoading:D(()=>r.value),error:D(()=>p.value),start:y,set:h,finish:i,clear:T}}function G(o={}){const t=d(),s=t._loadingIndicator=t._loadingIndicator||K(o);return P()&&(t._loadingIndicatorDeps=t._loadingIndicatorDeps||0,t._loadingIndicatorDeps++,z(()=>{t._loadingIndicatorDeps--,t._loadingIndicatorDeps===0&&(s._cleanup(),delete t._loadingIndicator)})),s}class N{constructor(t){A(this,"RESOURCE","auth/login");this.httpFactory=t}async login(t){const s={route:this.RESOURCE,method:"POST",body:t};return this.httpFactory.call(s)}}const $=w("lastRoute",{state:()=>({route:"/home"}),actions:{lastKnownRoute(o){this.route=o}},persist:{storage:sessionStorage}}),Q=w("auth",{state:()=>({authenticated:!1,loading:!1,user:{},department:"",locations:[],selectedLocation:""}),actions:{async authenticateUser({username:o,password:t,department:s}){var l,c,m,v,_,y;let g=new N(new O);const f={username:o,password:t,department:s},{$toast:u,$router:n}=d(),{data:e,error:r,pending:p}=await g.login(f);if(this.loading=p,r.value&&u.error(r.value.data.error),e.value){let h=new Date((l=e==null?void 0:e.value)==null?void 0:l.authorization.expiry_time);h.setHours(h.getHours());const S=F("token",{expires:h,path:"/",sameSite:"strict"}),{route:i}=$();if(S.value=(c=e==null?void 0:e.value)==null?void 0:c.authorization.token,S.value!=null){this.authenticated=!0,this.user=(m=e==null?void 0:e.value)==null?void 0:m.authorization.user,this.department=s,this.locations=(v=e==null?void 0:e.value)==null?void 0:v.authorization.user.lab_locations;const L=((_=e==null?void 0:e.value)==null?void 0:_.authorization.user.lab_locations.length)>1;u.success(`Logged in as ${o}`),L?n.push("/locations"):(this.selectedLocation=(y=e==null?void 0:e.value)==null?void 0:y.authorization.user.lab_locations[0].name,i==""?n.push("/home"):n.push(i))}}},async logUserOut(){const o=F("token"),{start:t,finish:s,isLoading:g}=G();t();const{lastKnownRoute:f}=$(),u={route:q.logout,method:"GET",token:`${o.value}`},{data:n,error:e,pending:r}=await C(u);g.value=r,n.value&&(f("/home"),s(),o.value=null,d().$router.push("/"),d().$toast.success("Successfully logged out")),e.value&&(console.error("error: ",e.value),s(),d().$toast.error("Failed to log out"))}},persist:{storage:sessionStorage}});export{$ as a,G as b,Q as u};
