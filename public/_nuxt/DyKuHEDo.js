import{_ as V}from"./BdENdgJT.js";import{_ as D}from"./DM9bqyyZ.js";import{d as F,r as u,u as G,a as H,c as R,w as I,o as M,b as l,e as i,f as p,g as s,h as z,i as C,v as P,j as J,F as b,k as y,t as $,l as x,m as k,_ as K,n as O}from"./D_S6f-1-.js";import{P as Q}from"./D9oLXKDB.js";import{u as W}from"./ms7f_jyB.js";import{r as X}from"./DLYgY-h_.js";import"./WAIr9m7E.js";import"./Cpt9Ovmf.js";const Y={class:"px-5 py-5"},Z={class:"flex items-center space-x-3 justify-between"},ee={class:"w-full mt-5 rounded"},se={class:"flex flex-col items-center mx-auto justify-center py-20"},te={class:"overflow-x-auto mb-20 rounded"},oe={class:"table-auto w-full border-collapse border rounded"},ae={class:"border-b"},ne={class:"w-full bg-gray-50"},re={class:"border-r sticky left-0 bg-white"},le={class:""},ie={class:"flex items-center justify-between border-b py-2 px-4 hover:bg-gray-100 transition duration-150 hover:font-medium"},ce=["checked","disabled","onChange"],be=F({__name:"permissions",setup(ue){W({title:`${Q.name.toUpperCase()} - Permissions`});const B=X,L=u([{name:"Home",link:"/home"},{name:"Access Controls",link:"#"}]),{$toast:j}=G(),c=u(""),m=u([]),d=u([]),v=H("token"),o=u(!1),S=R(()=>{if(!c.value)return m.value;const t=c.value.toLowerCase();return m.value.filter(e=>e.display_name.toLowerCase().includes(t))}),f=async()=>{o.value=!0;const t={route:x.privileges,method:"GET",token:`${v.value}`},{data:e,pending:a,error:n}=await k(t);e.value&&(m.value=e.value,o.value=!1),n.value&&(console.error(n.value),o.value=!1)},w=async()=>{const t={route:x.roles,method:"GET",token:`${v.value}`},{data:e,error:a}=await k(t);e.value&&(d.value=e.value),a.value&&console.error(a.value)},q=async()=>{o.value=!0;const t={route:`${x.roles}/update_permissions`,method:"PUT",token:`${v.value}`,body:{role_privileges:d.value}},{data:e,pending:a,error:n}=await k(t);o.value=a,e.value&&(o.value=!1,j.success("Permissions updated successfully!"),await f(),await w()),n.value&&(o.value=!1,console.error(n.value))},N=t=>new Set(["superadmin","superuser"]).has(t.toLowerCase()),T=(t,e,a)=>{const{checked:n}=t.target;e.privileges=n?[...e.privileges,a]:e.privileges.filter(({id:_})=>_!==a.id)};return I(c,t=>{f()}),M(()=>{f(),w()}),(t,e)=>{const a=V,n=D,_=K,A=O;return l(),i("div",Y,[p(a,{pages:L.value},null,8,["pages"]),e[3]||(e[3]=s("div",{class:"flex items-center justify-between py-5"},[s("h3",{class:"text-2xl font-semibold"},"Permissions")],-1)),s("div",Z,[p(n,{search:c.value,"onUpdate:search":e[0]||(e[0]=r=>c.value=r)},null,8,["search"]),p(_,{loading:o.value,click:q,text:"Save changes",color:"success",icon:z(B)},null,8,["loading","icon"])]),s("div",ee,[C(s("div",se,[p(A,{loading:o.value},null,8,["loading"]),e[1]||(e[1]=s("p",{class:"text-base mt-2"},[J(" Loading permissions, please wait"),s("span",{class:"animate-pulse"},"...")],-1))],512),[[P,o.value]]),C(s("div",te,[s("table",oe,[s("thead",ae,[s("tr",ne,[e[2]||(e[2]=s("th",{class:"px-20 py-2 text-left uppercase font-semibold border sticky left-0"}," Permissions ",-1)),(l(!0),i(b,null,y(d.value,r=>(l(),i("th",{class:"px-4 py-2 text-left uppercase font-semibold",key:r.id},$(r.name),1))),128))])]),s("tbody",null,[(l(!0),i(b,null,y(S.value,(r,E)=>(l(),i("tr",{key:E},[s("td",re,[s("div",le,[s("div",ie,[s("p",null,$(r.display_name),1)])])]),(l(!0),i(b,null,y(d.value,(h,U)=>(l(),i("td",{class:"border px-4 py-2",key:U},[s("input",{type:"checkbox",checked:h.privileges.filter(g=>g.name==r.name).length>0,class:"mr-2 leading-tight",disabled:N(h.name),onChange:g=>T(g,h,r)},null,40,ce)]))),128))]))),128))])])],512),[[P,!o.value]])])])}}});export{be as default};
