import{_ as j}from"./CRuJk1iG.js";import{a as q,z as w,ax as I,l as P,m as F,U as B,a2 as C,s as U,x as M,b as a,e as p,f as x,g as e,j as v,t as i,i as E,ay as V,H as Y,D as h,h as T,az as A,aA as H,F as y,k as g,v as L,_ as G,n as Q}from"./DbJ6VTtH.js";import{_ as X}from"./xKZoS5Yg.js";import{u as Z}from"./BPFQqTxh.js";import{P as J}from"./BJRIIcKh.js";import{u as K}from"./BoB3wlvU.js";import{r as W}from"./BsPboDhg.js";import{r as $}from"./DLEO9OFV.js";import{r as ee}from"./hnu7W4Au.js";import{r as te}from"./Dqw-T9oa.js";import{r as se}from"./nNMAiyHf.js";import{_ as re}from"./BjXUQWIC.js";import"./CCijkVrC.js";import"./DXbs9UP2.js";import"./mn5DLNYF.js";const oe={name:"PatientReport",components:{UserIcon:W,QrCodeIcon:$,FunnelIcon:ee},setup(){K({title:`${J.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:te,refreshIcon:se,cookie:q("token"),moment:w,facility:Z(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String((this._.provides[I]||this.$route).query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(s=>{(s.identifier_type==="current_traditional_authority"||s.identifier_type==="physical_address")&&(this.physicalAddress=s.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){var d;this.loading=!0;const s=(d=(this._.provides[I]||this.$route).query.order_id)==null?void 0:d.toString(),t=this.dateRange!==null&&this.dateRange.length>0&&w(this.dateRange[0]).isValid()?w(this.dateRange[0]).format("YYYY-MM-DD"):"",n=this.dateRange!==null&&this.dateRange.length>1&&w(this.dateRange[1]).isValid()?w(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,s!=null){const r={route:`${P.tests}/${this.patientId}/report?order_id=${s}&from=${t}&to=${n}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:R}=await F(r);if(this.loading=R,o.value){this.loading=!1,this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let k=o.value.orders.map(_=>{let b=0;return _.tests!==void 0&&(b+=_.tests.filter(D=>D.status.toLowerCase()==="verified").length),{..._,tests_verified:b}});this.reportData=k,this.showPrinterDialog()}m.value&&(this.loading=!1,console.error(m.value))}else{const r={route:`${P.tests}/${this.patientId}/report?from=${t}&to=${n}`,method:"GET",token:`${this.cookie}`},{data:o,error:m,pending:R}=await F(r);if(this.loading=R,o.value){this.person=o.value.client.person,this.person_identifiers=o.value.client.client_identifiers;let k=o.value.orders.map(_=>{let b=0;return _.tests!==void 0&&(b+=_.tests.filter(D=>D.status.toLowerCase()==="verified").length),{..._,tests_verified:b}});this.reportData=k,this.loading=!1,this.showPrinterDialog()}m.value&&(console.error(m.value),this.loading=!1)}},getOrderStatusInitiatorName(s){const t=["specimen-accepted","specimen-rejected"],n=s.find(d=>t.includes(d.status.name));return n?`${n.initiator.first_name} ${n.initiator.last_name}`:""},getOrderStatus(s){return s!==null?B(s.split("-").join(" ")):""},getTestStatusInitiatorName(s,t){const n=s.find(d=>t===d.status.name);return n?{name:`${n.initiator.first_name} ${n.initiator.last_name}`,created_at:n.created_date}:{name:"",created_at:""}},getTestTypes(s){return s.map(t=>t.name).join(", ")},getDepartments(s){return[...new Set(s.map(n=>n.department))].join(", ")},getAuthorizedTestCount(s){return s.reduce((t,n)=>t+n.tests_verified,0)},showIndicatorRanges(s){return s.some(t=>t.test_indicator_type==="numeric")},getTestStatusName(s){return s=="verified"?s="Authorized":s=s.split("-").map(t=>this.capitalizeStr(t)).join(" "),s},capitalizeStr(s){return s.charAt(0).toUpperCase()+s.slice(1)},updateReport(s){s&&this.init()},checkSusceptibilityResults(s){return s.tests.some(t=>t.suscept_test_result.length!==0)},getFilteredDrugs(s){return s.filter(t=>t.zone!==null)},showResult(s,t){return t.length>0&&s.toLowerCase()==="growth"?`Growth of ${[...new Set(t)].map(n=>n.name).join(", ")}`:s},shouldPrintSmallLabel(s){return s.some(t=>t.test_types.some(n=>n.print_device))},getSmallLabelPrintTests(s){const t=[],n=new Set;return s.forEach(d=>{d.test_types.forEach(r=>{r.print_device&&n.add(r.name)})}),s.forEach(d=>{d.tests.forEach(r=>{n.has(r.test_type_name)&&t.push(String(r.id))})}),t},getPrintCount(s){return s.reduce((t,n)=>t+n.print_count,0)},getRequiredRange(s,t){const n=s.sex=="M"?"Male":"Female",d=Math.ceil(Number(C(s.date_of_birth)==0?1:Number(C(s.date_of_birth))));return t.filter(r=>r.sex===n&&d>Number(r.min_age)&&d<Number(r.max_age)||r.sex==="Both"&&d>Number(r.min_age)&&d<Number(r.max_age))[0]},shouldDisplayRange(s,t,n){let d=null;return this.showIndicatorRanges(s)&&(d=this.getRequiredRange(t,n.indicator_ranges)),d},getMachineName(s){return s[0].result.machine_name},getCompletedTests(s){const t=new Set(["completed","verified","test-rejected"]);return s.filter(n=>t.has(n.status.toLowerCase()))},showPrinterDialog(){this.$nextTick(()=>{var s;((s=(this._.provides[I]||this.$route).query.printer)==null?void 0:s.toString())=="true"&&this.$refs.corePrinter.init()})},getRemarks(s){var r,o;const t=s==null?void 0:s.status_trail.find(m=>m.status.name.toLowerCase()==="test-rejected");let n="N/A";t&&(n=`<b>Rejected Reason:</b> ${(r=t==null?void 0:t.status_reason)==null?void 0:r.description}`);const d=(o=s==null?void 0:s.result_remarks)==null?void 0:o.value;return d&&n!=="N/A"?`${d}<br>${n}`:d||n},hasAnyRemarks(s){return s.some(t=>{const n=this.getRemarks(t);return n&&n!=="N/A"})}}},ne=""+new URL("medical-record.B8XPaMkU.png",import.meta.url).href,ie={class:"py-5 px-5"},le={class:"flex items-center py-5"},ae={class:"text-2xl font-semibold uppercase",style:{"font-size":"24px","line-height":"2rem"}},de={class:"text-sky-500 text-2xl",style:{"font-size":"24px","line-height":"2rem"}},pe={class:"mt-2 space-y-3"},ue={class:"w-full flex items-center justify-between"},ce={class:"flex items-center space-x-5"},me={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},_e={class:"w-72 ml-2"},be={class:"flex items-center space-x-2"},fe={key:0,class:"border rounded print-container mt-10"},he={class:"rounded-tr rounded-tl border-b px-5 py-5"},ye={class:"flex items-center justify-between"},ge={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},xe={class:"font-normal"},ve={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted",style:{"font-size":"20px","line-height":"2rem"}},Te={class:"flex items-center not-italic text-gray-600"},Re={class:"flex items-center not-italic text-gray-600"},ke={class:"flex items-center justify-between mt-5"},De={class:"w-full mt-2"},we={class:"border px-2 py-2"},Ae={class:"border-t px-2 py-2"},Se={class:"border-t px-2 py-2 border-r"},Ie={class:"border px-2 py-2"},Me={class:"border px-2 py-2",colspan:"2"},Ee={class:"bg-gray-100 border-b flex items-center justify-between px-2 py-2 font-medium"},Ne={class:"flex items-center"},Pe={class:"border-collapse border-slate-500 w-full"},Fe={class:"border-b border-r px-2 py-2"},Ce={class:"border-b px-2 py-2"},Le={class:"border-b border-r px-2 py-2"},Oe={class:"border-b px-2 py-2"},ze={class:"border-b border-r px-2 py-2"},je={class:"border-b px-2 py-2"},qe={class:"border-collapse w-full"},Be={class:"bg-gray-100 text-black"},Ue={colspan:2,class:"px-2 py-2 text-lg font-semibold"},Ve={class:"border px-2 py-2 text-left"},Ye={class:"p-0 border-b",style:{padding:"0 !important"}},He={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},Ge={class:"border-b"},Qe={class:"border-r px-2 py-2"},Xe={class:"px-2 py-2 flex items-center border-r"},Ze=["innerHTML"],Je={key:0},Ke={class:"px-2"},We={key:0,class:"border-t border-l px-2 py-2 font-bold"},$e={key:1,class:"border px-2 py-2"},et={class:"border px-2 py-2"},tt={class:"test-status"},st={class:"px-2"},rt={class:"px-2"},ot={class:"px-2"},nt={key:0},it={class:"px-2"},lt={class:"px-2 mb-2"},at={key:0,class:"mb-2"},dt={key:0,class:"mb-3"},pt={class:"font-medium"},ut=["innerHTML"],ct={key:1,class:"px-4 py-2 border-b"},mt={class:"m-2"},_t={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},bt={class:"w-full"},ft={classs:"border-l border-r"},ht={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},yt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},gt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},xt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"};function vt(s,t,n,d,r,o){const m=j,R=M("FunnelIcon"),k=M("datepicker"),_=G,b=X,D=M("barcode"),O=Q;return a(),p("div",ie,[x(m,{pages:r.pages},null,8,["pages"]),e("div",le,[t[3]||(t[3]=e("img",{src:ne,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),e("h3",ae,[t[2]||(t[2]=v(" patient report for ")),e("span",de,'"'+i(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`)+'"',1)])]),e("div",pe,[e("div",ue,[e("div",ce,[e("div",me,[x(R,{class:"w-5 h-5 mr-2"}),t[4]||(t[4]=v(" Filter By Date Range ")),e("div",_e,[x(k,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r.dateRange,"onUpdate:modelValue":t[0]||(t[0]=u=>r.dateRange=u)},null,8,["modelValue"])])]),e("div",be,[E(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=u=>r.showPendingTests=u)},null,512),[[V,r.showPendingTests]]),t[5]||(t[5]=e("label",null,"Include pending tests",-1))]),x(_,{loading:r.loading,color:"primary",text:"Generate Report",icon:r.refreshIcon,click:()=>o.init()},null,8,["loading","icon","click"])]),e("div",null,[r.reportData.length>0?(a(),Y(b,{key:0,"print-small-label":o.shouldPrintSmallLabel(r.reportData),id:o.patientId,orderId:o.orderId,tests:o.getSmallLabelPrintTests(r.reportData),orderTests:r.reportData[0].tests,onUpdate:o.updateReport,ref:"corePrinter"},null,8,["print-small-label","id","orderId","tests","orderTests","onUpdate"])):h("",!0)])]),r.reportData.length>0?(a(),p("div",fe,[e("div",he,[e("div",ye,[t[6]||(t[6]=e("div",{class:"flex items-center space-x-2"},[e("img",{src:re,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold",style:{"font-size":"24px","line-height":"2rem"}}," PATIENT REPORT ")],-1)),e("div",null,[x(D,{value:r.reportData[0].accession_number,"display-value":!1,height:50},null,8,["value"])]),e("div",ge,[e("address",xe,[e("span",ve,i(r.facility.details.name),1),e("span",Te,i(r.facility.details.address),1),e("span",Re,i(r.facility.details.phone),1)])])]),e("div",ke,[e("div",null,[t[7]||(t[7]=e("span",{class:"font-medium"},"Report Date:",-1)),v(" "+i(r.moment(new Date).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:T(A))),1)]),e("div",null,[t[8]||(t[8]=e("span",{class:"font-medium"},"No. Printed:",-1)),v(" "+i(o.getPrintCount(r.reportData)),1)]),e("div",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"Date Sample Collected:",-1)),v(" "+i(r.reportData.length>0&&r.moment(r.reportData[0].sample_collection_time).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:T(A))),1)])]),e("table",De,[e("tbody",null,[e("tr",null,[t[10]||(t[10]=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1)),e("td",we,i(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`),1),t[11]||(t[11]=e("td",{class:"border-t border-l px-2 py-2 font-bold"},"Sex: ",-1)),e("td",Ae,i(r.person.sex==="F"?"Female":"Male"),1),t[12]||(t[12]=e("td",{class:"border-t border-l px-2 py-2 font-bold"},"Age: ",-1)),e("td",Se,i(("calculateAgeFullFormat"in s?s.calculateAgeFullFormat:T(H))(r.person.date_of_birth)),1)]),e("tr",null,[t[13]||(t[13]=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1)),e("td",Ie,i(r.person.id),1),t[14]||(t[14]=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1)),e("td",Me,i(o.getPhysicalAddress),1)])])])]),(a(!0),p(y,null,g(r.reportData,(u,z)=>(a(),p("div",{key:z},[e("div",Ee,[e("div",Ne," Accession No: "+i(u.accession_number),1),e("div",null," Requested By: "+i(u.requested_by)+" ("+i(u.requesting_ward)+") ",1)]),e("table",Pe,[e("tbody",null,[e("tr",null,[t[15]||(t[15]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1)),e("td",Fe,i(u.specimen),1),t[16]||(t[16]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1)),e("td",Ce,i(r.moment(u.created_date).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:T(A))),1)]),e("tr",null,[t[17]||(t[17]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1)),e("td",Le,i(o.getTestTypes(u.test_types)),1),t[18]||(t[18]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1)),e("td",Oe,i(o.getDepartments(u.test_types)),1)]),e("tr",null,[t[19]||(t[19]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1)),e("td",ze,i(o.getOrderStatus(u.order_status)),1),t[20]||(t[20]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1)),e("td",je,i(o.getOrderStatusInitiatorName(u.order_status_trail)),1)])])]),e("table",qe,[e("thead",null,[e("tr",Be,[t[21]||(t[21]=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1)),e("th",Ue," Tests Authorized("+i(u.tests_verified)+") ",1)])]),e("tbody",null,[t[26]||(t[26]=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1)),(a(!0),p(y,null,g(r.showPendingTests?u.tests:o.getCompletedTests(u.tests),l=>(a(),p("tr",{key:l.id},[e("td",Ve,i(l.test_type_name),1),e("td",Ye,[e("table",He,[t[22]||(t[22]=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Units "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1)),e("tbody",Ge,[(a(!0),p(y,null,g(l.indicators,(c,S)=>{var f,N;return a(),p("tr",{key:S,class:"border-b"},[e("td",Qe,i(c.name),1),e("td",Xe,[e("p",{innerHTML:o.showResult(((f=c.result)==null?void 0:f.value)??"",l==null?void 0:l.suscept_test_result)},null,8,Ze),(N=c.result)!=null&&N.value?h("",!0):(a(),p("span",Je,"Not done"))]),e("td",Ke,i(c==null?void 0:c.unit),1),o.shouldDisplayRange(l.indicators,r.person,c)!==void 0&&o.shouldDisplayRange(l.indicators,r.person,c)!==null?(a(),p("td",We," ("+i(o.shouldDisplayRange(l.indicators,r.person,c).lower_range)+" - "+i(o.shouldDisplayRange(l.indicators,r.person,c).upper_range)+") ",1)):(a(),p("td",$e))])}),128))])])]),e("td",et,[e("div",tt,[t[23]||(t[23]=e("p",{class:"font-bold"},"Test Status",-1)),e("p",st,i(o.getTestStatusName(l.status)),1),e("p",rt," By: "+i(o.getTestStatusInitiatorName(l.status_trail,l.status).name),1),e("p",ot," On: "+i(r.moment(o.getTestStatusInitiatorName(l.status_trail,l.status).created_at).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:T(A))),1)]),o.getTestStatusInitiatorName(l.status_trail,"completed").name?(a(),p("div",nt,[t[25]||(t[25]=e("p",{class:"font-bold"},"Performed By",-1)),e("p",it,i(o.getTestStatusInitiatorName(l.status_trail,"completed").name),1),e("p",lt," On: "+i(r.moment(o.getTestStatusInitiatorName(l.status_trail,"completed").created_at).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:T(A))),1),o.getMachineName(l.indicators)?(a(),p("div",at,[t[24]||(t[24]=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1)),e("p",null,i(o.getMachineName(l.indicators)),1)])):h("",!0)])):h("",!0)])]))),128))])]),e("div",null,[t[28]||(t[28]=e("div",{class:"bg-gray-100 px-4 py-2 border-b"},[e("h3",{class:"text-lg font-semibold"},"Test Remarks")],-1)),o.hasAnyRemarks(u.tests)?(a(!0),p(y,{key:0},g(r.showPendingTests?u.tests:o.getCompletedTests(u.tests),l=>(a(),p("div",{class:"px-4 py-2 border-b",key:l.id},[o.getRemarks(l)?(a(),p("div",dt,[e("p",pt,i(l.test_type_name)+":",1),e("p",{class:"ml-4",innerHTML:o.getRemarks(l)},null,8,ut)])):h("",!0)]))),128)):(a(),p("div",ct,t[27]||(t[27]=[e("p",{class:"text-gray-600"},"No remarks available for these tests.",-1)])))]),E(e("div",mt,[t[30]||(t[30]=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1)),e("div",null,[(a(!0),p(y,null,g(u.tests,l=>(a(),p("div",{class:"grid grid-cols-2 gap-4",key:l.id},[l.test_type_name.toLowerCase().includes("culture")?(a(!0),p(y,{key:0},g(l.suscept_test_result,(c,S)=>(a(),p("div",{key:S},[e("div",_t,i(c.name),1),e("table",bt,[t[29]||(t[29]=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1)),e("tbody",ft,[(a(!0),p(y,null,g(o.getFilteredDrugs(c.drugs),f=>(a(),p("tr",{key:f.drug_id},[e("th",ht,i(f.name),1),e("th",yt,i(f.zone),1),e("th",gt,i(f.interpretation),1)]))),128))])])]))),128)):h("",!0)]))),128))])],512),[[L,o.checkSusceptibilityResults(u)]])]))),128))])):h("",!0),e("div",null,[E(e("div",xt,[x(O),t[31]||(t[31]=e("p",{class:"text-base"},[v(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1))],512),[[L,r.loading]])])])])}const Ot=U(oe,[["render",vt]]);export{Ot as default};
