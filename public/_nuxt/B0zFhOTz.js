import{_ as z}from"./Bz0K0IGU.js";import{a as B,z as w,aG as I,l as C,m as L,W as V,ao as O,s as U,x as N,b as d,e as u,f as T,g as e,j as v,t as i,i as M,aH as j,H,aI as Y,C as y,h as R,aJ as S,aK as G,F as g,k as x,v as q,_ as J,n as K}from"./Mfiulbk9.js";import{_ as Q}from"./3jFXYALF.js";import{u as W}from"./DVF6Pu2h.js";import{P as X}from"./Cym2IAMG.js";import{u as Z}from"./hBIwNBsI.js";import{r as $}from"./BaiS-HIW.js";import{r as ee}from"./Cz-eDXx7.js";import{r as te}from"./Blth7wSc.js";import{r as se}from"./Bes5wY1O.js";import{r as re}from"./TyvU6Xpr.js";import{_ as oe}from"./CVFoFHhy.js";import"./CWIC1ZeM.js";import"./B-Vd1x1K.js";import"./B1IFxoh8.js";const ne={name:"PatientReport",components:{UserIcon:$,QrCodeIcon:ee,FunnelIcon:te},setup(){Z({title:`${X.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:se,refreshIcon:re,cookie:B("token"),moment:w,facility:W(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1,printAllTests:!0}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String((this._.provides[I]||this.$route).query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(s=>{(s.identifier_type==="current_traditional_authority"||s.identifier_type==="physical_address")&&(this.physicalAddress=s.value)}),this.physicalAddress}},async created(){this.init()},watch:{printAllTests(){this.init()}},methods:{async init(){var r,n;this.loading=!0;const s=(r=(this._.provides[I]||this.$route).query.order_id)==null?void 0:r.toString(),t=(n=(this._.provides[I]||this.$route).query.encounter_id)==null?void 0:n.toString(),o=this.dateRange!==null&&this.dateRange.length>0&&w(this.dateRange[0]).isValid()?w(this.dateRange[0]).format("YYYY-MM-DD"):"",p=this.dateRange!==null&&this.dateRange.length>1&&w(this.dateRange[1]).isValid()?w(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,s!=null){const _=`${C.tests}/${this.patientId}/report?order_id=${s}&from=${o}&to=${p}`,k={route:this.printAllTests?`${_}&encounter_id=${t}`:_,method:"GET",token:`${this.cookie}`},{data:m,error:b,pending:D}=await L(k);if(this.loading=D,m.value){this.loading=!1,this.person=m.value.client.person,this.person_identifiers=m.value.client.client_identifiers;let A=m.value.orders.map(a=>{let f=0;return a.tests!==void 0&&(f+=a.tests.filter(l=>l.status.toLowerCase()==="verified").length),{...a,tests_verified:f}});this.reportData=A,this.showPrinterDialog()}b.value&&(this.loading=!1,console.error(b.value))}else{const _=`${C.tests}/${this.patientId}/report?from=${o}&to=${p}`,k={route:this.printAllTests?`${_}&encounter_id=${t}`:_,method:"GET",token:`${this.cookie}`},{data:m,error:b,pending:D}=await L(k);if(this.loading=D,m.value){this.person=m.value.client.person,this.person_identifiers=m.value.client.client_identifiers;let A=m.value.orders.map(a=>{let f=0;return a.tests!==void 0&&(f+=a.tests.filter(l=>l.status.toLowerCase()==="verified").length),{...a,tests_verified:f}});this.reportData=A,this.loading=!1,this.showPrinterDialog()}b.value&&(console.error(b.value),this.loading=!1)}},getOrderStatusInitiatorName(s){const t=["specimen-accepted","specimen-rejected"],o=s.find(p=>t.includes(p.status.name));return o?`${o.initiator.first_name} ${o.initiator.last_name}`:""},getOrderStatus(s){return s!==null?V(s.split("-").join(" ")):""},getTestStatusInitiatorName(s,t){const o=s.find(p=>t===p.status.name);return o?{name:`${o.initiator.first_name} ${o.initiator.last_name}`,created_at:o.created_date}:{name:"",created_at:""}},getTestTypes(s){return s.map(t=>t.name).join(", ")},getDepartments(s){return[...new Set(s.map(o=>o.department))].join(", ")},getAuthorizedTestCount(s){return s.reduce((t,o)=>t+o.tests_verified,0)},showIndicatorRanges(s){return s.some(t=>t.test_indicator_type==="numeric")},getTestStatusName(s){return s=="verified"?s="Authorized":s=s.split("-").map(t=>this.capitalizeStr(t)).join(" "),s},capitalizeStr(s){return s.charAt(0).toUpperCase()+s.slice(1)},updateReport(s){s&&this.init()},checkSusceptibilityResults(s){return s.tests.some(t=>t.suscept_test_result.length!==0)},getFilteredDrugs(s){return s.filter(t=>t.zone!==null)},showResult(s,t){return t.length>0&&s.toLowerCase()==="growth"?`Growth of ${[...new Set(t)].map(o=>o.name).join(", ")}`:s},shouldPrintSmallLabel(s){return s.some(t=>t.test_types.some(o=>o.print_device))},getSmallLabelPrintTests(s){const t=[],o=new Set;return s.forEach(p=>{p.test_types.forEach(r=>{r.print_device&&o.add(r.name)})}),s.forEach(p=>{p.tests.forEach(r=>{o.has(r.test_type_name)&&t.push(String(r.id))})}),t},getPrintCount(s){return s.reduce((t,o)=>t+o.print_count,0)},getRequiredRange(s,t){const o=s.sex=="M"?"Male":"Female",p=Math.ceil(Number(O(s.date_of_birth)==0?1:Number(O(s.date_of_birth))));return t.filter(r=>r.sex===o&&p>Number(r.min_age)&&p<Number(r.max_age)||r.sex==="Both"&&p>Number(r.min_age)&&p<Number(r.max_age))[0]},shouldDisplayRange(s,t,o){let p=null;return this.showIndicatorRanges(s)&&(p=this.getRequiredRange(t,o.indicator_ranges)),p},getMachineName(s){return s[0].result.machine_name},getCompletedTests(s){const t=new Set(["completed","verified","test-rejected"]);return s.filter(o=>t.has(o.status.toLowerCase()))},showPrinterDialog(){this.$nextTick(()=>{var s;((s=(this._.provides[I]||this.$route).query.printer)==null?void 0:s.toString())=="true"&&this.$refs.corePrinter.init()})},getRemarks(s){var r,n;const t=s==null?void 0:s.status_trail.find(_=>_.status.name.toLowerCase()==="test-rejected");let o="N/A";t&&(o=`<b>Rejected Reason:</b> ${(r=t==null?void 0:t.status_reason)==null?void 0:r.description}`);const p=(n=s==null?void 0:s.result_remarks)==null?void 0:n.value;return p&&o!=="N/A"?`${p}<br>${o}`:p||o},hasAnyRemarks(s){return s.some(t=>{const o=this.getRemarks(t);return o&&o!=="N/A"})}}},ie=""+new URL("medical-record.B8XPaMkU.png",import.meta.url).href,le={class:"py-5 px-5"},ae={class:"flex items-center py-5"},de={class:"text-2xl font-semibold uppercase",style:{"font-size":"24px","line-height":"2rem"}},pe={class:"text-sky-500 text-2xl",style:{"font-size":"24px","line-height":"2rem"}},ue={class:"mt-2 space-y-3"},ce={class:"w-full flex items-center justify-between"},me={class:"flex items-center space-x-5"},_e={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},be={class:"w-72 ml-2"},fe={class:"flex items-center space-x-2"},he={class:"flex items-center space-x-2"},ye={key:0,class:"border rounded print-container mt-10"},ge={class:"rounded-tr rounded-tl border-b px-5 py-5"},xe={class:"flex items-center justify-between"},Te={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},ve={class:"font-normal"},Re={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted",style:{"font-size":"20px","line-height":"2rem"}},ke={class:"flex items-center not-italic text-gray-600"},De={class:"flex items-center not-italic text-gray-600"},Ae={class:"flex items-center justify-between mt-5"},we={class:"w-full mt-2"},Se={class:"border px-2 py-2"},Ie={class:"border-t px-2 py-2"},Me={class:"border-t px-2 py-2 border-r"},Pe={class:"border px-2 py-2"},Ee={class:"border px-2 py-2",colspan:"2"},Ne={class:"bg-gray-100 border-b flex items-center justify-between px-2 py-2 font-medium"},Fe={class:"flex items-center"},Ce={class:"border-collapse border-slate-500 w-full"},Le={class:"border-b border-r px-2 py-2"},Oe={class:"border-b px-2 py-2"},je={class:"border-b border-r px-2 py-2"},qe={class:"border-b px-2 py-2"},ze={class:"border-b border-r px-2 py-2"},Be={class:"border-b px-2 py-2"},Ve={class:"border-collapse w-full"},Ue={class:"bg-gray-100 text-black"},He={colspan:2,class:"px-2 py-2 text-lg font-semibold"},Ye={class:"border px-2 py-2 text-left"},Ge={class:"p-0 border-b",style:{padding:"0 !important"}},Je={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},Ke={class:"border-b"},Qe={class:"border-r px-2 py-2"},We={class:"px-2 py-2 flex items-center border-r"},Xe=["innerHTML"],Ze={key:0},$e={class:"px-2"},et={key:0,class:"border-t border-l px-2 py-2 font-bold"},tt={key:1,class:"border px-2 py-2"},st={class:"border px-2 py-2"},rt={class:"test-status"},ot={class:"px-2"},nt={class:"px-2"},it={class:"px-2"},lt={key:0},at={class:"px-2"},dt={class:"px-2 mb-2"},pt={key:0,class:"mb-2"},ut={key:0,class:"mb-3"},ct={class:"font-medium"},mt=["innerHTML"],_t={key:1,class:"px-4 py-2 border-b"},bt={class:"m-2"},ft={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},ht={class:"w-full"},yt={classs:"border-l border-r"},gt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},xt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Tt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},vt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"};function Rt(s,t,o,p,r,n){const _=z,P=N("FunnelIcon"),k=N("datepicker"),m=J,b=Q,D=N("barcode"),A=K;return d(),u("div",le,[T(_,{pages:r.pages},null,8,["pages"]),e("div",ae,[t[4]||(t[4]=e("img",{src:ie,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),e("h3",de,[t[3]||(t[3]=v(" patient report for ")),e("span",pe,'"'+i(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`)+'"',1)])]),e("div",ue,[e("div",ce,[e("div",me,[e("div",_e,[T(P,{class:"w-5 h-5 mr-2"}),t[5]||(t[5]=v(" Filter By Date Range ")),e("div",be,[T(k,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r.dateRange,"onUpdate:modelValue":t[0]||(t[0]=a=>r.dateRange=a)},null,8,["modelValue"])])]),e("div",fe,[M(e("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>r.showPendingTests=a)},null,512),[[j,r.showPendingTests]]),t[6]||(t[6]=e("label",null,"Include pending tests",-1))]),e("div",he,[M(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>r.printAllTests=a)},null,512),[[j,r.printAllTests]]),t[7]||(t[7]=e("label",null,"Print all tests for this patient",-1))]),T(m,{loading:r.loading,color:"primary",text:"Generate Report",icon:r.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])]),e("div",null,[r.reportData.length>0?(d(),H(b,Y({key:0,"print-small-label":n.shouldPrintSmallLabel(r.reportData),id:n.patientId,orderId:n.orderId},r.printAllTests?{encounter_id:r.reportData[0].encounter_id}:{},{tests:n.getSmallLabelPrintTests(r.reportData),orderTests:r.reportData[0].tests,onUpdate:n.updateReport,ref:"corePrinter"}),null,16,["print-small-label","id","orderId","tests","orderTests","onUpdate"])):y("",!0)])]),r.reportData.length>0?(d(),u("div",ye,[e("div",ge,[e("div",xe,[t[8]||(t[8]=e("div",{class:"flex items-center space-x-2"},[e("img",{src:oe,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold",style:{"font-size":"24px","line-height":"2rem"}}," PATIENT REPORT ")],-1)),e("div",null,[T(D,{value:r.reportData[0].accession_number,"display-value":!1,height:50},null,8,["value"])]),e("div",Te,[e("address",ve,[e("span",Re,i(r.facility.details.name),1),e("span",ke,i(r.facility.details.address),1),e("span",De,i(r.facility.details.phone),1)])])]),e("div",Ae,[e("div",null,[t[9]||(t[9]=e("span",{class:"font-medium"},"Report Date:",-1)),v(" "+i(r.moment(new Date).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:R(S))),1)]),e("div",null,[t[10]||(t[10]=e("span",{class:"font-medium"},"No. Printed:",-1)),v(" "+i(n.getPrintCount(r.reportData)),1)]),e("div",null,[t[11]||(t[11]=e("span",{class:"font-medium"},"Date Sample Collected:",-1)),v(" "+i(r.reportData.length>0&&r.moment(r.reportData[0].sample_collection_time).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:R(S))),1)])]),e("table",we,[e("tbody",null,[e("tr",null,[t[12]||(t[12]=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1)),e("td",Se,i(`${r.person.first_name} ${r.person.middle_name?r.person.middle_name:""} ${r.person.last_name}`),1),t[13]||(t[13]=e("td",{class:"border-t border-l px-2 py-2 font-bold"},"Sex: ",-1)),e("td",Ie,i(r.person.sex==="F"?"Female":"Male"),1),t[14]||(t[14]=e("td",{class:"border-t border-l px-2 py-2 font-bold"},"Age: ",-1)),e("td",Me,i(("calculateAgeFullFormat"in s?s.calculateAgeFullFormat:R(G))(r.person.date_of_birth)),1)]),e("tr",null,[t[15]||(t[15]=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1)),e("td",Pe,i(r.person.id),1),t[16]||(t[16]=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1)),e("td",Ee,i(n.getPhysicalAddress),1)])])])]),(d(!0),u(g,null,x(r.reportData,(a,f)=>(d(),u("div",{key:f},[e("div",Ne,[e("div",Fe," Accession No: "+i(a.accession_number),1),e("div",null," Requested By: "+i(a.requested_by)+" ("+i(a.requesting_ward)+") ",1)]),e("table",Ce,[e("tbody",null,[e("tr",null,[t[17]||(t[17]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1)),e("td",Le,i(a.specimen),1),t[18]||(t[18]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1)),e("td",Oe,i(r.moment(a.created_date).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:R(S))),1)]),e("tr",null,[t[19]||(t[19]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1)),e("td",je,i(n.getTestTypes(a.test_types)),1),t[20]||(t[20]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1)),e("td",qe,i(n.getDepartments(a.test_types)),1)]),e("tr",null,[t[21]||(t[21]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1)),e("td",ze,i(n.getOrderStatus(a.order_status)),1),t[22]||(t[22]=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1)),e("td",Be,i(n.getOrderStatusInitiatorName(a.order_status_trail)),1)])])]),e("table",Ve,[e("thead",null,[e("tr",Ue,[t[23]||(t[23]=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1)),e("th",He," Tests Authorized("+i(a.tests_verified)+") ",1)])]),e("tbody",null,[t[28]||(t[28]=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1)),(d(!0),u(g,null,x(r.showPendingTests?a.tests:n.getCompletedTests(a.tests),l=>(d(),u("tr",{key:l.id},[e("td",Ye,i(l.test_type_name),1),e("td",Ge,[e("table",Je,[t[24]||(t[24]=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Units "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1)),e("tbody",Ke,[(d(!0),u(g,null,x(l.indicators,(c,E)=>{var h,F;return d(),u("tr",{key:E,class:"border-b"},[e("td",Qe,i(c.name),1),e("td",We,[e("p",{innerHTML:n.showResult(((h=c.result)==null?void 0:h.value)??"",l==null?void 0:l.suscept_test_result)},null,8,Xe),(F=c.result)!=null&&F.value?y("",!0):(d(),u("span",Ze,"Not done"))]),e("td",$e,i(c==null?void 0:c.unit),1),n.shouldDisplayRange(l.indicators,r.person,c)!==void 0&&n.shouldDisplayRange(l.indicators,r.person,c)!==null?(d(),u("td",et," ("+i(n.shouldDisplayRange(l.indicators,r.person,c).lower_range)+" - "+i(n.shouldDisplayRange(l.indicators,r.person,c).upper_range)+") ",1)):(d(),u("td",tt))])}),128))])])]),e("td",st,[e("div",rt,[t[25]||(t[25]=e("p",{class:"font-bold"},"Test Status",-1)),e("p",ot,i(n.getTestStatusName(l.status)),1),e("p",nt," By: "+i(n.getTestStatusInitiatorName(l.status_trail,l.status).name),1),e("p",it," On: "+i(r.moment(n.getTestStatusInitiatorName(l.status_trail,l.status).created_at).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:R(S))),1)]),n.getTestStatusInitiatorName(l.status_trail,"completed").name?(d(),u("div",lt,[t[27]||(t[27]=e("p",{class:"font-bold"},"Performed By",-1)),e("p",at,i(n.getTestStatusInitiatorName(l.status_trail,"completed").name),1),e("p",dt," On: "+i(r.moment(n.getTestStatusInitiatorName(l.status_trail,"completed").created_at).format("DATE_FORMAT_TIME"in s?s.DATE_FORMAT_TIME:R(S))),1),n.getMachineName(l.indicators)?(d(),u("div",pt,[t[26]||(t[26]=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1)),e("p",null,i(n.getMachineName(l.indicators)),1)])):y("",!0)])):y("",!0)])]))),128))])]),e("div",null,[t[30]||(t[30]=e("div",{class:"bg-gray-100 px-4 py-2 border-b"},[e("h3",{class:"text-lg font-semibold"},"Test Remarks")],-1)),n.hasAnyRemarks(a.tests)?(d(!0),u(g,{key:0},x(r.showPendingTests?a.tests:n.getCompletedTests(a.tests),l=>(d(),u("div",{class:"px-4 py-2 border-b",key:l.id},[n.getRemarks(l)?(d(),u("div",ut,[e("p",ct,i(l.test_type_name)+":",1),e("p",{class:"ml-4",innerHTML:n.getRemarks(l)},null,8,mt)])):y("",!0)]))),128)):(d(),u("div",_t,t[29]||(t[29]=[e("p",{class:"text-gray-600"},"No remarks available for these tests.",-1)])))]),M(e("div",bt,[t[32]||(t[32]=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1)),e("div",null,[(d(!0),u(g,null,x(a.tests,l=>(d(),u("div",{class:"grid grid-cols-2 gap-4",key:l.id},[l.test_type_name.toLowerCase().includes("culture")?(d(!0),u(g,{key:0},x(l.suscept_test_result,(c,E)=>(d(),u("div",{key:E},[e("div",ft,i(c.name),1),e("table",ht,[t[31]||(t[31]=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1)),e("tbody",yt,[(d(!0),u(g,null,x(n.getFilteredDrugs(c.drugs),h=>(d(),u("tr",{key:h.drug_id},[e("th",gt,i(h.name),1),e("th",xt,i(h.zone),1),e("th",Tt,i(h.interpretation),1)]))),128))])])]))),128)):y("",!0)]))),128))])],512),[[q,n.checkSusceptibilityResults(a)]])]))),128))])):y("",!0),e("div",null,[M(e("div",vt,[T(A),t[33]||(t[33]=e("p",{class:"text-base"},[v(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1))],512),[[q,r.loading]])])])])}const qt=U(ne,[["render",Rt]]);export{qt as default};
