import{_ as oe}from"./Breadcrumb.vue.27032e73.js";import{_ as ne}from"./Dropdown.729717fa.js";import{p as le,u as ae,x as b,a as ce,G as O,h as w,o as v,c as T,d as _,m as r,e as s,t as g,i as F,j as A,z as j,F as ie,r as de,n as pe,l as V,w as _e,v as ue,f as me,g as fe,b as be}from"./entry.717629a0.js";import{_ as ge}from"./ExportButton.vue.d42749fb.js";import{_ as he}from"./Address.vue.bbff9167.js";import{e as ye}from"./constants.75204871.js";import{_ as xe}from"./report.09c7283a.js";import{_ as Ee}from"./logo.0e6b7f6c.js";import{_ as ve}from"./page.b56c3298.js";import{h,f as B,e as P}from"./fetch.f246156a.js";import{k as Te}from"./vue-doc-download.e7a7aca2.js";import{P as Se}from"./package.27cdbc43.js";import{u as Re}from"./facility.daeb515f.js";import{r as Le}from"./FunnelIcon.155f5cff.js";import{r as Me}from"./ArrowPathIcon.a6a7b639.js";import"./nuxt-link.1c9114c5.js";import"./HomeIcon.40653a6b.js";import"./listbox.e27c2b22.js";import"./hidden.c6e30757.js";import"./use-text-value.9d6b25b6.js";import"./CheckIcon.cf3afd16.js";import"./CheckCircleIcon.94ec606d.js";import"./MagnifyingGlassIcon.f9ead28b.js";import"./network.b529c562.js";import"./transition.df1b9b67.js";import"./XMarkIcon.cf19f790.js";import"./PencilSquareIcon.768d5e2b.js";import"./PrinterIcon.2dd5e0f4.js";const Ye={class:"px-5 py-5"},Ne={class:"flex items-center py-5"},Ae=s("img",{src:xe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Ue={class:"text-2xl font-semibold uppercase"},ke={class:"w-full flex items-center justify-between mb-5"},Ce={class:"w-full flex items-center space-x-3"},$e={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},We={class:"w-72 ml-2"},Ge={class:"w-40"},Oe={class:"w-48 flex items-end justify-end"},we={class:"rounded border"},Fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},je=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:Ee,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold uppercase"},"INFECTION REPORT")],-1),Ve={key:0},Be={class:"hidden"},Pe=s("h3",null,"INFECTION REPORT",-1),He={class:"text-lg font-semibold py-2 px-2"},Ie={class:"text-normal font-normal"},qe={id:"print-container"},ze=["innerHTML"],Ke=s("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"SUMMARY",-1),Je={class:"w-full border-t"},Qe=s("thead",null,[s("tr",{class:"border-b border-t bg-gray-100"},[s("th",{class:"px-2 py-2 border-r text-left"},"TESTS"),s("th",{class:"px-2 py-2 text-left"},"TOTAL")])],-1),Xe={class:"px-2 py-2 border-r border-b"},Ze={class:"px-2 py-2 border-r border-b"},De={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},et=s("img",{src:ve,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),tt=s("p",{class:"text-base"},"Data not found, please generate report",-1),st=[et,tt],rt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},ot=s("p",{class:"text-base"},[A(" Generating report, please wait"),s("span",{class:"animate-ping"},"...")],-1),Wt=le({__name:"infection",setup(nt){ae({title:`${Se.name.toUpperCase()} - Infection Report`});const H=b("Infection Report"),I=b([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),S=b([]),x=b({id:0,name:"select department"}),U=ce("token"),m=b(!1),R=Re(),L=b([]),k=b([]),{$toast:M}=be(),l=b(new Array("","")),Y=O(()=>l.value[0]?h(l.value[0]).format("YYYY-MM-DD"):""),N=O(()=>l.value[1]?h(l.value[1]).format("YYYY-MM-DD"):""),q=()=>{l.value=new Array("","")},z=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',c=(o,e,n)=>{const a=o.indexOf(e);return a!==-1?o.slice(0,a)+n+o.slice(a+e.length):o},K=o=>{let e="",n="",a="",d="",f=0,u=0,i=0,p=0,y=0;return o.reduce((t,C)=>{const D=C.measures.flatMap($=>$.results.flatMap(W=>{const G=Object.keys(W[0])[0],ee=W[0][G];return Object.entries(ee).map(([te,se])=>{const re=se;return{test_type:C.test_type,measure:$.name,result:G,gender:te==="F"?"Female":"Male",...re}})}));return t.push(...D),t},new Array).forEach(t=>{u++,i++,f++,a===t.test_type?(e+="<tr>",n!==t.measure?(n=t.measure,d=t.result,e=c(e,"NEW_MEASURE",u.toString()),e=e.replace("NEW_RESULT",i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),u=0,i=0,p=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):d!==t.result&&(e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),d=t.result,i=0,p=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(a=t.test_type,n=t.measure,d=t.result,e=e.replace(/NEW_TEST/g,f.toString()),e=c(e,"NEW_MEASURE",u.toString()),e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),u=0,i=0,p=0,f=0,y=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.L_E_5?t.L_E_5:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_5_L_E_14?t.G_5_L_E_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_14?t.G_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0)).toString()+"</td>",p+=(t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0),d===t.result&&i==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),u==0&&(y=t.L_E_5+t.G_5_L_E_14+t.G_14)}),e=c(e,"NEW_TEST",(++f).toString()),e=c(e,"NEW_MEASURE",(++u).toString()),e=c(e,"NEW_RESULT",(++i).toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),e+="</tr>",e},J=o=>{const e=z(),n=o.length>0?K(o):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${n}</table>`};async function Q(){const{data:o,error:e}=await B({route:`${P.departments}`,method:"GET",token:`${U.value}`});o.value&&(S.value=o.value,S.value.some(n=>n.id===0)||S.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function X(){if(Z())M.warning("Please select a department");else{m.value=!0;let o=l.value[0].toString()!=""?h(l.value[0].toString()).format("YYYY-MM-DD"):"",e=l.value[1].toString()!=""?h(l.value[1].toString()).format("YYYY-MM-DD"):"";const n={route:`${P.aggregateReports}infection?from=${o}&to=${e}&department=${x.value.id}`,method:"GET",token:`${U.value}`},{data:a,error:d,pending:f}=await B(n);m.value=f,a.value&&(m.value=!1,L.value=a.value.data,k.value=a.value.summary,M.success("Report data generated successfully!")),d.value&&(console.error(d.value),m.value=!1,M.error(ye))}}function Z(){return x.value.name=="select department"}return Q(),(o,e)=>{const n=oe,a=w("datepicker"),d=ne,f=me,u=w("FormKit"),i=ge,p=he,y=fe;return v(),T("div",Ye,[_(n,{pages:r(I)},null,8,["pages"]),s("div",Ne,[Ae,s("h3",Ue,g(r(H)),1)]),s("div",ke,[_(u,{type:"form","submit-label":"Update",onSubmit:X,actions:!1,id:"submitForm"},{default:F(({value:E})=>[s("div",Ce,[s("div",$e,[_(r(Le),{class:"w-5 h-5 mr-2"}),A(" Filter By Date Range "),s("div",We,[_(a,{onCleared:q,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r(l),"onUpdate:modelValue":e[0]||(e[0]=t=>j(l)?l.value=t:null)},null,8,["modelValue"])])]),s("div",Ge,[_(d,{items:r(S),modelValue:r(x),"onUpdate:modelValue":e[1]||(e[1]=t=>j(x)?x.value=t:null)},null,8,["items","modelValue"])]),s("div",null,[_(f,{loading:r(m),color:"primary",type:"submit",text:"Generate Report",icon:r(Me),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),s("div",Oe,[_(r(Te),{element:"print-container",filename:`infection_report_from_${r(h)(r(Y)).format("DD_MM_YYYY")}_to_${r(h)(r(N)).format("DD_MM_YYYY")}_for_${r(R).details.name.toLowerCase().split(" ").join("_")}`},{default:F(()=>[_(i,{text:"Export Excel"})]),_:1},8,["filename"])])]),s("div",null,[s("div",we,[s("div",Fe,[je,_(p)]),r(L).length>0&&!r(m)?(v(),T("div",Ve,[s("div",Be,[Pe,s("h3",null,g(r(R).details.name),1),s("p",null,g(r(R).details.address),1),s("p",null,g(r(R).details.phone),1)]),s("div",He,[A(" Tests Performed Period: "),s("span",Ie,g(r(Y)!=""?r(h)(r(Y)).format("DD/MM/YYYY"):"")+" - "+g(r(N)!=""?r(h)(r(N)).format("DD/MM/YYYY"):""),1)]),s("div",qe,[s("div",{innerHTML:J(r(L))},null,8,ze),s("div",null,[Ke,s("table",Je,[Qe,s("tbody",null,[(v(!0),T(ie,null,de(r(k),(E,t)=>(v(),T("tr",{key:E.name,class:pe(t%2===0?"bg-white":"bg-gray-50")},[s("td",Xe,g(E.name),1),s("td",Ze,g(E.count),1)],2))),128))])])])])])):V("",!0),r(L).length==0&&!r(m)?(v(),T("div",De,st)):V("",!0),_e(s("div",rt,[_(y),ot],512),[[ue,r(m)]])])])])}}});export{Wt as default};
