var Se=Object.defineProperty;var Te=(w,y,u)=>y in w?Se(w,y,{enumerable:!0,configurable:!0,writable:!0,value:u}):w[y]=u;var R=(w,y,u)=>Te(w,typeof y!="symbol"?y+"":y,u);import{_ as Re}from"./CwhZhTYd.js";import{l as C,d as Ue,a2 as ke,a as Ce,r as i,bl as Ae,bm as Y,w as Ne,bn as De,y as ae,b,e as h,f as a,h as o,g as t,i as U,v as j,z as Me,H as V,aA as ne,bo as re,s as ie,F as B,k as W,t as Ie,q as H,L as qe,K as k,j as $e,bp as Pe,bq as O,br as ue,a1 as de,m as Ge,u as L,E as Oe,J as Le,n as Fe,_ as Ye,bs as je}from"./Cc7Tx-yz.js";import{_ as Be}from"./B2AwJQL3.js";import{_ as We}from"./B4HNt-4g.js";import{_ as He}from"./BiDM_Sox.js";import{H as Ke}from"./ZFDwNG7M.js";import{r as Qe}from"./N5NNdOyU.js";import{r as ze}from"./hRixWZZJ.js";import"./q0bNtrxF.js";import"./BstLhON-.js";import"./Lq5eAXI3.js";import"./OJVLXLw2.js";import"./BTya_2KW.js";import"./DGBXCpo7.js";import"./hLgSztLL.js";import"./DQNbD7zb.js";import"./BE9xBVSw.js";class Je extends Ke{constructor(){super(...arguments);R(this,"ORGANISMS",C.organisms);R(this,"SPECIMENS",C.specimens);R(this,"DEPARTMENTS",C.departments);R(this,"TEST_TYPE_INDICATORS",`${C.testTypes}/test_indicator_types`)}async getOrganisms(u){const v={route:this.ORGANISMS,method:"GET",token:`${u}`};return this.call(v)}async getSpecimens(u){const v={route:this.SPECIMENS,method:"GET",token:`${u}`};return this.call(v)}async getDepartments(u){const v={route:this.DEPARTMENTS,method:"GET",token:`${u}`};return this.call(v)}async getTestTypesIndicators(u){const v={route:this.TEST_TYPE_INDICATORS,method:"GET",token:`${u}`};return this.call(v)}}const Xe={class:"px-5 py-5"},Ze={class:"flex items-center justify-center mx-auto my-20"},et={class:"mt-2 space-y-3"},tt={class:"grid grid-cols-2 gap-4"},lt={class:"w-full flex items-center"},st={class:"py-1 ml-2 flex flex-col space-y-2"},ot={class:"w-full flex items-center space-x-2"},at={class:"w-full flex flex-col space-y-2"},nt={class:"w-full flex flex-col space-y-2"},rt={class:"w-full flex items-center space-x-2"},it={class:"w-full flex flex-col space-y-2"},ut={class:"w-full flex"},dt={class:"py-3 flex items-center justify-between"},mt={class:"text-lg text-grameasuresy-700 font-semibold"},ct=["onClick"],pt={class:"grid grid-cols-4 gap-2 mb-3"},vt={class:"flex items-center space-x-3"},ft={class:"grid grid-cols-2 gap-2"},_t={class:""},gt={class:"grid grid-cols-2 gap-2"},yt={class:"flex flex-col"},xt={class:""},Vt={class:"grid grid-cols-2 gap-2"},bt=["onClick"],Et={class:"w-full flex items-center justify-center space-x-2"},ht={class:"w-full grid grid-cols-2 gap-4"},wt=["onClick"],St={key:3,class:"flex items-center px-3 py-3 rounded bg-sky-50 mt-3 text-sky-500"},Tt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Bt=Ue({__name:"index",setup(w){const y=ke(),u=Ce("token"),v=new Je,me=i(!1),p=i([]),A=i(""),N=i(""),D=i(""),K=i([]),E=i(!1),M=i([]),Q=i([]),z=i([]),I=i([]),q=i(!1),$=i(!1),ce=i(Ae),S=i({name:Y}),J=i([]),X=i([]),Z=i([]),P=i(""),G=i({name:Y}),pe=Pe,ve=async()=>{const{data:s,error:e}=await v.getOrganisms(`${u.value}`);s.value&&(Q.value=s.value,z.value=s.value.map(d=>d.name)),e.value&&console.error("could not load organisms: ",e.value)},fe=async()=>{const{data:s,error:e}=await v.getSpecimens(`${u.value}`);s.value&&(J.value=s.value,X.value=s.value.map(d=>d.name)),e.value&&(me.value=!1,console.error("could not load specimens: ",e.value))},_e=async()=>{const{data:s,error:e}=await v.getDepartments(`${u.value}`);s.value&&(Z.value=s.value),e.value&&console.error("could not load departments: ",e.value)},ge=async()=>{const{data:s,error:e}=await v.getTestTypesIndicators(`${u.value}`);s.value&&(K.value=s.value),e.value&&console.error("could not load test type indicators: ",e.value)};async function ee(s,e){try{const c=(p==null?void 0:p.value[s]).indicator_ranges;let r=0;if(c.length>0){const _=c.length-1;r=c[_].id}const f={id:r&&r+1,interpretation:""},x=e.toLowerCase();x.includes("numeric")?(f.age_max=0,f.age_min=0,f.upper_range=0,f.lower_range=0,f.gender={name:O.SELECT_GENDER}):(x=="auto complete"||x.includes("alpha"))&&(f.value=""),c.push(f)}catch(d){console.error("Error: ",d)}}const te=(s,e)=>{p.value[s].indicator_ranges.splice(e,1)},le=()=>{p.value.push({name:"",test_indicator_type:0,unit:"",type:{name:ue},description:"",indicator_ranges:[],value:"",id:String(p.value.length+1)})},se=s=>new Set(["free text","rich text"]).has(s);async function ye(){E.value=!0;const s=p.value.map(g=>{const f=g.indicator_ranges.map(x=>{if(x.hasOwnProperty("gender")){const _=x;return{sex:_.gender.name,max_age:_.max_age,min_age:_.min_age,upper_range:_.upper_range,lower_range:_.lower_range,interpretation:_.interpretation}}else return delete x.id,x});return{...g,indicator_ranges:f,test_indicator_type:g.type.id}}),e={route:C.testTypes,method:"POST",token:`${u.value}`,body:{name:A.value,short_name:N.value,sex:P.value,expected_turn_around_time:{value:D.value,unit:S.value.name},print_device:q.value,department_id:G.value.id,specimens:de(J.value,M.value),indicators:s,organisms:de(Q.value,I.value)}},{data:d,error:c,pending:r}=await Ge(e);E.value=r,d.value&&(oe(),y.push("/test-catalog/test-types?create=true"),E.value=!1),c.value&&(console.error("error creating test type: ",c.value),L().$toast.error(Oe),E.value=!1)}const xe=s=>{const e=new Set(je);for(const d of s)if(d.type.name.toLowerCase()==="numeric"){for(const c of d.indicator_ranges)if(!e.has(c.gender.name.toLowerCase()))return L().$toast.warning(O.GENDER_REQUIRED),!1}return!0},Ve=s=>s.name===Y?(L().$toast.warning(O.DURATION_REQUIRED),!1):!0,be=s=>{for(const e of s)if(e.type.name===ue)return L().$toast.warning(O.MEASURE_TYPE_REQUIRED),!1;return!0},Ee=()=>{const s=xe(p.value),e=Ve(S.value),d=be(p.value);return s&&e&&d};Ne(()=>p.value.map(s=>s.type),(s,e)=>{s!==e&&s.forEach((d,c)=>{if(d!==e[c]&&new Set(De).has(d.name.toLowerCase().split(" ").join(""))){const g=p.value[c].type.name;ee(c,g)}})},{deep:!0});const oe=()=>{Le("submitForm")};return fe(),_e(),ge(),ve(),le(),(s,e)=>{const d=Re,c=Fe,r=ae("FormKit"),g=Be,f=ae("multi-select"),x=We,_=Ye,he=He;return b(),h("div",Xe,[a(d,{pages:o(pe)},null,8,["pages"]),e[22]||(e[22]=t("div",{class:"flex items-center justify-between"},[t("h3",{class:"text-2xl font-semibold mt-5"},"Create Test Type")],-1)),t("div",null,[U(t("div",Ze,[a(c,{loading:o(E)},null,8,["loading"])],512),[[j,o(E)]]),U(t("div",null,[a(r,{id:"submitForm",type:"form","submit-label":"Update",onSubmit:e[10]||(e[10]=we=>Ee()&&ye()),actions:!1},{default:Me(({value:we})=>[t("div",et,[t("div",tt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:o(A),"onUpdate:modelValue":e[0]||(e[0]=l=>V(A)?A.value=l:null)},null,8,["modelValue"]),a(r,{type:"text",label:"Short name",validation:"required",modelValue:o(N),"onUpdate:modelValue":e[1]||(e[1]=l=>V(N)?N.value=l:null)},null,8,["modelValue"])]),t("div",lt,[a(r,{type:"number",label:"Expected Turn Around Time",validation:"required|number",modelValue:o(D),"onUpdate:modelValue":e[2]||(e[2]=l=>V(D)?D.value=l:null)},null,8,["modelValue"]),t("div",st,[e[11]||(e[11]=t("p",{class:"font-medium text-base"},"Duration",-1)),a(g,{items:o(ce),modelValue:o(S),"onUpdate:modelValue":e[3]||(e[3]=l=>V(S)?S.value=l:null)},null,8,["items","modelValue"])])]),t("div",ot,[U(t("input",{id:"showCultureWorksheet",name:"showCultureWorksheet",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=l=>V($)?$.value=l:null)},null,512),[[ne,o($)]]),e[12]||(e[12]=t("label",{for:"showCultureWorksheet"},"Show Culture Worksheet?",-1))]),U(t("div",at,[e[13]||(e[13]=t("label",{class:"font-medium"},"Organisms",-1)),a(f,{style:{"--ms-max-height":"none !important"},modelValue:o(I),"onUpdate:modelValue":e[5]||(e[5]=l=>V(I)?I.value=l:null),options:o(z),mode:"tags",required:!1,clear:"",searchable:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])],512),[[j,o($)]]),t("div",nt,[e[14]||(e[14]=t("label",{class:"font-medium"},"Specimens",-1)),a(f,{style:{"--ms-max-height":"none !important"},modelValue:o(M),"onUpdate:modelValue":e[6]||(e[6]=l=>V(M)?M.value=l:null),options:o(X),mode:"tags",required:"",searchable:"",clear:"",class:"focus:ring-none focus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),t("div",rt,[U(t("input",{id:"shouldPrintResults",name:"shouldPrintResults",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>V(q)?q.value=l:null)},null,512),[[ne,o(q)]]),e[15]||(e[15]=t("label",{for:"shouldPrintResults"},"Print Results On Small Label?",-1))]),t("div",it,[e[16]||(e[16]=t("label",{class:"font-medium"},"Lab section",-1)),a(g,{"is-searchable":!0,modelValue:o(G),"onUpdate:modelValue":e[8]||(e[8]=l=>V(G)?G.value=l:null),items:o(Z)},null,8,["modelValue","items"])]),a(x,{label:"Specific Sex","items-selected":o(P),"onUpdate:itemsSelected":e[9]||(e[9]=l=>V(P)?P.value=l:null),items:("GENDER"in s?s.GENDER:o(re)).map(l=>l.name),mode:"single"},null,8,["items-selected","items"]),t("div",ut,[a(_,{click:()=>{le()},color:"primary",text:"Add Measure",icon:o(ie)},null,8,["click","icon"])]),o(p).length!=0?(b(!0),h(B,{key:0},W(o(p),(l,T)=>(b(),h("div",{key:l.id,class:"border px-5 py-3 rounded"},[t("div",dt,[t("h3",mt," Measures ("+Ie(T+1)+") ",1),t("button",{onClick:()=>{o(p).splice(T,1)}},[a(o(H),{class:"w-5 h-5"})],8,ct)]),t("div",pt,[a(r,{type:"text",label:"Name",validation:"required",modelValue:l.name,"onUpdate:modelValue":n=>l.name=n},null,8,["modelValue","onUpdate:modelValue"]),t("div",null,[e[17]||(e[17]=t("p",{class:"font-medium mb-2"},"Type",-1)),a(g,{modelValue:l.type,"onUpdate:modelValue":n=>l.type=n,items:o(K)},null,8,["modelValue","onUpdate:modelValue","items"])]),a(r,{type:"text",label:"Unit",modelValue:l.unit,"onUpdate:modelValue":n=>l.unit=n},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Description",modelValue:l.description,"onUpdate:modelValue":n=>l.description=n},null,8,["modelValue","onUpdate:modelValue"])]),se(l.type.name.toLowerCase())?k("",!0):(b(),qe(_,{key:0,type:"button",click:()=>{ee(T,l.type.name)},color:"primary",text:"Add New Range",icon:o(ie)},null,8,["click","icon"])),l.indicator_ranges.length>0&&l.type.name==="Numeric"?(b(!0),h(B,{key:1},W(l.indicator_ranges,(n,F)=>(b(),h("div",{class:"w-full px-3 py-3",key:n.id},[t("div",vt,[t("div",ft,[t("div",_t,[e[19]||(e[19]=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Age Range",-1)),t("div",gt,[a(r,{type:"number",label:"Minimum",validation:"required",modelValue:n.min_age,"onUpdate:modelValue":m=>n.min_age=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",label:"Maximum",validation:"required",modelValue:n.max_age,"onUpdate:modelValue":m=>n.max_age=m},null,8,["modelValue","onUpdate:modelValue"]),t("div",yt,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sex",-1)),a(g,{modelValue:n.gender,"onUpdate:modelValue":m=>n.gender=m,items:"GENDER"in s?s.GENDER:o(re)},null,8,["modelValue","onUpdate:modelValue","items"])])])]),t("div",xt,[e[20]||(e[20]=t("label",{class:"mb-2 text-lg font-semibold text-gray-600"},"Measure Range",-1)),t("div",Vt,[a(r,{type:"number",number:"",step:"any",label:"Minimum",validation:"required|required",modelValue:n.upper_range,"onUpdate:modelValue":m=>n.upper_range=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"number",number:"",step:"any",label:"Maximum",validation:"required|required",modelValue:n.lower_range,"onUpdate:modelValue":m=>n.lower_range=m},null,8,["modelValue","onUpdate:modelValue"])])]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(T,F)},[a(o(H),{class:"w-5 h-5"})],8,bt)])]))),128)):k("",!0),l.indicator_ranges.length>0&&l.type.name=="Auto Complete"||l.type.name==="Alpha Numeric"?(b(!0),h(B,{key:2},W(l.indicator_ranges,(n,F)=>(b(),h("div",{class:"px-3 py-3",key:n.id},[t("div",Et,[t("div",ht,[a(r,{type:"text",label:"Value",validation:"required",modelValue:n.value,"onUpdate:modelValue":m=>n.value=m},null,8,["modelValue","onUpdate:modelValue"]),a(r,{type:"text",label:"Interpretation",validation:"required",modelValue:n.interpretation,"onUpdate:modelValue":m=>n.interpretation=m},null,8,["modelValue","onUpdate:modelValue"])]),t("button",{onClick:m=>te(T,F),class:"h-full bg-red-500 flex items-center justify-center rounded text-white px-4 py-2 mt-2"},[a(o(H),{class:"w-5 h-5"})],8,wt)])]))),128)):k("",!0),se(l.type.name.toLowerCase())?(b(),h("div",St,[a(o(Qe),{class:"w-5 h-5 mr-2"}),e[21]||(e[21]=$e(" A text box will appear for results entry "))])):k("",!0)]))),128)):k("",!0)]),t("div",Tt,[a(he,{type:"button",click:()=>{oe()},text:"Clear form"},null,8,["click"]),a(_,{type:"submit",click:()=>{},loading:o(E),color:"success",icon:o(ze),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})],512),[[j,!o(E)]])])])}}});export{Bt as default};
