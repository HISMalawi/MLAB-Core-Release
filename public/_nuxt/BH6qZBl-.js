import{_ as W}from"./CGGtvusN.js";import{d as K,r as _,u as Q,c as D,z as v,o as J,x as T,b as u,e as p,f as a,h as t,M as X,g as o,j as E,A as k,y as m,Y as Z,p as O,G as ee,V as te,S as oe,t as h,L as $,F as C,k as M,C as se,l as ae,_ as re}from"./D6i_IOc_.js";import{_ as ne}from"./DhP7LVvB.js";import{_ as le}from"./BDzYUTR_.js";import{u as ie,_ as de}from"./B0IsjAMG.js";import{_ as ce}from"./Q0jOLyQ3.js";import{_ as ue}from"./CBa_CEmt.js";import{_ as pe}from"./Ip4akOdJ.js";import{P as me}from"./BZSIQZRS.js";import{u as fe}from"./CW5x0XU2.js";import{u as _e}from"./DWAwhHUi.js";import{r as ve}from"./DZLF4Rpe.js";import{r as ye}from"./B7eO7aR_.js";import"./By9LU-fN.js";import"./DWXm4k5R.js";const xe=""+new URL("whonet.BSO_29W3.png",import.meta.url).href,ge={class:"px-5 py-5"},be={class:"w-full flex items-center justify-between"},Ee={class:"bg-white flex space-x-5 py-5 flex-wrap"},he={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},we={class:"w-72 ml-2"},Re={class:"fixed inset-0 overflow-y-auto"},Ae={class:"flex min-h-full items-center justify-center p-4 text-center"},De={class:"mt-4"},Te={class:"mt-6 flex justify-end space-x-3"},Ce={class:"border rounded print-container mt-5"},Me={class:"w-full rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Se={class:"mt-3 px-5 border-b"},Ne={class:"font-medium mb-2"},ke={class:"font-normal"},Oe={class:"max-w-full overflow-x-auto"},$e={class:"p-4"},Fe={class:"w-full border border-dotted rounded overflow-x-auto"},Ye={class:"bg-gray-100"},je={class:"border-b"},Ve={key:0,class:"flex flex-col space-y-3 items-center justify-center py-10"},tt=K({__name:"whonet",setup(Be){_e({title:`${me.name} - Daily Log Reports`});const F=_([{label:"Show zone numbers (e.g. '1,2,3,4...')",value:"number"},{label:"Show interpretation (e.g. 'Resistant (R), Susceptible (S), Intermediate (I)')",value:"interpretation"}]),w=_("number");fe();const Y=_([{name:"Home",link:"/home"},{name:"Reports",link:"#"}]),{$toast:A}=Q(),{loading:i,executeCancellableRequest:j,cancelRequest:V}=ie(),y=_(!1),d=_(["",""]),c=_([]),x=D(()=>d.value[0]?v(d.value[0]).format("YYYY-MM-DD"):""),g=D(()=>d.value[1]?v(d.value[1]).format("YYYY-MM-DD"):""),B=()=>{d.value=["",""]},S=s=>["laboratory","first_name","last_name","gender","dob","ward_or_location","accession_number","specimen_type","requested_by"].filter(r=>s.length>0&&s.some(n=>r in n)),P=s=>({WARD_OR_LOCATION:"WARD OR LOCATION",SPECIMEN_TYPE:"SPECIMEN TYPE",REQUESTED_BY:"REQUESTED BY",ACCESSION_NUMBER:"ACCESSION NUMBER",FIRST_NAME:"FIRST NAME",LAST_NAME:"LAST NAME"})[s]||s.replaceAll("_"," "),I=D(()=>{const s=new Set;return c.value.forEach(e=>{Object.keys(e).forEach(r=>s.add(r))}),c.value.map(e=>{const r={};return Array.from(s).forEach(n=>{const f=n.toUpperCase().replace(/[_-]/g," ");if(typeof e[n]=="string"&&e[n]&&e[n].startsWith("{"))try{const b=JSON.parse(e[n]);w.value==="number"?r[f]=b.zone||"":r[f]=b.interpretation||""}catch{r[f]=e[n]||""}else r[f]=e[n]||""}),r})}),L=async()=>{if(i.value=!0,!x.value||!g.value){A.warn("Please select a date range"),i.value=!1;return}c.value=[];let s=`start_date=${x.value}&end_date=${g.value}`;const{data:e,error:r}=await j({route:`${ae.whonet}?${s}`,method:"GET"});e.value&&(c.value=e.value.data,i.value=!1,A.success("Report generated successfully")),r.value&&(console.error(r.value),A.error("An error occurred while generating report"),i.value=!1)};return J(()=>{i.value=!1}),(s,e)=>{const r=W,n=T("datepicker"),f=re,b=ne,H=T("FormKit"),U=T("excel"),q=le,z=de;return u(),p("div",ge,[a(r,{pages:t(Y)},null,8,["pages"]),e[13]||(e[13]=X('<div class="flex items-center py-5"><div class="flex items-center mr-2"><div class="w-12 h-12 bg-gray-100 flex items-center justify-center rounded-full"><img src="'+ce+'" alt="report-icon" class="w-8 h-8"></div><div class="w-12 h-12 bg-gray-100 flex items-center justify-center rounded-full -ml-3"><img src="'+xe+'" alt="report-icon" class="w-8 h-8"></div></div><h3 class="text-2xl font-semibold uppercase">WHONET Report</h3></div>',1)),o("div",be,[o("div",Ee,[o("div",he,[a(t(ve),{class:"w-5 h-5 mr-2"}),e[6]||(e[6]=E(" Filter By Date Range ")),o("div",we,[a(n,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy",onCleared:B,"input-class-name":"datepicker",modelValue:t(d),"onUpdate:modelValue":e[0]||(e[0]=l=>k(d)?d.value=l:null),"max-date":new Date},null,8,["modelValue","max-date"])])]),o("div",null,[a(f,{color:"primary",text:"Generate Report",icon:t(ye),click:()=>L(),loading:t(i)},null,8,["icon","click","loading"])])]),o("div",null,[a(b,{text:"Export Excel",onClick:e[1]||(e[1]=()=>{y.value=!0})}),a(t(oe),{appear:"",show:t(y),as:"template"},{default:m(()=>[a(t(Z),{as:"div",onClose:e[5]||(e[5]=l=>y.value=!1),class:"relative z-10"},{default:m(()=>[a(t(O),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:m(()=>e[7]||(e[7]=[o("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),o("div",Re,[o("div",Ae,[a(t(O),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:m(()=>[a(t(ee),{class:"w-full max-w-md transform overflow-hidden rounded bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:m(()=>[a(t(te),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:m(()=>e[8]||(e[8]=[E(" Export Report To Excel ")])),_:1}),o("div",De,[e[9]||(e[9]=o("p",{class:"text-sm text-gray-500"}," Select results format to export. ",-1)),a(H,{type:"radio",name:"export_format",modelValue:t(w),"onUpdate:modelValue":e[2]||(e[2]=l=>k(w)?w.value=l:null),options:t(F)},null,8,["modelValue","options"])]),o("div",Te,[o("button",{type:"button",class:"inline-flex justify-center rounded border border-transparent bg-gray-100 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-200",onClick:e[3]||(e[3]=l=>y.value=!1)}," Cancel "),a(U,{class:"btn btn-default",header:[],data:t(I),worksheet:"report-work-sheet",name:`whonet_report_${t(v)(t(x)).format("DD_MM_yyyy")}_to_${t(v)(t(g)).format("DD_MM_yyyy")}.xls`},{default:m(()=>[o("button",{type:"button",class:"inline-flex justify-center rounded border border-transparent bg-sky-50 px-4 py-2 text-sm font-medium text-sky-600 hover:bg-sky-200",onClick:e[4]||(e[4]=l=>y.value=!1)}," Export Excel ")]),_:1},8,["data","name"])])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])]),o("div",Ce,[o("div",Me,[e[10]||(e[10]=o("div",{class:"flex flex-col space-y-2"},[o("img",{src:ue,alt:"app-logo",class:"w-24 h-24 object-cover"}),o("h3",{class:"text-xl font-semibold"},"WHONET REPORT")],-1)),a(q)]),o("div",Se,[o("h3",Ne,[e[11]||(e[11]=E(" Tests Performed Period: ")),o("span",ke,h(t(x)?t(v)(t(x)).format("DATE_FORMAT"in s?s.DATE_FORMAT:t($)):"-")+" - "+h(t(g)?t(v)(t(g)).format("DATE_FORMAT"in s?s.DATE_FORMAT:t($)):"-"),1)])]),o("div",Oe,[o("div",$e,[o("table",Fe,[o("thead",Ye,[o("tr",je,[(u(!0),p(C,null,M(S(t(c)),(l,R)=>(u(),p("th",{key:R,class:"px-2 py-2 text-center border-r text-lg uppercase"},h(P(l)),1))),128))])]),o("tbody",null,[(u(!0),p(C,null,M(t(c),(l,R)=>(u(),p("tr",{key:R,class:"divide-gray-200"},[(u(!0),p(C,null,M(S(t(c)),(N,G)=>(u(),p("td",{key:`${R}-${G}`,class:"capitalize px-2 py-2 text-center border-b border-r"},h(l[N]===""?"â€”":l[N]),1))),128))]))),128))])])])]),a(z,{condition:t(i),cancelReportGeneration:()=>t(V)()},null,8,["condition","cancelReportGeneration"]),t(c).length==0&&!t(i)?(u(),p("div",Ve,e[12]||(e[12]=[o("img",{src:pe,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),o("p",null,[E(" Please generate report data to preview the "),o("span",{class:"font-medium"},h("whonet")),E(" report. ")],-1)]))):se("",!0)])])}}});export{tt as default};
