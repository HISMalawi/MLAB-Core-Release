import{_ as oe}from"./Breadcrumb.vue.8ff2b6d4.js";import{_ as ne}from"./Dropdown.1e8bc329.js";import{l as le,B as b,u as ae,K as G,f as O,o as v,c as T,b as _,k as r,d as s,t as g,g as F,h as M,D as w,F as ce,r as ie,n as de,j as B,w as pe,v as _e,a as V,e as ue}from"./entry.ad4aba20.js";import{_ as me}from"./ExportButton.vue.d6927dab.js";import{_ as fe}from"./Address.vue.542cb173.js";import{_ as be}from"./Loader.04cfad00.js";import{u as ge}from"./vue.f36acd1f.bf45fb5c.js";import{e as he}from"./constants.060e48ac.js";import{_ as ye}from"./report.f1156e35.js";import{_ as xe}from"./logo.c764db13.js";import{_ as Ee}from"./page.e5e4c551.js";import{h,f as j,e as P}from"./fetch.5019f737.js";import{k as ve}from"./vue-doc-download.5a050509.js";import{P as Te}from"./package.00b14c4a.js";import{u as Se}from"./facility.3aab2e3f.js";import{r as Re}from"./FunnelIcon.9908961f.js";import{r as Le}from"./ArrowPathIcon.4f8264cd.js";import"./nuxt-link.5507b38f.js";import"./HomeIcon.d2a4a580.js";import"./listbox.6bf033a9.js";import"./hidden.d4abb7ca.js";import"./use-text-value.36050435.js";import"./CheckIcon.d58d2707.js";import"./CheckCircleIcon.9f3da900.js";import"./MagnifyingGlassIcon.3c05ce5b.js";import"./transition.bf38d962.js";import"./XMarkIcon.81c841af.js";import"./PencilSquareIcon.d20f2125.js";import"./PrinterIcon.a64525c6.js";const Me={class:"px-5 py-5"},Ye={class:"flex items-center py-5"},Ne=s("img",{src:ye,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ke={class:"text-2xl font-semibold uppercase"},Ue={class:"w-full flex items-center justify-between mb-5"},Ae={class:"w-full flex items-center space-x-3"},Ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},$e={class:"w-72 ml-2"},We={class:"w-40"},Ge={class:"w-48 flex items-end justify-end"},Oe={class:"rounded border"},Fe={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},we=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:xe,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold uppercase"}," INFECTION REPORT ")],-1),Be={key:0,id:"print-container"},Ve={class:"hidden"},je=s("h3",null,"INFECTION REPORT",-1),Pe={class:"text-lg font-semibold py-2 px-2"},He={class:"text-normal font-normal"},Ie=["innerHTML"],Ke=s("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"Summary",-1),qe={class:"w-full border-t"},ze=s("thead",null,[s("tr",{class:"border-b border-t bg-gray-100"},[s("th",{class:"px-2 py-2 border-r text-left"},"Tests"),s("th",{class:"px-2 py-2 text-left"},"Total")])],-1),De={class:"px-2 py-2 border-r border-b"},Je={class:"px-2 py-2 border-r border-b"},Qe={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Xe=s("img",{src:Ee,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Ze=s("p",{class:"text-base"},"Data not found, please generate report",-1),et=[Xe,Ze],tt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},st=s("p",{class:"text-base"},[M("Generating report, please wait"),s("span",{class:"animate-ping"},"...")],-1),$t=le({__name:"infection",setup(rt){ge({title:`${Te.name.toUpperCase()} - Infection Report`});const H=b("Infection Report"),I=b([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),S=b([]),x=b({id:0,name:"select department"}),Y=ae("token"),m=b(!1),L=Se(),R=b([]),N=b([]),n=b(new Array("","")),k=G(()=>n.value[0]?h(n.value[0]).format("YYYY-MM-DD"):""),U=G(()=>n.value[1]?h(n.value[1]).format("YYYY-MM-DD"):""),K=()=>{n.value=new Array("","")},q=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',c=(o,e,l)=>{const a=o.indexOf(e);return a!==-1?o.slice(0,a)+l+o.slice(a+e.length):o},z=o=>{let e="",l="",a="",d="",f=0,u=0,i=0,p=0,y=0;return o.reduce((t,A)=>{const Z=A.measures.flatMap(C=>C.results.flatMap($=>{const W=Object.keys($[0])[0],ee=$[0][W];return Object.entries(ee).map(([te,se])=>{const re=se;return{test_type:A.test_type,measure:C.name,result:W,gender:te==="F"?"Female":"Male",...re}})}));return t.push(...Z),t},new Array).forEach(t=>{u++,i++,f++,a===t.test_type?(e+="<tr>",l!==t.measure?(l=t.measure,d=t.result,e=c(e,"NEW_MEASURE",u.toString()),e=e.replace("NEW_RESULT",i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),u=0,i=0,p=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):d!==t.result&&(e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),d=t.result,i=0,p=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(a=t.test_type,l=t.measure,d=t.result,e=e.replace(/NEW_TEST/g,f.toString()),e=c(e,"NEW_MEASURE",u.toString()),e=e.replace(/NEW_RESULT/g,i.toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),u=0,i=0,p=0,f=0,y=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.L_E_5?t.L_E_5:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_5_L_E_14?t.G_5_L_E_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+(t.G_14?t.G_14:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0)).toString()+"</td>",p+=(t.L_E_5??0)+(t.G_5_L_E_14??0)+(t.G_14??0),d===t.result&&i==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),u==0&&(y=t.L_E_5+t.G_5_L_E_14+t.G_14)}),e=c(e,"NEW_TEST",(++f).toString()),e=c(e,"NEW_MEASURE",(++u).toString()),e=c(e,"NEW_RESULT",(++i).toString()),e=c(e,"RESULT_TOTAL",p.toString()),e=c(e,"TEST_TOTAL",y.toString()),e+="</tr>",e},D=o=>{const e=q(),l=o.length>0?z(o):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${l}</table>`};async function J(){const{data:o,error:e}=await j({route:`${P.departments}`,method:"GET",token:`${Y.value}`});o.value&&(S.value=o.value,S.value.some(l=>l.id===0)||S.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function Q(){if(X())V().$toast.warning("Please select a department");else{m.value=!0;let o=n.value[0].toString()!=""?h(n.value[0].toString()).format("YYYY-MM-DD"):"",e=n.value[1].toString()!=""?h(n.value[1].toString()).format("YYYY-MM-DD"):"";const l={route:`${P.aggregateReports}infection?from=${o}&to=${e}&department=${x.value.id}`,method:"GET",token:`${Y.value}`},{data:a,error:d,pending:f}=await j(l);m.value=f,a.value&&(m.value=!1,R.value=a.value.data,N.value=a.value.summary),d.value&&(console.error(d.value),m.value=!1,V().$toast.error(he))}}function X(){return x.value.name=="select department"}return J(),(o,e)=>{const l=oe,a=O("datepicker"),d=ne,f=ue,u=O("FormKit"),i=me,p=fe,y=be;return v(),T("div",Me,[_(l,{pages:r(I)},null,8,["pages"]),s("div",Ye,[Ne,s("h3",ke,g(r(H)),1)]),s("div",Ue,[_(u,{type:"form","submit-label":"Update",onSubmit:Q,actions:!1,id:"submitForm"},{default:F(({value:E})=>[s("div",Ae,[s("div",Ce,[_(r(Re),{class:"w-5 h-5 mr-2"}),M(" Filter By Date Range "),s("div",$e,[_(a,{onCleared:K,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:r(n),"onUpdate:modelValue":e[0]||(e[0]=t=>w(n)?n.value=t:null)},null,8,["modelValue"])])]),s("div",We,[_(d,{items:r(S),modelValue:r(x),"onUpdate:modelValue":e[1]||(e[1]=t=>w(x)?x.value=t:null)},null,8,["items","modelValue"])]),s("div",null,[_(f,{loading:r(m),color:"primary",type:"submit",text:"Generate Report",icon:r(Le),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),s("div",Ge,[_(r(ve),{element:"print-container",filename:`infection_report_from_${r(h)(r(n)[0].toString()).format("DD_MM_YYYY")}_to_${r(h)(r(n)[1].toString()).format("DD_MM_YYYY")}`},{default:F(()=>[_(i,{text:"Export Excel"})]),_:1},8,["filename"])])]),s("div",null,[s("div",Oe,[s("div",Fe,[we,_(p)]),r(R).length>0&&!r(m)?(v(),T("div",Be,[s("div",Ve,[je,s("h3",null,g(r(L).details.name),1),s("p",null,g(r(L).details.address),1),s("p",null,g(r(L).details.phone),1)]),s("div",Pe,[M("Tests Performed Period: "),s("span",He,g(r(k)!=""?r(h)(r(k)).format("DD/MM/YYYY"):"")+" - "+g(r(U)!=""?r(h)(r(U)).format("DD/MM/YYYY"):""),1)]),s("div",{innerHTML:D(r(R))},null,8,Ie),s("div",null,[Ke,s("table",qe,[ze,s("tbody",null,[(v(!0),T(ce,null,ie(r(N),(E,t)=>(v(),T("tr",{key:E.name,class:de(t%2===0?"bg-white":"bg-gray-50")},[s("td",De,g(E.name),1),s("td",Je,g(E.count),1)],2))),128))])])])])):B("",!0),r(R).length==0&&!r(m)?(v(),T("div",Qe,et)):B("",!0),pe(s("div",tt,[_(y),st],512),[[_e,r(m)]])])])])}}});export{$t as default};
