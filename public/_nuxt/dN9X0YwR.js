import{_ as Fe}from"./COJDNupw.js";import{d as G,aa as Re,ab as Le,c as A,r as u,ac as qe,o as K,w as Ae,ad as pe,ae as Ne,af as Oe,ag as De,ah as je,ai as Pe,F as he,aj as me,b as O,e as D,g as s,u as Be,a as _e,f as p,h as t,z as k,Y as Ue,p as M,G as Ie,V as Me,k as V,H as ve,j as Ve,N as fe,t as U,S as He,m as H,l as z,_ as ze,ak as Ge,a9 as Ke,a5 as Ye,C as q,O as B,y as Qe,a0 as Je}from"./BxD-h1LR.js";import{_ as We}from"./DMx_cVtr.js";import{r as Xe}from"./BkJfYQCG.js";import{d as Ze,p as et}from"./Bu7bZmRE.js";import{s as tt}from"./pmVMiK7H.js";import{r as at}from"./DedCeG2P.js";import{r as st}from"./4khDGtnR.js";import{_ as lt}from"./BNhNOnHe.js";import{_ as ot}from"./DCLH_TIo.js";import{u as rt}from"./BmiBNsbw.js";import{u as nt}from"./DRcUz5ts.js";import{P as it}from"./C1C0mJ5v.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";let ct=Symbol("GroupContext"),ut=G({name:"Switch",emits:{"update:modelValue":y=>!0},props:{as:{type:[Object,String],default:"button"},modelValue:{type:Boolean,default:void 0},defaultChecked:{type:Boolean,optional:!0},form:{type:String,optional:!0},name:{type:String,optional:!0},value:{type:String,optional:!0},id:{type:String,default:null},disabled:{type:Boolean,default:!1},tabIndex:{type:Number,default:0}},inheritAttrs:!1,setup(y,{emit:n,attrs:m,slots:x,expose:N}){var w;let E=(w=y.id)!=null?w:`headlessui-switch-${Re()}`,f=Le(ct,null),[v,g]=Ze(A(()=>y.modelValue),o=>n("update:modelValue",o),A(()=>y.defaultChecked));function R(){g(!v.value)}let T=u(null),S=f===null?T:f.switchRef,C=tt(A(()=>({as:y.as,type:m.type})),S);N({el:S,$el:S});function $(o){o.preventDefault(),R()}function F(o){o.key===me.Space?(o.preventDefault(),R()):o.key===me.Enter&&et(o.currentTarget)}function i(o){o.preventDefault()}let a=A(()=>{var o,h;return(h=(o=qe(S))==null?void 0:o.closest)==null?void 0:h.call(o,"form")});return K(()=>{Ae([a],()=>{if(!a.value||y.defaultChecked===void 0)return;function o(){g(y.defaultChecked)}return a.value.addEventListener("reset",o),()=>{var h;(h=a.value)==null||h.removeEventListener("reset",o)}},{immediate:!0})}),()=>{let{name:o,value:h,form:d,tabIndex:L,...j}=y,I={checked:v.value},P={id:E,ref:S,role:"switch",type:C.value,tabIndex:L===-1?0:L,"aria-checked":v.value,"aria-labelledby":f==null?void 0:f.labelledby.value,"aria-describedby":f==null?void 0:f.describedby.value,onClick:$,onKeyup:F,onKeypress:i};return pe(he,[o!=null&&v.value!=null?pe(Ne,Oe({features:De.Hidden,as:"input",type:"checkbox",hidden:!0,readOnly:!0,checked:v.value,form:d,disabled:j.disabled,name:o,value:h})):null,je({ourProps:P,theirProps:{...m,...Pe(j,["modelValue","defaultChecked"])},slot:I,attrs:m,slots:x,name:"Switch"})])}}});function dt(y,n){return O(),D("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const pt=s("div",{class:"fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity"},null,-1),mt={class:"fixed inset-0 overflow-hidden"},vt={class:"absolute inset-0 overflow-hidden"},ft={class:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10"},ht={class:"absolute left-0 top-0 -ml-8 flex pr-2 pt-4 sm:-ml-10 sm:pr-4"},_t=s("span",{class:"absolute -inset-2.5"},null,-1),yt=s("span",{class:"sr-only"},"Close panel",-1),gt={class:"flex h-full flex-col overflow-y-scroll bg-white py-3 shadow-xl"},bt={class:"border-b"},xt={class:"relative mt-6 flex-1 flex flex-col space-y-3"},wt={class:"px-5 flex flex-col space-y-3"},St={classs:"flex flex-col items-center"},Ct={class:"absolute w-full border-t bottom-0 justify-end flex px-5 pt-3 items-center space-x-5"},$t=G({__name:"filters",emits:["tableFields","filterFields","specimenFields","locationField","originField","onClearFilters"],setup(y,{emit:n}){const m=u(!1),{$toast:x}=Be(),N=()=>{m.value=!0},w=u([{label:"Show person who requested test",value:!1,property:"Requested by",table_value:"requested_by"},{label:"Show person who completed the test",value:!1,property:"Completed by",table_value:"completed"},{label:"Show test tracking numbers",value:!1,property:"tracking number",table_value:"tracking_number"},{label:"Show test result value",value:!1,property:"Test result",table_value:"result"},{label:"Show date of test result",value:!1,property:"Result date",table_value:"result_date"}]),E=u([]),f=u([]),v=u([]),g=u([]),R=_e("token"),T=n,S=()=>{const i=w.value.filter(a=>a.value);T("tableFields",i),T("specimenFields",v.value.join(",")),T("locationField",g.value.join(",")),m.value=!1,x.success("Filters applied successfully")},C=()=>{m.value=!1,w.value=w.value.map(i=>({...i,value:!1})),v.value=[],g.value=[],T("onClearFilters",w.value),x.success("Filters reset successfully")},$=async()=>{const{data:i,error:a,pending:o}=await H({route:z.specimens,method:"GET",token:`${R.value}`});i&&(E.value=i.value)},F=async()=>{const{data:i,error:a,pending:o}=await H({route:z.locations,method:"GET",token:`${R.value}`});i&&(f.value=i.value)};return K(()=>{$(),F()}),(i,a)=>{const o=ze,h=We;return O(),D("div",null,[p(o,{text:"Apply filters",color:"primary",icon:t(Xe),click:N},null,8,["icon"]),p(t(He),{as:"template",show:t(m)},{default:k(()=>[p(t(Ue),{class:"relative z-10",onClose:a[3]||(a[3]=d=>m.value=!1)},{default:k(()=>[p(t(M),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[pt]),_:1}),s("div",mt,[s("div",vt,[s("div",ft,[p(t(M),{as:"template",enter:"transform transition ease-in-out duration-500 sm:duration-700","enter-from":"translate-x-full","enter-to":"translate-x-0",leave:"transform transition ease-in-out duration-500 sm:duration-700","leave-from":"translate-x-0","leave-to":"translate-x-full"},{default:k(()=>[p(t(Ie),{class:"pointer-events-auto relative w-screen max-w-md"},{default:k(()=>[p(t(M),{as:"template",enter:"ease-in-out duration-500","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in-out duration-500","leave-from":"opacity-100","leave-to":"opacity-0"},{default:k(()=>[s("div",ht,[s("button",{type:"button",class:"relative text-gray-100 hover:text-white",onClick:a[0]||(a[0]=d=>m.value=!1)},[_t,yt,p(t(dt),{class:"h-6 w-6","aria-hidden":"true"})])])]),_:1}),s("div",gt,[s("div",bt,[p(t(Me),{class:"text-xl font-semibold leading-6 text-gray-900 px-4 py-2"},{default:k(()=>[V("Filters")]),_:1})]),s("div",xt,[s("div",wt,[s("div",null,[p(h,{label:"Specimen",mode:"tags",items:t(E).map(d=>d.name),"items-selected":t(v),"onUpdate:itemsSelected":a[1]||(a[1]=d=>ve(v)?v.value=d:null)},null,8,["items","items-selected"])]),s("div",null,[p(h,{label:"Lab location",mode:"tags",items:t(f).map(d=>d.name),"items-selected":t(g),"onUpdate:itemsSelected":a[2]||(a[2]=d=>ve(g)?g.value=d:null)},null,8,["items","items-selected"])]),s("div",St,[(O(!0),D(he,null,Ve(t(w),d=>(O(),D("label",{key:d.label,class:"flex items-center pt-3"},[p(t(ut),{modelValue:d.value,"onUpdate:modelValue":L=>d.value=L,class:fe([d.value?"bg-sky-500":"bg-gray-200","relative mr-2 inline-flex w-11 h-6 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75"])},{default:k(()=>[s("span",{"aria-hidden":"true",class:fe([d.value?"translate-x-5":"translate-x-0","pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out"])},null,2)]),_:2},1032,["modelValue","onUpdate:modelValue","class"]),V(" "+U(d.label),1)]))),128))])]),s("div",Ct,[p(o,{text:"Reset",color:"error",icon:t(at),click:C},null,8,["icon"]),p(o,{text:"Apply",color:"success",icon:t(st),click:S},null,8,["icon"])])])])]),_:1})]),_:1})])])])]),_:1})]),_:1},8,["show"])])}}}),kt=""+new URL("report_details.CM__hAjw.png",import.meta.url).href,Et={class:"px-5 py-5"},Tt=s("div",{class:"py-4 flex items-center"},[s("img",{src:kt,alt:"report-icon",class:"w-8 h-8 mr-2"}),s("h3",{class:"text-2xl font-semibold uppercase"},"Report Details")],-1),Ft={class:"bg-gray-50 border border-gray-100 rounded"},Rt={class:"flex px-2 py-2 items-center"},Lt=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",viewBox:"0 0 48 48"},[s("path",{fill:"currentColor","fill-rule":"evenodd",d:"M31 10a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2h-8a1 1 0 1 0 0 2v7h-3v-7a1 1 0 1 0 0-2H9a1 1 0 1 0 0 2v7H7v-3H5v3H4v2h1v13H4v2h1v2h2v-2h34v2h2v-2h1v-2h-1V21h1v-2h-1v-3h-2v3h-2v-7a1 1 0 1 0 0-2zm6 9v-7h-4v7zm-4 2h4v5h-4zm-2 0v8a4 4 0 0 0 8 0v-8h2v13H7V21h2v8a4 4 0 0 0 8 0v-8h3v8a4 4 0 0 0 8 0v-8zm-5-2v-7h-4v7zm-11 0v-7h-4v7zm-4 2h4v2h-4z","clip-rule":"evenodd"})],-1),qt={class:"px-2 text-base font-medium uppercase"},At={class:"flex px-2 py-2 items-center"},Nt=Je('<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 512 512"><rect width="416" height="384" x="48" y="80" fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" rx="48"></rect><circle cx="296" cy="232" r="24" fill="currentColor"></circle><circle cx="376" cy="232" r="24" fill="currentColor"></circle><circle cx="296" cy="312" r="24" fill="currentColor"></circle><circle cx="376" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="312" r="24" fill="currentColor"></circle><circle cx="216" cy="312" r="24" fill="currentColor"></circle><circle cx="136" cy="392" r="24" fill="currentColor"></circle><circle cx="216" cy="392" r="24" fill="currentColor"></circle><circle cx="296" cy="392" r="24" fill="currentColor"></circle><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M128 48v32m256-32v32"></path><path fill="none" stroke="currentColor" stroke-linejoin="round" stroke-width="32" d="M464 160H48"></path></svg>',1),Ot={class:"px-2 text-base font-medium"},Dt=s("span",{class:"font-medium text-black uppercase"},"Report period:",-1),jt={class:"w-full flex items-center justify-between mt-3"},Pt={class:"flex items-center space-x-3"},Bt={class:"mt-5"},ta=G({__name:"[associated_id]",setup(y){var Y,Q;const n=Ge();rt({title:`${Ke(((Q=(Y=n.query.type)==null?void 0:Y.toString())==null?void 0:Q.toUpperCase().replaceAll("-"," "))??"")} Drilldown - ${it.name.toUpperCase()}`});const m=u([]),x=u(!1),N=u(""),w=_e("token"),E=nt(),f=Ye(),v=u("name"),g=u(0),R=u([10,25,50,100,500,1e3]),T=u("patient_name"),S=u("asc"),C=u([]),$=u([]),F=u({page:1,rowsPerPage:10,sortBy:"name"}),i=u([{text:"SN",value:"sn",sortable:!1},{text:"PATIENT NO",value:"patient_id",sortable:!0},{text:"PATIENT NAME",value:"patient_name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"TEST",value:"test_type_name",sortable:!0},{text:"DATE REGISTERED",value:"date_registered",sortable:!0}]),a=u(i.value),o=u([]),h=[{name:"Home",link:"/home"},{name:"Reports",link:"#"}],d=(e,l,c,r)=>{const b=q(r).format("MMMM"),_=q(r).format("yyyy");return{aggregate:`${q(l).format(B)} - ${q(c).format(B)}`,culture:`${b}, ${_}`,moh:`${r}`}[e]},L=A(()=>m.value.map((e,l)=>{const c=e.completed_by&&e.completed_by.username?e.completed_by.username:"",r=e.results&&e.results.length>0?e.results.find(_=>_.value!==null):{},b=e.results&&e.results.length>0?e.results.filter(_=>_.name!=="Lab Tech. Name:").map(_=>`${_.name}: ${_.value}`).join(", "):"";return{sn:l+1,patient_id:e.client.patient_no,patient_name:`${e.client.first_name} ${e.client.last_name}`,accession_number:e.accession_number,test_type_name:e.test_type_name,specimen_type:e.specimen_type,result:b,result_date:q(r.result_date).format(B),completed:c,requested_by:e.requested_by,tracking_number:e.tracking_number,lab_location:e.lab_location.name,date_registered:q(e.created_date).format(B)}})),j=A(()=>L.value.map(e=>{let l={SN:e.sn,"PATIENT NO":e.patient_id,"PATIENT NAME":e.patient_name,"ACCESSION NO":e.accession_number,TEST:e.test_type_name,SPECIMEN:e.specimen_type,"TEST RESULT":e.result.replace(/,/g,`
`),"LAB LOCATION":e.lab_location,"RESULT DATE":e.result_date,"COMPLETED BY":e.completed,"REQUESTED BY":e.requested_by,"TRACKING NUMBER":e.tracking_number,"DATE REGISTERED":e.date_registered};if(o.value.length>0){let c=o.value.map(r=>r.toUpperCase());l=Object.fromEntries(Object.entries(l).filter(([r])=>c.includes(r.toUpperCase())||i.value.some(b=>b.text===r.toUpperCase())))}else{const c=a.value.map(r=>r.text.toUpperCase());l=Object.fromEntries(Object.entries(l).filter(([r])=>c.includes(r.toUpperCase())))}return l})),I=u([{origin:"aggregate",path:`${z.aggregateDrilldown}?associated_ids=${n.params.associated_id}`}]),P=async()=>{x.value=!0;const e=I.value.find(_=>_.origin==="aggregate");if(!e){console.error("Endpoint not found");return}const l={route:`${e.path}&page=${F.value.page}&per_page=${F.value.rowsPerPage}`,method:"GET",token:`${w.value}`},{data:c,error:r,pending:b}=await H(l);x.value=b,c.value&&(m.value=c.value.data,g.value=c.value.meta.total_count,x.value=!1),r.value&&(console.error(r.value),x.value=!1)},ye=e=>{if(typeof e=="object"){F.value=e;const c={...f.currentRoute.value.query,page:e.page,rowsPerPage:e.rowsPerPage};f.replace({query:c}),P()}},ge=e=>{C.value=[],$.value=[],xe(e),a.value=i.value.filter(l=>!l.text.includes("Specimen")).filter(l=>!l.text.includes("Lab Location"))},be=e=>{if(a.value=[...i.value],o.value=[],e.length>0){const l=new Set(a.value.map(r=>r.text));e.forEach(r=>{l.has(r.property)||(a.value.push({text:r.property,value:r.table_value,sortable:!0}),o.value.push(r.property))});const c=new Set(e.map(r=>r.property));a.value=a.value.filter(r=>c.has(r.text)||i.value.some(b=>b.text===r.text))}},xe=e=>{e.forEach(l=>{l.value||(a.value=a.value.filter(c=>c.text!==l.property))}),C.value.length===0&&$.value.length===0&&(a.value=[...i.value])},we=e=>{const l=e.split(",").filter(c=>c.trim()!=="");C.value=l,l.length>0?Ce({text:"Specimen",value:"specimen_type",sortable:!0}):$e(),C.value.length===0&&$.value.length===0&&(i.value=[...i.value])},Se=e=>{const l=e.split(",").filter(c=>c.trim()!=="");$.value=l,l.length>0?ke({text:"Lab Location",value:"lab_location",sortable:!0}):Ee(),C.value.length===0&&$.value.length===0&&(i.value=[...i.value])},Ce=e=>{a.value.some(l=>l.text==="Specimen")||a.value.push(e)},$e=()=>{a.value=a.value.filter(e=>e.text!=="Specimen")},ke=e=>{a.value.some(l=>l.text==="Lab Location")||a.value.push(e)},Ee=()=>{a.value=a.value.filter(e=>e.text!=="Lab Location")},Te=e=>e.join("-").toLowerCase().replace(/ /g,"-");return K(()=>{P()}),(e,l)=>{var W,X,Z,ee,te,ae,se,le,oe,re,ne,ie,ce,ue,de;const c=Fe,r=$t,b=lt,_=Qe("excel"),J=ot;return O(),D("div",Et,[p(c,{pages:h}),Tt,s("div",null,[s("div",Ft,[s("div",Rt,[Lt,s("p",qt,U(t(n).query.test)+" (total tests count: "+U(t(n).query.count)+") ",1)]),s("div",At,[Nt,s("p",Ot,[Dt,V(" "+U(d((W=t(n).query.origin)==null?void 0:W.toString(),(X=t(n).query.from)==null?void 0:X.toString(),(Z=t(n).query.to)==null?void 0:Z.toString(),(ee=t(n).query.dateRange)==null?void 0:ee.toString())),1)])])]),s("div",jt,[s("div",null,[p(r,{onTableFields:be,onSpecimenFields:we,onLocationField:Se,onOnClearFilters:ge})]),s("div",Pt,[p(_,{class:"btn btn-default",header:[`${(te=t(n).query.origin)==null?void 0:te.toString().toUpperCase()} - ${(ae=t(n).query.type)==null?void 0:ae.toString().replaceAll("-"," ").toUpperCase()} `,`FOR PERIOD ${d((se=t(n).query.origin)==null?void 0:se.toString(),(le=t(n).query.from)==null?void 0:le.toString(),(oe=t(n).query.to)==null?void 0:oe.toString(),(re=t(n).query.dateRange)==null?void 0:re.toString())}`,t(E).details.name,t(E).details.address,t(E).details.phone,`${(ie=(ne=t(n).query.test)==null?void 0:ne.toString())==null?void 0:ie.toUpperCase()}`],data:t(j),worksheet:"report-work-sheet",name:Te([`${(ce=t(n).query.origin)==null?void 0:ce.toString()}`,`${(ue=t(n).query.type)==null?void 0:ue.toString()}`,`${(de=t(n).query.test)==null?void 0:de.toString()}`,".xls"])},{default:k(()=>[p(b,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),s("div",Bt,[p(J,{headers:t(a),data:t(L),loading:t(x),"rows-per-items":t(R),searchField:t(N),searchValue:t(v),serverItemsLength:t(g),serverOptions:t(F),sortBy:t(T),sortType:t(S),onUpdate:ye},null,8,["headers","data","loading","rows-per-items","searchField","searchValue","serverItemsLength","serverOptions","sortBy","sortType"])])])])}}});export{ta as default};
