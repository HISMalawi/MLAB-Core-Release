var le=Object.defineProperty;var oe=(m,n,i)=>n in m?le(m,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[n]=i;var w=(m,n,i)=>oe(m,typeof n!="symbol"?n+"":n,i);import{_ as ie}from"./BFE2e6qW.js";import{_ as re}from"./BW-thXDA.js";import{_ as de}from"./HlF4afxl.js";import{J as z,z as ce,d as ue,bz as me,af as pe,a as fe,r as l,c as h,a2 as _e,w as J,bA as P,o as ve,x as O,b as M,e as H,g as t,f as c,h as a,j as L,y as Y,t as N,by as ye,A as y,K as R,i as be,ay as xe,C as ge,l as we,m as he,u as V,_ as Ne}from"./DaR_ss44.js";import{_ as Ve}from"./DAoM-dCf.js";import{A as b,u as ke,P as $e}from"./o7FrOws6.js";import{P as Ce}from"./CMtC_zcg.js";import{u as Se}from"./CfS7LVlI.js";import{r as Pe}from"./Ft-ZegxM.js";import"./jy5sGp16.js";import"./DdDBrcBJ.js";import"./CZ2PDY8V.js";import"./3s8e8opx.js";import"./CzrFPi8W.js";import"./DkfWqLD-.js";import"./kwQtm3rv.js";import"./BfSjAygv.js";class qe{constructor(n){w(this,"client",{id:"",uuid:""});w(this,"tests",[]);w(this,"order",{priority:1,requested_by:"",collected_by:z().$state.department,sample_collected_time:"",tracking_number:""});w(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=n}createEncounter(n,i){this.encounter={...this.encounter,encounter_type:n,facility_section:i}}buildOrder(n="",i=ce().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=n,this.order.sample_collected_time=i}setTests(n,i){this.tests=i.map(p=>({specimen:n,test_type:p}))}async createOrder(n){return b.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client,lab_location:n})}}const De={class:"py-5 px-5"},Ae={class:"mt-5"},Te={class:"flex items-center space-x-2"},Ue={class:"text-xl font-semibold uppercase"},Je={class:"border rounded mt-5"},Oe={class:"w-full py-5 px-5"},Re={class:"flex items-center space-x-20"},Be={class:"flex items-center space-x-3"},Ee={class:"mt-1 text-gray-600"},Fe={class:"flex items-center space-x-3"},Me={class:"mt-1 text-gray-600"},He={class:"flex items-center space-x-3"},Le={class:"mt-1 text-gray-600"},Ye={class:"border mt-5 rounded"},ze={class:"px-5 py-5"},Ke={class:"w-full mb-5"},We={class:"flex flex-col space-y-2"},je={class:"w-full flex items-center space-x-10 mb-5"},Ge={class:"w-1/2 flex flex-col space-y-2"},Ie={class:"w-1/2 flex flex-col space-y-2"},Qe={class:"font-medium"},Xe={class:"w-full flex items-center space-x-10 mb-5"},Ze={class:"w-1/2 flex flex-col space-y-2"},et={class:"w-1/2 flex flex-col space-y-2"},tt={class:"w-full my-6"},st={key:0,class:"w-full mb-5 flex flex-col space-y-2"},at={class:"w-full"},ht=ue({__name:"index",setup(m){Se({title:`${Ce.name.toUpperCase()} - New Test`});const n=me(),i=pe(),p=z(),K=ke(),W=fe("token"),u=l({date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1}),j=l([{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}]),B=l([]),q=l([]),k=l([]),f=l([]),_=l({name:"select visit type",id:0}),r=l({name:"select specimen",id:0}),v=l({name:"select ward",id:0}),g=l([]),$=l(""),C=l(""),D=l("Requesting Ward"),S=l(!1),G=h(()=>_e(u.value.date_of_birth)),A=h(()=>u.value.sex.match(/f/i)?"Female":"Male"),E=h(()=>`${u.value.first_name} ${u.value.middle_name} ${u.value.last_name}`),I=h(()=>u.value.client_id),T=h(()=>p.user.departments.find(s=>s.name===p.department));function Q(s){const e={route:`${we.clients}/${s}`,method:"GET",token:`${W.value}`};he(e).then(({data:d,error:x})=>{d.value&&(u.value=d.value),x.value&&console.error(x.value)})}function X(s,e){const d=s.find(x=>x.name===e);return d?d.id:null}async function Z(){const s=new qe(u.value.client_id);s.createEncounter(Number(_.value.id),Number(v.value.id)),s.buildOrder($.value,C.value),s.setTests(Number(r.value.id),g.value);const e=X(p.locations,p.selectedLocation),d=await s.createOrder(Number(e));P(d)||(V().$toast.success(`Order with accession number ${d.accession_number} has been created successfully!`),await K.alertConfirmation({message:"Do you want to print specimen label?"})&&await $e.printSpecimenLabel(d.accession_number)),i.push("/tests")}function ee(){return Number(_.value.id)==0?(V().$toast.warning("Please select visit type and try again!"),!1):Number(r.value.id)==0?(V().$toast.warning("Please select specimen and try again!"),!1):Number(v.value.id)==0?(V().$toast.warning("Please select ward and try again!"),!1):g.value.length==0?(V().$toast.warning("Please select tests and try again!"),!1):!0}return J(_,async s=>{s.name.toLowerCase()=="referral"?(D.value="Requesting Facility",v.value={name:"select facility",id:0}):D.value="Requesting Ward",k.value=[],P(k.value[Number(s.id)])&&(k.value=await b.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:Number(s.id)}))}),J(r,async s=>{P(f.value[Number(s.id)])&&(f.value[Number(s.id)]=await b.getJson("specimen/test_types",{specimen_id:Number(s.id),department_id:T.value.id,sex:A.value})||[])}),J(()=>p,async s=>{for(const e in f.value)f.value.hasOwnProperty(e)&&delete f.value[e];P(r.value)||(f.value[Number(r.value.id)]=await b.getJson("specimen/test_types",{specimen_id:Number(r.value.id),department_id:s.user.departments.find(e=>e.name===s.department).id,sex:A.value})||[]),b.getJson("specimen",{department_id:T.value.id}).then(e=>q.value=e)},{deep:!0}),ve(async()=>{const s=await b.getJson("encounter_types");B.value=s.data;const e=await b.getJson("specimen",{department_id:T.value.id});q.value=e,Q(n.query.patient_id)}),(s,e)=>{const d=ie,x=re,F=O("FormKit"),U=de,te=O("multi-select"),se=O("datepicker"),ae=Ne;return M(),H("div",null,[t("div",De,[c(d,{pages:a(j)},null,8,["pages"]),t("div",Ae,[t("div",Te,[e[9]||(e[9]=t("img",{src:Ve,class:"w-auto h-6",alt:"flash-icon"},null,-1)),t("h3",Ue,[e[8]||(e[8]=L(" New order for ")),t("span",null,[c(x,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${a(E).toLowerCase().replace(" ","+")}`},{default:Y(()=>[L(" “"+N(a(E))+"” ",1)]),_:1},8,["to"])])])]),t("div",Je,[e[13]||(e[13]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("img",{src:ye,class:"h-8 w-auto",alt:"fever-icon"}),t("h3",{class:"font-semibold text-lg"},"Patient Details")],-1)),t("div",Oe,[t("div",Re,[t("div",Be,[e[10]||(e[10]=t("h3",{class:"font-medium"},"Patient Number:",-1)),t("p",Ee,N(a(I)),1)]),t("div",Fe,[e[11]||(e[11]=t("h3",{class:"font-medium"},"Age",-1)),t("p",Me,N(a(G))+" years old",1)]),t("div",He,[e[12]||(e[12]=t("h3",{class:"font-medium"},"Sex:",-1)),t("p",Le,N(a(A)),1)])])])]),c(F,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=ne=>ee()&&Z()),actions:!1,id:"submitForm"},{default:Y(({value:ne})=>[t("div",Ye,[e[19]||(e[19]=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("h3",{class:"font-semibold text-lg"},"Order Details")],-1)),t("div",ze,[t("div",Ke,[t("div",We,[c(F,{label:"Requesting Physician",validation:"required",modelValue:a($),"onUpdate:modelValue":e[0]||(e[0]=o=>y($)?$.value=o:null)},null,8,["modelValue"])])]),t("div",je,[t("div",Ge,[e[14]||(e[14]=t("label",{class:"font-medium"},"Visit Type",-1)),c(U,{items:a(B),modelValue:a(_),"onUpdate:modelValue":e[1]||(e[1]=o=>y(_)?_.value=o:null),class:R(a(_).name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",Ie,[t("label",Qe,N(a(D)),1),c(U,{isSearchable:"",items:a(k),modelValue:a(v),"onUpdate:modelValue":e[2]||(e[2]=o=>y(v)?v.value=o:null),class:R(a(v).name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),t("div",Xe,[t("div",Ze,[e[15]||(e[15]=t("label",{class:"font-medium"},"Specimen Type",-1)),c(U,{items:a(q),modelValue:a(r),"onUpdate:modelValue":e[3]||(e[3]=o=>y(r)?r.value=o:null),class:R(a(r).name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",et,[e[16]||(e[16]=t("label",{class:"font-medium"},"Tests",-1)),c(te,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:a(g),"onUpdate:modelValue":e[4]||(e[4]=o=>y(g)?g.value=o:null),options:a(f)[a(r).id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",tt,[be(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=o=>y(S)?S.value=o:null)},null,512),[[xe,a(S)]]),e[17]||(e[17]=t("label",{class:"font-medium"},"Back Data Entry",-1))]),a(S)?(M(),H("div",st,[e[18]||(e[18]=t("label",{class:"font-medium"},"Sample collection date",-1)),c(se,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:a(C),"onUpdate:modelValue":e[6]||(e[6]=o=>y(C)?C.value=o:null)},null,8,["modelValue"])])):ge("",!0),t("div",at,[c(ae,{type:"submit",text:"Place order",color:"primary",icon:a(Pe),click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}}});export{ht as default};
