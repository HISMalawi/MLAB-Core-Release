import{_ as Ee}from"./BFE2e6qW.js";import{b as k,e as q,g as e,d as be,r as i,a as ne,u as oe,x as E,f as s,h as a,y as c,Y as de,p as W,G as ce,V as ue,j as Q,q as me,A as R,i as J,B as ie,C as Y,S as pe,l as B,m as G,D as Te,_ as ve,z as Ie,s as Ce,v as re,t as H,F as ye,k as xe,n as De,E as Pe,c as qe,w as $e,o as Le,H as se}from"./DaR_ss44.js";import{_ as Ue}from"./BXtY6SFH.js";import{_ as he}from"./r0QsBocn.js";import{r as Ve}from"./BTU_o6qE.js";import{r as Ae}from"./CxRsRgau.js";import{_ as Fe}from"./B1bLn-Yy.js";import{r as Re}from"./B_cjOhbr.js";import{r as Me}from"./DfY9W-tc.js";import{r as Se}from"./CZiYodP1.js";import{r as je}from"./CCe7HPTx.js";import{r as Be}from"./BfSjAygv.js";import{_ as Ge}from"./BCBnBcQ0.js";import{u as le}from"./Di-6L_Dx.js";import{P as Ne}from"./CMtC_zcg.js";import{u as ze}from"./CfS7LVlI.js";import"./BW-thXDA.js";import"./jy5sGp16.js";function Oe(V,l){return k(),q("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z","clip-rule":"evenodd"})])}const we="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6%2036C6%2031.0347%2017.9925%2028%2024%2028C30.0075%2028%2042%2031.0347%2042%2036V42H6V36Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M24%2024C28.4183%2024%2032%2020.4183%2032%2016C32%2011.5817%2028.4183%208%2024%208C19.5817%208%2016%2011.5817%2016%2016C16%2020.4183%2019.5817%2024%2024%2024ZM24%2026C29.5228%2026%2034%2021.5228%2034%2016C34%2010.4772%2029.5228%206%2024%206C18.4772%206%2014%2010.4772%2014%2016C14%2021.5228%2018.4772%2026%2024%2026Z'%20fill='%23333333'/%3e%3c/svg%3e",Ze={class:"fixed inset-0 overflow-y-auto"},He={class:"flex min-h-full items-center justify-center p-4 text-center"},Ke={class:"border-b px-3 py-3 flex items-center justify-between"},Xe={class:"mt-2 space-y-3 px-5"},Ye={class:"grid grid-cols-2 gap-4"},Je={class:"grid grid-cols-2 gap-4"},Qe={class:"grid grid-cols-2 gap-4"},We={class:"w-full flex items-center"},et={class:"flex items-center"},tt={class:"flex items-center ml-2"},at={key:0,class:"mt-2"},st={class:"mt-10 justify-end flex items-center space-x-3 px-3 py-2 border-t"},lt=be({__name:"index",setup(V){const l=i(!1),u=Ve,U=Ae,r=i([]),_=i([]),m=i([]),$=ne("token"),T=i([]),L=i([]),A=i([]),y=i([]),I=i([]),h=i([]),w=i(""),n=i(""),C=i(""),D=i(""),S=i(""),N=i(""),O=i(!1),d=i(!1),M=i(!1),K=i(!1),{$metadata:F}=oe(),fe=async()=>{O.value=!0;const p=r.value?r.value.map(Z=>{var X;return(X=m.value.find(ae=>Z===ae.name))==null?void 0:X.id}).filter(Z=>Z!==void 0):[],t=A.value?A.value.map(Z=>{var X;return(X=L.value.find(ae=>Z===ae.name))==null?void 0:X.id}).filter(Z=>Z!==void 0):[],g=h.value?h.value.map(Z=>{var X;return(X=y.value.find(ae=>Z===ae.name))==null?void 0:X.id}).filter(Z=>Z!==void 0).map(Number):[],f={route:B.users,method:"POST",token:`${$.value}`,body:{person:{first_name:w.value,middle_name:n.value,last_name:C.value,sex:S.value},user:{username:D.value,password:N.value},roles:t,departments:p,lab_locations:g}},{data:ee,error:te,pending:b}=await G(f);O.value=b;const{$toast:ke}=oe();ee.value&&(x(),ke.success("User created successfully!"),O.value=!1),te.value&&(x(),ke.error(te.value),O.value=!1,console.error(te.value))},_e=async()=>{try{const p={route:B.roles,method:"GET",token:`${$.value}`},{data:t,error:g}=await G(p);t.value&&Array.isArray(t.value)?(L.value=t.value,T.value=t.value.map(f=>f.name)):g.value&&(console.error("Error fetching roles:",g.value),L.value=[],T.value=[])}catch(p){console.error("Unexpected error fetching roles:",p),L.value=[],T.value=[]}},ge=async()=>{try{const p={route:B.locations,method:"GET",token:`${$.value}`},{data:t,error:g}=await G(p);t.value&&Array.isArray(t.value)?(y.value=t.value,I.value=t.value.map(f=>f.name)):g.value&&(console.error("Error fetching locations:",g.value),y.value=[],I.value=[])}catch(p){console.error("Unexpected error fetching locations:",p),y.value=[],I.value=[]}},j=async()=>{M.value=!0,K.value=!1;try{if(F!=null&&F.departments&&Array.isArray(F.departments)&&F.departments.length>0){m.value=F.departments,_.value=m.value.map(f=>f.name);return}const p={route:B.departments,method:"GET",token:`${$.value}`},{data:t,error:g}=await G(p);t.value&&Array.isArray(t.value)?(m.value=t.value,_.value=m.value.map(f=>f.name)):g.value&&(console.error("Error fetching departments:",g.value),K.value=!0,m.value=[],_.value=[])}catch(p){console.error("Unexpected error fetching departments:",p),K.value=!0,m.value=[],_.value=[]}finally{M.value=!1}},o=async()=>{await j()},P=async()=>{d.value=!0;try{await Promise.all([_e(),ge(),j()]),x()}catch(p){console.error("Error initializing dialog:",p),x()}finally{d.value=!1}},z=()=>{Te("submitForm"),r.value=[],A.value=[],h.value=[],S.value="",K.value=!1},v=()=>{l.value=!1,z()},x=()=>{l.value=!l.value};return(p,t)=>{const g=ve,f=E("FormKit"),ee=Ue,te=he;return k(),q("div",null,[e("div",null,[s(g,{text:"Add user",color:"primary",loading:a(d),icon:a(u),click:()=>{P()}},null,8,["loading","icon","click"])]),s(a(pe),{appear:"",show:a(l),as:"template"},{default:c(()=>[s(a(de),{as:"div",onClose:x,class:"relative z-10"},{default:c(()=>[s(a(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>t[10]||(t[10]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Ze,[e("div",He,[s(a(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[s(a(ce),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",Ke,[s(a(ue),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>t[11]||(t[11]=[e("img",{src:we,alt:"user-icon",class:"w-8 h-8 mr-2"},null,-1),Q(" Add user ")])),_:1}),e("button",{onClick:v},[s(a(me),{class:"w-5 h-5"})])]),s(f,{type:"form",id:"submitForm","submit-label":"Update",onSubmit:fe,actions:!1},{default:c(()=>[e("div",Xe,[e("div",Ye,[s(f,{type:"text",label:"Username",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Username must contain only letters, no spaces or special characters"},modelValue:a(D),"onUpdate:modelValue":t[0]||(t[0]=b=>R(D)?D.value=b:null)},null,8,["modelValue"]),s(f,{type:"text",label:"First name",modelValue:a(w),"onUpdate:modelValue":t[1]||(t[1]=b=>R(w)?w.value=b:null),validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"}},null,8,["modelValue"])]),e("div",Je,[s(f,{type:"text",label:"Middle name",modelValue:a(n),"onUpdate:modelValue":t[2]||(t[2]=b=>R(n)?n.value=b:null)},null,8,["modelValue"]),s(f,{type:"text",label:"Last name",modelValue:a(C),"onUpdate:modelValue":t[3]||(t[3]=b=>R(C)?C.value=b:null),validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"}},null,8,["modelValue"])]),s(f,{type:"group"},{default:c(()=>[e("div",Qe,[s(f,{type:"password",label:"Password",name:"password",validation:"required",modelValue:a(N),"onUpdate:modelValue":t[4]||(t[4]=b=>R(N)?N.value=b:null),"validation-visibility":"live"},null,8,["modelValue"]),s(f,{type:"password",label:"Confirm password",name:"password_confirm",validation:"required|confirm","validation-label":"Password confirmation","validation-visibility":"live"})])]),_:1}),e("div",We,[t[14]||(t[14]=e("label",{class:"mr-5 font-medium text-lg"},"Sex",-1)),e("label",et,[J(e("input",{required:"","onUpdate:modelValue":t[5]||(t[5]=b=>R(S)?S.value=b:null),type:"radio",value:"M",name:"gender",class:"w-4 h-4 rounded-full bg-sky-500 border-sky-800 text-sky-500 focus:ring-sky-800"},null,512),[[ie,a(S)]]),t[12]||(t[12]=e("span",{class:"ml-2"},"Male",-1))]),e("label",tt,[J(e("input",{required:"","onUpdate:modelValue":t[6]||(t[6]=b=>R(S)?S.value=b:null),type:"radio",value:"F",name:"gender",class:"w-4 h-4 rounded-full bg-sky-500 border-sky-800 text-sky-500 focus:ring-sky-800"},null,512),[[ie,a(S)]]),t[13]||(t[13]=e("span",{class:"ml-2"},"Female",-1))])]),s(ee,{label:"Select Role(s)","items-selected":a(A),"onUpdate:itemsSelected":t[7]||(t[7]=b=>R(A)?A.value=b:null),items:a(T),mode:"tags"},null,8,["items-selected","items"]),s(ee,{label:"Select Laboratory Location(s)","items-selected":a(h),"onUpdate:itemsSelected":t[8]||(t[8]=b=>R(h)?h.value=b:null),items:a(I),mode:"tags"},null,8,["items-selected","items"]),e("div",null,[s(ee,{label:"Select Lab Section(s)","items-selected":a(r),"onUpdate:itemsSelected":t[9]||(t[9]=b=>R(r)?r.value=b:null),items:a(_),mode:"tags",direction:"top",loading:a(M),placeholder:a(M)?"Loading departments...":"Select lab sections"},null,8,["items-selected","items","loading","placeholder"]),a(K)&&!a(M)?(k(),q("div",at,[t[15]||(t[15]=e("p",{class:"text-red-600 text-sm mb-2"}," Failed to load lab sections. ",-1)),e("button",{onClick:o,class:"text-blue-600 hover:text-blue-800 text-sm underline",type:"button"}," Retry loading ")])):Y("",!0)])]),e("div",st,[s(te,{type:"button",click:()=>{z()},text:"Clear form"},null,8,["click"]),s(g,{loading:a(O),type:"submit",click:()=>{},color:"success",icon:a(U),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),ot={components:{TransitionRoot:pe,TransitionChild:W,Dialog:de,DialogPanel:ce,DialogTitle:ue,XMarkIcon:me,UserIcon:Re},props:{data:{required:!0,type:Object}},data(){return{moment:Ie,open:!1,addIcon:Ve,viewIcon:Me,editIcon:Se,clearIcon:je,details:{id:"",username:"",first_name:"",last_name:"",middle_name:"",sex:"",date_of_birth:"",lab_locations:new Array,roles:new Array,departments:new Array},loading:!1,cookie:ne("token")}},methods:{async init(){this.loading=!0;const V={route:`${B.users}/${this.data.id}`,method:"GET",token:`${this.cookie}`},{data:l,error:u,pending:U}=await G(V);this.loading=U,l.value&&(this.details=l.value,this.loading=!1,this.handleDialog()),u.value&&(console.error(u.value),this.loading=!1)},handleDialog(){this.open=!this.open}}},nt={class:"fixed inset-0 overflow-y-auto"},it={class:"flex min-h-full items-center justify-center p-4 text-center"},rt={class:"border-b px-3 py-3 flex items-center justify-between"},dt={class:"flex items-center justify-center mx-auto my-20"},ct={class:"space-y-3 px-5 py-5"},ut={class:"w-full flex flex-col space-y-1"},mt={class:"text-base text-gray-600"},pt={class:"w-full flex flex-col space-y-1"},vt={class:"text-base text-gray-600"},ft={class:"w-full flex flex-col space-y-1"},_t={class:"text-base text-gray-600"},gt={class:"w-full flex flex-col space-y-1"},yt={class:"w-full flex flex-col space-y-1"},xt={class:"w-full flex flex-col space-y-1"};function bt(V,l,u,U,r,_){const m=ve,$=E("TransitionChild"),T=E("DialogTitle"),L=E("XMarkIcon"),A=De,y=E("DialogPanel"),I=E("Dialog"),h=E("TransitionRoot");return k(),q("div",null,[e("div",null,[s(m,{text:"View",color:"primary",icon:r.viewIcon,click:_.init},null,8,["icon","click"])]),s(h,{appear:"",show:r.open,as:"template"},{default:c(()=>[s(I,{as:"div",onClose:_.handleDialog,class:"relative z-10"},{default:c(()=>[s($,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>l[1]||(l[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",nt,[e("div",it,[s($,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[s(y,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",rt,[s(T,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>l[2]||(l[2]=[e("img",{src:we,class:"w-6 h-6 mr-2"},null,-1),Q(" View User Account ")])),_:1}),e("button",{onClick:l[0]||(l[0]=(...w)=>_.handleDialog&&_.handleDialog(...w))},[s(L,{class:"w-5 h-5"})])]),J(e("div",dt,[s(A,{loading:r.loading},null,8,["loading"])],512),[[re,r.loading]]),J(e("div",ct,[e("div",ut,[l[3]||(l[3]=e("label",{class:"font-semibold text-lg"},"Username",-1)),e("p",mt,H(r.details.username),1)]),e("div",pt,[l[4]||(l[4]=e("label",{class:"font-semibold text-lg"},"First name",-1)),e("p",vt,H(r.details.first_name),1)]),e("div",ft,[l[5]||(l[5]=e("label",{class:"font-semibold text-lg"},"Last name",-1)),e("p",_t,H(r.details.last_name),1)]),e("div",gt,[l[6]||(l[6]=e("label",{class:"font-semibold text-lg"},"Roles",-1)),(k(!0),q(ye,null,xe(r.details.roles,(w,n)=>(k(),q("p",{class:"text-base text-gray-600",key:n},H(w.role_name),1))),128))]),e("div",yt,[l[7]||(l[7]=e("label",{class:"font-semibold text-lg"},"Locations",-1)),(k(!0),q(ye,null,xe(r.details.lab_locations,(w,n)=>(k(),q("p",{class:"text-base text-gray-600",key:n},H(w.name),1))),128))]),e("div",xt,[l[8]||(l[8]=e("label",{class:"font-semibold text-lg"},"Departments",-1)),(k(!0),q(ye,null,xe(r.details.departments,(w,n)=>(k(),q("p",{class:"text-base text-gray-600",key:n},H(w.name),1))),128))])],512),[[re,!r.loading]])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ht=Ce(ot,[["render",bt]]),wt={class:"mx-auto flex justify-center py-20 bg-white"},kt={class:"fixed inset-0 overflow-y-auto"},$t={class:"flex min-h-full items-center justify-center p-4 text-center"},Ct={class:"border-b px-3 py-3 flex items-center justify-between"},Dt={class:"mt-2 space-y-3 px-5 py-5"},Ut={class:"grid grid-cols-2 gap-4"},Vt={class:"grid grid-cols-2 gap-4"},At={class:"grid grid-cols-2 gap-4"},St={class:"w-full flex flex-col space-y-2"},Et={class:"w-full flex flex-col space-y-2"},Tt={class:"flex items-center"},It={class:"flex items-center"},Pt={class:"flex items-center ml-2"},qt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Lt=be({__name:"index",props:{data:{}},emits:["update"],setup(V,{emit:l}){const u=V,U=i(!1),r=Se,_=Ae,m=i([]),$=i([]),T=i([]),L=i([]),A=i([]),y=i([]),I=ne("token"),h=i([]),w=i([]),n=i([]),C=i(!1),D=i(!1),S=l,{$toast:N,$metadata:O}=oe(),d=i({id:"",username:"",first_name:"",last_name:"",middle_name:"",old_password:"",new_password:"",sex:"",date_of_birth:"",roles:[],lab_locations:[],departments:[]}),M=()=>{U.value=!U.value},K=async()=>{const j={route:B.roles,method:"GET",token:`${I.value}`},{data:o,error:P}=await G(j);o.value&&(w.value=o.value,h.value=o.value.map(z=>z.name)),P.value&&console.error(P.value)},F=async()=>{const j={route:B.locations,method:"GET",token:`${I.value}`},{data:o,error:P}=await G(j);o.value&&(L.value=o.value,A.value=o.value.map(z=>z.name)),P.value&&console.error(P.value)},fe=()=>{T.value=O.departments,$.value=T.value.map(j=>j.name)},_e=async()=>{await K(),await F(),fe(),M(),D.value=!0;const j={route:`${B.users}/${u.data.id}`,method:"GET",token:`${I.value}`},{data:o,error:P,pending:z}=await G(j);D.value=z,o.value&&(d.value=o.value,D.value=!1,n.value=o.value.roles.map(({role_name:v})=>{var x;return(x=w.value.find(p=>v===p.name))==null?void 0:x.name}).filter(v=>v!==void 0),m.value=o.value.departments.map(({name:v})=>{var x;return(x=T.value.find(p=>v===p.name))==null?void 0:x.name}).filter(v=>v!==void 0),y.value=o.value.lab_locations.map(({name:v})=>{var x;return(x=L.value.find(p=>v===p.name))==null?void 0:x.name}).filter(v=>v!==void 0)),P.value&&(console.error(P.value),D.value=!1)},ge=async()=>{C.value=!0;const j=m.value?m.value.map(t=>{var g;return(g=T.value.find(f=>t===f.name))==null?void 0:g.id}).filter(t=>t!==void 0).map(Number):[],o=n.value?n.value.map(t=>{var g;return(g=w.value.find(f=>t===f.name))==null?void 0:g.id}).filter(t=>t!==void 0):[],P=y.value?y.value.map(t=>{var g;return(g=L.value.find(f=>t===f.name))==null?void 0:g.id}).filter(t=>t!==void 0).map(Number):[],z={route:`${B.users}/${u.data.id}`,method:"PUT",token:`${I.value}`,body:{person:{first_name:d.value.first_name,middle_name:d.value.middle_name,last_name:d.value.last_name,sex:d.value.sex,date_of_birth:d.value.date_of_birth},user:{username:d.value.username,old_password:d.value.old_password,password:d.value.new_password},roles:o,departments:j,lab_locations:P}},{data:v,error:x,pending:p}=await G(z);C.value=p,v.value&&(M(),N.success("User updated successfully!"),C.value=!1,S("update",!0)),x.value&&(console.error(x.value),M(),N.error(Pe),C.value=!1)};return(j,o)=>{const P=ve,z=De,v=E("FormKit"),x=Ue,p=he;return k(),q("div",null,[e("div",null,[s(P,{text:"Edit",color:"primary",icon:a(r),click:_e,loading:a(D)},null,8,["icon","loading"])]),s(a(pe),{appear:"",show:a(U),as:"template"},{default:c(()=>[s(a(de),{as:"div",onClose:M,class:"relative z-10"},{default:c(()=>[s(a(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>o[10]||(o[10]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),J(e("div",wt,[s(z)],512),[[re,a(D)]]),J(e("div",kt,[e("div",$t,[s(a(W),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[s(a(ce),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",Ct,[s(a(ue),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>o[11]||(o[11]=[e("img",{src:we,class:"w-8 h-8 mr-2",alt:"person-icon"},null,-1),Q(" Edit user ")])),_:1}),e("button",{onClick:M},[s(a(me),{class:"w-5 h-5"})])]),s(v,{type:"form","submit-label":"Update",onSubmit:ge,actions:!1},{default:c(()=>[e("div",Dt,[e("div",Ut,[s(v,{type:"text",label:"Username",modelValue:a(d).username,"onUpdate:modelValue":o[0]||(o[0]=t=>a(d).username=t),validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Username must contain only letters and spaces"}},null,8,["modelValue"]),s(v,{type:"text",label:"First name",modelValue:a(d).first_name,"onUpdate:modelValue":o[1]||(o[1]=t=>a(d).first_name=t),validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters and spaces"}},null,8,["modelValue"])]),e("div",Vt,[s(v,{type:"text",label:"Middle name",modelValue:a(d).middle_name,"onUpdate:modelValue":o[2]||(o[2]=t=>a(d).middle_name=t)},null,8,["modelValue"]),s(v,{type:"text",label:"Last name",modelValue:a(d).last_name,"onUpdate:modelValue":o[3]||(o[3]=t=>a(d).last_name=t),validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters and spaces"}},null,8,["modelValue"])]),s(v,{type:"group"},{default:c(()=>[e("div",At,[e("div",St,[s(v,{type:"password",label:"New password",name:"password",modelValue:a(d).new_password,"onUpdate:modelValue":o[4]||(o[4]=t=>a(d).new_password=t),"validation-visibility":"live"},null,8,["modelValue"])]),e("div",Et,[s(v,{type:"password",label:"Confirm new password",name:"password_confirm",validation:a(d).new_password&&"required|confirm","validation-label":"Password confirmation","validation-visibility":"live"},null,8,["validation"])])])]),_:1}),e("div",Tt,[o[14]||(o[14]=e("label",{class:"mr-5 font-medium text-lg"},"Sex",-1)),e("label",It,[J(e("input",{required:"","onUpdate:modelValue":o[5]||(o[5]=t=>a(d).sex=t),type:"radio",value:"M",name:"gender",class:"w-4 h-4 rounded-full bg-sky-500 border-sky-800 text-sky-500 focus:ring-sky-800"},null,512),[[ie,a(d).sex]]),o[12]||(o[12]=e("span",{class:"ml-2"},"Male",-1))]),e("label",Pt,[J(e("input",{required:"","onUpdate:modelValue":o[6]||(o[6]=t=>a(d).sex=t),type:"radio",value:"F",name:"gender",class:"w-4 h-4 rounded-full bg-sky-500 border-sky-800 text-sky-500 focus:ring-sky-800"},null,512),[[ie,a(d).sex]]),o[13]||(o[13]=e("span",{class:"ml-2"},"Female",-1))])]),s(x,{label:"Select Role(s)","items-selected":a(n),"onUpdate:itemsSelected":o[7]||(o[7]=t=>R(n)?n.value=t:null),items:a(h),mode:"tags"},null,8,["items-selected","items"]),s(x,{label:"Select Laboratory Location(s)","items-selected":a(y),"onUpdate:itemsSelected":o[8]||(o[8]=t=>R(y)?y.value=t:null),items:a(A),mode:"tags"},null,8,["items-selected","items"]),s(x,{label:"Select Lab Section(s)","items-selected":a(m),"onUpdate:itemsSelected":o[9]||(o[9]=t=>R(m)?m.value=t:null),items:a($),mode:"tags"},null,8,["items-selected","items"])]),e("div",qt,[s(p,{type:"button",click:()=>{},text:"Clear form"}),s(P,{loading:a(C),type:"submit",click:()=>{},color:"success",icon:a(_),text:"Save Changes"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])],512),[[re,!a(D)]])]),_:1})]),_:1},8,["show"])])}}}),Ft={components:{TransitionRoot:pe,TransitionChild:W,Dialog:de,DialogPanel:ce,DialogTitle:ue,XMarkIcon:me,ExclamationTriangleIcon:Be},data(){return{show:!1,disableIcon:Oe,loading:!1,reason:"",cookie:ne("token"),details:{id:"",username:"",first_name:"",last_name:"",middle_name:"",sex:"",date_of_birth:"",lab_locations:new Array,roles:new Array,departments:new Array}}},props:{data:{type:Object,required:!0}},methods:{async init(){this.loading=!0;const V={route:`${B.users}/${this.data.id}`,method:"GET",token:`${this.cookie}`},{data:l,error:u,pending:U}=await G(V);this.loading=U,l.value&&(this.details=l.value,this.loading=!1,this.handleDialog()),u.value&&(console.error(u.value),this.loading=!1)},async deleteData(V){this.loading=!0;const l={route:`${B.users}/${V}`,method:"DELETE",token:`${this.cookie}`},{pending:u,error:U,data:r}=await G(l);this.loading=u,r.value&&(this.handleDialog(),oe().$toast.success(`${r.value.message}`),this.loading=!1,this.$emit("update",!0),this.reason=""),U.value&&(console.log(r.value),this.loading=!1)},async activate(V){this.loading=!0;const l={route:`${B.users}/activate/${V}`,method:"PUT",token:`${this.cookie}`,body:{retired_reason:this.reason}},{pending:u,error:U,data:r}=await G(l);this.loading=u,r.value&&(this.handleDialog(),oe().$toast.success(`${r.value.message}`),this.loading=!1,this.$emit("update",!0),this.reason=""),U.value&&(console.log(r.value),this.loading=!1)},handleDialog(){this.show=!this.show}}},Rt={key:0},Mt={key:1},jt={class:"fixed inset-0 overflow-y-auto"},Bt={class:"flex min-h-full items-center justify-center p-4 text-center"},Gt={class:"border-b px-3 py-3 flex items-center justify-between"},Nt={class:"mt-2 space-y-3 px-5"},zt={class:"rounded px-2 py-2"},Ot={class:"font-semibold text-red-500"},Zt={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Ht(V,l,u,U,r,_){const m=ve,$=E("TransitionChild"),T=E("ExclamationTriangleIcon"),L=E("DialogTitle"),A=E("XMarkIcon"),y=E("FormKit"),I=he,h=E("DialogPanel"),w=E("Dialog"),n=E("TransitionRoot");return k(),q("div",null,[e("div",null,[u.data.is_active?(k(),q("div",Rt,[s(m,{click:_.init,color:"error",text:"Disable",icon:r.disableIcon},null,8,["click","icon"])])):Y("",!0),u.data.is_active?Y("",!0):(k(),q("div",Mt,[s(m,{click:_.init,color:"success",text:"Enable",icon:r.disableIcon},null,8,["click","icon"])]))]),s(n,{appear:"",show:r.show,as:"template"},{default:c(()=>[s(w,{as:"div",class:"relative z-10"},{default:c(()=>[s($,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>l[3]||(l[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",jt,[e("div",Bt,[s($,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[s(h,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",Gt,[s(L,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:c(()=>[s(T,{class:"h-5 w-5 mr-2"}),Q(" "+H(u.data.is_active?"Confirm disable":"Confirm activate"),1)]),_:1}),e("button",{onClick:l[0]||(l[0]=(...C)=>_.handleDialog&&_.handleDialog(...C))},[s(A,{class:"w-5 h-5"})])]),s(y,{type:"form","submit-label":"Update",onSubmit:l[2]||(l[2]=C=>u.data.is_active?_.deleteData(u.data.id):_.activate(u.data.id)),actions:!1},{default:c(({value:C})=>[e("div",Nt,[e("div",zt,[Q(" Do you want to "+H(u.data.is_active?"disable":"activate")+" ",1),e("span",Ot,H(u.data.username),1),l[4]||(l[4]=Q(" account? Note that once this action is completed, it can not be undone "))]),s(y,{type:"textarea",label:"Reason",validation:"required",modelValue:r.reason,"onUpdate:modelValue":l[1]||(l[1]=D=>r.reason=D)},null,8,["modelValue"])]),e("div",Zt,[s(I,{click:_.handleDialog,type:"button",text:"Cancel"},null,8,["click"]),s(m,{loading:r.loading,type:"submit",click:()=>{},color:"success",icon:r.disableIcon,text:"Continue"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Kt=Ce(Ft,[["render",Ht]]),Xt=()=>{const V=i([{text:"id",value:"id",sortable:!0},{text:"username",value:"username",sortable:!0},{text:"full name",value:"fullname",sortable:!0},{text:"sex",value:"sex",sortable:!0},{text:"actions",value:"actions"}]),l=i([{name:"Home",link:"/home"},{name:"Access Controls",link:"#"}]);return{HEADERS:V,PAGES:l}},Yt={class:"py-5 px-5"},Jt={class:"flex items-center justify-between py-5"},Qt={class:"text-2xl font-semibold"},Wt={class:"flex justify-end w-full px-2 py-2 mb-2"},ea={class:"py-2 flex items-center space-x-2"},xa=be({__name:"user-accounts",setup(V){ze({title:`${Ne.name.toUpperCase()} - User Accounts`});const l=i("List of users"),u=Xt(),U=u.HEADERS.value,r=i([]),_=ne("token"),m=i(!1),$=i(""),T=i(""),L=u.PAGES.value,A=i(0),y=i({page:1,rowsPerPage:25,sortBy:"name"}),I=qe(()=>r.value.map(n=>({id:n.id,is_active:n.is_active,username:n.username.charAt(0).toUpperCase()+n.username.slice(1),fullname:`${n.first_name} ${n.last_name}`,sex:n.sex})));async function h(){m.value=!0;const{page:n,rowsPerPage:C}=y.value,D={route:`${B.users}?page=${n}&per_page=${C}&search=${$.value}`,method:"GET",token:`${_.value}`},{data:S,error:N,pending:O}=await G(D);m.value=O,S.value&&(r.value=S.value.data,m.value=!1,A.value=S.value.meta.total_count),N.value&&(console.error(N.value),m.value=!1)}const w=n=>{typeof n=="object"&&(y.value=n)};return $e($,()=>{h()}),$e(y,()=>{h()}),Le(()=>{h()}),(n,C)=>{const D=Ee,S=lt,N=Fe,O=ht,d=Lt,M=Kt,K=Ge;return k(),q("div",Yt,[s(D,{pages:a(L)},null,8,["pages"]),e("div",Jt,[e("h3",Qt,H(a(l)),1),("usePermissions"in n?n.usePermissions:a(le))().can.manage("users")?(k(),se(S,{key:0,onUpdate:h})):Y("",!0)]),e("div",Wt,[s(N,{search:a($),"onUpdate:search":C[0]||(C[0]=F=>R($)?$.value=F:null)},null,8,["search"])]),("usePermissions"in n?n.usePermissions:a(le))().can.manage("users")?(k(),se(K,{key:0,headers:a(U),data:a(I),loading:a(m),searchField:"username",searchValue:a(T),serverItemsLength:a(A),serverOptions:a(y),onUpdate:w},{actions:c(({item:F})=>[e("div",ea,[("usePermissions"in n?n.usePermissions:a(le))().can.manage("users")?(k(),se(O,{key:0,data:F},null,8,["data"])):Y("",!0),("usePermissions"in n?n.usePermissions:a(le))().can.manage("users")?(k(),se(d,{key:1,data:F,onUpdate:h},null,8,["data"])):Y("",!0),("usePermissions"in n?n.usePermissions:a(le))().can.manage("users")?(k(),se(M,{key:2,data:F,onUpdate:h},null,8,["data"])):Y("",!0)])]),_:1},8,["headers","data","loading","searchValue","serverItemsLength","serverOptions"])):Y("",!0)])}}});export{xa as default};
