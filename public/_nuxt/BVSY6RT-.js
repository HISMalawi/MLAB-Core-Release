import{_ as fe}from"./9st0-0tz.js";import{_ as ye}from"./CzHc6CvN.js";import{b as P,e as C,g as s,d as ge,r as p,a as he,$ as Te,I as Re,u as M,c as E,z as y,a2 as Ee,w as k,o as H,x as O,f as d,h as e,t as T,y as x,j as Y,A as F,q as xe,D as j,L as I,l as Q,E as $e,m as Ae,_ as Se,s as we}from"./DFRCgfJ7.js";import{_ as De}from"./5ffiGmvL.js";import{_ as Me,a as Pe}from"./DgK-omSo.js";import{_ as Ce}from"./DJS9VRo6.js";import{u as Ne,_ as be}from"./B7ujCJfJ.js";import{_ as ke}from"./BA0dDRo1.js";import{_ as Ie}from"./eyEzJQOB.js";import{P as qe}from"./BJWqiItS.js";import{u as Ue}from"./BjeQ_SpI.js";import{u as Oe}from"./DX-fG2iE.js";import{r as Ye}from"./CJomWIoV.js";import{r as Fe}from"./BS_3Esgb.js";import"./_gKYxzJq.js";import"./ETY0v-Ty.js";import"./DPgPQj3l.js";import"./DgQpkSfa.js";import"./Ddj-PgKU.js";import"./BYyprm3K.js";import"./w-YgZM2H.js";import"./BCeJtOqG.js";import"./D8DjzwVZ.js";function je(Z,g){return P(),C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[s("path",{"fill-rule":"evenodd",d:"M3 6.75A.75.75 0 0 1 3.75 6h16.5a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 6.75ZM3 12a.75.75 0 0 1 .75-.75H12a.75.75 0 0 1 0 1.5H3.75A.75.75 0 0 1 3 12Zm0 5.25a.75.75 0 0 1 .75-.75h16.5a.75.75 0 0 1 0 1.5H3.75a.75.75 0 0 1-.75-.75Z","clip-rule":"evenodd"})])}const Ve={class:"px-5 py-5"},Le={class:"flex items-center py-5"},Be={class:"text-2xl font-semibold uppercase"},Ge={class:"w-full flex items-center justify-between mb-5"},ze={class:"w-full flex items-center space-x-3"},He={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Qe={class:"w-72 ml-2"},Ze={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Ke={class:"w-48 ml-2"},Je={class:"flex justify-end py-2"},Xe={class:"bg-gray-100 rounded flex items-center text-zinc-500"},We={class:"w-48"},et={class:"w-48"},tt={class:"border rounded print-container mt-5"},rt={class:"w-full rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},at={class:"mt-3 px-5"},st={class:"font-medium mb-2"},ot={class:"font-normal"},nt={key:0,id:"print-container"},lt=["onClick"],it=["onClick"],ct=["onClick"],ut=["onClick"],dt=["onClick"],mt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},pt=ge({__name:"user-statistics",setup(Z){Oe({title:`${qe.name.toUpperCase()} - User Statistics Report`});const{loading:g,executeCancellableRequest:K,cancelRequest:J}=Ne(),V=p(""),X=p(""),W=Fe,$=p(new Array),L=he("token"),N=p({page:1,rowsPerPage:20,sortBy:"name"}),B=p(0),l=p([]),ee=p("User Statistics Report"),G=p([]),q=Ue(),h=Te(),_=Re(),m=p({name:_.query["report-type"]||"select report type"}),{$toast:te}=M(),u=p({name:"Select and search for user..."}),re=p([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),ae=p([{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}]),v=E(()=>$.value.map(t=>({...t,created_date:y(t.created_date).format("DD/MMM/YYYY"),age:Ee(t.date_of_birth)}))),se=E(()=>{const t=m.value,r=()=>v.value.length>0&&t.name=="Summary"?v.value.map(a=>({USER:a.user,"TESTS COMPLETED":a.tests_completed.count,"TESTS RECEIVED":a.tests_received.count,"SPECIMEN COLLECTED":a.specimen_collected.count,"SPECIMEN REJECTED":a.specimen_rejected.count,"TESTS AUTHORIZED":a.tests_authorized.count})):[],i=()=>v.value.length>0&&t.name=="Patient Registry"?v.value.map(a=>({"PATIENT NO":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,AGE:a.age,SEX:a.sex})):[],n=()=>v.value.length>0&&t.name=="Tests Registry"?v.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":`${a.client.first_name} ${a.client.last_name}`,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[],c=()=>v.value.length>0&&t.name=="Specimen Registry"?v.value.map(a=>({"SPECIMEN NUMBER":a.id,"PATIENT NAME":a.patient_name,"PATIENT NUMBER":a.patient_no,"DATE REGISTERED":a.created_date})):[],R=()=>v.value.length>0&&t.name=="Tests Performed"?v.value.map(a=>({"TEST TYPE":a.test_type_name,"PATIENT NUMBER":a.id,"PATIENT NAME":a.patient_name,SPECIMEN:a.specimen_type,"DATE REGISTERED":a.created_date})):[];return{Summary:r(),"Patient Registry":i(),"Tests Registry":n(),"Specimen Registry":c(),"Tests Performed":R()}[t.name]}),U=E(()=>G.value.map(t=>({id:t.id,name:`${t.first_name} ${t.last_name}`}))),oe=E(()=>{const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},r=m.value.name.toLowerCase();return t[r]||""}),ne=E(()=>{const t={summary:new Array({text:"Name",value:"user"},{text:"Tests Received",value:"tests_received"},{text:"Specimen Collected",value:"specimen_collected"},{text:"Specimen Rejected",value:"specimen_rejected"},{text:"Tests Performed",value:"tests_completed"},{text:"Tests Authorized",value:"tests_authorized"}),"specimen registry":new Array({text:"Specimen Number",value:"id"},{text:"Name",value:"specimen"},{text:"Patient Number",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Date Registered",value:"created_date"}),"tests registry":new Array({text:"Test Type",value:"test_type_name"},{text:"Patient Number",value:"client.id"},{text:"Patient Name",value:"actions"},{text:"Specimen",value:"specimen_type"},{text:"Date Registered",value:"created_date"}),"patients registry":new Array({text:"Patient Number",value:"id"},{text:"Name",value:"actions"},{text:"Gender",value:"sex"},{text:"Age",value:"age"},{text:"Date Registered",value:"created_date"}),"tests performed":new Array({text:"Test Id",value:"test_id"},{text:"Test Type",value:"test_type"},{text:"Patient No",value:"patient_no"},{text:"Patient Name",value:"patient_name"},{text:"Accession Number",value:"accession_number"},{text:"Date Registered",value:"created_date"})},r=m.value.name.toLowerCase();return t[r]||new Array}),S=E(()=>l.value[0]?y(l.value[0]).format("YYYY-MM-DD"):""),w=E(()=>l.value[1]?y(l.value[1]).format("YYYY-MM-DD"):"");async function b(){if(z(m.value)=="")M().$toast.warning("Please select a report type!");else{g.value=!0;const{page:t,rowsPerPage:r}=N.value;let i=`from=${S.value}&to=${w.value}&report_type=${z(m.value).toLocaleLowerCase()}&page=${t}&limit=${r}&user=${u.value.id}&report_id=${_.query.report_id||""}`;const n={route:`${Q.aggregateReports}user_statistics?${i}`,method:"GET",token:`${L.value}`},{data:c,error:R,pending:A}=await K(n);g.value=A,c.value&&(g.value=!1,$.value=c.value.data.tests,B.value=c.value.data.metadata.total_count,le(c.value.data.report_id),c.value.data.tests.length>0?M().$toast.success("Report data generated successfully"):M().$toast.warning(`No data found in period ${S.value} - ${w.value}`)),R.value&&(g.value=!1,console.error(R.value),M().$toast.error($e))}}const le=t=>{const i={...h.currentRoute.value.query,report_id:t};h.replace({query:i}).catch(n=>{console.error("Failed to replace route:",n)})};async function ie(){const{data:t,error:r}=await Ae({route:`${Q.users}?page=1&per_page=2000`,method:"GET",token:`${L.value}`});t.value&&(G.value=t.value.data,U.value.some(n=>n.name=="All")||U.value.unshift({id:0,name:"All"})),r.value&&console.error(r.value)}const D=(t,r,i,n)=>{i!==0&&n!==""?h.push(`/reports/${n}?origin=aggregate&type=user-statistics-report&from=${S.value}&to=${w.value}&test=${t} - ${r}&department=&count=${i}`):te.warning("No data found!")};function z(t){return t.name=="select report type"?"":t.name}function ce(t){typeof t=="object"&&(N.value=t)}function ue(t){V.value=t,X.value=t,b()}k(()=>N.value,(t,r)=>{t!=r&&b()}),k(()=>m.value,(t,r)=>{if(t!==r){$.value=[];const n={...h.currentRoute.value.query,"report-type":t.name,report_id:""};h.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}}),k(()=>u.value,(t,r)=>{if(t!==r){$.value=[];const n={...h.currentRoute.value.query,user:t.name,report_id:""};h.replace({query:n}).catch(c=>{console.error("Failed to replace route:",c)})}}),k(l,(t,r)=>{if(t!==r&&t.length>0){const i=l.value[0]?y(l.value[0]).format("YYYY-MM-DD"):"",n=l.value[1]?y(l.value[1]).format("YYYY-MM-DD"):"";if(i||n){const R={...h.currentRoute.value.query,...i&&{from:i},...n&&{to:n},report_id:""};h.replace({query:R}).catch(A=>{console.error("Failed to replace route:",A)})}}},{deep:!0});const de=E(()=>_.query.to!==void 0&&_.query.from!==void 0&&_.query.user!==void 0?(l.value=[new Date(String(_.query.from)),new Date(String(_.query.to))],u.value.name=`${_.query.user}`,_.query.to!==""&&_.query.from!==""&&_.query.user!==""):!1);return H(()=>{de.value?b():g.value=!1}),H(async()=>{await ie()}),(t,r)=>{const i=fe,n=O("datepicker"),c=ye,R=Se,A=O("FormKit"),a=De,me=O("excel"),pe=Pe,_e=Ce,ve=be;return P(),C("div",Ve,[d(i,{pages:e(re)},null,8,["pages"]),s("div",Le,[r[4]||(r[4]=s("img",{src:ke,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),s("h3",Be,T(e(ee)),1)]),s("div",Ge,[d(A,{type:"form","submit-label":"Update",onSubmit:b,actions:!1,id:"submitForm"},{default:x(({value:o})=>[s("div",ze,[s("div",He,[d(e(Ye),{class:"w-5 h-5 mr-2"}),r[5]||(r[5]=Y(" Filter By Date Range ")),s("div",Qe,[d(n,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(l),"onUpdate:modelValue":r[0]||(r[0]=f=>F(l)?l.value=f:null),format:"dd/MM/yyyy",maxDate:new Date},null,8,["modelValue","maxDate"])])]),s("div",Ze,[d(e(je),{class:"w-5 h-5 mr-2 my-2.5"}),r[6]||(r[6]=Y(" Report Type ")),s("div",Ke,[d(c,{class:"bg-white",items:e(ae),modelValue:e(m),"onUpdate:modelValue":r[1]||(r[1]=f=>F(m)?m.value=f:null)},null,8,["items","modelValue"])])]),s("div",Je,[s("div",Xe,[s("div",We,[d(c,{class:"bg-white rounded",isSearchable:!0,items:e(U),modelValue:e(u),"onUpdate:modelValue":r[2]||(r[2]=f=>F(u)?u.value=f:null),onUpdate:ue},null,8,["items","modelValue"])]),e(u).name!=null&&e(u).name!=="Select and search for user..."?(P(),C("button",{key:0,type:"button",onClick:r[3]||(r[3]=f=>u.value={name:"Select and search for user..."})},[d(e(xe),{class:"w-5 h-5 mx-2 my-2.5"})])):j("",!0)])]),s("div",et,[d(R,{type:"submit",color:"primary",text:"Generate Report",icon:e(W),click:()=>{},loading:e(g)},null,8,["icon","loading"])])])]),_:1}),d(me,{class:"btn btn-default",header:[`USER STATISTICS ${e(m).name.toUpperCase()} REPORT`,`PERIOD FROM ${e(y)(e(S)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(I))} TO ${e(y)(e(w)).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(I))}`,e(q).details.name,e(q).details.address,e(q).details.phone],data:e(se),worksheet:"report-work-sheet",name:`user_statistics_report_${e(m).name.toLowerCase().split(" ").join("_")}_${e(y)(e(S)).format("DD_MM_yyyy")}_to_${e(y)(e(w)).format("DD_MM_yyyy")}.xls`},{default:x(()=>[d(a,{text:"Export Excel"})]),_:1},8,["header","data","name"])]),s("div",tt,[s("div",rt,[r[7]||(r[7]=s("div",{class:"flex flex-col space-y-2"},[s("img",{src:Ie,alt:"app-logo",class:"w-24 h-24 object-cover"}),s("h3",{class:"text-xl font-semibold"},"USER STATISTICS REPORT")],-1)),d(pe)]),s("div",at,[s("h3",st,[r[8]||(r[8]=Y(" Tests Performed Period: ")),s("span",ot,T(e(l).length>0&&e(l)[0].toString()!=""?e(y)(e(l)[0].toString()).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(I)):"")+" - "+T(e(l).length>0&&e(l)[1].toString()!=""?e(y)(e(l)[1].toString()).format("DATE_FORMAT"in t?t.DATE_FORMAT:e(I)):""),1)])]),e($).length>0?(P(),C("div",nt,[d(_e,{headers:e(ne),data:e(v),serverItemsLength:e(B),serverOptions:e(N),loading:e(g),"search-field":e(oe),"search-value":e(V),onUpdate:ce},{actions:x(({item:o})=>[s("td",null,T(e(m).name.toLowerCase()=="patients registry"?`${o.first_name}
                            ${o.middle_name} ${o.last_name}`:`${o.client.first_name}
                            ${o.client.middle_name}
                            ${o.client.last_name}`),1)]),"item-tests_received":x(({item:o})=>[s("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>D("Tests Received",e(u).name,o.tests_received.count,o.tests_received.associated_ids)},T(o.tests_received.count),9,lt)]),"item-specimen_collected":x(({item:o})=>[s("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>D("Tests Received",e(u).name,o.specimen_collected.count,o.specimen_collected.associated_ids)},T(o.specimen_collected.count),9,it)]),"item-specimen_rejected":x(({item:o})=>[s("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>D("Tests Received",e(u).name,o.specimen_rejected.count,o.specimen_rejected.associated_ids)},T(o.specimen_rejected.count),9,ct)]),"item-tests_completed":x(({item:o})=>[s("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>D("Tests Received",e(u).name,o.tests_completed.count,o.tests_completed.associated_ids)},T(o.tests_completed.count),9,ut)]),"item-tests_authorized":x(({item:o})=>[s("td",{class:"hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:f=>D("Tests Received",e(u).name,o.tests_authorized.count,o.tests_authorized.associated_ids)},T(o.tests_received.count),9,dt)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value"])])):j("",!0),d(ve,{condition:e(g),cancelReportGeneration:()=>e(J)()},null,8,["condition","cancelReportGeneration"]),e($).length==0&&!e(g)?(P(),C("div",mt,r[9]||(r[9]=[s("img",{src:Me,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),s("p",null,"Data not found, please generate report",-1)]))):j("",!0)])])}}}),Ut=we(pt,[["__scopeId","data-v-1eb5c2a5"]]);export{Ut as default};
