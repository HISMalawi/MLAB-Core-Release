import{_ as K}from"./B0LaQ5Ul.js";import{_ as Q}from"./BfF5L8Si.js";import{d as W,r as v,a as X,u as Z,c as R,o as ee,m as te,b as n,e as l,f as d,h as t,g as e,t as p,p as C,y as F,n as oe,F as y,j as k,s as S,i as se,v as re,_ as ae,k as ne}from"./JBsVKZmo.js";import{_ as le}from"./DZH9Y4M7.js";import{_ as de}from"./C1Kkhh8H.js";import{_ as ie}from"./us_p91AA.js";import{u as ce}from"./B76wTae4.js";import{S as P,d as T,e as me}from"./D__F487H.js";import{_ as pe}from"./B7V4hso6.js";import{_ as ue}from"./C-QZrv9j.js";import{_ as _e}from"./BW_TZ2bL.js";import{h as b,e as V,f as A}from"./CZ6eCgXt.js";import{F as fe}from"./DJpjRKvH.js";import{u as he}from"./Bfp68H6u.js";import{P as ve}from"./CrgnIM47.js";import{r as be}from"./MXsTUCyV.js";import{r as ye}from"./jGqCdn13.js";import"./WJywbfjK.js";import"./BXOjIDzI.js";import"./DAHdFzVE.js";import"./C61IPztP.js";import"./B-WBCWpg.js";import"./Bvy4dQbz.js";import"./xplkPwj7.js";import"./DXJOBCvN.js";import"./rvUhT-B_.js";import"./5DhtzSAE.js";import"./B_mMcxuE.js";import"./BhnZKBDU.js";import"./n4_or2sV.js";import"./T519L7Bv.js";const ge={class:"px-5 py-5"},xe=e("img",{src:pe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),we={class:"w-full flex items-center justify-between"},ke={class:"flex items-center space-x-3"},De={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Re={class:"w-72 ml-2"},Ce={class:"w-44"},Ee={class:"flex items-center space-x-3"},$e={class:"mt-3"},je={class:"text-lg font-semibold mb-2"},Me={class:"text-normal font-normal"},Fe={class:"border rounded"},Se={class:"flex items-center justify-between px-5 py-5 border-b"},Pe=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ue,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1),Te={key:0,class:"mt-10 print-container",id:"print-container"},Ve={class:"w-full border border-dotted rounded overflow-x-auto"},Ae={class:"bg-gray-50 border-b border-dotted rounded-t"},Le=e("th",{class:"border-r"},null,-1),Ye=["colspan"],Be=e("th",null,"TOTAL",-1),Ne=e("td",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1),qe=e("td",{class:"border-r border-t border-b border-dotted px-2 py-2"},null,-1),Ge={class:"border-r border-b border-dotted px-2 py-2"},Oe={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},Ue={class:"w-full items-center flex flex-col space-y-2 my-10"},He=e("p",null,[C(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),ze={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Je=e("img",{src:_e,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),Ie=e("p",null,"Please generate report data to preview the report",-1),Ke=[Je,Ie],Qe="Rejected Samples Report",jt=W({__name:"rejected-samples",setup(We){ce({title:`${ve.name.toUpperCase()} - Rejected Samples Report`});const L=v([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),E=v([]),h=v({name:P}),$=X("token"),Y=he(),i=v(["",""]),{$toast:g}=Z(),c=v(!1),B=()=>{i.value=new Array("","")},m=v({result:[],value:void 0,wards:[]}),j=R(()=>m.value.result.map(r=>{const o={};r.test_types.forEach(s=>{o[s.name]||(o[s.name]={}),o[s.name][s.ward]||(o[s.name][s.ward]=0),o[s.name][s.ward]+=s.count});const a=Object.keys(o).map(s=>({name:s,wards:o[s]}));return{name:r.name,testTypes:a}})),N=(r,o)=>{const a=j.value.find(u=>u.name===r),s=a==null?void 0:a.testTypes.find(u=>u.name===o);return s?Object.values(s.wards).reduce((u,D)=>u+D,0):0};async function q(){const r={route:V.departments,method:"GET",token:`${$.value}`},{data:o,error:a}=await A(r);o.value&&(E.value=o.value),a.value&&console.error(a.value)}const x=R(()=>i.value[0]?b(i.value[0]).format("YYYY-MM-DD"):""),w=R(()=>i.value[1]?b(i.value[1]).format("YYYY-MM-DD"):"");async function G(){if(O())g.warning("Please select a department");else{c.value=!0;const r={route:`${V.aggregateReports}rejected?from=${x.value}&to=${w.value}&department=${h.value.id}`,method:"GET",token:`${$.value}`},{data:o,error:a,pending:s}=await A(r);c.value=s,o.value&&(c.value=!1,m.value=o.value.data,o.value.data.result.length>0?g.success("Report generated successfully!"):g.warning("Data not found within the specified period")),a.value&&(console.error(a.value),c.value=!1,g.error(me))}}function O(){return h.value.name==P}return ee(()=>{q()}),(r,o)=>{const a=K,s=te("datepicker"),u=Q,D=ae,U=le,H=de,z=ie,J=ne;return n(),l("div",ge,[d(a,{pages:t(L)},null,8,["pages"]),e("div",{class:"flex items-center py-5"},[xe,e("h3",{class:"text-2xl font-semibold uppercase"},p(Qe))]),e("div",we,[e("div",ke,[e("div",De,[d(t(be),{class:"w-5 h-5 mr-2"}),C(" Filter By Date Range "),e("div",Re,[d(s,{onCleared:B,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(i),"onUpdate:modelValue":o[0]||(o[0]=_=>F(i)?i.value=_:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),e("div",Ce,[d(u,{items:t(E),modelValue:t(h),"onUpdate:modelValue":o[1]||(o[1]=_=>F(h)?h.value=_:null)},null,8,["items","modelValue"])]),d(D,{color:"primary",text:"Generate Report",icon:t(ye),click:()=>G(),loading:t(c)},null,8,["icon","click","loading"])]),e("div",Ee,[d(U,{printSmallLabel:!1}),d(t(fe),{element:"print-container",filename:`rejected_samples_report(${t(h).name.toLowerCase().split(" ").join("_")})_from_${t(b)(t(x)).format("DD_MM_yyyy")}_to_${t(b)(t(w)).format("DD_MM_yyyy")}_for_${t(Y).details.name.toLowerCase().split(" ").join("_")}`},{default:oe(()=>[d(H,{text:"Export Excel"})]),_:1},8,["filename"])])]),e("div",$e,[e("h3",je,[C(" Tests Performed Period: "),e("span",Me,p(t(x)!=""?t(b)(t(x)).format("dateFormat"in r?r.dateFormat:t(T)):"")+" - "+p(t(w)!=""?t(b)(t(w)).format("dateFormat"in r?r.dateFormat:t(T)):""),1)])]),e("div",Fe,[e("div",Se,[Pe,d(z)]),t(m).result.length>0&&!t(c)?(n(),l("div",Te,[e("table",Ve,[(n(!0),l(y,null,k(t(j),(_,I)=>(n(),l(y,{key:I},[e("thead",Ae,[e("tr",null,[Le,e("th",{colspan:t(m).wards.length,class:"px-5 py-2 border-r uppercase"},p(_.name),9,Ye),Be])]),e("tbody",null,[e("tr",null,[Ne,(n(!0),l(y,null,k(t(m).wards,f=>(n(),l("td",{key:f,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},p(f),1))),128)),qe]),(n(!0),l(y,null,k(_.testTypes,f=>(n(),l("tr",{key:f.name},[e("td",Ge,p(f.name),1),(n(!0),l(y,null,k(t(m).wards,M=>(n(),l("td",{key:M,class:"border-r border-b border-dotted px-2 py-2"},p(f.wards[M]||0),1))),128)),e("td",Oe,p(N(_.name,f.name)),1)]))),128))])],64))),128))])])):S("",!0),se(e("div",Ue,[d(J),He],512),[[re,t(c)]]),t(m).wards.length==0&&t(m).result.length==0&&!t(c)?(n(),l("div",ze,Ke)):S("",!0)])])}}});export{jt as default};
