import{d as ae,r as D,b as a,H as De,y as L,f as x,h as o,Y as we,p as ee,g as t,G as Ce,S as Oe,n as $e,a as Te,$ as Ee,I as Ae,u as V,c as M,z as O,U as te,w as re,o as Me,x as oe,e as l,t as f,j as U,A as se,L as ne,F as y,k,D as N,ak as je,al as Se,am as Pe,l as Le,_ as qe}from"./BLMYYBub.js";import{_ as Ne}from"./DeHqjJH7.js";import{_ as Ye}from"./BOt9Lm4e.js";import{_ as Be}from"./Bxl2pUFk.js";import{_ as Ve}from"./BC1wyGKt.js";import{_ as Ue,a as Fe}from"./DrZlfu5Z.js";import{u as ze,_ as Ge}from"./CXkY3hoU.js";import{_ as Ie}from"./CaWMponf.js";import{_ as We}from"./Gj1XiySU.js";import{P as He}from"./CM4UxiDe.js";import{u as Je}from"./B4BIo1yJ.js";import{u as Qe}from"./CfmpkH2n.js";import{r as Ke}from"./BZ-nU4m4.js";import{r as Xe}from"./Cbp5S_6y.js";import"./sNlKP72R.js";import"./DliR-cc7.js";import"./BlFheT0q.js";import"./IJCDyQty.js";import"./cHOIL3XF.js";import"./CkgugtXF.js";import"./BpACQbkq.js";import"./OnYuLN16.js";import"./DDt9YMgi.js";import"./Rq-tLeC0.js";import"./9NBlOp5g.js";const Ze={class:"fixed inset-0 overflow-y-auto top-0"},et={class:"flex min-h-full items-start justify-end top-0 p-4 text-center"},tt={class:"flex items-center space-x-2"},rt=ae({__name:"DownloadingDialog",setup(le,{expose:q}){const j=D(!1);function b(){j.value=!1}function F(){j.value=!0}return q({openModal:F,closeModal:b}),(w,S)=>{const $=$e;return a(),De(o(Oe),{appear:"",show:o(j),as:"template"},{default:L(()=>[x(o(we),{as:"div",onClose:b,class:"relative z-10"},{default:L(()=>[x(o(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:L(()=>S[0]||(S[0]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-50"},null,-1)])),_:1}),t("div",Ze,[t("div",et,[x(o(ee),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:L(()=>[x(o(Ce),{class:"w-full max-w-md transform overflow-hidden rounded bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:L(()=>[t("div",tt,[x($),S[1]||(S[1]=t("div",null,[t("h3",{class:"text-xl font-semibold"},"Downloading"),t("p",{class:"text-gray-500"}," Please wait patiently, it may take 1-4 minutes to download the files ")],-1))])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])}}}),ot={class:"px-5 py-5"},st={class:"w-full flex items-center justify-between"},nt={class:"flex items-center space-x-3"},at={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},lt={class:"w-72 ml-2"},it={class:"w-44"},ct={class:"flex items-center space-x-3"},dt={class:"border rounded print-container mt-5"},ut={class:"w-full rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},pt={class:"mt-3 px-5 border-b"},mt={class:"font-medium mb-2"},ft={class:"font-normal"},bt={key:0,class:"overflow-x-auto",id:"print-container"},yt={class:"w-full border border-dotted rounded overflow-x-auto"},vt={class:"w-full"},_t=["colspan"],xt={class:"border-b"},gt={class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},kt={class:"capitalize font-medium px-2 py-2 text-center border-r bg-gray-50"},ht=["onClick"],Rt={class:"px-2 py-2 text-center font-medium"},Dt={key:0,class:"w-full border border-dotted rounded overflow-x-auto mt-10"},wt=["colspan"],Ct={class:"border-t"},Ot={class:"capitalize px-2 py-2 text-center bg-gray-50 border-r"},$t=["onClick"],Tt=["onClick"],Et=["onClick"],At=["onClick"],Mt=["onClick"],jt=["onClick"],St={key:1,class:"w-full py-2 mt-2.5 border-b"},Pt={key:2,class:"w-full border border-dotted rounded overflow-x-auto"},Lt=["colspan"],qt={class:"border-b"},Nt={class:"px-2 py-2 text-center uppercase bg-gray-50 border-b border-t"},Yt={class:"capitalize px-2 py-2 text-center border-r"},Bt=["onClick"],Vt={class:"px-2 py-2 text-center font-bold"},Ut={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Ft={class:"font-medium"},zt="Department Report",yr=ae({__name:"department",setup(le){Qe({title:`${He.name.toUpperCase()} - Department Report`});const q=Je(),j=D(new Array),b=D(new Array("","")),F=()=>{b.value=new Array("","")},w=D({name:"select department"}),S=Te("token"),$=Ee(),C=Ae(),{$toast:z}=V(),{loading:E,executeCancellableRequest:ie,cancelRequest:ce}=ze(),de=D(null),H=D([]),J=D(""),Q=D([]),K=D(),G=D(null),c=D({wards:[],data:[]}),ue=D([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),pe=M(()=>{const{id:s,name:e}=w.value;return s===0||s===void 0?"":e}),Y=M(()=>b.value[0]?O(b.value[0]).format("YYYY-MM-DD"):""),B=M(()=>b.value[1]?O(b.value[1]).format("YYYY-MM-DD"):""),me=M(()=>{const s=[];return c.value.data.length>0&&c.value.data.forEach(e=>{Object.keys(e).forEach(d=>{e[d].forEach(i=>{const p={TEST:i.test_type.toString().toUpperCase(),MONTH:te(d)};c.value.wards.forEach(u=>{p[u.toUpperCase()]=0}),Object.keys(i.ward).forEach(u=>{p[u.toUpperCase()]=i.ward[u].total});const m=Object.values(i.ward).reduce((u,v)=>u+v.total,0);p.total=m,s.push(p)})})}),s}),fe=M(()=>{const s=[];return c.value.critical_values.forEach(e=>{Object.keys(e).forEach(d=>{e[d].forEach(p=>{const m={TEST:d,"CRITICAL VALUE LEVEL":p.critical_value_level};c.value.wards.forEach(u=>{m[u.toUpperCase()]=0}),Object.keys(p.ward).forEach(u=>{m[u.toUpperCase()]=p.ward[u].total}),m.TOTAL=Object.values(p.ward).reduce((u,v)=>u+v.total,0),s.push(m)})})}),s}),be=M(()=>{const s=[];return c.value.blood_bank_products.length>0&&c.value.blood_bank_products.forEach(e=>{Object.keys(e).forEach(d=>{e[d].forEach(i=>{i.ward.forEach(p=>{Object.keys(p).forEach(m=>{const u=p[m];Object.keys(u).forEach(v=>{const h=u[v],I={PRODUCT:d,GENDER:te(i.gender),"AGE RANGE":v,"WARD ":m.toUpperCase(),"TOTAL COUNT":h.total};s.push(I)})})})})})}),s}),ye=async()=>{var s,e,d;(s=G.value)==null||s.openModal();try{const i=[me.value,be.value,fe.value],p=["Department Report","Department - Blood Bank Products Report","Department - Hematology Critical Values Report"];for(let m=0;m<i.length;m++){const u=i[m],v=p[m].toLowerCase().replace(/ /g,"_");H.value=u,J.value=`${v}_${O(Y.value).format("DD_MM_yyyy")}_to_${O(B.value).format("DD_MM_yyyy")}.xls`,Q.value=["LABORATORY DEPARTMENT REPORT",v,`PERIOD FROM ${O(Y.value).format("DD-MM-yyyy")} TO ${O(B.value).format("DD-MM-yyyy")}`,q.details.name,q.details.address,q.details.phone],await je(),(e=K.value)==null||e.click(),await new Promise(h=>setTimeout(h,500))}z.success(Se)}catch(i){console.error("error dowloading reports: ",i),z.error(Pe)}(d=G.value)==null||d.closeModal()};async function X(){if(xe())V().$toast.warning("Please select a department!");else{E.value=!0,c.value={wards:[],data:[]};let s=`from=${Y.value}&to=${B.value}&department=${_e(w.value.name)}&report_id=${C.query.report_id}`;const e={route:`${Le.aggregateReports}/department?${s}`,method:"GET",token:`${S.value}`},{data:d,error:i,pending:p}=await ie(e);E.value=p,d.value&&(E.value=!1,c.value=d.value,ve(d.value.report_id),V().$toast.success("Report generated successfully!")),i.value&&(E.value=!1,console.error(i.value))}}const ve=s=>{const d={...$.currentRoute.value.query,report_id:s};$.replace({query:d}).catch(i=>{console.error("Failed to replace route:",i)})};function _e(s){return s==="select department"||s==="-- select test type --"||s==="-- select test status --"?"":s}function xe(){return w.value.name=="select department"}const A=(s,e,d,i)=>{d!==0&&i!==""?$.push(`/reports/${i}?origin=aggregate&type=department-report&from=${Y.value}&to=${B.value}&test=${s} - ${e}&department=${w.value.name}&count=${d}`):z.warning("No data found for this month")};function Z(s){return c.value.wards.reduce((d,i)=>d+(s.ward[i]?s.ward[i].total:0),0)}function R(s,e,d,i){const m=JSON.parse(JSON.stringify(s[Object.keys(s)[0]])).find(h=>h.gender===e);if(!m)return 0;const u=m.ward.find(h=>Object.keys(h)[0]===d.toLowerCase());if(!u)return 0;const v=u[d.toLowerCase()][i];return v===void 0?0:v.total}function P(s,e,d,i){const m=JSON.parse(JSON.stringify(s[Object.keys(s)[0]])).find(h=>h.gender===e);if(!m)return 0;const u=m.ward.find(h=>Object.keys(h)[0]===d.toLowerCase());if(!u)return 0;const v=u[d.toLowerCase()][i];return v===void 0?0:v.associated_ids}re(b,()=>{const s=b.value[0]?O(b.value[0]).format("YYYY-MM-DD"):"",e=b.value[1]?O(b.value[1]).format("YYYY-MM-DD"):"";if(s||e){const i={...$.currentRoute.value.query,...s&&{from:s},...e&&{to:e}};$.replace({query:i}).catch(p=>{console.error("Failed to replace route:",p)})}},{deep:!0}),re(w,(s,e)=>{if(s!==e){const i={...$.currentRoute.value.query,department:s.name||void 0,report_id:""};$.replace({query:i}).catch(p=>{console.error("Failed to replace route:",p)})}});const ge=M(()=>C.query.to!==void 0&&C.query.from!==void 0&&C.query.department!==void 0?(b.value=[C.query.from,C.query.to],w.value.name=`${C.query.department}`,C.query.to!==""&&C.query.from!==""&&C.query.department!==""):!1);return Me(()=>{ge.value?X():E.value=!1,j.value=V().$metadata.departments}),(s,e)=>{const d=rt,i=Ne,p=oe("datepicker"),m=Ye,u=qe,v=Be,h=oe("excel"),I=Ve,ke=Fe,he=Ge;return a(),l("div",ot,[x(d,{ref_key:"downloadModalRef",ref:G},null,512),x(i,{pages:o(ue)},null,8,["pages"]),t("div",{class:"flex items-center py-5"},[e[2]||(e[2]=t("img",{src:Ie,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),t("h3",{class:"text-2xl font-semibold uppercase"},f(zt))]),t("div",st,[t("div",nt,[t("div",at,[x(o(Ke),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=U(" Filter By Date Range ")),t("div",lt,[x(p,{onCleared:F,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",modelValue:o(b),"onUpdate:modelValue":e[0]||(e[0]=n=>se(b)?b.value=n:null),maxDate:new Date},null,8,["modelValue","maxDate"])])]),t("div",it,[x(m,{items:o(j),modelValue:o(w),"onUpdate:modelValue":e[1]||(e[1]=n=>se(w)?w.value=n:null)},null,8,["items","modelValue"])]),t("div",null,[x(u,{color:"primary",text:"Generate Report",icon:o(Xe),click:()=>X(),loading:o(E)},null,8,["icon","click","loading"])])]),t("div",ct,[x(v,{printSmallLabel:!1}),x(h,{class:"btn btn-default",ref_key:"excelRef",ref:de,header:o(Q),data:o(H),worksheet:"report-work-sheet",name:o(J)},{default:L(()=>[t("button",{ref_key:"excelTriggerRef",ref:K},null,512)]),_:1},8,["header","data","name"]),x(I,{onClick:ye,text:"Export Excel"})])]),t("div",dt,[t("div",ut,[e[4]||(e[4]=t("div",{class:"flex flex-col space-y-2"},[t("img",{src:We,alt:"app-logo",class:"w-24 h-24 object-cover"}),t("h3",{class:"text-xl font-semibold"},"LABORATORY DEPARTMENT REPORT")],-1)),x(ke)]),t("div",pt,[t("h3",mt,[e[5]||(e[5]=U(" Tests Performed Period: ")),t("span",ft,f(o(b)[0].toString()!=""?o(O)(o(b)[0].toString()).format("DATE_FORMAT"in s?s.DATE_FORMAT:o(ne)):"")+" - "+f(o(b)[1].toString()!=""?o(O)(o(b)[1].toString()).format("DATE_FORMAT"in s?s.DATE_FORMAT:o(ne)):""),1)])]),o(c).wards.length>0&&o(c).data.length>0?(a(),l("div",bt,[t("table",yt,[t("thead",vt,[t("tr",null,[e[6]||(e[6]=t("th",{class:"px-2 py-2 text-center border-r"},"TESTS",-1)),t("th",{class:"px-2 py-2 text-center border-r border-b bg-gray-100",colspan:o(c).wards.length}," WARDS ",8,_t),e[7]||(e[7]=t("th",{class:"px-2 py-2 text-center"},"TOTAL",-1))]),t("tr",xt,[e[8]||(e[8]=t("th",{class:"border-r"},null,-1)),(a(!0),l(y,null,k(o(c).wards,(n,T)=>(a(),l("th",{class:"px-2 py-2 text-center border-r",key:T},f(n),1))),128))])]),t("tbody",null,[(a(!0),l(y,null,k(o(c).data,(n,T)=>(a(),l(y,{key:T},[t("th",gt,f(Object.keys(n)[0].toString().toUpperCase()),1),(a(!0),l(y,null,k(o(c).wards,(r,_)=>(a(),l("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t",key:_}))),128)),e[9]||(e[9]=t("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},null,-1)),(a(!0),l(y,null,k(n[Object.keys(n)[0]],(r,_)=>(a(),l("tr",{class:"border-t border-b",key:_},[t("td",kt,f(r.test_type),1),(a(!0),l(y,null,k(o(c).wards,(g,W)=>(a(),l("td",{onClick:Re=>A(r.test_type,g,r.ward[g]?r.ward[g].total:0,r.ward[g]?r.ward[g].associated_ids:""),key:W,class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},f(r.ward[g]?r.ward[g].total:0),9,ht))),128)),t("td",Rt,f(Z(r)),1)]))),128))],64))),128))])]),o(c).blood_bank_products.length>0?(a(),l("table",Dt,[t("thead",null,[t("tr",null,[e[10]||(e[10]=t("th",{class:"border-b px-2 py-2 uppercase",rowspan:4}," Blood Products ",-1)),e[11]||(e[11]=t("th",{class:"border-b px-2 py-2"},null,-1)),t("th",{class:"border-b px-2 py-2 bg-gray-100",colspan:o(c).wards.length}," Wards ",8,wt)])]),t("tbody",null,[(a(!0),l(y,null,k(o(c).blood_bank_products,(n,T)=>(a(),l(y,{key:T},[t("tr",Ct,[t("td",Ot,f(Object.keys(n)[0]),1),e[12]||(e[12]=t("td",{class:"px-2 py-2 border-r border-b"},null,-1)),(a(!0),l(y,null,k(o(c).wards,(r,_)=>(a(),l("th",{colspan:3,class:"px-2 py-2 text-center border-r border-b",key:_},f(r),1))),128))]),t("tr",null,[e[16]||(e[16]=t("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1)),e[17]||(e[17]=t("td",{class:"px-2 py-2 border-b border-r"},"Age-Ranges",-1)),(a(!0),l(y,null,k(o(c).wards,(r,_)=>(a(),l(y,{key:_},[e[13]||(e[13]=t("td",{class:"px-2 py-2 border-b border-r"},"0-5",-1)),e[14]||(e[14]=t("td",{class:"px-2 py-2 border-b border-r"},"6-14",-1)),e[15]||(e[15]=t("td",{class:"border-r px-2 py-2 border-b"},"15-120",-1))],64))),128))]),t("tr",null,[e[18]||(e[18]=t("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1)),e[19]||(e[19]=t("td",{class:"px-2 py-2 border-b border-r"},"Female",-1)),(a(!0),l(y,null,k(o(c).wards,r=>(a(),l(y,{key:r},[t("td",{class:"px-4 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for females, `,r,R(n,"female",r,"0-5"),P(n,"female",r,"0-5"))},f(R(n,"female",r,"0-5")),9,$t),t("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for females, `,r,R(n,"female",r,"6-14"),P(n,"female",r,"6-14"))},f(R(n,"female",r,"6-14")),9,Tt),t("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for females, `,r,R(n,"female",r,"15-120"),P(n,"female",r,"15-120"))},f(R(n,"female",r,"15-120")),9,Et)],64))),128))]),t("tr",null,[e[20]||(e[20]=t("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1)),e[21]||(e[21]=t("td",{class:"px-2 py-2 border-b border-r"},"Male",-1)),(a(!0),l(y,null,k(o(c).wards,r=>(a(),l(y,{key:r},[t("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for males`,r,R(n,"male",r,"0-5"),P(n,"male",r,"0-5"))},f(R(n,"male",r,"0-5")),9,At),t("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for males`,r,R(n,"male",r,"6-14"),P(n,"male",r,"6-14"))},f(R(n,"male",r,"6-14")),9,Mt),t("td",{class:"px-2 py-2 border-b border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:_=>A(`${Object.keys(n)[0]} for males`,r,R(n,"male",r,"15-120"),P(n,"male",r,"15-120"))},f(R(n,"male",r,"15-120")),9,jt)],64))),128))])],64))),128))])])):N("",!0),o(c).critical_values.length>0?(a(),l("div",St,e[22]||(e[22]=[t("h3",{class:"text-xl font-semibold uppercase text-center"}," CRITICAL VALUES ",-1)]))):N("",!0),o(c).critical_values.length>0?(a(),l("table",Pt,[t("thead",null,[t("tr",null,[e[23]||(e[23]=t("th",{class:"px-2 py-2 text-center border-r"},"Measure",-1)),t("th",{class:"px-2 py-2 text-center border-r border-b bg-gray-100",colspan:o(c).wards.length}," Wards ",8,Lt),e[24]||(e[24]=t("th",{class:"px-2 py-2 text-center font-bold uppercase"},"Total",-1))]),t("tr",qt,[e[25]||(e[25]=t("th",{class:"border-r"},null,-1)),(a(!0),l(y,null,k(o(c).wards,(n,T)=>(a(),l("th",{class:"px-2 py-2 text-center border-r",key:T},f(n),1))),128))])]),t("tbody",null,[(a(!0),l(y,null,k(o(c).critical_values,(n,T)=>(a(),l(y,{key:T},[t("th",Nt,f(Object.keys(n)[0]),1),(a(!0),l(y,null,k(o(c).wards,(r,_)=>(a(),l("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t",key:_}))),128)),e[26]||(e[26]=t("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},null,-1)),(a(!0),l(y,null,k(n[Object.keys(n)[0]],(r,_)=>(a(),l("tr",{class:"border-t border-b",key:_},[t("td",Yt,f(r.critical_value_level),1),(a(!0),l(y,null,k(o(c).wards,(g,W)=>(a(),l("td",{key:W,onClick:Re=>A(`${Object.keys(n)[0]} - Critical value (${r.critical_value_level})`,g,r.ward[g]?r.ward[g].total:0,r.ward[g]?r.ward[g].associated_ids:""),class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},f(r.ward[g]?r.ward[g].total:0),9,Bt))),128)),t("td",Vt,f(Z(r)),1)]))),128))],64))),128))])])):N("",!0)])):N("",!0),x(he,{condition:o(E),cancelReportGeneration:()=>o(ce)()},null,8,["condition","cancelReportGeneration"]),o(c).wards.length==0&&o(c).data.length==0&&!o(E)?(a(),l("div",Ut,[e[29]||(e[29]=t("img",{src:Ue,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1)),t("p",null,[e[27]||(e[27]=U(" Please generate report data to preview the ")),t("span",Ft,f(o(pe)),1),e[28]||(e[28]=U(" report. "))])])):N("",!0)])])}}});export{yr as default};
