var A=Object.defineProperty;var q=(s,e,n)=>e in s?A(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var d=(s,e,n)=>(q(s,typeof e!="symbol"?e+"":e,n),n);import{_ as N}from"./Breadcrumb.vue.c66aa30f.js";import{_ as P}from"./nuxt-link.a46a2f01.js";import{_ as B}from"./Dropdown.77434b8c.js";import{u as E,ap as O,a as L,b as r,_ as U,g as h,o as x,c as g,e as t,d as a,i as b,h as w,t as m,n as f,w as F,S as H,k as J,ao as R,f as I}from"./entry.7a85215a.js";import{u as v,h as M,A as c,t as K,j as Y,e as W,f as j,v as u,P as z}from"./fetch.b3533157.js";import{e as G}from"./constants.8b327ee6.js";import{P as Q}from"./package.c07b7a49.js";import{r as X}from"./IdentificationIcon.08079636.js";import{r as Z}from"./ArrowDownTrayIcon.abb6941e.js";import{r as $}from"./CheckIcon.5efdbc1a.js";import{F as ee,K as te,B as se,N as ie,H as ne}from"./listbox.40261f8b.js";import{_ as oe}from"./medical_sample.a2aacc21.js";import"./HomeIcon.d83c3686.js";import"./CheckCircleIcon.ca1d9483.js";import"./MagnifyingGlassIcon.cb45cf45.js";import"./transition.aeb06950.js";import"./hidden.38d3ab8c.js";import"./XMarkIcon.3f6360b6.js";import"./PencilSquareIcon.c3173494.js";import"./PrinterIcon.be882207.js";import"./use-text-value.c03a06b7.js";class ae{constructor(e){d(this,"client",{id:"",uuid:""});d(this,"tests",[]);d(this,"order",{priority:1,requested_by:"",collected_by:v().$state.department,sample_collected_time:"",tracking_number:""});d(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=e}createEncounter(e,n){this.encounter={...this.encounter,encounter_type:e,facility_section:n}}buildOrder(e="",n=M().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=e,this.order.sample_collected_time=n}setTests(e,n){this.tests=n.map(p=>({specimen:e,test_type:p}))}async createOrder(){return c.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client})}}const le={components:{Listbox:ee,ListboxButton:te,ListboxLabel:se,ListboxOptions:ie,ListboxOption:ne,IdentificationIcon:X},setup(){E({title:`${Q.name.toUpperCase()} - New Test`})},data(){return{ArrowDownTrayIcon:Z,CheckIcon:$,pages:[{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}],patient:{date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1},visitTypes:new Array,specimens:new Array,wards:new Array,tests:new Array,visitTypeSelected:{name:"select visit type",id:0},specimenSelected:{name:"select specimen",id:0},wardSelected:{name:"select ward",id:0},testsSelected:new Array,physician:"",sampleCollectionDate:"",requestingTitle:"Requesting Ward",isBDE:!1,authStore:v(),alert:K(),route:O(),token:L("token")}},computed:{patientAge(){return Y(this.patient.date_of_birth)},patientSex(){return this.patient.sex.match(/f/i)?"Female":"Male"},patientName(){return`${this.patient.first_name} ${this.patient.middle_name} ${this.patient.last_name}`},patientNumber(){return this.patient.client_id},currentDepartment(){return this.authStore.user.departments.find(s=>s.name===this.authStore.department)}},methods:{getPatient(s){const e={route:`${W.clients}/${s}`,method:"GET",token:`${this.token}`};j(e).then(({data:n,error:p,pending:i})=>{n.value&&(this.patient=n.value),p.value&&console.error(G)})},async saveChanges(){const s=new ae(this.patient.client_id);s.createEncounter(this.visitTypeSelected.id,this.wardSelected.id),s.buildOrder(this.physician,this.sampleCollectionDate),s.setTests(this.specimenSelected.id,this.testsSelected);const e=await s.createOrder();u(e)||(r().$toast.success(`Order with accession number ${e.accession_number} has been created successfully!`),await this.alert.alertConfirmation({message:"Do you want to print specimen label?"})&&await z.printSpecimenLabel(e.accession_number)),r().$router.push("/tests")},validator(){return this.visitTypeSelected.id==0?(r().$toast.warning("Please select visit type and try again!"),!1):this.specimenSelected.id==0?(r().$toast.warning("Please select specimen and try again!"),!1):this.wardSelected.id==0?(r().$toast.warning("Please select ward and try again!"),!1):this.testsSelected.length==0?(r().$toast.warning("Please select tests and try again!"),!1):!0}},watch:{async visitTypeSelected(s){s.name.toLowerCase()=="referral"?(this.requestingTitle="Requesting Facility",this.wardSelected={name:"select facility",id:0}):this.requestingTitle="Requesting Ward",this.wards=new Array,u(this.wards[s.id])&&(this.wards=await c.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:s.id}))},async specimenSelected(s){u(this.tests[s.id])&&(this.tests[s.id]=await c.getJson("specimen/test_types",{specimen_id:s.id,department_id:this.currentDepartment.id})||[])},async authStore(s){for(const e in this.tests)this.tests.hasOwnProperty(e)&&delete this.tests[e];u(this.specimenSelected)||(this.tests[this.specimenSelected.id]=await c.getJson("specimen/test_types",{specimen_id:this.specimenSelected.id,department_id:s.user.departments.find(e=>e.name===s.department).id})||[])}},created(){c.getJson("encounter_types").then(s=>this.visitTypes=s.data),c.getJson("specimen").then(s=>this.specimens=s),this.getPatient(this.route.query.patient_id)}},re={class:"py-5 px-5"},ce={class:"mt-5"},de={class:"flex items-center space-x-2"},me=t("img",{src:oe,class:"w-auto h-6",alt:"flash-icon"},null,-1),pe={class:"text-xl font-semibold uppercase"},ue={class:"border rounded mt-5"},_e=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("img",{src:R,class:"h-8 w-auto",alt:"fever-icon"}),t("h3",{class:"font-semibold text-lg"},"Patient Details")],-1),he={class:"w-full py-5 px-5"},fe={class:"flex items-center space-x-20"},ye={class:"flex items-center space-x-3"},xe=t("h3",{class:"font-medium"},"Patient Number:",-1),ge={class:"mt-1 text-gray-600"},be={class:"flex items-center space-x-3"},we=t("h3",{class:"font-medium"},"Age",-1),ve={class:"mt-1 text-gray-600"},Se={class:"flex items-center space-x-3"},ke=t("h3",{class:"font-medium"},"Sex:",-1),Ve={class:"mt-1 text-gray-600"},Ce={class:"border mt-5 rounded"},Te=t("div",{class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},[t("h3",{class:"font-semibold text-lg"},"Order Details")],-1),De={class:"px-5 py-5"},Ae={class:"w-full mb-5"},qe={class:"flex flex-col space-y-2"},Ne={class:"w-full flex items-center space-x-10 mb-5"},Pe={class:"w-1/2 flex flex-col space-y-2"},Be=t("label",{class:"font-medium"},"Visit Type",-1),Ee={class:"w-1/2 flex flex-col space-y-2"},Oe={class:"font-medium"},Le={class:"w-full flex items-center space-x-10 mb-5"},Ue={class:"w-1/2 flex flex-col space-y-2"},Fe=t("label",{class:"font-medium"},"Specimen Type",-1),He={class:"w-1/2 flex flex-col space-y-2"},Je=t("label",{class:"font-medium"},"Tests",-1),Re={class:"w-full my-6"},Ie=t("label",{class:"font-medium"},"Back Data Entry",-1),Me={key:0,class:"w-full mb-5 flex flex-col space-y-2"},Ke=t("label",{class:"font-medium"},"Sample collection date",-1),Ye={class:"w-full"};function We(s,e,n,p,i,l){const S=N,k=P,y=h("FormKit"),_=B,V=h("multi-select"),C=h("datepicker"),T=I;return x(),g("div",null,[t("div",re,[a(S,{pages:i.pages},null,8,["pages"]),t("div",ce,[t("div",de,[me,t("h3",pe,[b(" New order for "),t("span",null,[a(k,{class:"text-sky-500 text-xl font-semibold",to:`/patients?search=${l.patientName.toLowerCase().replace(" ","+")}`},{default:w(()=>[b(" “"+m(l.patientName)+"” ",1)]),_:1},8,["to"])])])]),t("div",ue,[_e,t("div",he,[t("div",fe,[t("div",ye,[xe,t("p",ge,m(l.patientNumber),1)]),t("div",be,[we,t("p",ve,m(l.patientAge)+" years old",1)]),t("div",Se,[ke,t("p",Ve,m(l.patientSex),1)])])])]),a(y,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=D=>l.validator()&&l.saveChanges()),actions:!1,id:"submitForm"},{default:w(({value:D})=>[t("div",Ce,[Te,t("div",De,[t("div",Ae,[t("div",qe,[a(y,{label:"Requesting Physician",validation:"required",modelValue:i.physician,"onUpdate:modelValue":e[0]||(e[0]=o=>i.physician=o)},null,8,["modelValue"])])]),t("div",Ne,[t("div",Pe,[Be,a(_,{items:i.visitTypes,modelValue:i.visitTypeSelected,"onUpdate:modelValue":e[1]||(e[1]=o=>i.visitTypeSelected=o),class:f(i.visitTypeSelected.name=="select visit type"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",Ee,[t("label",Oe,m(i.requestingTitle),1),a(_,{isSearchable:"",items:i.wards,modelValue:i.wardSelected,"onUpdate:modelValue":e[2]||(e[2]=o=>i.wardSelected=o),class:f(i.wardSelected.name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])])]),t("div",Le,[t("div",Ue,[Fe,a(_,{items:i.specimens,modelValue:i.specimenSelected,"onUpdate:modelValue":e[3]||(e[3]=o=>i.specimenSelected=o),class:f(i.specimenSelected.name=="select specimen"&&"text-gray-600")},null,8,["items","modelValue","class"])]),t("div",He,[Je,a(V,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:i.testsSelected,"onUpdate:modelValue":e[4]||(e[4]=o=>i.testsSelected=o),options:i.tests[i.specimenSelected.id||0],placeholder:"select tests",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Re,[F(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=o=>i.isBDE=o)},null,512),[[H,i.isBDE]]),Ie]),i.isBDE?(x(),g("div",Me,[Ke,a(C,{required:"",position:"left",placeholder:"select date",range:!1,"input-class-name":"datepicker",modelValue:i.sampleCollectionDate,"onUpdate:modelValue":e[6]||(e[6]=o=>i.sampleCollectionDate=o)},null,8,["modelValue"])])):J("",!0),t("div",Ye,[a(T,{type:"submit",text:"Place order",color:"primary",icon:i.CheckIcon,click:()=>{}},null,8,["icon"])])])])]),_:1})])])])}const ht=U(le,[["render",We]]);export{ht as default};
