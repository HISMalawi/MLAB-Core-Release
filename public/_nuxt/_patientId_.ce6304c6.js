import{_ as j}from"./Breadcrumb.vue.a39ffbdc.js";import{u as z,a as M,_ as V,g as P,o as d,c as p,d as S,e,i as g,t as o,w as I,V as E,q as Y,k,l as f,F as b,r as y,v as A,f as O}from"./entry.fea207a2.js";import{_ as U}from"./index.7702ee62.js";import{_ as G}from"./Loader.bca8454f.js";import{a as T,d as w}from"./constants.d775b389.js";import{h as N,e as F,f as C,d as q}from"./fetch.fde8799b.js";import{u as H}from"./facility.db04d184.js";import{P as Q}from"./package.2170dd03.js";import{r as Z}from"./UserIcon.d18f1772.js";import{r as J}from"./QrCodeIcon.529fe234.js";import{r as K}from"./FunnelIcon.be70d113.js";import{r as W}from"./PrinterIcon.177ee18a.js";import{r as X}from"./ArrowPathIcon.a6f59c0b.js";import{_ as $}from"./logo.2125b981.js";import"./nuxt-link.14636546.js";import"./HomeIcon.b687b7f0.js";import"./jspdf.es.min.41c2e386.js";import"./XMarkIcon.c02e9f86.js";import"./transition.848bec43.js";import"./hidden.d08f7e65.js";import"./PencilSquareIcon.9dc286fc.js";const ee={name:"PatientReport",components:{UserIcon:Z,QrCodeIcon:J,FunnelIcon:K},setup(){z({title:`${Q.name} - Patient Report`})},data(){return{dateRange:[],pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:W,refreshIcon:X,cookie:M("token"),moment:N,facility:H(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){this.loading=!0;const t=this.$route.query.order_id;let r=T[0].toString()!=""?N(T[0].toString()).format("YYYY-MM-DD"):"",a=T[1].toString()!=""?N(T[1].toString()).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const l={route:`${F.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${a}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:x}=await C(l);if(this.loading=x,s.value){this.loading=!1,this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let v=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(R=>R.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=v}n.value&&(this.loading=!1,console.error(n.value))}else{const l={route:`${F.tests}/${this.patientId}/report?from=${r}&to=${a}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:x}=await C(l);if(this.loading=x,s.value){this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let v=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(R=>R.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=v,this.loading=!1}n.value&&(console.error(n.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],a=t.find(l=>r.includes(l.status.name));return a?`${a.initiator.first_name} ${a.initiator.last_name}`:""},getOrderStatus(t){return t!==null?this.capitalizeStr(t.split("-")[1]):""},getTestStatusInitiatorName(t,r){const a=t.find(l=>r===l.status.name);return a?{name:`${a.initiator.first_name} ${a.initiator.last_name}`,created_at:a.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(a=>a.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,a)=>r+a.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0?`Growth of ${r.map(a=>a.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.tests.some(a=>a.print_device))},getSmallLabelPrintTests(t){const r=[];return t.forEach(a=>{a.tests.forEach(l=>{l.print_device&&r.push(l.id)})}),r},getPrintCount(t){return t.reduce((r,a)=>r+a.print_count,0)},getRequiredRange(t,r){const a=t.sex=="M"?"Male":"Female",l=Number(q(t.date_of_birth));return r.filter(s=>s.sex===a&&l>Number(s.min_age)&&l<Number(s.max_age)||s.sex==="Both"&&l>Number(s.min_age)&&l<Number(s.max_age))[0]},shouldDisplayRange(t,r,a){let l=null;return this.showIndicatorRanges(t)&&(l=this.getRequiredRange(r,a.indicator_ranges)),l}}},te=""+new URL("medical-record.2202ac05.png",import.meta.url).href,se={class:"py-5 px-5"},re={class:"flex items-center py-5"},oe=e("img",{src:te,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ne={class:"text-2xl font-semibold uppercase"},ie={class:"text-sky-500 text-2xl"},ae={class:"mt-2 space-y-3"},le={class:"w-full flex items-center justify-between"},de={class:"flex items-center space-x-5"},ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},pe={class:"w-72 ml-2"},_e={class:"flex items-center space-x-2"},ue=e("label",null,"Include pending tests",-1),me={key:0,class:"border rounded print-container mt-10"},he={class:"rounded-tr rounded-tl border-b px-5 py-5"},fe={class:"flex items-center justify-between"},be=e("div",{class:"flex items-center space-x-2"},[e("img",{src:$,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold"},"PATIENT REPORT")],-1),ye={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},ge={class:"font-normal"},xe={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},ve={class:"flex items-center not-italic text-gray-600"},Re={class:"flex items-center not-italic text-gray-600"},Se={class:"flex items-center justify-between mt-5"},ke=e("span",{class:"font-medium"},"Report Date:",-1),we=e("span",{class:"font-medium"},"No. Printed:",-1),De=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Te={class:"w-full mt-2"},Ie=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Ne={class:"border px-2 py-2"},Pe=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Ae={class:"border px-2 py-2"},Fe=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Ce={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),Le={class:"border px-2 py-2"},Be=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),je={class:"border px-2 py-2",colspan:"2"},ze={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Me={class:"flex items-center"},Ve={class:"border-collapse border-slate-500 w-full"},Ee=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),Ye={class:"border-b border-r px-2 py-2"},Oe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),Ue={class:"border-b px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),He={class:"border-b border-r px-2 py-2"},Qe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),Ze={class:"border-b px-2 py-2"},Je=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),Ke={class:"border-b border-r px-2 py-2"},We=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1),Xe={class:"border-b px-2 py-2"},$e={class:"border-collapse w-full"},et={class:"bg-gray-100 text-gray-600"},tt=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),st={colspan:3,class:"px-2 py-2 text-lg font-semibold"},rt=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),ot={class:"border px-2 py-2"},nt={class:"border"},it={class:"w-full h-full"},at=e("tr",null,[e("td",{class:"border px-2 py-2 font-bold"},"Measure"),e("td",{class:"border px-2 py-2 font-bold"},"Result"),e("td",{class:"border px-2 py-2 font-bold"},"Range")],-1),lt={class:"border px-2 py-2"},dt={class:"border-b px-2 py-2 flex items-center"},ct=["innerHTML"],pt={key:0,class:"text-xs pt-1 pl-1"},_t={key:0,class:"border px-2 py-2 font-bold"},ut={key:1,class:"border px-2 py-2"},mt={class:"border px-2 py-2"},ht={class:"border px-2 py-2"},ft={class:"test-status"},bt=e("p",{class:"font-bold"},"Test Status",-1),yt={class:"px-2"},gt={class:"px-2"},xt={class:"px-2"},vt={key:0,class:"performed-by"},Rt=e("p",{class:"font-bold"},"Performed By",-1),St={class:"px-2"},kt={class:"px-2"},wt={class:"m-2"},Dt=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Tt={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},It={class:"w-full"},Nt=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),Pt={classs:"border-l border-r"},At={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Ft={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Ct={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},qt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Lt=e("p",{class:"text-base"},[g(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function Bt(t,r,a,l,s,n){const x=j,v=P("FunnelIcon"),u=P("datepicker"),m=O,R=U,L=G;return d(),p("div",se,[S(x,{pages:s.pages},null,8,["pages"]),e("div",re,[oe,e("h3",ne,[g(" patient report for "),e("span",ie,'"'+o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`)+'"',1)])]),e("div",ae,[e("div",le,[e("div",de,[e("div",ce,[S(v,{class:"w-5 h-5 mr-2"}),g(" Filter By Date Range "),e("div",pe,[S(u,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=c=>s.dateRange=c)},null,8,["modelValue"])])]),e("div",_e,[I(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=c=>s.showPendingTests=c)},null,512),[[E,s.showPendingTests]]),ue]),S(m,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])]),e("div",null,[n.getAuthorizedTestCount(s.reportData)>0?(d(),Y(R,{key:0,"print-small-label":n.shouldPrintSmallLabel(s.reportData),id:n.patientId,orderId:n.orderId,tests:n.getSmallLabelPrintTests(s.reportData),onUpdate:n.updateReport},null,8,["print-small-label","id","orderId","tests","onUpdate"])):k("",!0)])]),s.reportData.length>0?(d(),p("div",me,[e("div",he,[e("div",fe,[be,e("div",ye,[e("address",ge,[e("span",xe,o(s.facility.details.name),1),e("span",ve,o(s.facility.details.address),1),e("span",Re,o(s.facility.details.phone),1)])])]),e("div",Se,[e("div",null,[ke,g(" "+o(s.moment(new Date).format("dateFormat"in t?t.dateFormat:f(w))),1)]),e("div",null,[we,g(" "+o(n.getPrintCount(s.reportData)),1)]),e("div",null,[De,g(" "+o(s.reportData.length>0&&s.moment(s.reportData[0].sample_collected_time).format("dateFormat"in t?t.dateFormat:f(w))),1)])]),e("table",Te,[e("tbody",null,[e("tr",null,[Ie,e("td",Ne,o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`),1),Pe,e("td",Ae,o(s.person.sex==="F"?"Female":"Male"),1),Fe,e("td",Ce,o(("calculateAge"in t?t.calculateAge:f(q))(s.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[qe,e("td",Le,o(s.person.id),1),Be,e("td",je,o(n.getPhysicalAddress),1)])])])]),(d(!0),p(b,null,y(s.reportData,(c,B)=>(d(),p("div",{key:B},[e("div",ze,[e("div",Me," Accession No: "+o(c.accession_number),1),e("div",null," Requested By: "+o(c.requested_by)+" ("+o(c.requesting_ward)+") ",1)]),e("table",Ve,[e("tbody",null,[e("tr",null,[Ee,e("td",Ye,o(c.specimen),1),Oe,e("td",Ue,o(s.moment(c.created_date).format("dateFormat"in t?t.dateFormat:f(w))),1)]),e("tr",null,[Ge,e("td",He,o(n.getTestTypes(c.test_types)),1),Qe,e("td",Ze,o(n.getDepartments(c.test_types)),1)]),e("tr",null,[Je,e("td",Ke,o(n.getOrderStatus(c.order_status)),1),We,e("td",Xe,o(n.getOrderStatusInitiatorName(c.order_status_trail)),1)])])]),e("table",$e,[e("thead",null,[e("tr",et,[tt,e("th",st," Tests Authorized("+o(c.tests_verified)+") ",1)])]),e("tbody",null,[rt,(d(!0),p(b,null,y(s.showPendingTests?c.tests:c.tests.filter(i=>i.status.toLowerCase()!=="pending"),i=>(d(),p("tr",{key:i.id},[e("td",ot,o(i.test_type_name),1),e("td",nt,[e("table",it,[at,(d(!0),p(b,null,y(i.indicators,_=>{var D,h;return d(),p("tr",null,[e("td",lt,o(_.name),1),e("td",dt,[e("p",{innerHTML:n.showResult(((D=_.result)==null?void 0:D.value)??"",i==null?void 0:i.suscept_test_result)},null,8,ct),(h=_.result)!=null&&h.value?(d(),p("span",pt,o((i==null?void 0:i.suscept_test_result.length)>0?"":_==null?void 0:_.unit),1)):k("",!0)]),n.shouldDisplayRange(i.indicators,s.person,_)!==void 0&&n.shouldDisplayRange(i.indicators,s.person,_)!==null?(d(),p("td",_t," ("+o(n.shouldDisplayRange(i.indicators,s.person,_).lower_range)+" - "+o(n.shouldDisplayRange(i.indicators,s.person,_).upper_range)+") ",1)):(d(),p("td",ut,"N/A"))])}),256))])]),e("td",mt,o((i==null?void 0:i.remarks)??"N/A"),1),e("td",ht,[e("div",ft,[bt,e("p",yt,o(n.getTestStatusName(i.status)),1),e("p",gt," By: "+o(n.getTestStatusInitiatorName(i.status_trail,i.status).name),1),e("p",xt," On: "+o(s.moment(n.getTestStatusInitiatorName(i.status_trail,i.status).created_at).format("dateFormat"in t?t.dateFormat:f(w))),1)]),n.getTestStatusInitiatorName(i.status_trail,"completed").name?(d(),p("div",vt,[Rt,e("p",St,o(n.getTestStatusInitiatorName(i.status_trail,"completed").name),1),e("p",kt," On: "+o(s.moment(n.getTestStatusInitiatorName(i.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:f(w))),1)])):k("",!0)])]))),128))])]),I(e("div",wt,[Dt,e("div",null,[(d(!0),p(b,null,y(c.tests,i=>(d(),p("div",{class:"grid grid-cols-2 gap-4",key:i.id},[i.test_type_name.toLowerCase().includes("culture")?(d(!0),p(b,{key:0},y(i.suscept_test_result,(_,D)=>(d(),p("div",{key:D},[e("div",Tt,o(_.name),1),e("table",It,[Nt,e("tbody",Pt,[(d(!0),p(b,null,y(n.getFilteredDrugs(_.drugs),h=>(d(),p("tr",{key:h.drug_id},[e("th",At,o(h.name),1),e("th",Ft,o(h.zone),1),e("th",Ct,o(h.interpretation),1)]))),128))])])]))),128)):k("",!0)]))),128))])],512),[[A,n.checkSusceptibilityResults(c)]])]))),128))])):k("",!0),e("div",null,[I(e("div",qt,[S(L),Lt],512),[[A,s.loading]])])])])}const os=V(ee,[["render",Bt]]);export{os as default};
