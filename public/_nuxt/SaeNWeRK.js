import{a as S,u as h,P as b,l as I,m as a,b as v,e as D,f as r,n as l,g as c,p as q,x as A,s as L,_ as R}from"./DkSHUfZG.js";import{e as f,f as _}from"./D2LBdSgo.js";import{r as V}from"./CFqEtL_8.js";import{r as O}from"./CEYBmAkp.js";import{r as k}from"./_yfpsPGK.js";import{S as z,h as N,Y as B,G as F,V as U}from"./C_hGcfdC.js";const j={components:{TransitionRoot:z,TransitionChild:N,Dialog:B,DialogPanel:F,DialogTitle:U,XMarkIcon:V,ExclamationTriangleIcon:O,PrinterIcon:k},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1},orderTests:{type:Array,required:!1}},data(){return{show:!1,printIcon:k,cookie:S("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const n={route:f.printers,method:"GET",token:`${this.cookie}`},{data:e,error:t}=await _(n);e.value&&(this.printers=new Array,e.value.map(d=>{this.printers.push(d.name)})),t.value&&console.error(t.value)},isCrossMatchTest(){var n;return this.orderTests?(n=this.orderTests)==null?void 0:n.some(e=>e.test_type_name.toLowerCase()=="cross-match"):!1},async toPrintSmallLabel(){this.zebraPrinting=!0;const n={route:f.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests,is_cross_match:this.isCrossMatchTest()}},{data:e,error:t,pending:d}=await _(n);if(this.zebraPrinting=d,e.value){this.zebraPrinting=!1;const o=new FileReader;o.onload=()=>{const i=URL.createObjectURL(e.value),s=document.createElement("a");s.href=i,s.setAttribute("download",`${Date.now()}.lbl`),s.click(),URL.revokeObjectURL(i)},o.readAsText(e.value)}t.value&&(this.zebraPrinting=!1,console.error(t.value))},containsWords(n,...e){for(let t=0;t<e.length;t++)if(n.cssText.includes(e[t]))return!0;return!1},async submitForm(n){var p,m;let e=new FormData;this.loading=!0;let t=new Array;t.push(Number(this.orderId));let d=this.id;e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(t)),e.append("client_id",d);const o={route:f.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:i,error:s,pending:u}=await _(o);this.loading=u,i.value&&(i.value.printed?h().$toast.success("Patient report printed successfully!"):h().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((p=(this._.provides[b]||this.$route).query.printer)==null?void 0:p.toString())=="true"&&this.$router.back(),this.handleClick()),s.value&&(this.loading=!1,console.error(s.value),h().$toast.error("An error occurred while printing patient report"),this.handleClick(),((m=(this._.provides[b]||this.$route).query.printer)==null?void 0:m.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show}}},M=c("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),E={class:"fixed inset-0 overflow-y-auto"},$={class:"flex top-0 items-center justify-center p-4 text-center"},G={class:"border-b px-3 py-3 flex items-center justify-between"},X={class:"py-5 px-5"},K={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Y(n,e,t,d,o,i){const s=R,u=a("TransitionChild"),p=a("PrinterIcon"),m=a("DialogTitle"),x=a("XMarkIcon"),g=a("FormKit"),w=a("DialogPanel"),P=a("Dialog"),T=a("TransitionRoot");return v(),D("div",null,[r(s,{click:i.init,color:"primary",text:"Print",icon:o.printIcon},null,8,["click","icon"]),r(T,{appear:"",show:o.show,as:"template"},{default:l(()=>[r(P,{as:"div",class:"relative z-10"},{default:l(()=>[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:l(()=>[M]),_:1}),c("div",E,[c("div",$,[r(u,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:l(()=>[r(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:l(()=>[c("div",G,[r(m,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:l(()=>[r(p,{class:"h-5 w-5 mr-2"}),q(" Print ")]),_:1}),c("button",{onClick:e[0]||(e[0]=(...y)=>i.handleClick&&i.handleClick(...y))},[r(x,{class:"w-5 h-5"})])]),r(g,{type:"form","submit-label":"Update",onSubmit:i.submitForm,actions:!1},{default:l(({value:y})=>[c("div",X,[r(g,{validation:"required",label:"Select a printer",type:"radio",modelValue:o.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=C=>o.selectedPrinter=C),options:o.printers},null,8,["modelValue","options"])]),c("div",K,[t.printSmallLabel?(v(),A(s,{key:0,type:"button",loading:o.zebraPrinting,click:()=>{i.toPrintSmallLabel()},icon:o.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):L("",!0),r(s,{click:()=>{},loading:o.loading,type:"submit",icon:o.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const te=I(j,[["render",Y]]);export{te as _};
