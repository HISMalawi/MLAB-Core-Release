import{u as S,a as p,_ as I,f as l,o as g,c as T,b as o,g as c,d,h as D,p as A,j as F,e as L}from"./entry.71c9e4aa.js";import{E as R}from"./jspdf.es.min.65e2939b.js";import{a as V,e as u,f as m}from"./fetch.ad8fdb43.js";import{r as q}from"./XMarkIcon.aea27e1b.js";import{r as b}from"./PrinterIcon.be7f4d4c.js";import{S as O,h as U,U as z,G as B,V as N}from"./transition.fb9320ab.js";const j={components:{TransitionRoot:O,TransitionChild:U,Dialog:z,DialogPanel:B,DialogTitle:N,XMarkIcon:q,ExclamationTriangleIcon:V,PrinterIcon:b},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1}},data(){return{show:!1,printIcon:b,cookie:S("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const s={route:u.printers,method:"GET",token:`${this.cookie}`},{data:e,error:i,pending:r}=await m(s);e.value&&(this.printers=new Array,e.value.map(t=>{this.printers.push(t.name)})),i.value&&console.error(i.value)},async printSmallLabel(){this.zebraPrinting=!0;const s={route:u.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests}},{data:e,error:i,pending:r}=await m(s);if(this.zebraPrinting=r,e.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const n=URL.createObjectURL(e.value),a=document.createElement("a");a.href=n,a.setAttribute("download",`${Date.now()}.lbl`),a.click(),URL.revokeObjectURL(n)},t.readAsText(e.value)}i.value&&(this.zebraPrinting=!1,console.error(i.value))},async generatePDF(){this.loading=!0;const s=document.querySelector(".print-container"),e=new R({orientation:"portrait",unit:"px"}),i=async r=>{const t=r.output("blob");await this.submitForm(t)};e.html(s,{callback:function(r){i(r)},margin:[10,10,10,10],autoPaging:"text",x:0,y:0,width:430,windowWidth:985}),e.setFont("Helvetica","normal")},async submitForm(s){let e=new FormData,i=new Array;i.push(Number(this.orderId)),e.append("pdf",s,`patient-name-${this.id}`),e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(i));const r={route:u.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:t,error:n,pending:a}=await m(r);this.loading=a,t.value&&(t.value.printed?p().$toast.success("Patient report printed successfully!"):p().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),this.handleClick()),n.value&&(this.loading=!1,console.error(n.value),p().$toast.error("An error occurred while printing patient report"),this.handleClick())},handleClick(){this.show=!this.show}}},E=d("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),G={class:"fixed inset-0 overflow-y-auto"},M={class:"flex top-0 items-center justify-center p-4 text-center"},X={class:"border-b px-3 py-3 flex items-center justify-between"},K={class:"py-5 px-5"},H={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function J(s,e,i,r,t,n){const a=L,f=l("TransitionChild"),y=l("PrinterIcon"),v=l("DialogTitle"),k=l("XMarkIcon"),h=l("FormKit"),w=l("DialogPanel"),x=l("Dialog"),P=l("TransitionRoot");return g(),T("div",null,[o(a,{click:n.init,color:"primary",text:"Print",icon:t.printIcon},null,8,["click","icon"]),o(P,{appear:"",show:t.show,as:"template"},{default:c(()=>[o(x,{as:"div",class:"relative z-10"},{default:c(()=>[o(f,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[E]),_:1}),d("div",G,[d("div",M,[o(f,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[o(w,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[d("div",X,[o(v,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:c(()=>[o(y,{class:"h-5 w-5 mr-2"}),D(" Print ")]),_:1}),d("button",{onClick:e[0]||(e[0]=(..._)=>n.handleClick&&n.handleClick(..._))},[o(k,{class:"w-5 h-5"})])]),o(h,{type:"form","submit-label":"Update",onSubmit:n.generatePDF,actions:!1},{default:c(({value:_})=>[d("div",K,[o(h,{validation:"required",label:"Select a printer",type:"radio",modelValue:t.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=C=>t.selectedPrinter=C),options:t.printers},null,8,["modelValue","options"])]),d("div",H,[n.printSmallLabel?(g(),A(a,{key:0,type:"button",loading:t.zebraPrinting,click:()=>{n.printSmallLabel()},icon:t.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):F("",!0),o(a,{click:()=>{},loading:t.loading,type:"submit",icon:t.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const te=I(j,[["render",J]]);export{te as _};
