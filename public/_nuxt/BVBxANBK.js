import{_ as H}from"./BFE2e6qW.js";import{S as X,p as G,Y as Q,G as Y,V as z,q as E,a as L,ax as y,u as J,s as W,x as l,b as u,e as p,g as e,f as o,y as d,j as b,t as v,F as M,k as N,_ as R,d as Z,af as ee,r as I,aC as te,c as oe,o as se,h as c,H as re,C as ne}from"./DaR_ss44.js";import{_ as ae}from"./r0QsBocn.js";import{S as U}from"./Ctdkx0xy.js";import{r as ie}from"./B_cjOhbr.js";import{r as j}from"./CHKECodZ.js";import{r as A}from"./BTU_o6qE.js";import{r as ce}from"./CxRsRgau.js";import{r as le}from"./CCe7HPTx.js";import{r as de}from"./Cy4CbOJ5.js";import{_ as ue}from"./BXtY6SFH.js";import{P as me}from"./CMtC_zcg.js";import{u as pe}from"./CfS7LVlI.js";import{r as _e}from"./CgdBYDbq.js";import"./BW-thXDA.js";import"./jy5sGp16.js";const fe={props:{voucherId:{required:!0,type:String},requisitions:{required:!0,type:Array}},components:{TransitionRoot:X,TransitionChild:G,Dialog:Q,DialogPanel:Y,DialogTitle:z,XMarkIcon:E,UserIcon:ie,TicketIcon:j},data(){return{open:!1,addIcon:A,saveIcon:ce,clearIcon:le,completeIcon:de,loading:!1,name:"",description:"",cookie:L("token")}},methods:{async createStockOrder(){this.loading=!0;const _=new U,n={voucher_number:Number((this._.provides[y]||this.$route).params.voucherId),requisitions:this.requisitions.map(s=>({stock_item_id:s.stock_item.id,quantity_requested:s.quantity_requested}))},{data:f,error:h,pending:i}=await _.createStockOrder(`${this.cookie}`,n);this.loading=i,f.value&&(this.loading=!1,J().$toast.success(`Stock order ${(this._.provides[y]||this.$route).params.voucherId} created successfully`),this.handleClick(),this.$emit("update",!0)),h.value&&(this.loading=!1,console.error(h.value))},handleClick(){this.open=!this.open},clearForm(){this.$formkit.reset("submitForm")}}},he={class:"fixed inset-0 overflow-y-auto"},ke={class:"flex min-h-full items-center justify-center p-4 text-center"},be={class:"border-b px-3 py-3 flex items-center justify-between"},ve={class:"py-5 px-5 space-y-3"},ye={class:"flex bg-gray-50 border-l-4 border-l-100 rounded-r px-2 py-2 items-center space-x-2"},ge={class:"mt-3"},xe={class:"w-full"},Ce={class:"px-2 py-2 border-r"},Ie={class:"px-2 py-2"},Se={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function $e(_,n,f,h,i,s){const m=R,g=l("TransitionChild"),x=l("TicketIcon"),S=l("DialogTitle"),$=l("XMarkIcon"),q=ae,w=l("FormKit"),T=l("DialogPanel"),V=l("Dialog"),O=l("TransitionRoot");return u(),p("div",null,[e("div",null,[o(m,{icon:i.completeIcon,text:"Complete",color:"primary",click:()=>{s.handleClick()}},null,8,["icon","click"])]),o(O,{appear:"",show:i.open,as:"template"},{default:d(()=>[o(V,{as:"div",onClose:s.handleClick,class:"relative z-10"},{default:d(()=>[o(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:d(()=>n[1]||(n[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",he,[e("div",ke,[o(g,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:d(()=>[o(T,{class:"w-full max-w-4xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:d(()=>[e("div",be,[o(S,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:d(()=>[o(x,{class:"w-8 h-8 mr-2"}),n[2]||(n[2]=b(" Order Checkout "))]),_:1}),e("button",{onClick:n[0]||(n[0]=(...t)=>s.handleClick&&s.handleClick(...t))},[o($,{class:"w-5 h-5"})])]),o(w,{type:"form","submit-label":"Update",onSubmit:s.createStockOrder,actions:!1,id:"submitForm"},{default:d(({value:t})=>[e("div",ve,[e("div",ye,[o(x,{class:"h-5 w-5"}),e("p",null,[n[3]||(n[3]=b("Voucher Number: ")),e("strong",null,v((_._.provides[y]||_.$route).params.voucherId),1)])]),e("div",ge,[e("table",xe,[n[4]||(n[4]=e("thead",{clas:"w-full border-t border-l border-r"},[e("tr",{class:"border-b border-t border-r border-l rounded"},[e("th",{colspan:2,class:"text-left p-2"}," Requisitions ")]),e("tr",{class:"border-b border-t border-r border-l rounded"},[e("th",{class:"px-2 py-2 text-left border-r"}," Stock Item "),e("th",{class:"px-2 py-2 text-left"}," Quantity Being Requested ")])],-1)),e("tbody",null,[(u(!0),p(M,null,N(f.requisitions,(r,a)=>(u(),p("tr",{key:a,class:"border-b border-t border-r border-l rounded"},[e("td",Ce,v(r.stock_item.name),1),e("td",Ie,v(r.quantity_requested),1)]))),128))])])])]),e("div",Se,[o(q,{type:"button",click:()=>{},text:"Cancel"}),o(m,{loading:i.loading,type:"submit",click:()=>{},color:"success",icon:i.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const qe=W(fe,[["render",$e]]),we={class:"px-5 py-5"},Te={class:"py-5 flex items-center justify-between"},Ve={class:"text-2xl font-semibold"},Oe={class:"rounded border"},De={class:"flex rounded-t justify-between bg-gray-50 border-b px-2 py-2 cursor-text"},Be={class:"flex items-center space-x-2"},Fe={class:"px-5 py-5"},Me={class:"grid grid-cols-4 gap-4 mt-5"},Ne={class:"mt-8"},Ze=Z({__name:"[voucherId]",setup(_){pe({title:`${me.name.toUpperCase()} - Create Stock Order`});const n=ee(),f=I("Create Stock Order"),h=I([{name:"Home",link:"/home"},{name:"Stock Orders",link:"/stock-management/orders"}]),i=I(!1),s=te([]),m=I([]),g=A,x=_e,S=oe(()=>m.value.map(t=>t.name)),$=async()=>{i.value=!0;const t=new U,{data:r,error:a}=await t.getStockItem("");r.value&&(m.value=r.value),a.value&&console.error(a.value),i.value=!1},q=()=>{s.push({stock_item:{name:"",id:0},quantity_requested:0,id:0,batch_number:"",lot_number:""})},w=t=>{t>=0&&t<s.length&&s.splice(t,1)},T=(t,r)=>{const a=m.value.find(D=>D.name===t);a&&s[r]&&Object.assign(s[r].stock_item,{name:a.name,id:a.id})},V=t=>t.length===0?!1:t.every(r=>r.quantity_requested>0),O=t=>{t&&n.push("/stock-management/orders")};return se(()=>{$()}),(t,r)=>{const a=H,D=qe,F=R,P=ue,K=l("FormKit");return u(),p("div",we,[o(a,{pages:c(h)},null,8,["pages"]),e("div",Te,[e("h3",Ve,v(c(f)),1)]),e("div",Oe,[e("div",De,[e("div",Be,[o(c(j),{class:"h-5 w-5"}),e("p",null,[r[0]||(r[0]=b("Voucher Number: ")),e("strong",null,v((t._.provides[y]||t.$route).params.voucherId),1)])]),V(c(s))?(u(),re(D,{key:0,onUpdate:O,"voucher-id":`${(t._.provides[y]||t.$route).params.voucherId}`,requisitions:c(s)},null,8,["voucher-id","requisitions"])):ne("",!0)]),e("div",Fe,[r[1]||(r[1]=e("div",{class:"flex px-2 py-2 mb-4 rounded-r border-l-4 border-sky-100 bg-sky-50"},[b(" Click on the "),e("strong",{class:"mx-2"},'"Add Stock Item"'),b(" button to start creating your order requisition items ")],-1)),o(F,{icon:c(g),text:"Add Stock Item",color:"success",click:q},null,8,["icon"]),(u(!0),p(M,null,N(c(s),(C,B)=>(u(),p("div",{class:"flex flex-col space-y-3",key:B},[e("div",Me,[o(P,{label:"Stock item",items:c(S),"items-selected":C.stock_item.name,"onUpdate:itemsSelected":[k=>C.stock_item.name=k,k=>T(k,B)]},null,8,["items","items-selected","onUpdate:itemsSelected"]),o(K,{label:"Quantity requested",type:"number",validation:"required",modelValue:C.quantity_requested,"onUpdate:modelValue":k=>C.quantity_requested=k},null,8,["modelValue","onUpdate:modelValue"]),e("div",Ne,[o(F,{icon:c(x),text:"Delete",color:"error",click:()=>w(B)},null,8,["icon","click"])])])]))),128))])])])}}});export{Ze as default};
