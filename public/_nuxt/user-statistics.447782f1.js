import{_ as w}from"./Breadcrumb.b0c0412c.js";import{_ as R}from"./Dropdown.607d272b.js";import{u as S,a as y,_ as P,f as g,o as c,c as p,b as a,d as o,t as x,g as v,j as u,e as V}from"./entry.791399ec.js";import{_ as N}from"./SearchBar.3bd38df9.js";import{_ as C}from"./Datatable.3b86044c.js";import{u as D}from"./vue.f36acd1f.8530d91e.js";import{h as m,d as M,e as Y,f as I}from"./fetch.b60ef317.js";import{e as U}from"./constants.713ae7a7.js";import{P as L}from"./package.d411c004.js";import{k as j,w as A}from"./vue-doc-download.ab618b63.js";import{r as E}from"./MagnifyingGlassIcon.4c928ac3.js";import{r as B}from"./ArrowUpTrayIcon.3f5194d1.js";import{r as O}from"./ArrowPathIcon.04123d3a.js";import{_ as F}from"./stock_out.41f0adc7.js";import"./nuxt-link.1af0fd3d.js";import"./HomeIcon.bfaa9779.js";import"./listbox.e9c3a7ec.js";import"./hidden.63232384.js";import"./use-text-value.83d37c68.js";import"./CheckIcon.4b9566d6.js";import"./CheckCircleIcon.f3db3db8.js";import"./XMarkIcon.235914cb.js";import"./Loader.0e90c75f.js";import"./transition.f6288412.js";import"./PencilSquareIcon.ffacbd25.js";import"./PrinterIcon.9d4d78fd.js";const G={components:{MagnifyingGlassIcon:E,ExportToExcel:j,ExportToWord:A},setup(){D({title:`${L.name.toUpperCase()} - User Statistics Report`})},data(){return{title:"User Statistics Report",exportIcon:B,pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],reportTypes:[{name:"Summary"},{name:"Specimen Registry"},{name:"Patients Registry"},{name:"Tests Registry"},{name:"Tests Performed"}],reportTypeSelected:{name:"-- select report type --"},dateFrom:"",dateTo:"",search:"",searchValue:"",refreshIcon:O,statistics:new Array,cookie:S("token"),serverOptions:{page:1,rowsPerPage:25,sortBy:"name"},serverItemsLength:0,loading:!1}},computed:{headers(){const t={summary:[{text:"Name",value:"user",sortable:!0},{text:"Tests Received",value:"tests_received",sortable:!0},{text:"Specimen Collected",value:"specimen_collected",sortable:!0},{text:"Specimen Rejected",value:"specimen_rejected",sortable:!0},{text:"Tests Performed",value:"tests_completed",sortable:!0},{text:"Tests Authorized",value:"tests_authorized"}],"specimen registry":[{text:"Specimen Number",value:"id",sortable:!0},{text:"Name",value:"specimen",sortable:!0},{text:"Patient Number",value:"patient_no",sortable:!0},{text:"Name",value:"patient_no",sortable:!0},{text:"Date Registered",value:"created_date",sortable:!0}],"tests registry":[{text:"Test Type",value:"test_type_name",sortable:!0},{text:"Patient Number",value:"client.id",sortable:!0},{text:"Patient Name",value:"actions",sortable:!0},{text:"Specimen",value:"specimen_type",sortable:!0},{text:"Date Registered",value:"created_date"}],"patients registry":[{text:"Patient Number",value:"id",sortable:!0},{text:"Name",value:"actions",sortable:!0},{text:"Gender",value:"sex",sortable:!0},{text:"Age",value:"age",sortable:!0},{text:"Date Registered",value:"created_date",sortable:!0}],"tests performed":[{text:"Test Id",value:"test_id",sortable:!0},{text:"Test Type",value:"test_type",sortable:!0},{text:"Patient No",value:"patient_no",sortable:!0},{text:"Patient Name",value:"patient_name",sortable:!0},{text:"Accession Number",value:"accession_number",sortable:!0},{text:"Date Registered",value:"created_date"}]},s=this.reportTypeSelected.name.toLowerCase();return t[s]||[]},filteredStatistics(){return this.statistics.map(t=>({...t,created_date:m(t.created_date).format("DD/MMM/YYYY"),age:M(t.date_of_birth)}))},dataSeachValue(){const t={"tests performed":"test_type","patients registry":"actions","tests registry":"test_type_name","specimen registry":"specimen",summary:"user"},s=this.reportTypeSelected.name.toLowerCase();return t[s]||""}},methods:{async generateReport(){this.loading=!0;let t=this.dateFrom!=""?m(this.dateFrom).format("YYYY-MM-DD"):"",s=this.dateTo!=""?m(this.dateTo).format("YYYY-MM-DD"):"";const{page:_,rowsPerPage:h}=this.serverOptions;let e=`from=${t}&to=${s}&report_type=${this.checkReportType(this.reportTypeSelected).toLocaleLowerCase()}&page=${_}&limit=${h}`;const n={route:`${Y.aggregateReports}user_statistics?${e}`,method:"GET",token:`${this.cookie}`},{data:i,error:l,pending:d}=await I(n);this.loading=d,i.value&&(this.loading=!1,this.statistics=i.value.data.tests,this.serverItemsLength=i.value.data.metadata.total_count,y().$toast.success("Report data generated successfully")),l.value&&(this.loading=!1,console.error(l.value),y().$toast.success(U))},checkReportType(t){return t.name=="-- select report type --"?"":t.name},updateReport(t){typeof t=="object"&&(this.serverOptions=t),this.generateReport()},update(t){this.seach=t,this.searchValue=t}},watch:{reportTypeSelected:{handler(){this.statistics=new Array},deep:!0}}},q={class:"px-5 py-5"},W={class:"flex items-center justify-between py-5"},z={class:"text-2xl font-semibold"},H={class:"w-full flex items-center justify-between mb-5"},J={class:"w-full flex items-center space-x-3"},K={class:"w-48 space-y-2"},Q={class:"w-48 space-y-2"},X={class:"w-48 space-y-2"},Z={class:"w-48"},$={class:"flex justify-end w-full px-2 py-2 mb-2"},ee={key:0,class:"flex justify-end w-full px-2 py-2 mb-2"},te={key:1,id:"print-container"},se={key:2,class:"flex flex-col space-y-3 items-center justify-center"},re=o("img",{src:F,class:"w-20 h-20"},null,-1),oe=o("p",{class:"font-medium"},"Please generate report data to preview the report",-1),ae=[re,oe];function ne(t,s,_,h,e,n){const i=w,l=g("datepicker"),d=R,f=V,b=g("ExportToWord"),T=N,k=C;return c(),p("div",q,[a(i,{pages:e.pages},null,8,["pages"]),o("div",W,[o("h3",z,x(e.title),1)]),o("div",H,[o("div",J,[o("div",K,[a(l,{position:"left",placeholder:"-- start date --",range:!1,"input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateFrom,"onUpdate:modelValue":s[0]||(s[0]=r=>e.dateFrom=r),format:"dd/MM/yyyy"},null,8,["modelValue"])]),o("div",Q,[a(l,{placeholder:"-- end date --",range:!1,"input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:e.dateTo,"onUpdate:modelValue":s[1]||(s[1]=r=>e.dateTo=r),format:"dd/MM/yyyy"},null,8,["modelValue"])]),o("div",X,[a(d,{items:e.reportTypes,modelValue:e.reportTypeSelected,"onUpdate:modelValue":s[2]||(s[2]=r=>e.reportTypeSelected=r)},null,8,["items","modelValue"])]),o("div",Z,[a(f,{color:"success",text:"Generate Report",icon:e.refreshIcon,click:()=>n.generateReport(),loading:e.loading},null,8,["icon","click","loading"])])]),o("div",$,[a(b,{element:"print-container",filename:"document"},{default:v(()=>[a(f,{text:"Export",color:"success",icon:e.exportIcon,click:()=>{}},null,8,["icon"])]),_:1})])]),e.statistics.length>0?(c(),p("div",ee,[a(T,{search:e.search,"onUpdate:search":s[3]||(s[3]=r=>e.search=r),onUpdate:n.update},null,8,["search","onUpdate"])])):u("",!0),e.statistics.length>0?(c(),p("div",te,[a(k,{headers:n.headers,data:n.filteredStatistics,serverItemsLength:e.serverItemsLength,serverOptions:e.serverOptions,loading:e.loading,"search-field":n.dataSeachValue,"search-value":e.searchValue,onUpdate:n.updateReport},{actions:v(({item:r})=>[o("p",null,x(e.reportTypeSelected.name.toLowerCase()=="patients registry"?`${r.first_name}
                                            ${r.middle_name} ${r.last_name}`:`${r.client.first_name} ${r.client.middle_name}
                                            ${r.client.last_name}`),1)]),_:1},8,["headers","data","serverItemsLength","serverOptions","loading","search-field","search-value","onUpdate"])])):u("",!0),e.statistics.length==0?(c(),p("div",se,ae)):u("",!0)])}const Ye=P(G,[["render",ne]]);export{Ye as default};
