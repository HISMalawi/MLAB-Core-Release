import{_ as _t}from"./Cjy89chx.js";import{b as f,e as S,g as e,d as Se,r as c,I as ke,a as Oe,w as ve,x as se,f as n,h as t,y as b,Y as Te,p as ce,G as Ve,V as Me,j as ie,q as De,S as Le,l as K,m as W,u as pe,E as re,_ as we,A as ne,c as yt,b6 as ht,C as G,i as Ke,v as it,bt,t as A,ap as Ge,ao as ct,z as _e,X as lt,W as wt,J as Qe,aE as xt,F as Ce,k as $e,H as me,aJ as ut,av as gt,b1 as Ct,n as $t,aH as kt,s as St,$ as nt,bp as Tt,R as Vt,o as rt,bu as Mt,bv as Dt}from"./Dq6GAKbi.js";import{_ as dt}from"./aL3Laz_N.js";import{_ as Lt,a as jt}from"./uLMXU4Yv.js";import{_ as At}from"./B75xAycs.js";import{_ as Ht}from"./C5aNvNlb.js";import{_ as Ue}from"./DSfYjN7g.js";import{r as ot}from"./D5QMWYSq.js";import{r as Pe}from"./CyEda1vY.js";import{u as mt}from"./B9wtpvPg.js";import{u as qe}from"./DausA3Fa.js";import{P as tt,u as Rt}from"./wT5fWcyP.js";import{r as pt}from"./BqtKM9rz.js";import{r as st}from"./-0aQroE5.js";import{r as qt}from"./B-Z5sfJU.js";import{r as Ot}from"./B_rQD4tC.js";import{r as Ut}from"./BxpGzns0.js";import{r as Pt}from"./nhR7A2Xt.js";import{_ as Ft}from"./DwzG69rt.js";import{_ as Nt}from"./CBANAzjR.js";import{u as Et}from"./B-asOVRT.js";import{P as Bt}from"./Cym2IAMG.js";import{u as zt}from"./BrH0U_CL.js";import{r as It}from"./COwjCBK1.js";import{r as Zt}from"./ByBrz7Qz.js";import{r as Wt}from"./CVfhGWHK.js";import{r as Yt}from"./SR-hCNaz.js";import{r as Gt,a as Kt}from"./Dc-Ziquj.js";import"./CCv5i2WQ.js";import"./E1BQBXOe.js";import"./DD5ohXvj.js";import"./V6O_Nsr-.js";import"./Bzq-bUMT.js";import"./B9U-_Lex.js";import"./B0f6nJlG.js";import"./FeIzrERn.js";import"./cn4mwiMo.js";import"./CmfTMOIT.js";import"./HOxJZgwd.js";import"./D4QpeBrC.js";function ft(Q,m){return f(),S("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 0 0 0-1.5h-3.75V6Z","clip-rule":"evenodd"})])}function et(Q,m){return f(),S("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M15.73 5.5h1.035A7.465 7.465 0 0 1 18 9.625a7.465 7.465 0 0 1-1.235 4.125h-.148c-.806 0-1.534.446-2.031 1.08a9.04 9.04 0 0 1-2.861 2.4c-.723.384-1.35.956-1.653 1.715a4.499 4.499 0 0 0-.322 1.672v.633A.75.75 0 0 1 9 22a2.25 2.25 0 0 1-2.25-2.25c0-1.152.26-2.243.723-3.218.266-.558-.107-1.282-.725-1.282H3.622c-1.026 0-1.945-.694-2.054-1.715A12.137 12.137 0 0 1 1.5 12.25c0-2.848.992-5.464 2.649-7.521C4.537 4.247 5.136 4 5.754 4H9.77a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23ZM21.669 14.023c.536-1.362.831-2.845.831-4.398 0-1.22-.182-2.398-.52-3.507-.26-.85-1.084-1.368-1.973-1.368H19.1c-.445 0-.72.498-.523.898.591 1.2.924 2.55.924 3.977a8.958 8.958 0 0 1-1.302 4.666c-.245.403.028.959.5.959h1.053c.832 0 1.612-.453 1.918-1.227Z"})])}function Qt(Q,m){return f(),S("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z","clip-rule":"evenodd"})])}function Xt(Q,m){return f(),S("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.625 9.75a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375m-13.5 3.01c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.184-4.183a1.14 1.14 0 0 1 .778-.332 48.294 48.294 0 0 0 5.83-.498c1.585-.233 2.708-1.626 2.708-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0 0 12 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018Z"})])}function Jt(Q,m){return f(),S("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 10.5v6m3-3H9m4.06-7.19-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z"})])}const es={class:"fixed inset-0 overflow-y-auto"},ts={class:"flex min-h-full items-center justify-center p-4 text-center"},ss={class:"border-b px-3 py-3 flex items-center justify-between"},os={class:"mt-2 space-y-3 pb-40"},as={class:"w-full flex flex-col space-y-2 px-5"},ls={class:"w-full flex flex-col space-y-2 px-5"},ns={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},rs=Se({__name:"index",props:{item:{}},emits:["update"],setup(Q,{emit:m}){const O=m,g=Q,C=c(!1),U=ot,le=Pe,H=c([]),V=c(!1),l=c([]),M=c([]),D=c([]),z=ke(),E=c("-- select department"),F=Oe("token"),R=ke(),N=c(0);async function X(){k();const I=R.department,u=R.user.departments.find(a=>a.name===I);u&&(N.value=Number(u.id)),E.value=I,D.value=R.user.departments,await B(N.value)}async function B(I){var T;const u=(T=g.item.client)!=null&&T.sex.match(/f/i)?"Female":"Male",a={route:`${K.specimenTestTypes}?department_id=${I}&specimen_id=${g.item.specimen_id}&sex=${u}`,method:"GET",token:`${F.value}`},{error:p,data:_}=await W(a);_.value&&(M.value=_.value,l.value=_.value),p.value&&console.error("error: ",p.value)}async function ae(){V.value=!0;let I=H.value.map(T=>({specimen:g.item.specimen_id,test_type:T}));const u=z.locations.find(T=>T.name===z.selectedLocation);if(!u){pe().$toast.error("Location not found"),V.value=!1;return}const a={route:`${K.addTestOrder}`,method:"POST",token:`${F.value}`,body:{order_id:g.item.order_id,lab_location:(u==null?void 0:u.id)||0,tests:I}},{data:p,error:_}=await W(a);p.value&&(pe().$toast.success("Tests added to current order successfully!"),V.value=!1,O("update",!0),k()),_.value&&(k(),console.error("error: ",_.value),pe().$toast.error(re),V.value=!1)}function k(){C.value=!C.value}function te(){H.value=[]}return ve(E,(I,u)=>{if(I!==u){const a=R.user.departments.find(p=>p.name===I);a&&(N.value=Number(a.id),B(N.value))}}),(I,u)=>{const a=we,p=se("multi-select"),_=Ue,T=se("FormKit");return f(),S("div",null,[e("div",null,[n(a,{text:"Add test to current order",color:"warning",icon:t(U),click:()=>{X()}},null,8,["icon","click"])]),n(t(Le),{appear:"",show:C.value,as:"template"},{default:b(()=>[n(t(Te),{as:"div",onClose:k,class:"relative z-10"},{default:b(()=>[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>u[2]||(u[2]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",es,[e("div",ts,[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(t(Ve),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",ss,[n(t(Me),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:b(()=>u[3]||(u[3]=[e("svg",{class:"w-6 h-6 mr-2",xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64"},[e("path",{fill:"currentColor",d:"M43.191 40.403h5.498a.775.775 0 1 0 0-1.55h-5.498a.775.775 0 0 0 0 1.55m12.544-23.651H36.222V32.08h19.513zM54.319 30.78H37.622V18.059h16.697zM22.771 17.262H19.6v3.171h-3.171v3.171H19.6v3.171h3.171v-3.171h3.17v-3.171h-3.17z"}),e("path",{fill:"currentColor",d:"M43.191 22.323h5.498a.775.775 0 0 0 0-1.55h-5.498a.775.775 0 0 0 0 1.55"}),e("path",{fill:"currentColor",d:"M55.612.547H9.042C4.479.547.766 4.26.766 8.825v46.568c0 4.565 3.713 8.278 8.276 8.278h46.57c4.564 0 8.277-3.712 8.277-8.278V8.825c0-4.564-3.714-8.278-8.277-8.278M9.252 11.361v10.416H7.693a.533.533 0 0 1-.534-.534V7.802c0-.455.339-.825.805-.825h6.887c.464 0 .805.369.805.824v.789h10.648c.296 0 .534.239.534.532v3.023h-9.089v-.791c0-.454-.339-.823-.807-.823h-6.883c-.467 0-.806.375-.806.831zM30.49 28.617H11.881a.53.53 0 0 1-.534-.532V14.644c0-.455.339-.825.804-.825h6.885c.466 0 .807.369.807.823v.789H30.49c.296 0 .534.239.534.532v12.121a.53.53 0 0 1-.535.532zm26.644 27.286H34.828V15.316h22.306z"}),e("path",{fill:"currentColor",d:"M55.735 34.831H36.222v15.33h19.513zm-1.406 14.022H37.634V36.135h16.695z"})],-1),ie(" Add Test To Current Order ")])),_:1}),e("button",{onClick:k},[n(t(De),{class:"w-5 h-5"})])]),n(T,{type:"form","submit-label":"Update",onSubmit:ae,actions:!1,id:"submitForm"},{default:b(()=>[e("div",os,[e("div",as,[u[4]||(u[4]=e("label",{class:"font-medium"},"Department",-1)),n(p,{style:{"--ms-max-height":"none !important"},modelValue:E.value,"onUpdate:modelValue":u[0]||(u[0]=h=>E.value=h),options:D.value.map(h=>h.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),e("div",ls,[u[5]||(u[5]=e("label",{class:"font-medium"},"Tests",-1)),n(p,{style:{"--ms-max-height":"none !important"},modelValue:H.value,"onUpdate:modelValue":u[1]||(u[1]=h=>H.value=h),options:l.value,mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",ns,[n(_,{type:"button",click:()=>te(),text:"Clear form"},null,8,["click"]),n(a,{loading:V.value,type:"submit",click:()=>{},color:"success",icon:t(le),text:"Save changes"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),is={class:"fixed inset-0 overflow-y-auto"},cs={class:"flex min-h-full items-center justify-center p-4 text-center"},us={class:"border-b px-3 py-3 flex items-center justify-between"},ds={class:"mt-2 space-y-3 pb-40"},ms={class:"w-full flex flex-col space-y-2 px-5"},ps={class:"w-full flex flex-col space-y-2 px-5"},fs={class:"w-full flex flex-col space-y-2 px-5"},vs={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},_s=Se({__name:"index",props:{color:{},item:{}},emits:["update"],setup(Q,{emit:m}){const O=m,g=Q,C=c(!1),U=ot,le=Pe,H=c(!1),V=c([]),l=c([]),M=c([]),D=c([]),z=ke(),{getSpecimenDisplayName:E}=mt(),F=c("-- select department"),R=c(""),N=c([]),X=c([]),B=Oe("token"),ae=ke(),k=c(0),{$toast:te}=pe();async function I(){_();const h=ae.department,w=ae.user.departments.find(v=>v.name===h);w&&(k.value=Number(w.id)),F.value=h,D.value=ae.user.departments,await u(k.value)}async function u(h){var y;const w=(y=g.item.client)!=null&&y.sex.match(/f/i)?"Female":"Male",v={route:`${K.specimens}?department_id=${h}&specimen_id=${g.item.specimen_id}&sex=${w}`,method:"GET",token:`${B.value}`},{error:$,data:J}=await W(v);J.value&&(l.value=J.value,V.value=J.value.map(P=>E(P.name,P.preferred_name))),$.value&&console.error("error: ",$.value)}async function a(){var y;if(!R.value){X.value=[];return}const h=l.value.find(P=>E(P.name,P.preferred_name)===R.value);if(!h){X.value=[];return}const w=(y=g.item.client)!=null&&y.sex.match(/f/i)?"Female":"Male",v={route:`specimen/test_types?specimen_id=${h.id}&department_id=${k.value}&sex=${w}`,method:"GET",token:`${B.value}`},{error:$,data:J}=await W(v);J.value&&(M.value=J.value,X.value=J.value,N.value=[]),$.value&&(console.error("error: ",$.value),X.value=[])}async function p(){H.value=!0;const h=l.value.find(P=>E(P.name,P.preferred_name)===R.value);if(!h){te.error("Please select a valid specimen"),H.value=!1;return}let w=N.value.map(P=>({specimen:h.id.toString(),test_type:P}));const v=z.locations.find(P=>P.name===z.selectedLocation);if(!v){te.error("Location not found"),H.value=!1;return}const $={route:`${K.addOrderToEncounter}`,method:"POST",token:`${B.value}`,body:{encounter_id:g.item.encounter_id,lab_location:(v==null?void 0:v.id)||0,tests:w}},{data:J,error:y}=await W($);J.value&&(H.value=!1,O("update",J.value),_()),y.value&&(_(),console.error("error: ",y.value),te.error(re),H.value=!1)}function _(){C.value=!C.value}function T(){R.value="",N.value=[],X.value=[]}return ve(F,(h,w)=>{if(h!==w){const v=ae.user.departments.find($=>$.name===h);v&&(k.value=Number(v.id),u(k.value),R.value="",N.value=[],X.value=[])}}),ve(R,()=>{a()}),(h,w)=>{const v=we,$=se("multi-select"),J=Ue,y=se("FormKit");return f(),S("div",null,[e("div",null,[n(v,{text:"Add order to encounter",color:g.color,icon:t(U),click:()=>{I()}},null,8,["color","icon","click"])]),n(t(Le),{appear:"",show:t(C),as:"template"},{default:b(()=>[n(t(Te),{as:"div",onClose:_,class:"relative z-10"},{default:b(()=>[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>w[3]||(w[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",is,[e("div",cs,[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(t(Ve),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",us,[n(t(Me),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:b(()=>w[4]||(w[4]=[e("svg",{class:"w-6 h-6 mr-2",xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64"},[e("path",{fill:"currentColor",d:"M43.191 40.403h5.498a.775.775 0 1 0 0-1.55h-5.498a.775.775 0 0 0 0 1.55m12.544-23.651H36.222V32.08h19.513zM54.319 30.78H37.622V18.059h16.697zM22.771 17.262H19.6v3.171h-3.171v3.171H19.6v3.171h3.171v-3.171h3.17v-3.171h-3.17z"}),e("path",{fill:"currentColor",d:"M43.191 22.323h5.498a.775.775 0 0 0 0-1.55h-5.498a.775.775 0 0 0 0 1.55"}),e("path",{fill:"currentColor",d:"M55.612.547H9.042C4.479.547.766 4.26.766 8.825v46.568c0 4.565 3.713 8.278 8.276 8.278h46.57c4.564 0 8.277-3.712 8.277-8.278V8.825c0-4.564-3.714-8.278-8.277-8.278M9.252 11.361v10.416H7.693a.533.533 0 0 1-.534-.534V7.802c0-.455.339-.825.805-.825h6.887c.464 0 .805.369.805.824v.789h10.648c.296 0 .534.239.534.532v3.023h-9.089v-.791c0-.454-.339-.823-.807-.823h-6.883c-.467 0-.806.375-.806.831zM30.49 28.617H11.881a.53.53 0 0 1-.534-.532V14.644c0-.455.339-.825.804-.825h6.885c.466 0 .807.369.807.823v.789H30.49c.296 0 .534.239.534.532v12.121a.53.53 0 0 1-.535.532zm26.644 27.286H34.828V15.316h22.306z"}),e("path",{fill:"currentColor",d:"M55.735 34.831H36.222v15.33h19.513zm-1.406 14.022H37.634V36.135h16.695z"})],-1),ie(" Add Order To Encounter ")])),_:1}),e("button",{onClick:_},[n(t(De),{class:"w-5 h-5"})])]),n(y,{type:"form","submit-label":"Update",onSubmit:p,actions:!1,id:"submitForm"},{default:b(()=>[e("div",ds,[e("div",ms,[w[5]||(w[5]=e("label",{class:"font-medium"},"Department",-1)),n($,{style:{"--ms-max-height":"none !important"},modelValue:t(F),"onUpdate:modelValue":w[0]||(w[0]=P=>ne(F)?F.value=P:null),options:t(D).map(P=>P.name),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),e("div",ps,[w[6]||(w[6]=e("label",{class:"font-medium"},"Specimen",-1)),n($,{style:{"--ms-max-height":"none !important"},modelValue:t(R),"onUpdate:modelValue":w[1]||(w[1]=P=>ne(R)?R.value=P:null),options:t(V),searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])]),e("div",fs,[w[7]||(w[7]=e("label",{class:"font-medium"},"Test Types",-1)),n($,{style:{"--ms-max-height":"none !important"},modelValue:t(N),"onUpdate:modelValue":w[2]||(w[2]=P=>ne(N)?N.value=P:null),options:t(X),mode:"tags",searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",vs,[n(J,{type:"button",click:()=>T(),text:"Clear form"},null,8,["click"]),n(v,{loading:t(H),type:"submit",click:()=>{},color:"success",icon:t(le),text:"Save changes"},null,8,["loading","icon"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),ys="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M27%2015V4H10C9.44772%204%209%204.44772%209%205V43C9%2043.5523%209.44772%2044%2010%2044H38C38.5523%2044%2039%2043.5523%2039%2043V16H28C27.4477%2016%2027%2015.5523%2027%2015ZM29%2014V4.58579L38.4142%2014H29ZM17%2019C17%2018.4477%2017.4477%2018%2018%2018H23C25.2091%2018%2027%2019.7909%2027%2022C27%2024.0759%2025.4186%2025.7825%2023.3948%2025.9808L27%2029.5859L30.2929%2026.293L31.7072%2027.7072L28.4142%2031.0001L31.7071%2034.293L30.2928%2035.7072L27%2032.4143L23.7072%2035.7072L22.2929%2034.293L25.5858%2031.0001L20.5857%2026H19V33H17V25V19ZM23%2024H19V20H23C24.1046%2020%2025%2020.8954%2025%2022C25%2023.1046%2024.1046%2024%2023%2024Z'%20fill='currentColor'/%3e%3c/svg%3e",hs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M19%204C18.4477%204%2018%204.44772%2018%205V8C18%208.55228%2018.4477%209%2019%209H20V11.2729C19.4174%2011.4788%2019%2012.0344%2019%2012.6875V39C19%2041.7614%2021.2386%2044%2024%2044C26.7614%2044%2029%2041.7614%2029%2039V12.6875C29%2012.0344%2028.5826%2011.4788%2028%2011.2729V9H29C29.5523%209%2030%208.55228%2030%208V5C30%204.44772%2029.5523%204%2029%204H19ZM22%2011.6875V9H26V11.6875C26%2012.3406%2026.4174%2012.8962%2027%2013.1021V18H21V13.1021C21.5826%2012.8962%2022%2012.3406%2022%2011.6875Z'%20fill='currentColor'/%3e%3c/svg%3e",bs="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M28.7526%206.3415C28.4782%206.02797%2028.0383%205.91736%2027.6483%206.0639C27.2583%206.21043%2027%206.58339%2027%207V14C27%2015.1046%2027.8954%2016%2029%2016H35C35.3924%2016%2035.7485%2015.7705%2035.9106%2015.4132C36.0728%2015.0559%2036.011%2014.6368%2035.7526%2014.3415L28.7526%206.3415ZM20.75%2023H19.25L20%2021.2L20.75%2023ZM27.5576%205L37%2015.3866V40C37%2041.6569%2035.6569%2043%2034%2043H14C12.3431%2043%2011%2041.6569%2011%2040V8C11%206.34315%2012.3431%205%2014%205H27.5576ZM21.8462%2015.2308C21.5356%2014.4855%2020.8074%2014%2020%2014C19.1926%2014%2018.4644%2014.4855%2018.1538%2015.2308L13.1538%2027.2308C12.729%2028.2504%2013.2112%2029.4213%2014.2308%2029.8462C15.2504%2030.271%2016.4213%2029.7888%2016.8462%2028.7692L17.5833%2027H22.4167L23.1538%2028.7692C23.5787%2029.7888%2024.7496%2030.271%2025.7692%2029.8462C26.7888%2029.4213%2027.271%2028.2504%2026.8462%2027.2308L26.7432%2026.9837C26.8273%2026.9944%2026.913%2027%2027%2027H28V28C28%2029.1046%2028.8954%2030%2030%2030C31.1046%2030%2032%2029.1046%2032%2028V27H33C34.1046%2027%2035%2026.1046%2035%2025C35%2023.8954%2034.1046%2023%2033%2023H32V22C32%2020.8954%2031.1046%2020%2030%2020C28.8954%2020%2028%2020.8954%2028%2022V23H27C26.3521%2023%2025.7762%2023.3081%2025.4107%2023.7857L21.8462%2015.2308ZM15%2031C13.8954%2031%2013%2031.8954%2013%2033C13%2034.1046%2013.8954%2035%2015%2035C13.8954%2035%2013%2035.8954%2013%2037C13%2038.1046%2013.8954%2039%2015%2039H27C28.1046%2039%2029%2038.1046%2029%2037C29%2035.8962%2028.1058%2035.0012%2027.0023%2035H33C34.1046%2035%2035%2034.1046%2035%2033C35%2031.8954%2034.1046%2031%2033%2031L15%2031Z'%20fill='currentColor'%20stroke='%23333333'%20stroke-width='2'%20stroke-linejoin='round'/%3e%3c/svg%3e",vt="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M40%2024.0005C40%2027.3142%2037.3137%2030.0005%2034%2030.0005H32.566L27.7629%2024.9453C27.9142%2024.6638%2028%2024.3419%2028%2024C28%2022.8954%2027.1046%2022%2026%2022H24.9645L21.1644%2018.0005H34C37.3137%2018.0005%2040%2020.6868%2040%2024.0005ZM36%2023.9995C36%2023.1711%2035.3284%2022.4995%2034.5%2022.4995C33.6716%2022.4995%2033%2023.1711%2033%2023.9995C33%2024.8279%2033.6716%2025.4995%2034.5%2025.4995C35.3284%2025.4995%2036%2024.8279%2036%2023.9995ZM30.752%2023.25C31.1673%2023.25%2031.504%2023.5858%2031.504%2024C31.504%2024.4142%2031.1673%2024.75%2030.752%2024.75C30.3367%2024.75%2030%2024.4142%2030%2024C30%2023.5858%2030.3367%2023.25%2030.752%2023.25Z'%20fill='%23333333'/%3e%3cpath%20d='M12%2024C12%2022.8954%2012.8954%2022%2014%2022H16.6881L12.9715%2018.0883C10.1478%2018.5761%208%2021.0375%208%2024.0005C8%2027.3142%2010.6863%2030.0005%2014%2030.0005H24.2896L20.4886%2026H14C12.8954%2026%2012%2025.1046%2012%2024Z'%20fill='%23333333'/%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M44%2024C44%2035.0457%2035.0457%2044%2024%2044C12.9543%2044%204%2035.0457%204%2024C4%2012.9543%2012.9543%204%2024%204C35.0457%204%2044%2012.9543%2044%2024ZM42%2024C42%2029.1085%2039.8719%2033.7199%2036.4539%2036.9962L11.6573%2010.8981C14.8798%207.86121%2019.2226%206%2024%206C33.9411%206%2042%2014.0589%2042%2024ZM24%2042C28.1125%2042%2031.9028%2040.6209%2034.9338%2038.2999L10.2781%2012.35C7.60984%2015.4897%206%2019.5569%206%2024C6%2033.9411%2014.0589%2042%2024%2042Z'%20fill='%23333333'/%3e%3c/svg%3e",ws={key:0},xs={class:"fixed inset-0 overflow-y-auto"},gs={class:"flex min-h-full items-center justify-center text-center"},Cs={class:"border-b px-3 py-3 flex items-center justify-between"},$s={class:"flex items-center justify-center mx-auto my-20"},ks={class:"grid grid-cols-3 gap-4 px-5 py-5"},Ss={class:"rounded border"},Ts={class:"w-full space-y-2 py-2"},Vs={class:"w-full flex justify-between px-4 py-1"},Ms={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Ds={class:"w-full flex justify-between px-4 py-1"},Ls={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},js={key:0,class:"w-full flex justify-between px-4 py-1"},As={class:"rounded border"},Hs={class:"w-full space-y-2 py-2"},Rs={class:"w-full flex justify-between px-4 py-1"},qs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Os={class:"w-full flex justify-between px-4 py-1"},Us={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Ps={class:"w-full flex justify-between px-4 py-1"},Fs={class:"rounded border max-h-72 overflow-y-auto"},Ns={class:"w-full space-y-2 py-2"},Es={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Bs={class:"w-full flex justify-between px-4 py-1"},zs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Is={class:"w-full flex justify-between px-4 py-1"},Zs={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},Ws={class:"flex items-center space-x-2 relative"},Ys={class:"relative"},Gs={class:"truncate"},Ks={key:0,class:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg z-50 max-h-60 overflow-hidden"},Qs={class:"p-2 border-b"},Xs={class:"max-h-40 overflow-y-auto"},Js=["onMousedown"],eo={key:0,class:"px-3 py-2 text-sm text-gray-500 italic"},to={key:0,class:"flex items-center"},so={key:1,class:"text-xs text-gray-500",title:"Ward can only be edited within 24 hours of test creation"},oo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},ao={class:"w-full flex justify-between px-4 py-1"},lo={class:"w-full flex justify-between px-4 py-2 bg-gray-50 border-b border-t border-dotted"},no={class:"mx-5 rounded border mb-5"},ro={class:"flex items-center justify-between bg-gray-50 px-4 py-2 border-b rounded-t"},io={class:"justify-end flex items-center space-x-3"},co={key:0},uo={class:"font-medium"},mo={class:"flex items-center space-x-1"},po=["innerHTML"],fo={key:1,class:"text-xs"},vo={key:1,class:"px-4 py-2 flex items-center"},_o={class:"text-lg font-semibold"},yo={class:"text-base text-gray-600 font-normal"},ho={key:2,class:"px-2.5 py-2.5 border-t"},bo={key:3},wo={class:"w-full px-5 py-2 border-b border-dotted flex justify-between items-center"},xo={class:"w-full px-5 py-2 border-b border-dotted flex justify-between items-center"},go={class:"w-full px-5 py-2 border-b border-dotted flex justify-between items-center"},Co={class:"w-full px-5 py-2 border-b border-dotted flex justify-between items-center"},$o=Se({__name:"index",props:{open:{type:Boolean,required:!1}},emits:["update","order"],setup(Q,{expose:m,emit:O}){const g=Q,C=O,{getSpecimenDisplayName:U,getTestTypeDisplayName:le,getDisplayName:H}=mt(),V=c(g.open),l=c({}),M=c(!1),D=c(!1),z=c(!1),E=pt,F=st,R=qt,N=Oe("token"),X=ke(),B=pe();async function ae(d){M.value=!0;const[o]=await Promise.all([W({route:`${K.tests}/${d.id}`,method:"GET",token:`${N.value}`}),w()]);if(M.value=o.pending.value,o.data.value){l.value=o.data.value,te.value=l.value.requesting_ward||"";const j=k.value.find(ee=>ee.name===te.value);a.value=(j==null?void 0:j.id)||null,typeof l.value=="object"&&xe()}o.error.value&&(M.value=!1,console.error(o.error.value),B.$toast.error(re))}const k=c([]),te=c(""),I=c(!1),u=c(!1),a=c(null),p=c(""),_=c(!1),T=c(null),h=yt(()=>p.value.trim()?k.value.filter(d=>d.name.toLowerCase().includes(p.value.toLowerCase())):k.value);async function w(){I.value=!0;try{const d={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:`${N.value}`},{data:o,error:j}=await W(d);o.value&&(k.value=o.value),j.value&&(console.error("Error fetching wards:",j.value),B.$toast.error("Failed to load wards"))}catch(d){console.error("Failed to fetch wards:",d),B.$toast.error("Failed to load wards")}finally{I.value=!1}}function v(){var ee,Y;if(!((ee=l.value)!=null&&ee.created_date)||((Y=l.value)==null?void 0:Y.status.toLowerCase())=="verified")return!1;const d=new Date(l.value.created_date);return(new Date().getTime()-d.getTime())/(1e3*60*60)<=72}async function $(){var d;if(!((d=l.value)!=null&&d.encounter_id)||!a.value){B.$toast.error("Invalid ward selection");return}if(!v()){B.$toast.error("Ward can only be edited within 24 hours of test creation");return}u.value=!0;try{const o={route:`${K.encounters}/${l.value.encounter_id}`,method:"PUT",token:`${N.value}`,body:{encounter:{facility_section_id:a.value}}},{data:j,error:ee}=await W(o);if(j.value){const Y=k.value.find(s=>s.id===a.value);Y&&(te.value=Y.name,l.value.requesting_ward=Y.name),B.$toast.success("Ward updated successfully")}ee.value&&(console.error("Error updating ward:",ee.value),B.$toast.error("Failed to update ward"))}catch(o){console.error("Failed to update ward:",o),B.$toast.error("Failed to update ward")}finally{u.value=!1}}function J(d){const o=d.target,j=k.value.find(ee=>ee.name===o.value);j&&(a.value=j.id,$())}function y(d){te.value=d.name,a.value=d.id,_.value=!1,p.value="",$()}function P(){!v()||u.value||(_.value=!0,p.value="",gt(()=>{var d;(d=T.value)==null||d.focus()}))}function ue(){setTimeout(()=>{_.value=!1,p.value=""},150)}function ye(d){if(d.key==="Escape")ue();else if(d.key==="Enter"){const o=h.value[0];o&&y(o)}}async function Fe(){const d={route:K.printOutZebra,method:"POST",token:`${N.value}`,body:{order_id:l.value.order_id,tests:[l.value.id],is_cross_match:!0}},{data:o,error:j,pending:ee}=await W(d);if(z.value=ee.value,o.value){z.value=!1;const Y=new FileReader;Y.onload=()=>{const s=URL.createObjectURL(o.value),r=document.createElement("a");r.href=s,r.setAttribute("download",`${Date.now()}.lbl`),r.click(),URL.revokeObjectURL(s)},Y.readAsText(o.value),B.$toast.success("Results printed successfully!")}j.value&&(z.value=!1,B.$toast.error(re),console.error(j.value))}async function je(d,o){D.value=!0;const j={route:`${K.testStatus}/${o}/${d}`,method:"PUT",token:`${N.value}`},{data:ee,error:Y,pending:s}=await W(j);D.value=s.value,ee.value&&(D.value=!1,B.$toast.success(`${l.value.test_type_name} test for ${l.value.client.first_name} ${l.value.client.middle_name!==null?l.value.client.middle_name:""} ${l.value.client.last_name} verified successfully!`),He(!0)),Y.value&&(console.error(Y.value),D.value=!1)}function Ae(){C("update",!0)}function fe(d){C("order",d),xe()}function xe(){V.value=!V.value}function Ne(){return tt.printSpecimenLabel(l.value.accession_number)}function Ee(){return tt.printTrackingNumber(l.value.tracking_number)}function He(d=!1){return Ct(`/reports/daily/patient-report/${l.value.client.id}?order_id=${l.value.order_id}&printer=${d}&encounter_id=${l.value.encounter_id}`)}function Be(d){let o="";return d.forEach(j=>{j.status.name==="pending"&&(o=`${j.initiator.first_name} ${j.initiator.last_name}`)}),Ge(o)}function Re(d){return new Set(["voided","test-rejected","rejected","not-done"]).has(d.toLowerCase())}function ze(d){const o=X.user,j=d.completed_by;if(j){if(j.id!==o.id)return!0;if(j.is_super_admin===!0)return!0}return!1}function Ie(d){const o=new Date(d.created_date),j=d.status_trail.find(he=>he.status.name.toLowerCase()==="verified");if(!j)return"In progress...";const Y=new Date(j.created_date).getTime()-o.getTime(),s=Math.floor(Y/1e3),r=Math.floor(s/(3600*24)),i=Math.floor(s%(3600*24)/3600),x=Math.floor(s%3600/60),q=s%60,Z=[];return r>0&&Z.push(`${r} day${r>1?"s":""}`),i>0&&Z.push(`${i} hour${i>1?"s":""}`),x>0&&Z.push(`${x} minute${x>1?"s":""}`),q>0&&Z.push(`${q} second${q>1?"s":""}`),Z.length>0?Z.join(", "):"0 seconds"}return m({init:ae,printBBResults:Fe,changeStatus:je,updateChanges:Ae,updateNewOrder:fe,handleClick:xe,printAccessionNumber:Ne,printTrackingNumber:Ee,viewReport:He,getRequestedBy:Be,isRejectedOrVoided:Re,isCompletedByCurrentUserOrSuperAdmin:ze,getTurnAroundTime:Ie,fetchWards:w,canEditWard:v,updateWard:$,onWardChange:J,selectWard:y,showWardSearch:P,hideWardDropdown:ue,onSearchKeydown:ye}),(d,o)=>{const j=Ht,ee=$t,Y=we,s=rs,r=_s;return f(),S("div",null,[ht(d.$slots,"default",{onClick:ae}),l.value!==null&&l.value.client!==void 0?(f(),S("div",ws,[n(j,{class:"hidden",ref:"corePrinter",orderId:`${l.value.order_id}`,id:`${l.value.client.id}`},null,8,["orderId","id"])])):G("",!0),n(t(Le),{appear:"",show:V.value,as:"template"},{default:b(()=>[n(t(Te),{as:"div",class:"relative z-10"},{default:b(()=>[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>o[1]||(o[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",xs,[e("div",gs,[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(t(Ve),{class:"w-full max-w-7xl m-20 transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",Cs,[n(t(Me),{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:b(()=>o[2]||(o[2]=[e("img",{src:ys,class:"w-8 h-8 mr-2"},null,-1),ie(" View Test ")])),_:1}),e("button",{onClick:xe},[n(t(De),{class:"w-5 h-5"})])]),Ke(e("div",$s,[n(ee,{loading:M.value},null,8,["loading"])],512),[[it,M.value]]),e("div",ks,[e("div",Ss,[o[8]||(o[8]=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:bt,class:"w-7 h-7 mr-1"}),ie(" Patient ")])],-1)),e("div",Ts,[e("div",Vs,[o[3]||(o[3]=e("h3",{class:"font-semibold"},"Patient Number",-1)),e("p",null,A(l.value.client.id),1)]),e("div",Ms,[o[4]||(o[4]=e("h3",{class:"font-semibold"},"Name",-1)),e("p",null,A(("capitalize"in d?d.capitalize:t(Ge))(`${l.value.client.first_name} ${l.value.client.middle_name!==null?l.value.client.middle_name:""} ${l.value.client.last_name}`)),1)]),e("div",Ds,[o[5]||(o[5]=e("h3",{class:"font-semibold"},"Sex",-1)),e("p",null,A(l.value.client.sex),1)]),e("div",Ls,[o[6]||(o[6]=e("h3",{class:"font-semibold"},"Age",-1)),e("p",null,A(("calculateAge"in d?d.calculateAge:t(ct))(l.value.client.date_of_birth)),1)]),l.value.client.client_history?(f(),S("div",js,[o[7]||(o[7]=e("h3",{class:"font-semibold"},"Client History",-1)),e("p",null,A(l.value.client.client_history),1)])):G("",!0)])]),e("div",As,[o[14]||(o[14]=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t"},[e("h3",{class:"text-lg font-semibold text-black flex items-center"},[e("img",{src:hs,class:"w-7 h-7 mr-1"}),ie(" Specimen ")])],-1)),e("div",Hs,[e("div",Rs,[o[9]||(o[9]=e("h3",{class:"font-semibold"},"Specimen Type",-1)),e("p",null,A(t(U)(l.value.specimen_type,l.value.specimen_preferred_name)),1)]),e("div",qs,[o[10]||(o[10]=e("h3",{class:"font-semibold"},"Tracking Number",-1)),e("p",null,A(l.value.tracking_number),1)]),e("div",Os,[o[11]||(o[11]=e("h3",{class:"font-semibold"},"Accession Number",-1)),e("p",null,A(l.value.accession_number),1)]),e("div",Us,[o[12]||(o[12]=e("h3",{class:"font-semibold"},"Status",-1)),e("p",null,A(("capitalize"in d?d.capitalize:t(Ge))(l.value.order_status.split("-").join(" "))),1)]),e("div",Ps,[o[13]||(o[13]=e("h3",{class:"font-semibold"},"Turn Around Time",-1)),e("p",null,A(Ie(l.value)),1)])])]),e("div",Fs,[o[24]||(o[24]=e("div",{class:"px-2 py-2 bg-gray-50 border-b rounded-t flex items-center"},[e("img",{src:bs,class:"w-7 h-7 mr-1"}),e("h3",{class:"text-lg font-semibold text-black"},"Test")],-1)),e("div",Ns,[e("div",Es,[o[15]||(o[15]=e("h3",{class:"font-semibold"},"Name",-1)),e("p",null,A(t(le)(l.value.test_type_name,l.value.test_type_preferred_name)),1)]),e("div",Bs,[o[16]||(o[16]=e("h3",{class:"font-semibold"},"Date Registered",-1)),e("p",null,A(t(_e)(l.value.created_date).format("DATE_FORMAT"in d?d.DATE_FORMAT:t(lt))),1)]),e("div",zs,[o[17]||(o[17]=e("h3",{class:"font-semibold"},"Receipt Date",-1)),e("p",null,A(t(_e)(l.value.created_date).format("DATE_FORMAT"in d?d.DATE_FORMAT:t(lt))),1)]),e("div",Is,[o[18]||(o[18]=e("h3",{class:"font-semibold"},"Test Status",-1)),e("p",null,A(("capitalizeStr"in d?d.capitalizeStr:t(wt))(l.value.status.split("-").join(" "))),1)]),e("div",Zs,[o[20]||(o[20]=e("h3",{class:"font-semibold"},"Ward/Location",-1)),e("div",Ws,[e("div",Ys,[e("div",{onClick:P,class:Qe(["border border-gray-300 rounded px-2 py-1 text-sm cursor-pointer min-w-[150px] flex items-center justify-between",!v()||u.value?"bg-gray-100 cursor-not-allowed":"bg-white hover:border-blue-300"])},[e("span",Gs,A(te.value||"Select Ward"),1),o[19]||(o[19]=e("svg",{class:"w-4 h-4 ml-2 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})],-1))],2),_.value?(f(),S("div",Ks,[e("div",Qs,[Ke(e("input",{ref_key:"wardSearchInput",ref:T,"onUpdate:modelValue":o[0]||(o[0]=i=>p.value=i),onKeydown:ye,onBlur:ue,type:"text",placeholder:"Search wards...",class:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring focus:ring-blue-200"},null,544),[[xt,p.value]])]),e("div",Xs,[(f(!0),S(Ce,null,$e(t(h),i=>(f(),S("div",{key:i.id,onMousedown:x=>y(i),class:"px-3 py-2 text-sm hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0"},A(i.name),41,Js))),128)),t(h).length===0?(f(),S("div",eo," No wards found ")):G("",!0)])])):G("",!0)]),u.value?(f(),S("div",to,[n(ee,{loading:!0,size:"sm"})])):G("",!0),v()?G("",!0):(f(),S("div",so," ðŸ”’ "))])]),e("div",oo,[o[21]||(o[21]=e("h3",{class:"font-semibold"},"Request Origin",-1)),e("p",null,A(l.value.request_origin),1)]),e("div",ao,[o[22]||(o[22]=e("h3",{class:"font-semibold"},"Registered By",-1)),e("p",null,A(Be(l.value.status_trail)),1)]),e("div",lo,[o[23]||(o[23]=e("h3",{class:"font-semibold"},"Requested By",-1)),e("p",null,A(l.value.requested_by),1)])])])]),e("div",no,[e("div",ro,[o[25]||(o[25]=e("h3",{class:"text-lg font-semibold text-black"},"Results",-1)),e("div",io,[l.value.status.toLowerCase()==="completed"&&("usePermissions"in d?d.usePermissions:t(qe))().can.verify("test_results")&&ze(l.value)?(f(),me(Y,{key:0,icon:t(F),text:"Authorize",click:()=>{je("verified",l.value.id)},color:"success",loading:D.value},null,8,["icon","click","loading"])):G("",!0),(l.value.status.toLowerCase()==="completed"||l.value.status.toLowerCase()==="verified"||l.value.status.toLowerCase()==="rejected"||l.value.status.toLowerCase()==="test-rejected")&&("usePermissions"in d?d.usePermissions:t(qe))().can.view("reports")?(f(),me(Y,{key:1,icon:t(E),text:"View Report",click:He,color:"primary"},null,8,["icon"])):G("",!0),n(s,{item:l.value,onUpdate:Ae,color:"primary"},null,8,["item"]),n(r,{item:l.value,onUpdate:fe,color:"primary"},null,8,["item"]),n(Y,{icon:t(R),text:"Print Accession Number",click:Ne,color:"primary"},null,8,["icon"]),n(Y,{icon:t(R),color:"success",text:"Print Tracking Number",click:Ee},null,8,["icon"])])]),Re(l.value.status)?(f(),S("div",vo,[o[27]||(o[27]=e("img",{src:vt,class:"w-6 h-6 mr-2",alt:"no-result-svg"},null,-1)),e("h3",_o,[o[26]||(o[26]=ie(" Test Rejected: ")),e("span",yo,A(l.value.rejection_reason),1)])])):(f(),S("div",co,[(f(!0),S(Ce,null,$e(l.value.indicators,(i,x)=>{var q;return f(),S("div",{class:Qe(l.value.indicators.length!==Number(x)+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:x},[e("h3",uo,A(t(H)(i.name,i.preferred_name)),1),e("div",mo,[i.result?(f(),S("p",{key:0,innerHTML:i.result.value?i.result.value:"Not done"},null,8,po)):G("",!0),(q=i.result)!=null&&q.value?(f(),S("span",fo,A(i==null?void 0:i.unit),1)):G("",!0)])],2)}),128))])),l.value.test_type_name=="Cross-match"&&l.value.status.toLowerCase()=="verified"?(f(),S("div",ho,[n(Y,{loading:z.value,click:()=>{Fe()},text:"Print results",color:"primary",icon:t(R)},null,8,["loading","click","icon"])])):G("",!0),l.value.test_type_name.toString().toLowerCase().includes("cross")?(f(),S("div",bo,[o[32]||(o[32]=e("div",{class:"flex items-center justify-between px-4 py-2 bg-gray-50 border-b border-t"},[e("h3",{class:"text-lg font-semibold text-black"}," Post Cross-match processes ")],-1)),e("div",null,[e("div",wo,[o[28]||(o[28]=e("h3",{class:"font-medium"},"Collected by",-1)),e("p",null,A(l.value.post_crossmatch_process?l.value.post_crossmatch_process.collected_by:"Not collected"),1)]),e("div",xo,[o[29]||(o[29]=e("h3",{class:"font-medium"},"Collected date",-1)),e("p",null,A(l.value.post_crossmatch_process?t(_e)(l.value.post_crossmatch_process.collection_date).format("DATE_FORMAT_TIME"in d?d.DATE_FORMAT_TIME:t(ut)):"Not collected"),1)]),e("div",go,[o[30]||(o[30]=e("h3",{class:"font-medium"},"Transfusion outcome",-1)),e("p",null,A(l.value.post_crossmatch_process?l.value.post_crossmatch_process.transfusion_outcome:"Not done"),1)]),e("div",Co,[o[31]||(o[31]=e("h3",{class:"font-medium"},"Returned reason",-1)),e("p",null,A(l.value.post_crossmatch_process?l.value.post_crossmatch_process.returned_reason:"Not returned"),1)])])])):G("",!0)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),ko={class:"fixed inset-0 overflow-y-auto"},So={class:"flex min-h-full items-center justify-center p-4 text-center"},To={class:"border-b px-3 py-3 flex items-center justify-between"},Vo={class:"mt-2 space-y-3 px-5 py-5"},Mo={class:"w-full border border-dotted rounded"},Do={class:"flex items-center space-x-1"},Lo=["innerHTML"],jo={key:1,class:"text-xs"},Ao={class:"w-full flex items-center"},Ho={class:"w-full flex flex-col space-y-2"},Ro={class:"w-full flex flex-col space-y-2"},qo={class:"w-full flex flex-col space-y-2"},Oo={class:"flex items-center space-x-2"},Uo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Po=Se({__name:"index",props:{item:{}},emits:["update"],setup(Q,{emit:m}){const O=Q,g=m,C=c(),U=c(!1),le=Pe,H=c(""),V=c(""),l=c(!1),M=c(!1),D=c(!1),z=c([]),{$toast:E}=pe(),F=c({name:"select ward",id:0}),R=async()=>{const{data:u,error:a}=await W({route:K.sections,method:"GET"});u.value&&(z.value=u.value.data),a.value&&console.error(a.value)},N=async()=>{l.value=!0,await R();const u={route:`${K.tests}/${O.item.id}`,method:"GET"},{data:a,error:p,pending:_}=await W(u);l.value=_,a.value&&(l.value=!1,C.value=a.value,F.value=z.value.find(T=>T.name==a.value.requesting_ward)||{name:"select ward",id:0},k()),p.value&&(l.value=!1,console.error(p.value),E.error(re))},X=()=>{V.value=""},B=()=>{const u=new Date,a=u.getFullYear(),p=String(u.getMonth()+1).padStart(2,"0"),_=String(u.getDate()).padStart(2,"0"),T=String(u.getHours()).padStart(2,"0"),h=String(u.getMinutes()).padStart(2,"0");V.value=`${a}-${p}-${_}T${T}:${h}`},ae=async()=>{M.value=!0;const u={route:`${K.processCrossMatch}`,method:"POST",body:{post_crossmatch_process:{facility_section_id:F.value.id,test_id:O.item.id,collected_by:H.value,collection_date:V.value}}},{data:a,error:p,pending:_}=await W(u);M.value=_,a.value&&(E.success("Collection details saved successfully!"),k(),M.value=!1,te(),g("update",!0)),p.value&&(console.error(p.value),E.error(re),M.value=!1)},k=()=>{U.value=!U.value};async function te(){var T,h;const u={route:K.printOutZebra,method:"POST",body:{order_id:(T=C.value)==null?void 0:T.order_id,tests:[(h=C.value)==null?void 0:h.id],is_cross_match:!0}},{data:a,error:p,pending:_}=await W(u);if(D.value=_,a.value){D.value=!1;const w=new FileReader;w.onload=()=>{const v=URL.createObjectURL(a.value),$=document.createElement("a");$.href=v,$.setAttribute("download",`${Date.now()}.lbl`),$.click(),URL.revokeObjectURL(v)},w.readAsText(a.value),E.success("Results printed successfully!")}p.value&&(D.value=!1,E.error(re),console.error(p.value))}const I=()=>{H.value="",V.value="",F.value={name:"select ward",id:0}};return(u,a)=>{const p=we,_=se("FormKit"),T=dt,h=se("datepicker"),w=Ue;return f(),S("div",null,[e("div",null,[n(p,{text:"Collect",color:"primary",icon:t(Jt),click:()=>{N()},loading:t(l)},null,8,["icon","click","loading"])]),n(t(Le),{appear:"",show:t(U),as:"template"},{default:b(()=>[n(t(Te),{as:"div",onClose:k,class:"relative z-10"},{default:b(()=>[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>a[3]||(a[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",ko,[e("div",So,[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(t(Ve),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",To,[n(t(Me),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:b(()=>a[4]||(a[4]=[e("svg",{class:"w-8 h-8 mr-2",xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 512 512"},[e("path",{fill:"currentColor",d:"m118.2 55l-2.5 5.02C108.9 73.86 99.93 79 91.97 79s-16.99-5.17-23.92-19.03l-16.1 8.06C61.02 86.17 75.99 97 91.97 97c14.43 0 27.93-8.91 37.03-24h82v419h18V73h81.8c7.3 11.92 17.2 19.95 28.2 22.82V119h18V95.84c12.5-3.24 23.7-13.13 31.1-27.81l-16.2-8.06C365 73.83 356 79 348 79s-17-5.17-23.9-19.03L321.6 55zm171.1 82c-1.3 3-3.9 9.6-5.4 19.8c-1.9 12.9-2.9 29.5-2.9 47.2c0 33.5 3.8 70.9 10.5 93.5c14 6 35.3 9.5 56.5 9.5s42.5-3.5 56.5-9.5c6.7-22.6 10.5-60 10.5-93.5c0-17.7-1-34.3-2.9-47.2c-1.5-10.2-4.1-16.8-5.4-19.8zm5.3 77c35.3 7.2 70.6 10.5 105.9 0c-.5 24-2.4 45-10.2 69.6c-28.9 3-56.5 11.4-89.9-3.9zm91.1 107.7c-5.8 1.1-11.8 1.9-17.9 2.4c.7 3.1 1.5 6.6 2.3 10.6c2.4 11.4 4.4 25.3 3.9 32.7v.1c-.4 6.3-3 13.3-6.2 21.1s-6.9 16.5-7.7 26.7c-1.2 14.7 1.4 34.1 4.1 50.4s5.6 29.4 5.6 29.4l17.6-4s-2.9-12.6-5.5-28.3c-2.5-15.8-4.7-35-3.8-46.1c.5-6.4 3.2-13.4 6.4-21.3s6.9-16.6 7.5-26.8c.7-11.5-1.8-25.6-4.2-37.5c-.7-3.4-1.5-6.6-2.1-9.4m-74.7.1v24.5h18v-22.1c-6.1-.5-12.2-1.3-18-2.4"})],-1),ie(" Blood collection ")])),_:1}),e("button",{type:"button",onClick:k},[n(t(De),{class:"w-5 h-5"})])]),n(_,{type:"form","submit-label":"Update",onSubmit:ae,actions:!1,id:"collectionForm"},{default:b(({value:v})=>{var $,J;return[e("div",Vo,[e("div",null,[a[5]||(a[5]=e("h3",{class:"text-lg font-semibold text-black"},"Results",-1)),e("div",Mo,[(f(!0),S(Ce,null,$e(($=t(C))==null?void 0:$.indicators,(y,P)=>{var ue,ye;return f(),S("div",{class:Qe(((ue=t(C))==null?void 0:ue.indicators.length)!==P+1?"w-full px-5 py-2 border-b border-dotted flex justify-between items-center":"w-full px-5 py-2 flex justify-between items-center"),key:P},[e("h3",null,A(y.name),1),e("div",Do,[y.result?(f(),S("p",{key:0,innerHTML:y.result.value?y.result.value:"Not done"},null,8,Lo)):G("",!0),(ye=y.result)!=null&&ye.value?(f(),S("span",jo,A(y==null?void 0:y.unit),1)):G("",!0)])],2)}),128))])]),e("div",Ao,[e("div",Ho,[n(_,{type:"text",label:"Person's Name",validation:"required",modelValue:t(H),"onUpdate:modelValue":a[0]||(a[0]=y=>ne(H)?H.value=y:null)},null,8,["modelValue"])])]),e("div",Ro,[a[6]||(a[6]=e("label",{class:"font-medium"},"Designated ward",-1)),n(T,{isSearchable:"",items:t(z),modelValue:t(F),"onUpdate:modelValue":a[1]||(a[1]=y=>ne(F)?F.value=y:null),class:Qe(t(F).name=="select ward"&&"text-gray-600")},null,8,["items","modelValue","class"])]),e("div",qo,[a[7]||(a[7]=e("label",{class:"font-medium"},"Collection Time",-1)),e("div",Oo,[n(h,{required:"",position:"left",onCleared:X,placeholder:"select collection date and time",range:!1,format:"dd/MM/yyyy HH:mm:ss","input-class-name":"datepicker",modelValue:t(V),"onUpdate:modelValue":a[2]||(a[2]=y=>ne(V)?V.value=y:null),minDate:(J=t(C))==null?void 0:J.created_date,maxDate:new Date},null,8,["modelValue","minDate","maxDate"]),n(p,{text:"Now",color:"primary",click:()=>{B()},icon:t(ft)},null,8,["click","icon"])])])]),e("div",Uo,[n(w,{type:"button",text:"Clear form",click:I}),n(p,{loading:t(M),type:"submit",color:"success",icon:t(le),click:()=>{},text:"Save details"},null,8,["loading","icon"])])]}),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),Fo={class:"fixed inset-0 overflow-y-auto"},No={class:"flex min-h-full items-center justify-center p-4 text-center"},Eo={class:"border-b px-3 py-3 flex items-center justify-between"},Bo={class:"mt-2 space-y-3 px-5 py-5"},zo={class:"mt-2"},Io={key:0,class:"space-y-3"},Zo={class:"w-full relative flex flex-col space-y-2"},Wo={class:"flex items-center space-x-2"},Yo={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Go=Se({__name:"index",props:{item:{}},emits:["update"],setup(Q,{emit:m}){const O=Q,g=m,C=c(),U=c(!1),le=Pe,H=c(""),V=c(!1),l=c(""),M=c(""),D=c(""),z=c(!1),E=c(!1),F=c(!1),{$toast:R}=pe(),N=async()=>{z.value=!0;const u={route:`${K.tests}/${O.item.id}`,method:"GET"},{data:a,error:p,pending:_}=await W(u);z.value=_,a.value&&(z.value=!1,C.value=a.value,k()),p.value&&(z.value=!1,console.error(p.value),R.error(re))},X=()=>{D.value=""},B=()=>{const u=new Date,a=u.getFullYear(),p=String(u.getMonth()+1).padStart(2,"0"),_=String(u.getDate()).padStart(2,"0"),T=String(u.getHours()).padStart(2,"0"),h=String(u.getMinutes()).padStart(2,"0");D.value=`${a}-${p}-${_}T${T}:${h}`},ae=async()=>{E.value=!0;const u={route:`${K.processCrossMatch}`,method:"POST",body:{post_crossmatch_process:{facility_section_id:O.item.post_crossmatch_process.facility_section_id,test_id:O.item.id,transfusion_outcome:H.value,returned:V.value,returned_by:M.value,returned_date:D.value,returned_reason:l.value}}},{data:a,error:p,pending:_}=await W(u);E.value=_,a.value&&(R.success("Transfusion outcome saved successfully!"),k(),E.value=!1,te(),g("update",!0)),p.value&&(console.error(p.value),R.error(re),E.value=!1)},k=()=>{U.value=!U.value};async function te(){var T,h;const u={route:K.printOutZebra,method:"POST",body:{order_id:(T=C.value)==null?void 0:T.order_id,tests:[(h=C.value)==null?void 0:h.id],is_cross_match:!0}},{data:a,error:p,pending:_}=await W(u);if(F.value=_,a.value){F.value=!1;const w=new FileReader;w.onload=()=>{const v=URL.createObjectURL(a.value),$=document.createElement("a");$.href=v,$.setAttribute("download",`${Date.now()}.lbl`),$.click(),URL.revokeObjectURL(v)},w.readAsText(a.value),R.success("Results printed successfully!")}p.value&&(F.value=!1,R.error(re),console.error(p.value))}const I=()=>{H.value="",V.value=!0,M.value="",D.value="",l.value=""};return(u,a)=>{const p=we,_=se("FormKit"),T=se("datepicker"),h=Ue;return f(),S("div",null,[e("div",null,[n(p,{text:"Outcome",color:"success",icon:t(Xt),click:()=>{N()},loading:t(z)},null,8,["icon","click","loading"])]),n(t(Le),{appear:"",show:t(U),as:"template"},{default:b(()=>[n(t(Te),{as:"div",onClose:k,class:"relative z-10"},{default:b(()=>[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>a[5]||(a[5]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Fo,[e("div",No,[n(t(ce),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(t(Ve),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",Eo,[n(t(Me),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:b(()=>a[6]||(a[6]=[e("svg",{class:"w-8 h-8 mr-2",xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 64 64"},[e("path",{fill:"currentColor",d:"M55.407.547H8.833C4.271.547.559 4.26.559 8.824v46.568c0 4.565 3.713 8.279 8.274 8.279h46.574c4.564 0 8.276-3.713 8.276-8.279V8.824c0-4.564-3.712-8.277-8.276-8.277M35.358 16.592a6.583 6.583 0 0 1 6.584 6.584c0 3.634-2.949 6.586-6.584 6.586s-6.584-2.952-6.584-6.586a6.583 6.583 0 0 1 6.584-6.584M8.191 18.675v-5.269h5.269V8.137h5.269v5.269h5.269v5.269h-5.269v5.268H13.46v-5.268zM52.64 53.058c-.488 0-.957-.095-1.385-.267l-5.862-1.631v5.843H25.044V51.16l-5.86 1.631a3.7 3.7 0 0 1-1.385.267a3.755 3.755 0 0 1-3.112-5.853l9.4-12.889c1.02-1.398 2.445-2.955 5.45-2.955H40.9c3.004 0 4.43 1.558 5.449 2.955l9.399 12.889a3.74 3.74 0 0 1 .642 2.099a3.757 3.757 0 0 1-3.752 3.754z"}),e("path",{fill:"currentColor",d:"M25.043 35.868v7.816l.712-.24c5.242-1.545 7.281 5.376 2.04 6.918l-.168.047l7.592 2.513l7.593-2.513l-.171-.047c-5.238-1.542-3.199-8.463 2.039-6.918l.716.24v-7.816l-10.177 3.325z"})],-1),ie(" Transfusion outcome ")])),_:1}),e("button",{type:"button",onClick:k},[n(t(De),{class:"w-5 h-5"})])]),n(_,{type:"form","submit-label":"Update",onSubmit:ae,actions:!1,id:"collectionForm"},{default:b(({value:w})=>{var v;return[e("div",Bo,[n(_,{type:"text",label:"Transfusion Outcome",modelValue:t(H),"onUpdate:modelValue":a[0]||(a[0]=$=>ne(H)?H.value=$:null),validation:"required"},null,8,["modelValue"]),e("div",zo,[e("label",null,[Ke(e("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=$=>ne(V)?V.value=$:null)},null,512),[[kt,t(V)]]),a[7]||(a[7]=ie(" Is it returned? "))])]),t(V)?(f(),S("div",Io,[n(_,{type:"text",label:"Returned By",modelValue:t(M),"onUpdate:modelValue":a[2]||(a[2]=$=>ne(M)?M.value=$:null),validation:"required"},null,8,["modelValue"]),e("div",Zo,[a[8]||(a[8]=e("label",{class:"font-medium"},"Returned Date",-1)),e("div",Wo,[n(T,{required:"",position:"left",onCleared:X,placeholder:"select collection date and time",range:!1,teleport:!0,format:"dd/MM/yyyy HH:mm:ss","input-class-name":"datepicker",modelValue:t(D),"onUpdate:modelValue":a[3]||(a[3]=$=>ne(D)?D.value=$:null),minDate:(v=t(C))==null?void 0:v.created_date,maxDate:new Date},null,8,["modelValue","minDate","maxDate"]),n(p,{text:"Now",color:"primary",click:()=>{B()},icon:t(ft)},null,8,["click","icon"])])]),n(_,{type:"textarea",label:"Returned Reason",modelValue:t(l),"onUpdate:modelValue":a[4]||(a[4]=$=>ne(l)?l.value=$:null),validation:"required"},null,8,["modelValue"])])):G("",!0)]),e("div",Yo,[n(h,{type:"button",text:"Clear form",click:()=>{I()}},null,8,["click"]),n(p,{loading:t(E),type:"submit",color:"success",icon:t(le),click:()=>{},text:"Save details"},null,8,["loading","icon"])])]}),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),Ko={components:{TransitionRoot:Le,TransitionChild:ce,Dialog:Te,DialogPanel:Ve,DialogTitle:Me,XMarkIcon:De,UserIcon:Ot},data(){return{open:!1,addIcon:Ut,saveIcon:Pe,clearIcon:Pt,name:"",description:"",loading:!1,cookie:Oe("token"),reasons:new Array,reasonsSelected:"",rawReasons:new Array}},props:{item:{required:!0,type:Object},text:{type:String,required:!0},action:{type:String,required:!0},icon:{type:[Object,Function],required:!0}},methods:{async init(){this.handleClick();const Q={route:K.rejectionReasons,method:"GET",token:`${this.cookie}`},{error:m,data:O}=await W(Q);O.value&&(this.rawReasons=O.value,O.value.map(g=>{this.reasons.push(g.description)})),m.value&&console.error(m.value)},async submitForm(){this.loading=!0;let Q=null;this.rawReasons.map(U=>{U.description===this.reasonsSelected&&(Q=U.id)});const m={route:`${K.testStatus}/${this.item.id}/${this.action}?status_reason_id=${Q}&person_talked_to=${this.name}`,method:"PUT",token:`${this.cookie}`,body:{}},{data:O,error:g,pending:C}=await W(m);this.loading=C,O.value&&(pe().$toast.success(`Test action "${this.text}" done successfully!`),this.handleClick(),this.loading=!1,this.$emit("update",!0)),g.value&&(console.error(g.value),pe().$toast.error(re),this.loading=!1)},handleClick(){this.open=!this.open},resetForm(){this.reasonsSelected="",this.$formkit.reset("rejectionForm")}}},Qo={class:"fixed inset-0 overflow-y-auto"},Xo={class:"flex min-h-full items-center justify-center p-4 text-center"},Jo={class:"border-b px-3 py-3 flex items-center justify-between"},ea={class:"mt-2 space-y-3 px-5 py-5"},ta={class:"space-y-2"},sa={class:"border-b border-dotted text-gray-600"},oa={class:"space-y-2"},aa={class:"border-b border-dotted text-gray-600"},la={class:"space-y-2"},na={class:"border-b border-dotted text-gray-600"},ra={class:"w-full flex items-center"},ia={class:"w-full flex flex-col space-y-2"},ca={class:"w-full flex flex-col space-y-2 pb-40"},ua={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function da(Q,m,O,g,C,U){const le=we,H=se("TransitionChild"),V=se("DialogTitle"),l=se("XMarkIcon"),M=se("FormKit"),D=se("multi-select"),z=Ue,E=se("DialogPanel"),F=se("Dialog"),R=se("TransitionRoot");return f(),S("div",null,[e("div",null,[n(le,{text:O.text,color:"error",icon:O.icon,click:U.init},null,8,["text","icon","click"])]),n(R,{appear:"",show:C.open,as:"template"},{default:b(()=>[n(F,{as:"div",onClose:U.handleClick,class:"relative z-10"},{default:b(()=>[n(H,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:b(()=>m[3]||(m[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Qo,[e("div",Xo,[n(H,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:b(()=>[n(E,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:b(()=>[e("div",Jo,[n(V,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:b(()=>[m[4]||(m[4]=e("img",{src:vt,class:"w-8 h-8 mr-2"},null,-1)),ie(" "+A(O.text.charAt(0).toUpperCase()+O.text.slice(1))+" Reason ",1)]),_:1}),e("button",{onClick:m[0]||(m[0]=(...N)=>U.handleClick&&U.handleClick(...N))},[n(l,{class:"w-5 h-5"})])]),n(M,{type:"form","submit-label":"Update",onSubmit:U.submitForm,actions:!1,id:"rejectionForm"},{default:b(({value:N})=>[e("div",ea,[e("div",ta,[m[5]||(m[5]=e("h3",{class:"font-medium"},"Test Type",-1)),e("p",sa,A(O.item.test_type_name),1)]),e("div",oa,[m[6]||(m[6]=e("h3",{class:"font-medium"},"Specimen",-1)),e("p",aa,A(O.item.specimen_type),1)]),e("div",la,[m[7]||(m[7]=e("h3",{class:"font-medium"},"Accession Number",-1)),e("p",na,A(O.item.accession_number),1)]),e("div",ra,[e("div",ia,[n(M,{type:"text",label:"Person Talked To",validation:O.text.toLowerCase()!=="void"?"required":"",modelValue:C.name,"onUpdate:modelValue":m[1]||(m[1]=X=>C.name=X)},null,8,["validation","modelValue"])])]),e("div",ca,[m[8]||(m[8]=e("label",{class:"font-medium"},"Select Reason(s)",-1)),n(D,{style:{"--ms-max-height":"none !important"},modelValue:C.reasonsSelected,"onUpdate:modelValue":m[2]||(m[2]=X=>C.reasonsSelected=X),options:C.reasons,searchable:!0,required:!0,clear:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),e("div",ua,[n(z,{type:"button",text:"Clear form",click:U.resetForm},null,8,["click"]),n(le,{loading:C.loading,type:"submit",click:()=>{},color:"success",icon:C.saveIcon,text:"Save changes"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const ma=St(Ko,[["render",da]]),pa={class:"py-5 px-5"},fa={class:"flex items-center space-x-2 py-5"},va={class:"text-2xl font-semibold uppercase"},_a={class:"flex justify-between items-center w-full py-2 mb-2"},ya={class:"flex items-center space-x-2"},ha={class:"relative z-10 w-40"},ba={class:"w-44"},wa={class:"pt-1"},xa={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},ga={class:"w-72 ml-2"},Ca={class:"py-3 flex items-center space-x-3"},$a={class:"py-2 flex items-center"},ka={class:"w-full flex items-center justify-between space-x-2"},Sa={key:0,class:"flex items-center space-x-2"},Ta={key:0,class:"flex items-center space-x-2"},fl=Se({__name:"index",setup(Q){const m=ke(),O=nt(),g=Tt(),C=Vt(),{$toast:U,$metadata:le}=pe();Et({title:`${Bt.name.toUpperCase()} - ${m.department} Tests`});const H=c(!1),V=c(0),l=c(),M=c(["",""]),D=c(""),z=c("Tests Lists"),E=c([{name:"Home",link:"/home"}]),{value:F}=zt("test_name_display","preferred_name"),R=c([{text:"PATIENT NO",value:"client.id",sortable:!0},{text:"PATIENT NAME",value:"name",sortable:!0},{text:"ACCESSION NO",value:"accession_number",sortable:!0},{text:"PANEL TYPE",value:String(F.value)==="full_name"?"test_panel_name":"test_panel_preferred_name",sortable:!0},{text:"TEST",value:String(F.value)==="full_name"?"test_type_name":"test_type_preferred_name",sortable:!0},{text:"LOCATION",value:"requesting_ward",sortable:!0},{text:"ORDER STATUS",value:"order_status",sortable:!0},{text:"STATUS",value:"status",sortable:!0},{text:"DATE REGISTERED",value:"created_date",sortable:!0},{text:"ACTIONS",value:"actions",sortable:!1}]),N=c([{text:"Results",color:"primary",icon:It,status:"completed",show:"started",permission:"enter_test_results"},{text:"Accept",color:"success",icon:st,status:"pending",show:"not-collected",permission:"accept_test_specimen"},{text:"Start",color:"warning",icon:Qt,status:"started",show:"pending",permission:"start_test"},{text:"Authorize",color:"success",status:"verified",icon:st,show:"completed",permission:"verify_test_results"}]),X=s=>{const r=[{name:"Reject",icon:et,action:"rejected",permission:"void_test"},{name:"Void",icon:et,action:"voided",permission:"void_test"},{name:"Notdone",icon:et,action:"not_done",permission:"void_test"}];return s.toLowerCase()==="verified"?r.filter(i=>i.name.toLowerCase()==="void"):r},B=c([]),ae=Rt(),k=c({name:"select status"}),te=c("accession_number"),I=c(""),u=Oe("token"),a=c(!1),p=c(!0),_=c(0),T=c([]),h=c({page:1,rowsPerPage:20,sortBy:"name"}),w=c([]),v=c([]),$=s=>{V.value==s?V.value=0:V.value=s},J=async s=>{a.value=!0;const r={route:`${K.nlimsTestSearch}?tracking_number=${s.replace(/\$$/,"")}`,method:"GET",token:`${u.value}`},{data:i,error:x}=await W(r);i.value&&(Dt(i.value).then(q=>{const Z={...g.query,search:q};C.replace({query:Z}),D.value=q,I.value=q,y()}).catch(q=>{console.error("error routing to merged test: ",q)}),a.value=!1),x.value&&(console.error(x.value),U.error(`${x.value.data.error}`),a.value=!1)},y=async()=>{P(),a.value=!0;const{page:s,rowsPerPage:r}=h.value;let i=Ae(m.user.departments,m.department),x=Ae(m.locations,m.selectedLocation),q=k.value.name==="select status"?"":k.value.name!==void 0&&k.value.name;const Z=M.value[0].toString()!==""?_e(M.value[0].toString()).format("YYYY-MM-DD"):"",he=M.value[1].toString()!==""?_e(M.value[1].toString()).format("YYYY-MM-DD"):"",Xe={route:`${K.tests}?minimal=true&page=${s}&per_page=${r}&status=${q.toString().toLowerCase()}&search=${D.value}&department_id=${i}&lab_location=${x}&start_date=${Z}&end_date=${he}&facility_sections=${T.value}`,method:"GET",token:`${u.value}`},{data:ge,error:Ze,pending:Je}=await W(Xe);a.value=Je,ge.value&&(ge.value.data.length==0&&U.warning("No tests found within the specified period"),B.value=ge.value.data.map(oe=>{var We,Ye,L,be;return{...oe,name:`${Ge(`${(We=oe.client)==null?void 0:We.first_name} ${((Ye=oe.client)==null?void 0:Ye.middle_name)!==null?oe.client.middle_name:""} ${(L=oe.client)==null?void 0:L.last_name}`)} (${oe.client.sex}, ${ct((be=oe.client)==null?void 0:be.date_of_birth)} yrs)`,order_status:`${oe.order_status!==null?(oe.order_status.charAt(0).toUpperCase()+oe.order_status.slice(1)).split("-").join(" "):""}`,status:`${oe.status!==null?oe.status.charAt(0).toUpperCase()+oe.status.slice(1):""}`,created_date:_e(oe.created_date).utcOffset(2).format(ut)}}),_.value=ge.value.meta.total_count,a.value=!1),Ze.value&&(console.error(Ze.value.data),U.error(re),a.value=!1)},P=async()=>{const s={route:`${K.testStatus}/all`,method:"GET",token:`${u.value}`},{data:r,error:i}=await W(s);r.value&&(w.value=r.value.map(x=>({id:x.id,name:x.name.charAt(0).toUpperCase()+x.name.slice(1)}))),i.value&&console.error(i.value)},ue=async(s,r)=>{a.value=!0;const i={route:`${K.testStatus}/${r}/${s}`,method:"PUT",token:`${u.value}`,body:{}},{data:x,error:q,pending:Z}=await W(i);a.value=Z,x.value&&(y(),a.value=!1),q.value&&(console.error(q.value),a.value=!1)},ye=async s=>{Mt(s)||(U.success(`Order with accession number ${s.accession_number} has been created successfully!`),await ae.alertConfirmation({message:"Do you want to print specimen label?"})&&await tt.printSpecimenLabel(s.accession_number)),y()},Fe=async(s,r)=>{a.value=!0;const i={route:`${K.orderStatus}/${s}`,method:"PUT",token:`${u.value}`,body:{order_id:r}},{data:x,error:q,pending:Z}=await W(i);a.value=Z,x.value&&(y(),a.value=!1),q.value&&(console.error(q.value),a.value=!1)},je=(s,r)=>{const i={completed:()=>{const Z={default:`/tests/result?accession_number=${r.accession_number}&test_id=${r.id}`,culture:`/tests/result/culture-sensitivity?accession_number=${r.accession_number}&test_id=${r.id}`},he=r.test_type_name.toLowerCase().includes("culture")?"culture":"default";He(r,Z[he])},verified:()=>Y(r),default:()=>{s.status!==""&&ue(s.status,r.id)}},x=s.status;(i[x]||i.default)()},Ae=(s,r)=>{const i=s.find(x=>x.name===r);return i?i.id:null},fe=s=>{if(V.value=0,typeof s=="object"){h.value=s;const r={...g.query,page:s.page,rowsPerPage:s.rowsPerPage};C.replace({query:r})}y(),H.value=!1},xe=()=>{I.value="",D.value="",y()},Ne=s=>{D.value=s,I.value=s;const r={...g.query,search:s};C.replace({query:r}),s!==""?Be(s)?J(s):fe(s):y()},Ee=s=>{if(s){T.value=s;for(let r=v.value.length-1;r>=0;r--){const i=v.value[r];i.origin==="wards"&&!s.includes(i.value)&&v.value.splice(r,1)}s.forEach(r=>{v.value.some(i=>i.origin==="wards"&&i.value===r)||v.value.push({origin:"wards",value:r})}),y()}},He=(s,r)=>{C.push(r)},Be=s=>/^(x|l).*\d/.test(s.toLowerCase()),Re=s=>{if(s.name!=="select status"){const i=v.value.find(x=>x.origin==="statuses");i?i.value=s.name:v.value.push({origin:"statuses",value:s.name})}k.value=s;const r={...g.query,status:s.name.toLowerCase()=="select status"?"":s.name.toLowerCase()};C.replace({query:r}),r.status!==""&&y()},ze=s=>{if(s.origin==="statuses"&&k.value.name!=="select status"&&Re({name:"select status"}),s.origin==="wards"){const i=T.value.indexOf(s.value);i!==-1&&T.value.splice(i,1)}const r=v.value.findIndex(i=>i.origin===s.origin);r!==-1&&v.value.splice(r,1),y()},Ie=s=>{const r=m.user,i=s.completed_by;if(i){if(i.id!==r.id)return!0;if(i.is_super_admin===!0)return!0}return!1},d=(s,r)=>{const{hasPermission:i}=qe(),x=s.status.toLowerCase(),q=r.show.toLowerCase();if(x===q){const Z=Ie(s);return x==="pending"&&s.order_status.toLowerCase()==="specimen not collected"?!1:r.permission?Z&&i.value(String(r.permission)):Z}return!1},o=s=>{const r=new Set(["rejected","not-done","voided","test-rejected"]),i=new Set(["specimen not collected"]);return!r.has(s.status.toLowerCase())&&i.has(s.order_status.toLowerCase())},j=s=>{const{can:r}=qe();return!new Set(["voided","test-rejected","rejected","not-done"]).has(s.status.toLowerCase())&&r.void("test")},ee=()=>{M.value=["",""]},Y=s=>{l!==null&&l.value.init(s)};return ve(()=>m.department,(s,r)=>{s!==r&&y()}),ve(()=>m.selectedLocation,(s,r)=>{s!==r&&y()}),ve(M,(s,r)=>{if(p.value){p.value=!1;return}if(s!==r){const i=s[0].toString()!==""?_e(s[0].toString()).format("YYYY-MM-DD"):"",x=s[1].toString()!==""?_e(s[1].toString()).format("YYYY-MM-DD"):"",q={...g.query,from:i,to:x};C.replace({query:q}),y()}},{deep:!0}),ve(k,s=>{Re(s)},{deep:!0}),ve(()=>O.selectedWard,s=>{if(s){T.value=[s];const r=v.value.findIndex(i=>i.origin==="wards");r!==-1?v.value[r].value=s:v.value.push({origin:"wards",value:s}),y()}}),rt(()=>{var s,r,i,x,q,Z;h.value={page:Number(g.query.page?g.query.page:1),rowsPerPage:Number(g.query.rowsPerPage?g.query.rowsPerPage:20)},k.value=g.query.status?{name:g.query.status.toString()}:{name:"select status"},D.value=(s=g.query.search)!=null&&s.toString()?(r=g.query.search)==null?void 0:r.toString():"",M.value=[`${(i=g.query.from)!=null&&i.toString()?(x=g.query.from)==null?void 0:x.toString():""}`,`${(q=g.query.to)!=null&&q.toString()?(Z=g.query.to)==null?void 0:Z.toString():""}`],y()}),rt(()=>{const{selectedWard:s}=nt();s&&(T.value=[s],v.value.push({origin:"wards",value:s}),y())}),(s,r)=>{const i=_t,x=we,q=dt,Z=Lt,he=se("datepicker"),Xe=At,ge=jt,Ze=$o,Je=Po,oe=Go,We=ma,Ye=Ft;return f(),S("div",pa,[n(i,{pages:t(E)},null,8,["pages"]),e("div",fa,[r[3]||(r[3]=e("img",{src:Nt,class:"object-cover h-8 w-8",alt:"tests-icon"},null,-1)),e("h3",va,A(t(z)),1)]),e("div",_a,[e("div",ya,[n(x,{text:"Refresh",color:"warning",icon:t(Zt),click:()=>{xe()},loading:t(a)},null,8,["icon","click","loading"]),e("div",ha,[n(q,{items:t(w),modelValue:t(k),"onUpdate:modelValue":r[0]||(r[0]=L=>ne(k)?k.value=L:null)},null,8,["items","modelValue"])]),e("div",ba,[n(Z,{wards:t(le).wards,initialSelection:t(T),"onUpdate:itemsSelected":Ee},null,8,["wards","initialSelection"])]),e("div",wa,[e("div",xa,[n(t(Wt),{class:"w-5 h-5 mr-2"}),r[4]||(r[4]=ie(" Date Range ")),e("div",ga,[n(he,{required:"",position:"left",onCleared:ee,placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:t(M),"onUpdate:modelValue":r[1]||(r[1]=L=>ne(M)?M.value=L:null),maxDate:new Date},null,8,["modelValue","maxDate"])])])])]),n(Xe,{onUpdate:Ne,search:t(D),"onUpdate:search":r[2]||(r[2]=L=>ne(D)?D.value=L:null)},null,8,["search"])]),e("div",Ca,[(f(!0),S(Ce,null,$e(t(v),(L,be)=>(f(),me(ge,{value:L,close:"",color:"green",key:be,onUpdate:ze},null,8,["value"]))),128))]),n(Ye,{headers:t(R),data:t(B),loading:t(a),searchField:t(te),searchValue:t(I),serverItemsLength:t(_),serverOptions:t(h),onUpdate:fe},{actions:b(({item:L})=>{var be;return[e("div",$a,[e("div",ka,[t(V)!==L.id?(f(),S("div",Sa,[n(Ze,{ref_key:"testsDialog",ref:l,onUpdate:fe,onOrder:ye},{default:b(()=>[n(x,{color:"primary",text:"View",icon:t(pt),click:()=>{Y(L)}},null,8,["icon","click"])]),_:2},1536),L.status.toLowerCase()=="verified"&&L.test_type_name.toLowerCase()=="cross-match"&&!L.post_crossmatch_process&&!t(m).isClinicalStaff?(f(),me(Je,{key:0,item:L,onUpdate:fe},null,8,["item"])):G("",!0),L.status.toLowerCase()=="verified"&&L.test_type_name.toLowerCase()=="cross-match"&&L.post_crossmatch_process&&((be=L.post_crossmatch_process)==null?void 0:be.transfusion_outcome)===null&&!t(m).isClinicalStaff?(f(),me(oe,{key:1,item:L,onUpdate:fe},null,8,["item"])):G("",!0),L.status.toLowerCase()==="completed"&&("usePermissions"in s?s.usePermissions:t(qe))().can.edit("test_results")&&!t(m).isClinicalStaff?(f(),me(x,{key:2,click:()=>{je({status:"completed"},L)},text:"Edit",color:"success",icon:t(ot)},null,8,["click","icon"])):G("",!0),(f(!0),S(Ce,null,$e(t(N),(de,at)=>Ke((f(),me(x,{color:de.color,text:de.text,icon:de.icon,click:()=>{je(de,L)},key:at},null,8,["color","text","icon","click"])),[[it,d(L,de)&&!t(m).isClinicalStaff]])),128)),o(L)&&!t(m).isClinicalStaff?(f(),me(x,{key:3,color:"success",text:"Accept",icon:t(Yt),click:()=>Fe("accepted",L.order_id)},null,8,["icon","click"])):G("",!0)])):G("",!0),j(L)&&!t(m).isClinicalStaff?(f(),me(x,{key:1,click:()=>$(L.id),color:"",text:"",icon:t(H)==!0?t(Gt):t(Kt)},null,8,["click","icon"])):G("",!0)]),j(L)&&t(V)==L.id&&!t(m).isClinicalStaff?(f(),S("div",Ta,[(f(!0),S(Ce,null,$e(X(L.status),(de,at)=>(f(),me(We,{key:de.name,item:L,text:de.name,icon:de.icon,action:de.action,onUpdate:fe},null,8,["item","text","icon","action"]))),128))])):G("",!0)])]}),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions"]),r[5]||(r[5]=e("div",{id:"tests-container"},null,-1))])}}});export{fl as default};
