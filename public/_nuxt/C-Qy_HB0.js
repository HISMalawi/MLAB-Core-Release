import{_ as V}from"./CUGREwii.js";import{_ as D}from"./ptOfu_GX.js";import{d as F,r as u,u as G,a as H,c as R,w as I,o as M,b as l,e as i,f as p,g as e,h as z,i as C,v as P,F as b,j as y,t as $,k as J,l as x,m as k,_ as K,n as O}from"./JEpZiKDn.js";import{u as Q}from"./Bl4Rx-lb.js";import{P as W}from"./DObdreHM.js";import{r as X}from"./C1QrZmAh.js";import"./DGM4Jn_4.js";import"./Cd90EHgg.js";const Y={class:"px-5 py-5"},Z=e("div",{class:"flex items-center justify-between py-5"},[e("h3",{class:"text-2xl font-semibold"},"Permissions")],-1),ee={class:"flex items-center space-x-3 justify-between"},se={class:"w-full mt-5 rounded"},te={class:"flex flex-col items-center mx-auto justify-center py-20"},oe=e("p",{class:"text-base mt-2"},[J(" Loading permissions, please wait"),e("span",{class:"animate-pulse"},"...")],-1),ae={class:"overflow-x-auto mb-20 rounded"},ne={class:"table-auto w-full border-collapse border rounded"},re={class:"border-b"},le={class:"w-full bg-gray-50"},ie=e("th",{class:"px-20 py-2 text-left uppercase font-semibold border sticky left-0"}," Permissions ",-1),ce={class:"border-r sticky left-0 bg-white"},ue={class:""},de={class:"flex items-center justify-between border-b py-2 px-4 hover:bg-gray-100 transition duration-150 hover:font-medium"},pe=["checked","disabled","onChange"],ke=F({__name:"permissions",setup(me){Q({title:`${W.name.toUpperCase()} - Permissions`});const B=X,L=u([{name:"Home",link:"/home"},{name:"Access Controls",link:"#"}]),{$toast:j}=G(),c=u(""),m=u([]),d=u([]),_=H("token"),o=u(!1),S=R(()=>{if(!c.value)return m.value;const t=c.value.toLowerCase();return m.value.filter(s=>s.display_name.toLowerCase().includes(t))}),v=async()=>{o.value=!0;const t={route:x.privileges,method:"GET",token:`${_.value}`},{data:s,pending:a,error:n}=await k(t);s.value&&(m.value=s.value,o.value=!1),n.value&&(console.error(n.value),o.value=!1)},w=async()=>{const t={route:x.roles,method:"GET",token:`${_.value}`},{data:s,error:a}=await k(t);s.value&&(d.value=s.value),a.value&&console.error(a.value)},q=async()=>{o.value=!0;const t={route:`${x.roles}/update_permissions`,method:"PUT",token:`${_.value}`,body:{role_privileges:d.value}},{data:s,pending:a,error:n}=await k(t);o.value=a,s.value&&(o.value=!1,j.success("Permissions updated successfully!"),await v(),await w()),n.value&&(o.value=!1,console.error(n.value))},N=t=>new Set(["superadmin","superuser"]).has(t.toLowerCase()),T=(t,s,a)=>{const{checked:n}=t.target;s.privileges=n?[...s.privileges,a]:s.privileges.filter(({id:f})=>f!==a.id)};return I(c,t=>{v()}),M(()=>{v(),w()}),(t,s)=>{const a=V,n=D,f=K,A=O;return l(),i("div",Y,[p(a,{pages:L.value},null,8,["pages"]),Z,e("div",ee,[p(n,{search:c.value,"onUpdate:search":s[0]||(s[0]=r=>c.value=r)},null,8,["search"]),p(f,{loading:o.value,click:q,text:"Save changes",color:"success",icon:z(B)},null,8,["loading","icon"])]),e("div",se,[C(e("div",te,[p(A,{loading:o.value},null,8,["loading"]),oe],512),[[P,o.value]]),C(e("div",ae,[e("table",ne,[e("thead",re,[e("tr",le,[ie,(l(!0),i(b,null,y(d.value,r=>(l(),i("th",{class:"px-4 py-2 text-left uppercase font-semibold",key:r.id},$(r.name),1))),128))])]),e("tbody",null,[(l(!0),i(b,null,y(S.value,(r,E)=>(l(),i("tr",{key:E},[e("td",ce,[e("div",ue,[e("div",de,[e("p",null,$(r.display_name),1)])])]),(l(!0),i(b,null,y(d.value,(h,U)=>(l(),i("td",{class:"border px-4 py-2",key:U},[e("input",{type:"checkbox",checked:h.privileges.filter(g=>g.name==r.name).length>0,class:"mr-2 leading-tight",disabled:N(h.name),onChange:g=>T(g,h,r)},null,40,pe)]))),128))]))),128))])])],512),[[P,!o.value]])])])}}});export{ke as default};
