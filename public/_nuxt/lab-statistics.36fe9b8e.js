import{_ as ot}from"./Breadcrumb.vue.af519b7d.js";import{_ as st}from"./Dropdown.c3b078e3.js";import{m as at,u as rt,a as nt,C as h,g as A,o as i,c as p,d as m,e,t as y,h as V,l as t,i as O,E as Y,F as C,r as S,n as lt,k as L,w as ct,v as it,b as M,f as pt}from"./entry.64b6b942.js";import{_ as dt}from"./index.e15a6363.js";import{_ as mt}from"./ExportButton.vue.ea9faa25.js";import{_ as ut}from"./Address.vue.0136ab68.js";import{_ as _t}from"./Loader.52c40d31.js";import{d as N,e as ft}from"./constants.31b85c3a.js";import{_ as ht}from"./report.35dfb70a.js";import{_ as yt}from"./logo.9f0778b3.js";import{_ as vt}from"./page.2ba6cd71.js";import{h as v,f as q,e as G}from"./fetch.8fd817fe.js";import{u as gt}from"./facility.a7378ed6.js";import{P as xt}from"./package.70b788f3.js";import{r as bt}from"./FunnelIcon.73d98fcb.js";import{r as wt}from"./ArrowPathIcon.b9b688c3.js";import"./nuxt-link.f9df4f37.js";import"./HomeIcon.4d524c11.js";import"./listbox.947b1eda.js";import"./hidden.a9fd55b4.js";import"./use-text-value.cb6830ee.js";import"./CheckIcon.b87f947f.js";import"./CheckCircleIcon.acd40d04.js";import"./MagnifyingGlassIcon.12344835.js";import"./jspdf.es.min.168aff09.js";import"./XMarkIcon.64f3f5c2.js";import"./PrinterIcon.5a175993.js";import"./transition.5b1867a1.js";import"./PencilSquareIcon.f5030dad.js";const Dt={class:"px-5 py-5"},kt=e("img",{src:ht,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),Ct={class:"w-full flex items-center justify-between mb-3"},Rt={class:"flex items-center space-x-3"},St={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Tt={class:"w-72 ml-2"},$t={class:"w-44"},Mt={class:"flex items-center space-x-3"},Et={class:"border rounded print-container",id:"print-container"},At={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},Ot=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:yt,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," LABORATORY STATISTICS REPORT ")],-1),Ft={class:"mt-3 px-5"},Ut={class:"font-medium mb-2"},Bt={class:"font-normal"},jt={class:"overflow-x-auto bg-white border-t"},Pt={key:0,class:"w-full overflow-x-auto"},Vt={class:"uppercase bg-gray-100"},Yt={class:"text-left"},Lt=e("th",{class:"px-4 py-2"},"Tests",-1),Nt=e("th",{class:"px-4 py-2"},"Total",-1),qt={style:{width:"100% !important"},class:"w-full bg-sky-50 border-t border-b border-dotted"},Gt={class:"px-4 py-2 font-bold"},It=e("td",{class:"px-4 py-2"},null,-1),zt={class:"px-4 py-2"},Ht={class:"px-4 py-2"},Kt={class:"w-full items-center flex flex-col space-y-2 my-10"},Jt=e("p",null,[O("Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),Qt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Wt=e("img",{src:vt,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Xt=e("p",null,"Data not found, please generate report",-1),Zt=[Wt,Xt],te="Lab Statistics Report",Ee=at({__name:"lab-statistics",setup(ee){rt({title:`${xt.name.toUpperCase()} - Lab Statistics Report`});const E=gt(),F=nt("token"),I=[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],T=h([]),R=h({name:"select department"}),a=h(["",""]),U=h([]),b=h([]),$=h([]),z=h([]),g=h(!1),H=()=>{a.value=new Array("","")};async function K(){const o={route:G.departments,method:"GET",token:`${F}`},{data:s,error:r}=await q(o);s.value&&(T.value=s.value,T.value.push({id:0,name:"All"}),T.value.sort((c,n)=>{const l=c.name.toUpperCase(),u=n.name.toUpperCase();return l<u?-1:l>u?1:0})),r.value&&console.error(r.value)}function J(o){return o==="select department"||o==="-- select test type --"||o==="-- select test status --"?"":o}function Q(o,s){const r=new Date(o),c=new Date(s),n=new Array;let l=r;for(;l<=c;){const u=l.toLocaleString("default",{month:"long"});n.push(u),l.setMonth(l.getMonth()+1)}b.value=n}const W=()=>{const{value:o}=R;return o.name==="select department"?!M().$toast.warning("Please select a department"):!0};async function X(){g.value=!0;let o=a.value[0].toString()!=""?v(a.value[0].toString()).format("YYYY-MM-DD"):"",s=a.value[1].toString()!=""?v(a.value[1].toString()).format("YYYY-MM-DD"):"",r=`from=${o}&to=${s}&department=${J(R.value.name)}`;const c={route:`${G.aggregateReports}/lab_statistics?${r}`,method:"GET",token:`${F.value}`},{data:n,error:l,pending:u}=await q(c);if(g.value=u,n.value){Q(n.value.from,n.value.to),U.value=n.value.data,$.value=Z(n.value.data);let f=[];$.value.forEach(w=>{const D={};D["Tests".toUpperCase()]=w.department.toUpperCase(),b.value.forEach(x=>{D[x.toUpperCase()]=""}),D["Total".toUpperCase()]="",f.push(D),w.tests.forEach(x=>{const k={};k["Tests".toUpperCase()]=x.name,b.value.forEach(d=>{k[d.toUpperCase()]=B(x,d)}),k["Total".toUpperCase()]=j(x),f.push(k)})}),f=f,g.value=!1,n.value.data.length>0?M().$toast.success("Report data generated successfully"):M().$toast.warning(`No data found for period ${o} - ${s}`)}l.value&&(g.value=!1,console.error("error: ",l.value),M().$toast.error(ft))}function Z(o){return o.map(s=>{const r=Object.keys(s)[0],c=Object.entries(s[r]).map(([n,l])=>{const u=Object.entries(l).map(([f,w])=>({[f]:w}));return{name:n,results:u}});return{department:r,tests:c}})}function B(o,s){let r=0;return o.results.forEach(c=>{r+=c[s]||0}),r}function j(o){let s=0;return o.results.forEach(r=>{Object.values(r).forEach(c=>{s+=c})}),s}function tt(o){return o%2===0}return K(),(o,s)=>{const r=ot,c=A("datepicker"),n=st,l=pt,u=A("FormKit"),f=dt,w=mt,D=A("excel"),x=ut,k=_t;return i(),p("div",Dt,[m(r,{pages:I}),e("div",{class:"flex items-center py-5"},[kt,e("h3",{class:"text-2xl font-semibold uppercase"},y(te))]),e("div",Ct,[m(u,{type:"form","submit-label":"Update",onSubmit:s[2]||(s[2]=d=>W()&&X()),actions:!1,id:"submitForm"},{default:V(({value:d})=>[e("div",Rt,[e("div",St,[m(t(bt),{class:"w-5 h-5 mr-2"}),O(" Filter By Date Range "),e("div",Tt,[m(c,{onCleared:H,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(a),"onUpdate:modelValue":s[0]||(s[0]=_=>Y(a)?a.value=_:null)},null,8,["modelValue"])])]),e("div",$t,[m(n,{items:t(T),modelValue:t(R),"onUpdate:modelValue":s[1]||(s[1]=_=>Y(R)?R.value=_:null)},null,8,["items","modelValue"])]),m(l,{type:"submit",color:"primary",text:"Generate Report",icon:t(wt),click:()=>{},loading:t(g)},null,8,["icon","loading"])])]),_:1}),e("div",Mt,[m(f),e("div",null,[m(D,{class:"btn btn-default",header:["LABORATORY STATISTICS REPORT ",`PERIOD FROM ${t(v)(t(a)[0].toString()).format("DD-MM-yyyy")} TO ${t(v)(t(a)[1].toString()).format("DD-MM-yyyy")}`,t(E).details.name,t(E).details.address,t(E).details.phone],data:t(z),worksheet:"report-work-sheet",name:`lab-statistics-report_${t(v)(t(a)[0].toString()).format("DD_MM_yyyy")}_to_${t(v)(t(a)[1].toString()).format("DD_MM_yyyy")}.xls`},{default:V(()=>[m(w,{text:"Export Excel"})]),_:1},8,["header","data","name"])])])]),e("div",Et,[e("div",At,[Ot,m(x)]),e("div",Ft,[e("h3",Ut,[O("Tests Performed Period: "),e("span",Bt,y(t(a)[0].toString()!=""?t(v)(t(a)[0].toString()).format("dateFormat"in o?o.dateFormat:t(N)):"")+" - "+y(t(a)[1].toString()!=""?t(v)(t(a)[1].toString()).format("dateFormat"in o?o.dateFormat:t(N)):""),1)])]),e("div",jt,[t($).length>0?(i(),p("table",Pt,[e("thead",Vt,[e("tr",Yt,[Lt,(i(!0),p(C,null,S(t(b),d=>(i(),p("th",{key:d,class:"px-4 py-2"},y(d),1))),128)),Nt])]),e("tbody",null,[(i(!0),p(C,null,S(t($),d=>(i(),p(C,{key:d.department},[e("tr",qt,[e("td",Gt,y(d.department),1),(i(!0),p(C,null,S(t(b),_=>(i(),p("td",{key:_,class:"px-4 py-2"}))),128)),It]),(i(!0),p(C,null,S(d.tests,(_,et)=>(i(),p("tr",{key:_.name,class:lt({"bg-gray-50":tt(et),"border-b border-dotted":!0})},[e("td",zt,y(_.name),1),(i(!0),p(C,null,S(t(b),P=>(i(),p("td",{key:P,class:"px-4 py-2"},y(B(_,P)),1))),128)),e("td",Ht,y(j(_)),1)],2))),128))],64))),128))])])):L("",!0),ct(e("div",Kt,[m(k),Jt],512),[[it,t(g)]]),t(U).length==0&&!t(g)?(i(),p("div",Qt,Zt)):L("",!0)])])])}}});export{Ee as default};
