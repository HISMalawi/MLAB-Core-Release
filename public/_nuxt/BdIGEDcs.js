import{_ as he}from"./MtWVAv6l.js";import{_ as ve}from"./D-cEHdYr.js";import{d as F,C as g,x as z,b as l,e as d,g as e,F as M,k as N,t as r,h as s,az as I,K as T,j as k,a4 as te,r as _,a as xe,c as B,w as Q,y as W,f,H as O,z as Te,O as ee,Z as Ee,L as U,l as V,m as L,u as Y,_ as $e,n as ge,ay as Ae}from"./9XSeHgHf.js";import{_ as Re}from"./D3rdnAkZ.js";import{_ as De,a as Se}from"./DkKIqURC.js";import{_ as ke}from"./DndER3vO.js";import{_ as Me}from"./DGxkzWNY.js";import{u as Ne}from"./0UK1qgr-.js";import{P as Ie}from"./DKEHjzpY.js";import{u as Oe}from"./CrWhNh3r.js";import{r as we}from"./DNfD1q8t.js";import{r as Ce}from"./BaYFf1JQ.js";import"./GyzHslbn.js";import"./IZqDdjE-.js";import"./t_3FEneG.js";import"./rn2SG5fd.js";import"./C_uFo46x.js";import"./-LglSNea.js";import"./B3Ese4Ds.js";import"./C3mF1duK.js";import"./XSM5iu41.js";const Pe=F({props:{data:{required:!0,type:Object}},data(){return{moment:g,headers:[{name:"SN"},{name:"Patient ID"},{name:"Patient Name"},{name:"Accession Number"},{name:"Specimen"},{name:"Receipt Date"},{name:"Tests"},{name:"Performed By"},{name:"Results"},{name:"Remarks"},{name:"Results Entry Date"},{name:"Authorized By"},{name:"Authorized Date"},{name:"Turn Around Time"}],reportData:this.data}}}),Ve={class:"w-full overflow-x-auto"},Le={class:"w-full text-left overflow-y-auto"},Fe={class:"uppercase bg-gray-100"},je={class:"border-b"},Be={class:"px-2 py-2 font-normal border-r"},Ue={class:"px-2 py-2 font-normal border-r"},Ye={class:"px-2 py-2 font-normal border-r"},ze={class:"px-2 py-2 font-normal border-r"},qe={class:"px-2 py-2 font-normal border-r"},Ge={class:"px-2 py-2 font-normal border-r"},He={class:"px-2 py-2 font-normal border-r"},Ke={class:"px-2 py-2 font-normal border-r"},Ze={class:"px-2 py-2 font-normal border-r"},Je={key:0,class:"font-medium"},Xe={class:"px-2 py-2 font-normal border-r"},Qe={class:"px-2 py-2 font-normal border-r"},We={class:"px-2 py-2 font-normal border-r"},et={class:"px-2 py-2 font-normal border-r"},tt={class:"px-2 py-2 font-normal"};function st(a,p,D,y,A,h){return l(),d("div",Ve,[e("table",Le,[e("thead",Fe,[e("tr",je,[(l(!0),d(M,null,N(a.headers,(o,m)=>(l(),d("th",{class:"uppercase py-2 px-2 border-r",key:m},r(o.name),1))),128))])]),e("tbody",null,[(l(!0),d(M,null,N(a.data.data,(o,m)=>(l(),d("tr",{class:"bg-white border-b",key:m},[e("th",Be,r(m+1),1),e("th",Ue,r(o.patient_id),1),e("th",Ye,r(o.patient_name),1),e("th",ze,r(o.accession_number),1),e("th",qe,r(o.specimen),1),e("th",Ge,r(a.moment(o.created_date).format("DATE_TIME_FORMAT"in a?a.DATE_TIME_FORMAT:s(I))),1),e("th",He,r(o.test),1),e("th",Ke,r(o.performed_by),1),e("th",Ze,[(l(!0),d(M,null,N(o.results,(b,R)=>(l(),d("p",{key:R},[b!=null&&b!==""?(l(),d("span",Je,r(`${R}:`),1)):T("",!0),k(" "+r(b),1)]))),128))]),e("th",Xe,r(o.remarks),1),e("th",Qe,r(o.result_date?a.moment(o.result_date).format("DATE_TIME_FORMAT"in a?a.DATE_TIME_FORMAT:s(I)):""),1),e("th",We,r(o.authorized_by),1),e("th",et,r(o.authorized_date?a.moment(o.authorized_date).format("DATE_TIME_FORMAT"in a?a.DATE_TIME_FORMAT:s(I)):""),1),e("th",tt,r(o.tat),1)]))),128))])])])}const ot=z(Pe,[["render",st]]),rt=F({props:{data:{required:!0,type:Object}},data(){var a;return{details:(a=this.data)==null?void 0:a.data}},methods:{removeDuplicates(a){return a.filter((D,y)=>a.findIndex(A=>A.patient_no===D.patient_no)===y)}}}),at={class:"w-full text-left"},nt={class:"px-2 py-2 font-normal border-r border-b"},lt={class:"px-2 py-2 font-normal border-r border-b"},dt={class:"px-2 py-2 font-normal border-r border-b"},ct={class:"px-2 py-2 font-normal border-r border-b"},pt={class:"px-2 py-2 font-normal border-r border-b"},it={class:"px-2 py-2 font-normal border-r border-b"},ut={class:"px-2 py-2 font-normal border-r border-b"},mt={class:"px-2 py-2 font-normal border-r border-b space-y-1"},_t={class:"w-full text-left"},ft={class:"px-2 py-2 font-normal border-r border-b"},bt={class:"px-2 py-2 font-normal border-r border-b"},yt={class:"px-2 py-2 font-normal border-r border-b"};function ht(a,p,D,y,A,h){return l(),d("div",null,[e("div",null,[e("table",at,[p[0]||(p[0]=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"},"SN"),e("th",{class:"uppercase py-2 px-2 border-r"},"PATIENT NO"),e("th",{class:"uppercase py-2 px-2 border-r"},"PATIENT NAME"),e("th",{class:"uppercase py-2 px-2 border-r"},"AGE"),e("th",{class:"uppercase py-2 px-2 border-r"},"SEX"),e("th",{class:"uppercase py-2 px-2 border-r"},"ACCESSION NUMBER"),e("th",{class:"uppercase py-2 px-2 border-r"},"SPECIMEN TYPE"),e("th",{class:"uppercase py-2 px-2 border-r"},"TESTS")])],-1)),e("tbody",null,[(l(!0),d(M,null,N(a.details,(o,m)=>(l(),d("tr",{key:m},[e("th",nt,r(m+1),1),e("th",lt,r(o.patient_no),1),e("th",dt,r(o.patient_name),1),e("th",ct,r(("calculateAge"in a?a.calculateAge:s(te))(o.dob)),1),e("th",pt,r(o.gender),1),e("th",it,r(o.accession_number),1),e("th",ut,r(o.specimen),1),e("th",mt,[(l(!0),d(M,null,N(o.test_type,(b,R)=>(l(),d("p",{key:R},r(b),1))),128))])]))),128))])])]),p[2]||(p[2]=e("div",{class:"px-3 py-3 uppercase"},"SUMMARY",-1)),e("table",_t,[p[1]||(p[1]=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"},"TOTAL VISITS"),e("th",{class:"uppercase py-2 px-2 border-r"},"MALE"),e("th",{class:"uppercase py-2 px-2 border-r"},"FEMALE")])],-1)),e("tbody",null,[e("tr",null,[e("th",ft,r(a.data.visits.length),1),e("th",bt,r(a.removeDuplicates(a.details).filter(o=>o.gender=="M").length),1),e("th",yt,r(a.removeDuplicates(a.details).filter(o=>o.gender=="F").length),1)])])])])}const vt=z(rt,[["render",ht]]),xt=F({props:{data:{required:!0,type:Object}},data(){var a;return{details:(a=this.data)==null?void 0:a.data}}}),Tt={class:"w-full text-left"},Et={class:"px-2 py-2 font-normal border-r border-b"},$t={class:"px-2 py-2 font-normal border-r border-b"},gt={class:"px-2 py-2 font-normal border-r border-b"},At={class:"px-2 py-2 font-normal border-r border-b"},Rt={class:"px-2 py-2 font-normal border-r border-b"},Dt={class:"px-2 py-2 font-normal border-r border-b"},St={class:"px-2 py-2 font-normal border-r border-b"},kt={class:"px-2 py-2 font-normal border-r border-b"},Mt={class:"px-2 py-2 font-normal border-r border-b"};function Nt(a,p,D,y,A,h){return l(),d("div",null,[e("table",Tt,[p[0]||(p[0]=e("thead",{class:"uppercase bg-gray-100"},[e("tr",{class:"border-b"},[e("th",{class:"uppercase py-2 px-2 border-r"}," SN "),e("th",{class:"uppercase py-2 px-2 border-r"}," ACCESSION NUMBER "),e("th",{class:"uppercase py-2 px-2 border-r"}," SPECIMEN "),e("th",{class:"uppercase py-2 px-2 border-r"}," RECEIPT DATE "),e("th",{class:"uppercase py-2 px-2 border-r"}," TESTS "),e("th",{class:"uppercase py-2 px-2 border-r"}," LAB selection "),e("th",{class:"uppercase py-2 px-2 border-r"}," REJECTION REASON "),e("th",{class:"uppercase py-2 px-2 border-r"}," PERSON TALKED TO "),e("th",{class:"uppercase py-2 px-2 border-r"}," DATE REJECTED ")])],-1)),e("tbody",null,[(l(!0),d(M,null,N(a.details,(o,m)=>(l(),d("tr",{key:m},[e("th",Et,r(m+1),1),e("th",$t,r(o.accession_number),1),e("th",gt,r(o.specimen),1),e("th",At,r(o.receipt_date),1),e("th",Rt,r(o.test),1),e("th",Dt,r(o.department),1),e("th",St,r(o.rejection_reason),1),e("th",kt,r(o.person_talked_to),1),e("th",Mt,r(o.test_status_date),1)]))),128))])])])}const It=z(xt,[["render",Nt]]),Ot={class:"px-5 py-5"},wt={class:"flex items-center"},Ct={class:"bg-white flex space-x-5 py-5 flex-wrap"},Pt={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Vt={class:"w-72 ml-2"},Lt={class:"flex flex-col"},Ft={class:"flex flex-col"},jt={class:"flex flex-col"},Bt={class:"flex flex-col"},Ut={class:"border rounded"},Yt={class:"flex items-center justify-between px-5 py-5 border-b"},zt={class:"px-5 py-3"},qt={key:0,class:"text-lg font-semibold"},Gt={class:"text-md font-normal"},Ht={class:"text-lg font-semibold"},Kt={class:"text-md font-normal"},Zt={key:1,class:"text-lg font-semibold"},Jt={class:"font-normal"},Xt={key:0,class:"w-full border-t"},Qt={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Wt={key:2,class:"mx-auto justify-center flex flex-col items-center space-y-3 py-10"},Ts=F({__name:"daily-log",setup(a){Oe({title:`${Ie.name} - Daily Log Reports`});const p=Ne(),D=_([{name:"Home",link:"/home"},{name:"Reports",link:"#"}]),y=xe("token"),A=_([]),h=_({name:"select department"}),o=_([]),m=new Ae,b=_({name:"select test type"}),R=_([]),v=_({name:"select test status"}),E=_(["",""]),i=_({}),q=_(0),se=_([{name:"Test record",value:"test_record"},{name:"Patient record",value:"patient_record"}]),u=_({name:"select report type",value:"select report type"}),$=_(!1),w=B(()=>E.value[0]?g(E.value[0]).format("YYYY-MM-DD"):""),C=B(()=>E.value[1]?g(E.value[1]).format("YYYY-MM-DD"):""),oe=()=>{E.value=["",""]};async function re(){const n={route:V.departments,method:"GET",token:`${y.value}`},{data:t,error:c}=await L(n);t.value&&(A.value=t.value),c.value&&console.error(c.value)}async function G(){const n={route:`${V.testTypes}/by_department?department_id=${h.value.id}`,method:"GET",token:`${y.value}`},{data:t,error:c}=await L(n);t.value&&(o.value=t.value),c.value&&console.error(c.value)}function j(n){let t="";return n=="select department"||n==="select test type"||n==="select test status"?t="":t=n,t}async function ae(){const n={route:`${V.testStatus}/all`,method:"GET",token:`${y.value}`},{data:t,error:c}=await L(n);t.value&&(R.value=t.value),c.value&&console.error(c.value)}const ne=n=>Object.entries(n).map(([t,c])=>`${t}: ${c}`).join(", "),le=B(()=>{let n=new Array;return u.value.value=="test_record"&&i.value.data&&i.value.data.map(t=>{n.push({"PATIENT ID":t.patient_id,"PATIENT NAME":t.patient_name,"ACCESSION NUMBER":t.accession_number,SPECIMEN:t.specimen,"RECEIPT DATE":t.created_date?g(t.created_date).format(I):"",TEST:t.test,"PERFORMED BY":t.performed_by,RESULTS:ne(t.results),REMARKS:t.remarks,"RESULTS ENTRY DATE":t.result_date?g(t.result_date).format(I):"","AUTHORIZED BY":t.authorized_by,"AUTHORIZED DATE":t.authorized_date?g(t.authorized_date).format(I):"","TURN AROUND TIME":t.tat})}),u.value.value=="patient_record"&&i.value.data&&i.value.data.map(t=>{n.push({"PATIENT ID":t.patient_no,"PATIENT NAME":t.patient_name,AGE:te(t.dob),SEX:t.gender,"ACCESSION NUMBER":t.accession_number,"SPECIMEN TYPE":t.specimen,TESTS:t.test_type.join(", ")})}),n}),de=()=>{m.cancel(Y)};async function ce(){var n;if($.value=!0,u.value.value!="select report type"){let t=`from=${w.value}&to=${C.value}&department=${j(h.value.name)}&report_type=${u.value.value}&test_status=${j(v.value.name)}&test_type=${j(b.value.name)}`;const{data:c,error:P,pending:S}=await L({route:`${V.dailyReports}/daily_log?${t}`,method:"GET",token:`${y.value}`},m);$.value=S,c.value&&($.value=!1,((n=c.value)==null?void 0:n.data.length)==0&&Y().$toast.warning("No data found for specified parameters"),i.value=c.value,u.value.value=="test_record"&&(q.value=c.value.completed_tests)),P.value&&($.value=!1,console.error(P.value))}else Y().$toast.warning("Please select the report type before generating the report"),$.value=!1}return Q(()=>h.value,()=>{G()}),Q(()=>u.value,()=>{i.value=[]}),re(),G(),ae(),(n,t)=>{var H,K,Z,J,X;const c=he,P=W("datepicker"),S=ve,pe=$e,ie=Re,ue=W("excel"),me=Se,_e=ot,fe=vt,be=It,ye=ge;return l(),d("div",Ot,[f(c,{pages:s(D)},null,8,["pages"]),t[11]||(t[11]=e("div",{class:"flex items-center py-5"},[e("img",{src:ke,alt:"report-icon",class:"w-8 h-8 mr-2"}),e("h3",{class:"text-2xl font-semibold uppercase"},"Daily Log Report")],-1)),e("div",wt,[e("div",Ct,[e("div",Pt,[f(s(we),{class:"w-5 h-5 mr-2"}),t[5]||(t[5]=k(" Filter By Date Range ")),e("div",Vt,[f(P,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy",onCleared:oe,"input-class-name":"datepicker",modelValue:s(E),"onUpdate:modelValue":t[0]||(t[0]=x=>O(E)?E.value=x:null),"max-date":new Date},null,8,["modelValue","max-date"])])]),e("div",Lt,[f(S,{items:s(A),modelValue:s(h),"onUpdate:modelValue":t[1]||(t[1]=x=>O(h)?h.value=x:null)},null,8,["items","modelValue"])]),e("div",Ft,[f(S,{items:s(o),modelValue:s(b),"onUpdate:modelValue":t[2]||(t[2]=x=>O(b)?b.value=x:null)},null,8,["items","modelValue"])]),e("div",jt,[f(S,{items:s(R),modelValue:s(v),"onUpdate:modelValue":t[3]||(t[3]=x=>O(v)?v.value=x:null)},null,8,["items","modelValue"])]),e("div",Bt,[f(S,{items:s(se),modelValue:s(u),"onUpdate:modelValue":t[4]||(t[4]=x=>O(u)?u.value=x:null)},null,8,["items","modelValue"])]),f(pe,{color:"primary",text:"Generate Report",icon:s(Ce),loading:s($),click:()=>ce()},null,8,["icon","loading","click"]),f(ue,{class:"btn btn-default",header:[`DAILY LOG ${s(u).name.toUpperCase()} REPORT`,`PERIOD: ${s(w)} - ${s(C)}`,s(p).details.name,s(p).details.address,s(p).details.phone],data:s(le),worksheet:"report-work-sheet",name:`daily_log_${s(u).value}_report.xls`},{default:Te(()=>[f(ie,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",Ut,[e("div",Yt,[t[6]||(t[6]=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:Me,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"},"DAILY LOG REPORT")],-1)),f(me)]),e("div",zt,[s(u).value=="test_record"&&s(v).name!=="test-rejected"?(l(),d("h3",qt,[t[7]||(t[7]=k(" Test Record: ")),e("span",Gt,r(s(q).toLocaleString())+" completed tests",1)])):T("",!0),e("h3",Ht,[t[8]||(t[8]=k(" Tests Performed Period: ")),e("span",Kt,r(s(w)?s(g)(s(w)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(ee)):"")+" - "+r(s(C)?s(g)(s(C)).format("DATE_FORMAT"in n?n.DATE_FORMAT:s(ee)):""),1)]),s(v).name==="test-rejected"?(l(),d("h3",Zt,[k(r(("capitalizeStr"in n?n.capitalizeStr:s(Ee))(s(v).name.replaceAll("-"," ")))+": ",1),e("span",Jt,r((H=s(i))!=null&&H.data?(Z=(K=s(i))==null?void 0:K.data)==null?void 0:Z.length:0),1)])):T("",!0)]),((X=(J=s(i))==null?void 0:J.data)==null?void 0:X.length)>0?(l(),d("div",Xt,[s(u).value=="test_record"&&s(v).name!=="test-rejected"?(l(),U(_e,{key:0,data:s(i)},null,8,["data"])):T("",!0),s(u).value=="patient_record"?(l(),U(fe,{key:1,data:s(i)},null,8,["data"])):T("",!0),s(v).name=="test-rejected"?(l(),U(be,{key:2,data:s(i)},null,8,["data"])):T("",!0)])):T("",!0),s(i).length==0&&!s($)?(l(),d("div",Qt,t[9]||(t[9]=[e("img",{src:De,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),e("p",null,"Data not found, please generate report",-1)]))):T("",!0),s($)&&s(i).length==0?(l(),d("div",Wt,[f(ye),t[10]||(t[10]=e("p",{class:"text-base"},[k(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1)),e("button",{class:"font-medium text-base text-sky-500",onClick:de},"Cancel")])):T("",!0)])])}}});export{Ts as default};
