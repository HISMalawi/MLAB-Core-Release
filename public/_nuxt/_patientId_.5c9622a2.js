import{_ as V}from"./Breadcrumb.6b2e0aaf.js";import{u as L,_ as M,f as P,o as d,c,b as w,d as e,w as A,N as j,p as z,j as g,t as o,h as T,k as x,F as f,r as y,v as B,e as q}from"./entry.07439091.js";import{_ as Y}from"./index.8e02fee9.js";import{d as D}from"./constants.06d305c2.js";import{h as R,e as C,f as N,i as U,_ as O}from"./fetch.b0dbeb5a.js";import{u as E}from"./vue.f36acd1f.70ff2b88.js";import{u as G}from"./facility.9663b28a.js";import{P as H}from"./package.d411c004.js";import{r as Q}from"./UserIcon.a7089748.js";import{r as Z}from"./QrCodeIcon.1a95cf3a.js";import{r as J}from"./PrinterIcon.0139b369.js";import{r as K}from"./ArrowPathIcon.e0098bbf.js";import{_ as W}from"./logo.b25abaa2.js";import"./nuxt-link.93f30edb.js";import"./HomeIcon.42729c2c.js";import"./jspdf.es.min.3d7af806.js";import"./XMarkIcon.03d2e3cf.js";import"./transition.d75289e9.js";import"./hidden.0c3ab281.js";import"./PencilSquareIcon.ac5eab04.js";const X={name:"PatientReport",components:{UserIcon:Q,QrCodeIcon:Z},setup(){E({title:`${H.name} - Patient Report`})},data(){return{startDate:"",endDate:"",pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:J,refreshIcon:K,cookie:L("token"),moment:R,facility:G(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){this.loading=!0;const t=this.$route.query.order_id;let r=this.startDate!=""?R(this.startDate).format("YYYY-MM-DD"):"",i=this.endDate!=""?R(this.endDate).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const p={route:`${C.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await N(p);if(this.loading=v,s.value){this.loading=!1,this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let b=s.value.orders.map(_=>{let m=0;return _.tests!==void 0&&(m+=_.tests.filter(k=>k.status.toLowerCase()==="verified").length),{..._,tests_verified:m}});this.reportData=b}n.value&&(this.loading=!1,console.error(n.value))}else{const p={route:`${C.tests}/${this.patientId}/report?from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await N(p);if(this.loading=v,s.value){this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let b=s.value.orders.map(_=>{let m=0;return _.tests!==void 0&&(m+=_.tests.filter(k=>k.status.toLowerCase()==="verified").length),{..._,tests_verified:m}});this.reportData=b,this.loading=!1}n.value&&(console.error(n.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],i=t.find(p=>r.includes(p.status.name));return i?i.initiator.first_name+" "+i.initiator.last_name:""},getOrderStatus(t){return t!==null?this.capitalizeStr(t.split("-")[1]):""},getTestStatusInitiatorName(t,r){const i=t.find(p=>r===p.status.name);return i?{name:i.initiator.first_name+" "+i.initiator.last_name,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return t.map(r=>r.department).join(", ")},getAuthorizedTestCount(t){let r=0;return t.length>0&&t.map(i=>{r=i.tests_verified}),r},showIndicarRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){let r=!1;return t.tests.map(i=>{i.suscept_test_result.length!==0&&(r=!0)}),r},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){let i="";return r.length>0?i=`Growth of ${r.map(s=>s.name).join(", ")}`:i=t,i},shouldPrintSmallLable(t){let r=!1;return t.map(i=>{i.tests.map(p=>{p.print_device&&(r=!0)})}),r},getSmallLabelPrintTests(t){let r=Array();return t.map(i=>{i.tests.map(p=>{p.print_device&&r.push(p.id)})}),r},getPrintCount(t){let r=0;return t.map(i=>{r=r+i.print_count}),r}}},$={class:"py-5 px-5"},ee={class:"mt-2 space-y-3 px-2 py-2"},te={class:"w-full flex items-center justify-between"},se={class:"flex items-center space-x-5"},re={class:"w-52"},oe={class:"w-52"},ne={class:"flex items-center space-x-2"},ae=e("label",null,"Include pending tests",-1),ie={class:"border rounded print-container"},le=e("div",{class:"flex items-center justify-between border-b px-2 py-2"},[e("div",{class:"flex items-center space-x-2"},[e("img",{src:O,class:"w-8 h-8"}),e("h3",null,"Patient Report")])],-1),de={class:"bg-gray-50 rounded-tr rounded-tl border-b px-5 py-5"},ce={class:"flex items-center justify-between"},pe=e("img",{src:W,alt:"app-logo",class:"w-24 h-24 object-cover"},null,-1),ue={class:"space-y-2"},_e={class:"uppercase font-medium"},me={class:"uppercase font-medium"},he={class:"uppercase font-medium"},fe=e("p",{class:"uppercase font-medium underline"},"Laboratory Report",-1),ye={class:"flex items-center justify-between mt-5"},be=e("span",{class:"font-medium"},"Patient Report:",-1),ge=e("span",{class:"font-medium"},"No. Printed:",-1),xe=e("span",{class:"font-medium"},"Date Sample Collected:",-1),ve={class:"w-full mt-5"},ke=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),we={class:"border px-2 py-2"},De=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Se={class:"border px-2 py-2"},Te=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Ie={class:"border px-2 py-2"},Re=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),Pe={class:"border px-2 py-2"},Ae=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),Ce={class:"border px-2 py-2",colspan:"2"},Ne={class:"bg-sky-100 text-sky-600 flex items-center justify-between px-2 py-2 font-medium"},Fe={class:"flex items-center"},Ve={class:"m-3"},Le={class:"border-collapse border border-slate-500 w-full mb-5"},Me=e("td",{class:"border px-2 py-2 font-bold"},"Specimen Type",-1),je={class:"border px-2 py-2"},ze=e("td",{class:"border px-2 py-2 font-bold"},"Date Registered",-1),Be={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold"},"Test Type(s)",-1),Ye={class:"border px-2 py-2"},Ue=e("td",{class:"border px-2 py-2 font-bold"},"Lab Sections",-1),Oe={class:"border px-2 py-2"},Ee=e("td",{class:"border px-2 py-2 font-bold"},"Specimen Status",-1),Ge={class:"border px-2 py-2"},He=e("td",{class:"border px-2 py-2 font-bold"},"Received By",-1),Qe={class:"border px-2 py-2"},Ze={class:"m-3"},Je={class:"border-collapse border w-full"},Ke=e("th",{class:"px-2 py-2"},"Results",-1),We={class:"px-2 py-2"},Xe=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),$e={class:"border px-2 py-2"},et={class:"border px-2 py-2"},tt={class:"w-full h-full"},st=e("td",{class:"border px-2 py-2 font-bold"},"Measure",-1),rt=e("td",{class:"border px-2 py-2 font-bold"},"Result",-1),ot={key:0,class:"border px-2 py-2 font-bold"},nt={class:"border px-2 py-2"},at={class:"border px-2 py-2"},it=["innerHTML"],lt={key:0},dt={class:"border px-2 py-2"},ct={class:"border px-2 py-2"},pt={class:"test-status"},ut=e("p",{class:"font-bold"},"Test Status",-1),_t={class:"px-2"},mt={class:"px-2"},ht={class:"px-2"},ft={key:0,class:"performed-by"},yt=e("p",{class:"font-bold"},"Performed By",-1),bt={class:"px-2"},gt={class:"px-2"},xt={class:"m-2"},vt=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"},"Suscpeptibility Test Results",-1),kt={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},wt={class:"w-full"},Dt=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),St={classs:"border-l border-r"},Tt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},It={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Rt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"};function Pt(t,r,i,p,s,n){const v=V,b=P("datepicker"),_=q,m=Y,k=P("QrCodeIcon");return d(),c("div",$,[w(v,{pages:s.pages},null,8,["pages"]),e("div",ee,[e("div",te,[e("div",se,[e("div",re,[w(b,{placeholder:"-- start date --",format:"dd/MM/yyyy","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",range:!1,shortcuts:!1,modelValue:s.startDate,"onUpdate:modelValue":r[0]||(r[0]=l=>s.startDate=l)},null,8,["modelValue"])]),e("div",oe,[w(b,{placeholder:"-- end date --",format:"dd/MM/yyyy","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",range:!1,shortcuts:!1,modelValue:s.endDate,"onUpdate:modelValue":r[1]||(r[1]=l=>s.endDate=l)},null,8,["modelValue"])]),e("div",ne,[A(e("input",{type:"checkbox","onUpdate:modelValue":r[2]||(r[2]=l=>s.showPendingTests=l)},null,512),[[j,s.showPendingTests]]),ae]),e("div",null,[w(_,{loading:s.loading,color:"success",text:"Generate Report",icon:s.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])])]),e("div",null,[n.getAuthorizedTestCount(s.reportData)>0?(d(),z(m,{key:0,"print-small-label":n.shouldPrintSmallLable(s.reportData),id:n.patientId,orderId:n.orderId,tests:n.getSmallLabelPrintTests(s.reportData),onUpdate:n.updateReport},null,8,["print-small-label","id","orderId","tests","onUpdate"])):g("",!0)])]),e("div",ie,[le,e("div",de,[e("div",ce,[pe,e("div",ue,[e("p",_e,o(s.facility.details.name),1),e("p",me,o(s.facility.details.address),1),e("p",he,o(s.facility.details.phone),1),fe])]),e("div",ye,[e("div",null,[be,T(" "+o(s.moment(new Date).format("dateFormat"in t?t.dateFormat:x(D))),1)]),e("div",null,[ge,T(" "+o(n.getPrintCount(s.reportData)),1)]),e("div",null,[xe,T(" "+o(s.reportData.length>0&&s.moment(s.reportData[0].sample_collected_time).format("dateFormat"in t?t.dateFormat:x(D))),1)])]),e("table",ve,[e("tbody",null,[e("tr",null,[ke,e("td",we,o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`),1),De,e("td",Se,o(s.person.sex==="F"?"Female":"Male"),1),Te,e("td",Ie,o(("calculateAge"in t?t.calculateAge:x(U))(s.person.date_of_birth))+" yr(s)",1)]),e("tr",null,[Re,e("td",Pe,o(s.person.id),1),Ae,e("td",Ce,o(n.getPhysicalAddress),1)])])])]),(d(!0),c(f,null,y(s.reportData,(l,F)=>(d(),c("div",{class:"rounded border border-sky-100 mx-2 my-2",key:F},[e("div",Ne,[e("div",Fe,[w(k,{class:"w-5 h-5 mr-2"}),T(" Accession No: "+o(l.accession_number),1)]),e("div",null,"Requested By: "+o(l.requested_by)+" ("+o(l.requesting_ward)+")",1)]),e("div",Ve,[e("table",Le,[e("tbody",null,[e("tr",null,[Me,e("td",je,o(l.specimen),1),ze,e("td",Be,o(s.moment(l.created_date).format("dateFormat"in t?t.dateFormat:x(D))),1)]),e("tr",null,[qe,e("td",Ye,o(n.getTestTypes(l.test_types)),1),Ue,e("td",Oe,o(n.getDepartments(l.test_types)),1)]),e("tr",null,[Ee,e("td",Ge,o(n.getOrderStatus(l.order_status)),1),He,e("td",Qe,o(n.getOrderStatusInitiatorName(l.order_status_trail)),1)])])])]),e("div",Ze,[e("table",Je,[e("thead",null,[e("tr",null,[Ke,e("th",We,"Tests Authorized("+o(l.tests_verified)+")",1)])]),e("tbody",null,[Xe,(d(!0),c(f,null,y(s.showPendingTests?l.tests:l.tests.filter(a=>a.status.toLowerCase()!=="pending"),a=>(d(),c("tr",{key:a.id},[e("td",$e,o(a.test_type_name),1),e("td",et,[e("table",tt,[e("tr",null,[st,rt,n.showIndicarRanges(a.indicators)?(d(),c("td",ot,"Range")):g("",!0)]),(d(!0),c(f,null,y(a.indicators,u=>{var S,h;return d(),c("tr",null,[e("td",nt,o(u.name),1),e("td",at,[e("p",{innerHTML:n.showResult(((S=u.result)==null?void 0:S.value)??"",a==null?void 0:a.suscept_test_result)},null,8,it),(h=u.result)!=null&&h.value?(d(),c("span",lt,o((a==null?void 0:a.suscept_test_result.length)>0?"":u==null?void 0:u.unit),1)):g("",!0)]),n.showIndicarRanges(a.indicators)?(d(!0),c(f,{key:0},y(u.indicator_ranges,I=>(d(),c("td",{class:"border px-2 py-2 font-bold",key:I.id},[e("span",null,"("+o(I.lower_range)+" - "+o(I.upper_range)+")",1)]))),128)):g("",!0)])}),256))])]),e("td",dt,o((a==null?void 0:a.remarks)??"N/A"),1),e("td",ct,[e("div",pt,[ut,e("p",_t,o(n.getTestStatusName(a.status)),1),e("p",mt,"By: "+o(n.getTestStatusInitiatorName(a.status_trail,a.status).name),1),e("p",ht,"On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,a.status).created_at).format("dateFormat"in t?t.dateFormat:x(D))),1)]),n.getTestStatusInitiatorName(a.status_trail,"completed").name?(d(),c("div",ft,[yt,e("p",bt,o(n.getTestStatusInitiatorName(a.status_trail,"completed").name),1),e("p",gt,"On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:x(D))),1)])):g("",!0)])]))),128))])])]),A(e("div",xt,[vt,e("div",null,[(d(!0),c(f,null,y(l.tests,a=>(d(),c("div",{class:"grid grid-cols-2 gap-4",key:a.id},[a.test_type_name.toLowerCase().includes("culture")?(d(!0),c(f,{key:0},y(a.suscept_test_result,(u,S)=>(d(),c("div",{key:S},[e("div",kt,o(u.name),1),e("table",wt,[Dt,e("tbody",St,[(d(!0),c(f,null,y(n.getFilteredDrugs(u.drugs),h=>(d(),c("tr",{key:h.drug_id},[e("th",Tt,o(h.name),1),e("th",It,o(h.zone),1),e("th",Rt,o(h.interpretation),1)]))),128))])])]))),128)):g("",!0)]))),128))])],512),[[B,n.checkSusceptibilityResults(l)]])]))),128))])])])}const Kt=M(X,[["render",Pt]]);export{Kt as default};
