import{_ as j}from"./Breadcrumb.vue.e4889425.js";import{u as B,_ as z,f as P,o as l,c as d,b as R,d as e,h as g,t as o,w as I,U,p as V,j as S,k as b,F as f,r as y,v as A,e as E}from"./entry.504e3567.js";import{_ as Y}from"./index.6285eafe.js";import{_ as O}from"./Loader.d8ed2750.js";import{a as T,d as w}from"./constants.47b80c98.js";import{h as N,e as F,f as C,d as L}from"./fetch.b3082bb9.js";import{u as G}from"./vue.f36acd1f.ccd3f3bb.js";import{u as H}from"./facility.a25c7714.js";import{P as Q}from"./package.9dfae452.js";import{r as Z}from"./UserIcon.dd3e6bf5.js";import{r as J}from"./QrCodeIcon.32a8e107.js";import{r as K}from"./FunnelIcon.b505e276.js";import{r as W}from"./PrinterIcon.39289cb1.js";import{r as X}from"./ArrowPathIcon.823809c9.js";import{_ as $}from"./logo.5f424d1d.js";import"./nuxt-link.09b9e00f.js";import"./HomeIcon.a5863fa5.js";import"./jspdf.es.min.d6707e67.js";import"./XMarkIcon.a83fbe3b.js";import"./transition.ac68d846.js";import"./hidden.5732ecbe.js";import"./PencilSquareIcon.7237cab8.js";const ee={name:"PatientReport",components:{UserIcon:Z,QrCodeIcon:J,FunnelIcon:K},setup(){G({title:`${Q.name} - Patient Report`})},data(){return{dateRange:[],pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:W,refreshIcon:X,cookie:B("token"),moment:N,facility:H(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){this.loading=!0;const t=this.$route.query.order_id;let r=T[0].toString()!=""?N(T[0].toString()).format("YYYY-MM-DD"):"",i=T[1].toString()!=""?N(T[1].toString()).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const c={route:`${F.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:x}=await C(c);if(this.loading=x,s.value){this.loading=!1,this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let v=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=v}n.value&&(this.loading=!1,console.error(n.value))}else{const c={route:`${F.tests}/${this.patientId}/report?from=${r}&to=${i}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:x}=await C(c);if(this.loading=x,s.value){this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let v=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=v,this.loading=!1}n.value&&(console.error(n.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],i=t.find(c=>r.includes(c.status.name));return i?`${i.initiator.first_name} ${i.initiator.last_name}`:""},getOrderStatus(t){return t!==null?this.capitalizeStr(t.split("-")[1]):""},getTestStatusInitiatorName(t,r){const i=t.find(c=>r===c.status.name);return i?{name:`${i.initiator.first_name} ${i.initiator.last_name}`,created_at:i.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(i=>i.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,i)=>r+i.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0?`Growth of ${r.map(i=>i.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.tests.some(i=>i.print_device))},getSmallLabelPrintTests(t){const r=[];return t.forEach(i=>{i.tests.forEach(c=>{c.print_device&&r.push(c.id)})}),r},getPrintCount(t){return t.reduce((r,i)=>r+i.print_count,0)},getRequiredRange(t,r){const i=t.sex=="M"?"Male":"Female",c=Number(L(t.date_of_birth));return r.filter(s=>s.sex===i&&c>Number(s.min_age)&&c<Number(s.max_age)||s.sex==="Both"&&c>Number(s.min_age)&&c<Number(s.max_age))[0]},shouldDisplayRange(t,r,i){let c=null;return this.showIndicatorRanges(t)&&(c=this.getRequiredRange(r,i.indicator_ranges)),c},getMachineName(t){return t[0].result.machine_name}}},te=""+new URL("medical-record.2202ac05.png",import.meta.url).href,se={class:"py-5 px-5"},re={class:"flex items-center py-5"},oe=e("img",{src:te,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ne={class:"text-2xl font-semibold uppercase"},ae={class:"text-sky-500 text-2xl"},ie={class:"mt-2 space-y-3"},le={class:"w-full flex items-center justify-between"},de={class:"flex items-center space-x-5"},ce={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},pe={class:"w-72 ml-2"},_e={class:"flex items-center space-x-2"},ue=e("label",null,"Include pending tests",-1),me={key:0,class:"border rounded print-container mt-10"},he={class:"rounded-tr rounded-tl border-b px-5 py-5"},be={class:"flex items-center justify-between"},fe=e("div",{class:"flex items-center space-x-2"},[e("img",{src:$,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold"},"PATIENT REPORT")],-1),ye={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},ge={class:"font-normal"},xe={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},ve={class:"flex items-center not-italic text-gray-600"},ke={class:"flex items-center not-italic text-gray-600"},Re={class:"flex items-center justify-between mt-5"},Se=e("span",{class:"font-medium"},"Report Date:",-1),we=e("span",{class:"font-medium"},"No. Printed:",-1),De=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Te={class:"w-full mt-2"},Ie=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Ne={class:"border px-2 py-2"},Pe=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Ae={class:"border px-2 py-2"},Fe=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Ce={class:"border px-2 py-2"},Le=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),Me={class:"border px-2 py-2"},qe=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),je={class:"border px-2 py-2",colspan:"2"},Be={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},ze={class:"flex items-center"},Ue={class:"border-collapse border-slate-500 w-full"},Ve=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),Ee={class:"border-b border-r px-2 py-2"},Ye=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),Oe={class:"border-b px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),He={class:"border-b border-r px-2 py-2"},Qe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),Ze={class:"border-b px-2 py-2"},Je=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),Ke={class:"border-b border-r px-2 py-2"},We=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1),Xe={class:"border-b px-2 py-2"},$e={class:"border-collapse w-full"},et={class:"bg-gray-100 text-gray-600"},tt=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),st={colspan:3,class:"px-2 py-2 text-lg font-semibold"},rt=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),ot={class:"border px-2 py-2"},nt={class:"border"},at={class:"w-full h-full"},it=e("thead",null,[e("tr",null,[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1),lt={class:"border-r border-b px-2 py-2"},dt={class:"border-b px-2 py-2 flex items-center"},ct=["innerHTML"],pt={key:0,class:"text-xs pt-1 pl-1"},_t={key:1},ut={key:0,class:"border px-2 py-2 font-bold"},mt={key:1,class:"border px-2 py-2"},ht={class:"border px-2 py-2"},bt={class:"border px-2 py-2"},ft={class:"test-status"},yt=e("p",{class:"font-bold"},"Test Status",-1),gt={class:"px-2"},xt={class:"px-2"},vt={class:"px-2"},kt={key:0},Rt=e("p",{class:"font-bold"},"Performed By",-1),St={class:"px-2"},wt={class:"px-2 mb-2"},Dt={key:0,class:"mb-2"},Tt=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1),It={class:"m-2"},Nt=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Pt={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},At={class:"w-full"},Ft=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),Ct={classs:"border-l border-r"},Lt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Mt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},qt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},jt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Bt=e("p",{class:"text-base"},[g(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function zt(t,r,i,c,s,n){const x=j,v=P("FunnelIcon"),u=P("datepicker"),m=E,k=Y,M=O;return l(),d("div",se,[R(x,{pages:s.pages},null,8,["pages"]),e("div",re,[oe,e("h3",ne,[g(" patient report for "),e("span",ae,'"'+o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`)+'"',1)])]),e("div",ie,[e("div",le,[e("div",de,[e("div",ce,[R(v,{class:"w-5 h-5 mr-2"}),g(" Filter By Date Range "),e("div",pe,[R(u,{required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=p=>s.dateRange=p)},null,8,["modelValue"])])]),e("div",_e,[I(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=p=>s.showPendingTests=p)},null,512),[[U,s.showPendingTests]]),ue]),R(m,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])]),e("div",null,[n.getAuthorizedTestCount(s.reportData)>0?(l(),V(k,{key:0,"print-small-label":n.shouldPrintSmallLabel(s.reportData),id:n.patientId,orderId:n.orderId,tests:n.getSmallLabelPrintTests(s.reportData),onUpdate:n.updateReport},null,8,["print-small-label","id","orderId","tests","onUpdate"])):S("",!0)])]),s.reportData.length>0?(l(),d("div",me,[e("div",he,[e("div",be,[fe,e("div",ye,[e("address",ge,[e("span",xe,o(s.facility.details.name),1),e("span",ve,o(s.facility.details.address),1),e("span",ke,o(s.facility.details.phone),1)])])]),e("div",Re,[e("div",null,[Se,g(" "+o(s.moment(new Date).format("dateFormat"in t?t.dateFormat:b(w))),1)]),e("div",null,[we,g(" "+o(n.getPrintCount(s.reportData)),1)]),e("div",null,[De,g(" "+o(s.reportData.length>0&&s.moment(s.reportData[0].sample_collected_time).format("dateFormat"in t?t.dateFormat:b(w))),1)])]),e("table",Te,[e("tbody",null,[e("tr",null,[Ie,e("td",Ne,o(`${s.person.first_name} ${s.person.middle_name} ${s.person.last_name}`),1),Pe,e("td",Ae,o(s.person.sex==="F"?"Female":"Male"),1),Fe,e("td",Ce,o(("calculateAge"in t?t.calculateAge:b(L))(s.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[Le,e("td",Me,o(s.person.id),1),qe,e("td",je,o(n.getPhysicalAddress),1)])])])]),(l(!0),d(f,null,y(s.reportData,(p,q)=>(l(),d("div",{key:q},[e("div",Be,[e("div",ze," Accession No: "+o(p.accession_number),1),e("div",null," Requested By: "+o(p.requested_by)+" ("+o(p.requesting_ward)+") ",1)]),e("table",Ue,[e("tbody",null,[e("tr",null,[Ve,e("td",Ee,o(p.specimen),1),Ye,e("td",Oe,o(s.moment(p.created_date).format("dateFormat"in t?t.dateFormat:b(w))),1)]),e("tr",null,[Ge,e("td",He,o(n.getTestTypes(p.test_types)),1),Qe,e("td",Ze,o(n.getDepartments(p.test_types)),1)]),e("tr",null,[Je,e("td",Ke,o(n.getOrderStatus(p.order_status)),1),We,e("td",Xe,o(n.getOrderStatusInitiatorName(p.order_status_trail)),1)])])]),e("table",$e,[e("thead",null,[e("tr",et,[tt,e("th",st," Tests Authorized("+o(p.tests_verified)+") ",1)])]),e("tbody",null,[rt,(l(!0),d(f,null,y(s.showPendingTests?p.tests:p.tests.filter(a=>a.status.toLowerCase()!=="pending"),a=>(l(),d("tr",{key:a.id},[e("td",ot,o(a.test_type_name),1),e("td",nt,[e("table",at,[it,(l(!0),d(f,null,y(a.indicators,_=>{var D,h;return l(),d("tr",null,[e("td",lt,o(_.name),1),e("td",dt,[e("p",{innerHTML:n.showResult(((D=_.result)==null?void 0:D.value)??"",a==null?void 0:a.suscept_test_result)},null,8,ct),(h=_.result)!=null&&h.value?(l(),d("span",pt,o((a==null?void 0:a.suscept_test_result.length)>0?"":_==null?void 0:_.unit),1)):(l(),d("span",_t,"Not done"))]),n.shouldDisplayRange(a.indicators,s.person,_)!==void 0&&n.shouldDisplayRange(a.indicators,s.person,_)!==null?(l(),d("td",ut," ("+o(n.shouldDisplayRange(a.indicators,s.person,_).lower_range)+" - "+o(n.shouldDisplayRange(a.indicators,s.person,_).upper_range)+") ",1)):(l(),d("td",mt,"N/A"))])}),256))])]),e("td",ht,o((a==null?void 0:a.remarks)??"N/A"),1),e("td",bt,[e("div",ft,[yt,e("p",gt,o(n.getTestStatusName(a.status)),1),e("p",xt," By: "+o(n.getTestStatusInitiatorName(a.status_trail,a.status).name),1),e("p",vt," On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,a.status).created_at).format("dateFormat"in t?t.dateFormat:b(w))),1)]),n.getTestStatusInitiatorName(a.status_trail,"completed").name?(l(),d("div",kt,[Rt,e("p",St,o(n.getTestStatusInitiatorName(a.status_trail,"completed").name),1),e("p",wt," On: "+o(s.moment(n.getTestStatusInitiatorName(a.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:b(w))),1),n.getMachineName(a.indicators)?(l(),d("div",Dt,[Tt,e("p",null,o(n.getMachineName(a.indicators)),1)])):S("",!0)])):S("",!0)])]))),128))])]),I(e("div",It,[Nt,e("div",null,[(l(!0),d(f,null,y(p.tests,a=>(l(),d("div",{class:"grid grid-cols-2 gap-4",key:a.id},[a.test_type_name.toLowerCase().includes("culture")?(l(!0),d(f,{key:0},y(a.suscept_test_result,(_,D)=>(l(),d("div",{key:D},[e("div",Pt,o(_.name),1),e("table",At,[Ft,e("tbody",Ct,[(l(!0),d(f,null,y(n.getFilteredDrugs(_.drugs),h=>(l(),d("tr",{key:h.drug_id},[e("th",Lt,o(h.name),1),e("th",Mt,o(h.zone),1),e("th",qt,o(h.interpretation),1)]))),128))])])]))),128)):S("",!0)]))),128))])],512),[[A,n.checkSusceptibilityResults(p)]])]))),128))])):S("",!0),e("div",null,[I(e("div",jt,[R(M),Bt],512),[[A,s.loading]])])])])}const ls=z(ee,[["render",zt]]);export{ls as default};
