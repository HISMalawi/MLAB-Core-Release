import{_ as he}from"./CNMhSPC9.js";import{b as A,e as N,g as e,d as J,r as p,c as ie,z as j,w as Y,o as ge,x as I,f as l,h as a,A as B,F as ye,k as xe,t as S,a as z,u as O,y as c,Y as Q,p as q,G as ee,V as te,j as H,q as ae,S as le,l as L,m as T,E,_ as Z,an as be,a0 as we,s as me,i as K,v as X,n as Ce,ao as Ve,I as ke,U as $e,ap as Pe,X as De,H as re,C as de}from"./B6cxelmB.js";import{_ as pe}from"./8L7Zf1G9.js";import{r as ce}from"./sNlg2jLO.js";import{r as W}from"./BM0_TiSU.js";import{r as Fe}from"./DXWDGmxJ.js";import{r as fe}from"./D5oqNTl_.js";import{r as Ie}from"./D_XcT9Jo.js";import{r as ve}from"./CpO96He0.js";import{_ as Ae}from"./Dp6JBLML.js";import{u as ue}from"./o6wuLrEP.js";import{P as Me}from"./D4--2Hlb.js";import{u as Ue}from"./CZuTiJYT.js";import{r as Be}from"./KGHA3aGV.js";import{r as Oe}from"./Be3OvNuL.js";import{r as Ne}from"./DZ0fSVSz.js";import"./ggmJqlUs.js";import"./D3aePf0O.js";function Se(s,n){return A(),N("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm4.28 10.28a.75.75 0 0 0 0-1.06l-3-3a.75.75 0 1 0-1.06 1.06l1.72 1.72H8.25a.75.75 0 0 0 0 1.5h5.69l-1.72 1.72a.75.75 0 1 0 1.06 1.06l3-3Z","clip-rule":"evenodd"})])}function je(s,n){return A(),N("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{d:"M4.5 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0ZM14.25 8.625a3.375 3.375 0 1 1 6.75 0 3.375 3.375 0 0 1-6.75 0ZM1.5 19.125a7.125 7.125 0 0 1 14.25 0v.003l-.001.119a.75.75 0 0 1-.363.63 13.067 13.067 0 0 1-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 0 1-.364-.63l-.001-.122ZM17.25 19.128l-.001.144a2.25 2.25 0 0 1-.233.96 10.088 10.088 0 0 0 5.06-1.01.75.75 0 0 0 .42-.643 4.875 4.875 0 0 0-6.957-4.611 8.586 8.586 0 0 1 1.71 5.157v.003Z"})])}const qe={class:"w-full flex flex-col space-y-2"},Le={class:""},Te=["checked","onChange"],_e=J({__name:"AgeInput",props:{dateOfBirth:{default:void 0}},emits:["update:modelValue","update:dateOfBirth"],setup(s,{expose:n,emit:C}){const f=s,t=C,m=[{id:"years",label:"Years"},{id:"months",label:"Months"},{id:"weeks",label:"Weeks"},{id:"days",label:"Days"}],k={years:120,months:1440,weeks:6240,days:43800},i=p("days"),r=p(0),y=p(!1),x=ie(()=>`required|min:0|max:${k[i.value]}`),u=ie(()=>`Estimated ${i.value}`),b=ie(()=>!r.value||r.value===0?"":j().subtract(r.value,i.value).format("YYYY-MM-DD")),_=(V,P,U)=>{const F=j().subtract(V,P);return j().diff(F,U)},v=V=>{if(r.value){const P=_(r.value,i.value,V);i.value=V,r.value=P}else i.value=V},$=(V,P)=>{const U=j(V,"YYYY-MM-DD");r.value=j().diff(U,P)},M=()=>{r.value=0,i.value="days"};return Y(r,()=>{!y.value&&r.value!==void 0&&(y.value=!0,t("update:dateOfBirth",b.value),y.value=!1)}),Y(()=>f.dateOfBirth,V=>{V&&!y.value&&$(V,i.value)}),ge(()=>{f.dateOfBirth&&$(f.dateOfBirth,i.value)}),n({reset:M}),(V,P)=>{const U=I("FormKit");return A(),N("div",qe,[l(U,{label:a(u),type:"number",validation:a(x),modelValue:a(r),"onUpdate:modelValue":P[0]||(P[0]=F=>B(r)?r.value=F:null),"validation-messages":{min:"Age cannot be negative",max:`Age cannot exceed ${k[a(i)]} ${a(i)}`}},null,8,["label","validation","modelValue","validation-messages"]),e("div",Le,[(A(),N(ye,null,xe(m,F=>e("label",{key:F.id,class:"flex items-center space-x-2"},[e("input",{type:"radio",checked:a(i)===F.id,onChange:G=>v(F.id),name:"ageUnit",class:"form-radio"},null,40,Te),e("span",null,S(F.label),1)])),64))])])}}}),se="data:image/svg+xml,%3csvg%20width='48'%20height='48'%20viewBox='0%200%2048%2048'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M25.1716%208.17157C26.0154%207.32777%2027.1424%206.93977%2028.2466%207.00756C27.631%205.25582%2025.9622%204%2024%204C21.5147%204%2019.5%206.01472%2019.5%208.5C19.5%2010.9853%2021.5147%2013%2024%2013C24.1751%2013%2024.348%2012.99%2024.5179%2012.9705C23.6533%2011.4448%2023.8712%209.47191%2025.1716%208.17157Z'%20fill='%23333333'/%3e%3cpath%20d='M13.8493%2017.0002C15.0941%2015.7409%2016.8649%2015%2018.9884%2015H29.1716L26.5858%2012.4142C25.8047%2011.6332%2025.8047%2010.3668%2026.5858%209.58579C27.3668%208.80474%2028.6332%208.80474%2029.4142%209.58579L35.4142%2015.5858C35.9862%2016.1578%2036.1573%2017.018%2035.8478%2017.7654C35.5382%2018.5127%2034.8089%2019%2034%2019H30V42C30%2043.0722%2029.1544%2043.9537%2028.0831%2043.9983C27.0118%2044.0428%2026.096%2043.2346%2026.0069%2042.1661L25.1597%2032H22.8403L21.9931%2042.1661C21.904%2043.2346%2020.9882%2044.0428%2019.9169%2043.9983C18.8456%2043.9537%2018%2043.0722%2018%2042V30H21C23.2091%2030%2025%2028.2091%2025%2026C25%2023.7909%2023.2091%2022%2021%2022H18V19.1088C17.3996%2019.2527%2016.9805%2019.5224%2016.694%2019.8123C16.2492%2020.2622%2016.0063%2020.879%2016.0001%2021.5192C15.994%2022.158%2016.2233%2022.758%2016.6498%2023.1924C17.0565%2023.6064%2017.7714%2024%2018.9884%2024H20.9913C22.0959%2024%2022.9913%2024.8954%2022.9913%2026C22.9913%2027.1046%2022.0959%2028%2020.9913%2028H18.9893C16.8375%2028%2015.0466%2027.2686%2013.796%2025.9951C12.5652%2024.742%2011.9848%2023.092%2012.0003%2021.4808C12.0158%2019.871%2012.6259%2018.2378%2013.8493%2017.0002Z'%20fill='%23333333'/%3e%3c/svg%3e",Ee={class:"fixed inset-0 overflow-y-auto"},Ye={class:"flex min-h-full items-center justify-center p-4 text-center"},Re={class:"border-b px-3 py-3 flex items-center justify-between"},ze={class:"mt-2 space-y-3 px-5 py-5"},He={class:"w-full grid grid-cols-3 gap-2"},Ze={class:"w-full flex flex-col space-y-2"},Ge={class:"grid grid-cols-2 gap-2"},Ke={class:"w-full flex flex-col space-y-2"},Xe={class:"w-full"},We={class:"w-full grid grid-cols-2 gap-2"},Je={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},Qe=J({__name:"index",props:{openForm:{type:Boolean},defaultData:{}},emits:["onPatientCreated","sethandleDialog"],setup(s,{emit:n}){const C=n,f=p(!1),t=p(!1),m=z("token"),k=O().$toast,i=s,r=p(""),y=p(""),x=p(""),u=p(""),b=p(""),_=p(""),v=p(""),$=p(""),M=p(!1),V=p(null),P=()=>{f.value=!f.value,C("sethandleDialog",f.value)},U=o=>{$.value=new Date(String(o)).toString(),M.value=!0},F=()=>{var o;(o=V.value)==null||o.reset()},G=async()=>{t.value=!0;const o={route:L.clients,method:"POST",token:`${m.value}`,body:{client:{uuid:""},person:{first_name:y.value,middle_name:x.value,last_name:u.value,sex:_.value.charAt(0),date_of_birth:$.value,birth_date_estimated:M.value},client_identifiers:{current_village:"",current_district:"",current_traditional_authority:"",physical_address:v.value,npid:b.value}}},{data:d,error:g,pending:R}=await T(o);t.value=R,d.value&&(k.success("Patient created successfully!"),P(),h(),C("onPatientCreated",!0),t.value=!1),g.value&&(console.error(g.value),k.error(E),t.value=!1)},h=()=>{var o;r.value="",y.value="",x.value="",u.value="",_.value="",v.value="",$.value="",M.value=!1,(o=V.value)==null||o.reset()};return Y(()=>i.defaultData,o=>{o&&(r.value=o.uuid,y.value=o.firstName,u.value=o.lastName,_.value=o.gender.toUpperCase()=="M"?"Male":"Female")}),Y(()=>i.openForm,o=>{f.value=o}),(o,d)=>{const g=I("FormKit"),R=I("datepicker"),oe=_e,ne=pe,w=Z;return A(),N("div",null,[l(a(le),{appear:"",show:a(f),as:"template"},{default:c(()=>[l(a(Q),{as:"div",onClose:P,class:"relative z-10"},{default:c(()=>[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>d[7]||(d[7]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",Ee,[e("div",Ye,[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[l(a(ee),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",Re,[l(a(te),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>d[8]||(d[8]=[e("img",{src:se,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),H(" Create patient ")])),_:1}),e("button",{onClick:P},[l(a(ae),{class:"w-5 h-5"})])]),l(g,{type:"form",id:"patientForm","submit-label":"Update",onSubmit:G,actions:!1},{default:c(({})=>[e("div",ze,[e("div",He,[l(g,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:a(y),"onUpdate:modelValue":d[0]||(d[0]=D=>B(y)?y.value=D:null)},null,8,["modelValue"]),l(g,{type:"text",label:"Middle name",modelValue:a(x),"onUpdate:modelValue":d[1]||(d[1]=D=>B(x)?x.value=D:null)},null,8,["modelValue"]),l(g,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:a(u),"onUpdate:modelValue":d[2]||(d[2]=D=>B(u)?u.value=D:null)},null,8,["modelValue"])]),e("div",Ze,[d[9]||(d[9]=e("label",{class:"font-medium"},"National Patient ID",-1)),l(g,{type:"text",modelValue:a(b),"onUpdate:modelValue":d[3]||(d[3]=D=>B(b)?b.value=D:null)},null,8,["modelValue"])]),e("div",Ge,[e("div",Ke,[d[10]||(d[10]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Xe,[l(R,{placeholder:"Click to select a date",modelValue:a($),"onUpdate:modelValue":d[4]||(d[4]=D=>B($)?$.value=D:null),range:!1,"max-date":new Date,onCleared:F,"ignore-time-validation":!0,teleport:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",required:""},null,8,["modelValue","max-date"])])]),l(oe,{"onUpdate:dateOfBirth":U})]),e("div",We,[l(g,{modelValue:a(_),"onUpdate:modelValue":d[5]||(d[5]=D=>B(_)?_.value=D:null),type:"radio",label:"Sex",options:["Male","Female"],validation:"required"},null,8,["modelValue"]),l(g,{type:"text",label:"Physical Address",validation:"required",modelValue:a(v),"onUpdate:modelValue":d[6]||(d[6]=D=>B(v)?v.value=D:null)},null,8,["modelValue"])])]),e("div",Je,[l(ne,{type:"button",click:h,text:"Clear form"}),l(w,{type:"submit",click:()=>{},color:"success",icon:a(ce),text:"Save changes",loading:a(t)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),et={class:"fixed inset-0 overflow-y-auto"},tt={class:"flex min-h-full items-center justify-center p-4 text-center"},at={class:"border-b px-3 py-3 flex items-center justify-between"},lt={class:"mt-2 space-y-3 px-5 py-5"},st={class:"w-full grid grid-cols-2 gap-2"},ot={class:"items-center"},nt={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},it=J({__name:"index",emits:["action-completed"],setup(s,{emit:n}){const C=n,f=p(!1),t=p(!1),m=z("token"),{$toast:k}=O(),i=p({firstName:"",lastName:"",gender:""}),r=()=>f.value=!f.value,y=async()=>{t.value=!0;const x={route:we(L.client.search,{first_name:i.value.firstName,last_name:i.value.lastName,gender:i.value.gender}),method:"GET",token:`${m.value}`},{data:u,error:b,pending:_}=await T(x);t.value=_,u.value&&(r(),C("action-completed",{patient:u.value,defaults:i.value}),i.value={firstName:"",lastName:"",gender:""}),b.value&&k.error(`${E}`),t.value=f.value=!1};return(x,u)=>{const b=Z,_=I("FormKit");return A(),N("div",null,[e("div",null,[l(b,{text:"Find/Create Patient",color:"primary",icon:a(W),click:r},null,8,["icon"])]),l(a(le),{appear:"",show:a(f),as:"template"},{default:c(()=>[l(a(Q),{as:"div",onClose:r,class:"relative z-10"},{default:c(()=>[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>u[3]||(u[3]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",et,[e("div",tt,[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[l(a(ee),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",at,[l(a(te),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>u[4]||(u[4]=[e("img",{src:se,class:"w-8 h-8 mr-2"},null,-1),H(" "+S("Find or Create patient"))])),_:1}),e("button",{onClick:r},[l(a(ae),{class:"w-5 h-5"})])]),l(_,{type:"form",onSubmit:y,actions:!1},{default:c(({})=>[e("div",lt,[e("div",st,[l(_,{type:"text",label:"First name",validation:"required",modelValue:a(i).firstName,"onUpdate:modelValue":u[0]||(u[0]=v=>a(i).firstName=v)},null,8,["modelValue"]),l(_,{type:"text",label:"Last name",validation:"required",modelValue:a(i).lastName,"onUpdate:modelValue":u[1]||(u[1]=v=>a(i).lastName=v)},null,8,["modelValue"])]),e("div",ot,[l(_,{modelValue:a(i).gender,"onUpdate:modelValue":u[2]||(u[2]=v=>a(i).gender=v),type:"radio",label:"Gender",options:"sex"in x?x.sex:a(be),validation:"required"},null,8,["modelValue","options"])])]),e("div",nt,[l(b,{type:"submit",click:()=>{},color:"success",icon:a(Se),text:"Find",loading:a(t)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),rt={components:{TransitionRoot:le,TransitionChild:q,Dialog:Q,DialogPanel:ee,DialogTitle:te,XMarkIcon:ae,UserIcon:Fe},props:{data:{required:!0,type:Object}},data(){return{details:new Object,open:!1,addIcon:W,viewIcon:fe,saveIcon:ce,clearIcon:Ie,cookie:z("token"),loading:!1}},methods:{async init(){this.adjustVisibility(),this.loading=!0;const s={route:`${L.clients}/${this.data.client_id}`,method:"GET",token:`${this.cookie}`},{data:n,pending:C,error:f}=await T(s);n.value&&(this.details=n.value,this.loading=!1),f.value&&(console.log(f.value),O().$toast.error(E))},adjustVisibility(){this.open=!this.open}}},dt={class:"fixed inset-0 overflow-y-auto"},ut={class:"flex min-h-full items-center justify-center p-4 text-center"},ct={class:"border-b px-3 py-3 flex items-center justify-between"},mt={class:"flex items-center justify-center mx-auto my-20"},pt={class:"mt-2 space-y-3 px-5 py-5"},ft={class:"w-full flex flex-col space-y-1"},vt={class:"underline"},_t={class:"w-full flex flex-col space-y-1"},ht={class:"underline"},gt={class:"w-full flex flex-col space-y-1"},yt={class:"underline"},xt={class:"w-full flex flex-col space-y-1"},bt={class:"underline"},wt={class:"w-full flex flex-col space-y-1"},Ct={class:"underline"};function Vt(s,n,C,f,t,m){const k=Z,i=I("TransitionChild"),r=I("DialogTitle"),y=I("XMarkIcon"),x=Ce,u=I("DialogPanel"),b=I("Dialog"),_=I("TransitionRoot");return A(),N("div",null,[e("div",null,[l(k,{text:"View",color:"success",icon:t.viewIcon,click:m.init},null,8,["icon","click"])]),l(_,{appear:"",show:t.open,as:"template"},{default:c(()=>[l(b,{as:"div",onClose:m.adjustVisibility,class:"relative z-10"},{default:c(()=>[l(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>n[1]||(n[1]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",dt,[e("div",ut,[l(i,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[l(u,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",ct,[l(r,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>n[2]||(n[2]=[e("img",{src:se,class:"w-8 h-8 mr-2"},null,-1),H(" View patient ")])),_:1}),e("button",{onClick:n[0]||(n[0]=(...v)=>m.adjustVisibility&&m.adjustVisibility(...v))},[l(y,{class:"w-5 h-5"})])]),K(e("div",mt,[l(x,{loading:t.loading},null,8,["loading"])],512),[[X,t.loading]]),K(e("div",pt,[e("div",ft,[n[3]||(n[3]=e("label",{class:"font-semibold text-lg"},"Name",-1)),e("p",vt,S(`${t.details.first_name} ${t.details.last_name}`),1)]),e("div",_t,[n[4]||(n[4]=e("label",{class:"font-semibold text-lg"},"National Patient ID",-1)),e("p",ht,S(t.details.npid),1)]),e("div",gt,[n[5]||(n[5]=e("label",{class:"font-semibold text-lg"},"Date Of Birth",-1)),e("p",yt,S(t.details.date_of_birth),1)]),e("div",xt,[n[6]||(n[6]=e("label",{class:"font-semibold text-lg"},"Sex",-1)),e("p",bt,S(t.details.sex),1)]),e("div",wt,[n[7]||(n[7]=e("label",{class:"font-semibold text-lg"},"Physical Address",-1)),e("p",Ct,S(t.details.physical_address),1)])],512),[[X,!t.loading]])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const kt=me(rt,[["render",Vt]]),$t={class:"fixed inset-0 overflow-y-auto"},Pt={class:"flex min-h-full items-center justify-center p-4 text-center"},Dt={class:"border-b px-3 py-3 flex items-center justify-between"},Ft={class:"mt-2 space-y-3 px-5 py-5"},It={class:"w-full grid grid-cols-2 gap-2"},At={class:"w-full grid grid-cols-3 gap-2"},Mt={class:"grid grid-cols-2 gap-2"},Ut={class:"w-full flex flex-col space-y-2"},Bt={class:"w-full"},Ot={class:"w-full grid grid-cols-2 gap-2"},Nt={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},St=J({__name:"index",props:{data:{required:!0,type:Object}},emits:["update"],setup(s,{emit:n}){const C=s,f=n,t=p({uuid:"",npid:"",first_name:"",middle_name:"",last_name:"",date_of_birth:"",gender:"",physical_address:"",value:void 0,id:0,client_id:0,sex:"",phone:"",birth_date_estimated:!1}),m=p(!1),k=ce,i=ve,r=p(!1),y=z("token"),x=p(!1),u=p(!1),b=p(!1),_=p(""),v=p(""),$=p(null),M=()=>{m.value=!m.value},V=h=>{t.value.birth_date_estimated=!0,b.value=!0},P=()=>{var h;_.value="",b.value=!1,(h=$.value)==null||h.reset()},U=()=>{var h;(h=$.value)==null||h.reset()},F=async()=>{const h={route:`${L.clients}/${C.data.client_id}`,method:"GET",token:`${y.value}`},{data:o,error:d}=await T(h);o.value&&(t.value=o.value,v.value=o.value.gender=="M"?"Male":"Female",M()),d.value&&(console.error(d.value),O().$toast.error(E))},G=async()=>{r.value=!0;const h={route:`${L.clients}/${C.data.client_id}`,method:"PUT",token:`${y.value}`,body:{client:{uuid:t.value.uuid},person:{first_name:t.value.first_name,middle_name:t.value.middle_name,last_name:t.value.last_name,sex:v.value.charAt(0),date_of_birth:t.value.date_of_birth,birth_date_estimated:b.value},client_identifiers:[{type:"physical_address",value:t.value.physical_address},{type:"phone",value:t.value.phone},{type:"npid",value:t.value.npid}]}},{data:o,error:d,pending:g}=await T(h);r.value=g,o.value&&(r.value=!1,Object.assign(t,{}),O().$toast.success("Patient updated successfully!"),M(),f("update",!0)),d.value&&(r.value=!1,console.error(d.value),O().$toast.error(E))};return Y(()=>t.value.date_of_birth,h=>{!u.value&&h&&(x.value=!0,t.value.age=Number(Ve(h)),x.value=!1)}),Y(()=>t.value.age,(h,o)=>{h!==o&&h!=null&&!x.value&&!t.value.date_of_birth&&(u.value=!0,t.value.date_of_birth=j().subtract(h,"years").format("YYYY-MM-DD"),u.value=!1,b.value=!0)}),(h,o)=>{const d=Z,g=I("FormKit"),R=I("datepicker"),oe=_e,ne=pe;return A(),N("div",null,[e("div",null,[l(d,{text:"Edit",color:"primary",icon:a(i),click:F},null,8,["icon"])]),l(a(le),{appear:"",show:a(m),as:"template"},{default:c(()=>[l(a(Q),{as:"div",onClose:M,class:"relative z-10"},{default:c(()=>[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>o[9]||(o[9]=[e("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),e("div",$t,[e("div",Pt,[l(a(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[l(a(ee),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:c(()=>[e("div",Dt,[l(a(te),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:c(()=>o[10]||(o[10]=[e("img",{src:se,class:"w-8 h-8 mr-2",alt:"nausea-icon"},null,-1),H(" Edit patient ")])),_:1}),e("button",{onClick:M},[l(a(ae),{class:"w-5 h-5"})])]),l(g,{type:"form",id:"editPatientForm","submit-label":"Update",onSubmit:G,actions:!1},{default:c(()=>[e("div",Ft,[e("div",It,[l(g,{type:"text",label:"Patient ID",modelValue:a(t).uuid,"onUpdate:modelValue":o[0]||(o[0]=w=>a(t).uuid=w)},null,8,["modelValue"]),l(g,{type:"text",label:"National Patient ID",modelValue:a(t).npid,"onUpdate:modelValue":o[1]||(o[1]=w=>a(t).npid=w)},null,8,["modelValue"])]),e("div",At,[l(g,{type:"text",label:"First name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"First name must contain only letters, no spaces or special characters"},modelValue:a(t).first_name,"onUpdate:modelValue":o[2]||(o[2]=w=>a(t).first_name=w)},null,8,["modelValue"]),l(g,{type:"text",label:"Middle name",modelValue:a(t).middle_name,"onUpdate:modelValue":o[3]||(o[3]=w=>a(t).middle_name=w)},null,8,["modelValue"]),l(g,{type:"text",label:"Last name",validation:"required|matches:/^[a-zA-Z']+$/","validation-messages":{matches:"Last name must contain only letters, no spaces or special characters"},modelValue:a(t).last_name,"onUpdate:modelValue":o[4]||(o[4]=w=>a(t).last_name=w)},null,8,["modelValue"])]),e("div",Mt,[e("div",Ut,[o[11]||(o[11]=e("label",{class:"font-medium"},"Date Of Birth",-1)),e("div",Bt,[l(R,{placeholder:"Click to select a date",modelValue:a(t).date_of_birth,"onUpdate:modelValue":o[5]||(o[5]=w=>a(t).date_of_birth=w),range:!1,"max-date":new Date,onCleared:U,"ignore-time-validation":!0,teleport:!0,"input-class-name":"datepicker",format:"dd/MM/yyyy",required:""},null,8,["modelValue","max-date"])])]),l(oe,{dateOfBirth:a(t).date_of_birth,"onUpdate:dateOfBirth":[o[6]||(o[6]=w=>a(t).date_of_birth=w),V]},null,8,["dateOfBirth"])]),e("div",Ot,[l(g,{modelValue:a(v),"onUpdate:modelValue":o[7]||(o[7]=w=>B(v)?v.value=w:null),type:"radio",label:"Sex",options:["Male","Female"],validation:"required"},null,8,["modelValue"]),l(g,{type:"text",label:"Physical Address",validation:"required",modelValue:a(t).physical_address,"onUpdate:modelValue":o[8]||(o[8]=w=>a(t).physical_address=w)},null,8,["modelValue"])])]),e("div",Nt,[l(ne,{type:"button",click:P,text:"Clear form"}),l(d,{type:"submit",click:()=>{},color:"success",icon:a(k),text:"Save changes",loading:a(r)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),jt={components:{UsersIcon:je,PlusIcon:W,MagnifyingGlassIcon:Be},setup(){Ue({title:`${Me.name.toUpperCase()} - Patients`})},data(){return{loading:!1,openCreatePatientForm:!1,newIcon:Oe,defaultData:{},editIcon:ve,viewIcon:fe,refreshIcon:Ne,headers:new Array({text:"patient no",value:"client_id",sortable:!0},{text:"name",value:"name",sortable:!0},{text:"sex",value:"sex",sortable:!0},{text:"date of birth",value:"date_of_birth",sortable:!0},{text:"physical address",value:"physical_address",sortable:!0},{text:"actions",value:"actions"}),pages:[{name:"Home",link:"/home"}],data:{},addIcon:W,patients:new Array,cookie:z("token"),serverItemsLength:0,serverOptions:{page:1,rowsPerPage:25,sortBy:"name"},searchField:"name",search:"",searchValue:"",createPatient:!1,showSearch:!1}},created(){this.init()},methods:{updateSearch(s){this.searchValue=s,this.search=s,this.updatePatients(!0)},async init(){this.createPatient=!1,this.defaultData={firstName:"",lastName:"",middleName:"",gender:""},this.loading=!0;const{page:s,rowsPerPage:n}=this.serverOptions,C=ke(),f=$e(C.locations.filter(r=>typeof r.id=="number"),C.selectedLocation),t={route:`${L.clients}?page=${s}&per_page=${n}&search=${this.search}&lab_location=${f}`,method:"GET",token:`${this.cookie}`};let{data:m,error:k,pending:i}=await T(t);this.loading=i,m.value&&(this.patients=m.value.clients,this.serverItemsLength=m.value.meta.total_count),k.value&&(console.error(k.value.data),O().$toast.error(`${E}`))},updatePatients(s){typeof s=="object"&&(this.serverOptions=s),this.init()},async handleClick(s){this.data=s,s.source==="remote"&&await this.handleSaveRemotePatient(this.data),this.$router.push(`/tests/new-test?patient_id=${s.client_id}`)},async handleSaveRemotePatient(s){const n={route:L.clients,method:"POST",token:this.cookie,body:{client:{uuid:s.uuid},person:{first_name:s.first_name,middle_name:s.middle_name,last_name:s.last_name,sex:s.sex,date_of_birth:s.date_of_birth,birth_date_estimated:!1},client_identifiers:{current_village:s.current_village,current_district:s.current_district,current_traditional_authority:s.current_traditional_authority,physical_address:`${s.home_village} ${s.home_traditional_authority} ${s.home_district}`,npid:s.npid}}},{data:C,error:f,pending:t}=await T(n);C.value&&(this.data=C.value),f.value&&O().$toast.error(`${E}`)},handleActionCompleted(s){s.patient.length>0?(this.createPatient=!0,this.patients=s.patient,this.serverItemsLength=s.patient.length,this.showSearch=!0):(O().$toast.warning("Patient not found"),this.openCreatePatientForm=!0,this.defaultData=s.defaults,this.showSearch=!1)},setCreatePatientFormVisibility(s){this.openCreatePatientForm=s}},computed:{filteredPatients(){return this.patients.map(s=>({...s,name:Pe(`${s.first_name} ${s.middle_name!=null?s.middle_name:""} ${s.last_name}`),date_of_birth:j(s.date_of_birth).format(De)}))}}},qt={class:"py-5 px-5"},Lt={class:"flex justify-between items-center w-full py-2 mb-2"},Tt={class:"flex items-center space-x-2"},Et={class:"mb-2.5"},Yt={class:"text-lg font-medium"},Rt={class:"py-2 flex items-center space-x-2"};function zt(s,n,C,f,t,m){var _,v;const k=he,i=Z,r=Qe,y=it,x=kt,u=St,b=Ae;return A(),N("div",qt,[l(k,{pages:t.pages},null,8,["pages"]),n[1]||(n[1]=e("div",{class:"flex items-center space-x-2 py-5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},[e("path",{fill:"currentColor",d:"M16 11a4 4 0 1 0 0-8a4 4 0 0 0 0 8m-6-3.5a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0m19 0a3.5 3.5 0 1 1-7 0a3.5 3.5 0 0 1 7 0M9.377 13a3.98 3.98 0 0 0-.877 2.5V23c0 1.235.298 2.4.827 3.427A5 5 0 0 1 2 22v-6.5A2.5 2.5 0 0 1 4.5 13zm13.296 13.427A7.5 7.5 0 0 0 23.5 23v-7.5c0-.946-.328-1.815-.877-2.5H27.5a2.5 2.5 0 0 1 2.5 2.5V22a5 5 0 0 1-7.327 4.427M12.5 13a2.5 2.5 0 0 0-2.5 2.5V23a6 6 0 0 0 12 0v-7.5a2.5 2.5 0 0 0-2.5-2.5z"})]),e("h3",{class:"text-2xl font-semibold uppercase"},"Patients")],-1)),e("div",Lt,[e("div",Tt,[l(i,{color:"warning",icon:t.refreshIcon,text:"Refresh",click:()=>{m.init()}},null,8,["icon","click"]),K(l(i,{click:()=>{t.openCreatePatientForm=!0},text:"Create a new patient",color:"success",icon:t.addIcon},null,8,["click","icon"]),[[X,t.createPatient]])]),("usePermissions"in s?s.usePermissions:a(ue))().can.manage("patients")?(A(),re(r,{key:0,openForm:t.openCreatePatientForm,onSethandleDialog:m.setCreatePatientFormVisibility,onOnPatientCreated:m.updatePatients,"default-data":t.defaultData},null,8,["openForm","onSethandleDialog","onOnPatientCreated","default-data"])):de("",!0),("usePermissions"in s?s.usePermissions:a(ue))().can.manage("patients")?(A(),re(y,{key:1,onActionCompleted:m.handleActionCompleted},null,8,["onActionCompleted"])):de("",!0)]),K(e("div",Et,[n[0]||(n[0]=H(" Showing results for ")),e("span",Yt,S(`${(_=t.defaultData)==null?void 0:_.firstName} ${(v=t.defaultData)==null?void 0:v.lastName}`),1)],512),[[X,t.showSearch]]),("usePermissions"in s?s.usePermissions:a(ue))().can.manage("patients")?(A(),re(b,{key:0,headers:t.headers,data:m.filteredPatients,loading:t.loading,searchField:t.searchField,searchValue:t.searchValue,serverItemsLength:t.serverItemsLength,serverOptions:t.serverOptions,onUpdate:m.updatePatients},{actions:c(({item:$})=>[e("div",Rt,[l(i,{click:()=>m.handleClick($),text:"New Test",color:"primary",icon:t.newIcon},null,8,["click","icon"]),l(x,{data:$},null,8,["data"]),l(u,{data:$,onUpdate:m.updatePatients},null,8,["data","onUpdate"])])]),_:1},8,["headers","data","loading","searchField","searchValue","serverItemsLength","serverOptions","onUpdate"])):de("",!0)])}const ua=me(jt,[["render",zt]]);export{ua as default};
