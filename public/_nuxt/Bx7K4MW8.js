import{_ as ne}from"./COJDNupw.js";import{_ as le}from"./CoQgzhbz.js";import{d as ce,r as k,ar as j,a as de,a5 as ie,ak as ue,u as pe,c as M,C as f,w as P,o as L,y as V,b as i,e as u,f as v,h as e,g as r,t as x,k as B,H as N,z as me,O as A,F as $,j as C,K as G,l as U,m as _e,E as fe,_ as ve}from"./BxD-h1LR.js";import{_ as he}from"./C2S1Arkw.js";import{_ as ye}from"./BNhNOnHe.js";import{_ as Re}from"./Cs7plFji.js";import{u as be,_ as ge}from"./NR9_F3jh.js";import{u as xe}from"./BmiBNsbw.js";import{_ as Ee}from"./CKMQEpqg.js";import{_ as Te}from"./B4cMvEBz.js";import{_ as De}from"./CQcCm1L6.js";import{u as we}from"./DRcUz5ts.js";import{P as ke}from"./C1C0mJ5v.js";import{r as Me}from"./BkJfYQCG.js";import{r as $e}from"./CQe3LSWs.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";const Ae={class:"px-5 py-5"},Ce=r("img",{src:Ee,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),qe={class:"w-full flex items-center justify-between"},Oe={class:"flex items-center space-x-3"},Fe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Se={class:"w-72 ml-2"},Ye={class:"w-44"},je={class:"flex items-center space-x-3"},Pe={class:"border rounded mt-5"},Le={class:"flex items-center justify-between px-5 py-5 border-b"},Ve=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Te,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold"},"REJECTED SAMPLES REPORT")],-1),Be={class:"mt-3 px-5"},Ne={class:"text-lg font-semibold mb-2"},Ge={class:"text-normal font-normal"},Ue={key:0,class:"print-container",id:"print-container"},He={class:"w-full border border-dotted rounded overflow-x-auto"},Qe={class:"bg-gray-50 border-b border-dotted rounded-t"},ze=r("th",{class:"border-r border-b border-dotted px-2 py-2 font-semibold"}," TESTS ",-1),Ie=r("th",{class:"border-r border-t border-b border-dotted px-2 py-2"},"TOTAL",-1),Je={class:"border-r border-b border-dotted px-2 py-2"},Ke=["onClick"],We={class:"border-r border-t border-b border-dotted px-2 py-2 font-bold"},Xe={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Ze=r("img",{src:De,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),et=r("p",{class:"text-base"},"Please generate report data to preview the report",-1),tt=[Ze,et],ot="Rejected Samples Report",$t=ce({__name:"rejected-samples",setup(rt){xe({title:`${ke.name.toUpperCase()} - Rejected Samples Report`});const H=k([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),O=k([]),p=k({name:j}),F=de("token"),q=we(),g=ie(),m=ue(),{loading:R,executeCancellableRequest:Q,cancelRequest:z}=be(),c=k(["",""]),{$toast:w}=pe(),I=()=>{c.value=new Array("","")},h=k({results:[],value:void 0,wards:[]}),S=M(()=>h.value.results.map(o=>{const t={};o.test_types.forEach(a=>{const{name:n,ward:l,count:y,associated_ids:_}=a;t[n]||(t[n]={}),t[n][l]||(t[n][l]={count:0,associated_ids:""}),t[n][l].count+=y,t[n][l].associated_ids=_});const s=Object.keys(t).map(a=>({name:a,wards:t[a]}));return{name:o.name,testTypes:s}})),J=M(()=>{const o=[];return h.value.results.forEach(t=>{const s={},a={};t.test_types.forEach(n=>{const{name:l,ward:y,count:_}=n;s[l]||(s[l]={},a[l]=0),s[l][y]=_||0,a[l]+=_});for(const n in s){const l=s[n],y={TESTS:n};h.value.wards.forEach(_=>{y[_]=l[_]!==void 0?l[_]:0}),y.TOTAL=a[n],o.push(y)}}),o}),K=(o,t)=>{const s=S.value.find(n=>n.name===o),a=s==null?void 0:s.testTypes.find(n=>n.name===t);return a?Object.values(a.wards).reduce((n,l)=>n+l.count,0):0};async function W(){const o={route:U.departments,method:"GET",token:`${F.value}`},{data:t,error:s}=await _e(o);t.value&&(O.value=t.value),s.value&&console.error(s.value)}const E=M(()=>c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):""),T=M(()=>c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"");async function Y(){if(X())w.warning("Please select a department");else{R.value=!0;const o={route:`${U.aggregateReports}rejected?from=${E.value}&to=${T.value}&department=${p.value.id}&report_id=${m.query.report_id}`,method:"GET",token:`${F.value}`},{data:t,error:s,pending:a}=await Q(o);R.value=a,t.value&&(R.value=!1,h.value=t.value,Z(t.value.report_id),t.value.results.length>0?w.success("Report generated successfully!"):w.warning("Data not found within the specified period")),s.value&&(console.error(s.value),R.value=!1,w.error(fe))}}const X=()=>p.value.name==j,Z=o=>{const s={...g.currentRoute.value.query,report_id:o};g.replace({query:s}).catch(a=>{console.error("Failed to replace route:",a)})},ee=(o,t,s,a)=>{s!==0&&a!==""?g.push(`/reports/${a}?origin=aggregate&type=rejected-samples-report&from=${E.value}&to=${T.value}&test=${o} - ${t}&department=${p.value.name}&count=${s}`):w.warning("No data found for this month")};P(c,()=>{const o=c.value[0]?f(c.value[0]).format("YYYY-MM-DD"):"",t=c.value[1]?f(c.value[1]).format("YYYY-MM-DD"):"";if(o||t){const a={...g.currentRoute.value.query,...o&&{from:o},...t&&{to:t}};g.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0}),P(p,(o,t)=>{if(o!==t){const a={...g.currentRoute.value.query,department:o.name||void 0,report_id:""};g.replace({query:a}).catch(n=>{console.error("Failed to replace route:",n)})}});const te=M(()=>m.query.to!==void 0&&m.query.from!==void 0&&m.query.department!==void 0?(c.value=[m.query.from,m.query.to],p.value.name=`${m.query.department}`,m.query.to!==""&&m.query.from!==""&&m.query.department!==""):!1);return L(()=>{te.value&&Y()}),L(()=>{W()}),(o,t)=>{const s=ne,a=V("datepicker"),n=le,l=ve,y=he,_=ye,oe=V("excel"),re=Re,se=ge;return i(),u("div",Ae,[v(s,{pages:e(H)},null,8,["pages"]),r("div",{class:"flex items-center py-5"},[Ce,r("h3",{class:"text-2xl font-semibold uppercase"},x(ot))]),r("div",qe,[r("div",Oe,[r("div",Fe,[v(e(Me),{class:"w-5 h-5 mr-2"}),B(" Filter By Date Range "),r("div",Se,[v(a,{onCleared:I,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:e(c),"onUpdate:modelValue":t[0]||(t[0]=D=>N(c)?c.value=D:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),r("div",Ye,[v(n,{items:e(O),modelValue:e(p),"onUpdate:modelValue":t[1]||(t[1]=D=>N(p)?p.value=D:null)},null,8,["items","modelValue"])]),v(l,{color:"primary",text:"Generate Report",icon:e($e),click:()=>Y(),loading:e(R)},null,8,["icon","click","loading"])]),r("div",je,[v(y,{printSmallLabel:!1}),v(oe,{class:"btn btn-default",header:[`REJECTED ${e(p).name.toUpperCase()} SAMPLES REPORT`,`PERIOD FROM ${e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A))} TO ${e(f)(e(T)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A))}`,e(q).details.name,e(q).details.address,e(q).details.phone],data:e(J),worksheet:"report-work-sheet",name:`rejected_${e(p).name.toLowerCase().split(" ").join("_")}_report_${e(f)(e(E)).format("DD_MM_yyyy")}_to_${e(f)(e(T)).format("DD_MM_yyyy")}.xls`},{default:me(()=>[v(_,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),r("div",Pe,[r("div",Le,[Ve,v(re)]),r("div",Be,[r("h3",Ne,[B(" Tests Performed Period: "),r("span",Ge,x(e(E)!=""?e(f)(e(E)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A)):"")+" - "+x(e(T)!=""?e(f)(e(T)).format("DATE_FORMAT"in o?o.DATE_FORMAT:e(A)):""),1)])]),e(h).results.length>0&&!e(R)?(i(),u("div",Ue,[r("table",He,[(i(!0),u($,null,C(e(S),(D,ae)=>(i(),u($,{key:ae},[r("thead",Qe,[r("tr",null,[ze,(i(!0),u($,null,C(e(h).wards,d=>(i(),u("th",{key:d,class:"border-r border-b border-dotted px-2 py-2 uppercase font-semibold"},x(d),1))),128)),Ie])]),r("tbody",null,[(i(!0),u($,null,C(D.testTypes,d=>(i(),u("tr",{key:d.name},[r("td",Je,x(d.name),1),(i(!0),u($,null,C(e(h).wards,b=>(i(),u("td",{key:b,onClick:st=>ee(d.name,b,d.wards[b]?d.wards[b].count:0,d.wards[b]?d.wards[b].associated_ids:""),class:"px-4 border-r border-dotted py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(d.wards[b]?d.wards[b].count:0),9,Ke))),128)),r("td",We,x(K(D.name,d.name)),1)]))),128))])],64))),128))])])):G("",!0),v(se,{condition:e(R),cancelReportGeneration:()=>e(z)()},null,8,["condition","cancelReportGeneration"]),e(h).wards.length==0&&e(h).results.length==0&&!e(R)?(i(),u("div",Xe,tt)):G("",!0)])])}}});export{$t as default};
