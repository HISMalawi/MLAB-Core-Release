import{_ as L}from"./CUC3bBKZ.js";import{S as j,p as E,Y as P,G as z,V as N,q as K,A as F,B as G,a as T,u as X,x as U,y as d,b as c,e as p,f as i,z as u,g as t,j as I,t as y,F as R,k as A,L as S,K as x,_ as M,s as H,l as O,m as D,i as q,v as C,n as Q}from"./BomcfpdA.js";import{S as V}from"./CQpqnWfj.js";import{r as W}from"./D94jxSfK.js";import{_ as Y}from"./BM3s60a1.js";import{_ as J}from"./Dzvfjycu.js";import{P as Z}from"./WDQKvhhq.js";import{u as $}from"./BjPGKtCZ.js";import{r as ee}from"./W5PRmU-K.js";import{r as te}from"./DvUQq13P.js";import{r as se}from"./Bebq7u_r.js";import{_ as oe}from"./DBmflaAt.js";import"./C0NBKdgm.js";import"./D6yT9IfA.js";import"./CRSxM5WR.js";import"./B7Ohi4Ie.js";import"./Boa9CdQB.js";import"./BrQkqONm.js";import"./Bzo7eHVr.js";import"./DroGVA2N.js";import"./BsfKay9h.js";import"./6YkiL_hW.js";const le={components:{TransitionRoot:j,TransitionChild:E,Dialog:P,DialogPanel:z,DialogTitle:N,XMarkIcon:K},data(){return{transferIcon:F,saveIcon:W,show:!1,loading:!1,editIcon:G,cookie:T("token")}},props:{data:{type:Object,required:!0}},computed:{filteredRequisitions(){return this.data.requisitions.map((o,e)=>{o.stock_item.name=="-- select item --"&&this.data.requisitions.splice(e,1)}),this.data.requisitions.map(o=>({stock_item_name:o.stock_item.name,stock_item_id:o.stock_item.id,quantity:o.quantity_requested,lot:o.lot_number,batch:o.batch_number,expiry_date:o.expiry_date}))}},methods:{async submitForm(){this.loading=!0;const o=new V,e={receiving_from:this.data.receiving_from,stock_status_reason:this.data.reason,stock_items:this.filteredRequisitions},{data:a,error:h,pending:s}=await o.receiveExternalStock(`${this.cookie}`,e);this.loading=s,a.value&&(this.loading=!1,X().$toast.success("Stock received successfully"),this.handleClick(),this.$router.push("/stock-management/transactions")),h.value&&(this.loading=!1,console.error(h.value),this.handleClick())},handleClick(){this.show=!this.show}}},ie={class:"fixed inset-0 overflow-y-auto"},ae={class:"flex min-h-full items-center justify-center p-4 text-center"},ne={class:"border-b px-3 py-3 flex items-center justify-between"},re={class:"py-5 px-5"},ce={class:"w-full flex items-center space-x-2"},de={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},me={class:"w-full flex items-center space-x-2 mt-2"},ue={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},pe={class:"w-full"},fe={class:"px-2 py-2 border-r"},_e={class:"px-2 py-2 border-r"},ye={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function he(o,e,a,h,s,n){const b=M,k=d("TransitionChild"),f=d("DialogTitle"),m=d("XMarkIcon"),v=d("FormKit"),g=d("DialogPanel"),w=d("Dialog"),l=d("TransitionRoot");return c(),p("div",null,[i(b,{click:n.handleClick,color:"success",text:"Receive",icon:s.transferIcon},null,8,["click","icon"]),i(l,{appear:"",show:s.show,as:"template"},{default:u(()=>[i(w,{as:"div",class:"relative z-10"},{default:u(()=>[i(k,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:u(()=>e[1]||(e[1]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",ie,[t("div",ae,[i(k,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:u(()=>[i(g,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:u(()=>[t("div",ne,[i(f,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:u(()=>e[2]||(e[2]=[t("img",{src:Y,class:"w-8 h-8 mr-2"},null,-1),I(" Checkout Stock Transfer ")])),_:1}),t("button",{onClick:e[0]||(e[0]=(..._)=>n.handleClick&&n.handleClick(..._))},[i(m,{class:"w-5 h-5"})])]),i(v,{type:"form","submit-label":"Update",onSubmit:n.submitForm,actions:!1,id:"submitForm"},{default:u(({value:_})=>[t("div",re,[t("div",ce,[e[3]||(e[3]=t("p",{class:"w-72 font-medium"},"From: ",-1)),t("span",de,y(a.data.receiving_from),1)]),t("div",me,[e[4]||(e[4]=t("p",{class:"w-72 font-medium"},"Reason for transfer: ",-1)),t("span",ue,y(a.data.reason),1)]),e[6]||(e[6]=t("div",{class:"bg-gray-50 px-2 py-2 border rounded-t mt-4"},[t("h3",{class:"font-semibold"},"Stock In Items")],-1)),t("table",pe,[e[5]||(e[5]=t("thead",{clas:"w-full border-l border-r"},[t("tr",{class:"border-b border-r border-l rounded"},[t("th",{class:"px-2 py-2 text-left border-r"}," Item "),t("th",{class:"px-2 py-2 text-left"}," Quantity ")])],-1)),t("tbody",null,[(c(!0),p(R,null,A(n.filteredRequisitions,(r,B)=>(c(),p("tr",{key:B,class:"border-b border-t border-r border-l rounded"},[t("td",fe,y(r.stock_item_name),1),t("td",_e,y(r.quantity),1)]))),128))])])]),t("div",ye,[n.filteredRequisitions.length>0?(c(),S(b,{key:0,loading:s.loading,type:"submit",click:()=>{},color:"success",icon:s.transferIcon,text:"Continue"},null,8,["loading","icon"])):x("",!0)])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const be=U(le,[["render",he]]),ke={setup(){$({title:`${Z.name.toUpperCase()} - Receive Stock`})},components:{SquaresPlusIcon:ee},data(){return{open:!1,transferIcon:F,saveIcon:W,clearIcon:te,addIcon:H,deleteIcon:se,destinations:new Array,selectedDestination:{name:"-- select sender --"},reason:"",requisitions:new Array,stockItems:new Array,cookie:T("token"),showFacility:!1,showWard:!1,suppliers:new Array,selectedDeparment:{name:"-- select supplier --"},facilities:new Array,selectedFacility:{name:"-- select facility --"},wards:new Array,selectedWard:{name:"-- select Ward --"},selectedItem:{name:"-- select item --"},pages:[{name:"Home",link:"/home"},{name:"Stock Management",link:"#"},{name:"Transactions",link:"/stock-management/transactions"}],transferData:{},requisitionLoading:{id:0,value:!1}}},computed:{destinationOptions(){return[{name:"Supplier",label:"Supplier"},{name:"Facility",label:"Facility"},{name:"Wards",label:"Wards"}]},selectedItems(){switch(this.selectedDestination.name){case"Supplier":return this.selectedItem={name:"-- select supplier --"},this.suppliers;case"Facility":return this.selectedItem={name:"-- select facility --"},this.facilities;case"Ward":return this.selectedItem={name:"-- select ward --"},this.wards;default:return[]}}},created(){this.addDestinations(),this.loadStockItems()},methods:{async loadStockItems(){const o=new V,{data:e,error:a}=await o.getStockItem(`${this.cookie}`);e.value&&(this.stockItems=e.value),a.value&&console.error(a.value)},async loadFacilities(){const o={route:O.facility,method:"GET",token:`${this.cookie}`},{data:e,error:a}=await D(o);e.value&&(this.facilities=e.value.data),a.value&&console.error(a.value)},async loadSuppliers(){const o=new V,{data:e,error:a}=await o.getStockSupplier(`${this.cookie}`);e.value&&(this.suppliers=e.value),a.value&&console.error(a.value)},async loadWards(){console.log("bjkm");const o={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:`${this.cookie}`},{data:e,error:a}=await D(o);e.value&&(this.wards=e.value),a.value&&console.error(a.value)},addStockItem(){this.requisitions.push({id:0,stock_item:{name:"-- select item --",id:0},quantity_requested:0,batch_number:"",lot_number:"",expiry_date:""})},deleteStockItem(o){o>=0&&o<this.requisitions.length&&this.requisitions.splice(o,1)},addDestinations(){["Supplier","Ward","Department"].forEach(e=>this.destinations.push({name:e}))}},watch:{selectedDestination:{handler(o){const e={Supplier:this.loadSuppliers,Facility:this.loadFacilities,Ward:this.loadWards};console.log(o);const a=e[o.name];a&&a.call(this)},deep:!0}}},ve={class:"px-5 py-5"},xe={class:"flex items-center justify-between py-5"},ge={class:"w-full mt-2 grid grid-cols-5 gap-2"},we={class:"col-span-1 order-2 rounded border"},Ie={class:"flex flex-col space-y-2 px-5 py-5"},Se={class:"w-full flex flex-col space-y-2"},Ve={key:0,class:"w-full flex flex-col space-y-2"},De={class:"font-medium"},qe={class:"col-span-4 order-1 rounded border"},Ce={class:"px-5 py-5"},Fe={class:"grid grid-cols-6 gap-5 mb-5"},Te={class:"flex flex-col space-y-2"},Ue={class:"mt-8 flex items-center space-x-2"},Re={class:"flex flex-col items-center justify-center space-y-2"};function Ae(o,e,a,h,s,n){const b=L,k=be,f=J,m=d("FormKit"),v=M,g=Q,w=d("SquaresPlusIcon");return c(),p("div",ve,[i(b,{pages:s.pages},null,8,["pages"]),t("div",xe,[e[4]||(e[4]=t("h3",{class:"text-2xl font-semibold capitalize"},"Receive External Stock",-1)),i(k,{data:{reason:s.reason,receiving_from:`${s.selectedItem.name.includes("select")?"":s.selectedItem.name} ${s.selectedDestination.name.includes("select")?"":s.selectedDestination.name}`,requisitions:s.requisitions}},null,8,["data"])]),t("div",null,[t("div",ge,[t("div",we,[e[7]||(e[7]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Details")],-1)),t("div",Ie,[t("div",Se,[e[5]||(e[5]=t("label",{class:"font-medium"},"Receive From",-1)),i(f,{items:s.destinations,modelValue:s.selectedDestination,"onUpdate:modelValue":e[0]||(e[0]=l=>s.selectedDestination=l)},null,8,["items","modelValue"])]),s.selectedDestination&&n.selectedItems.length>0?(c(),p("div",Ve,[t("label",De,[I("Select "+y(s.selectedDestination.name.toLowerCase()),1),e[6]||(e[6]=t("span",{class:"text-red-600 font-medium"},"*",-1))]),i(f,{"is-searchable":!0,items:n.selectedItems,modelValue:s.selectedItem,"onUpdate:modelValue":e[1]||(e[1]=l=>s.selectedItem=l)},null,8,["items","modelValue"])])):x("",!0),i(m,{label:"Reason for receiving",type:"textarea",modelValue:s.reason,"onUpdate:modelValue":e[2]||(e[2]=l=>s.reason=l),validation:"required"},null,8,["modelValue"])])]),t("div",qe,[e[12]||(e[12]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Stock Items")],-1)),t("div",Ce,[q(i(v,{color:"primary",click:n.addStockItem,text:"Add items",icon:s.addIcon},null,8,["click","icon"]),[[C,s.requisitions.length>0]]),(c(!0),p(R,null,A(s.requisitions,(l,_)=>(c(),p("div",{class:"flex flex-col space-y-3 mt-5",key:_},[t("div",Fe,[t("div",Te,[e[8]||(e[8]=t("label",{class:"font-medium mb-0"},"Stock item",-1)),i(f,{"is-searchable":!0,items:s.stockItems,modelValue:l.stock_item,"onUpdate:modelValue":r=>l.stock_item=r},null,8,["items","modelValue","onUpdate:modelValue"])]),i(m,{label:"Quantity received",type:"number",validation:"required",modelValue:l.quantity_requested,"onUpdate:modelValue":r=>l.quantity_requested=r,modelModifiers:{lazy:!0},delay:1e3},null,8,["modelValue","onUpdate:modelValue"]),i(m,{label:"Batch",type:"text",validation:"required",modelValue:l.batch_number,"onUpdate:modelValue":r=>l.batch_number=r,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),i(m,{label:"Lot",type:"text",validation:"required",modelValue:l.lot_number,"onUpdate:modelValue":r=>l.lot_number=r,modelModifiers:{lazy:!0},delay:2e3},null,8,["modelValue","onUpdate:modelValue"]),i(m,{type:"date",modelValue:l.expiry_date,"onUpdate:modelValue":r=>l.expiry_date=r,label:"Expiry Date"},null,8,["modelValue","onUpdate:modelValue"]),t("div",Ue,[s.requisitionLoading.id==l.id&&s.requisitionLoading.value?(c(),S(g,{key:0,class:"w-5 h-5"})):x("",!0),s.requisitionLoading.value?x("",!0):(c(),S(v,{key:1,icon:s.deleteIcon,text:"Delete",color:"error",click:()=>{n.deleteStockItem(_)}},null,8,["icon","click"]))])])]))),128)),q(t("div",Re,[e[10]||(e[10]=t("img",{src:oe,class:"w-28 h-28 text-red-500"},null,-1)),e[11]||(e[11]=t("p",{class:"flex items-center"},"No stock items entered for receive",-1)),t("button",{onClick:e[3]||(e[3]=(...l)=>n.addStockItem&&n.addStockItem(...l)),type:"button",class:"flex items-center text-sky-500 font-medium"},[i(w,{class:"w-5 h-5 mr-2"}),e[9]||(e[9]=I(" Add stock item "))])],512),[[C,s.requisitions.length==0]])])])])])])}const ot=U(ke,[["render",Ae]]);export{ot as default};
