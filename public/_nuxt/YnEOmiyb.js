import{_ as de}from"./CdrT672K.js";import{S as me,p as ue,Y as pe,G as fe,V as _e,q as ve,a as X,u as L,s as be,x as h,b as _,e as C,f as a,y as S,g as t,j as R,t as D,F as Y,k as Z,_ as J,d as ye,r as c,c as N,o as ke,w as W,h as s,A as B,D as j,i as z,v as E,H,n as he,l as ge,m as O}from"./BbkUq3pP.js";import{S as A}from"./DrAKmsfg.js";import{r as xe}from"./C7SUZWvt.js";import{r as we}from"./DQOpZ8rn.js";import{r as Se}from"./aOGwGJoO.js";import{_ as Ce}from"./BM3s60a1.js";import{_ as $e}from"./hcyw4BxI.js";import{_ as Te}from"./CGQhUj9Z.js";import{_ as Ie}from"./PHlxz6BT.js";import{P as De}from"./Cno8v37U.js";import{u as Ve}from"./BZTj5M85.js";import{r as Fe}from"./DWtgXak8.js";import{r as Me}from"./DC48ZIun.js";import{r as Ue}from"./BDtoEpty.js";import"./CfIHGZVq.js";import"./GKXdb3Iz.js";import"./DDyamxLR.js";import"./CF9TYKcD.js";import"./CLuuOqS6.js";import"./pkSlw8mP.js";import"./BC5bLOnc.js";import"./E3GA-zZE.js";import"./BIuVjvou.js";const qe={components:{TransitionRoot:me,TransitionChild:ue,Dialog:pe,DialogPanel:fe,DialogTitle:_e,XMarkIcon:ve},data(){return{transferIcon:xe,saveIcon:we,show:!1,loading:!1,editIcon:Se,cookie:X("token")}},props:{data:{type:Object,required:!0}},computed:{filteredRequisitions(){return this.data.requisitions.map(m=>({stock_item_name:m.stock_item.name,stock_item_id:m.stock_item.id,quantity:m.quantity_requested,lot:m.lot_number,batch:m.batch_number}))}},methods:{async submitForm(){this.loading=!0;const m=new A,l={sending_to:this.data.sendingTo,stock_status_reason:this.data.reason,stock_items:this.filteredRequisitions},{data:g,error:I,pending:v}=await m.stockOutTransaction(`${this.cookie}`,l);this.loading=v,g.value&&(this.loading=!1,L().$toast.success(g.value.message),this.handleClick(),this.$router.push("/stock-management/issue")),I.value&&(this.loading=!1,console.error(I.value),this.handleClick())},handleClick(){this.show=!this.show}}},Ne={class:"fixed inset-0 overflow-y-auto"},Be={class:"flex min-h-full items-center justify-center p-4 text-center"},je={class:"border-b px-3 py-3 flex items-center justify-between"},Le={class:"py-5 px-5"},Re={class:"w-full flex items-center space-x-2"},Ae={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},Qe={class:"w-full flex items-center space-x-2 mt-2"},Pe={class:"w-full border-b-2 text-gray-700 border-dotted pb-1 font-normal border-gray-300"},Ge={class:"w-full"},Ke={class:"border-b border-t border-r border-l rounded"},We={class:"px-2 py-2 border-r"},ze={class:"px-2 py-2 border-r"},Ee={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function He(m,l,g,I,v,b){const r=J,x=h("TransitionChild"),d=h("DialogTitle"),w=h("XMarkIcon"),$=h("FormKit"),V=h("DialogPanel"),F=h("Dialog"),M=h("TransitionRoot");return _(),C("div",null,[a(r,{click:b.handleClick,color:"success",text:"Transfer",icon:v.transferIcon},null,8,["click","icon"]),a(M,{appear:"",show:v.show,as:"template"},{default:S(()=>[a(F,{as:"div",class:"relative z-10"},{default:S(()=>[a(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:S(()=>l[1]||(l[1]=[t("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1)])),_:1}),t("div",Ne,[t("div",Be,[a(x,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:S(()=>[a(V,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:S(()=>[t("div",je,[a(d,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:S(()=>l[2]||(l[2]=[t("img",{src:Ce,class:"w-8 h-8 mr-2"},null,-1),R(" Checkout Stock Transfer ")])),_:1}),t("button",{onClick:l[0]||(l[0]=(...u)=>b.handleClick&&b.handleClick(...u))},[a(w,{class:"w-5 h-5"})])]),a($,{type:"form","submit-label":"Update",onSubmit:b.submitForm,actions:!1,id:"submitForm"},{default:S(({value:u})=>[t("div",Le,[t("div",Re,[l[3]||(l[3]=t("p",{class:"w-72 font-medium"},"To: ",-1)),t("span",Ae,D(g.data.sendingTo),1)]),t("div",Qe,[l[4]||(l[4]=t("p",{class:"w-72 font-medium"},"Reason for transfer: ",-1)),t("span",Pe,D(g.data.reason),1)]),l[6]||(l[6]=t("div",{class:"bg-gray-50 px-2 py-2 border rounded-t mt-4"},[t("h3",{class:"font-semibold"},"Stock Out Items")],-1)),t("table",Ge,[l[5]||(l[5]=t("thead",{clas:"w-full border-l border-r"},[t("tr",{class:"border-b border-r border-l rounded"},[t("th",{class:"px-2 py-2 text-left border-r"}," Item "),t("th",{class:"px-2 py-2 text-left"}," Quantity ")])],-1)),t("tbody",null,[(_(!0),C(Y,null,Z(b.filteredRequisitions,(U,y)=>(_(),C("tr",Ke,[t("td",We,D(U.stock_item_name),1),t("td",ze,D(U.quantity),1)]))),256))])])]),t("div",Ee,[a(r,{loading:v.loading,type:"submit",click:()=>{},color:"success",icon:v.transferIcon,text:"Continue"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const Oe=be(qe,[["render",He]]),Xe={class:"px-5 py-5"},Ye={class:"flex items-center justify-between py-5"},Ze={class:""},Je={class:"w-full mt-2 grid grid-cols-3 gap-2"},et={class:"col-span-1 order-2 rounded border"},tt={class:"flex flex-col space-y-2 px-5 py-5"},ot={class:"w-full flex flex-col space-y-2"},st={key:0,class:"w-full flex flex-col space-y-2"},at={class:"font-medium"},nt={class:"col-span-2 order-1 rounded border"},lt={class:"px-5 py-5"},it={class:"grid grid-cols-5 gap-4 mb-5"},rt={class:"mt-8 flex items-center space-x-2"},ct={class:"flex flex-col items-center justify-center space-y-2"},qt=ye({__name:"transfer-stock",setup(m){Ve({title:`${De.name.toUpperCase()} - Transfer Stock`});const l=Me,g=Ue,{$toast:I,$metadata:v}=L(),b=c([]),r=c({name:"-- select destination --"}),x=c(""),d=c([]),w=c([]),$=X("token"),V=c([]),F=c([]),M=c([]),u=c({name:"-- select item --"}),U=c([{name:"Home",link:"/home"},{name:"Stock Management",link:"#"},{name:"Transactions",link:"/stock-management/transactions"}]),y=c({id:0,value:!1}),Q=N(()=>{const e={Department:{items:V,placeholder:"-- select department --"},Facility:{items:F,placeholder:"-- select facility --"},Ward:{items:M,placeholder:"-- select ward --"}}[r.value.name];return e?(u.value={name:e.placeholder},e.items.value):[]}),ee=o=>N(()=>{const e=w.value.find(n=>n.name===o);return e?e.lots:[]}),te=o=>N(()=>{const e=w.value.find(n=>n.name===o);return e?e.batches:[]});async function oe(){se(),le()}async function se(){const o=new A,{data:e,error:n}=await o.getStockItem(String($.value),"metadata=true");e.value&&(w.value=e.value),n.value&&console.error(n.value)}async function ae(){const o={route:ge.facility,method:"GET",token:$.value},{data:e,error:n}=await O(o);e.value&&(F.value=e.value.data),n.value&&console.error(n.value)}async function ne(){const o={route:"encounter_type_facility_section_mappings/facility_sections?encounter_type_id=2",method:"GET",token:$.value},{data:e,error:n}=await O(o);e.value&&(M.value=e.value,console.log(e.value)),n.value&&console.error(n.value)}function le(){let o=["Facility","Ward","Department"];b.value=o.map(e=>({name:e}))}async function ie(o){y.value={id:o.id,value:!0};const e=new A,n={stock_item_id:o.stock_item.id,quantity:o.quantity_requested,batch:o.batch_number,lot:o.lot_number},{data:p,error:k,pending:T}=await e.checkStockQuantity($.value,n);y.value={id:o.id,value:T},p.value&&(p.value.deduction_allowed||(L().$toast.warning(p.value.message),o.quantity_requested=0),y.value={id:o.id,value:!1}),k.value&&(console.error(k.value),y.value={id:o.id,value:!1},I.error("Could not verify stock quantity for given lot and batch, please try again"))}function P(){d.value.push({id:0,stock_item:{name:"-- select item --",id:0},quantity_requested:0,batch_number:"",lot_number:""})}function re(o){o>=0&&o<d.value.length&&d.value.splice(o,1)}return ke(()=>{oe()}),W(r,o=>{const n={Department:async()=>{V.value=v.departments},Facility:ae,Ward:ne}[o.name];n&&n()},{deep:!0}),W(d,o=>{let e=o.map(p=>{var k;return{...p,stock_item:{...p.stock_item,id:((k=w.value.find(T=>T.name===p.stock_item.name))==null?void 0:k.id)||0}}})[o.length-1];e.quantity_requested>0&&e.quantity_requested>0&&e.batch_number!==""&&e.lot_number!==""&&ie(e)},{deep:!0}),(o,e)=>{const n=de,p=Oe,k=$e,T=h("FormKit"),G=J,q=Te,ce=he;return _(),C("div",Xe,[a(n,{pages:s(U)},null,8,["pages"]),t("div",Ye,[e[3]||(e[3]=t("h3",{class:"text-2xl font-semibold capitalize"},"Transfer Stock",-1)),t("div",Ze,[a(p,{data:{reason:s(x),sendingTo:`${s(u).name.includes("select")?"":s(u).name} ${s(r).name.includes("select")?"":s(r).name}`,requisitions:s(d)}},null,8,["data"])])]),t("div",null,[t("div",Je,[t("div",et,[e[6]||(e[6]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Details")],-1)),t("div",tt,[t("div",ot,[e[4]||(e[4]=t("label",{class:"font-medium"},"Destination",-1)),a(k,{items:s(b),modelValue:s(r),"onUpdate:modelValue":e[0]||(e[0]=i=>B(r)?r.value=i:null)},null,8,["items","modelValue"])]),s(r)&&s(Q).length>0?(_(),C("div",st,[t("label",at,[R("Select "+D(s(r).name.toLowerCase()),1),e[5]||(e[5]=t("span",{class:"text-red-600 font-medium"},"*",-1))]),a(k,{"is-searchable":!0,items:s(Q),modelValue:s(u),"onUpdate:modelValue":e[1]||(e[1]=i=>B(u)?u.value=i:null)},null,8,["items","modelValue"])])):j("",!0),a(T,{label:"Reason for transfer",type:"textarea",modelValue:s(x),"onUpdate:modelValue":e[2]||(e[2]=i=>B(x)?x.value=i:null),validation:"required"},null,8,["modelValue"])])]),t("div",nt,[e[10]||(e[10]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-t"},[t("h3",{class:"font-semibold text-lg"},"Stock Items")],-1)),t("div",lt,[z(a(G,{color:"primary",click:P,text:"Add items",icon:s(l)},null,8,["icon"]),[[E,s(d).length>0]]),(_(!0),C(Y,null,Z(s(d),(i,K)=>(_(),C("div",{class:"flex flex-col space-y-3 mt-5",key:K},[t("div",it,[a(q,{label:"Stock item",mode:"single",items:s(w).map(f=>f.name),"items-selected":i.stock_item.name,"onUpdate:itemsSelected":f=>i.stock_item.name=f},null,8,["items","items-selected","onUpdate:itemsSelected"]),a(T,{label:"Quantity requested",type:"number",validation:"required",modelValue:i.quantity_requested,"onUpdate:modelValue":f=>i.quantity_requested=f,modelModifiers:{lazy:!0},delay:1e3},null,8,["modelValue","onUpdate:modelValue"]),a(q,{label:"Batch",mode:"single",items:te(i.stock_item.name).value,"items-selected":i.batch_number,"onUpdate:itemsSelected":f=>i.batch_number=f,delay:5},null,8,["items","items-selected","onUpdate:itemsSelected"]),a(q,{label:"Lot",mode:"single",items:ee(i.stock_item.name).value,"items-selected":i.lot_number,"onUpdate:itemsSelected":f=>i.lot_number=f},null,8,["items","items-selected","onUpdate:itemsSelected"]),t("div",rt,[s(y).id==i.id&&s(y).value?(_(),H(ce,{key:0,height:20,width:20})):j("",!0),s(y).value?j("",!0):(_(),H(G,{key:1,type:"button",icon:s(g),text:"Delete",color:"error",click:()=>{re(K)}},null,8,["icon","click"]))])])]))),128)),z(t("div",ct,[e[8]||(e[8]=t("img",{src:Ie,class:"w-28 h-28 text-red-500",alt:"stock-out-svg"},null,-1)),e[9]||(e[9]=t("p",{class:"flex items-center"},"No stock items for transfer",-1)),t("button",{onClick:P,type:"button",class:"flex items-center text-sky-500 font-medium"},[a(s(Fe),{class:"w-5 h-5 mr-2"}),e[7]||(e[7]=R(" Add stock item "))])],512),[[E,s(d).length==0]])])])])])])}}});export{qt as default};
