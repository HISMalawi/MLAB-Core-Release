import{_ as A}from"./Breadcrumb.b0c0412c.js";import{_ as B}from"./Dropdown.607d272b.js";import{u as Y,a as V,_ as N,f as T,o as r,c as o,b as u,d as e,t as s,g as O,h as g,k as F,F as c,r as m,j as D,e as S}from"./entry.791399ec.js";import{_ as z}from"./index.83d2f57f.js";import{d as R}from"./constants.713ae7a7.js";import{u as L}from"./vue.f36acd1f.8530d91e.js";import{h as k,e as M,f as j}from"./fetch.b60ef317.js";import{u as q}from"./facility.0de3d21a.js";import{P as I}from"./package.d411c004.js";import{k as U}from"./vue-doc-download.ab618b63.js";import{r as G}from"./ArrowPathIcon.04123d3a.js";import{r as H}from"./DocumentTextIcon.f65899eb.js";import{_ as J}from"./logo.82e35264.js";import{_ as W}from"./stock_out.41f0adc7.js";import"./nuxt-link.1af0fd3d.js";import"./HomeIcon.bfaa9779.js";import"./listbox.e9c3a7ec.js";import"./hidden.63232384.js";import"./use-text-value.83d37c68.js";import"./CheckIcon.4b9566d6.js";import"./CheckCircleIcon.f3db3db8.js";import"./MagnifyingGlassIcon.4c928ac3.js";import"./jspdf.es.min.6de95a72.js";import"./XMarkIcon.235914cb.js";import"./PrinterIcon.9d4d78fd.js";import"./transition.f6288412.js";import"./PencilSquareIcon.ffacbd25.js";const K={setup(){L({title:`${I.name.toUpperCase()} - Department Report`})},components:{ExportToExcel:U},data(){return{refreshIcon:G,exportIcon:H,moment:k,title:"Department Reports",facility:q(),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}],departments:new Array,selectedDepartment:{name:"-- select department --"},dateFrom:"",dateTo:"",cookie:Y("token"),reportData:{wards:[],data:[]},loading:!1}},created(){this.getDepartments()},methods:{async getDepartments(){const n={route:M.departments,method:"GET",token:`${this.cookie}`},{data:d,error:p}=await j(n);d.value&&(this.departments=d.value),p.value&&console.error(p.value)},async generateReport(){if(this.validate())V().$toast.warning("Please select a department!");else{this.loading=!0;let n=this.dateFrom!=""?k(this.dateFrom).format("YYYY-MM-DD"):"",d=this.dateTo!=""?k(this.dateTo).format("YYYY-MM-DD"):"",p=`from=${n}&to=${d}&department=${this.checkStatus(this.selectedDepartment.name)}`;const _={route:`${M.aggregateReports}/department?${p}`,method:"GET",token:`${this.cookie}`},{data:t,error:i,pending:h}=await j(_);this.loading=h,t.value&&(this.loading=!1,this.reportData=t.value,V().$toast.success("Report generated successfully!")),i.value&&(this.loading=!1,console.error(i.value))}},checkStatus(n){return n==="-- select department --"||n==="-- select test type --"||n==="-- select test status --"?"":n},validate(){return this.selectedDepartment.name=="-- select department --"},calculateRowTotal(n){return this.reportData.wards.reduce((p,_)=>p+(n.ward[_]?n.ward[_]:0),0)},getDataValue(n,d,p,_){const i=JSON.parse(JSON.stringify(n[Object.keys(n)[0]])).find(f=>f.gender===d);if(!i)return 0;const h=i.ward.find(f=>Object.keys(f)[0]===p.toLowerCase());if(!h)return 0;const y=h[p.toLowerCase()][_];return y===void 0?0:y}}},Q={class:"px-5 py-5"},X={class:"flex items-center justify-between py-5"},Z={class:"text-2xl font-semibold"},$={class:"w-full flex items-center justify-between"},ee={class:"flex items-center space-x-3"},te={class:"w-40"},re={class:"w-40"},oe={class:"w-44"},se={class:"flex items-center space-x-3"},ne={class:"mt-3"},ae={class:"text-lg font-semibold mb-2"},le={class:"text-normal font-normal"},ce={class:"border rounded print-container",id:"print-container"},de={class:"bg-gray-50 rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},ie=e("img",{src:J,alt:"app-logo",class:"w-24 h-24 object-cover"},null,-1),pe={class:"space-y-2 py-5"},me={class:"uppercase font-medium"},ue={class:"uppercase font-medium"},_e={class:"uppercase font-medium"},be=e("p",{class:"uppercase font-medium underline"},"Laboratory Report",-1),he={key:0,class:"overflow-x-auto"},ye={class:"w-full border border-dotted rounded overflow-x-auto"},fe={class:"w-full"},xe=e("th",{class:"px-2 py-2 text-center border-r"},"Tests",-1),ge=["colspan"],De=e("th",{class:"px-2 py-2 text-center"},"Total",-1),ke={class:"border-b"},we=e("th",{class:"border-r"},null,-1),ve={class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},Ve=e("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t"},null,-1),Te={class:"capitalize px-2 py-2 text-center border-r"},Fe={class:"px-2 py-2 text-center"},Re={key:0,class:"w-full border border-dotted rounded overflow-x-auto mt-10"},Me=e("th",{class:"border-b px-2 py-2",rowspan:4},"Blood Product",-1),je=e("th",{class:"border-b px-2 py-2"},null,-1),Ce=["colspan"],Pe={class:"border-t"},Ee={class:"capitalize px-2 py-2 text-center bg-gray-50 border-r"},Ae=e("td",{class:"px-2 py-2 border-r border-b"},null,-1),Be=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),Ye=e("td",{class:"px-2 py-2 border-b border-r"},"Age-Ranges",-1),Ne=e("td",{class:"px-2 py-2 border-b border-r"},"0-5",-1),Oe=e("td",{class:"px-2 py-2 border-b border-r"},"6-14",-1),Se=e("td",{class:"border-r px-2 py-2 border-b"},"15-120",-1),ze=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),Le=e("td",{class:"px-2 py-2 border-b border-r"},"Female",-1),qe={class:"px-2 py-2 border-b border-r"},Ie={class:"px-2 py-2 border-b border-r"},Ue={class:"border-r px-2 py-2 border-b"},Ge=e("td",{class:"px-2 py-2 bg-gray-50 border-r"}," ",-1),He=e("td",{class:"px-2 py-2 border-b border-r"},"Male",-1),Je={class:"px-2 py-2 border-b border-r"},We={class:"px-2 py-2 border-b border-r"},Ke={class:"border-r px-2 py-2 border-b"},Qe={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Xe=e("img",{src:W,class:"w-20 h-20"},null,-1),Ze={class:"font-medium"};function $e(n,d,p,_,t,i){const h=A,y=T("datepicker"),f=B,w=S,C=z,P=T("ExportToExcel");return r(),o("div",Q,[u(h,{pages:t.pages},null,8,["pages"]),e("div",X,[e("h3",Z,s(t.title),1)]),e("div",$,[e("div",ee,[e("div",te,[u(y,{position:"left",range:!1,placeholder:"-- start date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:t.dateFrom,"onUpdate:modelValue":d[0]||(d[0]=a=>t.dateFrom=a),format:"dd/MM/yyyy"},null,8,["modelValue"])]),e("div",re,[u(y,{range:!1,placeholder:"-- end date --","input-classes":"border rounded px-2 py-1.5 block focus:outline-none focus:ring-2 focus:ring-sky-500 transition duration-150 focus:border-none",modelValue:t.dateTo,"onUpdate:modelValue":d[1]||(d[1]=a=>t.dateTo=a),format:"dd/MM/yyyy"},null,8,["modelValue"])]),e("div",oe,[u(f,{items:t.departments,modelValue:t.selectedDepartment,"onUpdate:modelValue":d[2]||(d[2]=a=>t.selectedDepartment=a)},null,8,["items","modelValue"])]),e("div",null,[u(w,{color:"success",text:"Generate Report",icon:t.refreshIcon,click:()=>i.generateReport(),loading:t.loading},null,8,["icon","click","loading"])])]),e("div",se,[u(C,{printSmallLabel:!1}),u(P,{element:"print-container",filename:`department_report_from_${t.moment(t.dateFrom).format("DD_MM_yyyy")}_to_${t.moment(t.dateTo).format("DD_MM_yyyy")}`},{default:O(()=>[u(w,{text:"Export",icon:t.exportIcon,color:"success",click:()=>{}},null,8,["icon"])]),_:1},8,["filename"])])]),e("div",ne,[e("h3",ae,[g("Tests Performed Period: "),e("span",le,s(t.dateFrom!=""?t.moment(t.dateFrom).format("dateFormat"in n?n.dateFormat:F(R)):"")+" - "+s(t.dateTo!=""?t.moment(t.dateTo).format("dateFormat"in n?n.dateFormat:F(R)):""),1)])]),e("div",ce,[e("div",de,[ie,e("div",pe,[e("p",me,s(t.facility.details.name),1),e("p",ue,s(t.facility.details.address),1),e("p",_e,s(t.facility.details.phone),1),be])]),t.reportData.wards.length>0&&t.reportData.data.length>0?(r(),o("div",he,[e("table",ye,[e("thead",fe,[e("tr",null,[xe,e("th",{class:"px-2 py-2 text-center border-r border-b",colspan:t.reportData.wards.length},"Wards ",8,ge),De]),e("tr",ke,[we,(r(!0),o(c,null,m(t.reportData.wards,(a,x)=>(r(),o("th",{class:"px-2 py-2 text-center border-r",key:x},s(a),1))),128))])]),e("tbody",null,[(r(!0),o(c,null,m(t.reportData.data,(a,x)=>(r(),o(c,{key:x},[e("th",ve,s(Object.keys(a)[0]),1),(r(!0),o(c,null,m(t.reportData.wards,(l,b)=>(r(),o("th",{class:"capitalize px-2 py-2 text-center bg-gray-50 border-b border-t",key:b}))),128)),Ve,(r(!0),o(c,null,m(a[Object.keys(a)[0]],(l,b)=>(r(),o("tr",{class:"border-t border-b",key:b},[e("td",Te,s(l.test_type),1),(r(!0),o(c,null,m(t.reportData.wards,(v,E)=>(r(),o("td",{key:E,class:"border-r px-2 py-2 text-center"},s(l.ward[v]?l.ward[v]:0),1))),128)),e("td",Fe,s(i.calculateRowTotal(l)),1)]))),128))],64))),128))])]),t.reportData.blood_bank_products.length>0?(r(),o("table",Re,[e("thead",null,[e("tr",null,[Me,je,e("th",{class:"border-b px-2 py-2",colspan:t.reportData.wards.length},"Wards",8,Ce)])]),e("tbody",null,[(r(!0),o(c,null,m(t.reportData.blood_bank_products,(a,x)=>(r(),o(c,{key:x},[e("tr",Pe,[e("td",Ee,s(Object.keys(a)[0]),1),Ae,(r(!0),o(c,null,m(t.reportData.wards,(l,b)=>(r(),o("th",{colspan:3,class:"px-2 py-2 text-center border-r border-b",key:b},s(l),1))),128))]),e("tr",null,[Be,Ye,(r(!0),o(c,null,m(t.reportData.wards,(l,b)=>(r(),o(c,{key:b},[Ne,Oe,Se],64))),128))]),e("tr",null,[ze,Le,(r(!0),o(c,null,m(t.reportData.wards,l=>(r(),o(c,{key:l},[e("td",qe,s(i.getDataValue(a,"female",l,"0-5")),1),e("td",Ie,s(i.getDataValue(a,"female",l,"6-14")),1),e("td",Ue,s(i.getDataValue(a,"female",l,"15-120")),1)],64))),128))]),e("tr",null,[Ge,He,(r(!0),o(c,null,m(t.reportData.wards,l=>(r(),o(c,{key:l},[e("td",Je,s(i.getDataValue(a,"male",l,"0-5")),1),e("td",We,s(i.getDataValue(a,"male",l,"6-14")),1),e("td",Ke,s(i.getDataValue(a,"male",l,"15-120")),1)],64))),128))])],64))),128))])])):D("",!0)])):D("",!0),t.reportData.wards.length==0&&t.reportData.data.length==0?(r(),o("div",Qe,[Xe,e("p",null,[g("Please generate report data to preview the "),e("span",Ze,s(t.selectedDepartment.name),1),g(" report. ")])])):D("",!0)])])}const Ft=N(K,[["render",$e]]);export{Ft as default};
