import{_ as te}from"./COJDNupw.js";import{S as G,p as q,Y as R,G as L,V as z,a as B,s as O,q as K,l as g,m as x,u as f,E as b,x as N,y,b as m,e as S,g as s,f as t,z as p,k as H,F as M,j as X,L as C,K as D,_ as Y,d as se,r as T,h as l,B as ae,t as J,a1 as oe}from"./BxD-h1LR.js";import{_ as ie}from"./CoQgzhbz.js";import{_ as Q}from"./DlrUcOnO.js";import{r as W}from"./BPzJPC5B.js";import{_ as le}from"./DWHJDu6j.js";import{_ as ne}from"./CPPw0KVQ.js";import{_ as re}from"./DCLH_TIo.js";import{u as U}from"./D6kY4awV.js";import{u as ce}from"./BmiBNsbw.js";import{P as de}from"./C1C0mJ5v.js";import"./Dm9r4zu1.js";import"./Cpa0DX47.js";import"./CV2CrNCX.js";import"./Bu7bZmRE.js";import"./pmVMiK7H.js";import"./BuhIHGoH.js";import"./2qDGpbGm.js";import"./DiIN0LOU.js";import"./DQVzKFZd.js";import"./BO87LaRX.js";import"./DkqoXkVu.js";import"./CmGziMTe.js";const ue={components:{TransitionRoot:G,TransitionChild:q,Dialog:R,DialogPanel:L,DialogTitle:z},data(){return{open:!1,loading:!1,saving:!1,cookie:B("token"),disabled:!0,diseases:new Array,testTypes:new Array,selectedTestType:{name:""},items:new Array,plusIcon:O,saveIcon:W,addIcon:O,removeIcon:K,surveillanceItems:new Array}},methods:{adjustVisibility(){this.open=!this.open},addItem(){this.surveillanceItems.push({testType:this.testTypes[0],diseases:this.diseases[0]})},removeItem(o){this.surveillanceItems.splice(o,1)},async loadDiseases(){this.loading=!0;const o={route:g.disease.index,method:"GET",token:`${this.cookie}`},{data:r,error:c,pending:a}=await x(o);return r.value&&(this.diseases=r.value),this.loading=!1,c.value&&(this.loading=!1,f().$toast.error(`${b}`)),{data:r,error:c,pending:a}},async loadTestTypes(){this.adjustVisibility();const o=await this.loadDiseases();this.loading=!0;const r={route:g.testTypes,method:"GET",token:`${this.cookie}`},{data:c,error:a,pending:e}=await x(r);c.value&&(console.log(c.value),this.testTypes=c.value.test_types,this.surveillanceItems.push({testType:this.testTypes[0],diseases:o.data.value[0]})),this.loading=!1,a.value&&(this.loading=!1,f().$toast.error(`${b}`))},async handleSubmitForm(){this.saving=!0;const o=this.surveillanceItems.map(i=>({test_types_id:i.testType.id,diseases_id:i.diseases.id})),r={route:g.surveillance.create,method:"POST",token:`${this.cookie}`,body:{surveillance:{data:o}}},{data:c,pending:a,error:e}=await x(r);this.saving=a,c.value&&(this.closeForm(),f().$toast.success("Surviellance add successfully!"),this.$emit("update",!0),this.saving=!1),e.value&&(f().$toast.error(`${b}`),this.saving=!1)},closeForm(){this.open=!1,this.items=[{test_types_id:"",diseases_id:""}]}}},pe=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),me={class:"fixed inset-0 overflow-y-auto"},_e={class:"flex min-h-full items-center justify-center p-4 text-center"},ve={class:"border-b px-3 py-3 flex items-center justify-between"},fe={class:"mt-2 space-y-3 px-5 py-5"},he={class:"w-full col-span-4 flex items-center space-x-3"},ye={class:"w-1/2"},ge=s("label",{for:""},"Test type",-1),xe={class:"w-1/2"},be=s("label",{for:""},"Disease",-1),ke={class:"flex items-center space-x-3 pt-7"},we={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function Te(o,r,c,a,e,i){const u=Y,d=y("TransitionChild"),$=y("DialogTitle"),V=y("XMarkIcon"),I=ie,P=Q,k=y("FormKit"),A=y("DialogPanel"),j=y("Dialog"),F=y("TransitionRoot");return m(),S("div",null,[s("div",null,[t(u,{text:"Add Surveillance",color:"primary",icon:e.plusIcon,click:i.loadTestTypes},null,8,["icon","click"])]),t(F,{appear:"",show:e.open,as:"template"},{default:p(()=>[t(j,{as:"div",onClose:i.closeForm,class:"relative z-10"},{default:p(()=>[t(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[pe]),_:1}),s("div",me,[s("div",_e,[t(d,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[t(A,{class:"w-full max-w-4xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[s("div",ve,[t($,{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>[H(" Surveillance Setup ")]),_:1}),s("button",{onClick:r[0]||(r[0]=(...h)=>i.adjustVisibility&&i.adjustVisibility(...h))},[t(V,{class:"w-5 h-5"})])]),t(k,{type:"form","submit-label":"Save",onSubmit:i.handleSubmitForm,actions:!1},{default:p(()=>[s("div",fe,[(m(!0),S(M,null,X(e.surveillanceItems,(h,_)=>(m(),S("div",{class:"grid grid-cols-5 gap-2",key:_},[s("div",he,[s("div",ye,[ge,t(I,{items:e.testTypes,"model-value":h.testType},null,8,["items","model-value"])]),s("div",xe,[be,t(I,{items:e.diseases,"model-value":h.diseases},null,8,["items","model-value"])]),s("div",ke,[t(u,{icon:e.addIcon,text:"Add",color:"primary",click:()=>{i.addItem()},type:"button"},null,8,["icon","click"]),e.surveillanceItems.length>1?(m(),C(u,{key:0,icon:e.removeIcon,text:"Remove",color:"error",click:()=>{i.removeItem(_)}},null,8,["icon","click"])):D("",!0)])])]))),128))]),s("div",we,[t(P,{type:"button",text:"Close",click:i.closeForm},null,8,["click"]),t(u,{type:"submit",color:"success",icon:e.saveIcon,click:()=>{},text:"Save",loading:e.saving},null,8,["icon","loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])])}const Se=N(ue,[["render",Te]]),$e=s("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),Ie={class:"fixed inset-0 overflow-y-auto"},Ce={class:"flex min-h-full items-center justify-center p-4 text-center"},De={class:"border-b px-3 py-3 flex items-center justify-between"},Ve={class:"mt-2 space-y-3 px-5 py-5"},Pe={class:"w-full grid grid-cols-1 gap-1"},Ae={class:"mt-3 justify-end flex items-center space-x-3 px-3 py-2 border-t"},je=se({__name:"index",props:{id:{}},emits:["action-completed"],setup(o,{emit:r}){const c=T(!1),a=T(!1),e=B("token");T(!0);const i=T([]),u=T([]),d=T({test_type_id:-1,disease_id:-1}),$=T([{test_types_id:"",diseases_id:""}]),V=o,I=r,P=()=>{k(),A(),c.value=!c.value},k=async()=>{a.value=!0;const _={route:g.disease.index,method:"GET",token:`${e.value}`},n=await x(_);n.data.value&&(i.value=[],i.value.push({label:"- Select from the list",value:""}),n.data.value.map((v,w)=>i.value.push({label:v.name,value:v.id}))),a.value=!1,n.error.value&&(a.value=!1,f().$toast.error(`${b}`))},A=async()=>{a.value=!0;const _={route:g.testTypes,method:"GET",token:`${e.value}`},n=await x(_);n.data.value&&(u.value.push({label:"- Select from the list",value:""}),n.data.value.test_types.map((v,w)=>u.value.push({label:v.name,value:v.id}))),a.value=!1,n.error.value&&(a.value=!1,f().$toast.error(`${b}`))},j=async()=>{a.value=!0;const _={route:`${g.surveillance.edit}/${V.id}`,method:"GET",token:`${e.value}`},n=await x(_);n.data.value&&(d.value.test_type_id=n.data.value.test_types_id,d.value.disease_id=n.data.value.diseases_id,P()),a.value=!1,n.error.value&&(a.value=!1,f().$toast.error(`${b}`))},F=async()=>{a.value=!0;const _={route:g.surveillance.update,method:"PATCH",token:e.value,body:{surveillance:{data:[{diseases_id:d.value.disease_id,test_types_id:d.value.test_type_id}]}}},{data:n,pending:v,error:w}=await x(_);a.value=v,n.value&&(h(),f().$toast.success("Surveillance add successfully!"),I("action-completed",[])),w.value&&(f().$toast.error(`${b}`),a.value=!1)},h=()=>{c.value=a.value=!1,$.value=[{test_types_id:d.value.test_type_id,diseases_id:d.value.disease_id}]};return(_,n)=>{const v=Y,w=y("FormKit"),Z=Q;return m(),S("div",null,[s("div",null,[t(v,{text:"Edit",color:"primary",icon:l(ae),click:j},null,8,["icon"])]),t(l(G),{appear:"",show:l(c),as:"template"},{default:p(()=>[t(l(R),{as:"div",onClose:h,class:"relative z-10"},{default:p(()=>[t(l(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:p(()=>[$e]),_:1}),s("div",Ie,[s("div",Ce,[t(l(q),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:p(()=>[t(l(L),{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:p(()=>[s("div",De,[t(l(z),{as:"h3",class:"text-xl text-black flex items-center font-medium leading-6"},{default:p(()=>[H(J("Edit Surveillance Details"))]),_:1}),s("button",{onClick:h},[t(l(K),{class:"w-5 h-5"})])]),t(w,{type:"form","submit-label":"Save",onSubmit:F,actions:!1},{default:p(()=>[s("div",Ve,[s("div",Pe,[(m(!0),S(M,null,X(l($),(Le,ee)=>(m(),S("div",{class:"relative shadow-none border-2 p-3 mb-3 border-gray-100 text-left box-border space-x-4 grid grid-cols-4 rounded",key:ee},[l(u).length?(m(),C(w,{key:0,type:"select",label:"Test type",modelValue:l(d).test_type_id,"onUpdate:modelValue":n[0]||(n[0]=E=>l(d).test_type_id=E),placeholder:"Select test type",validation:"required",options:l(u),class:"w-full"},null,8,["modelValue","options"])):D("",!0),l(i).length?(m(),C(w,{key:1,type:"select",label:"Disease",modelValue:l(d).disease_id,"onUpdate:modelValue":n[1]||(n[1]=E=>l(d).disease_id=E),placeholder:"Select disease",validation:"required",options:l(i)},null,8,["modelValue","options"])):D("",!0)]))),128))])]),s("div",Ae,[t(Z,{type:"button",text:"Close",click:h}),t(v,{type:"submit",color:"success",icon:l(W),click:()=>{},text:"Save",loading:l(a)},null,8,["icon","loading"])])]),_:1})]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}}}),Fe={setup(){ce({title:`${de.name.toUpperCase()} - Surveillance`})},data(){return{pages:new Array({name:"Home",link:"/home"},{name:"Test Catalog",link:"#"}),serverItemsLength:0,loading:!1,items:new Array,cookie:B("token"),header:"Surveillance",search:"",searchValue:"",headers:[{text:"Test Type",value:"test_type",sortable:!0},{text:"Disease",value:"disease"},{text:"Actions",value:"actions",width:18}],serverOptions:{page:1,rowsPerPage:25,sortBy:"test_type"}}},created(){this.init()},methods:{updateSearch(o){this.searchValue=o,this.search=o,this.init()},async init(){this.loading=!0;const{page:o,rowsPerPage:r}=this.serverOptions,c={route:oe(g.surveillance.index,{page:o,page_size:r,search:this.search}),method:"GET",token:`${this.cookie}`},{data:a,error:e,pending:i}=await x(c);a.value&&(this.items=[],a.value.data.map((u,d)=>{this.items.push({id:u.id,test_type:u.test_type.name,disease:u.disease.name})}),this.serverItemsLength=a.value.total),this.loading=!1,e.value&&(this.loading=!1,f().$toast.error(`${b}`))},updateSurveillance(o){typeof o=="object"&&(this.serverOptions=o),this.init()}}},Ee={class:"px-5 py-5"},Ue={class:"flex items-center justify-between py-5"},qe={class:"text-2xl font-semibold"},Be={class:"flex items-center space-x-3"},Oe={class:"flex justify-end w-full px-2 py-2 mb-2"},Ge={class:"py-2 flex items-center space-x-2"};function Re(o,r,c,a,e,i){const u=te,d=Se,$=le,V=ne,I=je,P=re;return m(),S("div",Ee,[t(u,{pages:e.pages},null,8,["pages"]),s("div",Ue,[s("h3",qe,J(e.header),1),s("div",Be,[("usePermissions"in o?o.usePermissions:l(U))().can.manage("lab_configurations")?(m(),C(d,{key:0,onUpdate:i.updateSurveillance},null,8,["onUpdate"])):D("",!0),t($)])]),s("div",Oe,[("usePermissions"in o?o.usePermissions:l(U))().can.manage("lab_configurations")?(m(),C(V,{key:0,search:e.search,"onUpdate:search":r[0]||(r[0]=k=>e.search=k),onUpdate:i.updateSearch},null,8,["search","onUpdate"])):D("",!0)]),("usePermissions"in o?o.usePermissions:l(U))().can.manage("lab_configurations")?(m(),C(P,{key:0,headers:e.headers,data:e.items,serverOptions:e.serverOptions,loading:e.loading,serverItemsLength:e.serverItemsLength,searchField:"test_type",searchValue:e.searchValue,onUpdate:i.updateSurveillance},{actions:p(({item:k})=>[s("div",Ge,[t(I,{id:k.id,onUpdate:i.updateSurveillance},null,8,["id","onUpdate"])])]),_:1},8,["headers","data","serverOptions","loading","serverItemsLength","searchValue","onUpdate"])):D("",!0)])}const pt=N(Fe,[["render",Re]]);export{pt as default};
