var k=Object.defineProperty;var D=(s,e,n)=>e in s?k(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var d=(s,e,n)=>(D(s,typeof e!="symbol"?e+"":e,n),n);import{_ as A}from"./Breadcrumb.vue.0bdfacbe.js";import{_ as C}from"./Dropdown.b85726fc.js";import{u as q,ap as N,a as P,b as r,_ as B,g as h,o as y,c as x,e as t,d as a,i as E,t as m,h as U,w as g,V as L,aj as O,k as I,f as F}from"./entry.6ecd4149.js";import{u as w,h as R,A as c,p as H,d as J,e as M,f as K,q as u,P as Y}from"./fetch.ee87b44f.js";import{e as W}from"./constants.6cf4c43b.js";import{P as j}from"./package.274d278d.js";import{r as G}from"./IdentificationIcon.94085d5f.js";import{r as z}from"./ArrowDownTrayIcon.e0a2df5d.js";import{F as Q,K as X,B as Z,N as $,H as ee}from"./listbox.158c7b25.js";import"./nuxt-link.105aec3d.js";import"./HomeIcon.dfeb70f0.js";import"./CheckIcon.78d4a68d.js";import"./CheckCircleIcon.68946fc0.js";import"./MagnifyingGlassIcon.0da49368.js";import"./transition.4be39060.js";import"./hidden.06164e9c.js";import"./XMarkIcon.3f787dce.js";import"./PencilSquareIcon.34c3a71c.js";import"./PrinterIcon.33b23bbb.js";import"./use-text-value.9366d2ed.js";class te{constructor(e){d(this,"client",{id:"",uuid:""});d(this,"tests",[]);d(this,"order",{priority:1,requested_by:"",collected_by:w().$state.department,sample_collected_time:"",tracking_number:""});d(this,"encounter",{sending_facility:1,encounter_type:1,facility_section:1});this.client.id=e}createEncounter(e,n){this.encounter={...this.encounter,encounter_type:e,facility_section:n}}buildOrder(e="",n=R().format("YYYY-MM-DD HH:mm:ss")){this.order.requested_by=e,this.order.sample_collected_time=n}setTests(e,n){this.tests=n.map(p=>({specimen:e,test_type:p}))}async createOrder(){return c.postJson("orders",{tests:this.tests,order:this.order,encounter:this.encounter,client:this.client})}}const se={components:{Listbox:Q,ListboxButton:X,ListboxLabel:Z,ListboxOptions:$,ListboxOption:ee,IdentificationIcon:G},setup(){q({title:`${j.name.toUpperCase()} - New Test`})},data(){return{ArrowDownTrayIcon:z,pages:[{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}],patient:{date_of_birth:"",first_name:"",middle_name:"",last_name:"",client_id:0,id:0,sex:"",birth_date_estimated:!1},visitTypes:new Array,specimens:new Array,wards:new Array,tests:new Array,visitTypeSelected:{name:"select visit type",id:0},specimenSelected:{name:"select specimen",id:0},wardSelected:{name:"select ward",id:0},testsSelected:new Array,physician:"",sampleCollectionDate:"",requestingTitle:"Requesting Ward",isBDE:!1,authStore:w(),alert:H(),route:N(),token:P("token")}},computed:{patientAge(){return J(this.patient.date_of_birth)},patientSex(){return this.patient.sex.match(/f/i)?"Female":"Male"},patientName(){return`${this.patient.first_name} ${this.patient.middle_name} ${this.patient.last_name}`},patientNumber(){return this.patient.client_id},currentDepartment(){return this.authStore.user.departments.find(s=>s.name===this.authStore.department)}},methods:{getPatient(s){const e={route:`${M.clients}/${s}`,method:"GET",token:`${this.token}`};K(e).then(({data:n,error:p,pending:i})=>{n.value&&(this.patient=n.value),p.value&&console.error(W)})},async saveChanges(){const s=new te(this.patient.client_id);s.createEncounter(this.visitTypeSelected.id,this.wardSelected.id),s.buildOrder(this.physician,this.sampleCollectionDate),s.setTests(this.specimenSelected.id,this.testsSelected);const e=await s.createOrder();u(e)||(r().$toast.success(`Order with accession number ${e.accession_number} has been created successfully!`),await this.alert.alertConfirmation({message:"Do you want to print specimen label?"})&&await Y.printSpecimenLabel(e.accession_number)),r().$router.push("/tests")},validator(){return this.visitTypeSelected.id==0?(r().$toast.warning("Please select visit type and try again!"),!1):this.specimenSelected.id==0?(r().$toast.warning("Please select specimen and try again!"),!1):this.wardSelected.id==0?(r().$toast.warning("Please select ward and try again!"),!1):this.testsSelected.length==0?(r().$toast.warning("Please select tests and try again!"),!1):!0}},watch:{async visitTypeSelected(s){s.name.toLowerCase()=="referral"?(this.requestingTitle="Requesting Facility",this.wardSelected={name:"select facility",id:0}):this.requestingTitle="Requesting Ward",this.wards=new Array,u(this.wards[s.id])&&(this.wards=await c.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:s.id}))},async specimenSelected(s){u(this.tests[s.id])&&(this.tests[s.id]=await c.getJson("specimen/test_types",{specimen_id:s.id,department_id:this.currentDepartment.id})||[])},async authStore(s){for(const e in this.tests)this.tests.hasOwnProperty(e)&&delete this.tests[e];u(this.specimenSelected)||(this.tests[this.specimenSelected.id]=await c.getJson("specimen/test_types",{specimen_id:this.specimenSelected.id,department_id:s.user.departments.find(e=>e.name===s.department).id})||[])}},created(){c.getJson("encounter_types").then(s=>this.visitTypes=s.data),c.getJson("specimen").then(s=>this.specimens=s),this.getPatient(this.route.query.patient_id)}},ie=""+new URL("test.087be835.png",import.meta.url).href,ne={class:"py-5 px-5"},oe={class:"mt-5"},ae={class:"flex items-center space-x-2"},le=t("img",{src:ie,class:"w-auto h-8",alt:"flash-icon"},null,-1),re={class:"text-2xl font-semibold uppercase"},ce={class:"text-sky-500 text-2xl font-semibold"},de={class:"border rounded mt-5"},me={class:"bg-gray-50 flex items-center space-x-3 px-2 py-2 rounded-tr rounded-tl border-b"},pe=t("h3",{class:"font-semibold text-lg"},"Patient Details",-1),ue={class:"w-full py-5 px-5"},_e={class:"flex items-center space-x-20"},he={class:"flex items-center space-x-3"},fe=t("h3",{class:"text-lg font-medium"},"Patient Number:",-1),ye={class:"mt-1 text-gray-600"},xe={class:"flex items-center space-x-3"},ge=t("h3",{class:"text-lg font-medium"},"Age",-1),we={class:"mt-1 text-gray-600"},be={class:"flex items-center space-x-3"},ve=t("h3",{class:"text-lg font-medium"},"Sex:",-1),Se={class:"mt-1 text-gray-600"},Te={class:"border px-5 py-5 mt-5 rounded"},Ve={class:"w-full mb-5"},ke={class:"flex flex-col space-y-2"},De={class:"w-full flex items-center space-x-10 mb-5"},Ae={class:"w-1/2 flex flex-col space-y-2"},Ce=t("label",{class:"font-medium"},"Visit Type",-1),qe={class:"w-1/2 flex flex-col space-y-2"},Ne={class:"font-medium"},Pe={class:"w-full flex items-center space-x-10 mb-5"},Be={class:"w-1/2 flex flex-col space-y-2"},Ee=t("label",{class:"font-medium"},"Specimen Type",-1),Ue={class:"w-1/2 flex flex-col space-y-2"},Le=t("label",{class:"font-medium"},"Tests",-1),Oe={class:"w-full my-6"},Ie=t("label",{class:"font-medium"},"Back Data Entry",-1),Fe={key:0,class:"w-full mb-5 flex flex-col space-y-2"},Re=t("label",{class:"font-medium"},"Sample collection date",-1),He={class:"w-full"};function Je(s,e,n,p,i,l){const b=A,v=h("IdentificationIcon"),f=h("FormKit"),_=C,S=h("multi-select"),T=F;return y(),x("div",null,[t("div",ne,[a(b,{pages:i.pages},null,8,["pages"]),t("div",oe,[t("div",ae,[le,t("h3",re,[E(" New test for "),t("span",ce,"“"+m(l.patientName)+"”",1)])]),t("div",de,[t("div",me,[a(v,{class:"w-5 h-5"}),pe]),t("div",ue,[t("div",_e,[t("div",he,[fe,t("p",ye,m(l.patientNumber),1)]),t("div",xe,[ge,t("p",we,m(l.patientAge)+" years old",1)]),t("div",be,[ve,t("p",Se,m(l.patientSex),1)])])])]),a(f,{type:"form","submit-label":"Update",onSubmit:e[7]||(e[7]=V=>l.validator()&&l.saveChanges()),actions:!1,id:"submitForm"},{default:U(({value:V})=>[t("div",Te,[t("div",Ve,[t("div",ke,[a(f,{label:"Requesting Physician",validation:"required",modelValue:i.physician,"onUpdate:modelValue":e[0]||(e[0]=o=>i.physician=o)},null,8,["modelValue"])])]),t("div",De,[t("div",Ae,[Ce,a(_,{items:i.visitTypes,modelValue:i.visitTypeSelected,"onUpdate:modelValue":e[1]||(e[1]=o=>i.visitTypeSelected=o)},null,8,["items","modelValue"])]),t("div",qe,[t("label",Ne,m(i.requestingTitle),1),a(_,{isSearchable:"",items:i.wards,modelValue:i.wardSelected,"onUpdate:modelValue":e[2]||(e[2]=o=>i.wardSelected=o)},null,8,["items","modelValue"])])]),t("div",Pe,[t("div",Be,[Ee,a(_,{items:i.specimens,modelValue:i.specimenSelected,"onUpdate:modelValue":e[3]||(e[3]=o=>i.specimenSelected=o)},null,8,["items","modelValue"])]),t("div",Ue,[Le,a(S,{required:!0,style:{"--ms-max-height":"none !important"},modelValue:i.testsSelected,"onUpdate:modelValue":e[4]||(e[4]=o=>i.testsSelected=o),options:i.tests[i.specimenSelected.id||0],placeholder:"-- select tests --",mode:"tags",clear:"",searchable:"",class:"focus:ring-none fcus:border-none focus:outline-none multiselect-green"},null,8,["modelValue","options"])])]),t("div",Oe,[g(t("input",{type:"checkbox",placeholder:"Name of physician",class:"mr-3 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[5]||(e[5]=o=>i.isBDE=o)},null,512),[[L,i.isBDE]]),Ie]),i.isBDE?(y(),x("div",Fe,[Re,g(t("input",{type:"date",class:"w-full border rounded px-1.5 py-1.5 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-none transition duration-150","onUpdate:modelValue":e[6]||(e[6]=o=>i.sampleCollectionDate=o)},null,512),[[O,i.sampleCollectionDate]])])):I("",!0),t("div",He,[a(T,{type:"submit",text:"Place order",color:"success",icon:i.ArrowDownTrayIcon,click:()=>{}},null,8,["icon"])])])]),_:1})])])])}const dt=B(se,[["render",Je]]);export{dt as default};
