import{_ as B}from"./Breadcrumb.vue.a5cd8cfb.js";import{u as z,_ as V,f as P,o as l,c as d,b as w,d as e,h as x,t as o,w as I,Q as E,p as U,j as b,k as f,F as y,r as g,v as F,e as Y}from"./entry.0b8cd08a.js";import{_ as O}from"./index.35f8e966.js";import{_ as G}from"./Loader.079f2cba.js";import{d as D}from"./constants.1be0c037.js";import{h as S,e as C,f as M,c as H,i as L}from"./fetch.3bebfb7d.js";import{u as Q}from"./vue.f36acd1f.cbc612d6.js";import{u as Z}from"./facility.90d3dd6e.js";import{P as J}from"./package.b2e4a4ff.js";import{r as K}from"./UserIcon.8307e016.js";import{r as W}from"./QrCodeIcon.87d839b9.js";import{r as X}from"./FunnelIcon.26675cc2.js";import{r as $}from"./PrinterIcon.f055bae4.js";import{r as ee}from"./ArrowPathIcon.799ac706.js";import{_ as te}from"./logo.168ad185.js";import"./nuxt-link.7cdf9b23.js";import"./HomeIcon.4eb0c0eb.js";import"./jspdf.es.min.1f957379.js";import"./XMarkIcon.c65f13ea.js";import"./transition.29920038.js";import"./hidden.7f45844e.js";import"./PencilSquareIcon.8bd9941b.js";const se={name:"PatientReport",components:{UserIcon:K,QrCodeIcon:W,FunnelIcon:X},setup(){Q({title:`${J.name} - Patient Report`})},data(){return{dateRange:new Array("",""),pages:[{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Daily Reports",link:"#"},{name:"Patient Report",link:"/reports/daily/patient-report"}],location:{},reportData:new Array,person_identifiers:[],physicalAddress:"",person:{},printIcon:$,refreshIcon:ee,cookie:z("token"),moment:S,facility:Z(),hasSusceptivibility:!1,authorizedTestCount:0,showPendingTests:!1,loading:!1}},computed:{router(){return this.$router},patientId(){return String(this.router.currentRoute.value.params.patientId)},orderId(){return String(this.$route.query.order_id)},getPhysicalAddress(){return this.person_identifiers.length>0&&this.person_identifiers.forEach(t=>{(t.identifier_type==="current_traditional_authority"||t.identifier_type==="physical_address")&&(this.physicalAddress=t.value)}),this.physicalAddress}},async created(){this.init()},methods:{async init(){this.loading=!0;const t=this.$route.query.order_id,r=this.dateRange!==null&&this.dateRange.length>0&&S(this.dateRange[0]).isValid()?S(this.dateRange[0]).format("YYYY-MM-DD"):"",a=this.dateRange!==null&&this.dateRange.length>1&&S(this.dateRange[1]).isValid()?S(this.dateRange[1]).format("YYYY-MM-DD"):"";if(this.person_identifiers=new Array,t!=null){const c={route:`${C.tests}/${this.patientId}/report?order_id=${t}&from=${r}&to=${a}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await M(c);if(this.loading=v,s.value){this.loading=!1,this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let R=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=R}n.value&&(this.loading=!1,console.error(n.value))}else{const c={route:`${C.tests}/${this.patientId}/report?from=${r}&to=${a}`,method:"GET",token:`${this.cookie}`},{data:s,error:n,pending:v}=await M(c);if(this.loading=v,s.value){this.person=s.value.client.person,this.person_identifiers=s.value.client.client_identifiers;let R=s.value.orders.map(u=>{let m=0;return u.tests!==void 0&&(m+=u.tests.filter(k=>k.status.toLowerCase()==="verified").length),{...u,tests_verified:m}});this.reportData=R,this.loading=!1}n.value&&(console.error(n.value),this.loading=!1)}},getOrderStatusInitiatorName(t){const r=["specimen-accepted","specimen-rejected"],a=t.find(c=>r.includes(c.status.name));return a?`${a.initiator.first_name} ${a.initiator.last_name}`:""},getOrderStatus(t){return t!==null?H(t.split("-").join(" ")):""},getTestStatusInitiatorName(t,r){const a=t.find(c=>r===c.status.name);return a?{name:`${a.initiator.first_name} ${a.initiator.last_name}`,created_at:a.created_date}:{name:"",created_at:""}},getTestTypes(t){return t.map(r=>r.name).join(", ")},getDepartments(t){return[...new Set(t.map(a=>a.department))].join(", ")},getAuthorizedTestCount(t){return t.reduce((r,a)=>r+a.tests_verified,0)},showIndicatorRanges(t){return t.some(r=>r.test_indicator_type==="numeric")},getTestStatusName(t){return t=="verified"?t="Authorized":t=t.split("-").map(r=>this.capitalizeStr(r)).join(" "),t},capitalizeStr(t){return t.charAt(0).toUpperCase()+t.slice(1)},updateReport(t){t&&this.init()},checkSusceptibilityResults(t){return t.tests.some(r=>r.suscept_test_result.length!==0)},getFilteredDrugs(t){return t.filter(r=>r.zone!==null)},showResult(t,r){return r.length>0?`Growth of ${r.map(a=>a.name).join(", ")}`:t},shouldPrintSmallLabel(t){return t.some(r=>r.tests.some(a=>a.print_device))},getSmallLabelPrintTests(t){const r=[];return t.forEach(a=>{a.tests.forEach(c=>{c.print_device&&r.push(c.id)})}),r},getPrintCount(t){return t.reduce((r,a)=>r+a.print_count,0)},getRequiredRange(t,r){const a=t.sex=="M"?"Male":"Female",c=Number(L(t.date_of_birth));return r.filter(s=>s.sex===a&&c>Number(s.min_age)&&c<Number(s.max_age)||s.sex==="Both"&&c>Number(s.min_age)&&c<Number(s.max_age))[0]},shouldDisplayRange(t,r,a){let c=null;return this.showIndicatorRanges(t)&&(c=this.getRequiredRange(r,a.indicator_ranges)),c},getMachineName(t){return t[0].result.machine_name},getCompletedTests(t){const r=new Set(["completed","verified"]);return t.filter(a=>r.has(a.status.toLowerCase()))}}},re=""+new URL("medical-record.2202ac05.png",import.meta.url).href,oe={class:"py-5 px-5"},ne={class:"flex items-center py-5"},ae=e("img",{src:re,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),ie={class:"text-2xl font-semibold uppercase"},le={class:"text-sky-500 text-2xl"},de={class:"mt-2 space-y-3"},ce={class:"w-full flex items-center justify-between"},pe={class:"flex items-center space-x-5"},_e={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},ue={class:"w-72 ml-2"},me={class:"flex items-center space-x-2"},he=e("label",null,"Include pending tests",-1),be={key:0,class:"border rounded print-container mt-10"},fe={class:"rounded-tr rounded-tl border-b px-5 py-5"},ye={class:"flex items-center justify-between"},ge=e("div",{class:"flex items-center space-x-2"},[e("img",{src:te,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-2xl font-semibold"},"PATIENT REPORT")],-1),xe={class:"bg-gray-50 px-4 py-2 rounded border border-dotted"},ve={class:"font-normal"},Re={class:"flex items-center not-italic text-xl font-semibold border-b mb-2 border-dotted"},ke={class:"flex items-center not-italic text-gray-600"},we={class:"flex items-center not-italic text-gray-600"},De={class:"flex items-center justify-between mt-5"},Se=e("span",{class:"font-medium"},"Report Date:",-1),Te=e("span",{class:"font-medium"},"No. Printed:",-1),Ie=e("span",{class:"font-medium"},"Date Sample Collected:",-1),Ne={class:"w-full mt-2"},Ae=e("td",{class:"border px-2 py-2 font-bold"},"Patient Name",-1),Pe={class:"border px-2 py-2"},Fe=e("td",{class:"border px-2 py-2 font-bold"},"Sex",-1),Ce={class:"border px-2 py-2"},Me=e("td",{class:"border px-2 py-2 font-bold"},"Age",-1),Le={class:"border px-2 py-2"},je=e("td",{class:"border px-2 py-2 font-bold"},"Patient ID",-1),qe={class:"border px-2 py-2"},Be=e("td",{class:"border px-2 py-2 font-bold",colspan:"2"},"Address",-1),ze={class:"border px-2 py-2",colspan:"2"},Ve={class:"bg-gray-100 text-gray-600 border-b flex items-center justify-between px-2 py-2 font-medium"},Ee={class:"flex items-center"},Ue={class:"border-collapse border-slate-500 w-full"},Ye=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Type ",-1),Oe={class:"border-b border-r px-2 py-2"},Ge=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Date Registered ",-1),He={class:"border-b px-2 py-2"},Qe=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Test Type(s) ",-1),Ze={class:"border-b border-r px-2 py-2"},Je=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Lab Sections ",-1),Ke={class:"border-b px-2 py-2"},We=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Specimen Status ",-1),Xe={class:"border-b border-r px-2 py-2"},$e=e("td",{class:"border-b border-r px-2 py-2 font-bold"}," Received By ",-1),et={class:"border-b px-2 py-2"},tt={class:"border-collapse w-full"},st={class:"bg-gray-100 text-gray-600"},rt=e("th",{class:"px-2 py-2 text-lg font-semibold"},"Results",-1),ot={colspan:3,class:"px-2 py-2 text-lg font-semibold"},nt=e("tr",null,[e("th",{class:"border px-2 py-2 font-bold"},"Test Types"),e("th",{class:"border px-2 py-2 font-bold"},"Results"),e("th",{class:"border px-2 py-2 font-bold"},"Remarks"),e("th",{class:"border px-2 py-2 font-bold"},"Audit details")],-1),at={class:"border px-2 py-2 text-left"},it={class:"p-0 border-b",style:{padding:"0 !important"}},lt={class:"w-full border-collapse",style:{"border-collapse":"collapse !important",margin:"0 !important",padding:"0 !important"}},dt=e("thead",null,[e("tr",{class:"border-b border-t bg-gray-100"},[e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Measure "),e("th",{class:"border-r border-b px-2 py-2 font-bold"}," Result "),e("th",{class:"px-2 py-2 border-b font-bold"},"Range")])],-1),ct={class:"border-b"},pt={class:"border-r px-2 py-2"},_t={class:"px-2 py-2 flex items-center"},ut=["innerHTML"],mt={key:0,class:"text-xs"},ht={key:1},bt={key:0,class:"border-t border-l px-2 py-2 font-bold"},ft={key:1,class:"border px-2 py-2"},yt={class:"border px-2 py-2"},gt={class:"border px-2 py-2"},xt={class:"test-status"},vt=e("p",{class:"font-bold"},"Test Status",-1),Rt={class:"px-2"},kt={class:"px-2"},wt={class:"px-2"},Dt={key:0},St=e("p",{class:"font-bold"},"Performed By",-1),Tt={class:"px-2"},It={class:"px-2 mb-2"},Nt={key:0,class:"mb-2"},At=e("h3",{class:"font-bold"},"Laboratory Machine Used",-1),Pt={class:"m-2"},Ft=e("h3",{class:"text-lg font-semibold uppercase mb-3 mt-3"}," Suscpeptibility Test Results ",-1),Ct={class:"border rounded-tr rounded-tl px-2 py-2 font-medium text-lg"},Mt={class:"w-full"},Lt=e("thead",null,[e("tr",{class:"border-b px-2 py-2 text-left border-r border-l"},[e("th",{class:"px-4 py-2 border-r"},"Drug"),e("th",{class:"px-4 py-2 border-r"},"Zone (mm)"),e("th",{class:"px-4 py-2"},"Intrepretation")])],-1),jt={classs:"border-l border-r"},qt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Bt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},zt={class:"text-left border-l border-r px-4 py-2 border-b font-normal"},Vt={class:"mx-auto justify-center flex flex-col items-center space-y-3 py-20"},Et=e("p",{class:"text-base"},[x(" Generating report, please wait"),e("span",{class:"animate-ping"},"...")],-1);function Ut(t,r,a,c,s,n){const v=B,R=P("FunnelIcon"),u=P("datepicker"),m=Y,k=O,j=G;return l(),d("div",oe,[w(v,{pages:s.pages},null,8,["pages"]),e("div",ne,[ae,e("h3",ie,[x(" patient report for "),e("span",le,'"'+o(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`)+'"',1)])]),e("div",de,[e("div",ce,[e("div",pe,[e("div",_e,[w(R,{class:"w-5 h-5 mr-2"}),x(" Filter By Date Range "),e("div",ue,[w(u,{required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:s.dateRange,"onUpdate:modelValue":r[0]||(r[0]=p=>s.dateRange=p)},null,8,["modelValue"])])]),e("div",me,[I(e("input",{type:"checkbox","onUpdate:modelValue":r[1]||(r[1]=p=>s.showPendingTests=p)},null,512),[[E,s.showPendingTests]]),he]),w(m,{loading:s.loading,color:"primary",text:"Generate Report",icon:s.refreshIcon,click:()=>n.init()},null,8,["loading","icon","click"])]),e("div",null,[n.getAuthorizedTestCount(s.reportData)>0?(l(),U(k,{key:0,"print-small-label":n.shouldPrintSmallLabel(s.reportData),id:n.patientId,orderId:n.orderId,tests:n.getSmallLabelPrintTests(s.reportData),onUpdate:n.updateReport},null,8,["print-small-label","id","orderId","tests","onUpdate"])):b("",!0)])]),s.reportData.length>0?(l(),d("div",be,[e("div",fe,[e("div",ye,[ge,e("div",xe,[e("address",ve,[e("span",Re,o(s.facility.details.name),1),e("span",ke,o(s.facility.details.address),1),e("span",we,o(s.facility.details.phone),1)])])]),e("div",De,[e("div",null,[Se,x(" "+o(s.moment(new Date).format("dateFormat"in t?t.dateFormat:f(D))),1)]),e("div",null,[Te,x(" "+o(n.getPrintCount(s.reportData)),1)]),e("div",null,[Ie,x(" "+o(s.reportData.length>0&&s.moment(s.reportData[0].sample_collected_time).format("dateFormat"in t?t.dateFormat:f(D))),1)])]),e("table",Ne,[e("tbody",null,[e("tr",null,[Ae,e("td",Pe,o(`${s.person.first_name} ${s.person.middle_name?s.person.middle_name:""} ${s.person.last_name}`),1),Fe,e("td",Ce,o(s.person.sex==="F"?"Female":"Male"),1),Me,e("td",Le,o(("calculateAge"in t?t.calculateAge:f(L))(s.person.date_of_birth))+" yr(s) ",1)]),e("tr",null,[je,e("td",qe,o(s.person.id),1),Be,e("td",ze,o(n.getPhysicalAddress),1)])])])]),(l(!0),d(y,null,g(s.reportData,(p,q)=>(l(),d("div",{key:q},[e("div",Ve,[e("div",Ee," Accession No: "+o(p.accession_number),1),e("div",null," Requested By: "+o(p.requested_by)+" ("+o(p.requesting_ward)+") ",1)]),e("table",Ue,[e("tbody",null,[e("tr",null,[Ye,e("td",Oe,o(p.specimen),1),Ge,e("td",He,o(s.moment(p.created_date).format("dateFormat"in t?t.dateFormat:f(D))),1)]),e("tr",null,[Qe,e("td",Ze,o(n.getTestTypes(p.test_types)),1),Je,e("td",Ke,o(n.getDepartments(p.test_types)),1)]),e("tr",null,[We,e("td",Xe,o(n.getOrderStatus(p.order_status)),1),$e,e("td",et,o(n.getOrderStatusInitiatorName(p.order_status_trail)),1)])])]),e("table",tt,[e("thead",null,[e("tr",st,[rt,e("th",ot," Tests Authorized("+o(p.tests_verified)+") ",1)])]),e("tbody",null,[nt,(l(!0),d(y,null,g(s.showPendingTests?p.tests:n.getCompletedTests(p.tests),i=>(l(),d("tr",{key:i.id},[e("td",at,o(i.test_type_name),1),e("td",it,[e("table",lt,[dt,e("tbody",ct,[(l(!0),d(y,null,g(i.indicators,(_,T)=>{var h,N,A;return l(),d("tr",{key:T,class:"border-b"},[e("td",pt,o(_.name),1),e("td",_t,[e("p",{innerHTML:n.showResult(((h=_.result)==null?void 0:h.value)??"",i==null?void 0:i.suscept_test_result)},null,8,ut),(N=_.result)!=null&&N.value?(l(),d("span",mt,o((i==null?void 0:i.suscept_test_result.length)>0?"":_==null?void 0:_.unit),1)):b("",!0),(A=_.result)!=null&&A.value?b("",!0):(l(),d("span",ht,"Not done"))]),n.shouldDisplayRange(i.indicators,s.person,_)!==void 0&&n.shouldDisplayRange(i.indicators,s.person,_)!==null?(l(),d("td",bt," ("+o(n.shouldDisplayRange(i.indicators,s.person,_).lower_range)+" - "+o(n.shouldDisplayRange(i.indicators,s.person,_).upper_range)+") ",1)):(l(),d("td",ft,"N/A"))])}),128))])])]),e("td",yt,o((i==null?void 0:i.remarks)??"N/A"),1),e("td",gt,[e("div",xt,[vt,e("p",Rt,o(n.getTestStatusName(i.status)),1),e("p",kt," By: "+o(n.getTestStatusInitiatorName(i.status_trail,i.status).name),1),e("p",wt," On: "+o(s.moment(n.getTestStatusInitiatorName(i.status_trail,i.status).created_at).format("dateFormat"in t?t.dateFormat:f(D))),1)]),n.getTestStatusInitiatorName(i.status_trail,"completed").name?(l(),d("div",Dt,[St,e("p",Tt,o(n.getTestStatusInitiatorName(i.status_trail,"completed").name),1),e("p",It," On: "+o(s.moment(n.getTestStatusInitiatorName(i.status_trail,"completed").created_at).format("dateFormat"in t?t.dateFormat:f(D))),1),n.getMachineName(i.indicators)?(l(),d("div",Nt,[At,e("p",null,o(n.getMachineName(i.indicators)),1)])):b("",!0)])):b("",!0)])]))),128))])]),I(e("div",Pt,[Ft,e("div",null,[(l(!0),d(y,null,g(p.tests,i=>(l(),d("div",{class:"grid grid-cols-2 gap-4",key:i.id},[i.test_type_name.toLowerCase().includes("culture")?(l(!0),d(y,{key:0},g(i.suscept_test_result,(_,T)=>(l(),d("div",{key:T},[e("div",Ct,o(_.name),1),e("table",Mt,[Lt,e("tbody",jt,[(l(!0),d(y,null,g(n.getFilteredDrugs(_.drugs),h=>(l(),d("tr",{key:h.drug_id},[e("th",qt,o(h.name),1),e("th",Bt,o(h.zone),1),e("th",zt,o(h.interpretation),1)]))),128))])])]))),128)):b("",!0)]))),128))])],512),[[F,n.checkSusceptibilityResults(p)]])]))),128))])):b("",!0),e("div",null,[I(e("div",Vt,[w(j),Et],512),[[F,s.loading]])])])])}const ps=V(se,[["render",Ut]]);export{ps as default};
