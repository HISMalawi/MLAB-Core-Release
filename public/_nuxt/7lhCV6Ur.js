import{_ as me}from"./BSOqz5j4.js";import{_ as fe}from"./BpUhCbQO.js";import{d as ye,r as h,a as be,a2 as ge,ag as ve,u as Ee,c as U,C as b,w as I,o as he,y as P,b as M,e as Y,f as g,h as o,g as r,t as x,z as H,j as K,H as z,F as xe,k as Re,N as Te,K as Q,m as Le,l as J,E as Se,aq as $e,_ as Me}from"./27gxMGx-.js";import{_ as Ye}from"./D3rolrpP.js";import{_ as Ge,a as ke}from"./DmKpNa_M.js";import{u as Ne,_ as Ce}from"./Cb6ySZZz.js";import{_ as qe}from"./Cl9q0VvX.js";import{_ as Ae}from"./BZuVrphp.js";import{a as Ue}from"./Ck4zeF2r.js";import{P as Fe}from"./Dj9465vM.js";import{u as Oe}from"./B9AAm1fp.js";import{u as We}from"./BXtJ-a5P.js";import{r as je}from"./-RB0I00X.js";import{r as Be}from"./DP4PBieG.js";import"./DPOyO2jd.js";import"./eODTOUMG.js";import"./DPrp5pRO.js";import"./C7om58M4.js";import"./Dmqlm_CE.js";import"./BkCxw8YQ.js";import"./DZR_JJ-2.js";import"./UdSMLOvr.js";import"./BgDFElE0.js";const Ve={class:"px-5 py-5"},Ie={class:"flex items-center py-5"},Pe={class:"text-2xl font-semibold uppercase"},He={class:"w-full flex items-center justify-between mb-5"},Ke={class:"w-full flex items-center space-x-3"},ze={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},Qe={class:"w-72 ml-2"},Je={class:"w-40"},Xe={class:"w-48 flex items-end justify-end"},Ze={class:"rounded border"},we={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},De={key:0},et={class:"hidden"},tt={class:"text-lg font-semibold py-2 px-2"},rt={class:"text-normal font-normal"},ot={id:"print-container"},st=["innerHTML"],nt={class:"w-full border-t"},lt={class:"px-2 py-2 border-r border-b"},at=["onClick"],it={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},qt=ye({__name:"infection",setup(dt){We({title:`${Fe.name.toUpperCase()} - Infection Report`});const X=h("Infection Report"),Z=h([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),G=h([]),m=h({id:0,name:"select department"}),F=be("token"),{loading:v,executeCancellableRequest:w,cancelRequest:D}=Ne(),E=ge(),f=ve(),{$toast:R}=Ee(),k=Oe(),N=h([]),O=h([]),W=h(!1),a=h(new Array("","")),L=U(()=>a.value[0]?b(a.value[0]).format("YYYY-MM-DD"):""),S=U(()=>a.value[1]?b(a.value[1]).format("YYYY-MM-DD"):""),ee=()=>{a.value=new Array("","")},te=()=>'<thead class="w-full h-full border-b"><tr class="w-full h-full bg-gray-50"><th rowspan="2" class="px-2 py-2 border-r">Test</th><th rowspan="2" class="border-r">Measure</th><th rowspan="2" class="px-2 py-2 border-r">Results</th><th rowspan="2" class="px-2 py-2 border-r">Sex</th><th colspan="3" scope="colgroup" class="border-r border-b px-2 py-2">Age Range</th><th rowspan="2" class="px-2 py-2 border-r">M/F Total</th><th rowspan="2" class="px-2 py-2">Total</th></tr><tr><th scope="col" class="border-l px-2 py-2 border-r bg-gray-50">[0-5]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[5-14]</th><th scope="col" class="border-r px-2 py-2 bg-gray-50">[14-120]</th></tr></thead>',p=(s,e,l)=>{const n=s.indexOf(e);return n!==-1?s.slice(0,n)+l+s.slice(n+e.length):s},re=(s,e,l,n)=>{l!==0&&n!==""?E.push(`/reports/${n}?origin=aggregate&type=infection-report&from=${L.value}&to=${S.value}&test=${s} - ${e}&department=${m.value.name}&count=${l}`):R.warning("No data found for this month")},oe=s=>{W.value=!1;let e="",l="",n="",i="",u=0,c=0,_=0,y=0,T=0;return s.reduce((t,$)=>{const A=$.measures.flatMap(C=>C.results.flatMap(B=>{const V=Object.keys(B[0])[0],ue=B[0][V];return Object.entries(ue).map(([ce,pe])=>{const _e=pe;return{test_type:$.test_type,measure:C.name,result:V,gender:ce==="F"?"Female":"Male",..._e}})}));return t.push(...A),t},new Array).forEach(t=>{c++,_++,u++,n===t.test_type?(e+="<tr>",l!==t.measure?(l=t.measure,i=t.result,e=p(e,"NEW_MEASURE",c.toString()),e=e.replace("NEW_RESULT",_.toString()),e=p(e,"RESULT_TOTAL",y.toString()),c=0,_=0,y=0,e+="<td class='px-2 py-2 border-r border-b' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"):i!==t.result&&(e=e.replace(/NEW_RESULT/g,_.toString()),e=p(e,"RESULT_TOTAL",y.toString()),i=t.result,_=0,y=0,e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>")):(n=t.test_type,l=t.measure,i=t.result,e=e.replace(/NEW_TEST/g,u.toString()),e=p(e,"NEW_MEASURE",c.toString()),e=e.replace(/NEW_RESULT/g,_.toString()),e=p(e,"RESULT_TOTAL",y.toString()),e=p(e,"TEST_TOTAL",T.toString()),c=0,_=0,y=0,u=0,T=0,e+="<tr class='tests'>",e+="<td class='border-b border-r px-2 py-2' rowspan='NEW_TEST'>"+t.test_type+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_MEASURE'>"+t.measure+"</td>",e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>"+t.result+"</td>"),e+="<td class='border-r border-b px-2 py-2'>"+t.gender+"</td>";const $=q("L_E_5");e+=`
      <td
        class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${$}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">
        ${t.L_E_5?t.L_E_5.count.toString():"0"}
      </td>`;const A=q("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${A}"
        data-count="${t.L_E_5?t.L_E_5.count:0}"
        data-ids="${t.L_E_5?t.L_E_5.associated_ids:""}">`+(t.G_5_L_E_14?t.G_5_L_E_14.count:0).toString()+"</td>";const C=q("L_E_5");e+=`<td class="px-2 py-2 border-r border-b hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"
        data-clickable="true"
        id="tdRef"
        data-test="${t.test_type}"
        data-ward="${C}"
        data-count="${t.G_14?t.G_14.count:0}"
        data-ids="${t.G_14?t.G_14.associated_ids:""}">`+(t.G_14?t.G_14.count:0).toString()+"</td>",e+="<td class='border-r border-b px-2 py-2'>"+((t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0)).toString()+"</td>",y+=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0),i===t.result&&_==0&&(e+="<td class='border-r border-b px-2 py-2' rowspan='NEW_RESULT'>RESULT_TOTAL</td>"),c==0&&(T=(t.L_E_5?t.L_E_5.count:0)+(t.G_5_L_E_14?t.G_5_L_E_14.count:0)+(t.G_14?t.G_14.count:0))}),e=p(e,"NEW_TEST",(++u).toString()),e=p(e,"NEW_MEASURE",(++c).toString()),e=p(e,"NEW_RESULT",(++_).toString()),e=p(e,"RESULT_TOTAL",y.toString()),e=p(e,"TEST_TOTAL",T.toString()),e+="</tr>",W.value=!0,e},q=s=>({L_E_5:"Less than or equal to 5 years old",G_5_L_E_14:"Greater than 5 years old and less than or equal to 14 years old",G_14:"Greater than 14 years old"})[s],se=s=>{const e=te(),l=s.length>0?oe(s):"<tr></tr>";return`<table class="w-full rounded border-t">${e}${l}</table>`};async function ne(){const{data:s,error:e}=await Le({route:`${J.departments}`,method:"GET",token:`${F.value}`});s.value&&(G.value=s.value,G.value.some(l=>l.id===0)||G.value.unshift({id:0,name:"All"})),e.value&&console.error(e.value)}async function j(){if(ie())R.warning("Please select a department");else{v.value=!0;let s=a.value[0].toString()!=""?b(a.value[0].toString()).format("YYYY-MM-DD"):"",e=a.value[1].toString()!=""?b(a.value[1].toString()).format("YYYY-MM-DD"):"";const l={route:`${J.aggregateReports}infection?from=${s}&to=${e}&department=${m.value.name}&report_id=${f.query.report_id}`,method:"GET",token:`${F.value}`},{data:n,error:i,pending:u}=await w(l);v.value=u,n.value&&(v.value=!1,N.value=n.value.data,O.value=n.value.summary,ae(n.value.report_id),R.success("Report data generated successfully!")),i.value&&(console.error(i.value),v.value=!1,R.error(Se))}}const le=s=>{const e=s.target;if(e.tagName==="TD"&&e.id==="tdRef"){const{test:l,ward:n,count:i,ids:u}=e.dataset;if(i&&u){const c=parseInt(i,10);c!==0&&u!==""?E.push(`/reports/${u}?origin=aggregate&type=infection-report&from=${L.value}&to=${S.value}&test=${l} - ${n}&department=${m.value.name}&count=${c}`):R.warning("No data found for this month")}else R.warning("No data found for this month")}},ae=s=>{const l={...E.currentRoute.value.query,report_id:s};E.replace({query:l}).catch(n=>{console.error("Failed to replace route:",n)})},ie=()=>m.value.name==$e;I(a,()=>{const s=a.value[0]?b(a.value[0]).format("YYYY-MM-DD"):"",e=a.value[1]?b(a.value[1]).format("YYYY-MM-DD"):"";if(s||e){const n={...E.currentRoute.value.query,...s&&{from:s},...e&&{to:e}};E.replace({query:n}).catch(i=>{console.error("Failed to replace route:",i)})}},{deep:!0}),I(m,(s,e)=>{if(s!==e){const n={...E.currentRoute.value.query,department:s.name||void 0,report_id:""};E.replace({query:n}).catch(i=>{console.error("Failed to replace route:",i)})}});const de=U(()=>f.query.to!==void 0&&f.query.from!==void 0&&f.query.department!==void 0?(a.value=[f.query.from,f.query.to],m.value.name=`${f.query.department}`,f.query.to!==""&&f.query.from!==""&&f.query.department!==""):!1);return he(()=>{de.value?j():v.value=!1}),ne(),(s,e)=>{const l=me,n=P("datepicker"),i=fe,u=Me,c=P("FormKit"),_=Ye,y=ke,T=Ce;return M(),Y("div",Ve,[g(l,{pages:o(Z)},null,8,["pages"]),r("div",Ie,[e[2]||(e[2]=r("img",{src:qe,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1)),r("h3",Pe,x(o(X)),1)]),r("div",He,[g(c,{type:"form","submit-label":"Update",onSubmit:j,actions:!1,id:"submitForm"},{default:H(({value:d})=>[r("div",Ke,[r("div",ze,[g(o(je),{class:"w-5 h-5 mr-2"}),e[3]||(e[3]=K(" Filter By Date Range ")),r("div",Qe,[g(n,{onCleared:ee,required:"",position:"left",placeholder:"select start & end date",range:!0,format:"dd/MM/yyyy","input-class-name":"datepicker",modelValue:o(a),"onUpdate:modelValue":e[0]||(e[0]=t=>z(a)?a.value=t:null)},null,8,["modelValue"])])]),r("div",Je,[g(i,{items:o(G),modelValue:o(m),"onUpdate:modelValue":e[1]||(e[1]=t=>z(m)?m.value=t:null)},null,8,["items","modelValue"])]),r("div",null,[g(u,{loading:o(v),color:"primary",type:"submit",text:"Generate Report",icon:o(Be),click:()=>{}},null,8,["loading","icon"])])])]),_:1}),r("div",Xe,[g(o(Ue),{element:"print-container",filename:`infection_report_from_${o(b)(o(L)).format("DD_MM_YYYY")}_to_${o(b)(o(S)).format("DD_MM_YYYY")}_for_${o(k).details.name.toLowerCase().split(" ").join("_")}`},{default:H(()=>[g(_,{text:"Export Excel"})]),_:1},8,["filename"])])]),r("div",null,[r("div",Ze,[r("div",we,[e[4]||(e[4]=r("div",{class:"flex flex-col space-y-2"},[r("img",{src:Ae,alt:"app-logo",class:"w-24 h-24 object-cover"}),r("h3",{class:"text-xl font-semibold uppercase"},"INFECTION REPORT")],-1)),g(y)]),o(N).length>0&&!o(v)?(M(),Y("div",De,[r("div",et,[e[5]||(e[5]=r("h3",null,"INFECTION REPORT",-1)),r("h3",null,x(o(k).details.name),1),r("p",null,x(o(k).details.address),1),r("p",null,x(o(k).details.phone),1)]),r("div",tt,[e[6]||(e[6]=K(" Tests Performed Period: ")),r("span",rt,x(o(L)!=""?o(b)(o(L)).format("DD/MM/YYYY"):"")+" - "+x(o(S)!=""?o(b)(o(S)).format("DD/MM/YYYY"):""),1)]),r("div",ot,[r("div",{innerHTML:se(o(N)),onClick:le},null,8,st),r("div",null,[e[8]||(e[8]=r("h3",{class:"px-2 py-2 text-xl font-semibold uppercase"},"SUMMARY",-1)),r("table",nt,[e[7]||(e[7]=r("thead",null,[r("tr",{class:"border-b border-t bg-gray-100"},[r("th",{class:"px-2 py-2 border-r text-left"},"TESTS"),r("th",{class:"px-2 py-2 text-left"},"TOTAL")])],-1)),r("tbody",null,[(M(!0),Y(xe,null,Re(o(O),(d,t)=>(M(),Y("tr",{key:d.name,class:Te(t%2===0?"bg-white":"bg-gray-50")},[r("td",lt,x(d.name),1),r("td",{onClick:$=>re(d.name,o(m).name,d!=null&&d.total?d.total:0,d!=null&&d.associated_ids?d.associated_ids:""),class:"px-4 py-2 border-r hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150"},x(d.total),9,at)],2))),128))])])])])])):Q("",!0),o(N).length==0&&!o(v)?(M(),Y("div",it,e[9]||(e[9]=[r("img",{src:Ge,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),r("p",{class:"text-base"},"Data not found, please generate report",-1)]))):Q("",!0),g(T,{condition:o(v),cancelReportGeneration:()=>o(D)()},null,8,["condition","cancelReportGeneration"])])])])}}});export{qt as default};
