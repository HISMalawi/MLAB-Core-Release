import{_ as E}from"./CwhZhTYd.js";import{b as u,e as d,g as t,x as N,i as b,v as w,F as x,k,C as h,M as P,bG as V,P as T,a as O,l as y,m as v,a4 as L,u as A,bM as U,bH as F,y as M,f as p,t as l,h as S,O as C,K as g,L as Y,_ as z}from"./Cc7Tx-yz.js";import{_ as H}from"./B2AwJQL3.js";import{u as $}from"./iPblvlnL.js";import{P as G}from"./C7iPGxxk.js";import{u as W}from"./KiY27RO4.js";import{r as K}from"./CCvYerFB.js";import{r as Z}from"./COjTy3gZ.js";import{r as J}from"./hRixWZZJ.js";import{r as D}from"./4l3EBCQ_.js";import"./q0bNtrxF.js";import"./BstLhON-.js";import"./Lq5eAXI3.js";import"./OJVLXLw2.js";import"./BTya_2KW.js";import"./DGBXCpo7.js";import"./hLgSztLL.js";import"./DQNbD7zb.js";import"./BE9xBVSw.js";import"./ZFDwNG7M.js";function Q(i,e){return u(),d("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z","clip-rule":"evenodd"})])}const X={props:{loading:{required:!0,type:Boolean}}},ee={class:"py-3 px-3"},te={class:"grid grid-cols-3 gap-3"};function se(i,e,n,a,s,r){return b((u(),d("div",ee,[t("div",te,[(u(),d(x,null,k(6,c=>t("div",{key:c,class:"w-full col-span-1 h-8 bg-gray-100 rounded animate-pulse"})),64))]),e[0]||(e[0]=t("div",{class:"w-full h-32 bg-gray-100 rounded animate-pulse mt-3"},null,-1)),e[1]||(e[1]=t("div",{class:"w-32 h-8 bg-gray-100 rounded animate-pulse mt-3"},null,-1))],512)),[[w,n.loading]])}const ie=N(X,[["render",se]]),re={setup(){W({title:`${G.name.toUpperCase()} - Enter Test Results`})},data(){return{details:{},content:"",moment:h,header:"Enter Test Results",patientNo:"",name:"",age:"",sex_:"",selectedDate:"",specimenType:"",trackingNumber:"",accessionNumber:"",testType:"",requestingWard:"",dateRegistered:"",receiptDate:"",testStatus:"",requestingPhysician:"",requestOrigin:"",registeredBy:"",performedBy:"",turnAroundTime:{value:"",unit:""},filterIcon:K,addIcon:Q,refreshIcon:Z,printIcon:P,approveIcon:V,item:(this._.provides[T]||this.$route).params.item,indicatorRangesArray:new Array,accessionNo:"",cookie:O("token"),arrowDownIcon:J,testId:"",pages:[{name:"Home",link:"/home"},{name:"Tests",link:"/tests"}],measures:[],loading:!1,fetching:!1,updating:!1,authorizing:!1,resultsPresent:!0,selectedRange:"",remarks:"",statuses:{id:0,initiator:{id:0}},authStore:$(),machineOriented:!1,completedBy:{},machineName:"",rejectStatuses:[{name:"Reject",icon:D,action:"rejected"},{name:"Void",icon:D,action:"voided"},{name:"Not-done",icon:D,action:"not_done"}]}},computed:{minDate(){const i=new Date,e=i.getFullYear(),n=i.getMonth()+1,a=i.getDate();return`${e}-${n.toString().padStart(2,"0")}-${a.toString().padStart(2,"0")}`},textInputMeasures(){return this.measures.filter(i=>i.type==="numeric"||i.type==="free_text")},dropDownMeasures(){const i=this.measures.filter(e=>e.type==="auto_complete"||e.type==="alpha_numeric");return i.forEach(e=>{e.ranges.unshift({name:"-- select result --"})}),i},richTextEditorMeasures(){return this.measures.filter(i=>i.type==="rich_text")},hasTextInputMeasures(){return this.measures.filter(i=>i.type==="numeric"||i.type==="free_text").length>0},hasDropdownMeasures(){return this.measures.filter(i=>i.type==="alpha_numeric"||i.type==="auto_complete").length>0},hasRichTextMeasures(){return this.measures.filter(i=>i.type==="rich_text").length>0}},created(){this.accessionNo=`${(this._.provides[T]||this.$route).query.accession_number}`,this.testId=`${(this._.provides[T]||this.$route).query.test_id}`,this.init()},methods:{async resultsAvailable(i){const e={route:`${y.resultsAvailable}?accession_number=${i}`,method:"GET",token:`${this.cookie}`},{data:n,error:a,pending:s}=await v(e);n.value&&(n.value.result_available?this.resultsPresent=!1:this.resultsPresent=!0),a.value&&console.error(a.value)},async init(){var s,r;this.loading=!0;const i={route:`${y.tests}/${this.testId}`,method:"GET",token:`${this.cookie}`},{data:e,error:n,pending:a}=await v(i);this.loading=a,e.value&&(this.loading=!1,this.name=e.value.client.first_name+" "+((s=e.value.client)==null?void 0:s.last_name),this.patientNo=e.value.id,this.sex_=(r=e.value.client)==null?void 0:r.sex,this.age=L(e.value.client.date_of_birth)+"",this.trackingNumber=e.value.tracking_number,this.accessionNumber=e.value.accession_number,this.testStatus=e.value.status,this.specimenType=e.value.specimen_type,this.requestingPhysician=e.value.requested_by,this.testType=e.value.test_type_name,this.requestingWard=e.value.requesting_ward,this.dateRegistered=e.value.created_date,this.receiptDate=e.value.created_date,this.requestOrigin=e.value.request_origin,this.turnAroundTime=e.value.expected_turn_around_time,this.remarks=e.value.result_remarks?e.value.result_remarks.value:"",this.loadTestMesures(e.value.indicators),e.value.status_trail.map(c=>{c.status.name.toLowerCase()==="completed"&&(this.statuses=c,this.performedBy=`${c.initiator.first_name} ${c.initiator.last_name}`)}),e.value.status_trail.map(c=>{c.status.name.toLowerCase()==="pending"&&(this.registeredBy=`${c.initiator.first_name} ${c.initiator.last_name}`)}),this.resultsAvailable(e.value.accession_number),this.machineOriented=e.value.is_machine_oriented,this.completedBy=e.value.completed_by,this.details=e.value),n.value&&(console.error(n.value),this.loading=!1)},async fetchResults(){this.fetching=!0;const i={route:`${y.fetchResults}?accession_number=${this.accessionNo}`,method:"GET",token:`${this.cookie}`},{data:e,error:n,pending:a}=await v(i);this.fetching=a,e.value&&(this.measures.map(s=>{e.value.map(r=>{String(s.id)===String(r.indicator_id)&&(s.value.name=r.value,this.machineName=r.machine_name)})}),this.fetching=!1),n.value&&(console.error(n.value),this.fetching=!1)},async loadTestMesures(i){this.measures=new Array,i&&i.forEach(e=>{var n,a,s,r,c,m;this.measures.push({name:e.name,id:e.id,machine_name:(n=e.result)==null?void 0:n.machine_name,value:e.test_indicator_type==="free_text"||e.test_indicator_type==="numeric"?{name:e.name.toLowerCase().includes("date")?h((a=e.result)==null?void 0:a.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(s=e.result)==null?void 0:s.value}:((r=e.result)==null?void 0:r.value)!=null?{name:e.name.toLowerCase().includes("date")?h((c=e.result)==null?void 0:c.value,"DD/MMM/YYYY").format("DD/MMM/YYYY"):(m=e.result)==null?void 0:m.value}:e.test_indicator_type=="rich_text"?{name:""}:{name:"-- select result --"},type:e.test_indicator_type,unit:e.unit,ranges:this.toIndicatorRanges(e.indicator_ranges,e.id)})})},toIndicatorRanges(i,e){let n=[];return i&&i.forEach(a=>{n.push({id:e,name:a.value,lowerRange:a.lower_range,upperRange:a.upper_range})}),n},measuresToIndicators(){let i=new Array;return this.measures.forEach(e=>{i.push({indicator:e.id,value:e.type=="free_text"?e.value.name!==void 0?e.name.toLowerCase().includes("date")?h(e.value.name).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?h(e.value.name).format("DD/MMM/YYYY"):"":e.value.name:null:e.value!==void 0?e.name.toLowerCase().includes("date")?h(e.value).format("DD/MMM/YYYY").toLowerCase()!=="invalid date"?h(e.value).format("DD/MMM/YYYY"):"":e.value:null,machine_name:e.value!==null?this.machineName===""?e.machine_name:this.machineName:null})}),i},async updateTestResults(){this.updating=!0;let i=this.measuresToIndicators().map(r=>(typeof r.value=="object"&&r.value!==null&&(r.value=r.value.name=="-- select result --"?null:r.value.name),r));const e={route:`${y.updateResults}`,method:"POST",token:`${this.cookie}`,body:{test_id:this.testId,test_indicators:i,remarks:this.remarks}},{data:n,error:a,pending:s}=await v(e);this.updating=s,n.value&&(this.updating=!1,A().$toast.success("Test results updated successfully"),this.$router.back()),a.value&&(this.updating=!1,console.error(a.value))},async authorise(){this.authorizing=!0;const i={route:`${y.testStatus}/${this.testId}/verified`,method:"PUT",token:`${this.cookie}`},{data:e,error:n,pending:a}=await v(i);this.authorizing=a,e.value&&(this.authorizing=!1,A().$toast.success("Test status authorized successfully!"),this.$router.push("/tests")),n.value&&(console.error(n.value),this.authorizing=!1)},isCompletedByCurrentUserOrSuperAdmin(i){const e=this.authStore.user,n=i.completed_by;if(n){if(n.id!==e.id)return!0;if(n.is_super_admin===!0)return!0}return!1},shouldDisplayButton(i){return i.status.toLowerCase()==="completed"?this.isCompletedByCurrentUserOrSuperAdmin(i):!1},async printMachine(){const{alertConfirmation:i}=U();await i({message:"Do you want to print specimen label?"})&&await F.printSpecimenLabel(this.accessionNo)},measureReference(i){if(i.length===0)return"";const e=i[0];return e.lowerRange==null?"":`(Ref ${e.lowerRange} - ${e.upperRange})`}}},ne={class:"p-5"},oe={class:"flex items-center justify-between py-5"},ae={class:"text-2xl font-semibold"},le={class:"grid grid-cols-5 gap-4"},ue={class:"flex flex-col space-y-4 col-span-2 order-2"},de={class:"rounded border"},ce={class:"w-full flex items-center",style:{"padding-bottom":"20px"}},pe={class:"w-full space-y-2.5 py-5"},me={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},fe={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},he={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},ge={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},_e={class:"rounded border"},ye={class:"w-full flex items-center"},ve={class:"w-full space-y-2.5 py-5"},be={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},we={class:"w-full py-2 px-4 flex justify-between items-center"},xe={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},ke={class:"w-full py-2 px-4 flex justify-between items-center"},Te={class:"rounded border"},Me={class:"w-full flex items-center max-h-60 overflow-y-auto"},De={class:"w-full py-5"},Re={class:"w-full flex items-center pb-0 pt-72"},Ae={class:"w-full space-y-2 py-5"},Se={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Ce={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Ye={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Ne={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Be={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},qe={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},je={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Ie={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Ee={class:"w-full py-2 px-4 bg-gray-50 border-t border-b border-dotted flex justify-between items-center"},Pe={class:"w-full py-2 px-4 bg-white-100 flex justify-between items-center"},Ve={class:"rounded border order-1 col-span-3"},Oe={class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-medium text-md gap-5 flex flex-row"},Le={class:"p-5"},Ue={key:0,class:"w-full grid grid-cols-3 gap-4"},Fe={key:0,class:"col-span-3 grid grid-cols-3 gap-3"},ze=["id"],He={key:1,class:"col-span-3 grid grid-cols-3 gap-3"},$e={key:0},Ge=["id"],We={class:"text-base font-medium mb-2"},Ke={key:2,class:"col-span-3"},Ze=["id"],Je={class:"font-medium mb-2"},Qe={class:"w-full mt-3 relative"};function Xe(i,e,n,a,s,r){const c=E,m=z,B=H,q=M("FormKit"),j=M("datepicker"),R=M("RichTextEditor"),I=ie;return u(),d("div",ne,[p(c,{pages:s.pages},null,8,["pages"]),t("div",oe,[t("h3",ae,l(s.header),1)]),t("div",le,[t("div",ue,[t("div",de,[e[5]||(e[5]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tr rounded-tl font-semibold text-lg"}," Patient Details ",-1)),t("div",null,[t("div",ce,[t("div",pe,[t("div",me,[e[1]||(e[1]=t("p",{class:"font-medium"},"Patient No",-1)),t("p",null,l(s.patientNo),1)]),t("div",fe,[e[2]||(e[2]=t("p",{class:"font-medium"},"Name",-1)),t("p",null,l(s.name),1)]),t("div",he,[e[3]||(e[3]=t("p",{class:"font-medium"},"Age",-1)),t("p",null,l(s.age),1)]),t("div",ge,[e[4]||(e[4]=t("p",{class:"font-medium"},"Sex",-1)),t("p",null,l(s.sex_),1)])])])])]),t("div",_e,[e[10]||(e[10]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Specimen Details ",-1)),t("div",null,[t("div",ye,[t("div",ve,[t("div",be,[e[6]||(e[6]=t("p",{class:"font-medium"},"Specimen Type",-1)),t("p",null,l(s.specimenType),1)]),t("div",we,[e[7]||(e[7]=t("p",{class:"font-medium"},"Tracking Number",-1)),t("p",null,l(s.trackingNumber),1)]),t("div",xe,[e[8]||(e[8]=t("p",{class:"font-medium"},"Accession Number",-1)),t("p",null,l(s.accessionNumber),1)]),t("div",ke,[e[9]||(e[9]=t("p",{class:"font-medium"},"Status",-1)),t("p",null,l(s.testStatus),1)])])])])]),t("div",Te,[e[21]||(e[21]=t("div",{class:"bg-gray-50 px-2 py-2 border-b rounded-tl-lg rounded-tr-lg font-semibold text-lg"}," Test Details ",-1)),t("div",Me,[t("div",De,[t("div",Re,[t("div",Ae,[t("div",Se,[e[11]||(e[11]=t("p",{class:"font-medium"},"Test Type",-1)),t("p",null,l(s.testType),1)]),t("div",Ce,[e[12]||(e[12]=t("p",{class:"font-medium"},"Requesting Ward/Location",-1)),t("p",null,l(s.requestingWard),1)]),t("div",Ye,[e[13]||(e[13]=t("p",{class:"font-medium"},"Date Registered",-1)),t("p",null,l(s.moment(s.dateRegistered).format("DATE_FORMAT"in i?i.DATE_FORMAT:S(C))),1)]),t("div",Ne,[e[14]||(e[14]=t("p",{class:"font-medium"},"Receipt Date",-1)),t("p",null,l(s.moment(s.receiptDate).format("DATE_FORMAT"in i?i.DATE_FORMAT:S(C))),1)]),t("div",Be,[e[15]||(e[15]=t("p",{class:"font-medium"},"Test Status",-1)),t("p",null,l(s.testStatus),1)]),t("div",qe,[e[16]||(e[16]=t("p",{class:"font-medium"},"Requesting Physician",-1)),t("p",null,l(s.requestingPhysician),1)]),t("div",je,[e[17]||(e[17]=t("p",{class:"font-medium"},"Request Origin",-1)),t("p",null,l(s.requestOrigin),1)]),t("div",Ie,[e[18]||(e[18]=t("p",{class:"font-medium"},"Registered By",-1)),t("p",null,l(s.registeredBy),1)]),t("div",Ee,[e[19]||(e[19]=t("p",{class:"font-medium"},"Performed By",-1)),t("p",null,l(s.performedBy),1)]),t("div",Pe,[e[20]||(e[20]=t("p",{class:"font-medium"},"Turn around time",-1)),t("p",null,l(`${s.turnAroundTime.value} ${Number(s.turnAroundTime.value)==1?s.turnAroundTime.unit.toLowerCase().slice(0,-1):s.turnAroundTime.unit}`),1)])])])])])])]),t("div",Ve,[t("div",Oe,[b(p(m,{text:"Fetch results",color:"warning",icon:s.refreshIcon,loading:s.fetching,disabled:s.resultsPresent,click:()=>r.fetchResults()},null,8,["icon","loading","disabled","click"]),[[w,s.machineOriented]]),p(m,{text:"Print Accession Number",color:"primary",icon:s.printIcon,click:()=>r.printMachine()},null,8,["icon","click"]),b(p(m,{text:"Authorize",color:"success",icon:s.approveIcon,click:()=>r.authorise(),loading:s.authorizing},null,8,["icon","click","loading"]),[[w,r.shouldDisplayButton({status:s.testStatus,completed_by:s.completedBy})]])]),b(t("div",Le,[s.measures.length!==0?(u(),d("div",Ue,[r.hasDropdownMeasures?(u(),d("div",Fe,[(u(!0),d(x,null,k(r.dropDownMeasures,(o,_)=>(u(),d("div",{key:_},[t("div",null,[t("p",{class:"font-medium",id:`measure-mapping-id:${o.id}`},l(o.name),9,ze),p(B,{items:o.ranges,modelValue:o.value,"onUpdate:modelValue":f=>o.value=f},null,8,["items","modelValue","onUpdate:modelValue"])])]))),128))])):g("",!0),r.hasTextInputMeasures?(u(),d("div",He,[(u(!0),d(x,null,k(r.textInputMeasures,(o,_)=>(u(),d("div",{key:_},[o.type==="numeric"||o.type==="free_text"?(u(),d("div",$e,[o.name.toLowerCase().includes("date")?(u(),d("div",{key:1,id:`measure-mapping-id:${o.id}`},[t("p",We,l(o.name),1),p(j,{label:o.name,"input-class-name":"datepicker",placeholder:"dd/MM/yyyy",modelValue:o.value.name,"onUpdate:modelValue":f=>o.value.name=f,"text-input":"",format:"dd/MM/yyyy","min-date":new Date},null,8,["label","modelValue","onUpdate:modelValue","min-date"])],8,Ge)):(u(),Y(q,{key:0,type:o.name.toLowerCase().includes("comment")?"textarea":"text",label:o.name,modelValue:o.value.name,"onUpdate:modelValue":f=>o.value.name=f,help:`${r.measureReference(o.ranges)} ${o.unit}`,id:`measure-mapping-id:${o.id}`},null,8,["type","label","modelValue","onUpdate:modelValue","help","id"]))])):g("",!0)]))),128))])):g("",!0),r.hasRichTextMeasures?(u(),d("div",Ke,[(u(!0),d(x,null,k(r.richTextEditorMeasures,(o,_)=>(u(),d("div",{key:_},[t("div",{id:`measure-mapping-id:${o.id}`},[t("p",Je,l(o.name),1),p(R,{theme:"snow",class:"editor",content:o.value.name,"onUpdate:content":f=>o.value.name=f,contentType:"html"},null,8,["content","onUpdate:content"])],8,Ze)]))),128))])):g("",!0)])):g("",!0),t("div",Qe,[e[22]||(e[22]=t("p",{class:"font-medium mb-2"},"Remarks",-1)),p(R,{theme:"snow",class:"editor",content:s.remarks,"onUpdate:content":e[0]||(e[0]=o=>s.remarks=o),contentType:"html"},null,8,["content"])]),s.testStatus.toLowerCase()!=="verified"?(u(),Y(m,{key:1,loading:s.updating,text:"Update Test Results",color:"success",icon:s.arrowDownIcon,click:()=>r.updateTestResults(),class:"mt-5"},null,8,["loading","icon","click"])):g("",!0)],512),[[w,!s.loading]]),p(I,{loading:s.loading},null,8,["loading"])])])])}const bt=N(re,[["render",Xe]]);export{bt as default};
