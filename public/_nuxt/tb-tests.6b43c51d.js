import{_ as J}from"./Breadcrumb.vue.3bde75e9.js";import{m as z,u as G,x as R,a as H,I as D,g as j,o as a,c as n,d as m,l as t,e,t as _,J as I,i as C,z as K,h as Q,F as y,r as g,k as O,w as W,v as X,b as Y,f as Z}from"./entry.2f1e42b9.js";import{_ as ee}from"./index.3af38b3d.js";import{_ as te}from"./ExportButton.vue.6afb767c.js";import{_ as se}from"./Address.vue.e595c733.js";import{_ as oe}from"./Loader.0e328f2b.js";import{e as re}from"./constants.9f05ed5b.js";import{_ as ae}from"./report.664e75a0.js";import{_ as ne}from"./logo.54161c10.js";import{_ as le}from"./page.2ee9405c.js";import{h as T,e as ce,f as ie}from"./fetch.f66c8189.js";import{u as de}from"./facility.b394e227.js";import{P as ue}from"./package.bb5fb76c.js";import{r as pe}from"./FunnelIcon.887c14ea.js";import{r as me}from"./ArrowPathIcon.36a4b291.js";import"./nuxt-link.12fc21ba.js";import"./HomeIcon.04b2f4b8.js";import"./jspdf.es.min.c7b75303.js";import"./XMarkIcon.a6ae467b.js";import"./PrinterIcon.d705e3fe.js";import"./transition.0eb804de.js";import"./hidden.f2d50dc5.js";import"./PencilSquareIcon.6c44b9c5.js";const _e={class:"px-5 py-5"},fe=e("img",{src:ae,alt:"report-icon",class:"w-8 h-8 mr-2"},null,-1),he={class:"flex justify-between items-center"},ye={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},be={class:"w-72 ml-2"},xe={class:"w-48"},ge={class:"flex items-center space-x-3"},ve={key:0,class:"border rounded mt-10",id:"print-container"},ke={class:"flex items-center justify-between px-5 py-5 border-b"},we=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ne,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," TB TESTS REPORT ")],-1),Re={class:"m-3"},Te={class:"text-lg font-semibold mb-2"},$e={class:"text-normal font-normal"},Ee={class:"overflow-x-auto"},De={class:"w-full rounded overflow-x-auto border-t"},Oe={class:"w-full border-b"},Ye=["colspan"],Ce={class:"bg-gray-50"},Me=e("th",{class:"px-2 py-2 border-r uppercase"},"Result",-1),je={class:"px-2 py-2 border-r capitalize"},Se={class:"bg-gray-50"},Be=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"},"Total Examined",-1),Ae={key:0,class:"border-t bg-gray-100"},Pe=e("td",{class:"px-2 py-2 border-r font-semibold uppercase"},"Pick Up Rate",-1),Ve={class:"w-full items-center flex flex-col space-y-2 my-10"},Le=e("p",null,[C("Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),Ne={key:1,class:"w-full flex flex-col items-center justify-center space-y-2 py-10"},Fe=e("img",{src:le,alt:"page-icon",class:"object-cover w-20 h-20"},null,-1),Ue=e("p",null,"Data not found, please generate report",-1),qe=[Fe,Ue],Je="TB Report",ft=z({__name:"tb-tests",setup(ze){G({title:`${ue.name.toUpperCase()} - TB Tests Reports`});const S=R([{name:"Home",link:"/home"},{name:"Reports",link:"#"},{name:"Aggregate Reports",link:"#"}]),f=R([]),h=R(!1),c=R({months:new Array,data:new Array}),$=de(),B=H("token"),A=()=>{f.value=new Array("","")},P=(l,s)=>{let o=0;return s[Object.keys(s)[0]].forEach(r=>{o+=r.month[l]?r.month[l]:0}),o},M=l=>l.sort((s,o)=>{const r=["January","February","March","April","May","June","July","August","September","October","November","December"];return r.indexOf(s)-r.indexOf(o)}),V=D(()=>{const l=[];return c.value.data.length>0&&c.value.data.forEach(s=>{Object.keys(s).forEach(o=>{s[o].forEach(r=>{const u={TEST:o,RESULT:r.result,...M(Object.keys(r.month)).reduce((i,w)=>{const v=r.month[w];return i[w.toUpperCase()]=v??0,i},{})};l.push(u)})})}),l}),L=(l,s)=>{let o=1,r=1;Object.keys(s)[0].toString().toLowerCase().includes("+")&&s[Object.keys(s)[0]].forEach(i=>{r+=i.month[l]?i.month[l]:0});let u=0;return s[Object.keys(s)[0]].forEach(i=>{u+=i.month[l]?i.month[l]:0}),u>0?o=r/u*100:o=0,Math.floor(o)},b=D(()=>f.value[0]?T(f.value[0]).format("YYYY-MM-DD"):""),x=D(()=>f.value[1]?T(f.value[1]).format("YYYY-MM-DD"):"");async function N(){h.value=!0;let l=`from=${b.value}&to=${x.value}`;const s={route:`${ce.aggregateReports}tb_tests?${l}`,method:"GET",token:`${B.value}`},{data:o,error:r,pending:u}=await ie(s);h.value=u,o.value&&(h.value=!1,c.value=o.value,o.value.data.length>0?Y().$toast.success("Report data generated successfully"):Y().$toast.warning(`No data found in period ${b.value} - ${x.value}`)),r.value&&(h.value=!1,console.error(r.value),Y().$toast.success(re))}return(l,s)=>{const o=J,r=j("datepicker"),u=Z,i=ee,w=te,v=j("excel"),F=se,U=oe;return a(),n("div",_e,[m(o,{pages:t(S)},null,8,["pages"]),e("div",{class:"flex items-center py-5"},[fe,e("h3",{class:"text-2xl font-semibold uppercase"},_(Je))]),e("div",he,[e("form",{onSubmit:s[1]||(s[1]=I(p=>N(),["prevent"])),class:"w-full flex items-center space-x-3"},[e("div",ye,[m(t(pe),{class:"w-5 h-5 mr-2"}),C(" Filter By Date Range "),e("div",be,[m(r,{onCleared:A,required:"",position:"left",placeholder:"select start & end date",range:!0,"input-class-name":"datepicker",modelValue:t(f),"onUpdate:modelValue":s[0]||(s[0]=p=>K(f)?f.value=p:null),format:"dd/MM/yyyy"},null,8,["modelValue"])])]),e("div",xe,[m(u,{type:"submit",color:"primary",text:"Generate Report",icon:t(me),click:()=>{},loading:t(h)},null,8,["icon","loading"])])],32),e("div",ge,[m(i,{printSmallLabel:!1}),m(v,{class:"btn btn-default",header:[`TB TESTS LABORATORY REPORT ${t(b)} - ${t(x)}`,t($).details.name,t($).details.address,t($).details.phone],data:t(V),worksheet:"report-work-sheet",name:`tb_tests_report_from_${t(b)}_to_${t(x)}.xls`},{default:Q(()=>[m(w,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),t(c).data.length>0?(a(),n("div",ve,[e("div",ke,[we,m(F)]),e("div",Re,[e("h3",Te,[C("Tests Performed Period: "),e("span",$e,_(t(b)!=""?t(T)(t(b)).format("DD/MM/YYYY"):"")+" - "+_(t(x)!=""?t(T)(t(x)).format("DD/MM/YYYY"):""),1)])]),e("div",Ee,[e("table",De,[(a(!0),n(y,null,g(t(c).data,(p,q)=>(a(),n(y,{key:q},[e("thead",Oe,[e("tr",null,[e("th",{colspan:t(c).months.length+1,class:"uppercase bg-gray-100 text-center py-2 border-b"},_(Object.keys(p)[0]),9,Ye)]),e("tr",Ce,[Me,(a(!0),n(y,null,g(t(c).months,(d,k)=>(a(),n("th",{class:"px-2 py-2 border-r",key:k},_(d),1))),128))])]),e("tbody",null,[(a(!0),n(y,null,g(p[Object.keys(p)[0]],(d,k)=>(a(),n("tr",{class:"border-b",key:k},[e("td",je,_(d.result),1),(a(!0),n(y,null,g(t(c).months,E=>(a(),n("td",{key:E,class:"px-2 py-2 border-r"},_(d.month[E]>0?d.month[E]:0),1))),128))]))),128)),e("tr",Se,[Be,(a(!0),n(y,null,g(M(t(c).months),d=>(a(),n("td",{key:d,class:"px-2 py-2 border-r"},_(P(d,p)),1))),128))]),Object.keys(p)[0].toLowerCase()=="smear microscopy result"?(a(),n("tr",Ae,[Pe,(a(!0),n(y,null,g(t(c).months,(d,k)=>(a(),n("td",{key:k,class:"px-2 py-2 border-r"},_(L(d,p))+"% ",1))),128))])):O("",!0)])],64))),128))])])])):O("",!0),W(e("div",Ve,[m(U),Le],512),[[X,t(h)]]),t(c).data.length==0&&!t(h)?(a(),n("div",Ne,qe)):O("",!0)])}}});export{ft as default};
