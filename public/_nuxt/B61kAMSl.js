var w=Object.defineProperty;var x=(o,e,s)=>e in o?w(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var m=(o,e,s)=>x(o,typeof e!="symbol"?e+"":e,s);import{W as y,u as b,a as k}from"./CFJLM_Ie.js";import{H as E}from"./D72LMua3.js";class H{constructor(e){m(this,"RESOURCE","auth/login");this.httpFactory=e}async login(e){const s={route:this.RESOURCE,method:"POST",body:e};return this.httpFactory.call(s)}}const L=y("lastRoute",{state:()=>({route:"/home"}),actions:{lastKnownRoute(o){this.route=o}},persist:{storage:sessionStorage}}),F=y("auth",{state:()=>({authenticated:!1,loading:!1,user:{},department:"",locations:[],selectedLocation:""}),actions:{async authenticateUser({username:o,password:e,department:s}){var r,l,c,h,p,g;let S=new H(new E);const R={username:o,password:e,department:s},{$toast:n,$router:a}=b(),{data:t,error:u,pending:z}=await S.login(R);if(this.loading=z,u.value&&n.error(u.value.data.error),t.value){let i=new Date((r=t==null?void 0:t.value)==null?void 0:r.authorization.expiry_time);i.setHours(i.getHours());const v=k("token",{expires:i}),{route:f}=L();if(v.value=(l=t==null?void 0:t.value)==null?void 0:l.authorization.token,v.value!=null){this.authenticated=!0,this.user=(c=t==null?void 0:t.value)==null?void 0:c.authorization.user,this.department=s,this.locations=(h=t==null?void 0:t.value)==null?void 0:h.authorization.user.lab_locations;const d=((p=t==null?void 0:t.value)==null?void 0:p.authorization.user.lab_locations.length)>1;n.success(`Logged in as ${o}`),d?a.push("/locations"):(this.selectedLocation=(g=t==null?void 0:t.value)==null?void 0:g.authorization.user.lab_locations[0].name,f==""?a.push("/home"):a.push(f))}}}},persist:{storage:sessionStorage}});export{L as a,F as u};
