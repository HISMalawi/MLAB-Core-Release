import{a as C,b,_ as I,g as p,o as x,c as T,d as r,h as u,e as m,i as D,q,k as z,f as F}from"./entry.4b929376.js";import{h as L,E as R}from"./jspdf.es.min.0b304b7c.js";import{a as A,e as y,f as k}from"./fetch.1369e709.js";import{r as U}from"./XMarkIcon.c98b586b.js";import{r as w}from"./PrinterIcon.2b70bb81.js";import{S as V,h as N,U as O,G as B,V as $}from"./transition.ccd39ec1.js";const j={components:{TransitionRoot:V,TransitionChild:N,Dialog:O,DialogPanel:B,DialogTitle:$,XMarkIcon:U,ExclamationTriangleIcon:A,PrinterIcon:w},props:{id:{type:String},orderId:{type:String},printSmallLabel:{required:!1,type:Boolean,default:!1},tests:{type:Array,required:!1}},data(){return{show:!1,printIcon:w,cookie:C("token"),printers:new Array,selectedPrinter:"",loading:!1,zebraPrinting:!1}},methods:{async init(){this.handleClick();const l={route:y.printers,method:"GET",token:`${this.cookie}`},{data:e,error:n,pending:o}=await k(l);e.value&&(this.printers=new Array,e.value.map(t=>{this.printers.push(t.name)})),n.value&&console.error(n.value)},async toPrintSmallLabel(){this.zebraPrinting=!0;const l={route:y.printOutZebra,method:"POST",token:`${this.cookie}`,body:{order_id:this.orderId,tests:this.tests}},{data:e,error:n,pending:o}=await k(l);if(this.zebraPrinting=o,e.value){this.zebraPrinting=!1;const t=new FileReader;t.onload=()=>{const i=URL.createObjectURL(e.value),a=document.createElement("a");a.href=i,a.setAttribute("download",`${Date.now()}.lbl`),a.click(),URL.revokeObjectURL(i)},t.readAsText(e.value)}n.value&&(this.zebraPrinting=!1,console.error(n.value))},containsWords(l,...e){for(let n=0;n<e.length;n++)if(l.cssText.includes(e[n]))return!0;return!1},async generatePDF(){this.loading=!0;const l=document.querySelector(".print-container"),e=await L(l,{scale:2.5,onclone:s=>{}}),n=e.toDataURL("image/png"),o=new R({orientation:"portrait",unit:"px",format:"a4",hotfixes:["px_scaling"]}),t=o.internal.pageSize.getHeight(),i=o.internal.pageSize.getWidth(),a=e.height*i/e.width;let c=0;const d=10;let h=d,f=!0;const g=(s=0)=>{c++,f||o.addPage(),o.addImage(n,"PNG",0,-s,i,a),h+=t-2*d,f=!1};for(;h<a+d;)g(h);for(let s=1;s<=c;s++)o.setPage(s),o.setFontSize(10),o.text(`Page ${s} of ${c}`,10,t-10,{align:"justify"});await(async s=>{const _=s.output("blob");await this.submitForm(_)})(o)},async submitForm(l){var c,d;let e=new FormData,n=new Array;n.push(Number(this.orderId)),e.append("pdf",l,`patient-name-${this.id}`),e.append("printer_name",this.selectedPrinter),e.append("order_ids",JSON.stringify(n));const o={route:y.printOut,method:"POST",token:`${this.cookie}`,body:e},{data:t,error:i,pending:a}=await k(o);this.loading=a,t.value&&(t.value.printed?b().$toast.success("Patient report printed successfully!"):b().$toast.warning("Could not print patient report!"),this.loading=!1,this.$emit("update",!0),((c=this.$route.query.printer)==null?void 0:c.toString())=="true"&&this.$router.back(),this.handleClick()),i.value&&(this.loading=!1,console.error(i.value),b().$toast.error("An error occurred while printing patient report"),this.handleClick(),((d=this.$route.query.printer)==null?void 0:d.toString())=="true"&&this.$router.push("/tests"))},handleClick(){this.show=!this.show}}},E=m("div",{class:"fixed inset-0 bg-black bg-opacity-25"},null,-1),G={class:"fixed inset-0 overflow-y-auto"},H={class:"flex top-0 items-center justify-center p-4 text-center"},M={class:"border-b px-3 py-3 flex items-center justify-between"},W={class:"py-5 px-5"},X={class:"mt-4 justify-end flex items-center space-x-3 px-3 py-2 border-t"};function K(l,e,n,o,t,i){const a=F,c=p("TransitionChild"),d=p("PrinterIcon"),h=p("DialogTitle"),f=p("XMarkIcon"),g=p("FormKit"),v=p("DialogPanel"),s=p("Dialog"),_=p("TransitionRoot");return x(),T("div",null,[r(a,{click:i.init,color:"primary",text:"Print",icon:t.printIcon},null,8,["click","icon"]),r(_,{appear:"",show:t.show,as:"template"},{default:u(()=>[r(s,{as:"div",class:"relative z-10"},{default:u(()=>[r(c,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:u(()=>[E]),_:1}),m("div",G,[m("div",H,[r(c,{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:u(()=>[r(v,{class:"w-full max-w-3xl transform overflow-hidden rounded bg-white text-left align-middle shadow-xl transition-all"},{default:u(()=>[m("div",M,[r(h,{as:"h3",class:"text-lg flex items-center font-medium leading-6"},{default:u(()=>[r(d,{class:"h-5 w-5 mr-2"}),D(" Print ")]),_:1}),m("button",{onClick:e[0]||(e[0]=(...P)=>i.handleClick&&i.handleClick(...P))},[r(f,{class:"w-5 h-5"})])]),r(g,{type:"form","submit-label":"Update",onSubmit:i.generatePDF,actions:!1},{default:u(({value:P})=>[m("div",W,[r(g,{validation:"required",label:"Select a printer",type:"radio",modelValue:t.selectedPrinter,"onUpdate:modelValue":e[1]||(e[1]=S=>t.selectedPrinter=S),options:t.printers},null,8,["modelValue","options"])]),m("div",X,[n.printSmallLabel?(x(),q(a,{key:0,type:"button",loading:t.zebraPrinting,click:()=>{i.toPrintSmallLabel()},icon:t.printIcon,text:"Print Small Label",color:"primary"},null,8,["loading","click","icon"])):z("",!0),r(a,{click:()=>{},loading:t.loading,type:"submit",icon:t.printIcon,text:"Print",color:"success"},null,8,["loading","icon"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"])])}const ne=I(j,[["render",K]]);export{ne as _};
