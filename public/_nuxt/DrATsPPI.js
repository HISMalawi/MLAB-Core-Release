import{d as Y,r as m,a as P,ak as L,a5 as K,c as F,C as u,w as z,o as Q,y as g,b as i,e as _,g as e,f as c,z as $,h as t,k as v,H,t as p,F as M,j as D,K as N,i as J,v as X,u as C,l as Z,m as ee,E as te,_ as oe,n as se}from"./BxD-h1LR.js";import{_ as ae}from"./BNhNOnHe.js";import{_ as re}from"./Cs7plFji.js";import{_ as ne}from"./B4cMvEBz.js";import{_ as le}from"./CQcCm1L6.js";import{u as ce}from"./DRcUz5ts.js";import{s as de}from"./Qw5I_VYr.js";import{r as ue}from"./BkJfYQCG.js";import{r as ie}from"./CQe3LSWs.js";const _e={class:"w-full flex items-center justify-between mb-10"},me={class:"flex items-center space-x-5"},pe={class:"bg-gray-100 pl-2.5 rounded flex items-center text-zinc-500"},ye={class:"w-56 ml-2"},fe={class:"w-48"},he={class:"rounded border"},ve={class:"rounded-tr rounded-tl border-b px-5 py-5 flex items-center justify-between"},xe=e("div",{class:"flex flex-col space-y-2"},[e("img",{src:ne,alt:"app-logo",class:"w-24 h-24 object-cover"}),e("h3",{class:"text-xl font-semibold"}," CULTURE & SENSITIVITY WARDS COUNTS REPORT ")],-1),be={class:"px-4 mt-2 font-medium"},we={class:"font-normal"},Re={key:0,id:"print-container"},ge={class:"w-full mt-3",ref:"table"},Ce={class:"w-full border-b border-t bg-gray-50 rounded-t"},ke={class:"w-full"},Ee={class:"px-2 py-2 border-r"},Te={class:"px-2 py-2 border-r"},Se={class:"px-2 py-2 border-r"},Fe=["onClick"],$e={class:"w-full items-center flex flex-col space-y-2 my-10"},Me=e("p",{class:"text-base"},[v(" Generating report, please wait"),e("span",{class:"animate-pulse"},"...")],-1),De={key:1,class:"flex flex-col space-y-3 items-center justify-center py-10"},Ne=e("img",{src:le,class:"w-20 h-20 object-cover",alt:"page-icon"},null,-1),qe=e("p",{class:"text-base"},[v(" Please generate report data to preview the "),e("span",{class:"font-medium"},"General Counts"),v(" report. ")],-1),Ue=[Ne,qe],Ke=Y({__name:"wards-counts",setup(Ie){const o=m("");m("");const k=m([{name:"Ward Name"},{name:"Ward Type"},{name:"Period"},{name:"Total Count"}]),q=P("token"),U=m(""),l=m(!1),y=m([]),f=L(),x=K(),w=ce(),I=()=>{o.value=""},V=F(()=>k.value.flatMap(r=>y.value.map(s=>({WARD:s.ward,ENCOUNTER:s.encounter,"DATE PERIOD":u(o.value).format("MMMM-yyyy"),COUNT:s.count})))),A=(r,s,n)=>{de({test:r,type:"General Counts",count:s,associated_ids:n,date_filter:u(o.value).format("YYYY-MM-DD")},C())};async function E(){l.value=!0;let r=o.value?u(o.value).format("M"):"",s=o.value?u(o.value).format("yyyy"):"";const n={route:`${Z.aggregateReports}culture/wards_based_counts?year=${s}&month=${r}&report_id=${f.query.report_id}`,method:"GET",token:`${q.value}`},{data:d,error:b,pending:R}=await ee(n);l.value=R,d.value&&(y.value=d.value.data,l.value=!1,O(d.value.report_id),C().$toast.success("Report data generated successfully")),b.value&&(console.error(b.value),l.value=!1,C().$toast.error(te))}const O=r=>{U.value=r;const n={...x.currentRoute.value.query,report_id:r};x.replace({query:n}).catch(d=>{console.error("Failed to replace route:",d)})};z(o,()=>{if(o){const s={...x.currentRoute.value.query,dateFrom:u(o.value).format("M/yyyy")};x.replace({query:s}).catch(n=>{console.error("Failed to replace route:",n)})}},{deep:!0});const B=F(()=>f.query.dateFrom!==void 0&&f.query.dateFrom!=="");return Q(()=>{B.value&&E()}),(r,s)=>{var T;const n=g("datepicker"),d=oe,b=g("FormKit"),R=ae,j=g("excel"),G=re,W=se;return i(),_("div",null,[e("div",_e,[c(b,{type:"form","submit-label":"Update",onSubmit:E,actions:!1},{default:$(({value:a})=>[e("div",me,[e("div",pe,[c(t(ue),{class:"w-5 h-5 mr-2"}),v(" Filter By Date Range "),e("div",ye,[c(n,{onCleared:I,required:"",position:"left",placeholder:"select month & year",range:!1,"input-class-name":"datepicker",modelValue:t(o),"onUpdate:modelValue":s[0]||(s[0]=h=>H(o)?o.value=h:null),format:"M/yyyy"},null,8,["modelValue"])])]),e("div",fe,[c(d,{type:"submit",color:"primary",text:"Generate Report",icon:t(ie),click:()=>{},loading:t(l)},null,8,["icon","loading"])])])]),_:1}),e("div",null,[c(j,{class:"btn btn-default",header:[`CULTURE & SENSITIVITY WARDS COUNTS REPORT ${t(u)(t(o)).format("M/yyyy")}`,t(w).details.name,t(w).details.address,t(w).details.phone],data:t(V),worksheet:"report-work-sheet",name:`culture_sensitivity_wards_counts_report_${t(u)(t(o)).format("M_yyyy")}.xls`},{default:$(()=>[c(R,{text:"Export Excel"})]),_:1},8,["header","data","name"])])]),e("div",he,[e("div",ve,[xe,c(G)]),e("div",null,[e("h3",be,[v(" Data for period: "),e("span",we,p((T=t(f).query.dateFrom)==null?void 0:T.toString()),1)])]),t(y).length>0&&!t(l)?(i(),_("div",Re,[e("table",ge,[e("thead",Ce,[e("tr",ke,[(i(!0),_(M,null,D(t(k),(a,h)=>(i(),_("th",{class:"px-2 py-2 border-r uppercase",key:h},p(a.name),1))),128))])]),e("tbody",null,[(i(!0),_(M,null,D(t(y),(a,h)=>{var S;return i(),_("tr",{key:h,class:"border-b border-l border-r"},[e("td",Ee,p(a.ward),1),e("td",Te,p(a.encounter),1),e("td",Se,p((S=t(f).query.dateFrom)==null?void 0:S.toString()),1),e("td",{class:"px-2 py-2 hover:font-medium cursor-pointer hover:text-sky-500 hover:underline transition duration-150",onClick:Ve=>A(`Ward Based Counts - ${a.ward}, ${a.encounter}`,a.count,a.associated_ids)},p(a.count),9,Fe)])}),128))])],512)])):N("",!0),J(e("div",$e,[c(W),Me],512),[[X,t(l)]]),t(y).length==0&&!t(l)?(i(),_("div",De,Ue)):N("",!0)])])}}});export{Ke as default};
