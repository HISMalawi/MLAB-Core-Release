"use strict";(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[8377],{31588:(e,a,t)=>{t.d(a,{J8:()=>m,Jj:()=>r,bB:()=>c,m8:()=>s,ti:()=>o,yg:()=>i});var n=t(52110);const l=[n.Am,[["","Delete"]]],i=[n.aD,[["Delete"]]],o=(n.aD,[n.aD,[["N/A"],["Delete","Unknown"]]]),r=[n.aD,[["Delete"]]],u=[n.aD,[["Unknown","Delete"],["Qwerty","A-Z"]]],s=[n.uY,[["Unknown"]]],d=[n.ZY,[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],m=[n.lJ,[["","Delete"],["?123","0-9"],["Space","Unknown"]]],c=[{btn:"0-9",keyboard:u},{btn:"?123",keyboard:l},{btn:"A-Z",keyboard:d},{btn:"Qwerty",keyboard:m}]},15291:(e,a,t)=>{t.d(a,{I6:()=>i,LE:()=>E});t(74423),t(44114),t(72712),t(27495),t(98992),t(23215),t(8872);var n=t(77270);const l=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];var i,o=t(71035),r=t(1590),u=t(52110),s=t(31588),d=t(74353),m=t.n(d),c=t(9450);function p(e,a,t=!0){const l=[];return t&&l.push("UNKNOWN"),{id:e,helpText:`${a} Year`,appearInSummary:()=>!1,type:n.P.TT_TEXT,config:{customKeyboard:[u.aD,[l,["DELETE"]]]}}}function v(e,a){return{id:e,helpText:`${a} Month`,appearInSummary:()=>!1,type:n.P.TT_SELECT,options:()=>l}}function f(e,a){return{id:e,helpText:`${a} Day`,type:n.P.TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function T(e,a){return{id:e,helpText:`${a} Estimated period`,type:n.P.TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function _(e,a){return{id:e,helpText:`${a} Age Estimate`,type:n.P.TT_NUMBER,appearInSummary:()=>!1,config:{keypad:s.Jj}}}function h(e){return parseInt(e)<10?`0${e}`:e}async function b(e,a,t){if(a.defaultValue){const n=await a.defaultValue(e);if(n){const[e,a,l]=n.split("-");switch(t){case"Year":return e||"";case"Month":return parseInt(a)||"";case"Day":return parseInt(l)||""}}}return""}function y(e){return o.A.toStandardHisDisplayFormat(e)}function D(e,a,t,n){if(a.minDate){const l=a.minDate(t,n);if(new Date(e)<new Date(l))return[`${y(e)} is less than minimum date of ${y(l)}`]}if(a.maxDate){const l=a.maxDate(t,n);if(l&&new Date(e)>new Date(l))return[`${y(e)} is greater than max date of  ${y(l)}`]}}function x(e){return e%4===0&&e%100!==0||e%400===0}function $(e,a,t){return 2===a&&29===t?x(e)?29:28:t}function E(e,a=""){let t="",n="",u="",s="",d=!1;const x=`year_${e.id}`,E=`month_${e.id}`,w=`day_${e.id}`,k=`age_estimate_${e.id}`,g=`duration_estimate_${e.id}`,A=p(x,e.helpText,e.estimation.allowUnknown),I=v(E,e.helpText),N=f(w,e.helpText),S=_(k,e.helpText),M=T(g,e.helpText),V="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,U=a=>!(a[x]&&a[x].value&&["Unknown"].includes(a[x].value))&&(!e.condition||e.condition(a)),L=(e,a)=>{const t=[{type:"year",value:n,default:"YYYY"},{type:"month",value:u,default:"MM"},{type:"day",value:s,default:"DD"}];return t.reduce(((t,n)=>{const l=[null,void 0,"Unknown",""];return a===n.type?l.includes(e)?t.push(n.default):t.push(e):l.includes(n.value)?t.push(n.default):t.push(n.value),t}),[]).join("-")};"function"===typeof e.init&&(A.init=e.init),A.updateHelpTextOnValue=e=>`${A.helpText} (${L(null===e||void 0===e?void 0:e.label,"year")})`,A.proxyID=e.id,A.unload=e=>n=e.value.toString(),A.config={...A.config,...e.config},A.defaultValue=a=>b(a,e,"Year"),A.condition=a=>!e.condition||e.condition(a),A.validation=(a,t,n)=>{if(e.required&&r.A.required(a))return["Year cannot be empty"];const l=a?a.value:"";if(!e.estimation.allowUnknown&&l.toString().match(/unknown/i))return["Value unknown is not permitted"];if(l&&!["Unknown"].includes(l)&&isNaN(l)||Number(l)<1900)return["Invalid Year"];if(l&&"function"===typeof e.minDate){const a=o.A.getYear(e.minDate(t,n));if(parseInt(l)<a)return[`Year of ${l} is less than Minimum year of ${a}`]}if(l&&"function"===typeof e.maxDate){const a=e.maxDate(t,n);if(a&&Number(l)>o.A.getYear(a))return[`Year of ${l} exceeds Maximum year of ${o.A.getYear(a)}`]}return null},A.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:t?y(t):"Unknown"}),A.appearInSummary=(a,t)=>t===e.id,A.computedValue=a=>{if(t){const[n,l,i]=t.split("-");return t=`${a.value}-${l}-${i}`,e.computeValue(t,!1)}if(a&&"Unknown"===a.value)return t="",e.computeValue("Unknown",!1)},I.updateHelpTextOnValue=e=>`${I.helpText} (${L(null===e||void 0===e?void 0:e.label,"month")})`,I.proxyID=e.id,I.unload=e=>u=h(e.value.toString()),I.condition=e=>U(e),I.validation=e=>r.A.required(e),I.defaultValue=a=>b(a,e,"Month"),V&&(I.options=()=>[...l,{label:"Unknown",value:"Unknown"}]),I.computedValue=(a,n)=>{if(`${a.value}`.match(/unknown/i)){const a=n[x].value,l=m()().format("MM"),i=$(a,Number(l),Number(m()().format("DD")));return t=`${a}-${l}-${i}`,e.computeValue(t,!0)}if(t){const[n,l,i]=t.split("-"),o=h(`${a.value}`);return t=`${n}-${o}-${i}`,e.computeValue(t,!1)}},N.proxyID=e.id,N.updateHelpTextOnValue=e=>`${N.helpText} (${L(null===e||void 0===e?void 0:e.label,"day")})`,N.condition=e=>!`${e[E].value}`.match(/unknown/i)&&U(e),N.validation=(a,l,i)=>r.A.required(a)?["Day is required for date"]:(d=!!`${a.value}`.match(/unknown/i),s=d?"15":h(`${a.value}`),t=`${n}-${u}-${s}`,D(t,e,l,i)),N.defaultValue=a=>b(a,e,"Day"),N.computedValue=()=>e.computeValue(t,d),N.unload=(a,t,n,l)=>{e.unload&&e.unload(a,t,n,l)},N.beforeNext=(a,n)=>!e.beforeNext||e.beforeNext(t,n),N.config={year:e=>e[x].value,month:e=>e[E].value},V||(N.config.keyboardActions=[]);const F=(a,t)=>{const n=["Unknown"===a[x].value,!e.condition||e.condition(a),e.estimation.estimationFieldType===t];return n.every(Boolean)};return S.proxyID=e.id,S.validation=(a,n,l)=>{if(!a)return["Age estimate is required"];const i=/^(12[0-7]|1[01][0-9]|[1-9]?[0-9])$/;if(!`${null===a||void 0===a?void 0:a.value}`.match(i))return["Not a valid age estimate"];const o=parseInt(`${(null===a||void 0===a?void 0:a.value)||-1}`);if(o<0)return["Please enter a valid number"];if(o>300)return["Age estimate is too high and exceeding hard limit of 300"];const r=m()(c.kl.getSessionDate()).subtract(o,"years").year(),u=m()().format("MM"),s=$(r,Number(u),Number(m()().format("DD")));return t=`${r}-${u}-${s}`,D(t,e,n,l)},S.condition=e=>F(e,i.AGE_ESTIMATE_FIELD),S.computedValue=()=>e.computeValue(t,!0),S.beforeNext=(a,n)=>!e.beforeNext||e.beforeNext(t,n),M.proxyID=e.id,M.validation=(a,n,l)=>r.A.required(a)?["Please select an estimate"]:(t=m()(c.kl.getSessionDate()).subtract(a.value,"day").format(o.l),D(t,e,n,l)),M.condition=e=>F(e,i.MONTH_ESTIMATE_FIELD),M.computedValue=()=>e.computeValue(t,!0),M.beforeNext=(a,n)=>!e.beforeNext||e.beforeNext(t,n),[A,I,N,S,M]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field"})(i||(i={}))},88049:(e,a,t)=>{t.d(a,{T:()=>n});t(72712),t(98992),t(54520),t(8872);function n(e,a){const t=Object.values(Object.values(e)),n=t.filter((e=>!!e[a])).reduce(((e,t)=>(Array.isArray(t[a])?e[a]=t[a]:e[a]={...e[a],...t[a]},e)),{});return n}},38377:(e,a,t)=>{t.r(a),t.d(a,{default:()=>_});t(44114),t(81454);var n=t(20641),l=t(1590),i=t(25310),o=t(77270),r=t(741),u=t(85901),s=t(50953),d=t(2543),m=t(46079),c=t(71035),p=t(15291),v=t(88049);const f=(0,n.pM)({__name:"FindOrRegister",setup(e){const a=(0,r.Kj)(),t=(0,s.KR)(""),f=()=>({id:"first_name",helpText:"First name",type:o.P.TT_TEXT,computedValue:e=>({person:{first_name:e.value}}),options:async e=>{var t;if(null!==(t=e.first_name)&&void 0!==t&&t.value){var n;const t=await a.getJson("clients/search_by_name",{first_name:null===(n=e.first_name)||void 0===n?void 0:n.value});return null===t||void 0===t?void 0:t.data.map((e=>({label:e,value:e})))}return[]},validation:e=>l.A.isName(e)}),T=()=>({id:"last_name",helpText:"Last name",type:o.P.TT_TEXT,computedValue:e=>({person:{last_name:e.value}}),options:async e=>{var t;if(null!==(t=e.last_name)&&void 0!==t&&t.value){var n;const t=await a.getJson("clients/search_by_name",{last_name:null===(n=e.last_name)||void 0===n?void 0:n.value});return null===t||void 0===t?void 0:t.data.map((e=>({label:e,value:e})))}return[]},validation:e=>l.A.isName(e)}),_=()=>({id:"middle_name",helpText:"Middle name(Optional)",type:o.P.TT_TEXT,computedValue:e=>{if(e)return{person:{middle_name:e.value}}}}),h=()=>({id:"sex",helpText:"Gender",type:o.P.TT_SELECT,computedValue:e=>({person:{sex:e.value}}),validation:e=>l.A.required(e),options:()=>[{label:"Female",value:"F"},{label:"Male",value:"M"}]}),b=()=>{const e={id:"date_of_birth",summaryLabel:"Date of Birth",helpText:"Birth",required:!0,minDate:()=>c.A.estimateDateFromAge(100),maxDate:()=>c.A.sessionDate(),estimation:{allowUnknown:!0,allowUnknownMonthDay:!0,estimationFieldType:p.I6.AGE_ESTIMATE_FIELD},computeValue:(e,a)=>({person:{date_of_birth:e,birth_date_estimated:a}})};return(0,p.LE)(e)},y=()=>({id:"physical_address",helpText:"Physical address",type:o.P.TT_TEXT,computedValue:e=>({client_identifiers:{physical_address:e.value}}),validation:e=>l.A.required(e)}),D=()=>({id:"npid",helpText:"External Patient Number (Option)",type:o.P.TT_TEXT,computedValue:e=>{if(e)return{client_identifiers:{npid:(null===e||void 0===e?void 0:e.value)||""}}}}),x=()=>({id:"results",helpText:"Search results",type:o.P.TT_PERSON_RESULT_VIEW,dynamicHelpText:e=>`Search results for "${e.first_name.value} ${e.last_name.value} | ${e.sex.label}"`,options:async e=>{const t={first_name:e.first_name.value,last_name:e.last_name.value,gender:e.sex.value},n=await a.getJson("clients/search_dde",t);return null!==n&&void 0!==n&&n.ok?n.data.map((e=>({label:`${e.first_name} ${e.last_name} (${e.date_of_birth})`,value:e.client_id,other:{person:e,options:[{label:"First name",value:e.first_name},{label:"Middle name",value:e.middle_name},{label:"Last name",value:e.last_name},{label:"Sex",value:e.sex},{label:"Birthdate",value:e.date_of_birth},{label:"Is birth estimated?",value:e.birth_date_estimated?"Yes":"No"}]}}))):((0,u._O)("Unable to find client"),[])},config:{hiddenFooterBtns:["Clear","Next","Back","Finish"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{t.value="first_name"}},{name:"New Client",slot:"end",onClick:()=>{t.value="_NEXT_FIELD_"}},{name:"New Order",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(e,a){return(0,d.isEmpty)(a.results)}}},onClick:e=>m.A.push(`/order/${e.results.value}`)}]}}),$=[f(),_(),T(),h(),x(),...b(),y(),D()],E=(e,t)=>{a.postJson("clients",{client:{id:"",uuid:""},...(0,v.T)(t,"person"),...(0,v.T)(t,"client_identifiers")}).then((e=>{if(null!==e&&void 0!==e&&e.ok)return m.A.push(`/order/${e.data.client_id}`),(0,u.tP)("Client created");(0,u._O)((null===e||void 0===e?void 0:e.error)||"Unable to create")})).catch((()=>(0,u.L_)(r.MZ.GENERAL_ERROR)))};return(e,a)=>((0,n.uX)(),(0,n.Wv)(i.A,{fields:$,onFinish:E,skipSummary:!0,onOnIndex:a[0]||(a[0]=e=>t.value=""),activeField:t.value},null,8,["activeField"]))}}),T=f,_=T},81148:(e,a,t)=>{var n=t(46518),l=t(72652),i=t(79306),o=t(28551),r=t(1767);n({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),i(e);var a=r(this),t=0;return!l(a,(function(a,n){if(!e(a,t++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},23215:(e,a,t)=>{t(81148)}}]);
//# sourceMappingURL=8377.f305b06d.js.map