"use strict";(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[8377],{31588:(e,t,a)=>{a.d(t,{J8:()=>c,Jj:()=>o,bB:()=>m,m8:()=>s,ti:()=>l,yg:()=>r});var n=a(52110);const i=[n.Am,[["","Delete"]]],r=[n.aD,[["Delete"]]],l=(n.aD,[n.aD,[["N/A"],["Delete","Unknown"]]]),o=[n.aD,[["Delete"]]],u=[n.aD,[["Unknown","Delete"],["Qwerty","A-Z"]]],s=[n.uY,[["Unknown"]]],d=[n.ZY,[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],c=[n.lJ,[["","Delete"],["?123","0-9"],["Space","Unknown"]]],m=[{btn:"0-9",keyboard:u},{btn:"?123",keyboard:i},{btn:"A-Z",keyboard:d},{btn:"Qwerty",keyboard:c}]},15291:(e,t,a)=>{a.d(t,{I6:()=>r,LE:()=>k});a(16280),a(74423),a(44114),a(72712),a(27495),a(98992),a(23215),a(8872);var n=a(77270);const i=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];var r,l=a(71035),o=a(1590),u=a(52110),s=a(31588),d=a(74353),c=a.n(d),m=a(9450);function p(e,t,a=!0){const i=[];return a&&i.push("UNKNOWN"),{id:e,helpText:`${t} Year`,appearInSummary:()=>!1,type:n.P.TT_TEXT,config:{customKeyboard:[u.aD,[i,["DELETE"]]]}}}function v(e,t){return{id:e,helpText:`${t} Month`,appearInSummary:()=>!1,type:n.P.TT_SELECT,options:()=>i}}function _(e,t){return{id:e,helpText:`${t} Day`,type:n.P.TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function f(e){const{value:t,timeUnit:a}=e;if(t<0)throw new Error("Estimate value must be positive");const n=m.kl.getSessionDate();let i=c()(n);switch(a.toLowerCase()){case"hours":i=i.subtract(t,"hour");break;case"days":i=i.subtract(t,"day");break;case"weeks":i=i.subtract(t,"week");break;case"months":i=i.subtract(t,"month");break;case"years":i=i.subtract(t,"year");break;default:throw new Error(`Invalid time unit: ${a}`)}const r=i.year(),o=i.month()+1,u=i.date(),s=x(r,o,u);return s!==u&&(i=i.date(s)),i.format(l.l)}function h(e,t){return{id:e,helpText:`${t} Estimated period`,type:n.P.TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function b(e,t){return{id:e,helpText:`${t} Age Estimate`,type:n.P.TT_AGE_INPUT,appearInSummary:()=>!1,config:{keypad:s.Jj}}}function y(e){return parseInt(e)<10?`0${e}`:e}async function T(e,t,a){if(t.defaultValue){const n=await t.defaultValue(e);if(n){const[e,t,i]=n.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(i)||""}}}return""}function E(e){return l.A.toStandardHisDisplayFormat(e)}function D(e,t,a,n){if(t.minDate){const i=t.minDate(a,n);if(new Date(e)<new Date(i))return[`${E(e)} is less than minimum date of ${E(i)}`]}if(t.maxDate){const i=t.maxDate(a,n);if(i&&new Date(e)>new Date(i))return[`${E(e)} is greater than max date of  ${E(i)}`]}}function w(e){return e%4===0&&e%100!==0||e%400===0}function x(e,t,a){return 2===t&&29===a?w(e)?29:28:a}function k(e,t=""){let a="",n="",u="",s="",d=!1;const w=`year_${e.id}`,k=`month_${e.id}`,$=`day_${e.id}`,g=`age_estimate_${e.id}`,I=`duration_estimate_${e.id}`,A=p(w,e.helpText,e.estimation.allowUnknown),S=v(k,e.helpText),N=_($,e.helpText),M=b(g,e.helpText),V=h(I,e.helpText),U="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,L=t=>!(t[w]&&t[w].value&&["Unknown"].includes(t[w].value))&&(!e.condition||e.condition(t)),F=(e,t)=>{const a=[{type:"year",value:n,default:"YYYY"},{type:"month",value:u,default:"MM"},{type:"day",value:s,default:"DD"}];return a.reduce(((a,n)=>{const i=[null,void 0,"Unknown",""];return t===n.type?i.includes(e)?a.push(n.default):a.push(e):i.includes(n.value)?a.push(n.default):a.push(n.value),a}),[]).join("-")};"function"===typeof e.init&&(A.init=e.init),A.updateHelpTextOnValue=e=>`${A.helpText} (${F(null===e||void 0===e?void 0:e.label,"year")})`,A.proxyID=e.id,A.unload=e=>n=e.value.toString(),A.config={...A.config,...e.config},A.defaultValue=t=>T(t,e,"Year"),A.condition=t=>!e.condition||e.condition(t),A.validation=(t,a,n)=>{if(e.required&&o.A.required(t))return["Year cannot be empty"];const i=t?t.value:"";if(!e.estimation.allowUnknown&&i.toString().match(/unknown/i))return["Value unknown is not permitted"];if(i&&!["Unknown"].includes(i)&&isNaN(i)||Number(i)<1900)return["Invalid Year"];if(i&&"function"===typeof e.minDate){const t=l.A.getYear(e.minDate(a,n));if(parseInt(i)<t)return[`Year of ${i} is less than Minimum year of ${t}`]}if(i&&"function"===typeof e.maxDate){const t=e.maxDate(a,n);if(t&&Number(i)>l.A.getYear(t))return[`Year of ${i} exceeds Maximum year of ${l.A.getYear(t)}`]}return null},A.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?E(a):"Unknown"}),A.appearInSummary=(t,a)=>a===e.id,A.computedValue=t=>{if(a){const[n,i,r]=a.split("-");return a=`${t.value}-${i}-${r}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},S.updateHelpTextOnValue=e=>`${S.helpText} (${F(null===e||void 0===e?void 0:e.label,"month")})`,S.proxyID=e.id,S.unload=e=>u=y(e.value.toString()),S.condition=e=>L(e),S.validation=e=>o.A.required(e),S.defaultValue=t=>T(t,e,"Month"),U&&(S.options=()=>[...i,{label:"Unknown",value:"Unknown"}]),S.computedValue=(t,n)=>{if(`${t.value}`.match(/unknown/i)){const t=n[w].value,i=c()().format("MM"),r=x(t,Number(i),Number(c()().format("DD")));return a=`${t}-${i}-${r}`,e.computeValue(a,!0)}if(a){const[n,i,r]=a.split("-"),l=y(`${t.value}`);return a=`${n}-${l}-${r}`,e.computeValue(a,!1)}},N.proxyID=e.id,N.updateHelpTextOnValue=e=>`${N.helpText} (${F(null===e||void 0===e?void 0:e.label,"day")})`,N.condition=e=>!`${e[k].value}`.match(/unknown/i)&&L(e),N.validation=(t,i,r)=>o.A.required(t)?["Day is required for date"]:(d=!!`${t.value}`.match(/unknown/i),s=d?"15":y(`${t.value}`),a=`${n}-${u}-${s}`,D(a,e,i,r)),N.defaultValue=t=>T(t,e,"Day"),N.computedValue=()=>e.computeValue(a,d),N.unload=(t,a,n,i)=>{e.unload&&e.unload(t,a,n,i)},N.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),N.config={year:e=>e[w].value,month:e=>e[k].value},U||(N.config.keyboardActions=[]);const O=(t,a)=>{const n=["Unknown"===t[w].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return n.every(Boolean)};M.proxyID=e.id;return M.validation=(t,n,i)=>{var r,l;if(!t)return["Age estimate is required"];const o=null===t||void 0===t||null===(r=t.other)||void 0===r?void 0:r.value,u=null===t||void 0===t||null===(l=t.other)||void 0===l||null===(l=l.timeUnit)||void 0===l?void 0:l.toLowerCase();if(!o||!u)return["Invalid age estimate format"];const s=/^(0|[1-9]\d*)$/;if(!o.match(s))return["Not a valid number"];try{const t=parseInt(o);return a=f({value:t,timeUnit:u}),D(a,e,n,i)}catch(d){return[d.message]}},M.condition=e=>O(e,r.AGE_ESTIMATE_FIELD),M.computedValue=()=>e.computeValue(a,!0),M.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),V.proxyID=e.id,V.validation=(t,n,i)=>o.A.required(t)?["Please select an estimate"]:(a=c()(m.kl.getSessionDate()).subtract(t.value,"day").format(l.l),D(a,e,n,i)),V.condition=e=>O(e,r.MONTH_ESTIMATE_FIELD),V.computedValue=()=>e.computeValue(a,!0),V.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),[A,S,N,M,V]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field",e["WEEKS_ESTIAMATE_FIELD"]="weeks-period-estimate-field",e["DAY_ESTIMATE_FIELD"]="day-period-estimate-field",e["HOURS_ESTIMATE_FIELD"]="hours-period-estimate-field"})(r||(r={}))},88049:(e,t,a)=>{a.d(t,{T:()=>n});a(72712),a(98992),a(54520),a(8872);function n(e,t){const a=Object.values(Object.values(e)),n=a.filter((e=>!!e[t])).reduce(((e,a)=>(Array.isArray(a[t])?e[t]=a[t]:e[t]={...e[t],...a[t]},e)),{});return n}},38377:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});a(44114),a(81454);var n=a(20641),i=a(1590),r=a(25486),l=a(77270),o=a(741),u=a(85901),s=a(50953),d=a(2543),c=a(46079),m=a(71035),p=a(15291),v=a(88049);const _=(0,n.pM)({__name:"FindOrRegister",setup(e){const t=(0,o.Kj)(),a=(0,s.KR)(""),_=()=>({id:"first_name",helpText:"First name",type:l.P.TT_TEXT,computedValue:e=>({person:{first_name:e.value}}),options:async e=>{var a;if(null!==(a=e.first_name)&&void 0!==a&&a.value){var n;const a=await t.getJson("clients/search_by_name",{first_name:null===(n=e.first_name)||void 0===n?void 0:n.value});return null===a||void 0===a?void 0:a.data.map((e=>({label:e,value:e})))}return[]},validation:e=>i.A.isName(e)}),f=()=>({id:"last_name",helpText:"Last name",type:l.P.TT_TEXT,computedValue:e=>({person:{last_name:e.value}}),options:async e=>{var a;if(null!==(a=e.last_name)&&void 0!==a&&a.value){var n;const a=await t.getJson("clients/search_by_name",{last_name:null===(n=e.last_name)||void 0===n?void 0:n.value});return null===a||void 0===a?void 0:a.data.map((e=>({label:e,value:e})))}return[]},validation:e=>i.A.isName(e)}),h=()=>({id:"middle_name",helpText:"Middle name(Optional)",type:l.P.TT_TEXT,computedValue:e=>{if(e)return{person:{middle_name:e.value}}}}),b=()=>({id:"sex",helpText:"Gender",type:l.P.TT_SELECT,computedValue:e=>({person:{sex:e.value}}),validation:e=>i.A.required(e),options:()=>[{label:"Female",value:"F"},{label:"Male",value:"M"}]}),y=()=>{const e={id:"date_of_birth",summaryLabel:"Date of Birth",helpText:"Birth",required:!0,minDate:()=>m.A.estimateDateFromAge(100),maxDate:()=>m.A.sessionDate(),estimation:{allowUnknown:!0,allowUnknownMonthDay:!0,estimationFieldType:p.I6.AGE_ESTIMATE_FIELD},computeValue:(e,t)=>({person:{date_of_birth:e,birth_date_estimated:t}})};return(0,p.LE)(e)},T=()=>({id:"physical_address",helpText:"Physical address",type:l.P.TT_TEXT,computedValue:e=>({client_identifiers:{physical_address:e.value}}),validation:e=>i.A.required(e)}),E=()=>({id:"npid",helpText:"External Patient Number (Option)",type:l.P.TT_TEXT,computedValue:e=>{if(e)return{client_identifiers:{npid:(null===e||void 0===e?void 0:e.value)||""}}}}),D=()=>({id:"results",helpText:"Search results",type:l.P.TT_PERSON_RESULT_VIEW,dynamicHelpText:e=>`Search results for "${e.first_name.value} ${e.last_name.value} | ${e.sex.label}"`,options:async e=>{const a={first_name:e.first_name.value,last_name:e.last_name.value,gender:e.sex.value},n=await t.getJson("clients/search_dde",a);return null!==n&&void 0!==n&&n.ok?n.data.map(((e,t)=>{const a=!e.client_id;return{label:`${e.first_name} ${e.last_name} (${e.date_of_birth})`,value:a?t:e.client_id,isRemote:a,other:{person:e,options:[{label:"First name",value:e.first_name},{label:"Middle name",value:e.middle_name},{label:"Last name",value:e.last_name},{label:"Sex",value:e.sex},{label:"Birthdate",value:e.date_of_birth},{label:"Is birth estimated?",value:e.birth_date_estimated?"Yes":"No"},{label:"Source",value:a?"Remote (DDE)":"Local"}]}}})):((0,u._O)("Unable to find client"),[])},config:{hiddenFooterBtns:["Clear","Next","Back","Finish"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{a.value="first_name"}},{name:"New Client",slot:"end",onClick:()=>{a.value="_NEXT_FIELD_"}},{name:"New Order",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(e,t){return(0,d.isEmpty)(t.results)}}},onClick:async e=>{const t=e.results;if("remote"!==t.other.person.source)return c.A.push(`/order/${t.value}`);try{var a;const e=await x(t.other.person);if(null!==e&&void 0!==e&&null!==(a=e.data)&&void 0!==a&&a.client_id)return c.A.push(`/order/${e.data.client_id}`);console.log("Failed to register remote client")}catch(n){console.error("Error registering remote person:",n)}}}]}}),w=[_(),h(),f(),b(),D(),...y(),T(),E()],x=async e=>{try{const a=await t.postJson("clients",{client:{id:"",uuid:e.uuid},person:{first_name:e.first_name,middle_name:e.middle_name,last_name:e.last_name,sex:e.sex,date_of_birth:e.date_of_birth,birth_date_estimated:e.birth_date_estimated||!1},client_identifiers:{npid:e.npid||"",current_district:e.current_district||"",current_traditional_authority:e.current_traditional_authority||"",current_village:e.current_village||"",home_village:e.home_village||"",home_district:e.home_district||"",home_traditional_authority:e.home_traditional_authority||""}});if(null!==a&&void 0!==a&&a.ok)return a;{const e=(null===a||void 0===a?void 0:a.error)||"Failed to register client";return{ok:!1,error:e}}}catch(a){console.error("Error registering remote person:",a);const e="An error occurred while registering the client";return{ok:!1,error:e}}},k=(e,a)=>{t.postJson("clients",{client:{id:"",uuid:""},...(0,v.T)(a,"person"),...(0,v.T)(a,"client_identifiers")}).then((e=>{if(null!==e&&void 0!==e&&e.ok)return c.A.push(`/order/${e.data.client_id}`),(0,u.tP)("Client created");(0,u._O)((null===e||void 0===e?void 0:e.error)||"Unable to create")})).catch((()=>(0,u.L_)(o.MZ.GENERAL_ERROR)))};return(e,t)=>((0,n.uX)(),(0,n.Wv)(r.A,{fields:w,onFinish:k,skipSummary:!0,onOnIndex:t[0]||(t[0]=e=>a.value=""),activeField:a.value},null,8,["activeField"]))}}),f=_,h=f},81148:(e,t,a)=>{var n=a(46518),i=a(72652),r=a(79306),l=a(28551),o=a(1767);n({target:"Iterator",proto:!0,real:!0},{every:function(e){l(this),r(e);var t=o(this),a=0;return!i(t,(function(t,n){if(!e(t,a++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},23215:(e,t,a)=>{a(81148)}}]);
//# sourceMappingURL=8377.a09073c0.js.map