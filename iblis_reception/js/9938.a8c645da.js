(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[9938],{74353:function(e){!function(t,n){e.exports=n()}(0,(function(){"use strict";var e=1e3,t=6e4,n=36e5,r="millisecond",i="second",a="minute",s="hour",u="day",o="week",c="month",l="quarter",d="year",f="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},y=function(e,t,n){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(n)+e},$={s:y,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),r=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+y(r,2,"0")+":"+y(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var r=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(r,c),a=n-i<0,s=t.clone().add(r+(a?-1:1),c);return+(-(r+(n-i)/(a?i-s:s-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:c,y:d,w:o,d:u,D:f,h:s,m:a,s:i,ms:r,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},g="en",_={};_[g]=v;var D="$isDayjsObject",T=function(e){return e instanceof w||!(!e||!e[D])},b=function e(t,n,r){var i;if(!t)return g;if("string"==typeof t){var a=t.toLowerCase();_[a]&&(i=a),n&&(_[a]=n,i=a);var s=t.split("-");if(!i&&s.length>1)return e(s[0])}else{var u=t.name;_[u]=t,i=u}return!r&&i&&(g=i),i||!r&&g},M=function(e,t){if(T(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new w(n)},S=$;S.l=b,S.i=T,S.w=function(e,t){return M(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var w=function(){function v(e){this.$L=b(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[D]=!0}var y=v.prototype;return y.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(p);if(r){var i=r[2]-1||0,a=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,a)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,a)}}return new Date(t)}(e),this.init()},y.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},y.$utils=function(){return S},y.isValid=function(){return!(this.$d.toString()===h)},y.isSame=function(e,t){var n=M(e);return this.startOf(t)<=n&&n<=this.endOf(t)},y.isAfter=function(e,t){return M(e)<this.startOf(t)},y.isBefore=function(e,t){return this.endOf(t)<M(e)},y.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},y.unix=function(){return Math.floor(this.valueOf()/1e3)},y.valueOf=function(){return this.$d.getTime()},y.startOf=function(e,t){var n=this,r=!!S.u(t)||t,l=S.p(e),h=function(e,t){var i=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return r?i:i.endOf(u)},p=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},m=this.$W,v=this.$M,y=this.$D,$="set"+(this.$u?"UTC":"");switch(l){case d:return r?h(1,0):h(31,11);case c:return r?h(1,v):h(0,v+1);case o:var g=this.$locale().weekStart||0,_=(m<g?m+7:m)-g;return h(r?y-_:y+(6-_),v);case u:case f:return p($+"Hours",0);case s:return p($+"Minutes",1);case a:return p($+"Seconds",2);case i:return p($+"Milliseconds",3);default:return this.clone()}},y.endOf=function(e){return this.startOf(e,!1)},y.$set=function(e,t){var n,o=S.p(e),l="set"+(this.$u?"UTC":""),h=(n={},n[u]=l+"Date",n[f]=l+"Date",n[c]=l+"Month",n[d]=l+"FullYear",n[s]=l+"Hours",n[a]=l+"Minutes",n[i]=l+"Seconds",n[r]=l+"Milliseconds",n)[o],p=o===u?this.$D+(t-this.$W):t;if(o===c||o===d){var m=this.clone().set(f,1);m.$d[h](p),m.init(),this.$d=m.set(f,Math.min(this.$D,m.daysInMonth())).$d}else h&&this.$d[h](p);return this.init(),this},y.set=function(e,t){return this.clone().$set(e,t)},y.get=function(e){return this[S.p(e)]()},y.add=function(r,l){var f,h=this;r=Number(r);var p=S.p(l),m=function(e){var t=M(h);return S.w(t.date(t.date()+Math.round(e*r)),h)};if(p===c)return this.set(c,this.$M+r);if(p===d)return this.set(d,this.$y+r);if(p===u)return m(1);if(p===o)return m(7);var v=(f={},f[a]=t,f[s]=n,f[i]=e,f)[p]||1,y=this.$d.getTime()+r*v;return S.w(y,this)},y.subtract=function(e,t){return this.add(-1*e,t)},y.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var r=e||"YYYY-MM-DDTHH:mm:ssZ",i=S.z(this),a=this.$H,s=this.$m,u=this.$M,o=n.weekdays,c=n.months,l=n.meridiem,d=function(e,n,i,a){return e&&(e[n]||e(t,r))||i[n].slice(0,a)},f=function(e){return S.s(a%12||12,e,"0")},p=l||function(e,t,n){var r=e<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(m,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return S.s(t.$y,4,"0");case"M":return u+1;case"MM":return S.s(u+1,2,"0");case"MMM":return d(n.monthsShort,u,c,3);case"MMMM":return d(c,u);case"D":return t.$D;case"DD":return S.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,o,2);case"ddd":return d(n.weekdaysShort,t.$W,o,3);case"dddd":return o[t.$W];case"H":return String(a);case"HH":return S.s(a,2,"0");case"h":return f(1);case"hh":return f(2);case"a":return p(a,s,!0);case"A":return p(a,s,!1);case"m":return String(s);case"mm":return S.s(s,2,"0");case"s":return String(t.$s);case"ss":return S.s(t.$s,2,"0");case"SSS":return S.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},y.diff=function(r,f,h){var p,m=this,v=S.p(f),y=M(r),$=(y.utcOffset()-this.utcOffset())*t,g=this-y,_=function(){return S.m(m,y)};switch(v){case d:p=_()/12;break;case c:p=_();break;case l:p=_()/3;break;case o:p=(g-$)/6048e5;break;case u:p=(g-$)/864e5;break;case s:p=g/n;break;case a:p=g/t;break;case i:p=g/e;break;default:p=g}return h?p:S.a(p)},y.daysInMonth=function(){return this.endOf(c).$D},y.$locale=function(){return _[this.$L]},y.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),r=b(e,t,!0);return r&&(n.$L=r),n},y.clone=function(){return S.w(this.$d,this)},y.toDate=function(){return new Date(this.valueOf())},y.toJSON=function(){return this.isValid()?this.toISOString():null},y.toISOString=function(){return this.$d.toISOString()},y.toString=function(){return this.$d.toUTCString()},v}(),O=w.prototype;return M.prototype=O,[["$ms",r],["$s",i],["$m",a],["$H",s],["$W",u],["$M",c],["$y",d],["$D",f]].forEach((function(e){O[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),M.extend=function(e,t){return e.$i||(e(t,w,M),e.$i=!0),M},M.locale=b,M.isDayjs=T,M.unix=function(e){return M(1e3*e)},M.en=_[g],M.Ls=_,M.p={},M}))},32336:(e,t,n)=>{"use strict";n.d(t,{i:()=>u});n(98992),n(72577),n(81454);var r=n(741),i=n(50953);const a=(0,i.KR)("full_name");let s=!1;function u(){const e=()=>{var e;if(s)return a.value;const t=(0,r.Kj)(),n=null===(e=t.token)||void 0===e||null===(e=e.value)||void 0===e||null===(e=e.authorization)||void 0===e?void 0:e.user;if(n&&n.preferences){const e=n.preferences.find((e=>"test_name_display"===e.name&&"site"===e.target));if(e)return a.value=e.value,s=!0,a.value}return a.value="full_name",s=!0,a.value},t=e=>{if(!e)return"";const t=e.split(" ");return t.length>1?t.map((e=>e.charAt(0))).join("").toUpperCase():e.substring(0,4).toUpperCase()},n=(t,n)=>{const r=e();return"full_name"===r?t:n||(t||t)};return{getPreference:e,generatePreferredName:t,getDisplayName:n,preference:a}}},71035:(e,t,n)=>{"use strict";n.d(t,{A:()=>w,l:()=>a});n(27495);var r=n(74353),i=n.n(r);const a="YYYY-MM-DD",s="DD/MMM/YYYY";function u(){return sessionStorage.getItem("sessionDate")||i()().format(a)}function o(){return i()().format(s)}function c(){return i()().format(a)}function l(e,t){return i()(e).diff(t,"days")}function d(e){return i()().diff(e,"years")}function f(e){return i()(e).format("HH:mm")}function h(e){const t=i()(e).format(s);return t.match(/invalid/i)?"":t}function p(e){const t=i()(e).format(a);return t.match(/invalid/i)?"":t}function m(e){const t=i()().subtract(e,"years");return t.format(a)}function v(e){return i()().subtract(e,"years").year()}function y(e){return i()(e).year()}function $(e){return i()(e).format("MMM")}function g(e){return i()(e).date()}function _(e,t,n){return i()(e).add(n,t)}function D(e,t,n){return i()(e).subtract(n,t)}function T(){return i()().year()}function b(e,t){const n=new Date(e);return n.setDate(n.getDate()-t),p(n)}function M(e){const[t]=m(e).split("-");return parseInt(t)}function S(e,t=-1,n=-1){let r=t.toString(),i=n.toString(),a=e;const s=e=>e.toString().match(/Unknown/i);return parseInt(a.toString())<1900&&(a="1900"),t&&!s(t)||(r="07"),n&&!s(n)||(i="15"),p(`${a}-${r}-${i}`)}const w={sessionDate:u,currentDate:c,getYearOfAge:M,getYear:y,dateDiffInDays:l,getAgeInYears:d,toStandardHisTimeFormat:f,toStandardHisDisplayFormat:h,currentDisplayDate:o,stitchDate:S,toStandardHisFormat:p,estimateDateFromAge:m,getYearFromAge:v,getCurrentYear:T,getDateBeforeByDays:b,getMonth:$,getDay:g,add:_,subtract:D}},88049:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});n(72712),n(98992),n(54520),n(8872);function r(e,t){const n=Object.values(Object.values(e)),r=n.filter((e=>!!e[t])).reduce(((e,n)=>(Array.isArray(n[t])?e[t]=n[t]:e[t]={...e[t],...n[t]},e)),{});return r}},59938:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});n(44114),n(27495),n(98992),n(54520),n(3949),n(81454);var r=n(20641),i=n(1590),a=n(25486),s=n(77270),u=n(741),o=n(88049),c=n(75220),l=n(85901),d=n(82077),f=n(32336),h=n(50953),p=n(9624),m=n(46079),v=n(71035);const y=(0,r.pM)({__name:"NewOrder",setup(e){const t=(0,h.KR)(),n=(0,h.KR)(!1),y=(0,h.KR)(!1),$=()=>{y.value=!0,(0,p.q)(y.value,t.value)},g=(0,c.lq)(),_=(0,u.Kj)(),D=()=>{const e=[];return{id:"visit_type",helpText:"Visit type",type:s.P.TT_SELECT,requireNext:!1,validation:e=>i.A.required(e),computedValue:e=>({encounter:{encounter_type:e.value}}),init:async()=>{var t;const n=await _.getJson("encounter_types");return!(null===n||void 0===n||!n.ok)&&(null===(t=n.data)||void 0===t||t.data.forEach((t=>{e.push({label:t.name,value:t.id})})),!0)},options:()=>e}},T=()=>({id:"clinician",helpText:"Requesting Clinician",type:s.P.TT_TEXT,computedValue:e=>({order:{requested_by:e.value}}),options:async e=>{var t;if(null!==(t=e.clinician)&&void 0!==t&&t.value){var n;const t=await _.getJson("orders/search_by_requesting_clinician",{name:null===(n=e.clinician)||void 0===n?void 0:n.value});return null===t||void 0===t?void 0:t.data.map((e=>({label:e,value:e})))}return[]},validation:e=>i.A.required(e)}),b=()=>({id:"collector",helpText:"Sample collected by (Optional)",type:s.P.TT_TEXT,computedValue:e=>({order:{collected_by:(null===e||void 0===e?void 0:e.value)||""}})}),M=()=>{let e=null;return{id:"ward",helpText:"Requesting ward/location",requireNext:!1,type:s.P.TT_SELECT,init:async()=>{const t=await _.getJson("global");return t.ok&&(e=t.data.id),!0},config:{showKeyboard:!0},computedValue:t=>({encounter:{facility_section:t.value,sending_facility:e||-1}}),validation:e=>i.A.required(e),options:async e=>{const t=await _.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:e.visit_type.value});return(t.data||[]).map((e=>({label:e.name,value:e.id})))}}},S=()=>({id:"date",helpText:"Date",type:s.P.TT_DATE_PICKER,config:{maxDate:()=>v.A.currentDate()},validation:e=>{const t=i.A.required(e);if(t)return t;const n=new Date(e.value),r=new Date(v.A.currentDate());return n.setHours(0,0,0,0),r.setHours(0,0,0,0),n>r?["Order date cannot be greater than today"]:null}}),w=()=>{let e=[];const{getDisplayName:t}=(0,f.i)();return{id:"specimen_type",helpText:"Specimen type",type:s.P.TT_SELECT,requireNext:!1,init:async()=>{const n=await _.getJson("specimen");return!(null===n||void 0===n||!n.ok)&&(e=n.data.map((e=>({label:t(e.name,e.preferred_name),value:e.id}))),!0)},config:{showKeyboard:!0},options:()=>e,validation:e=>i.A.required(e)}},O=()=>{let e=[];return{id:"priority",helpText:"Specify priority",type:s.P.TT_SELECT,computedValue:e=>({order:{priority:e.value}}),validation:e=>i.A.required(e),init:async()=>{const t=await _.getJson("priorities");return!(null===t||void 0===t||!t.ok)&&(e=t.data.map((e=>({label:e.name,value:e.id}))),!0)},options:()=>e}},A=()=>{let e=[],t=null;return{id:"test_types",helpText:"Select test types",type:s.P.TT_MULTIPLE_SELECT,config:{showKeyboard:!0},computedValue:(e,t)=>({tests:e.map((e=>({specimen:t.specimen_type.value,test_type:e.value})))}),options:async n=>{var r;const i=await _.getJson(`/clients/${g.params.client_id}`),a=null!==i&&void 0!==i&&null!==(r=i.data)&&void 0!==r&&r.sex.match(/f/i)?"Female":"Male";if(n.specimen_type.value!=t){e=[],t=n.specimen_type.value;const r=await _.getJson("specimen/test_types",{specimen_id:t,sex:a});if(null===r||void 0===r||!r.ok)return[];e=r.data.map((e=>({label:e,value:e})))}return e},validation:e=>i.A.required(e)}},k=()=>({id:"time_sample_collected",helpText:"Time Sample Collected",type:s.P.TT_TIME,computedValue:(e,t)=>({order:{sample_collected_time:`${t.date} ${e.value}`}}),validation:(e,t)=>{const n=i.A.required(e);if(n)return n;const r=new Date(t.date),a=new Date(v.A.currentDate());if(r.setHours(0,0,0,0),a.setHours(0,0,0,0),r.getTime()===a.getTime()){const t=String(e.value),[n,r]=t.split(":").map(Number),i=new Date;i.setHours(n,r,0,0);const a=new Date;if(i>a)return["Sample collection time cannot be in the future"]}return null}}),Y=[D(),M(),T(),b(),w(),A(),S(),k(),O()],x=async(e,r)=>{var i;const a=new d.A,{getLocation:s,token:c}=(0,u.Kj)(),f=null===(i=c.value)||void 0===i||null===(i=i.authorization)||void 0===i?void 0:i.user,h=f.lab_locations.filter((e=>e.name==s())),p={client:{id:parseInt(`${g.params.client_id}`)},lab_location:h[0].id,...(0,o.T)(r,"encounter"),...(0,o.T)(r,"order"),...(0,o.T)(r,"tests")};n.value=!0,_.postJson("orders",p).then((e=>{t.value=e.data;const r=e.data.accession_number;if(!e.ok)return(0,l._O)(e.error);a.writeLbl("printout/accession_number",{accession_number:r},`${r}.lbl`),n.value=!1,y.value=!0;try{m.A.push("/tests")}catch(i){console.log(i)}(0,l.tP)("Order as been created!"),$()})).catch((()=>{n.value=!1,(0,l.L_)(u.MZ.GENERAL_ERROR)}))};return(e,t)=>((0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(a.A,{fields:Y,onFinish:x,skipSummary:!0,onFinishDisabled:n.value,cancelDestinationPath:"/home"},null,8,["onFinishDisabled"]),t[0]||(t[0]=(0,r.Lk)("div",{id:"rootContainer"},null,-1))]))}}),$=y,g=$}}]);
//# sourceMappingURL=9938.a8c645da.js.map