"use strict";(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[9938],{88049:(e,t,i)=>{i.d(t,{T:()=>a});i(72712),i(98992),i(54520),i(8872);function a(e,t){const i=Object.values(Object.values(e)),a=i.filter((e=>!!e[t])).reduce(((e,i)=>(Array.isArray(i[t])?e[t]=i[t]:e[t]={...e[t],...i[t]},e)),{});return a}},59938:(e,t,i)=>{i.r(t),i.d(t,{default:()=>T});i(44114),i(27495),i(98992),i(54520),i(3949),i(81454);var a=i(20641),n=i(1590),l=i(25486),o=i(77270),r=i(741),u=i(88049),s=i(75220),c=i(85901),d=i(82077),p=i(50953),v=i(35854),_=i(46079);const y=(0,a.pM)({__name:"NewOrder",setup(e){const t=(0,p.KR)(),i=((0,p.KR)(),(0,p.KR)(!1)),y=(0,p.KR)(!1),m=()=>{y.value=!0,(0,v.q)(y.value,t.value)},T=(0,s.lq)(),b=(0,r.Kj)(),h=()=>{const e=[];return{id:"visit_type",helpText:"Visit type",type:o.P.TT_SELECT,requireNext:!1,validation:e=>n.A.required(e),computedValue:e=>({encounter:{encounter_type:e.value}}),init:async()=>{var t;const i=await b.getJson("encounter_types");return!(null===i||void 0===i||!i.ok)&&(null===(t=i.data)||void 0===t||t.data.forEach((t=>{e.push({label:t.name,value:t.id})})),!0)},options:()=>e}},g=()=>({id:"clinician",helpText:"Requesting Clinician",type:o.P.TT_TEXT,computedValue:e=>({order:{requested_by:e.value}}),options:async e=>{var t;if(null!==(t=e.clinician)&&void 0!==t&&t.value){var i;const t=await b.getJson("orders/search_by_requesting_clinician",{name:null===(i=e.clinician)||void 0===i?void 0:i.value});return null===t||void 0===t?void 0:t.data.map((e=>({label:e,value:e})))}return[]},validation:e=>n.A.required(e)}),E=()=>({id:"collector",helpText:"Sample collected by (Optional)",type:o.P.TT_TEXT,computedValue:e=>({order:{collected_by:(null===e||void 0===e?void 0:e.value)||""}})}),f=()=>{let e=null;return{id:"ward",helpText:"Requesting ward/location",requireNext:!1,type:o.P.TT_SELECT,init:async()=>{const t=await b.getJson("global");return t.ok&&(e=t.data.id),!0},config:{showKeyboard:!0},computedValue:t=>({encounter:{facility_section:t.value,sending_facility:e||-1}}),validation:e=>n.A.required(e),options:async e=>{const t=await b.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:e.visit_type.value});return(t.data||[]).map((e=>({label:e.name,value:e.id})))}}},w=()=>({id:"date",helpText:"Date",type:o.P.TT_DATE_PICKER,validation:e=>n.A.required(e)}),q=()=>{let e=[];return{id:"specimen_type",helpText:"Specimen type",type:o.P.TT_SELECT,requireNext:!1,init:async()=>{const t=await b.getJson("specimen");return!(null===t||void 0===t||!t.ok)&&(e=t.data.map((e=>({label:e.name,value:e.id}))),!0)},config:{showKeyboard:!0},options:()=>e,validation:e=>n.A.required(e)}},A=()=>{let e=[];return{id:"priority",helpText:"Specify priority",type:o.P.TT_SELECT,computedValue:e=>({order:{priority:e.value}}),validation:e=>n.A.required(e),init:async()=>{const t=await b.getJson("priorities");return!(null===t||void 0===t||!t.ok)&&(e=t.data.map((e=>({label:e.name,value:e.id}))),!0)},options:()=>e}},x=()=>{let e=[],t=null;return{id:"test_types",helpText:"Select test types",type:o.P.TT_MULTIPLE_SELECT,config:{showKeyboard:!0},computedValue:(e,t)=>({tests:e.map((e=>({specimen:t.specimen_type.value,test_type:e.value})))}),options:async i=>{var a;const n=await b.getJson(`/clients/${T.params.client_id}`),l=null!==n&&void 0!==n&&null!==(a=n.data)&&void 0!==a&&a.sex.match(/f/i)?"Female":"Male";if(i.specimen_type.value!=t){e=[],t=i.specimen_type.value;const a=await b.getJson("specimen/test_types",{specimen_id:t,sex:l});if(null===a||void 0===a||!a.ok)return[];e=a.data.map((e=>({label:e,value:e})))}return e},validation:e=>n.A.required(e)}},L=()=>({id:"time_sample_collected",helpText:"Time Sample Collected",type:o.P.TT_TIME,computedValue:(e,t)=>({order:{sample_collected_time:`${t.date} ${e.value}`}}),validation:e=>n.A.required(e)}),k=[h(),f(),g(),E(),q(),x(),w(),L(),A()],P=async(e,a)=>{var n;const l=new d.A,{getLocation:o,token:s}=(0,r.Kj)(),p=null===(n=s.value)||void 0===n||null===(n=n.authorization)||void 0===n?void 0:n.user,v=p.lab_locations.filter((e=>e.name==o())),h={client:{id:parseInt(`${T.params.client_id}`)},lab_location:v[0].id,...(0,u.T)(a,"encounter"),...(0,u.T)(a,"order"),...(0,u.T)(a,"tests")};i.value=!0,b.postJson("orders",h).then((e=>{t.value=e.data;const a=e.data.accession_number;if(!e.ok)return(0,c._O)(e.error);l.writeLbl("printout/accession_number",{accession_number:a},`${a}.lbl`),i.value=!1,y.value=!0;try{_.A.push("/tests")}catch(n){console.log(n)}(0,c.tP)("Order as been created!"),m()})).catch((()=>{i.value=!1,(0,c.L_)(r.MZ.GENERAL_ERROR)}))};return(e,t)=>((0,a.uX)(),(0,a.CE)("div",null,[(0,a.bF)(l.A,{fields:k,onFinish:P,skipSummary:!0,onFinishDisabled:i.value,cancelDestinationPath:"/home"},null,8,["onFinishDisabled"]),t[0]||(t[0]=(0,a.Lk)("div",{id:"rootContainer"},null,-1))]))}}),m=y,T=m}}]);
//# sourceMappingURL=9938.ce3cab01.js.map