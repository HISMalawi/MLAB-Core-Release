"use strict";(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[8377],{31588:(e,t,a)=>{a.d(t,{J8:()=>c,Jj:()=>r,bB:()=>m,m8:()=>s,ti:()=>o,yg:()=>i});var n=a(52110);const l=[n.Am,[["","Delete"]]],i=[n.aD,[["Delete"]]],o=(n.aD,[n.aD,[["N/A"],["Delete","Unknown"]]]),r=[n.aD,[["Delete"]]],u=[n.aD,[["Unknown","Delete"],["Qwerty","A-Z"]]],s=[n.uY,[["Unknown"]]],d=[n.ZY,[["0-9","Delete"],["Qwerty","Unknown"],["","Space"]]],c=[n.lJ,[["","Delete"],["?123","0-9"],["Space","Unknown"]]],m=[{btn:"0-9",keyboard:u},{btn:"?123",keyboard:l},{btn:"A-Z",keyboard:d},{btn:"Qwerty",keyboard:c}]},15291:(e,t,a)=>{a.d(t,{I6:()=>i,LE:()=>k});a(16280),a(74423),a(44114),a(72712),a(27495),a(98992),a(23215),a(8872);var n=a(77270);const l=[{label:"Jan",value:1},{label:"Feb",value:2},{label:"Mar",value:3},{label:"Apr",value:4},{label:"May",value:5},{label:"Jun",value:6},{label:"Jul",value:7},{label:"Aug",value:8},{label:"Sep",value:9},{label:"Oct",value:10},{label:"Nov",value:11},{label:"Dec",value:12}];var i,o=a(71035),r=a(1590),u=a(52110),s=a(31588),d=a(74353),c=a.n(d),m=a(9450);function p(e,t,a=!0){const l=[];return a&&l.push("UNKNOWN"),{id:e,helpText:`${t} Year`,appearInSummary:()=>!1,type:n.P.TT_TEXT,config:{customKeyboard:[u.aD,[l,["DELETE"]]]}}}function v(e,t){return{id:e,helpText:`${t} Month`,appearInSummary:()=>!1,type:n.P.TT_SELECT,options:()=>l}}function f(e,t){return{id:e,helpText:`${t} Day`,type:n.P.TT_MONTHLY_DAYS,appearInSummary:()=>!1}}function h(e){const{value:t,timeUnit:a}=e;if(t<0)throw new Error("Estimate value must be positive");const n=m.kl.getSessionDate();let l=c()(n);switch(a.toLowerCase()){case"hours":l=l.subtract(t,"hour");break;case"days":l=l.subtract(t,"day");break;case"weeks":l=l.subtract(t,"week");break;case"months":l=l.subtract(t,"month");break;case"years":l=l.subtract(t,"year");break;default:throw new Error(`Invalid time unit: ${a}`)}const i=l.year(),r=l.month()+1,u=l.date(),s=x(i,r,u);return s!==u&&(l=l.date(s)),l.format(o.l)}function T(e,t){return{id:e,helpText:`${t} Estimated period`,type:n.P.TT_SELECT,appearInSummary:()=>!1,options:()=>[{label:"6 months ago",value:180},{label:"12 months ago",value:365},{label:"18 months ago",value:540},{label:"24 months ago",value:730},{label:"Over 2 years ago",value:730}]}}function _(e,t){return{id:e,helpText:`${t} Age Estimate`,type:n.P.TT_AGE_INPUT,appearInSummary:()=>!1,config:{keypad:s.Jj}}}function b(e){return parseInt(e)<10?`0${e}`:e}async function y(e,t,a){if(t.defaultValue){const n=await t.defaultValue(e);if(n){const[e,t,l]=n.split("-");switch(a){case"Year":return e||"";case"Month":return parseInt(t)||"";case"Day":return parseInt(l)||""}}}return""}function E(e){return o.A.toStandardHisDisplayFormat(e)}function D(e,t,a,n){if(t.minDate){const l=t.minDate(a,n);if(new Date(e)<new Date(l))return[`${E(e)} is less than minimum date of ${E(l)}`]}if(t.maxDate){const l=t.maxDate(a,n);if(l&&new Date(e)>new Date(l))return[`${E(e)} is greater than max date of  ${E(l)}`]}}function w(e){return e%4===0&&e%100!==0||e%400===0}function x(e,t,a){return 2===t&&29===a?w(e)?29:28:a}function k(e,t=""){let a="",n="",u="",s="",d=!1;const w=`year_${e.id}`,k=`month_${e.id}`,$=`day_${e.id}`,I=`age_estimate_${e.id}`,A=`duration_estimate_${e.id}`,g=p(w,e.helpText,e.estimation.allowUnknown),S=v(k,e.helpText),N=f($,e.helpText),M=_(I,e.helpText),V=T(A,e.helpText),U="boolean"===typeof e.estimation.allowUnknownMonthDay&&e.estimation.allowUnknownMonthDay,L=t=>!(t[w]&&t[w].value&&["Unknown"].includes(t[w].value))&&(!e.condition||e.condition(t)),F=(e,t)=>{const a=[{type:"year",value:n,default:"YYYY"},{type:"month",value:u,default:"MM"},{type:"day",value:s,default:"DD"}];return a.reduce(((a,n)=>{const l=[null,void 0,"Unknown",""];return t===n.type?l.includes(e)?a.push(n.default):a.push(e):l.includes(n.value)?a.push(n.default):a.push(n.value),a}),[]).join("-")};"function"===typeof e.init&&(g.init=e.init),g.updateHelpTextOnValue=e=>`${g.helpText} (${F(null===e||void 0===e?void 0:e.label,"year")})`,g.proxyID=e.id,g.unload=e=>n=e.value.toString(),g.config={...g.config,...e.config},g.defaultValue=t=>y(t,e,"Year"),g.condition=t=>!e.condition||e.condition(t),g.validation=(t,a,n)=>{if(e.required&&r.A.required(t))return["Year cannot be empty"];const l=t?t.value:"";if(!e.estimation.allowUnknown&&l.toString().match(/unknown/i))return["Value unknown is not permitted"];if(l&&!["Unknown"].includes(l)&&isNaN(l)||Number(l)<1900)return["Invalid Year"];if(l&&"function"===typeof e.minDate){const t=o.A.getYear(e.minDate(a,n));if(parseInt(l)<t)return[`Year of ${l} is less than Minimum year of ${t}`]}if(l&&"function"===typeof e.maxDate){const t=e.maxDate(a,n);if(t&&Number(l)>o.A.getYear(t))return[`Year of ${l} exceeds Maximum year of ${o.A.getYear(t)}`]}return null},g.summaryMapValue=()=>({label:e.summaryLabel||e.helpText,value:a?E(a):"Unknown"}),g.appearInSummary=(t,a)=>a===e.id,g.computedValue=t=>{if(a){const[n,l,i]=a.split("-");return a=`${t.value}-${l}-${i}`,e.computeValue(a,!1)}if(t&&"Unknown"===t.value)return a="",e.computeValue("Unknown",!1)},S.updateHelpTextOnValue=e=>`${S.helpText} (${F(null===e||void 0===e?void 0:e.label,"month")})`,S.proxyID=e.id,S.unload=e=>u=b(e.value.toString()),S.condition=e=>L(e),S.validation=e=>r.A.required(e),S.defaultValue=t=>y(t,e,"Month"),U&&(S.options=()=>[...l,{label:"Unknown",value:"Unknown"}]),S.computedValue=(t,n)=>{if(`${t.value}`.match(/unknown/i)){const t=n[w].value,l=c()().format("MM"),i=x(t,Number(l),Number(c()().format("DD")));return a=`${t}-${l}-${i}`,e.computeValue(a,!0)}if(a){const[n,l,i]=a.split("-"),o=b(`${t.value}`);return a=`${n}-${o}-${i}`,e.computeValue(a,!1)}},N.proxyID=e.id,N.updateHelpTextOnValue=e=>`${N.helpText} (${F(null===e||void 0===e?void 0:e.label,"day")})`,N.condition=e=>!`${e[k].value}`.match(/unknown/i)&&L(e),N.validation=(t,l,i)=>r.A.required(t)?["Day is required for date"]:(d=!!`${t.value}`.match(/unknown/i),s=d?"15":b(`${t.value}`),a=`${n}-${u}-${s}`,D(a,e,l,i)),N.defaultValue=t=>y(t,e,"Day"),N.computedValue=()=>e.computeValue(a,d),N.unload=(t,a,n,l)=>{e.unload&&e.unload(t,a,n,l)},N.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),N.config={year:e=>e[w].value,month:e=>e[k].value},U||(N.config.keyboardActions=[]);const O=(t,a)=>{const n=["Unknown"===t[w].value,!e.condition||e.condition(t),e.estimation.estimationFieldType===a];return n.every(Boolean)};M.proxyID=e.id;return M.validation=(t,n,l)=>{var i,o;if(!t)return["Age estimate is required"];const r=null===t||void 0===t||null===(i=t.other)||void 0===i?void 0:i.value,u=null===t||void 0===t||null===(o=t.other)||void 0===o||null===(o=o.timeUnit)||void 0===o?void 0:o.toLowerCase();if(!r||!u)return["Invalid age estimate format"];const s=/^(0|[1-9]\d*)$/;if(!r.match(s))return["Not a valid number"];try{const t=parseInt(r);return a=h({value:t,timeUnit:u}),D(a,e,n,l)}catch(d){return[d.message]}},M.condition=e=>O(e,i.AGE_ESTIMATE_FIELD),M.computedValue=()=>e.computeValue(a,!0),M.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),V.proxyID=e.id,V.validation=(t,n,l)=>r.A.required(t)?["Please select an estimate"]:(a=c()(m.kl.getSessionDate()).subtract(t.value,"day").format(o.l),D(a,e,n,l)),V.condition=e=>O(e,i.MONTH_ESTIMATE_FIELD),V.computedValue=()=>e.computeValue(a,!0),V.beforeNext=(t,n)=>!e.beforeNext||e.beforeNext(a,n),[g,S,N,M,V]}(function(e){e["AGE_ESTIMATE_FIELD"]="age-estimate-field",e["MONTH_ESTIMATE_FIELD"]="month-period-estimate-field",e["WEEKS_ESTIAMATE_FIELD"]="weeks-period-estimate-field",e["DAY_ESTIMATE_FIELD"]="day-period-estimate-field",e["HOURS_ESTIMATE_FIELD"]="hours-period-estimate-field"})(i||(i={}))},88049:(e,t,a)=>{a.d(t,{T:()=>n});a(72712),a(98992),a(54520),a(8872);function n(e,t){const a=Object.values(Object.values(e)),n=a.filter((e=>!!e[t])).reduce(((e,a)=>(Array.isArray(a[t])?e[t]=a[t]:e[t]={...e[t],...a[t]},e)),{});return n}},38377:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});a(44114),a(81454);var n=a(20641),l=a(1590),i=a(25486),o=a(77270),r=a(741),u=a(85901),s=a(50953),d=a(2543),c=a(46079),m=a(71035),p=a(15291),v=a(88049);const f=(0,n.pM)({__name:"FindOrRegister",setup(e){const t=(0,r.Kj)(),a=(0,s.KR)(""),f=()=>({id:"first_name",helpText:"First name",type:o.P.TT_TEXT,computedValue:e=>({person:{first_name:e.value}}),options:async e=>{var a;if(null!==(a=e.first_name)&&void 0!==a&&a.value){var n;const a=await t.getJson("clients/search_by_name",{first_name:null===(n=e.first_name)||void 0===n?void 0:n.value});return null===a||void 0===a?void 0:a.data.map((e=>({label:e,value:e})))}return[]},validation:e=>l.A.isName(e)}),h=()=>({id:"last_name",helpText:"Last name",type:o.P.TT_TEXT,computedValue:e=>({person:{last_name:e.value}}),options:async e=>{var a;if(null!==(a=e.last_name)&&void 0!==a&&a.value){var n;const a=await t.getJson("clients/search_by_name",{last_name:null===(n=e.last_name)||void 0===n?void 0:n.value});return null===a||void 0===a?void 0:a.data.map((e=>({label:e,value:e})))}return[]},validation:e=>l.A.isName(e)}),T=()=>({id:"middle_name",helpText:"Middle name(Optional)",type:o.P.TT_TEXT,computedValue:e=>{if(e)return{person:{middle_name:e.value}}}}),_=()=>({id:"sex",helpText:"Gender",type:o.P.TT_SELECT,computedValue:e=>({person:{sex:e.value}}),validation:e=>l.A.required(e),options:()=>[{label:"Female",value:"F"},{label:"Male",value:"M"}]}),b=()=>{const e={id:"date_of_birth",summaryLabel:"Date of Birth",helpText:"Birth",required:!0,minDate:()=>m.A.estimateDateFromAge(100),maxDate:()=>m.A.sessionDate(),estimation:{allowUnknown:!0,allowUnknownMonthDay:!0,estimationFieldType:p.I6.AGE_ESTIMATE_FIELD},computeValue:(e,t)=>({person:{date_of_birth:e,birth_date_estimated:t}})};return(0,p.LE)(e)},y=()=>({id:"physical_address",helpText:"Physical address",type:o.P.TT_TEXT,computedValue:e=>({client_identifiers:{physical_address:e.value}}),validation:e=>l.A.required(e)}),E=()=>({id:"npid",helpText:"External Patient Number (Option)",type:o.P.TT_TEXT,computedValue:e=>{if(e)return{client_identifiers:{npid:(null===e||void 0===e?void 0:e.value)||""}}}}),D=()=>({id:"results",helpText:"Search results",type:o.P.TT_PERSON_RESULT_VIEW,dynamicHelpText:e=>`Search results for "${e.first_name.value} ${e.last_name.value} | ${e.sex.label}"`,options:async e=>{const a={first_name:e.first_name.value,last_name:e.last_name.value,gender:e.sex.value},n=await t.getJson("clients/search_dde",a);return null!==n&&void 0!==n&&n.ok?n.data.map((e=>({label:`${e.first_name} ${e.last_name} (${e.date_of_birth})`,value:e.client_id,other:{person:e,options:[{label:"First name",value:e.first_name},{label:"Middle name",value:e.middle_name},{label:"Last name",value:e.last_name},{label:"Sex",value:e.sex},{label:"Birthdate",value:e.date_of_birth},{label:"Is birth estimated?",value:e.birth_date_estimated?"Yes":"No"}]}}))):((0,u._O)("Unable to find client"),[])},config:{hiddenFooterBtns:["Clear","Next","Back","Finish"],footerBtns:[{name:"Edit Search",slot:"end",onClick:()=>{a.value="first_name"}},{name:"New Client",slot:"end",onClick:()=>{a.value="_NEXT_FIELD_"}},{name:"New Order",color:"success",slot:"end",state:{disabled:{default:()=>!0,onValue(e,t){return(0,d.isEmpty)(t.results)}}},onClick:e=>c.A.push(`/order/${e.results.value}`)}]}}),w=[f(),T(),h(),_(),D(),...b(),y(),E()],x=(e,a)=>{t.postJson("clients",{client:{id:"",uuid:""},...(0,v.T)(a,"person"),...(0,v.T)(a,"client_identifiers")}).then((e=>{if(null!==e&&void 0!==e&&e.ok)return c.A.push(`/order/${e.data.client_id}`),(0,u.tP)("Client created");(0,u._O)((null===e||void 0===e?void 0:e.error)||"Unable to create")})).catch((()=>(0,u.L_)(r.MZ.GENERAL_ERROR)))};return(e,t)=>((0,n.uX)(),(0,n.Wv)(i.A,{fields:w,onFinish:x,skipSummary:!0,onOnIndex:t[0]||(t[0]=e=>a.value=""),activeField:a.value},null,8,["activeField"]))}}),h=f,T=h},81148:(e,t,a)=>{var n=a(46518),l=a(72652),i=a(79306),o=a(28551),r=a(1767);n({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),i(e);var t=r(this),a=0;return!l(t,(function(t,n){if(!e(t,a++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},23215:(e,t,a)=>{a(81148)}}]);
//# sourceMappingURL=8377.1d72ffe6.js.map