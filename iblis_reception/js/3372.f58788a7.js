"use strict";(globalThis["webpackChunkIBLISReception"]=globalThis["webpackChunkIBLISReception"]||[]).push([[3372],{82077:(e,t,n)=>{n.d(t,{A:()=>l});n(14603),n(47566),n(98721);var o=n(741),i=n(85901);class l{async writeLbl(e,t,n=`${Date.now()}.lbl`){const l=(0,o.Kj)();try{const o=await l.getText(e,t),a=new Blob([null===o||void 0===o?void 0:o.data],{type:"text/plain"});e=URL.createObjectURL(a);const r=document.createElement("a");r.setAttribute("href",e),r.setAttribute("download",n),r.click(),URL.revokeObjectURL(e),(0,i.tP)("Accession number printed!")}catch(a){console.error(a)}}}},88049:(e,t,n)=>{n.d(t,{T:()=>o});n(72712),n(98992),n(54520),n(8872);function o(e,t){const n=Object.values(Object.values(e)),o=n.filter((e=>!!e[t])).reduce(((e,n)=>(Array.isArray(n[t])?e[t]=n[t]:e[t]={...e[t],...n[t]},e)),{});return o}},27311:(e,t,n)=>{n.d(t,{u0:()=>b,Ay:()=>h,Qf:()=>f});var o=n(73235),i=n(20641),l=n(90033);function a(e,t,n,o,a,r){const s=(0,i.g2)("ion-title"),d=(0,i.g2)("ion-toolbar"),u=(0,i.g2)("ion-header"),c=(0,i.g2)("ion-content"),p=(0,i.g2)("ion-button"),v=(0,i.g2)("ion-footer"),m=(0,i.g2)("ion-page");return(0,i.uX)(),(0,i.Wv)(m,null,{default:(0,i.k6)((()=>[(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.bF)(d,null,{default:(0,i.k6)((()=>[(0,i.bF)(s,{class:"his-lg-text ion-text-center"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.currentField.helpText),1)])),_:1})])),_:1})])),_:1}),(0,i.bF)(c,null,{default:(0,i.k6)((()=>[((0,i.uX)(),(0,i.Wv)(i.PR,null,[((0,i.uX)(),(0,i.Wv)((0,i.$y)(e.currentField.type),{key:e.currentField.id,currentFieldig:e.currentField.currentFieldig,options:e.currentField.options,preset:e.currentField.preset,clear:e.valueClearIndex,fdata:e.formData,config:e.currentField.config,cdata:e.computedFormData,activationState:e.state,onValue:e.currentField.onValue,defaultValue:e.currentField.defaultValue,onValueUpdate:e.currentField.onValueUpdate,onOnValue:e.onFieldValue},null,40,["currentFieldig","options","preset","clear","fdata","config","cdata","activationState","onValue","defaultValue","onValueUpdate","onOnValue"]))],1024))])),_:1}),(0,i.bF)(v,null,{default:(0,i.k6)((()=>[(0,i.bF)(d,{color:"light"},{default:(0,i.k6)((()=>[(0,i.bF)(p,{disabled:e.disableBtn,onClick:e.onClose,slot:"start",color:"danger",size:"large"},{default:(0,i.k6)((()=>t[0]||(t[0]=[(0,i.eW)(" Close ")]))),_:1},8,["disabled","onClick"]),(0,i.bF)(p,{disabled:e.disableBtn,onClick:e.onClear,slot:"end",color:"warning",size:"large"},{default:(0,i.k6)((()=>t[1]||(t[1]=[(0,i.eW)(" Clear ")]))),_:1},8,["disabled","onClick"]),(0,i.bF)(p,{disabled:e.disableBtn,onClick:e.onDone,slot:"end",color:"success",size:"large"},{default:(0,i.k6)((()=>t[2]||(t[2]=[(0,i.eW)(" Done ")]))),_:1},8,["disabled","onClick"])])),_:1})])),_:1})])),_:1})}n(98992),n(3949);var r=n(85901),s=n(77270);function d(){const e={};return s.N.forEach((t=>{e[t]=(0,i.$V)((()=>n(33274)(`./${t}.vue`)))})),e}const u=(0,i.pM)({name:"SingleFieldTouchForm",components:{IonPage:o.AO,IonContent:o.W9,IonFooter:o.M0,IonToolbar:o.ai,IonButton:o.Jm,IonHeader:o.eU,IonTitle:o.BC,...d()},props:{dismissType:{type:String},onFinish:{type:Function,required:!0},currentField:{type:Object,required:!0}},data:()=>({valueClearIndex:0,formData:{},computedFormData:{},state:"",value:null,disableBtn:!1}),methods:{onClose(){"modal"===this.dismissType?o.OZ.dismiss():this.$router.back()},onClear(){this.valueClearIndex+=1,this.value=null},onFieldValue(e){this.value=e},onDone(){if(this.disableBtn=!0,this.currentField.validation){const e=this.currentField.validation(this.value);if(this.disableBtn=!1,e)return(0,r._O)(e.join(", "),6e4)}try{this.onFinish(this.value)}catch(e){(0,r.L_)(`${e}`),console.error(e)}this.onClose(),this.disableBtn=!1}}});var c=n(66262);const p=(0,c.A)(u,[["render",a]]),v=p;var m=n(25310),_=n(6336);async function b(e,t,n){(await o.OZ.create({component:m.A,backdropDismiss:!1,cssClass:"full-modal",componentProps:{onFinish:t,fields:e,skipSummary:!0,disableAutoModalDismiss:!0,cancelAction:()=>{"function"===typeof n&&n(),o.OZ.dismiss()}}})).present()}async function f(e,t={}){const n="boolean"!==typeof(null===t||void 0===t?void 0:t.strictNumbers)||(null===t||void 0===t?void 0:t.strictNumbers),i=await o.OZ.create({component:_.A,backdropDismiss:!1,cssClass:"keypad-modal custom-modal-backdrop",componentProps:{title:(null===t||void 0===t?void 0:t.title)||"",preset:(null===t||void 0===t?void 0:t.preset)||"",toggleButton:null===t||void 0===t?void 0:t.toggleButton,strictNumbers:n,customKeyboard:null===t||void 0===t?void 0:t.customKeyboard,noFloat:"boolean"===typeof(null===t||void 0===t?void 0:t.noFloat)&&t.noFloat,onKeyPress(t,o){e(n?parseInt(t):t,o)}}});i.present()}async function h(e,t){(await o.OZ.create({component:v,backdropDismiss:!1,cssClass:"full-modal",componentProps:{dismissType:"modal",currentField:e,onFinish:t}})).present()}},25855:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});n(44114),n(27495),n(98992),n(54520),n(3949),n(81454);var o=n(20641),i=n(1590),l=n(25310),a=n(77270),r=n(741),s=n(88049),d=n(75220),u=n(85901),c=n(82077),p=n(50953),v=n(90033);function m(e,t,n,i,l,a){const r=(0,o.g2)("ion-title"),s=(0,o.g2)("IonIcon"),d=(0,o.g2)("ion-button"),u=(0,o.g2)("ion-buttons"),c=(0,o.g2)("ion-toolbar"),p=(0,o.g2)("ion-header"),m=(0,o.g2)("ion-label"),_=(0,o.g2)("ion-item"),b=(0,o.g2)("ion-list"),f=(0,o.g2)("ion-content"),h=(0,o.g2)("ion-footer"),y=(0,o.g2)("ion-modal"),g=(0,o.g2)("ion-page");return(0,o.uX)(),(0,o.Wv)(g,null,{default:(0,o.k6)((()=>[(0,o.bF)(f,{class:"ion-padding"},{default:(0,o.k6)((()=>[(0,o.bF)(y,{"is-open":e.open},{default:(0,o.k6)((()=>[(0,o.bF)(p,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,null,{default:(0,o.k6)((()=>[(0,o.bF)(r,{style:{"font-size":"20px","font-weight":"600"}},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)("Patient order")]))),_:1}),(0,o.bF)(u,{slot:"end"},{default:(0,o.k6)((()=>[(0,o.bF)(d,{strong:!0,onClick:t[0]||(t[0]=t=>e.handleDialog())},{default:(0,o.k6)((()=>[(0,o.bF)(s,{size:"large",icon:e.close},null,8,["icon"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(f,null,{default:(0,o.k6)((()=>[(0,o.bF)(b,null,{default:(0,o.k6)((()=>[(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[3]||(t[3]=[(0,o.eW)("Tracking Number")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t;return[(0,o.eW)((0,v.v_)(null===(t=e.order)||void 0===t?void 0:t.tracking_number),1)]})),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[4]||(t[4]=[(0,o.eW)("Accession Number")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t;return[(0,o.eW)((0,v.v_)(null===(t=e.order)||void 0===t?void 0:t.accession_number),1)]})),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[5]||(t[5]=[(0,o.eW)("Patient Name")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t,n,i,l;return[(0,o.eW)((0,v.v_)(`${null===(t=e.order)||void 0===t?void 0:t.client.first_name} ${null!=(null===(n=e.order)||void 0===n?void 0:n.client.middle_name)?null===(i=e.order)||void 0===i?void 0:i.client.middle_name:""} ${null===(l=e.order)||void 0===l?void 0:l.client.last_name}`),1)]})),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[6]||(t[6]=[(0,o.eW)("Specimen Type")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t;return[(0,o.eW)((0,v.v_)(null===(t=e.order)||void 0===t?void 0:t.specimen),1)]})),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[7]||(t[7]=[(0,o.eW)("Test(s) Ordered")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t;return[(0,o.eW)((0,v.v_)(e.extractedTests(null===(t=e.order)||void 0===t?void 0:t.tests)),1)]})),_:1})])),_:1}),(0,o.bF)(_,null,{default:(0,o.k6)((()=>[(0,o.bF)(m,{style:{"font-size":"18px","font-weight":"600"}},{default:(0,o.k6)((()=>t[8]||(t[8]=[(0,o.eW)("Specimen Status")]))),_:1}),(0,o.bF)(m,{slot:"end"},{default:(0,o.k6)((()=>{var t,n;return[(0,o.eW)((0,v.v_)("specimen-not-collected"==(null===(t=e.order)||void 0===t?void 0:t.order_status)?"Specimen not collected":null===(n=e.order)||void 0===n?void 0:n.order_status),1)]})),_:1})])),_:1})])),_:1})])),_:1}),(0,o.bF)(h,null,{default:(0,o.k6)((()=>[(0,o.bF)(c,{color:"light",style:{padding:"5px"}},{default:(0,o.k6)((()=>[(0,o.bF)(d,{onClick:t[1]||(t[1]=t=>e.changeSpecimenStatus("accepted")),slot:"end",size:"large",color:"success"},{default:(0,o.k6)((()=>t[9]||(t[9]=[(0,o.eW)(" Accept ")]))),_:1}),(0,o.bF)(d,{onClick:e.rejectOrder,slot:"end",size:"large",color:"danger"},{default:(0,o.k6)((()=>t[10]||(t[10]=[(0,o.eW)(" Reject ")]))),_:1},8,["onClick"]),(0,o.bF)(d,{onClick:e.addTest,slot:"end",size:"large",color:"primary"},{default:(0,o.k6)((()=>t[11]||(t[11]=[(0,o.eW)(" Add Test ")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["is-open"])])),_:1})])),_:1})}var _=n(46079),b=n(27311),f=n(73235),h=n(35480),y=n(94355);const g=(0,o.pM)({components:{IonPage:f.AO,IonButtons:f.QW,IonButton:f.Jm,IonIcon:f.iq,IonModal:f.Sb,IonHeader:f.eU,IonContent:f.W9,IonToolbar:f.ai,IonTitle:f.BC,IonFooter:f.M0,IonItem:f.uz,IonLabel:f.he,IonList:f.nf},data(){return{open:!0,close:h.VNx,details:{client:{date_of_birth:"",first_name:"",id:"",last_name:"",middle_name:"",sex:""}}}},props:{order:{required:!0,type:Object},show:{required:!0,default:!1,type:Boolean}},async created(){const e=(0,r.Kj)(),t=await e.getJson(`tests/${this.order.tests[0].id}`);null!==t&&void 0!==t&&t.ok&&(this.details=null===t||void 0===t?void 0:t.data)},methods:{extractedTests(e){return e.map((e=>e.test_type_name)).join(", ")},handleDialog(){this.open=!1},async changeSpecimenStatus(e){const t=(0,r.Kj)(),n=await t.putJson(`order_statuses/${e}`,{order_id:this.details.order_id});null!==n&&void 0!==n&&n.ok&&((0,u.tP)(`Specimen ${e} successfully!`),this.open=!1,_.A.push(`/test/details?test_id=${this.details.id}`))},async rejectOrder(){this.open=!1,_.A.push(`test/reject/${this.details.id}`)},loadOrder(){(0,y.A)().searchbyID(this.details.accession_number)},async addTest(){this.handleDialog();const e=(0,r.Kj)();(0,b.u0)([{id:"test_types",helpText:"Select test types",type:a.P.TT_MULTIPLE_SELECT,config:{showKeyboard:!0},computedValue:(e,t)=>({order_id:this.details.order_id,tests:e.map((e=>({specimen:e.value,test_type:e.label})))}),options:async()=>{const t=await e.getJson("specimen/test_types",{specimen_id:this.details.specimen_id});return console.log(t),null!==t&&void 0!==t&&t.ok?t.data.map((e=>({label:e,value:this.details.specimen_id}))):[]},validation:e=>i.A.required(e)}],(async(t,n)=>{const o=await e.postJson("orders/add_test_to_order",n.test_types);if(null===o||void 0===o||!o.ok)return(0,u._O)(null===o||void 0===o?void 0:o.error);f.OZ.getTop().then((e=>e&&f.OZ.dismiss())),this.loadOrder()}),null)}}});var k=n(66262);const F=(0,k.A)(g,[["render",m]]),T=F;var w=n(53751);let C;function I(e,t){const n=document.getElementById("rootContainer");C&&C.unmount(),C=(0,w.Ef)(T,{show:e,order:t}),C.mount(n,!1)}const x=(0,o.pM)({__name:"NewOrder",setup(e){const t=(0,p.KR)(),n=((0,p.KR)(),(0,p.KR)(!1)),v=()=>{n.value=!0,I(n.value,t.value)},m=(0,d.lq)(),b=(0,r.Kj)(),f=()=>{const e=[];return{id:"visit_type",helpText:"Visit type",type:a.P.TT_SELECT,requireNext:!1,validation:e=>i.A.required(e),computedValue:e=>({encounter:{encounter_type:e.value}}),init:async()=>{var t;const n=await b.getJson("encounter_types");return!(null===n||void 0===n||!n.ok)&&(null===(t=n.data)||void 0===t||t.data.forEach((t=>{e.push({label:t.name,value:t.id})})),!0)},options:()=>e}},h=()=>({id:"clinician",helpText:"Requesting Clinician",type:a.P.TT_TEXT,computedValue:e=>({order:{requested_by:e.value}}),options:async e=>{var t;if(null!==(t=e.clinician)&&void 0!==t&&t.value){var n;const t=await b.getJson("orders/search_by_requesting_clinician",{name:null===(n=e.clinician)||void 0===n?void 0:n.value});return null===t||void 0===t?void 0:t.data.map((e=>({label:e,value:e})))}return[]},validation:e=>i.A.required(e)}),y=()=>({id:"collector",helpText:"Sample collected by (Optional)",type:a.P.TT_TEXT,computedValue:e=>({order:{collected_by:(null===e||void 0===e?void 0:e.value)||""}})}),g=()=>{let e=null;return{id:"ward",helpText:"Requesting ward/location",requireNext:!1,type:a.P.TT_SELECT,init:async()=>{const t=await b.getJson("global");return t.ok&&(e=t.data.id),!0},config:{showKeyboard:!0},computedValue:t=>({encounter:{facility_section:t.value,sending_facility:e||-1}}),validation:e=>i.A.required(e),options:async e=>{const t=await b.getJson("encounter_type_facility_section_mappings/facility_sections",{encounter_type_id:e.visit_type.value});return(t.data||[]).map((e=>({label:e.name,value:e.id})))}}},k=()=>({id:"date",helpText:"Date",type:a.P.TT_DATE_PICKER,validation:e=>i.A.required(e)}),F=()=>{let e=[];return{id:"specimen_type",helpText:"Specimen type",type:a.P.TT_SELECT,requireNext:!1,init:async()=>{const t=await b.getJson("specimen");return!(null===t||void 0===t||!t.ok)&&(e=t.data.map((e=>({label:e.name,value:e.id}))),!0)},config:{showKeyboard:!0},options:()=>e,validation:e=>i.A.required(e)}},T=()=>{let e=[];return{id:"priority",helpText:"Specify priority",type:a.P.TT_SELECT,computedValue:e=>({order:{priority:e.value}}),validation:e=>i.A.required(e),init:async()=>{const t=await b.getJson("priorities");return!(null===t||void 0===t||!t.ok)&&(e=t.data.map((e=>({label:e.name,value:e.id}))),!0)},options:()=>e}},w=()=>{let e=[],t=null;return{id:"test_types",helpText:"Select test types",type:a.P.TT_MULTIPLE_SELECT,config:{showKeyboard:!0},computedValue:(e,t)=>({tests:e.map((e=>({specimen:t.specimen_type.value,test_type:e.value})))}),options:async n=>{var o;const i=await b.getJson(`/clients/${m.params.client_id}`),l=null!==i&&void 0!==i&&null!==(o=i.data)&&void 0!==o&&o.sex.match(/f/i)?"Female":"Male";if(n.specimen_type.value!=t){e=[],t=n.specimen_type.value;const o=await b.getJson("specimen/test_types",{specimen_id:t,sex:l});if(null===o||void 0===o||!o.ok)return[];e=o.data.map((e=>({label:e,value:e})))}return e},validation:e=>i.A.required(e)}},C=()=>({id:"time_sample_collected",helpText:"Time Sample Collected",type:a.P.TT_TIME,computedValue:(e,t)=>({order:{sample_collected_time:`${t.date} ${e.value}`}}),validation:e=>i.A.required(e)}),x=[f(),g(),h(),y(),F(),w(),k(),C(),T()],A=async(e,o)=>{var i;const l=new c.A,{getLocation:a,token:d}=(0,r.Kj)(),p=null===(i=d.value)||void 0===i||null===(i=i.authorization)||void 0===i?void 0:i.user,f=p.lab_locations.filter((e=>e.name==a())),h={client:{id:parseInt(`${m.params.client_id}`)},lab_location:f[0].id,...(0,s.T)(o,"encounter"),...(0,s.T)(o,"order"),...(0,s.T)(o,"tests")};b.postJson("orders",h).then((e=>{t.value=e.data;const o=e.data.accession_number;if(!e.ok)return(0,u._O)(e.error);l.writeLbl("printout/accession_number",{accession_number:o},`${o}.lbl`),n.value=!0;try{_.A.push("/tests")}catch(i){console.log(i)}(0,u.tP)("Order as been created!"),v()})).catch((()=>(0,u.L_)(r.MZ.GENERAL_ERROR)))};return(e,t)=>((0,o.uX)(),(0,o.CE)("div",null,[(0,o.bF)(l.A,{fields:x,onFinish:A,skipSummary:!0,cancelDestinationPath:"/home"}),t[0]||(t[0]=(0,o.Lk)("div",{id:"rootContainer"},null,-1))]))}}),A=x,S=A},22812:e=>{var t=TypeError;e.exports=function(e,n){if(e<n)throw new t("Not enough arguments");return e}},14603:(e,t,n)=>{var o=n(36840),i=n(79504),l=n(655),a=n(22812),r=URLSearchParams,s=r.prototype,d=i(s.append),u=i(s["delete"]),c=i(s.forEach),p=i([].push),v=new r("a=1&a=2&b=3");v["delete"]("a",1),v["delete"]("b",void 0),v+""!=="a=2"&&o(s,"delete",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return u(this,e);var o=[];c(this,(function(e,t){p(o,{key:t,value:e})})),a(t,1);var i,r=l(e),s=l(n),v=0,m=0,_=!1,b=o.length;while(v<b)i=o[v++],_||i.key===r?(_=!0,u(this,i.key)):m++;while(m<b)i=o[m++],i.key===r&&i.value===s||d(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},47566:(e,t,n)=>{var o=n(36840),i=n(79504),l=n(655),a=n(22812),r=URLSearchParams,s=r.prototype,d=i(s.getAll),u=i(s.has),c=new r("a=1");!c.has("a",2)&&c.has("a",void 0)||o(s,"has",(function(e){var t=arguments.length,n=t<2?void 0:arguments[1];if(t&&void 0===n)return u(this,e);var o=d(this,e);a(t,1);var i=l(n),r=0;while(r<o.length)if(o[r++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},98721:(e,t,n)=>{var o=n(43724),i=n(79504),l=n(62106),a=URLSearchParams.prototype,r=i(a.forEach);o&&!("size"in a)&&l(a,"size",{get:function(){var e=0;return r(this,(function(){e++})),e},configurable:!0,enumerable:!0})}}]);
//# sourceMappingURL=3372.f58788a7.js.map